<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>借助VSCode在Ubuntu上使用QQ</title>
      <link href="/article/7d0a.html"/>
      <url>/article/7d0a.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/ubuntu/2021-07-02_23-59.png"></fancybox><p>更新于2021年6月。Ubuntu上使用QQ一直是个痛点，而且令人不解的是腾讯除了在19年把远古版本LinuxQQ拿出来修补一下之外，没有任何迹象表明其会推出官方的Linux新版QQ，所以通常Linux之上使用QQ就几个方式：① Wine版QQ，② 通过协议自定义封装的仿QQ的IM工具。本文使用的就是后者，而且作者借助Vscode以插件形式运行。</p><a id="more"></a><p>直接上地址： <a href="https://github.com/takayama-lily/vscode-qq" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/takayama-lily/vscode-qq</a></p><p><strong>此项目非常新鲜，三个月前才被创建，项目并非专为Linux设计，但完全可以在Ubuntu上使用</strong>，目前使用上发送信息有些小bug，但可以稳定的接受个人和群聊消息。</p><h4 id="为什么不用Wine版QQ"><a href="#为什么不用Wine版QQ" class="headerlink" title="为什么不用Wine版QQ"></a><strong>为什么不用Wine版QQ</strong></h4><p>第一，Wine的环境需要额外的安装，整体上有些复杂。本质上Wine类似于JVM虚拟机，可以让Windows应用跨平台的运行在Linux之上，但问题是QQ的适配并不完美，甚至可以说是<strong>十分糟糕</strong>，由于WindowsQQ的版本迭代更新太快，所以导致Wine上的适配工作往往并不及时，而且由于现在QQ的软件本身体量巨大，有些Wine版本的QQ直接放弃维护了，早期的比如：</p><p><a href="https://github.com/askme765cs/Wine-QQ-TIM" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/askme765cs/Wine-QQ-TIM</a> （这在2020年时尚可使用，但目前已无法登陆。）</p><p>第二，字体适配不佳。Wine环境本身有一套渲染字体，但由于其并非官方QQ的字体，而且仅有几种简单的字体以供选择，这直接导致即便你可以使用WineQQ，但整个界面都显得十分古怪，甚至使用体验不及官方的水货版LinuxQQ。</p><p>可以看到，对于使用QQ而言，WineQQ并不是十分友好的选择，虽然目前有新的针对Ubuntu20的WineQQ版本，但那些版本都基本无法在18、16、14版ubuntu上使用。而且对于我、或者使用Ubuntu作为实验编程平台的用户来说，更换、升级Ubuntu版本是个十分头疼的事情，因为涉及显卡驱动等等事项，非常容易因为升级了内核导致驱动无效而黑屏无法进入系统的情况。综上，在有替代品的前提下，为什么还要用wineQQ呢？！</p><h4 id="为什么用Vscode-QQ"><a href="#为什么用Vscode-QQ" class="headerlink" title="为什么用Vscode-QQ"></a><strong>为什么用Vscode-QQ</strong></h4><p>第一，轻量。以Vscode插件的形式，借助QQ协议库，直接重写一套UI，这是个绝佳的想法，没有冗余的功能需求，直接砍掉大量和聊天无关的功能，只保留核心的收发消息、收发表情图片。（文件好像还不支持！）</p><p>第二，界面友好。同样，在Vscode内，整个聊天界面直接由文件页面代替，也就是说打开某个人、群组进行聊天，就像打开一个文件那样操作，这在Vscode内是十分舒服的，可以无缝的和你编程工作混合在一起。</p><p>第三，安装方便。直接在Vscode插件栏搜索安装即可，安装之后需要用Vscode的命令搜索栏登陆一下账号，之后就可以愉快的聊天了，没有任何多余步骤，真的一分钟就可以在Ubuntu上使用到QQ！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/ubuntu/2021-07-02_23-55.png"></fancybox><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a><strong>结语</strong></h4><p>就像开头说的，目前此项目还处在开始阶段，连issue也才十几个，使用上的问题也存在，但不影响整体收发信息的功能，可以说很好的解决了QQ在Ubuntu的使用问题，作为一个Ubuntu使用者，非常真诚的向大家推荐这个工具！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/ubuntu/2021-07-02_15-57.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> QQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用PC同步播放移动设备的音频</title>
      <link href="/article/8caf.html"/>
      <url>/article/8caf.html</url>
      
        <content type="html"><![CDATA[<p>当你使用台式机工作时，你是否喜欢在旁边放一个pad或手机刷其他视频或音乐？并且在没有条件外放声音的情况下，你是否尝试过带两个耳机来收听两个设备的音频（电脑+移动设备）？如果你想这么干，又苦于没有头绪，那么本文将告诉你各种可能的方案以及他们是否可行，当然最后你会得到堪称完美的整合方式。</p><p>与此问题的相关英文问法通常是：</p><p><strong>How to stream audio from an Android device to a Windows PC ??</strong></p><h4 id="为什么要这样做"><a href="#为什么要这样做" class="headerlink" title="为什么要这样做"></a><strong>为什么要这样做</strong></h4><p>首先要明确我的使用场景：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210510032841.png" alt></p><a id="more"></a><p>可以看到，平板在我的桌面相当于一块小副屏，当然它并不能和PC直接互通，我们知道，华为的手机和平板、电脑之间可以多屏协作，即将手机画面和声音以有线或无线方式投送到平板、电脑之上，以达到在电脑上处理手机事务的能力，<strong>但遗憾的是：目前华为平板和电脑之间并没有多屏协作的官方方案！</strong>也就是说，对于平板来说，在华为设计思路里，并不是从属设备而是替代PC的主力设备，这和iPad的发展类似，当然它发展它的，我们个人的需求仍然要满足滴！</p><p>所以，我的需求是，在我正常使用耳机在台式电脑办公/娱乐时，我想从<strong>同一副耳机中听到来自平板中播放视频的声音</strong>，也就是说，虽然带着一副耳机，但可以听到不同类型设备的音频输出，这样我的平板就更加像一块小副屏，仅仅担负放视频的任务，声音共享。所以，核心问题来了：<strong>如何采集平板的音频并传输给PC？</strong></p><p>各种失败的尝试：</p><h4 id="第三方投屏软件"><a href="#第三方投屏软件" class="headerlink" title="第三方投屏软件"></a><strong>第三方投屏软件</strong></h4><p>由于华为的平板没有所谓的“多屏协作”，所以我想使用第三方的投屏软件来将平板的音视频投影到电脑上，当然这也就实现了我的目的，但通过尝试，发现当前<strong>几乎没有能够采集音频的投屏软件</strong>，有教程称小米自带投屏支持声音拾取，对此我并没有验证。更通俗的方案是依赖谷歌框架的投屏功能，不过我的 Matepadpro 是谷歌阉割版，此种方案作罢。</p><ul><li>这时我发现了名为“傲软投屏”的软件，号称可以采集声音，但经过实测，只是能采集平板的麦克风输入声音，USB或者Wifi连接都无法得到平板的音频输出！</li></ul><h4 id="远程桌面软件"><a href="#远程桌面软件" class="headerlink" title="远程桌面软件"></a><strong>远程桌面软件</strong></h4><p>如果你设备较多人又很懒，那么使用 TeamViewer 或者 Anydesk 等远程桌面软件来管理多个硬件设备是非常合适的，当然不使用 Windows 自带远程桌面的原因是：<strong>要兼容移动设备</strong>，所以使用 Anydesk 之类的软件即可轻松跨平台访问远程桌面。</p><ul><li>因此，在平板上安装 Anydesk 是个很自然的想法，更重要的是，对于电脑与电脑之间的远程访问，Anydesk 是支持声音传输的，即远端桌面上播放音乐，在访问端也可听到声音。但遗憾的是，经过实测，当 MatepadPro 和电脑通过 Anydesk 连接后，并不能听到任何平板的音频输出，不过其和投屏软件一样，也支持平板上麦克风声音的拾取。</li></ul><h4 id="电脑当做移动设备的蓝牙音频输出设备"><a href="#电脑当做移动设备的蓝牙音频输出设备" class="headerlink" title="电脑当做移动设备的蓝牙音频输出设备"></a><strong>电脑当做移动设备的蓝牙音频输出设备</strong></h4><p>即，把电脑当做平板的蓝牙耳机，当然就可以得到平板的声音了！这是最合理可行的方案，不过需要我们将 Windows 作为接收音频的蓝牙设备，完成此功能需要借助名为 “Bluetooth Audio Receiver” 的<strong>UWP应用</strong>，我没找到该软件的正常安装版本，对于我来说，我早已将微软的商店服务给禁用了，自然也无法使用此种方案。</p><h4 id="可能的替代方案"><a href="#可能的替代方案" class="headerlink" title="可能的替代方案"></a><strong>可能的替代方案</strong></h4><p>是否有该UWP应用的替代品？部分网络教程提及了蓝牙的音频传输功能，即，当平板和电脑以蓝牙相连时，在电脑上的蓝牙选项中会存在“接收音频”类似的功能选项，如果选中则可以得到平板的音频。但我的华为平板通过蓝牙连接电脑后，没有任何声音选项，故此方案不可。</p><p>经检索，网上有人说可以用过 “IVT BlueSoliel” 即千月蓝牙来实现。多说一嘴，千月蓝牙工具的核心是使用了虚拟蓝牙串口，即他会接管原有蓝牙功能，但其协议堆栈是和 Windows原生蓝牙是不同的，这也是为什么有时他能解决问题的原因。但是，经过我的尝试，这玩意儿也不好使，而且客户端做的仿佛是上世纪的UI，体验一般。</p><h4 id="正确答案"><a href="#正确答案" class="headerlink" title="正确答案"></a><strong>正确答案</strong></h4><p>以上试了这么多方案，有无线连接的，也有通过 USB 连接的，当然，对我来说我对有线无线并不在乎。所以，当我在尝试投屏软件时，有个“USB”直连模式我果断试用了，因为用 USB 连接并不占用带宽，这对局域网来说是很重要的！尤其是我现在用的路由器并不强劲。虽然投屏软件没能解决我的问题，但它引出了后续的终极方案：ADB调试直连。</p><p>需要用到的两个开源工具：</p><ul><li>scrcpy：<a href="https://github.com/Genymobile/scrcpy" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/Genymobile/scrcpy</a></li><li>sndcpy：<a href="https://github.com/rom1v/sndcpy" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/rom1v/sndcpy</a></li></ul><p>借助 Scrcpy 可以达到同屏的目的，几乎无延迟，我强烈怀疑有很多投屏软件就是这个开源项目的再封装。借助 Sndcpy 可以达到同步音频的目的，几乎无延迟！这不就是我苦苦寻找的东西吗！！两者同时使用，则可以将移动设备的画面及声音完全复制到电脑之上，当然，亲测<strong>单独使用 Sndcpy 也是可行的！</strong>这就完完全全是我想要的效果了：</p><p>只把平板的声音同步到电脑，在我用电脑娱乐玩游戏（游戏内有声音）时，耳机中也能听见来自平板上的视频的声音！</p><h4 id="Sndcpy-使用注意事项"><a href="#Sndcpy-使用注意事项" class="headerlink" title="Sndcpy 使用注意事项"></a><strong>Sndcpy 使用注意事项</strong></h4><ul><li><p>一定要打开手机的USB调试，验证：电脑通过数据线连接移动设备后，会弹出“是否允许调试”的询问弹框。</p></li><li><p>一定要在电脑端安装VLC播放器！其需要借助VLC的解码器。</p></li><li><p>一定要添加环境变量！</p></li></ul><blockquote><p>ADB: the full path to the adb executable<br>VLC: the full path to the vlc executable<br>SNDCPY_APK: the full path to sndcpy.apk<br>SNDCPY_PORT: the local port to forward to communicate with the device</p></blockquote><ul><li>优化使用</li></ul><p>以上两个工具，正常的使用方法是直接点击 xx.exe 唤起 Console 黑框终端运行，使用期间cmd终端会一直在且不可以关闭，这很令人抓狂！</p><p>当然我发现了完美的解决办法：将cmd终端<strong>最小化到右下角图标区域</strong>，仍然是后台常驻，但不会占用任务栏的空间，你也不会再在桌面看到任何黑框！</p><p>实现该功能的项目地址：<a href="https://github.com/fcFn/traymond" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/fcFn/traymond</a><br>使用：<strong>win键 + shift + Z</strong> 把当前窗口最小化常驻到右下角图标</p><h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a><strong>结语</strong></h4><p>通过最后的方案，实现了平板声音的实时采集传输，无需蓝牙，不用同屏图像，完美方案！！！<br>值得一提的是，该方案并不影响平板的原有音频输出！同时也不影响电脑原有的音频输出，如果同时播放视频，就像在浏览器同时开两个视频页面的效果一样（叠加）。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ADB调试 </tag>
            
            <tag> 踩坑 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大疆无人机全景图-补天-教程</title>
      <link href="/article/b157.html"/>
      <url>/article/b157.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210309000832.png"></fancybox><a id="more"></a><h3 id="为什么不用大疆默认导出"><a href="#为什么不用大疆默认导出" class="headerlink" title="为什么不用大疆默认导出"></a>为什么不用大疆默认导出</h3><p>原因很简单，那就是：画质差！</p><p>可以体会下这两者的区别，大疆 DJI Fly 导出的全景图（上）和使用PTGui合成分片的全景图（下）：</p><ul><li><p><strong>大小 2.72M</strong>，<a href="https://720yun.com/t/59vkcmfys2w" target="_blank" rel="external nofollow noopener noreferrer">https://720yun.com/t/59vkcmfys2w</a></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308221340.png"></fancybox></li><li><p><strong>大小 25.3M</strong>，<a href="https://720yun.com/t/34vkcmf7577" target="_blank" rel="external nofollow noopener noreferrer">https://720yun.com/t/34vkcmf7577</a></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308221305.png"></fancybox></li></ul><p>非常明显，下面的更加清晰！大疆导出的全景图简直不要太“糊”！要合成下面的全景图，那么就要用到 PTGui 这个软件。</p><h3 id="使用PTGui"><a href="#使用PTGui" class="headerlink" title="使用PTGui"></a>使用PTGui</h3><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308211017.png"></fancybox><p>拿出SD卡插到电脑，你会发现 DCIM-&gt;PANORAMA 这样的文件夹，这个文件夹就是存储全景图的地方，每个子文件夹（有很多分片）其实就是一张全景图，大疆默认导出时自动合成为一张图并保存到你的手机，也就是这个过程，让整个画面的画质产生了很大的损失。</p><p>如果我们自己合成，就可以控制合成图的质量，这也是我们的目标。要合成全景图，使用的工具就是PTGui，这里推荐直接用破戒的Pro版本。</p><ul><li>下载、安装、破戒：<a href="http://www.ddooo.com/softdown/177395.htm" target="_blank" rel="external nofollow noopener noreferrer">http://www.ddooo.com/softdown/177395.htm</a></li></ul><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>非常简单的三个步骤：<strong>①导入上述的分片</strong>、<strong>②对齐影像</strong>、<strong>③生成全景图</strong>。（因为无人机拍摄的分片是非常规整的，所以不需要任何手动设置）</p><p>注意在最后一步，有两个地方涉及合成质量：</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308213038.png"></fancybox><p>点击“创建全景”即可，然后点击“查看”，可以在 PTGui 内部的查看器里查看自由视角的合成图片（和720yun的效果是一样的）。如果你选择的“文件格式”是 jpg，那么导出后就可直接上传至 720yun 等平台发布全景图。</p><ul><li>最终结果：<a href="https://720yun.com/t/e8vkcmfw0qw" target="_blank" rel="external nofollow noopener noreferrer">https://720yun.com/t/e8vkcmfw0qw</a></li></ul><p>Wait！怎么刚合成的全景图头上有个洞！！别慌，我们下面就用PS来补上！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="为什么要补天"><a href="#为什么要补天" class="headerlink" title="为什么要补天"></a>为什么要补天</h3><p>默认情况下，全景图是由十几组照片（或六面体）合成的，大疆的拍摄方法，在PTGui里合成时会出现上部缺省的现象（下图的黑色部分），合成之后的结果，就是头顶有块没有像素的“黑洞”，在产出的全景图作品中，我们自然是不会允许这个洞存在，大疆默认的导出实际上是填补了这个洞，当然，我们也可以自己用PS补上这个洞。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308215550.png"></fancybox><h4 id="补天工具-Photoshop"><a href="#补天工具-Photoshop" class="headerlink" title="补天工具 Photoshop"></a>补天工具 Photoshop</h4><p>安装和使用：<a href="https://www.yutu.cn/softhtml/softsetup_1176.html" target="_blank" rel="external nofollow noopener noreferrer">https://www.yutu.cn/softhtml/softsetup_1176.html</a></p><h3 id="开始补天"><a href="#开始补天" class="headerlink" title="开始补天"></a>开始补天</h3><h4 id="天空元素单一"><a href="#天空元素单一" class="headerlink" title="天空元素单一"></a>天空元素单一</h4><p><strong>适用：</strong> 云彩不多，可见物不多，或者说“元素”不多，天空整体比较干净纯净；</p><p><strong>实质：</strong> 通过<strong>选择区域-&gt;编辑-&gt;填充</strong>，最后加涂抹，来过渡延展原始内容；</p><p><strong>步骤：</strong> <a href="https://bbs.dji.com/thread-238753-1-1.html" target="_blank" rel="external nofollow noopener noreferrer">https://bbs.dji.com/thread-238753-1-1.html</a></p><p><strong>核心操作：</strong> 使用<strong>滤镜-&gt;其他-&gt;位移</strong>，把复杂元素移到中间，千万不要放在左右两边。左右两边在合成全景后是接缝区域，如果直接涂抹修改，几乎无法做到接缝不可见，但是通过位移将元素单一的区域作为接缝，那就会得到非常完美的全景图。</p><h4 id="天空元素复杂"><a href="#天空元素复杂" class="headerlink" title="天空元素复杂"></a>天空元素复杂</h4><p><strong>适用：</strong> 多云天气，整个天空几乎找不到一处“竖向纯色调”的区域，那么如果我们涂抹缺省的黑色部分，很难做到左右两侧的颜色一致，这会直接导致合成之后明显的接缝。所以此时不能使用上述的方法来补天。比较方便、快捷的方法是：更换现成的无接缝天空素材。</p><p><strong>步骤：</strong> <a href="https://zhuanlan.zhihu.com/p/36005588" target="_blank" rel="external nofollow noopener noreferrer">https://zhuanlan.zhihu.com/p/36005588</a></p><p><strong>核心操作：</strong> 使用蒙版+渐变+合并天空素材图层，来用素材的“完整”天空，补全原来的残缺的天空。</p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>这里，由于我的天空比较干净，所以我只需要填充加涂抹就可以得到一张比较好的全景图，不过如果你仔细看正上方的天空，依然能够看到接缝区域（虽然没有明显的接缝线）。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210308214809.png"></fancybox><p><strong>最终效果：</strong> <a href="https://720yun.com/t/34vkcmf7577" target="_blank" rel="external nofollow noopener noreferrer">https://720yun.com/t/34vkcmf7577</a></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 测评 </tag>
            
            <tag> 摄影 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网站改版/域名更换全步骤</title>
      <link href="/article/3328.html"/>
      <url>/article/3328.html</url>
      
        <content type="html"><![CDATA[<p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210220055122.png"></fancybox></p><p>更换域名在建站初期是经常发生的事情，无非就是DNS修改下解析，替换下内部代码，但对于运营过一段时间的、搜索引擎收录良好的“成熟”站点来说，修改域名，对网站流量和引擎收录简直就是灭顶之灾。正值最近本站刚更换了域名，就此来记录下作为一个网站，更换域名所需要考虑和修改的内容。</p><a id="more"></a><h3 id="更换DNS绑定域名"><a href="#更换DNS绑定域名" class="headerlink" title="更换DNS绑定域名"></a>更换DNS绑定域名</h3><p>这一步不再赘述，无非就是解绑旧域名，换绑新域名。</p><h3 id="301重定向（重要！）"><a href="#301重定向（重要！）" class="headerlink" title="301重定向（重要！）"></a>301重定向（重要！）</h3><p>此步骤是重中之重！对搜索引擎来说，有专门的网站改版提交入口，目的是主动通知搜索引擎你的原站链接变更，从而加快新域名链接的收录，但完成网站改版的验证，（百度，谷歌）都需要你将旧域名的链接通过<strong>301重定向</strong>来跳转到新链接。需要注意的是：</p><ul><li>强烈建议网站改版的链接按照规则来更新。最理想的规则是 <strong>a.com/1.html =&gt; b.com/1.html</strong>，即网站内容不变，仅仅是更换域名而已。</li><li>百度站长平台支持你自定义链接替换规则。</li></ul><h4 id="如何完成301重定向？"><a href="#如何完成301重定向？" class="headerlink" title="如何完成301重定向？"></a>如何完成301重定向？</h4><ul><li><strong>html或js跳转[X]</strong>。对于绝大部分使用托管服务搭建站点的用户来说，通过一个单独的page进行跳转是最佳方案了。实现方法非常多，可以利用404.html页面，借助JavaScript进行自定义跳转，但是！！这样的跳转并不是带HTTP状态的301重定向。遗憾的是，对于Github和Coding，他们并不支持搜索引擎所需要的301重定向。</li></ul><p><strong>物理机/docker服务</strong>。这是最正统的实现方法，比如使用物理主机，通过Nginx配置即可完成重定向工作。但我没有云服务器我就没机会了吗？非也！HeroKu在等你！HeroKu也是一个站点托管平台，但突出点在于托管的实体对象，是docker对象，也就是说，理论上Heroku的托管应用就可以实现301重定向，确实，他们可以！</p><p><strong>①</strong> 在Ubuntu上使用，只需要先安装heroku，再将重定向项目克隆并上传到你的heroku应用中，最后配置所谓的“重定向路径”。具体步骤如下：</p><p>（其他平台安装参见：<a href="https://devcenter.heroku.com/articles/heroku-cli）" target="_blank" rel="external nofollow noopener noreferrer">https://devcenter.heroku.com/articles/heroku-cli）</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo snap install --classic heroku</span><br><span class="line">$ heroku login</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/joeyAghion/rerouter.git </span><br><span class="line">$ <span class="built_in">cd</span> rerouter</span><br><span class="line">$ git init</span><br><span class="line">$ heroku git:remote -a redirectold //heroku项目名称</span><br><span class="line"></span><br><span class="line">$ git add . //克隆后要修改一处地方！！</span><br><span class="line">$ git commit -am <span class="string">"make it better"</span></span><br><span class="line">$ git push heroku master</span><br><span class="line"></span><br><span class="line">$ heroku config:<span class="built_in">set</span> REDIRECTS=<span class="string">"&#123;'www.cz5h.com'=&gt;'www.cxmoe.com'&#125;"</span></span><br><span class="line">$ heroku domains:add cz5h.com</span><br></pre></td></tr></table></figure><p>注意：克隆之后的源代码需要修改一下，把跳转链接改为 <code>https</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">require &#39;rack&#x2F;rewrite&#39;</span><br><span class="line"># Expects ENV[&#39;REDIRECTS&#39;] to be a ruby hash of source hostnames to destination hostnames. E.g.:</span><br><span class="line">#   &quot;&#123;&#39;old.domain.com&#39; &#x3D;&gt; &#39;new.domain.com&#39;&#125;&quot;</span><br><span class="line">REDIRECTS &#x3D; eval(ENV[&#39;REDIRECTS&#39;] || &#39;&#39;) || &#123;&#125;</span><br><span class="line">use Rack::Rewrite do</span><br><span class="line">  REDIRECTS.each do |from, to|</span><br><span class="line">    r301 %r&#123;.*&#125;, &quot;https:&#x2F;&#x2F;#&#123;to&#125;$&amp;&quot;, if: -&gt; (env) &#123; env[&#39;SERVER_NAME&#39;] &#x3D;&#x3D; from &#125;</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"># Fall back to default app (empty).</span><br><span class="line">run -&gt; (env) &#123; [200, &#123;&#125;, []] &#125;</span><br></pre></td></tr></table></figure><p><strong>②</strong> 完成之后，即可在Heroku网站上看到修改的内容，尤其是Redirects配置。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210220001606.png"></fancybox></p><p><strong>③</strong> 之后，为了匹配缺省域名，我们需要两个域名绑定，分别是“a.com”和“<a href="http://www.a.com”。" target="_blank" rel="external nofollow noopener noreferrer">www.a.com”。</a></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219034340.png"></fancybox></p><p><strong>④</strong> 除此之外，为了完全对应新站链接，此处的heroku所使用的协议，应该跟我的站点一致也是“https://”，为了开启https，万恶的Heroku需要你在网站绑定信用卡，之后才可以顺利开启https。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210220001541.png"></fancybox></p><p><strong>⑤</strong> 还有，我们的301重定向需要全天可用，但heroku仅对付费者提供此项服务，因此最后选择了最便宜的类型，无需维护301太长时间，一两个月足以。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219040419.png"></fancybox></p><p><strong>⑥</strong> 一切就绪后，下面所示的SSL证书会自动添加。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219040517.png"></fancybox></p><p><strong>⑦</strong> 大功告成之后，可以去站长工具查询Http状态，当返回状态码和HEAD信息正确时，那就是301重定向已经搞定。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219044155.png"></fancybox></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="网站统计代码重置"><a href="#网站统计代码重置" class="headerlink" title="网站统计代码重置"></a>网站统计代码重置</h3><p>汇总一下，主要有：</p><ul><li>谷歌Analytics</li><li>百度统计</li><li>360站长</li><li>cnzz</li></ul><h3 id="网站地图重新提交"><a href="#网站地图重新提交" class="headerlink" title="网站地图重新提交"></a>网站地图重新提交</h3><p>我在以下平台重新提交了XML文件，</p><ul><li>baidu统计 （+robot.txt）</li><li>360站长</li><li>谷歌console</li></ul><h3 id="主动通知网站改版"><a href="#主动通知网站改版" class="headerlink" title="主动通知网站改版"></a>主动通知网站改版</h3><p>最后的步骤：去百度站长反映你要换域名了；去 Google Console 来提交网站改版。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219042138.png"></fancybox></p><p>下图显示谷歌的配置正确之后的结果。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210219130252.png"></fancybox></p><h3 id="更换第三方依赖域名"><a href="#更换第三方依赖域名" class="headerlink" title="更换第三方依赖域名"></a>更换第三方依赖域名</h3><ul><li><strong>webpushr</strong> //推送订阅弹窗</li><li><strong>valine邮件</strong>模板 //邮件设定</li><li>全局查找Hexo的theme主题文件夹，找到旧域名替换。</li></ul><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><ol><li><p>百度的网站改版校验非常奇怪，谷歌测试无误后，在百度站长就是校验失败，已经致信客服寻求帮助。</p></li><li><p>不必在意改版后的收录情况，一两个星期看一次就够啦，毕竟是一个重新收录的过程！</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 301重定向 </tag>
            
            <tag> SEO </tag>
            
            <tag> 网站改版 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远离借呗！查询你的个人征信</title>
      <link href="/article/62bb.html"/>
      <url>/article/62bb.html</url>
      
        <content type="html"><![CDATA[<p>在过去一年的年末，支付宝可谓是经历了巨大的风波，从蚂蚁金服上市被叫停整改，到马云的人设出现崩塌，似乎大家都有了一个比较统一的观念，那就是逃离蚂蚁花！对于相当一部分年轻人，蚂蚁花呗、蚂蚁借呗已经成了其生活中必不可少的工具，但同时也有相当一部分人深陷超前消费的漩涡中无法自拔…</p><a id="more"></a><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h4><p>面对花呗借呗，除了金钱上每月入不敷出的煎熬和压力外，你所承担的，或许还要更多，你今天的随意挥霍，可能带来的是可以对你今后人生造成巨大影响的隐患！借呗接入征信这是人尽皆知的，花呗最近也在部分对接征信！</p><p>以借呗为例，这个以花呗大哥身份悄然出现的新形式，点点支付宝，无需抵押无需任何资料文件，你就可以得到几千上万元真金白银，相当长的一段时间里，其受到了大部分年轻人喜爱，但后来的日子里，随着我国征信系统的不断完善，信用一词逐渐浮出水面，并通过关联各种公公资源服务，逐渐成为了一种无形且有力的约束系统。在这种情势下，以前的逾期不还、逾期几个月再还，都会在征信上给你记录的清清楚楚，等到你真正需要用到征信时，或许只能含泪悔恨当初的自己。</p><p>那么征信到底约束何人？约束老赖？错误！不要以为只有老赖才会被征信不良记录所惩治，其实只要你的征信不良记录达到一个标准，那么你就是所谓的“潜在失信人”，直接关系到你能不能顺利办理房贷、车贷等等业务。这个标准目前是：</p><blockquote><p>五年内累计超过三个月，或者存在超过90天的逾期；<br>征信机构对个人不良信息的保存期限，自不良行为或者事件终止之日起为5年；</p></blockquote><p>很难实现吗？如果你沉迷于用借呗（或者将来的花呗），一点也不难！<br>也就是说：即使你不是老赖，只要你忘记还、拖延还、或者是手机问题还不了（注意借呗通常只能手机还款），不管你什么理由，五年内逾期时间超限，那么你就是“问题人”！</p><p>这对于粗心的使用者，是及其危险的！</p><p>所以如果你不是个谨小慎微的人，切勿触碰支付宝的蚂蚁借呗！以及马上对接征信的花呗！这些形式用及其方便的操作习惯，让我们把警惕性降到了最低。尤其是对于苦逼的刚步入社会的年轻人来说，工作累、花钱多，借呗花呗用着挺爽，偶尔逾个期貌似也没关系，但对他们来说人生的下一步将是借房贷车贷来买房买车，到那时候，或许不少人看着自己满目疮痍的征信记录会欲哭无泪！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a><strong>前言</strong></h4><p>说了这么多，到底怎么查征信记录呢，EASY，一步步来即可。</p><p><strong>1 登录 <a href="https://ipcrs.pbccrc.org.cn/" target="_blank" rel="external nofollow noopener noreferrer">https://ipcrs.pbccrc.org.cn/</a></strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128045720.png"></fancybox><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128044756.png"></fancybox><p><strong>2 获取银联验证码</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128045147.png"></fancybox><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128045455.png"></fancybox><p><strong>3 填写选项提交</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128050518.png"></fancybox><p><strong>4 等待两天左右获得结果</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128050129.png"></fancybox><p><strong>5 借呗记录！</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128050033.png"></fancybox><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128023853.png"></fancybox><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128023939.png"></fancybox><p><strong>6 查询记录，一般是信用卡办理</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20210128024103.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 征信记录 </tag>
            
            <tag> 信贷 </tag>
            
            <tag> 借呗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>后科技时代—赛博朋克2077</title>
      <link href="/article/e6cd.html"/>
      <url>/article/e6cd.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201214004526.png"></fancybox><p>跳票多次终于还是来了，发售之日便收回成本这几乎是前无古人后无来者，这样一款现象级大作，我肯定也是忍不住滴，而且我的台式机配置还不错，一直没找到真正发挥作用的机会，终于借此机会，一赌大作风采！</p><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h3><p>由于波兰蠢驴发行游戏时并没有采取加密，也就是说作为单机游戏的《赛博朋克2077》，盗版瞬间就满天飞了，不过蠢驴貌似也是故意的，前期的宣发加自身质量注定这游戏是要大赚的，且后期的DLC也会让他们赚的盆满钵满。那不用担心收益，还需考虑什么呢？传播度！我觉得他们的目标是制作一款《GTA》级别的游戏，不仅好玩，而且广为流传。众所周知，3A大作年年有，可真正深入人心代代流传的，可能就那么几个。当然，支持正版我们每个人责无旁贷，298元，不贵的，希望您看到这里坚持本心，购入正版。</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><strong>准备工作</strong></h3><p>摆脱掉上个话题，我们直奔主题：什么样的机器可以玩？说实话，我一开始被风评搞得以为我的2060s都不能畅玩，但事实不是这样的，如果你的图形参数调整到“合适”的值，再加上N卡的DLSS这种技术的加持，低配玩Cp2077也是可能的，我不是专家也没法测评，最好的办法就是下载下来试一下，64G一晚上就搞定啦。</p><h3 id="游戏下载"><a href="#游戏下载" class="headerlink" title="游戏下载"></a><strong>游戏下载</strong></h3><p>请移步Steam购买正版，如果您实在囊中羞涩又发誓绝不使用盗版，那么请跪求购入正版之人，认其做父，然后让其家庭分享给你即可。</p><p>如果您坚持到这里，那您一定是想白嫖的那位，我转存到天翼云了，各位自便，版本1.40。</p><ul><li><strong>游戏附件（Cyberpunk 2077.7z 64G）下载：</strong> 16个文件合并解压一处即可，点击bin目录内exe即可畅玩。<a href="https://www.cxmoe.com">//CZ5H.COM//</a>以下访问码均换为数字：<br><a href="https://cloud.189.cn/t/mYz2y2eqAZzm" target="_blank" rel="external nofollow noopener noreferrer">https://cloud.189.cn/t/mYz2y2eqAZzm</a> ，访问码:nq三p</li><li><strong>修改器下载：</strong><br><a href="https://cloud.189.cn/t/UJbmmaQ7rIVb" target="_blank" rel="external nofollow noopener noreferrer">https://cloud.189.cn/t/UJbmmaQ7rIVb</a> ，访问码:zk九五</li><li><strong>本文链接：<a href="https://cz5h.com/article/e6cd.html" target="_blank" rel="external nofollow noopener noreferrer">https://cz5h.com/article/e6cd.html</a></strong></li></ul><h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a><strong>性能测试</strong></h3><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201214014910.png"></fancybox><p>游戏默认的全高特效，部分材质是超级，加之分辨率为2K，所以不开启DLSS的状态下，只有十几FPS，但如果开启DLSS模式，那就可以到60+FPS，可以畅玩无压力，面对静态材质，仍然具有2K的高质量画质。</p><p>通过游戏加加的监控可以发现，硬件性能被利用的不错，且FPS稳定60+，玩着非常爽。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/QQ图片20201213224004.png"></fancybox><ul><li><strong>游戏加加的下载：</strong><br><a href="https://gamepp.com/download.html" target="_blank" rel="external nofollow noopener noreferrer">https://gamepp.com/download.html</a></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="初体验"><a href="#初体验" class="headerlink" title="初体验"></a><strong>初体验</strong></h3><p><strong>绝美的赛博朋克风。</strong> 赛博朋克其实是一种科技高度发展的想象风格，说的是科技水平相当之高（义体，AI遍地），但人类却依然在精神层面没怎么进化，也就是说2077的人类，和我们差不多，但拥有2077年的超强科技，这种设定本身就是讨巧的，可以让现代人很容易产生代入感，同时又用各种“高大”、“雄壮”的科技大厦来震撼每个现代人的感官。《赛博朋克2077》中这种话面比比皆是。</p><p>你会发现里面并不包含太多工业化的东西，如果有很多，那就应该归类为蒸汽朋克了，那又是一种对未来的想象了。还有没有其他的呢？有，那便是“废土”风格，类似《辐射》等游戏就是这种类型，设定为毁灭后的后人类时代，玩起来又是另一番体验（2077之中亦有此风格的部分）。</p><p><strong>细微之处显真章。</strong> 游戏的开放程度，是超出我预期的，当然都在情理之中。</p><ul><li>某些街边的小吃摊的锅碗瓢盆，都能被打烂。</li><li>某些工业设施可以各种攀爬跳跃。</li><li>某些街边桥下的死角也可以随意畅玩。</li><li>关于光追及技术提升带来的真实感亦很震撼。<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/photomode_13122020_204854.png"></fancybox></li></ul><p><strong>不足之处也不少。</strong> 首先就是细微之处仍然不够细微：</p><ul><li>大楼不少，但能进去的就那几个；</li><li>NPC的举动有时依然很反人类很搞笑；</li><li><strong>原本剧情和你主动触发的意外情节会冲突，</strong> 比如开局阶段，当你去小吃摊和NPC对话时，如果你被警察围追且被攻击，NPC会不紧不慢的重复自己的台词，即使手榴弹满地炸，NPC依然坐在小吃摊吃东西。</li><li>反射问题。在水中、在玻璃面前，你都无法看到自己，尤其是在水中/水边，你无法低头看到倒影，有点诡异。</li><li>死角BUG。前面说了，某些犄角旮旯（比如从桥上跳下去到达的那种），也能走动自如自由探索，但我发现一个地方<strong>跳进去就出不来了！</strong>位置如地图绿色箭头所示，感兴趣的各位可以去试试，那个位置有两个大垃圾箱，有个过道可以翻越围栏过去，不过那边是死路，即你跳进去就只能读档重来了，按游戏设计正常不应该有这种死角。<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/QQ截图20201213214124.png"></fancybox></li></ul><h3 id="关于游戏的玩法"><a href="#关于游戏的玩法" class="headerlink" title="关于游戏的玩法"></a><strong>关于游戏的玩法</strong></h3><ul><li>正经做任务路线；</li><li>武器大师(制造升级)路线；</li><li>摄影大师(截图)路线；<strong>自带的截图工具太给力啦！</strong></li><li>城市探险(犄角旮旯)路线；</li><li>为非作歹路线；</li></ul><p>每个路线都非常可玩，由于此游戏的NPC触发剧情很多，所以讲道理可以玩很长的时间，而且可能正经玩家玩着玩着就被美轮美奂的景色吸引转职做摄影大师也未可知。</p><p><strong>最后以一张不夜城夜景结束本文。</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201214022709.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> Mini-ITX小钢炮 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 赛博朋克 </tag>
            
            <tag> 赛博朋克2077 </tag>
            
            <tag> Cyberpunk 2077 </tag>
            
            <tag> 附带修改器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>极米Z4X观看奈飞油管完美教程</title>
      <link href="/article/b15f.html"/>
      <url>/article/b15f.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201125194610.png"></fancybox><p>翻遍网络没找到完整的教程，有必要自己写写了。通过此方案，你可以用你的<strong>极米Z4X直接观看YouTubeTV、Netflix</strong>，完美解决极米Z4X海外体验差的痛点！本文包括全部文件的下载地址，极米Z4X完全可以照搬，对于其他型号，执行步骤相似、方案完全可行。</p><a id="more"></a><h3 id="基本的认知"><a href="#基本的认知" class="headerlink" title="基本的认知"></a><strong>基本的认知</strong></h3><p>有人说YouTubeTV可以直接在原厂固件安装，是这样的，但问题是缺少谷歌框架你就无法登陆谷歌账号，无法体验Chrome投屏！所以体验差十万八千里。</p><p>也有人说用手机看youtube再投屏也可以，是这样的，但问题是如果你只是手机用小飞机，那么手机看youtube时就和电视不在一个局域网内了，也就无法投屏；即便你用路由器fq，确实是可以看，但第一画质很低，第二你的投影依旧是个显示器，并没有挖掘其本身的性能（2+8G并不差）！</p><p>还有人说，如果你的机器安卓版本太低，那就没希望了，因为 youtubeTV 在 Andorid 5.1 以下的系统都不支持了。（实际是可以的！） </p><p>目前公认/极米官方论坛的说法是只有比较新的投影支持海外版固件的互刷，也就是说官方结论：<strong>极米Z4X及一些早起型号无法通过刷固件方式来获得海外体验</strong>，那么谷歌安装器的路子呢（软件方式）？大部分文章或帖子都没给出明确答案，不过阅读了大量的帖子之后发现，软件方式同样有几个公认的模糊地带：</p><ul><li>极米Z4X能否安装谷歌框架？</li><li>能否正常使用谷歌商店？</li><li>能否安装并登陆YoutubeTV？<strong>能！</strong></li><li>能否不授权就登陆Netflix？<strong>能！</strong></li></ul><p>其他型号同理，理论上是一样的问题，但我无法测试。总之，先说结论：以上看YT看NF全部是可行的，至少我的Z4X全部可以做到！<strong>重点就是你安装软件的版本需要和你机器安卓版本相对应！</strong>，另外，在我们开始软件安装前，我强烈建议你将你的极米Z4X刷成精简系统（在原厂包基础上的精简），这样一是可以有更多空间和性能来供后期youtube和奈飞的使用，二是官方最新固件貌似会在安装谷歌框架时出现问题。（更多详细内容请移步cz5h.com）</p><h3 id="精简你的固件系统"><a href="#精简你的固件系统" class="headerlink" title="精简你的固件系统"></a><strong>精简你的固件系统</strong></h3><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/411312312313.jpg"></fancybox><p>这部分是通用的，因为这里面共享了大部分型号的固件，此精简固件删掉了全部（奇异果等等）第三方内置应用，只保留了基础的功能性APP，安装后会发现系统占用才300M，性能储备充足！（上图的定位是错的，没找到怎么改..）</p><p>原厂包+精简包，下载地址：<br>链接：<a href="https://pan.baidu.com/s/1wta4E5DVbfcB4UIKFhbgkQ" target="_blank" rel="external nofollow noopener noreferrer">https://pan.baidu.com/s/1wta4E5DVbfcB4UIKFhbgkQ</a><br>提取码：92ty</p><p>找到你的型号对应的文件，下载下来并解压，就是两个bin文件。</p><p><strong>下面开始刷机：</strong></p><ol start="0"><li>准备：U盘 2.0 fat32格式  16G或以下（纯净U盘），刷之前格式化下！</li><li>将原厂包的bin文件放入格式化完的U盘。</li><li>断开极米投影设备的所有网络，有线网络和无线网络（否则刷完还会有开机广告）！</li><li>把U盘插到投影USB2.0接口，在当前（还未刷）系统下进入设置-&gt;系统升级-&gt;U盘升级，来触发刷机；</li><li>耐心等待刷机完成，大概十分钟左右。（亲测不需要重配遥控器，但如果有必要请重新匹配遥控器）</li><li>拔掉U盘，删除此时U盘内的全部文件（格式化），再拷贝精简包的bin文件到U盘；</li><li>在当前（已刷成原厂固件）系统下进入设置-&gt;系统升级-&gt;U盘升级，来触发刷机；</li><li>这次的刷机完成后，精简系统就刷完了。</li><li>默认当贝影视桌面+自带当贝市场，对后续操作十分友好！</li></ol><p>OK！现在你已经得到了非常纯净的固件系统，此时你的投影仪应该会比之前要流畅的多，且使用过程非常舒服，自带当贝安装软件非常方便，下面我们就来装一些软件，来做下一步的准备工作。（下图是我装完谷歌套件和油管奈飞之后的文件占用情况，<strong>吓不吓人！</strong>不得不说安装4.x版本的软件是真的小啊！）</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201125202906.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="安装实用工具和谷歌框架"><a href="#安装实用工具和谷歌框架" class="headerlink" title="安装实用工具和谷歌框架"></a><strong>安装实用工具和谷歌框架</strong></h3><p>直接在当贝搜索：<strong>3S一键ROOT</strong>、<strong>RE文件管理器</strong>（注意不是ES！）。找到后安装即可。<br>首先用一键ROOT获取权限（必须），无所谓保修不保修，我用了三年了就没出过问题。<br>之后，是一个可选步骤，用RE挂载局域网的共享文件夹（SMB），这样做的目的是，我用电脑将apk下载到指定文件夹内之后，直接就能用RE管理器看到并点击安装！<br>当然，你也可以用当贝的“远程推送”功能，在浏览器页面上传文件。或者你不嫌麻烦用U盘拷贝。</p><p>以上步骤其实就是root了一下，下面就开始安装Google框架了</p><p>从此处开始，你需要到你的投影设置页面，去看你机器的安卓版本，并记住！如果你是安卓4.x，那么务必不要去下载最新版的谷歌安装器(最新版本号为4.0)，请下载3.0的谷歌安装器，（图暂时找不到了骚瑞）。安装方式是半手动的弹出一系列谷歌软件让你安装，<strong>此刻你的网络环境应该是十分科学的</strong>，不然你会卡着不动。</p><p><strong>谷歌安装器：</strong><a href="https://cn.apksum.com/download/com.goplaycn.googleinstall_4.7_free" target="_blank" rel="external nofollow noopener noreferrer">https://cn.apksum.com/download/com.goplaycn.googleinstall_4.7_free</a></p><p>整个过程走完，谷歌框架就完美安装上了，这时大概率你会发现，你的谷歌商店会显示“从服务器检索信息出错”，没关系，不影响！</p><h3 id="安装匹配的海外应用"><a href="#安装匹配的海外应用" class="headerlink" title="安装匹配的海外应用"></a><strong>安装匹配的海外应用</strong></h3><p>原则：安卓版本&lt;=极米系统的安装版本；推荐使用 <a href="http://www.apkmirror.com" target="_blank" rel="external nofollow noopener noreferrer">www.apkmirror.com</a> 来检索我们所需要的软件，该网站有全部版本的apk备份，并且提供详细的对应支持的安卓版本！（比如下面这个我安卓4.3是装不上的）</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201125042907.png"></fancybox><p>NOW，让我们找几个应用体验下：Netflix、YouTubeTV只要安卓版本不超出，都是可以正常安装的！<br>如果你是Z4X（安卓4.3），那么可以直接用一下链接：</p><p><strong>Netflix：</strong><br><a href="https://www.apkmirror.com/apk/netflix-inc/netflix/netflix-3-16-6-build-5382-release/netflix-3-16-6-build-5382-android-apk-download/download/" target="_blank" rel="external nofollow noopener noreferrer">https://www.apkmirror.com/apk/netflix-inc/netflix/netflix-3-16-6-build-5382-release/netflix-3-16-6-build-5382-android-apk-download/download/</a></p><p><strong>YouTubeTV：</strong><br><a href="https://drive.google.com/a/ka8.hk/uc?authuser=0&amp;id=1aIeXGKyEH9H1ita9Ifj5iW-EYz_tFJw0&amp;export=download" target="_blank" rel="external nofollow noopener noreferrer">https://drive.google.com/a/ka8.hk/uc?authuser=0&amp;id=1aIeXGKyEH9H1ita9Ifj5iW-EYz_tFJw0&amp;export=download</a></p><p>注：这原本是解决其他低版本安卓设备问题的 Smart youtubeTV，我尝试安装在Z4X上，发现运行非常稳定。其内置四个youtubeTV模式，我选用的是第四个（LITE Alt），LITE Main模式会非常卡顿。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/345345234523.jpg"></fancybox><p><strong>奈飞登陆无压力有木有！</strong></p><p>其他的任何软件，<strong>只要支持你设备的安卓版本</strong>，都可以顺利的安装成功！</p><p>全部安装完之后，你会发现，虽然我们的谷歌商店是不可用的状态，但登陆youtube账号时并没有出现问题，登陆之后就和原生安卓TV的youtube体验完全相同了！实测播放画质最高可到<strong>1920x1080@30</strong>，30fps会有一点点卡顿的感觉，影响不大。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201125200550.png"></fancybox><p>对于Netflix，同样需要注意，这里装的是安卓版，非TV应用（TV应用最低支持安卓5）。不过视频还是很清晰的，而且非常流畅（目测稳定720@30fps）。由于是安卓应用，所以遥控体验不太好，搭配个无线鼠标就非常惬意了！顺便一说，如果你不是全尺寸投屏，距离近一些的话画面会细腻的多！</p><p>整体上观看YT和NF时，投影的发热量是比较明显的，但是Z4X屁股里有个大风扇，散热效果非常不错，所以问题不大。（更多详细内容请移步cz5h.com）</p><ul><li><p>这里放一个虎牙TV版本，不是官方的云视听TV版！官方版本的直播在东八区零点到八点是没法看的，这个第三方虎牙版本还是很强的，可以登录虎牙账号，甚至可以发弹幕。（原名叫高清游戏直播TV版，进去之后会让你更新，更新完之后就是虎牙TV版了，是个非官方的第三方版本）<br>高清游戏直播TV版：<a href="https://down.qwp365.cn/tv/gaoqingyouxizhibotvban.apk" target="_blank" rel="external nofollow noopener noreferrer">https://down.qwp365.cn/tv/gaoqingyouxizhibotvban.apk</a></p></li><li><p>有丰富海外软件的应用市场：<a href="https://aptoidetv-qumi-q38.en.aptoide.com/app" target="_blank" rel="external nofollow noopener noreferrer">https://aptoidetv-qumi-q38.en.aptoide.com/app</a><br>装完这个就不用自己找应用下载了，里面应有尽有。</p></li></ul><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h3><p>至此，你原来那台充斥着捆绑应用和广告的极米投影，摇身一变，变成了拥有 youtubeTV + Netflix 的电视投影！要知道小米、亚马逊等推出的电视棒，功能也不过如此（当然更强悍，安卓版本都是7.0起步了），能看 youtubeTV 和 Netflix 的投影，完全可以当做电视了！所以，如果你也想“全面升级”你的极米投影，那就参考本文开干吧，和从前那个鸡肋的原厂固件系统说拜拜，全新的体验在等着你！Peace.</p><p>注1：以上所有出现的软件均可正常在极米Z4X上使用，如果你的机器是Android-4.3.x以上，同样可以使用。<br>注2：所有截图均通过<strong>极米助手</strong>完成。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 极米投影 </tag>
            
            <tag> 刷机 </tag>
            
            <tag> YouTube </tag>
            
            <tag> 谷歌框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>给你的Win平板安装ChromeOS系统</title>
      <link href="/article/b192.html"/>
      <url>/article/b192.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/Screenshot 2020-11-09 at 08.40.47 (1).png"></fancybox><p>你是否觉得你的Win10平板性能太弱、娱乐性没有（跑不动）、用触屏不爽（屏太小）、系统掉电超快、想丢掉却又不舍得？拯救你鸡肋平板的方法来了！给你的平板换装ChromeOS，你会拥有全新的平板体验，或许你会再次对你的平板爱不释手！</p><a id="more"></a><p>我的机器配置：</p><ul><li>CPU: Intel Core m3-6Y30</li><li>Mem: 4GB</li></ul><p>详细外貌及参数可在<a href="https://post.smzdm.com/p/548619/" target="_blank" rel="external nofollow noopener noreferrer">这里</a>找到。</p><h3 id="啰嗦几句"><a href="#啰嗦几句" class="headerlink" title="啰嗦几句"></a><strong>啰嗦几句</strong></h3><p>Win10平板，在过去有段时间像雨后春笋般在市场上出现，以酷比魔方为代表的平板厂商，号称已经可以达到苏菲婆的体验了，我用的这个已经算是高端寨本了，但对我来说还是“小”！Windows就不应该出现在这么小的屏幕上，另外由于性能原因，娱乐性也几乎没有，不过让我欣慰的是这个本子可以流畅玩红色警戒，有很长一段时间我都是外接24寸屏幕玩红警的，当然本子会超级烫。</p><p>总之，体验就是，你能在这个小本子上满足一切Win的“日常”需求，而且还可以触屏！但是，时间一久，触屏的新鲜感过了，我就迅速对其失去兴趣了，一个重要的原因就是搭载 Windows 耗电是真的快，充电线就跟电源线一样了，拔不得。综上，在我有了台式机之后（笔记本装Ubuntu了），这个本子就彻底被打入冷宫了。</p><p><strong>但是天不绝此本，ChromeOS来了！</strong></p><p>Chrome OS 在今天其实已经不新鲜了，甚至在我三年前买这个平板的时候就已经出现了，但是，ChromeOS 在这几年发展了非常多的东西，包括 ARC+ 等等技术在内，直到其开始兼容安卓应用开始，其才逐渐形成比较明显的、有优势的系统特性。我会在之后写一篇 ChromeOS 使用体验的文章，这里直接列几个优点：</p><ul><li>可以得到全系统目前最好的原生 Chrome 浏览器体验（一点也不开玩笑）！</li><li>可以兼容 80% 安卓应用，Appstore或许没有，但可以直接安装apk！</li><li>可以以极低的功耗运行，真的可以做“移动”平板了！</li><li>触屏更加接近安卓体验，比win10不知道好到哪里去了！</li><li>娱乐性剧增，办公性下降，这正是我想要的！</li><li>开机速度巨快！</li></ul><p><strong>如何知道自己的电脑能不能装呢？</strong></p><p>答案是基本就没有不能装的！只是你没找到对应的系统（代号），去<a href="https://zh.wikipedia.org/wiki/Chromebook" target="_blank" rel="external nofollow noopener noreferrer">维基的 Chromebook 页面</a>，去找你的型号对应的厂家型号的<strong>ChromeOS代号</strong>，比如我的：</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201112231645.png"></fancybox><p>如果不幸列表内没有你的CPU型号，那你就只能找个相近的型号了（CPU代数优先），如何辨认是几代CPU？举个例子，i5-7200u是七代CPU，i7-6700hq是六代CPU，而我的 m3-6Y30 同样是六代CPU。</p><p>得到你的对应安装的<strong>版本代号</strong>，接下来就开始安装了！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="开始安装ChromeOS！"><a href="#开始安装ChromeOS！" class="headerlink" title="开始安装ChromeOS！"></a><strong>开始安装ChromeOS！</strong></h3><h4 id="一、安装启动系统"><a href="#一、安装启动系统" class="headerlink" title="一、安装启动系统"></a><strong>一、安装启动系统</strong></h4><p>目前，市面上的全部 Chromebook 都是出厂即带系统，也就是说，ChromeOS 和 OSX 一样，没有第三方正版系统，当然 ChromeOS 实际体验中根本没有正版认证的附加功能等等，也没有提示让你注册的东西。也就是说，Google 没有提供BIOS安装套件，但这并不影响骚操作安装方法，即：通过另一个系统来安装！</p><p><strong>1. 制作U盘启动</strong></p><p>这里我用我现成的 UbuntuMate 的安装盘，（如果你没有，请用UtraISO写盘工具製作U盘啓动盘，默认是GPT分区）</p><p><strong>2. 将ChromeOS相关文件同样放进启动盘</strong></p><p>这一步当然可以在进入Ubuntu系统后再去下载，但是我们直接放进启动盘内就无需再在安装时联网下载了。</p><p>在启动盘内新建 Chrome OS（注意大小写空格）文件夹，然后放入以下两个文件<strong>（解压之后）</strong>。</p><ul><li><a href="https://github.com/sebanc/brunch/releases" target="_blank" rel="external nofollow noopener noreferrer">Chrome 安装框架</a></li><li><a href="https://cros-updates-serving.appspot.com/" target="_blank" rel="external nofollow noopener noreferrer">Chrome OS 恢复镜像</a>，按你的版本代号，下载最新版本（Recovery那列的最大的数字）</li></ul><p><strong>3. 平板插入U盘，装机</strong></p><p>BIOS修改启动项等等不再赘述，关键：到Ubuntu的Grub界面，直接点击<strong>不安装进入系统</strong>，我们不需要安装UbuntuMate，我们只进去借助其环境运行我们的脚本。</p><p>进去之后，在Home文件夹内找到 cdrom-&gt;ChromeOS，在此文件夹下新建个 install.sh 将以下代码放进去，淡然你也可以一条条执行，都一样。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install figlet</span><br><span class="line">sudo apt-get install pv</span><br><span class="line">sudo apt-get install cgpt</span><br><span class="line">sudo bash chromeos-install.sh -src cave_recovery.bin -dst /dev/sda</span><br><span class="line">注意：你的recovery.bin要对应你下载的bin文件名称，可能很长，无所谓的。</span><br></pre></td></tr></table></figure><p>即：</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/57352354353.png"></fancybox><p>之后回车，开始安装，中间会卡住询问你是否继续，键入 yes 继续，出现以下信息之后，即安装完成，之后便可以点击重启，然后拔掉U盘。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/534243525345345345.png"></fancybox><p><strong>4. 安装结束</strong></p><p>再次开机后，即可进入 ChromeOS 配置引导界面。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20201112235318.png"></fancybox><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h3><p>如果你可以找到对应你机器CPU型号的 Chromebook 机器，那么恭喜你，百分百可以顺利安装成功，如果没有，那么也不要怕，如果你懂一点Linux知识就会发现这个安装过程是真的非常简单，这个 xxx_recovery.bin 不行那就换另一个试试，总会找到的！</p><p>到今天为止，ChromeOS我也用了四五天了，头两天一度想要换掉这个系统，因为发现Play商店里的适配应用少的可怜，但后面发现 ChromeOS 早就可以直接安装第三方apk了！（有几率安装不成功那就是真的不适配），像QQ和微信在Play商店里是没有的，但经我测试全系列版本的移动端QQ均可以正常在ChromeOS上使用！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/4n8795v3847584.png"></fancybox><p>下篇文章我就来写一下关于 ChromeOS 的绝佳使用体验！</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ChromeOS </tag>
            
            <tag> 安装 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重写Hexo豆瓣影评插件及npm发布</title>
      <link href="/article/5613.html"/>
      <url>/article/5613.html</url>
      
        <content type="html"><![CDATA[<p>不知道从什么时候开始，习惯于在豆瓣找电影看，到了后来，就偶尔写个电影观后感，随着看电影看的越来越多，可比较的东西就越来愈多，所以现在看完一部新电影，写写自己的感想就成了固定环节了，作为一种“动态”，能够搬到博客上与他人共享那是再好不过的了，找了一圈Hexo的插件，发现都不怎么好用，那么索性就魔改个自己用的版本！</p><a id="more"></a><p>基于HEXO豆瓣插件 <a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="external nofollow noopener noreferrer">hexo-douban</a> 的二次开发插，强烈建议先试用原插件，如果您觉得以下特性更能满足您的需要，那么再使用本插件。</p><p><strong>原插件 hexo-douban 的不足：</strong></p><ul><li>书影音、大部分人就想放影评</li><li>样式不好看，字体大小的一致性即颜色</li><li>渲染全部观影记录，几百部电影会导致有几十页翻页，臃肿</li><li>单纯的构造豆瓣原页面，在“已看”列表中，只会出现短评内容，长影评是另外的部分</li><li>构造的页面目录较深，和博客其他部分关联度不够</li><li>主题兼容性问题，valine部分的缺失</li><li>移动端界面不适配/合适</li></ul><p><strong>对应的应对措施：</strong></p><ul><li>砍掉多余部分</li><li>适当的美化了CSS</li><li>设置拉取列表的长度控制</li><li>魔改原有xpath解析逻辑，拉取长影评页面内容，补全到“已看”列表</li><li>改动原模板中样式的位置，以便于无差别的插入到其他同原页面，提升关联度</li><li>插入资源文件和valine构建代码</li><li>简单的重写了移动端样式</li></ul><p><strong>本插件的主要特性：</strong></p><ul><li><a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="external nofollow noopener noreferrer">原项目</a>固有特性；</li><li>重构模板页面，支持移动适配；</li><li>补全列表影评内容，支持短评和长影评（核心）；</li><li>支持生成指定长度的列表（对于观影数量较多的用户）；</li><li>样式inline化，允许直接嵌入同源其他页面；<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dbcontent"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$(<span class="string">'#dbcontent'</span>).load(<span class="string">'./movies/index.html .hexo-douban-item:nth-child(1)'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>注意：本插件构建的页面完全不保证兼容IE等上古浏览器，推广使用现代浏览器，人人有责。</strong></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="第一步：安装"><a href="#第一步：安装" class="headerlink" title="第一步：安装"></a>第一步：安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果您使用过原插件请先卸载之</span></span><br><span class="line">$ npm uninstall --save hexo-douban</span><br><span class="line">$ npm install --save hexo-douban-list</span><br></pre></td></tr></table></figure><h3 id="第二步：配置"><a href="#第二步：配置" class="headerlink" title="第二步：配置"></a>第二步：配置</h3><p>将下面的配置写入站点的配置文件 <code>_config.yml</code> 里(不是主题的配置文件).</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">douban:</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">ID（数字或字幕|无需引号）</span></span><br><span class="line">  <span class="attr">builtin:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">movie:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">'生成页面的标题'</span></span><br><span class="line">    <span class="attr">quote:</span> <span class="string">'生成页面的内容的导语'</span></span><br><span class="line">    <span class="attr">length:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">valine_id:</span> <span class="string">WbLE88qfAcz4hSI5</span></span><br><span class="line">    <span class="attr">valine_key:</span> <span class="string">ycqjmtEfUxuxD</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure><p><strong>注意：以上内容中务必确定 USER ID 的正确性！</strong></p><ul><li><strong>user</strong>: 你的豆瓣ID.打开豆瓣，登入账户，然后在右上角点击 “个人主页” ，这时候地址栏的URL大概是这样：”<a href="https://www.douban.com/people/xxxxxx/&quot;" target="_blank" rel="external nofollow noopener noreferrer">https://www.douban.com/people/xxxxxx/&quot;</a> ，其中的”xxxxxx”就是你的个人ID了。</li><li><strong>builtin</strong>: 是否将生成页面的功能嵌入<code>hexo s</code>和<code>hexo g</code>中，默认嵌入（TRUE）即npm安装后无需任何操作按原命令部署博客即可生效。</li><li><strong>title</strong>: 该页面的标题。</li><li><strong>quote</strong>: 写在页面开头的一段话,支持html语法。</li><li><strong>length</strong>: 默认值为2，非页数，可以自由尝试（建议取值:2-4）。</li><li><strong>timeout</strong>: 爬取数据的超时时间，默认是 10000ms ,如果在使用时发现报了超时的错(ETIMEOUT)可以把这个数据设置的大一点。</li></ul><p>对于 <code>valine_id</code> 和 <code>valine_key</code>，主要针对的是<strong>Volantis</strong>主题（以及其他默认渲染评论区域的主题），如果您在测试时页面没有评论区域，则可以忽略这两项，如果出现以下显示则需要填写此两项。（这两项是什么？请移步<a href="https://valine.js.org/quickstart.html#%E8%8E%B7%E5%8F%96APP-ID-%E5%92%8C-APP-Key" target="_blank" rel="external nofollow noopener noreferrer">Valine官方介绍</a>）</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200922010453.png" alt></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><strong>注意</strong>，通常大家都喜欢用<code>hexo d</code>来作为<code>hexo deploy</code>命令的简化，但是当安装了<code>hexo douban</code>之后，就不能用<code>hexo d</code>了，因为<code>hexo douban</code>跟<code>hexo deploy</code>的前缀都是<code>hexo d</code>。</p><h4 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h4><p>使用 <code>npm install hexo-douban-list --update --save</code> 直接更新。</p><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>执行 <code>hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server</code>，之后访问 <code>localhost:4000/movies</code> 即可访问生成的影评页面。</p><h3 id="删除（可补回来）的内容"><a href="#删除（可补回来）的内容" class="headerlink" title="删除（可补回来）的内容"></a>删除（可补回来）的内容</h3><p>相比较于原项目，取消或删除了以下内容：</p><ul><li>去掉了书籍和音乐，单纯针对电影</li><li>去掉了影评页跳转的菜单按钮</li><li>去掉了以上项目涉及的配置开关</li></ul><h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><p>如果构建页面为空或404，且日志输出为 <code>INFO  0 movies have been loaded in xx ms</code>，这时怀疑您的IP由于多次请求豆瓣的页面而被豆瓣封禁了，一般第二天会解禁，使用代理或更改IP即可解决。</p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node </tag>
            
            <tag> hexo-douban-list </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>滥用jsdelivr之存储视频/m3u8</title>
      <link href="/article/9cb3.html"/>
      <url>/article/9cb3.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912195745.png"></fancybox><p>对于博客来说，媒体资源的存取方式至关重要，借助Jsdelivr加速Github上存储的图片已经是公认的方案，但对于视频来说，面对动辄几百兆的视频资源，你几乎无法找到一个免费的“视频床”，在第三方直接防盗链能力日渐完善的当下，急切需要一种折中方案。本文就借鉴前辈的尝试，将视频存放在Github之上并利用Jsdelivr实现加速，并利用DPlayer将其插入到自己的博客中。</p><a id="more"></a><h3 id="核心问题"><a href="#核心问题" class="headerlink" title="核心问题"></a><strong>核心问题</strong></h3><ul><li>Github上传限制20M（网页）</li><li>Jsdelivr对加速资源的限制20M</li><li>Jsdelivr对MP4等视频格式的解码并不让人满意</li></ul><h3 id="Github网页上传限制"><a href="#Github网页上传限制" class="headerlink" title="Github网页上传限制"></a>Github网页上传限制</h3><p>老生常谈，网页不行就用Git工具，强烈推荐使用 Git Bash，<a href="https://git-scm.com/download" target="_blank" rel="external nofollow noopener noreferrer">Git下载地址</a>。</p><p>这里推荐重新新建一个仓库来存储视频，如果被认定滥用而封禁，也只会影响这一个仓库，所以还是新建一个仓库。</p><p>然后，在本地 git clone xxxx.git，下载到本地。</p><p>在将视频资源放进文件夹内，</p><p>在文件夹内新建 push.bat 写入如下代码，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add -A</span><br><span class="line">git commit -m<span class="string">"%date:~0,4%%date:~5,2%%date:~8,2%%time:~0,2%%time:~3,2%%time:~6,2%"</span></span><br><span class="line">git push -u origin master -f</span><br></pre></td></tr></table></figure><p>双击bat即可强制推送本地全部内容到Github仓库。使用Git方式上传，可以摆脱20M上传大小的限制，不过即便上传成功，Jsdelivr仍然对加速的资源有所限制，要解决这个问题，就需要进入到本文的核心了，即视频分片。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912194643.png"></fancybox><p>如果你觉得小于20M的mp4视频就可以被加速，那你就错了（涉及第三个问题），Jsdelivr对MP4的处理好像并不好，如<a href="https://github.com/TianZonglin/Ubuntu-Installog/blob/master/dd.mp4" target="_blank" rel="external nofollow noopener noreferrer">上图的视频</a>（视频正常）大小满足存储和加速条件，但通过jsdelivr链接访问后，居然只剩下音轨了。。（如果你在移动端打开，又可以解析到视频，奇怪！）</p><p><a href="https://cdn.jsdelivr.net/gh/TianZonglin/Ubuntu-Installog/dd.mp4" target="_blank" rel="external nofollow noopener noreferrer">https://cdn.jsdelivr.net/gh/TianZonglin/Ubuntu-Installog/dd.mp4</a></p><h3 id="视频切片"><a href="#视频切片" class="headerlink" title="视频切片"></a><strong>视频切片</strong></h3><p>首先，这不是简单的视频切分，这涉及到HLS技术，解释如下：</p><blockquote><p>HLS 的工作原理是把整个流分成一个个小的基于 HTTP 的文件来下载，每次只下载一些。当媒体流正在播放时，客户端可以选择从许多不同的备用源中以不同的速率下载同样的资源，允许流媒体会话适应不同的数据速率。在开始一个流媒体会话时，客户端会下载一个包含元数据的 extended M3U (m3u8) playlist文件，用于寻找可用的媒体流。HLS 只请求基本的 HTTP 报文，与实时传输协议（RTP）不同，HLS 可以穿过任何允许 HTTP 数据通过的防火墙或者代理服务器。它也很容易使用内容分发网络来传输媒体流。</p></blockquote><p>在我们的场景中，可以理解为视频的 url 就是 playlist 的链接地址，而 playlist 可以看做是视频分片的索引，如此大的视频被拆分，即绕过存储的单位件大小限制，同时也符合Jsdelivr对资源的要求，这样存储的视频，就可以“变相”的将Github做为视频床了。</p><p>如何实现？</p><h4 id="获取ffmpeg工具"><a href="#获取ffmpeg工具" class="headerlink" title="获取ffmpeg工具"></a><strong>获取ffmpeg工具</strong></h4><p>这里我用“获取”而不是“安装”，因为对于Windows来说，其已经被构建成可用的exe了，主要是几个exe，这里我们只使用 ffmpeg.exe，下载地址在<a href="https://ffmpeg.zeranoe.com/builds/" target="_blank" rel="external nofollow noopener noreferrer">这里</a>，下载Build压缩包之后，直接在压缩软件中查看bin目录下的内容，会发现有三个exe文件，只需要拖出 ffmpeg.exe 即可。</p><h4 id="文件放置和测试"><a href="#文件放置和测试" class="headerlink" title="文件放置和测试"></a><strong>文件放置和测试</strong></h4><p>在第一节中克隆的空白项目中，（以下文件名皆可自定义）新建个文件夹 MV-Queen，将原视频放进去，将 ffmpeg.exe 放进去，准备工作完成。</p><p>在此目录下，右键选择 Git_Bash_here（没有？请花亿分钟百度下然后重装下Git），然后将 ffmpeg.exe 直接拖入黑框中，回车，会显示ffmpeg的信息，如果你觉着这样麻烦也可以配置环境变量，这里不再赘述。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912194958.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="执行切片"><a href="#执行切片" class="headerlink" title="执行切片"></a><strong>执行切片</strong></h4><p>第一步：mp4转成ts格式，一对一转换，转换后大小没什么变化。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -y -i 你的名字.mp4 -vcodec copy -acodec copy -vbsf h264_mp4toannexb 你的名字.ts</span><br></pre></td></tr></table></figure><p>第二步，按间隔分片，1对N，下面的5即“每个分片5秒”，可以自己切换。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i 你的名字.ts -c copy -map 0 -f segment -segment_list playlist.m3u8 -segment_time 5 你的名字%03d.ts</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>这里如果直接输入ffmpeg是不能用的，我们首先拖动 ffmpeg.exe 到黑框中，这时会在 gitbash 中出现个路径，然后把上面的命令（ffmpeg后面的）复制到路径之后即可运行。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912183411.png"></fancybox><p>关于MP4的参数，务必满足视频编码为H264，音视频编码为AAC（YouTube下载的视频默认即此格式），如果不是请用格式工厂进行转换，具体详见<a href="http://www.moetuan.cn/index.php/554.html#jsDelivr%E4%B8%8EGitHub%E9%83%BD%E6%98%8E%E7%99%BD%EF%BC%8C%E9%82%A3%E6%A0%87%E9%A2%98%E9%87%8C%E7%9A%84FFmpeg%E5%8F%88%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" target="_blank" rel="external nofollow noopener noreferrer">王同学的文章</a>。</p><p><strong>最后一步：</strong></p><p>删掉或移除原视频和转换后的ts视频（两个最大的视频文件）以及 ffmpeg.exe，都移除去，剩下的就只有playlist和一大堆分片，之后点击之前的 push.bat 即可完成上传。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912184040.png"></fancybox><h4 id="使用DPlayer解析"><a href="#使用DPlayer解析" class="headerlink" title="使用DPlayer解析"></a><strong>使用DPlayer解析</strong></h4><p>再次明确，这不是单纯的视频切分，如果你不信，可以尝试访问单独的视频分片（应该是乱码）：</p><p><a href="https://cdn.jsdelivr.net/gh/TianZonglin/bibabo/MV-5min-100m-Queen/abc001.ts" target="_blank" rel="external nofollow noopener noreferrer">https://cdn.jsdelivr.net/gh/TianZonglin/bibabo/MV-5min-100m-Queen/abc001.ts</a></p><p>当然，直接试图访问m3u8链接也是不行的，这里需要 hls.js 。</p><p><a href="https://cdn.jsdelivr.net/gh/TianZonglin/bibabo/MV-5min-100m-Queen/playlist.m3u8" target="_blank" rel="external nofollow noopener noreferrer">https://cdn.jsdelivr.net/gh/TianZonglin/bibabo/MV-5min-100m-Queen/playlist.m3u8</a></p><blockquote><p>hls.js 是一款基于 Media Source Extensions 开发的，用于实现 HTTP Live Streaming 开源JavaScript类库。它可以实现将MPEG-2 和 AAC/MP3码流变成自制的 MP4的分片。并且可以直接绑定在Video 上，实现播放。</p></blockquote><p>在这里，我们使用DPlayer，只需要在引入 DPlayer.js 之前，引入 hls.js 即可，即：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.jsdelivr.net/gh/你的路径或CDN/DP.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"dplayer"</span> <span class="attr">class</span>=<span class="string">"dplayer-video dplayer dplayer-no-danmaku dplayer-paused"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/gh/你的路径或CDN/jquery-3.5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/gh/你的路径或CDN/hls.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/gh/你的路径或CDN/DP.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>别忘了构造代码（注意这里的type选择hls）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">const</span> dp = <span class="keyword">new</span> DPlayer(&#123;</span><br><span class="line">      container: <span class="built_in">document</span>.getElementById(<span class="string">'dplayer'</span>),</span><br><span class="line">      autoplay:!<span class="number">0</span>,<span class="attr">theme</span>:<span class="string">"#42b983"</span>,<span class="attr">loop</span>:<span class="literal">true</span>,<span class="attr">lang</span>:<span class="string">"zh-cn"</span>,<span class="attr">preload</span>:<span class="string">"auto"</span>,<span class="attr">volume</span>:<span class="built_in">Number</span>(<span class="string">"0"</span>),</span><br><span class="line">      video: &#123;</span><br><span class="line">          url: <span class="string">'https://cdn.jsdelivr.net/gh/你的m3u8链接/playlist.m3u8'</span>,</span><br><span class="line">          type: <span class="string">'hls'</span>,</span><br><span class="line">          defaultQuality: <span class="number">0</span>,</span><br><span class="line">          pic: <span class="string">'https://cdn.jsdelivr.net/gh/你的视频的初始未播放的画面（封面）.webp'</span>,</span><br><span class="line">          thumbnails: <span class="string">'thumbnails.jpg'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>针对自动播放问题，Chrome已经是禁止声音的自动播放了，也就是说，除非你静音，否则通常形式的video标签都无法在chrome中自动播放内容（iframe等除外），这里我的解决方式是，<strong>静音播放 + 按钮提醒</strong>，在视频下面加一行提示字符，然后利用dp的API做一下简单的控制（我把默认控制栏全部删掉了）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;span id=<span class="string">"btnV"</span> style=<span class="string">"color:#676767;font-size:16px;cursor:pointer;"</span>&gt;↑ 画面不动？没声音？点这里！&lt;<span class="regexp">/span&gt; </span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  $("#btnV").click(function()&#123;</span></span><br><span class="line"><span class="regexp">     if($("#btnV").html()=="↑ 画面不动？没声音？点这里！"||$("#btnV").html()=="↑ 没声音？点这里！")&#123;</span></span><br><span class="line"><span class="regexp">      dp.play();</span></span><br><span class="line"><span class="regexp">      dp.volume(0.4);</span></span><br><span class="line"><span class="regexp">      $("#btnV").html("↑ 太吵了，关掉！");</span></span><br><span class="line"><span class="regexp">     &#125;else&#123;</span></span><br><span class="line"><span class="regexp">      dp.volume(0);</span></span><br><span class="line"><span class="regexp">      $("#btnV").html("↑ 没声音？点这里！");</span></span><br><span class="line"><span class="regexp">     &#125;</span></span><br><span class="line"><span class="regexp">  &#125;) </span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><h4 id="修改Dplayer样式"><a href="#修改Dplayer样式" class="headerlink" title="修改Dplayer样式"></a><strong>修改Dplayer样式</strong></h4><p>为了极简化播放器，我将DPlayer的全部操作区间都给删掉了（display:none），这样就让视频区显得更加的纯粹，不告诉你你都不知道是视频，样式可以直接拷贝，代码如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.dplayer-controller</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dplayer-controller-mask</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dplayer-bezel</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.dplayer-notice</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="最终效果（jsd加速）"><a href="#最终效果（jsd加速）" class="headerlink" title="最终效果（jsd加速）"></a><strong>最终效果（<a href="https://github.com/TianZonglin/bibabo/tree/master/MV-5min-100m-Queen" target="_blank" rel="external nofollow noopener noreferrer">jsd加速</a>）</strong></h4><p>视频画面右键统计信息-&gt;查看数据源！</p>  <style>    .l_mainxx {      padding: 8px !important;    }    .dplayer-video-wrap {      position: relative;      background: #000;      font-size: 0;      width: 100%;      height: 100%;    }    .dplayer * {        box-sizing: content-box;        border-radius: 5px;    }    .dplayer {        position: relative;        overflow: hidden;        -webkit-user-select: none;        -moz-user-select: none;        -ms-user-select: none;        user-select: none;        line-height: 1;    }    .dplayer-controller{      display: none !important;    }    .dplayer-controller-mask{      display: none !important;    }    .dplayer-bezel{      display: none !important;    }    .dplayer-notice{      display: none !important;    }  </style>  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/file/DP.css">  <div id="dplayer2" class="dplayer-video dplayer dplayer-no-danmaku dplayer-paused"></div><br>  <center><span id="btnV2" style="color:#676767;font-size:16px;cursor:pointer;">↑ 画面不动？没声音？点这里！</span> </center>  <script src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/file/jquery-3.5.min.js"></script>  <script src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/file/hls.min.js"></script>  <script src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/file/DP.js"></script>  <script>    $(function(){       const dp = new DPlayer({        container: document.getElementById('dplayer2'),        autoplay:!0,theme:"#42b983",loop:true,lang:"zh-cn",preload:"auto",volume:Number("0"),        video: {            url: 'https://cdn.jsdelivr.net/gh/TianZonglin/bibabo/MV-5min-100m-Queen/playlist.m3u8',            type: 'hls',            defaultQuality: 0,            pic: 'https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200912010715.webp',            thumbnails: 'thumbnails.jpg',        },    });    $("#btnV2").click(function(){       if($("#btnV2").html()=="↑ 没声音？点这里！"){        dp.play();        dp.volume(0.4);        $("#btnV2").html("↑ 太吵了，关掉！");       }else{        dp.volume(0);        $("#btnV2").html("↑ 没声音？点这里！");       }    })   })  </script>  ]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> Hexo </tag>
            
            <tag> DPlayer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在群晖中优雅的使用百度网盘——baiduNetdisk+TinyManager</title>
      <link href="/article/e7a6.html"/>
      <url>/article/e7a6.html</url>
      
        <content type="html"><![CDATA[<p>2020年8月，继PanDownload被搞死（我没在群晖上用过）之后，BaiduPCS-go/web也全面歇菜，最早期的版本作者也已放弃github维护，目前能在群晖Docker镜像中搜索到的镜像，搭建后几乎全部失效无法下载，于此状况下，难道在群晖上对于百度网盘真没有好的下载工具（非BT下载）了吗？不然！</p><a id="more"></a><h3 id="群晖-baiduNetdisk"><a href="#群晖-baiduNetdisk" class="headerlink" title="群晖-baiduNetdisk"></a><strong>群晖-baiduNetdisk</strong></h3><p>在2019年底悄悄有人开发了一款“神器”，于近期才不断完善，现在也才一百度star，基本原理就是用docker起一个Linux（推测）虚拟机，里面放个百度网盘客户端，然后配好VNC，最终通过Web访问VNC桌面，进而操作百度网盘客户端。搭配使用的 Synology-baiduNetdisk.spk 只是一个连接器，核心还是Docker的环境。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829121045.png"><br></fancybox></p><p>最终的界面效果如下：</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829010856.png"><br></fancybox></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a><strong>安装</strong></h3><p>所以，本质上该工具有两部分，一个是核心的Docker镜像，一个是spk链接器。关于Docker镜像直接在Docker中搜索 baiduNetdisk 即可找到安装（1G大小），而链接应用可以直接从Github上获取，<a href="https://github.com/john-shine/synology-baiduNetdisk-package/releases" target="_blank" rel="external nofollow noopener noreferrer">点击下载最新的spk文件</a>，手动安装群晖应用（不会？请百度吧）。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829010719.png"><br></fancybox></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a><strong>配置</strong></h3><p>只有Docker端需要配置，而且是很重要的配置，主要有以下几部分：</p><h4 id="配置下载根目录"><a href="#配置下载根目录" class="headerlink" title="配置下载根目录"></a><strong>配置下载根目录</strong></h4><p>这部分是百度网盘可操作的最上层目录，默认是在<strong>存储Docker的空间上</strong>新建一个<code>BDDOWNLOAD</code>目录，如果你的群晖有多个空间，且你不想将下载内容放在系统空间/Docker空间里，那就需要修改docker配置（设置-卷）。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829010443.png"><br></fancybox></p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829010609.png"><br></fancybox></p><p>同理，在端口设置中，默认使用的群晖主机端口是6900，如果要改也可以改。改完之后Docker就可以正常启动了，然后这时访问<code>群晖IP/域名:6900</code>即可进入VNC页面，打开网盘设置窗口，可以看到在下载位置选项中，已经直接将根目录映射到了之前设置的目录。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829011802.png"><br></fancybox></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="配置VNC登录密码"><a href="#配置VNC登录密码" class="headerlink" title="配置VNC登录密码"></a><strong>配置VNC登录密码</strong></h4><p>如果你正常完成上述步骤，那么你会发现你访问正确链接后直接就进入桌面了，没有访问拦截，没有登录验证，非常不安全，作者也想到了这个问题，可以通过手动方式设置一个登陆密码，缺点是非常简单，不是单点登录，即每次刷新或者多开页面都需要输入密码。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829013431.png"><br></fancybox></p><p>设置方法，在先前设置的下载根目录内新建<code>.vnc</code>文件夹，在里面创建一个<code>passwd.txt</code>文件（可在本地创建好后上传到该目录），里面写你的登录密码明文，完成后重启Docker即可出现访问控制。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829013753.png"><br></fancybox></p><h4 id="其他非必要配置"><a href="#其他非必要配置" class="headerlink" title="其他非必要配置"></a><strong>其他非必要配置</strong></h4><p>为了不过多的占用群晖主体性能和更好地发挥该docker镜像的性能，这里对docker再修改几处配置，包括<code>CPU优先顺序</code>和<code>内存限制</code>（4G足矣再多就不正常了），再勾选上自动重启，以便异常挂掉后可以自动恢复。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829015257.png"><br></fancybox></p><h4 id="资源占用和性能"><a href="#资源占用和性能" class="headerlink" title="资源占用和性能"></a><strong>资源占用和性能</strong></h4><p>总体上占用资源不低，尤其是内存，如果你的群晖内存不是很大，那就更得主动限制一下其使用内存的大小。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829013551.png"><br></fancybox></p><p>对于性能（下载速度），我还是比较满意的，虽然不能跑满带宽，但和桌面的网盘客户端相比也差不多了，峰值速度可观，但其实不会一直维持峰值，九成时间稳定在5-6m/s，也算很不错的表现了。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829020929.png"><br></fancybox></p><p>不足的一点是，由于本质上是一个VNC桌面，所以对屏幕基本没有适配，在移动端上使用比较头大，主要是按钮太小，容易误触。</p><p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829014953.png"><br></fancybox></p><h3 id="Tiny-File-Manager"><a href="#Tiny-File-Manager" class="headerlink" title="Tiny File Manager"></a><strong>Tiny File Manager</strong></h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a><strong>安装</strong></h4><p>详见文章<a href="https://www.cxmoe.com/article/b940.html">《极简版（群晖）网盘文件管理工具——TinyManager》</a></p><h4 id="和本文的工具搭配使用"><a href="#和本文的工具搭配使用" class="headerlink" title="和本文的工具搭配使用"></a><strong>和本文的工具搭配使用</strong></h4><p>在 Tiny File Manager 使用的过程中需要设置一个根目录文件夹，即管理该目录下的所有文件，这里的管理目录，同样可以是百度网盘的下载目录，如此，我们可以将百度网盘的资源直接下载到 TinyManager 的管理目录内，从而下载完成后随即在 Manager 可见。</p><p>这样的好处有三个：</p><ul><li><ol><li><strong>Tiny Manager 足够轻量。</strong>该文件管理工具基于PHP，整体就一个两千行的PHP文件实现，足够的轻量不吃任何资源，同样可完成视频解析等功能。</li></ol></li><li><ol start="2"><li><strong>方便转存再下载。</strong>在帮别人（没速度或网速慢）下载百度网盘资源时，可以利用自己的网盘客户端和大带宽将资源转下到群晖内，然后再通过 Manager 直接分享直链供他人下载即可。</li></ol></li><li><ol start="3"><li><strong>直接解析视频音频。</strong>如果下的是百度网盘的视频资源，下载完成后即可在 Manager 目录内看到，点击预览即可播放，速度喜人，非常方便。</li></ol></li></ul><br><blockquote><p>访问 <a href="https://www.cxmoe.com">cz5h.com</a> 获取更多精彩内容。</p></blockquote><br><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h3><p>总体上，这就是相当于在docker运行了一个百度网盘客户端（推测是基于Linux的），所以，没有封号的风险，也不会存在各种交互问题，是具有原生百度网盘体验感的方式，在众多第三方工具都失效的当下，或许这种方式反而不失为一种好方案。</p><h3 id="附件"><a href="#附件" class="headerlink" title="附件"></a><strong>附件</strong></h3><p>由于很多人说目前群晖内下载的镜像和我文中的不太一样，推测可能是更新过了？所以各种问题，为了解决之，我把我使用的镜像（可用版）导出了，各位可以下载之后，通过docker导入（应该是这样做）。</p><p>下载链接：<a href="https://pan.baidu.com/s/1a-Izt5jmTAFWBsAXLceeXA" target="_blank" rel="external nofollow noopener noreferrer">https://pan.baidu.com/s/1a-Izt5jmTAFWBsAXLceeXA</a><br>提取码：5hq0 </p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 群晖 </tag>
            
            <tag> 百度网盘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>极简WEB文件管理工具（群晖）——TinyManager</title>
      <link href="/article/b940.html"/>
      <url>/article/b940.html</url>
      
        <content type="html"><![CDATA[<p>在之前<a href="https://www.cxmoe.com/article/f2f2.html">《导出七牛云资源到本地》</a>的文章中，我已经将文件全部转存到了群晖中，搭配Nginx已经可以实现直链访问。前几天又把自己电脑上存在的有用的软件包全部上传到了群晖，至此我的软件包文件夹已经有三四百个文件/安装包，除了直链访问，我迫切的需要一款简洁轻量的Web文件管理工具来方便管理这些文件，最终借助 <strong>Tiny FileManager</strong>，简洁高效的实现了我的需求。</p><a id="more"></a><h3 id="安装TinyManager"><a href="#安装TinyManager" class="headerlink" title="安装TinyManager"></a><strong>安装TinyManager</strong></h3><p>该项目已在Github开源，<a href="https://tinyfilemanager.github.io/" target="_blank" rel="external nofollow noopener noreferrer">主页地址</a>。安装非常的简单，直接<a href>下载最新版Zip包</a>，完成后解压，将整体目录改个名字比如“pan”，然后放入需要管理的文件的上一级，然后使用 WebStation 在该目录起一个Nginx容器+php环境，做完之后即可通过路径访问了。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829141132.png"></fancybox><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829141550.png"></fancybox><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a><strong>配置</strong></h3><p>经过上述安装，不需要配置即可通过 <code>domain:6543/pan/index.php</code> 访问（index可不写，6543需要路由器配置映射）登陆页面。初始的登陆密码是 <code>admin/admin@123</code> 和 <code>user/12345</code> 对应两个级别的用户。</p><h4 id="1-配置密码"><a href="#1-配置密码" class="headerlink" title="1. 配置密码"></a><strong>1. 配置密码</strong></h4><p>直接在群晖打开 <code>index.php</code> 进行编辑（config.php 中的也要对应修改），在27行，找到以下代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$auth_users = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'admin'</span> =&gt; <span class="string">'$c9a9qa2v9W18YaYkqI5cEG/ufAviA912PDly1JWwLPgh6324231hqFG'</span>, <span class="comment">//admin@123</span></span><br><span class="line">    <span class="string">'user'</span> =&gt; <span class="string">'$2dasidqwioev9W18YaYkqI5cEG/uf14y1JWwLPgh6pMzzJ42412hqFG'</span> <span class="comment">//12345</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>去到<a href="https://tinyfilemanager.github.io/docs/pwd.html" target="_blank" rel="external nofollow noopener noreferrer">该页面</a>，生成你想设置密码的加密字符串，然后回来将其替换到对应位置（箭头右边部分）即可完成密码修改。</p><h4 id="2-修改语言"><a href="#2-修改语言" class="headerlink" title="2. 修改语言"></a><strong>2. 修改语言</strong></h4><p>登陆文件管理Web页面，一定要用admin登陆，右上角下拉点击设置进入该页面选择语言，以及其他设置。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829142833.png"></fancybox><h4 id="3-配置管理根目录"><a href="#3-配置管理根目录" class="headerlink" title="3. 配置管理根目录"></a><strong>3. 配置管理根目录</strong></h4><p>在 <code>config.php</code> 中找到以下代码，<code>/tools</code> 即表示 Manager 初始进入的目录只有 tools，剩下的其他目录不可见。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Line 53</span></span><br><span class="line"><span class="comment">// use absolute path of directory i.e: '/var/www/folder' or $_SERVER['DOCUMENT_ROOT'].'/folder'</span></span><br><span class="line">$root_path = $_SERVER[<span class="string">'DOCUMENT_ROOT'</span>].<span class="string">'/tools'</span>;</span><br></pre></td></tr></table></figure><h4 id="4-修改文件夹权限"><a href="#4-修改文件夹权限" class="headerlink" title="4. 修改文件夹权限"></a><strong>4. 修改文件夹权限</strong></h4><p>此步骤很有必要，如果不改，默认的管理操作会无效，因为php文件没有相应的权限。需要在群晖的文件管理器中直接对 Manager 的工具文件夹进行权限修改（勾选上以下页面的“应用到子文件”，截图没截全）：</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829150236.png"></fancybox><p>修改完之后，Web管理页面上的编辑、删除、重命名即可正常使用。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="修改源码加以完善"><a href="#修改源码加以完善" class="headerlink" title="修改源码加以完善"></a><strong>修改源码加以完善</strong></h3><p>由于主体就一个php文件，所以比较容易修改，原页面主要的问题有以下几个：</p><ul><li>文件类型对应的图标太丑</li><li>文件操作区的按钮重复</li><li>修改根目录后文件直链出错</li><li>最底部的操作区没实际意义</li></ul><h4 id="1-修改文件类型对应的图标"><a href="#1-修改文件类型对应的图标" class="headerlink" title="1. 修改文件类型对应的图标"></a><strong>1. 修改文件类型对应的图标</strong></h4><p>这里首先引入最新版本的 font-awsome 图标，在index中的适当位置加入（以下代码需要在官网注册后才能得到）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://kit.fontawesome.com/xxxxxx.js"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在 2612 行找到 <code>function fm_get_file_icon_class($path)</code> 函数，全部类型对应的图标均在此修改即可。</p><h4 id="2-删除没用的部分"><a href="#2-删除没用的部分" class="headerlink" title="2. 删除没用的部分"></a><strong>2. 删除没用的部分</strong></h4><p>对我来说，文件的下载和直链，两部分完全相同，所以操作区的下载按钮直接删掉（复制其实也没用）。还有页面最底部的操作区也没用，直接删掉，对应到源码主要是以下几部分，直接注释掉即可：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Line 1947 - 删除对文件夹的复制</span><br><span class="line"><span class="comment">&lt;!--&lt;a title="&lt;?php echo lng('CopyTo')?&gt;..." href="?p=&amp;amp;copy=&lt;?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?&gt;"&gt;&lt;i class="fa fa-files-o" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">Line 1949 - 删除对文件夹的直链</span><br><span class="line"><span class="comment">&lt;!--&lt;a title="&lt;?php echo lng('DirectLink')?&gt;" href="&lt;?php echo fm_enc(FM_ROOT_URL . '/' . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f) ?&gt;" target="_blank"&gt;&lt;i class="fa fa-link" aria-hidden="true"&gt;&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">Line 2011 - 删除对文件的复制</span><br><span class="line"><span class="comment">&lt;!--&lt;a title="&lt;?php echo lng('CopyTo') ?&gt;..."</span></span><br><span class="line"><span class="comment">    href="?p=&lt;?php echo urlencode(FM_PATH) ?&gt;&amp;amp;copy=&lt;?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?&gt;"&gt;&lt;i class="fa fa-files-o"&gt;&lt;/i&gt;&lt;/a&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">Line 2015 - 删除对文件的下载</span><br><span class="line"><span class="comment">&lt;!--&lt;a title="&lt;?php echo lng('Download') ?&gt;" href="?p=&lt;?php echo urlencode(FM_PATH) ?&gt;&amp;amp;dl=&lt;?php echo urlencode($f) ?&gt;"&gt;&lt;i class="fa fa-download"&gt;&lt;/i&gt;&lt;/a&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">Line 2054 - 删除页面底部的操作区（注意注释位置）</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-12 col-sm-9"</span>&gt;</span><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;ul class="list-inline footer-action"&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt; &lt;a href="#/select-all" class="btn btn-small btn-outline-primary btn-2" onclick="select_all();return false;"&gt;&lt;i class="fa fa-check-square"&gt;&lt;/i&gt; &lt;?php echo lng('SelectAll') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;a href="#/unselect-all" class="btn btn-small btn-outline-primary btn-2" onclick="unselect_all();return false;"&gt;&lt;i class="fa fa-window-close"&gt;&lt;/i&gt; &lt;?php echo lng('UnSelectAll') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;a href="#/invert-all" class="btn btn-small btn-outline-primary btn-2" onclick="invert_all();return false;"&gt;&lt;i class="fa fa-th-list"&gt;&lt;/i&gt; &lt;?php echo lng('InvertSelection') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;input type="submit" class="hidden" name="delete" id="a-delete" value="Delete" onclick="return confirm('Delete selected files and folders?')"&gt;</span></span><br><span class="line"><span class="comment">            &lt;a href="javascript:document.getElementById('a-delete').click();" class="btn btn-small btn-outline-primary btn-2"&gt;&lt;i class="fa fa-trash"&gt;&lt;/i&gt; &lt;?php echo lng('Delete') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;input type="submit" class="hidden" name="zip" id="a-zip" value="zip" onclick="return confirm('Create archive?')"&gt;</span></span><br><span class="line"><span class="comment">            &lt;a href="javascript:document.getElementById('a-zip').click();" class="btn btn-small btn-outline-primary btn-2"&gt;&lt;i class="fa fa-file-archive-o"&gt;&lt;/i&gt; &lt;?php echo lng('Zip') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;input type="submit" class="hidden" name="tar" id="a-tar" value="tar" onclick="return confirm('Create archive?')"&gt;</span></span><br><span class="line"><span class="comment">            &lt;a href="javascript:document.getElementById('a-tar').click();" class="btn btn-small btn-outline-primary btn-2"&gt;&lt;i class="fa fa-file-archive-o"&gt;&lt;/i&gt; &lt;?php echo lng('Tar') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">        &lt;li class="list-inline-item"&gt;&lt;input type="submit" class="hidden" name="copy" id="a-copy" value="Copy"&gt;</span></span><br><span class="line"><span class="comment">            &lt;a href="javascript:document.getElementById('a-copy').click();" class="btn btn-small btn-outline-primary btn-2"&gt;&lt;i class="fa fa-files-o"&gt;&lt;/i&gt; &lt;?php echo lng('Copy') ?&gt; &lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">    &lt;/ul&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-修复链接问题"><a href="#3-修复链接问题" class="headerlink" title="3. 修复链接问题"></a><strong>3. 修复链接问题</strong></h4><p>在 <code>FM_ROOT_URL</code> 后面，将 <code>/</code> 改为 <code>/tools</code>（设置的根目录）即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Line 2014 </span></span><br><span class="line">&lt;a title=<span class="string">"&lt;?php echo lng('DirectLink') ?&gt;"</span> </span><br><span class="line">   href=<span class="string">"&lt;?php echo fm_enc(FM_ROOT_URL . '/tools' . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f) ?&gt;"</span> </span><br><span class="line">   target=<span class="string">"_blank"</span>&gt;</span><br><span class="line">  &lt;i class="fa fa-link"&gt;&lt;/i&gt;</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>将 <code>fm_enc($file_url)</code>改为 <code>str_replace(&quot;6543&quot;,&quot;6543/tools&quot;,fm_enc($file_url))</code>（把根目录加上）即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Line 1592</span></span><br><span class="line">&lt;b&gt;&lt;a href="&lt;?php echo str_replace("6543","6543/tools",fm_enc($file_url)) ?&gt;" target="_blank"&gt;&lt;i class="fa fa-external-link-square"&gt;&lt;/i&gt; &lt;?php echo lng('Open') ?&gt;&lt;/a&gt;&lt;/b&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Line 1647</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;div class="preview-video"&gt;&lt;video src="'</span> .  str_replace(<span class="string">"6543"</span>,<span class="string">"6543/tools"</span>,fm_enc($file_url)) . <span class="string">'" width="640" height="360" controls preload="metadata"&gt;&lt;/video&gt;&lt;/div&gt;'</span>;</span><br></pre></td></tr></table></figure><br><blockquote><p>访问 <a href="https://www.cxmoe.com">cz5h.com</a> 获取更多精彩内容。</p></blockquote><br><h4 id="4-最终的精简效果"><a href="#4-最终的精简效果" class="headerlink" title="4. 最终的精简效果"></a><strong>4. 最终的精简效果</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200829144337.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 群晖 </tag>
            
            <tag> 文件管理 </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>群晖硬盘过热导致的关机保护</title>
      <link href="/article/fed3.html"/>
      <url>/article/fed3.html</url>
      
        <content type="html"><![CDATA[<p>从七月末开始，我的NAS就突然不能正常开机了，今天尝试排查了一下错误，结果能够正常启动且正常运行，但正常运行两个小时之后，群晖就又宕机无法开机了，如此反复气死我了，最后简单搞了一下暂时可用了，但依旧没有找到病根。</p><a id="more"></a><h4 id="检查硬件"><a href="#检查硬件" class="headerlink" title="检查硬件"></a><strong>检查硬件</strong></h4><ul><li>拆卸下来 - 有内存无硬盘状态开机 - 检查是否系统有问题</li><li>拆卸内存 - 擦拭插槽和插片，插回去后开机 - 检查内存是否有问题</li><li>装回硬盘 - 开机，看是否正常登入 - 检查硬盘是否有问题</li></ul><p>以上是通用的步骤，对于具体的出错位置和原因，可以在我们重新登录群晖之后，通过查看日志中心来发现！</p><p>我的故障机器通过拔插硬盘和内存，获得了短暂的复活时间，其实当时我以为是修复了，就在我截图准备写此文时，它居然又挂了，虽然这次我知道是什么问题了，但还是很懵，基本上在靠 UptimeRobot 的监控邮件在<strong>确认</strong>群晖的死亡，为了更加及时、清晰的知道群晖的宕机时间和原因，我推荐大家把群晖异常的邮件推送给配置上。</p><p>配置邮件通知非常简单，在控制面板的通知设置里，把信息填上即可，做完后记得发测试邮件试一试。注意：这里的密码不是QQ账号密码，而是要去QQ邮箱的设置中获取的 <strong>16位授权码</strong>！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200822130713.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="定位日志"><a href="#定位日志" class="headerlink" title="定位日志"></a><strong>定位日志</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806191300.png"></fancybox><p>在通过硬件插拔后，我顺利进入了系统，然后通过查看<strong>日志</strong>这个APP，可以发现很明显的、触发关机的异常，这里是<strong>硬盘温度超过保护温度</strong>而触发关机保护。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806191641.png"></fancybox><p>可以看到日志说是<strong>drive4</strong>的问题，在<strong>磁盘管理</strong>这个APP中，我们可以找到那块磁盘，不幸的是这块磁盘是我RAID阵列中的一块，可以看到截图时的温度还是很正常的，就在截图后的半小时内，它就又宕机了，如果还是硬盘温度超限，那我就很不解了，因为在此期间我并没有访问什么服务，也就开启了Web端的DSM桌面。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200822130842.png"></fancybox><p>再仔细看日志的日期，或者直接看状态监控，可以发现最早的异常出现在7月22号（准确的说是7.21的23:58），要知道之前的时间跨度内我的群晖是百分百可用的，如果是<strong>硬盘老化</strong>，照理不会“坏”的这么突然。</p><h4 id="可能的推测"><a href="#可能的推测" class="headerlink" title="可能的推测"></a><strong>可能的推测</strong></h4><p>在上个月的那段时间我并不记得自己有任何对其的异常操作，所有操作均在七月22号之前很久就做了，我推测这次的硬盘升温并不是由于我的误操作引起的，可能还需要进一步找错误，硬盘4和另一块2T盘是同一时间同时从厂家买的，批号都很相似，讲道理不会有一块突然坏掉吧。。</p><p>如果真的是天气热导致的散热问题而引发的，那估计问题不大，天气不热了就没事了，不过还需要进一步观察。</p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 群晖 </tag>
            
            <tag> 异常 </tag>
            
            <tag> 维护 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速建站“新玩具”—glitch.me</title>
      <link href="/article/6868.html"/>
      <url>/article/6868.html</url>
      
        <content type="html"><![CDATA[<p>今天在 YouTube 看了一个谷歌的开发视频，里面主讲者用 Glitch.me 做了代码的演示平台，所以自然地通过视频下方的演示链接，接触到了 Glitch，初步使用过后，我觉得这和 now.sh 等功能差不多，专为Web静态页面提供快速发布服务。目前我看百度里对其介绍的文章基本没有，那我就来介绍一下它吧！</p><a id="more"></a><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806194610.png"></fancybox><p>部分内容翻译自官方的说明，可不是我瞎编的！</p><h3 id="Glitch到能干啥？"><a href="#Glitch到能干啥？" class="headerlink" title="Glitch到能干啥？"></a><strong>Glitch到能干啥？</strong></h3><h4 id="创建Web应用的工具"><a href="#创建Web应用的工具" class="headerlink" title="创建Web应用的工具"></a><strong>创建Web应用的工具</strong></h4><ul><li><p>其可以让所有人都能够使用此“开发工具”，因此其足够简单、易用。完善的代码补全提醒、健全的团队管理功能是其基本功能。除此之外，Glitch其实是一个协作式编程环境，只需要使用浏览器的开发页面，就可以构建从静态网页到结合全栈Node框架的所有应用。</p></li><li><p>第二个令我惊讶的特性是“多人协作开发”的功能，Glitch在这里真正做到了实时多人在线开发，这个功能还是很吸引人的。</p></li><li><p>第三点则是应用的“即时上线”功能，这里要吐槽下国内的Coding，使用静态部署一小时只有十次配额，对于Glitch，这将是无限的、实时的、无需我们干预的过程，Glitch本质上没有部署或发布的概念，修改后即生效。</p></li><li><p>第四点黑科技则是“和已有IDE的无缝结合”，例如可以在VSCode中使用插件来将Glitch的web开发页面搬到VSCode中，其余操作完全无影响。再比如结合Github，直接导入已有的代码进行构建。</p></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="友好、创造性的社区"><a href="#友好、创造性的社区" class="headerlink" title="友好、创造性的社区"></a><strong>友好、创造性的社区</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806223446.png"></fancybox><p>Glitch已经包含了非常多的有趣的项目，包含了各种分类的各种内容，以游戏为例，其允许我们直接看到、使用到游戏渲染后的内容，这也算是Glitch的黑科技吧，如果你对某个项目感兴趣，那么将其内化并加以完善在Glitch上也是非常容易就能实现的！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806223620.png"></fancybox><h3 id="Glitch怎么用？"><a href="#Glitch怎么用？" class="headerlink" title="Glitch怎么用？"></a><strong>Glitch怎么用？</strong></h3><p>详细讲解其用法是不现实的，这里就两个关键功能来对Glitch做个简单的讲解。</p><h4 id="快速发布静态页"><a href="#快速发布静态页" class="headerlink" title="快速发布静态页"></a><strong>快速发布静态页</strong></h4><p>有多快速呢？基本上就是“新建项目-&gt;编辑index.html-&gt;获得页面链接”就结束了。具体登陆时可以直接用Github登陆，其不会再有附加账号的要求。新建项目后会发现有个双栏的开发页面，所有工作都可以在这个页面完成，而且重点是左侧部分，功能基本都在这块。</p><p>以 <a href="https://github.com/iamcn/iamchinese" target="_blank" rel="external nofollow noopener noreferrer">iamchinese</a> 项目为例，修改完index.html后，随即打开左侧头像旁边的<code>Share</code>下拉框，选择<code>LiveAPP</code>，即可复制当前的页面链接，即：<a href="https://iamchinese.glitch.me" target="_blank" rel="external nofollow noopener noreferrer">https://iamchinese.glitch.me</a>，如果对默认名称不满意，可以直接修改一个可用的名称（即修改最左上角的项目名称）。</p><h4 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a><strong>绑定域名</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806233316.png"></fancybox><p>左下角，点击 Tools -&gt; Custom Domains，输入你的域名，即可以获得进一步的绑定信息。你会发现以下内容，至此应该有域名的朋友就知道怎么做了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">At your domain registrar </span><br><span class="line">you&#39;ll need to create a CNAME record </span><br><span class="line">for ihave.diedin.icu pointing to </span><br><span class="line">peyk2z9el29xvm93.preview.edgeapp.net</span><br></pre></td></tr></table></figure><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200806233419.png"></fancybox><p>需要注意的是，Glitch已说明如果你想直接访问<code>preview.edgeapp.net</code>这个链接，那么你只会得到<code>Not Found</code>。其只能在CNAME下生效。这里我用Dnspod，只需要添加一个CNAME即可。解析后即可访问 <a href="http://ihave.diedin.icu" target="_blank" rel="external nofollow noopener noreferrer">ihave.diedin.icu</a>。</p><p>至此，其主要功能“快速发布静态页面”就基本介绍完毕，各种扩展、功能大家可以自己去慢慢探索。</p><p><strong>不过据不可靠消息称，Glitch在国内无法访问，未验证。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 教程 </tag>
            
            <tag> Glitch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改自定义站点监控页面的样式</title>
      <link href="/article/cf94.html"/>
      <url>/article/cf94.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200726001149.png"></fancybox><p>许久之前就开始使用 UptimeRobot 来监控站点的状态了，不过一直是使用默认的方式，即绑定域名后使用官方的默认模板，使用体验还算可以，但令人不爽的是只有最近一周的运行状态，而且感觉状态刷新频率也不高，时值近日 NAS 极不稳定（现在还没弄好），我非常想看看是有多不稳定，但官方的监控页面信息实在不足，因此换用基于官方API的自定义监控页面。</p><a id="more"></a><h3 id="官方默认模板"><a href="#官方默认模板" class="headerlink" title="官方默认模板"></a><strong>官方默认模板</strong></h3><p><strong>示例页面：</strong><a href="/monitor.html">绑定的二级域名</a></p><p><strong>不足之处：</strong></p><ul><li>只有七天状态信息可见</li><li>刷新频率未知（迟滞）</li><li>必须绑定域名，也就意味着无法作为网站内页（之前用iframe硬加进来的，其实监控页面是<a href="https://up.cz5h.com/" target="_blank" rel="external nofollow noopener noreferrer">up.cz5h.com</a>）</li><li>无法自由更改页面内容</li></ul><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200726012510.png"></fancybox><h3 id="自定义模板（原版）"><a href="#自定义模板（原版）" class="headerlink" title="自定义模板（原版）"></a><strong>自定义模板（原版）</strong></h3><p><strong>示例页面：</strong><a href="https://status.org.cn/" target="_blank" rel="external nofollow noopener noreferrer">原项目DEMO页</a></p><p>利用 UptimeRobot 的API开发的监控页面，很好的解决了上述不足：</p><ul><li>其实现方式意味着我们可以随心所欲的安排监控页面出现的位置，网站内页或者嵌入到某页面都是可以实现的；</li><li>其API允许查看90天（据说）的状态信息，简直不要太开心；</li><li>实现方便，只需引入几个文件夹即可；</li></ul><p><strong>搭建步骤：</strong></p><ol><li>申请 UptimeRobot 账号，配置自己的站点并监控，其网站做的很人性化，步骤不再赘述，至此我们在其网站上就可以查看服务/站点的状态了；</li><li>下载自定义模板的代码，<a href="https://github.com/yb/uptime-status/releases" target="_blank" rel="external nofollow noopener noreferrer">Github地址</a>，并将其解压到Hexo文件夹内，具体可以放在 theme -&gt; yourTheme -&gt; source -&gt; folderName文件夹内；</li><li>在 UptimeRobot 官网，通过 MySettings - API Settings -&gt; Monitor-Specific API Keys -&gt; Show/hide 中的搜索框，找到你已创建的监控站点，点击生成 API kEY 并复制;</li><li>将 Key 复制到 config.js 中的对应位置，每个监控任务对应一个 Key，比如你监控了十个站点/服务，那需要十个 Key；</li><li>部署 Hexo，此时访问 yourSite/folderName（例如我的[cz5h.com/up}(<a href="https://www.cxmoe.com/up)），就可以看到监控信息了。">https://www.cxmoe.com/up)），就可以看到监控信息了。</a></li></ol><p><strong>不足之处：</strong></p><p>样式太丑了，和我博客的风格很不搭，别的都很好，致敬作者。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200726002402.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="简单修改后样式"><a href="#简单修改后样式" class="headerlink" title="简单修改后样式"></a><strong>简单修改后样式</strong></h3><p><strong>示例页面：</strong><a href="https://www.cxmoe.com/up">本站内页</a></p><p>修改过程非常简单，直接将以下CSS代码写入 index.html 中即可。注意几点：</p><ul><li>原页面有 footer 信息，这里直接用JS隐藏掉，之后你可以再覆写 footer，这样即使不修改源码也可以快速得到相要的样式；</li><li>样式名称还是很规范的，利用F12检查元素可以很快就完成修改；</li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">script</span>&gt;</span><br><span class="line">    document.getElementById('footer').style.display = 'none';// 隐藏选择的元素</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#010012</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(#<span class="number">010012</span>, #<span class="number">111</span>f4c, #<span class="number">010012</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#header</span> <span class="selector-class">.navi</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.timeline</span> <span class="selector-tag">i</span><span class="selector-class">.ok</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#2195f3bb</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.timeline</span> <span class="selector-tag">i</span><span class="selector-class">.down</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f34539bb</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.timeline</span> <span class="selector-tag">i</span><span class="selector-class">.none</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ff000026</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.meta</span> <span class="selector-class">.status</span><span class="selector-class">.down</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>();</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#f34539bb</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.timeline</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.meta</span> <span class="selector-class">.status</span><span class="selector-class">.ok</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>();</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#2195f3bb</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.meta</span> <span class="selector-class">.name</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.foot</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#757a80</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.timeline</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">55px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#footer</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#999fa6</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#header</span> <span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#2195f3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">18px</span> <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#c5def6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="attribute">border</span>: <span class="number">0px</span> solid <span class="number">#e3e4e6</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#uptime</span> <span class="selector-class">.item</span> &#123;</span><br><span class="line">     </span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">15px</span> solid <span class="number">#060923</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><strong>最终效果：</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200726002233.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> UptimeRobot </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>快速重置乌班图和GL开发环境</title>
      <link href="/article/483a.html"/>
      <url>/article/483a.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200809190237.png"></fancybox><p>这是一份完整的Ubuntu安装手册，可以帮助你快速初始化系统到可用状态，此手册包含两部分，包括Ubuntu系统的安装及配置、及GL相关开发环境的初始化。为了使行文更加清晰，文中插图全部以链接形式呈现，该手册仍然在完善中并已开源在Github。</p><a id="more"></a><p><strong>Go to <a href="https://tianzonglin.github.io/Ubuntu-Installog" target="_blank" rel="external nofollow noopener noreferrer">Github version</a></strong>，中英版本。</p><!-- TOC --><ul><li><a href="#0-机器信息">0. 机器信息</a></li><li><a href="#1-安装系统"><strong>1. 安装系统</strong></a><ul><li><a href="#11-准备usb启动盘"><strong>1.1 准备USB启动盘</strong></a></li><li><a href="#12-在bios中关闭-secure-boot"><strong>1.2 在BIOS中关闭 Secure Boot</strong></a></li><li><a href="#13-按正常步骤安装完系统"><strong>1.3 按正常步骤安装完系统</strong></a></li><li><a href="#14-第一次进入桌面后更新系统然后重启"><strong>1.4 第一次进入桌面后更新系统，然后重启</strong></a></li></ul></li><li><a href="#2-安装英伟达驱动"><strong>2. 安装英伟达驱动</strong></a><ul><li><a href="#21-添加软件源并查看"><strong>2.1 添加软件源并查看</strong></a></li><li><a href="#22-通过软件和更新直接安装"><strong>2.2 通过软件和更新直接安装</strong></a></li><li><a href="#23-不要设置-nouveau-黑名单或者设置-grub-启动项"><strong>2.3 不要设置 nouveau 黑名单或者设置 grub 启动项</strong></a></li></ul></li><li><a href="#3-安装-cuda-toolkit"><strong>3. 安装 cuda-toolkit</strong></a><ul><li><a href="#31-选择版本这里我用的-cuda-10_run"><strong>3.1 选择版本，这里我用的 cuda-10_*.run</strong></a></li><li><a href="#32-执行"><strong>3.2 执行</strong></a></li><li><a href="#33-跳过显卡安装"><strong>3.3 跳过显卡安装</strong></a></li><li><a href="#34-测试-samples"><strong>3.4 测试 Samples</strong></a></li><li><a href="#35-其他重要的配置"><strong>3.5 其他重要的配置</strong></a></li></ul></li><li><a href="#4-安装-gl-相关环境库"><strong>4. 安装 GL 相关环境、库</strong></a><ul><li><a href="#41-glglh"><strong>4.1 GL/gl.h</strong></a></li><li><a href="#42-glgluh"><strong>4.2 GL/glu.h</strong></a></li><li><a href="#43-others"><strong>4.3 others</strong></a></li><li><a href="#44-以上直接一次性安装"><strong>4.4 以上直接一次性安装</strong></a></li></ul></li><li><a href="#5-安装项目所需软件并重构"><strong>5. 安装项目所需软件并重构</strong></a><ul><li><a href="#51-基础工具"><strong>5.1 基础工具</strong></a></li><li><a href="#52-重新构建"><strong>5.2 重新构建</strong></a></li></ul></li><li><a href="#6-安装日程必备软件"><strong>6. 安装日程必备软件</strong></a><ul><li><a href="#61-截屏工具-flameshot"><strong>6.1 截屏工具： flameshot</strong></a></li><li><a href="#62-开发工具vscode"><strong>6.2 开发工具：vscode</strong></a></li></ul></li><li><a href="#7-使用-tweaks-修改主题"><strong>7. 使用 Tweaks 修改主题</strong></a><ul><li><a href="#71-安装-tweaks-及其扩展-extensions"><strong>7.1 安装 Tweaks 及其扩展 extensions</strong></a></li><li><a href="#72-更改顶部菜单栏样式"><strong>7.2 更改顶部菜单栏样式</strong></a></li><li><a href="#73-修改壁纸"><strong>7.3 修改壁纸</strong></a></li><li><a href="#74-修改面板到底部并把图标放到桌面"><strong>7.4 修改面板到底部，并把图标放到桌面</strong></a></li></ul></li><li><a href="#8-不重要的配置"><strong>8. 不重要的配置</strong></a><ul><li><a href="#81-添加中文支持"><strong>8.1 添加中文支持</strong></a></li><li><a href="#82-更改副屏分辨率"><strong>8.2 更改副屏分辨率</strong></a></li><li><a href="#83-添加一些未适配的应用"><strong>8.3 添加一些未适配的应用</strong></a></li><li><a href="#84-tweaks的一些不重要的美化设置"><strong>8.4 Tweaks的一些不重要的美化设置</strong></a></li><li><a href="#85-其他实用的配置及软件"><strong>8.5 其他实用的配置及软件</strong></a><ul><li><a href="#851-屏幕亮度控制"><strong>8.5.1 屏幕亮度控制</strong></a></li><li><a href="#852-vscode配置"><strong>8.5.2 Vscode配置</strong></a></li><li><a href="#853-picgo"><strong>8.5.3 picgo</strong></a></li><li><a href="#854-安装并配置-git"><strong>8.5.4 安装并配置 git</strong></a></li><li><a href="#855-远程桌面软件"><strong>8.5.5 远程桌面软件</strong></a></li></ul></li></ul></li><li><a href="#x-ubuntu使用注意事项"><strong>X. Ubuntu使用注意事项</strong></a><ul><li><a href="#x1-对于更新"><strong>X.1 对于更新</strong></a></li><li><a href="#x2-对于死机"><strong>X.2 对于死机</strong></a></li></ul></li></ul><!-- /TOC --><h3 id="0-机器信息"><a href="#0-机器信息" class="headerlink" title="0. 机器信息"></a>0. 机器信息</h3><ul><li>MSI GE62 490, 显卡英伟达960M（笔记本）</li><li>CPU: intel i7-6700HQ，带核显</li><li>单系统安装（ubuntu-18.04-LTS）</li></ul><h3 id="1-安装系统"><a href="#1-安装系统" class="headerlink" title="1. 安装系统"></a><strong>1. 安装系统</strong></h3><h4 id="1-1-准备USB启动盘"><a href="#1-1-准备USB启动盘" class="headerlink" title="1.1 准备USB启动盘"></a><strong>1.1 准备USB启动盘</strong></h4><p>注意：本文使用的官方镜像为 <a href="https://releases.ubuntu.com/18.04/ubuntu-18.04.4-desktop-amd64.iso" target="_blank" rel="external nofollow noopener noreferrer">ubuntu-18.04.4-desktop-amd64.iso</a>。</p><h4 id="1-2-在BIOS中关闭-Secure-Boot"><a href="#1-2-在BIOS中关闭-Secure-Boot" class="headerlink" title="1.2 在BIOS中关闭 Secure Boot"></a><strong>1.2 在BIOS中关闭 Secure Boot</strong></h4><h4 id="1-3-按正常步骤安装完系统"><a href="#1-3-按正常步骤安装完系统" class="headerlink" title="1.3 按正常步骤安装完系统"></a><strong>1.3 按正常步骤安装完系统</strong></h4><p>注意：如果你可以正常走完安装流程进入桌面，那就<strong>不需要</strong>修改 grub 的任何信息（例如nomodeset）。正常情况下，安装完后拔出USB启动盘，应该可以顺利进入桌面（此时系统运行在核显驱动下）。</p><h4 id="1-4-第一次进入桌面后更新系统，然后重启"><a href="#1-4-第一次进入桌面后更新系统，然后重启" class="headerlink" title="1.4 第一次进入桌面后更新系统，然后重启"></a><strong>1.4 第一次进入桌面后更新系统，然后重启</strong></h4><p>注意：当你第一次进入Ubuntu桌面时，可能会弹出系统及软件的更新，请同意更新，否则会影响后续操作。不过，当我们在安装完全部所需环境、软件之后，就不再需要更新了，尤其是尽量<strong>不进行</strong>系统级的更新，否则我们稍后安装的显卡驱动可能会因此出现异常。</p><h3 id="2-安装英伟达驱动"><a href="#2-安装英伟达驱动" class="headerlink" title="2. 安装英伟达驱动"></a><strong>2. 安装英伟达驱动</strong></h3><h4 id="2-1-添加软件源并查看"><a href="#2-1-添加软件源并查看" class="headerlink" title="2.1 添加软件源并查看"></a><strong>2.1 添加软件源并查看</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:graphics-drivers&#x2F;ppa</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo ubuntu-drivers devices</span><br></pre></td></tr></table></figure><p>注意：这里会输出你的机器适配的显卡驱动，并且会有一个 recommend 推荐项，我们稍后就安装这个推荐版本。</p><h4 id="2-2-通过软件和更新直接安装"><a href="#2-2-通过软件和更新直接安装" class="headerlink" title="2.2 通过软件和更新直接安装"></a><strong>2.2 通过软件和更新直接安装</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Software and Updates -&gt;</span><br><span class="line">    additional drivers -&gt;</span><br><span class="line">        select the recommandation version -&gt;</span><br><span class="line">            apply</span><br></pre></td></tr></table></figure><p>注意：安装显卡驱动的方式有很多，较新版本的Ubuntu完全可以在“软件和更新”中直接进行显卡驱动的安装。无需下载安装文件，无需通过命令安装。</p><h4 id="2-3-不要设置-nouveau-黑名单或者设置-grub-启动项"><a href="#2-3-不要设置-nouveau-黑名单或者设置-grub-启动项" class="headerlink" title="2.3 不要设置 nouveau 黑名单或者设置 grub 启动项"></a><strong>2.3 不要设置 nouveau 黑名单或者设置 grub 启动项</strong></h4><p>注意：使用此种方式安装显卡驱动，配置完全由系统完成，我们不用做任何设置。在‘软件与更新’内完成显卡安装后，重启系统。</p><p>重启后进入桌面（此时正常情况下是会顺利启动的），此时用 <code>nvidia-smi</code> 可以测试显卡信息，截图：<a href="http://i.imgur.com/GgfSqCM.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/GgfSqCM.png</a>，此外还可以直接通过系统信息来查看是否已加载英伟达显卡，截图：<a href="http://i.imgur.com/Euj6tQy.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/Euj6tQy.png</a>。</p><h3 id="3-安装-cuda-toolkit"><a href="#3-安装-cuda-toolkit" class="headerlink" title="3. 安装 cuda-toolkit"></a><strong>3. 安装 cuda-toolkit</strong></h3><p><strong>（第3、4、5节和我自己的开发需求有关，一般使用可以跳过这几节！）</strong></p><h4 id="3-1-选择版本，这里我用的-cuda-10-run"><a href="#3-1-选择版本，这里我用的-cuda-10-run" class="headerlink" title="3.1 选择版本，这里我用的 cuda-10_*.run"></a><strong>3.1 选择版本，这里我用的 cuda-10_*.run</strong></h4><p>（截图： <a href="http://i.imgur.com/6xPtxju.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/6xPtxju.png</a>）</p><h4 id="3-2-执行"><a href="#3-2-执行" class="headerlink" title="3.2 执行"></a><strong>3.2 执行</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod 777 cuda-10_\*.run</span><br><span class="line">$ sudo sh cuda-10_\*.run</span><br></pre></td></tr></table></figure><h4 id="3-3-跳过显卡安装"><a href="#3-3-跳过显卡安装" class="headerlink" title="3.3 跳过显卡安装"></a><strong>3.3 跳过显卡安装</strong></h4><p>注意：我们在前面已经安装过显卡了，这里务必要回答 NO。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 410.48?</span><br><span class="line">(y)es&#x2F;(n)o&#x2F;(q)uit: n</span><br></pre></td></tr></table></figure><h4 id="3-4-测试-Samples"><a href="#3-4-测试-Samples" class="headerlink" title="3.4 测试 Samples"></a><strong>3.4 测试 Samples</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;samples</span><br><span class="line">$ make</span><br><span class="line">  (10 minutes later)</span><br><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;cuda&#x2F;samples&#x2F;bin&#x2F;x86_64&#x2F;linux&#x2F;release</span><br><span class="line">$ .&#x2F;deviceQuery</span><br></pre></td></tr></table></figure><p>（截图： <a href="http://i.imgur.com/jJ7vpNw.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/jJ7vpNw.png</a>）</p><h4 id="3-5-其他重要的配置"><a href="#3-5-其他重要的配置" class="headerlink" title="3.5 其他重要的配置"></a><strong>3.5 其他重要的配置</strong></h4><p>注意：别忘了添加环境变量到 <code>/etc/profile</code>，如果不添加的话，后面使用Cuda会出现 <code>libcudart.so.10.0: cannot open shared object file: No such file or directory</code> 这种错误。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;bin:$PATH </span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib:&#x2F;usr&#x2F;local&#x2F;cuda&#x2F;lib64&#x2F;</span><br></pre></td></tr></table></figure><p>到此为止，英伟达显卡驱动和Cuda已经全部安装完毕。并且也通过测试来确保了安装的正确。</p><h3 id="4-安装-GL-相关环境、库"><a href="#4-安装-GL-相关环境、库" class="headerlink" title="4. 安装 GL 相关环境、库"></a><strong>4. 安装 GL 相关环境、库</strong></h3><p><strong>（第3、4、5节和我自己的开发需求有关，一般使用可以跳过这几节！）</strong></p><h4 id="4-1-GL-gl-h"><a href="#4-1-GL-gl-h" class="headerlink" title="4.1 GL/gl.h"></a><strong>4.1 GL/gl.h</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install mesa-common-dev</span><br></pre></td></tr></table></figure><h4 id="4-2-GL-glu-h"><a href="#4-2-GL-glu-h" class="headerlink" title="4.2 GL/glu.h"></a><strong>4.2 GL/glu.h</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libglu1-mesa-dev freeglut3-dev</span><br></pre></td></tr></table></figure><h4 id="4-3-others"><a href="#4-3-others" class="headerlink" title="4.3 others"></a><strong>4.3 others</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libglfw3-dev libgles2-mesa-dev libglew-dev libeigen3-dev</span><br></pre></td></tr></table></figure><h4 id="4-4-以上直接一次性安装"><a href="#4-4-以上直接一次性安装" class="headerlink" title="4.4 以上直接一次性安装"></a><strong>4.4 以上直接一次性安装</strong></h4><p>注意：这些库对我都是必须的，但这是取决于项目需求。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install mesa-common-dev freeglut3-dev libglfw3-dev libgles2-mesa-dev libglew-dev libeigen3-dev</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="5-安装项目所需软件并重构"><a href="#5-安装项目所需软件并重构" class="headerlink" title="5. 安装项目所需软件并重构"></a><strong>5. 安装项目所需软件并重构</strong></h3><p><strong>（第3、4、5节和我自己的开发需求有关，一般使用可以跳过这几节！）</strong></p><h4 id="5-1-基础工具"><a href="#5-1-基础工具" class="headerlink" title="5.1 基础工具"></a><strong>5.1 基础工具</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install vim</span><br><span class="line">$ sudo apt install cmake</span><br></pre></td></tr></table></figure><h4 id="5-2-重新构建"><a href="#5-2-重新构建" class="headerlink" title="5.2 重新构建"></a><strong>5.2 重新构建</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cd ProjectionExplain&#x2F;LIBRARY&#x2F;glui-master</span><br><span class="line">$ rm CMakeCache.txt</span><br><span class="line">$ make clean</span><br><span class="line">$ mkdir build &amp;&amp; cd build</span><br><span class="line">$ cmake ..</span><br><span class="line">$ make install</span><br><span class="line">$ cd ProjectionExplain&#x2F;</span><br><span class="line">$ make clean</span><br><span class="line">$ make </span><br><span class="line">$ .&#x2F;projwiz -f DATA&#x2F;segmentation lamp</span><br></pre></td></tr></table></figure><p>此时项目已经构建完毕并可以成功运行！<br> （截图： <a href="http://i.imgur.com/rDCtEId.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/rDCtEId.png</a>）</p><h3 id="6-安装日程必备软件"><a href="#6-安装日程必备软件" class="headerlink" title="6. 安装日程必备软件"></a><strong>6. 安装日程必备软件</strong></h3><h4 id="6-1-截屏工具：-flameshot"><a href="#6-1-截屏工具：-flameshot" class="headerlink" title="6.1 截屏工具： flameshot"></a><strong>6.1 截屏工具： flameshot</strong></h4><p>使用 <code>sudo apt-get install flameshot</code> 完成安装，并如截图所示进行配置（截图： <a href="http://i.imgur.com/id2PPYj.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/id2PPYj.png</a>）。</p><h4 id="6-2-开发工具：vscode"><a href="#6-2-开发工具：vscode" class="headerlink" title="6.2 开发工具：vscode"></a><strong>6.2 开发工具：vscode</strong></h4><p><strong>..更多相关配置在 8.5 小节..</strong></p><p>直接在 Ubuntu 的‘软件与更新’内安装Vscode（截图： <a href="http://i.imgur.com/W971ERc.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/W971ERc.png</a>）。</p><p>然后，对于 Cmake 项目，Vscode更多的充当编辑器的作用，搭配 terminal 进行构建即可。以前文项目为例：</p><ul><li>在Vscode中打开项目文件夹 (ProjectionExplain)</li><li>在Vscode中打开终端，Terminal-&gt;new terminal</li><li>在Vscode代码区编辑代码，在终端内构建-&gt;make &amp;&amp; ./projwiz -f DATA/segmentation lamp</li></ul><h3 id="7-使用-Tweaks-修改主题"><a href="#7-使用-Tweaks-修改主题" class="headerlink" title="7. 使用 Tweaks 修改主题"></a><strong>7. 使用 Tweaks 修改主题</strong></h3><h4 id="7-1-安装-Tweaks-及其扩展-extensions"><a href="#7-1-安装-Tweaks-及其扩展-extensions" class="headerlink" title="7.1 安装 Tweaks 及其扩展 extensions"></a><strong>7.1 安装 Tweaks 及其扩展 extensions</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install gnome-shell-extensions gnome-shell-extension-dash-to-panel gnome-tweaks adwaita-icon-theme-full</span><br></pre></td></tr></table></figure><p>在这之后需要注销或者重启生效。</p><h4 id="7-2-更改顶部菜单栏样式"><a href="#7-2-更改顶部菜单栏样式" class="headerlink" title="7.2 更改顶部菜单栏样式"></a><strong>7.2 更改顶部菜单栏样式</strong></h4><p>扩展名称：applications menu。<br>注意：开启此扩展可以使应用菜单栏变得和Windows风格一致。扩展-&gt;设置内的选项都可能会被用到，可以自己探索一下。</p><h4 id="7-3-修改壁纸"><a href="#7-3-修改壁纸" class="headerlink" title="7.3 修改壁纸"></a><strong>7.3 修改壁纸</strong></h4><h4 id="7-4-修改面板到底部，并把图标放到桌面"><a href="#7-4-修改面板到底部，并把图标放到桌面" class="headerlink" title="7.4 修改面板到底部，并把图标放到桌面"></a><strong>7.4 修改面板到底部，并把图标放到桌面</strong></h4><p>Ubuntu 的dock默认的风格更像是 OSX 系统，Tweaks允许我们修改其成为 Windows 风格（在底部）。另外，像Windows那样，我们把图标也放在桌面上。</p><p>首先对 dock 样式进行修改：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">打开 Tweaks -&gt; Extensions </span><br><span class="line">      -&gt; 打开 &#39;applications menu&#39; </span><br><span class="line">      -&gt; 打开 &#39;Dash to panel&#39; -&gt; 打开设置</span><br><span class="line">            -&gt; Location and Style</span><br><span class="line">                  -&gt; panel location -&gt; bottom</span><br><span class="line">                  -&gt; panel size -&gt; 45px</span><br><span class="line">                  -&gt; icons margin -&gt; 5px</span><br><span class="line">                  -&gt; indicator -&gt; open settings</span><br><span class="line">                        -&gt; height -&gt; 0px (we hide it by this)</span><br><span class="line">                  -&gt; clock location -&gt; right</span><br><span class="line">                  -&gt; task panels -&gt; left</span><br><span class="line">            -&gt; Behaviors</span><br><span class="line">                  -&gt; 关闭 &#39;favoriate applications&#39;</span><br><span class="line">                  -&gt; 关闭 &#39;applications icon&#39;</span><br><span class="line">                  -&gt; 打开 &#39;show desktop&#39;</span><br><span class="line">                  -&gt; 关闭 &#39;cancel applications&#39; group&#39;</span><br></pre></td></tr></table></figure><p>对于图标问题：</p><p>Ubuntu 默认的图标路径有好几个，下面是几个可能包含图标的路径，我们只需要将这些图标复制到桌面即可。<strong>注意：</strong>你会发现复制之后图标变成了 *.desktop 文件，我们只需要双击它们，然后点击‘信任并启动’，之后它们就会变回图标的样子了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;applications</span><br><span class="line">&#x2F;var&#x2F;lib&#x2F;snapd&#x2F;desktop&#x2F;applications</span><br><span class="line">~&#x2F;.local&#x2F;share&#x2F;applications</span><br></pre></td></tr></table></figure><p>至此，基础的主题修改已经完成，目前为止，你的 Ubuntu 看起来应该非常接近 Windows 了。（截图： <a href="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/2020-07-2823849238944.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/y7safc9.png</a>）</p><h3 id="8-不重要的配置"><a href="#8-不重要的配置" class="headerlink" title="8. 不重要的配置"></a><strong>8. 不重要的配置</strong></h3><h4 id="8-1-添加中文支持"><a href="#8-1-添加中文支持" class="headerlink" title="8.1 添加中文支持"></a><strong>8.1 添加中文支持</strong></h4><ul><li><strong>第一步给系统添加中文</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">打开 Settings </span><br><span class="line">-&gt; Region &amp; Languages</span><br><span class="line">    -&gt; manage installed language</span><br><span class="line">        -&gt; 如果弹出 &#39;installed not complete&#39;，那么先完成安装</span><br><span class="line">            -&gt; 点击 &#39;Install&#x2F;Remove Languages&#39; </span><br><span class="line">                -&gt; 选择 Chinese 然后安装（可能需要双击）</span><br><span class="line">            -&gt; 然后在 &#39;Language for menu and windows&#39; </span><br><span class="line">                -&gt; 拖拽 Chinese 到排名第一的位置</span><br><span class="line">-&gt; 现在在 &#39;Region &amp; Language&#39;中，语言已经自动的变为中文了</span><br></pre></td></tr></table></figure><p>注意：上述操作完并重启后，系统才会变成中文。一般会弹出一个 ‘change public folder names’ 询问弹框，就是问你要不要修改那几个公共文件夹的名字，强烈建议不要修改，即保持默认英文名称，这对于很多 bash 操作是很有利的。</p><ul><li><strong>安装搜狗输入法</strong></li></ul><p>注意：从官网下载安装包 <a href="https://pinyin.sogou.com/linux/?r=pinyin" target="_blank" rel="external nofollow noopener noreferrer">Linux_64-bit.deb.</a>，如果你用的是比较老的 Ubuntu 系统，请参照 <a href="https://pinyin.sogou.com/linux/help.php" target="_blank" rel="external nofollow noopener noreferrer">此页面</a> 进行安装。</p><ul><li><strong>安装 fcitx 并修改输入源为 SogouPinyin</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install fcitx</span><br><span class="line"></span><br><span class="line">然后打开 Settings</span><br><span class="line">    -&gt; manage installed language</span><br><span class="line">        -&gt; 修改 &#39;Input System&#39;(默认是IBus) 为 fcitx</span><br><span class="line">        -&gt; 然后点击 &#39;apply system-wild&#39;</span><br><span class="line">-&gt; 现在最好是重启一次，然后</span><br><span class="line">    -&gt; 在任务栏找到一个小键盘图标，</span><br><span class="line">        -&gt; 点击&#39;configure current input method&#39;</span><br><span class="line">            -&gt; 然后应该能发现搜狗输入法，还有些别的输入法</span><br><span class="line">                 我们可以删掉其余的输入法，只保留搜狗输入法和英文输出</span><br><span class="line">现在就完成全部输入法配置了，默认的切换键是 ‘单次Shift’</span><br></pre></td></tr></table></figure><p>注意：</p><p>以上三部分是不同的，请一步步来，并且在过程中如果没发现新增项，请尝试重启系统。有了中文支持，我们可以进一步对 Tweaks 进行配置。 （截图： <a href="http://i.imgur.com/l5sLZwZ.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/l5sLZwZ.png</a>）</p><h4 id="8-2-更改副屏分辨率"><a href="#8-2-更改副屏分辨率" class="headerlink" title="8.2 更改副屏分辨率"></a><strong>8.2 更改副屏分辨率</strong></h4><ul><li>连接你的副屏，我的副屏是2k屏，笔记本是1080的，所以输出分辨率最大只有1080，我们需要手动修改它；</li><li>新建个 sh 文件，里面包含重置分辨率的命令，这样只需要每次重启后设置自动执行，即可自动变为2k的输出。 下面需要做些准备工作来确定最后写入 sh 文件的三行命令的参数。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">首先是得到本机指定分辨率的渲染参数</span><br><span class="line"></span><br><span class="line">$ cvt 2560 1440</span><br><span class="line">&#x2F;&#x2F;下面的&quot;2560x1440_55.00&quot;就是从这里获得的</span><br><span class="line">$ xrandr -q</span><br><span class="line">&#x2F;&#x2F;这里查看副屏对应的显示器编号，下面的&quot;HDMI-1-2&quot;就是从这来的。 </span><br><span class="line"></span><br><span class="line">写入文件的三行：</span><br><span class="line"></span><br><span class="line">xrandr --newmode &quot;2560x1440_55.00&quot;  284.00  2560 2744 3016 3472  1440 1443 1448 1489 -hsync +vsync</span><br><span class="line">xrandr --addmode HDMI-1-2 &quot;2560x1440_55.00&quot;</span><br><span class="line">xrandr --output HDMI-1-2 --mode &quot;2560x1440_55.00&quot; --output eDP-1-1 --off</span><br></pre></td></tr></table></figure><ul><li>文件写好后，你可以手动去执行，当然如前所述，使之开机自动运行是最好的。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quick way :</span><br><span class="line">    -&gt; 将这三行命令放入 &#x2F;etc&#x2F;profile 文件内的最末尾；</span><br><span class="line">    -&gt; 重启后会发现可以自动得到 2k 的分辨率。</span><br></pre></td></tr></table></figure><p>注意：这样写的弊端在于，你必须保证2k副屏后再重启，如果你不用副屏了，你必须从 profile 里去掉这三行命令，否则会出错的。</p><h4 id="8-3-添加一些未适配的应用"><a href="#8-3-添加一些未适配的应用" class="headerlink" title="8.3 添加一些未适配的应用"></a><strong>8.3 添加一些未适配的应用</strong></h4><p>像是微信、QQ等聊天工具，或者红警等游戏，对于这些软件，默认是没有支持的，但仍然可以通过一些方法安装。</p><ul><li>方法一：在‘软件与更新’中安装 Wine，然后通过 Wine 来安装 Windows 应用。</li><li>方法二：安装安卓模拟器，通过模拟器来使用QQ等软件，这里我推荐 <a href="https://www.linzhuotech.com/index.php/home/index/download.html" target="_blank" rel="external nofollow noopener noreferrer">这个模拟器</a>，渲染速度和稳定性都还是不错的。（截图： <a href="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/Cache_32799f853a0e21fe..jpg" target="_blank" rel="external nofollow noopener noreferrer">img/Cache_32799f853a0e21fe..jpg</a>）</li><li><strong>方法三：墙裂推荐！</strong>这里直接下载封装了精简 Wine 环境的 QQ 软件包，即可以使用QQ，无需多余安装 Wine 也无需其他预先配置，只需要下载对应的 AppImage 文件，然后启动即可使用！</li></ul><p>方法三步骤：（<a href="https://github.com/askme765cs/Wine-QQ-TIM" target="_blank" rel="external nofollow noopener noreferrer">Github地址</a>）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;首先去release下载文件</span><br><span class="line"></span><br><span class="line">$ chmod a+x TIM-x86_64.AppImage</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;通过命令直接启动</span><br><span class="line">$ .&#x2F;TIM-x86_64.AppImage.AppImage</span><br></pre></td></tr></table></figure><p>注意，尽量选择TIM，QQ在我机器上测试发现有点问题。</p><p>如果你想通过图标点击来启动之，那么可以自己新建一个图标文件来完成，然后将此图标文件放到<code>~/.local/share/applications</code>，之后，在系统软件搜索界面你就能搜到你刚才添加的图标了（也就是个应用启动器），如果你想把它放到桌面，只需要将其复制到桌面，双击一下（选信任并启动）就行了。下面是制作 QQ 图标的步骤：</p><p>首先，获取图片（qq.png）然后创建 desktop 图标文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;TianZonglin&#x2F;tuchuang&#x2F;img&#x2F;qq.png</span><br><span class="line">$ vim QQ.desktop</span><br></pre></td></tr></table></figure><p>然后，复制并保存以下内容到你的图标文件中，注意修改路径。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Name&#x3D;QQ</span><br><span class="line">Exec&#x3D;&#x2F;home&#x2F;tzloop&#x2F;Downloads&#x2F;TIM-x86_64.AppImage</span><br><span class="line">Icon&#x3D;&#x2F;home&#x2F;tzloop&#x2F;Downloads&#x2F;qq.png</span><br><span class="line">Type&#x3D;Application</span><br><span class="line">StartupNotify&#x3D;true</span><br></pre></td></tr></table></figure><p>然后右键这个文件，在权限页面，勾选“允许作为应用执行”，最后将这个图标文件复制到指定路径。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp &#x2F;home&#x2F;tzloop&#x2F;Downloads&#x2F;QQ.desktop ~&#x2F;.local&#x2F;share&#x2F;applications</span><br></pre></td></tr></table></figure><h4 id="8-4-Tweaks的一些不重要的美化设置"><a href="#8-4-Tweaks的一些不重要的美化设置" class="headerlink" title="8.4 Tweaks的一些不重要的美化设置"></a><strong>8.4 Tweaks的一些不重要的美化设置</strong></h4><ul><li>主题 -&gt;  Adwaita-dark</li><li>指针 -&gt; Adwaita-default</li></ul><p>字体设置，默认的字体及大小为 <code>Ubuntu/11, Ubuntu Regular/11, Sans Regular/11, Ubuntu Mono Regular/13</code><br>这里我把前三项设置为了 <code>Ubuntu Medium</code> 字号不变，然后把整体的 <code>zoom ratio</code> 设置为了 1.3.</p><h4 id="8-5-其他实用的配置及软件"><a href="#8-5-其他实用的配置及软件" class="headerlink" title="8.5 其他实用的配置及软件"></a><strong>8.5 其他实用的配置及软件</strong></h4><h5 id="8-5-1-屏幕亮度控制"><a href="#8-5-1-屏幕亮度控制" class="headerlink" title="8.5.1 屏幕亮度控制"></a><strong>8.5.1 屏幕亮度控制</strong></h5><p>我使用 RedShift 软件来控制，相同的软件还有很多，像是 F.lux 等等也是很棒的。安装 RedShift 的步骤：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-&gt; install it with &#96;sudo apt-get install redshift-gtk&#96;, gtk means visual version.</span><br><span class="line">-&gt; open location service: Settings -&gt; Privacy -&gt; Location service -&gt; open. (this step is ESSENTIAL)</span><br><span class="line">-&gt; open redshift, if you can&#39;t find the icon, just search it in &#39;applications&#39;.</span><br><span class="line">-&gt; then, brightness will be changed</span><br><span class="line">-&gt; finally, with its menu, you can set it open with your system.</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h5 id="8-5-2-Vscode配置"><a href="#8-5-2-Vscode配置" class="headerlink" title="8.5.2 Vscode配置"></a><strong>8.5.2 Vscode配置</strong></h5><p><strong>@主题</strong></p><p> <code>File -&gt; Preferences -&gt; Color Theme</code>，我选择暗蓝色的 <code>Tomorrow Night Blue</code> 主题。</p><p><strong>@字体</strong></p><p> <code>File -&gt; Preferences -&gt; Settings</code>，通过<code>search</code> （搜索 <code>font</code>）来定位。我推荐直接用JSON进行编辑，编辑内容如下： </p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;terminal.integrated.fontFamily&quot;: &quot;monospace&quot;,</span><br><span class="line">    &quot;editor.fontWeight&quot;: &quot;600&quot;,</span><br><span class="line">    &quot;editor.fontFamily&quot;: &quot;monospace&quot;,</span><br><span class="line">    &quot;editor.fontSize&quot;: 15.5,</span><br><span class="line">    &quot;terminal.integrated.fontSize&quot;: 12,</span><br><span class="line">    &quot;workbench.colorTheme&quot;: &quot;Tomorrow Night Blue&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">以上组合在我的2K高分屏上工作的很好，推荐使用。</span><br></pre></td></tr></table></figure><p>如果你想让你的编码字体和 Windows 上的VSCode字体一致，那么你得首先安装 Windows 使用的字体，安装字体的步骤如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ wget https:&#x2F;&#x2F;down.gloriousdays.pw&#x2F;Fonts&#x2F;Consolas.zip</span><br><span class="line">$ unzip Consolas.zip</span><br><span class="line">$ sudo mkdir -p &#x2F;usr&#x2F;share&#x2F;fonts&#x2F;consolas</span><br><span class="line">$ sudo cp consola*.ttf &#x2F;usr&#x2F;share&#x2F;fonts&#x2F;consolas&#x2F;</span><br><span class="line">$ sudo chmod 644 &#x2F;usr&#x2F;share&#x2F;fonts&#x2F;consolas&#x2F;consola*.ttf</span><br><span class="line">$ cd &#x2F;usr&#x2F;share&#x2F;fonts&#x2F;consolas</span><br><span class="line">$ sudo mkfontscale &amp;&amp; sudo mkfontdir &amp;&amp; sudo fc-cache -fv</span><br><span class="line">&#x2F;&#x2F;check the installed fonts</span><br><span class="line">$ fc-list</span><br></pre></td></tr></table></figure><p><strong>@终端的位置</strong></p><p>在设置中搜索 <code>location</code>，找到 <code>Workbench › Panel: Default Location</code> ，将其修改为 Right，因为我想让代码区有更高的视野，同时代码也不会很长也就是不需要很大的宽度，即右侧部分可以来放置终端。</p><p><strong>@在左侧文件树视图内文件的排序规则</strong></p><p>在设置中搜索 <code>explorer.sortOrder</code>，并将其设置为按 <code>type</code> 排序，这对于混杂不同类型文件的项目来说很方便，相同种类的文件被放在一起。</p><p>最后修改完配置的Vscode截图长这样：<a href="http://i.imgur.com/g7OehEL.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/g7OehEL.png</a>。</p><h5 id="8-5-3-picgo"><a href="#8-5-3-picgo" class="headerlink" title="8.5.3 picgo"></a><strong>8.5.3 picgo</strong></h5><p>如果你希望方便的上传、分享你的截图或图片，那么一定要试试 PicGo，其在 Ubuntu 上的安装使用和之前的 TIM.AppImage 非常类似，具体如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">首先获得图标 picgo.png 并创建你的图标文件</span><br><span class="line"></span><br><span class="line">$ wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;TianZonglin&#x2F;tuchuang&#x2F;master&#x2F;img&#x2F;opic.png</span><br><span class="line">$ vim QQ.desktop</span><br><span class="line"></span><br><span class="line">然后复制以下内容到图标文件内，改成你的路径。</span><br><span class="line"></span><br><span class="line">[Desktop Entry]</span><br><span class="line">Name&#x3D;PicGO</span><br><span class="line">Exec&#x3D;&#x2F;home&#x2F;tzloop&#x2F;Downloads&#x2F;PicGo.AppImage</span><br><span class="line">Icon&#x3D;&#x2F;home&#x2F;tzloop&#x2F;Downloads&#x2F;opic.png</span><br><span class="line">Type&#x3D;Application</span><br><span class="line">StartupNotify&#x3D;true</span><br><span class="line"></span><br><span class="line">然后右键-&gt;权限页-&gt;允许作为应用执行</span><br><span class="line">最后复制到所需要的路径中</span><br></pre></td></tr></table></figure><p>如果你想直接上传你剪切板内的图片，那么在Ubuntu上你还需要安装个软件，通过 <code>sudo apt install xclip</code> 直接安装即可，下面是 PicGo 配置 Github 图床的步骤：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repository name -&gt; GITHUBACCOUNT&#x2F;tuchuang</span><br><span class="line">branch name -&gt; master</span><br><span class="line">token -&gt; get a new one from Github (Settings -&gt; Developer Settings -&gt; Personal access tokens)</span><br><span class="line">storage path -&gt; img&#x2F;</span><br><span class="line">custom domain name -&gt; https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;GITHUBACCOUNT&#x2F;tuchuang</span><br></pre></td></tr></table></figure><h5 id="8-5-4-安装并配置-git"><a href="#8-5-4-安装并配置-git" class="headerlink" title="8.5.4 安装并配置 git"></a><strong>8.5.4 安装并配置 git</strong></h5><ul><li><strong>settings</strong></li></ul><p>安装非常简单，直接用 <code>sudo apt install git</code> 进行安装，然后配合 Github，接下来设置免密。注意：Github只是一种 git server，其他的诸如 gitlab 等同理。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;YOUREMAIL&quot;</span><br><span class="line">$ vim ~&#x2F;.ssh&#x2F;id_rsa.pub</span><br></pre></td></tr></table></figure><p>然后去 Github -&gt; Settings -&gt; SSH and GPG keys -&gt; New SSH key，然后把 rsa.pub 的内容拷贝到 key 这里。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;YOURUSERNAME&quot;</span><br><span class="line">$ git config --global user.email &quot;YOUREMAIL&quot;</span><br></pre></td></tr></table></figure><p>至此，我们已完成免密设置，之后我们提交代码就不用进行账号验证了。（这只是ssh方式，https需要额外的设置）</p><ul><li><strong>同步代码的案例（我的方法）</strong> </li></ul><p>在 Github 新建一个仓库并命名为你项目名称，然后通过 <code>git clone git@xx.git</code> 将此空项目克隆到你的电脑，最后，将原项目的内容全部移动到此空文件夹内，然后执行以下语句，即可完成第一次提交。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add -A</span><br><span class="line">git commit -m &quot;&#96;date +%Y-%m-%d,%H:%m&#96;&quot; </span><br><span class="line">git push -u origin master -f</span><br></pre></td></tr></table></figure><p>现在你的代码应该已经可以在 Github 上可见了，如果你想控制提交的部分，你还需要修改/创建 <code>.gitignore</code> 文件。</p><p>我通常将其放在 sh 文件内，并在文件内的第一行添加 <code>#!/bin/sh</code>，这样就可以通过一行命令直接运行这三行命令，当然如果你想自动地、周期性的备份你的代码，你可以用 <code>crontab</code> 来将这个 sh 设置为周期性执行，这样你就无需手动备份啦！ </p><h5 id="8-5-5-远程桌面软件"><a href="#8-5-5-远程桌面软件" class="headerlink" title="8.5.5 远程桌面软件"></a><strong>8.5.5 远程桌面软件</strong></h5><p>对于Ubuntu用户来说，好的远程桌面软件也是十分重要的，这里我强烈推荐 AnyDesk，这是个非常轻量。易安装的远程桌面软件，没有 Vnc 那种额外的设置，只需要下载、安装，即可使用。</p><p>使用 Anydesk 首先要去官网（<a href="https://anydesk.com/zhs/downloads/linux" target="_blank" rel="external nofollow noopener noreferrer">here</a> ）下载 ，之后安装之，安装后即可使用。</p><h3 id="X-Ubuntu使用注意事项"><a href="#X-Ubuntu使用注意事项" class="headerlink" title="X. Ubuntu使用注意事项"></a><strong>X. Ubuntu使用注意事项</strong></h3><h4 id="X-1-对于更新"><a href="#X-1-对于更新" class="headerlink" title="X.1 对于更新"></a><strong>X.1 对于更新</strong></h4><p>在安装完所有驱动软件环境之后，尽量不进行系统更新，或者推迟它，不要尝试在设置中停止更新，因为我没找到，而且实际上我把软件更新给停了，给我造成好大不便，所以只需要记住关掉每次的更新弹窗即可。（不要动截图这里的东西：<a href="http://i.imgur.com/w7Kvc7X.png" target="_blank" rel="external nofollow noopener noreferrer">http://i.imgur.com/w7Kvc7X.png</a>）</p><h4 id="X-2-对于死机"><a href="#X-2-对于死机" class="headerlink" title="X.2 对于死机"></a><strong>X.2 对于死机</strong></h4><p>对 Ubuntu 来说，死机更多时候是桌面卡死，也就是假死，系统并没有死机，tty仍然可以进入，这时候<strong>切记不要</strong>断电重启，这种硬重启会给内核带来不明影响，说不定这样之后你系统就启动不了啦！</p><p>正确的方法是：<code>Ctrl+Alt+F2/3/4</code>，进入 <code>tty2/3/4</code>，然后 <code>restart gdm/lightdm</code>，或者你如果记得你先前的错误操作，那么在此处回滚即可，亦或是等着什么也不做，有些情况下系统会在一段时间后从死机中恢复的。</p><!--[**中 文 版 本**](https://www.cxmoe.com/article/483a.html) -->]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu </tag>
            
            <tag> 显卡 </tag>
            
            <tag> CUDA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十分钟搭建自己的Q&amp;A问答社区</title>
      <link href="/article/614d.html"/>
      <url>/article/614d.html</url>
      
        <content type="html"><![CDATA[<p>开源问答社区一直是一种社区形式，而且已经形成了诸如 Stack Overflow 和国内 SegmentFault 等一众问答社区。这些问答型社区的初衷都是旨在围绕特定的主题（编程）来对相关知识进行发问和探讨，区别于 Quarta 和知乎这类问答，其目标更明确，答案更清晰，整体上更像一个特定的知识库，通过问题来了解某一特定领域我认为也是个不错的选择。那么现在，围绕前段时间的CSC申请，在专栏已经积累了大量问答的材料，已经有必要专为其构建一个清晰、可用的问答自主系统了，<strong>Question2Answer</strong> 无疑对此非常合适！</p><a id="more"></a><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200627232744.png"></fancybox><p>注意：类似的框架/网站，还有不少，选择 Q2A 的主要原因还是因为它的易用性，搭建下来确实是非常的简单。</p><h3 id="安装教程"><a href="#安装教程" class="headerlink" title="安装教程"></a><strong>安装教程</strong></h3><p>安装 Question2Answer 系统是非常非常简单（dead easy）的，官方教程比较啰嗦，这里直接总结干货。</p><h4 id="环境需求"><a href="#环境需求" class="headerlink" title="环境需求"></a><strong>环境需求</strong></h4><p>首先选择自己的 Server，这里直接以 Apache 为例；然后还需要 PHP 和 Mysql，相关的软件环境版本的要求如下。更具体来说，直接安装 phpstudy（6.5以上版本均可）就完事儿了，全都是符合要求的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Apache or Nginx 无版本要求</span><br><span class="line">PHP &gt;&#x3D; 5.2 需要带MySQLi扩展（默认不用管）</span><br><span class="line">MySQL &gt;&#x3D; 5.x</span><br></pre></td></tr></table></figure><p>安装完 phpstudy 后，启动 Apache+Mysql，然后用其自带的 mysql-front 工具打开数据库，创建一个数据库，或者选择一个默认的数据库也可以，设置用户名密码（如果你需要密码），到此基本就完成配置了，后面需要给其提供数据库地址（localhost）、登录用户名、登录密码、数据库名称，即可。</p><h4 id="下载Q2A文件"><a href="#下载Q2A文件" class="headerlink" title="下载Q2A文件"></a><strong>下载Q2A文件</strong></h4><p>首先，去其Github的release下载最新版本，<a href>点击前往</a>。下载之后，将这个压缩包解压，然后全部放入 Apache 的网站根目录（WWW目录）。注意，在此处需要修改两个文件，<code>qa-config-example.php</code> 和 <code>.htaccess-example</code>，分别修改成 <code>qa-config.php</code> 和 <code>.htaccess</code>，对于后着可能会出现无法修改文件名的问题，自己想办法吧哈。（至此就能访问了，但我们还要引入一个中文包）</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200627230727.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>然后，在 <a href="https://github.com/yinhongbo/q2a-lang-cn/archive/master.zip" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 下载其中文语言包。将解压出的语言文件（就一个zh文件夹），放入 WWW 目录下的 qa-lang 文件夹，和初始的英语语言文件夹并列。到此就结束了，后面在网页上可以自动识别并加载语言包。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200627230841.png"></fancybox><p>最后，打开浏览器，访问 localhost:80 可以看到一个初始页面，上面有个 <code>很长的按钮</code>（初始化的按钮），点击一下稍作配置（设置超级管理员、语言）即可进入 Q2A 系统。</p><h4 id="修改系统的配置项"><a href="#修改系统的配置项" class="headerlink" title="修改系统的配置项"></a><strong>修改系统的配置项</strong></h4><p>初始系统的主题叫 SnowFlat，样子还是不错的，整体的论坛功能分区也很简单，所有的操作都集中在顶栏，点击其中的管理，进入配置页面，在此页面的内页顶栏又分了许多子项（大概十几项）。没必要每个都拿出胡来说一遍，如果你正确的配置了中文环境，</p><p>那么其实每一页的功能就很明了了，你需要做的就是阅读每一页，并且尝试修改这些功能，然后查看效果（都是修改提交后即可生效的）。</p><p>在我这段时间的使用过程中，觉得主要的修改集中在以下几个方面：</p><ul><li>普通：主体配置。</li><li>布局：修改各位置的html内容。</li><li>列表：关于显示条数。</li><li>权限：关于提问或者回答问题。</li><li>页面：关于导航栏的显示。</li><li>插件：开启标签云、快速提问等。</li></ul><p>再次强调，都是很简单的配置项，基本上自己尝试一遍就可以迅速的把相关内容修改到理想的状态了，多试试就OK啦。</p><h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a><strong>最终效果</strong></h3><p>演示地址（临时）：<a href="http://150.158.118.199/csc/" target="_blank" rel="external nofollow noopener noreferrer">点击前往</a></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200627234122.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 建站 </tag>
            
            <tag> 教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>体验1Gbps的上下行对等网络</title>
      <link href="/article/cbd8.html"/>
      <url>/article/cbd8.html</url>
      
        <content type="html"><![CDATA[<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200627002026.png"></fancybox><p>由于新冠疫情的消退，关闭了许久的校园终于开始逐步开放，又坐回熟悉的位子，打开熟悉的电脑，一顿操作后一切如旧。也许是我心血来潮，毫无征兆的就想测一下网速，不测不知道，一测吓一跳，阔别了几个月的网络，今天一测居然达到了<strong>1Gbps（1000Mbps）</strong>，而且还是上下行对等！瞬间惊掉了我的下巴…在此简单记录一下初次开车上高速的心情。</p><a id="more"></a><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>曾几何时，百兆光纤还是写在网吧门口的标语，作为重大卖点吸引顾客。而现在，百兆（100Mbps）网络早已飞入寻常百姓家，据我所知，下到城镇上至城市，200M光纤、500M光纤已成为大家的普遍选择。需要注意的是，这里的百兆，通通指的是下行带宽，对于上行带宽，不论国内还是国外，通常只有下行的十分之一，上下行对等网络由于费用问题，一般难以推广。随着5G时代的到来，越来越多的国内运营商开始吹捧1Gbps的超大网络带宽，但以目前能检索到的资讯来看，即便是目前试行的标称1Gbps的网络，速度往往也只有600-800Mbps，水分还是存在的。</p><p>那么，我们学校现在的网络到底是怎么回事儿呢？从原来的中等生一跃成为尖子生，到底发生了什么，我也不知道，<strong>或许是整合了华为的5G？</strong>这谁又知道呢。</p><h3 id="1Gbps初体验"><a href="#1Gbps初体验" class="headerlink" title="1Gbps初体验"></a>1Gbps初体验</h3><p>话不多说了，开车，看一下风景！</p><h4 id="一般的网络资源下载"><a href="#一般的网络资源下载" class="headerlink" title="一般的网络资源下载"></a>一般的网络资源下载</h4><p>如我所预料，看到这个<strong>106M/s</strong>的下载速度，心简直要飞出来了，活这么大还没体验过这下载速度噢。。这瞬间让我有点期待5G的来临了，虽然我不知道这个速度是不是5G来的。。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200626234707.png"></fancybox><h4 id="YouTube-8K-60FPS"><a href="#YouTube-8K-60FPS" class="headerlink" title="YouTube 8K 60FPS"></a>YouTube 8K 60FPS</h4><p>连接速度居然达到了惊人的<strong>41万kbps</strong>，要知道普通的海外百兆（100）带宽的连接速度也只有十几万，国内翻Q发烧友们看YouTube的发烧水准也只停留在20万，因为二十万左右8K视频就可以流畅（Buffer Health，超前缓冲）观看了。私以为这个速度还可以更快更恐怖，只不过我找不到合适的测试视频了，汗颜。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/W@N48_G1TCV}ZKP}R({@B77.png"></fancybox><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="更新LOL客户端"><a href="#更新LOL客户端" class="headerlink" title="更新LOL客户端"></a>更新LOL客户端</h4><p>几个月没有打开的LOL，打开之后没注意的功夫，已经进入主界面了，真的是一种毫无迟滞感的体验。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/3AHBL}79)7PE0RZP9_5Y4`V.png"></fancybox><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>不得不说，网络速度是这个网络时代影响人们体验网络的最最重要的因素之一，通过我的使用经历，我只能说网速的提升确实可以给我带来不一样的体验：</p><ul><li>想到、找到，即可以下载到；</li><li>想到、上传，即可以云端看到。</li></ul><p>这是从百兆到千兆的跳跃，也是改变人们网络使用习惯的一个转折，或许在可预见的未来，网速已失去其标量意义，超大带宽让人们忽略传输时间，那种生活的方方面面或许我们还不能够想象，但可以肯定的是，它正在向我们走来。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 联网 </tag>
            
            <tag> 初体验 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将群晖相册嵌入到Hexo博客中</title>
      <link href="/article/1c44.html"/>
      <url>/article/1c44.html</url>
      
        <content type="html"><![CDATA[<p>如何高效便捷的在博客中更新自己的动态是困扰很多人的问题，简单的方案就是另起炉灶在博客重新发布一份，但这种方法耗时耗力，因此不建议这样做。从原po平台同步到博客的某个位置应该是最理想的解决方案。对于照片来说，群晖的相册给我提供了一个来源库，那么如果我想让访客浏览我的近照，那么如何把照片从群晖相册同步到博客中就成了实现这一想法的核心问题。</p><a id="more"></a><br> <style>    iframe{        pointer-events: none;    }</style>  <script type="text/javascript">    function changeFrameHeight(){      var iframe= document.getElementById("myiframe");      var wid = document.getElementById('father').clientWidth;      if (wid>900) iframe.height = wid/2.19;      else if (wid>551) iframe.height = wid/2.21;      else if (wid>470) iframe.height = wid/2.165;      else iframe.height = wid/2.26;    }    function changeFrameHeight2(){      var iframe= document.getElementById("myiframe2");      var wid = document.getElementById('father').clientWidth;      if (wid>900) iframe.height = wid/1.59;      else if (wid>551) iframe.height = wid/2.01;      else if (wid>470) iframe.height = wid/1.965;      else iframe.height = wid/2.06;    }    window.οnresize=function(){      changeFrameHeight();      changeFrameHeight2();    }  </script><div style="background-color: rgb(0, 0, 0);padding-top: 7px;" id="father"><iframe width="100%" id="myiframe" frameborder="0" onload="changeFrameHeight()" src="https://nas.cz5h.com:5443/photo/embed/embed.html?album=album_5745425f414c42554d&autoplay=1&lightbox=1" photostation></iframe><!--<iframe width="100%" id="myiframe2" frameborder="0" onload="changeFrameHeight2()" src="https://nas.cz5h.com:5443/photo/embed/embed.html?album=album_e5a381e7bab8&autoplay=1" photostation></iframe>--></div><br><p><strong>拍摄设备：</strong>HUAWEI P30<br><strong>同步来源：</strong>群晖 <a href="https://nas.cz5h.com:5443/photo/#!Albums/album_5745425f414c42554d" target="_blank" rel="external nofollow noopener noreferrer">PhotoStation Album</a><br><strong>扩展详情：</strong>关于如何放置在主页，详见 <a href="/links/logs.html">更新日志</a></p><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>可以查证的、群晖官方提供的嵌入相册的方法，主要就是使用<code>iframe</code>进行嵌入。注意这里说的群晖相册，特指 <strong>Photo Station</strong>，而不是Moments等套件、在使用 Photo Station 的过程中，比较好的地方在于照片的地图模式、缩略图加载速度以及丰富的配置设置项。Moments我没有用过，但由于其关联套件太多，所以不在我的考虑范围之内，要知道我是个连Drive都不用的群晖用户。</p><p>采用<code>iframe</code>嵌入的另一个好处是，异步加载，基本对原站加载速度没什么影响。</p><h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="iframe的大小自适应"><a href="#iframe的大小自适应" class="headerlink" title="iframe的大小自适应"></a>iframe的大小自适应</h4><p>这是个老生常谈的问题，但其实每次遇到其详细情况又都不尽相同，这里使用日常解决方案：JS控制。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">changeFrameHeight</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> iframe= <span class="built_in">document</span>.getElementById(<span class="string">"myiframe"</span>);</span><br><span class="line">    <span class="keyword">var</span> wid = <span class="built_in">document</span>.getElementById(<span class="string">'father'</span>).clientWidth;</span><br><span class="line">    <span class="keyword">if</span> (wid&gt;<span class="number">900</span>) iframe.height = wid/<span class="number">2.19</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (wid&gt;<span class="number">551</span>) iframe.height = wid/<span class="number">2.21</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (wid&gt;<span class="number">470</span>) iframe.height = wid/<span class="number">2.165</span>;</span><br><span class="line">    <span class="keyword">else</span> iframe.height = wid/<span class="number">2.26</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;div style="background-color: rgb(0, 0, 0);padding-top: 7px;" id="father"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;iframe width="100%" id="myiframe" frameborder="0" onload="changeFrameHeight()" </span></span><br><span class="line"><span class="regexp">    src="https:/</span><span class="regexp">/nas.cz5h.com:5443/</span>photo/embed/embed.html?album=album_5745425f414c42554d&amp;autoplay=<span class="number">1</span>&amp;lightbox=<span class="number">1</span><span class="string">" photostation&gt;</span></span><br><span class="line"><span class="string">  &lt;/iframe&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure><p>巧妙之处在于包裹在iframe之上的div，正式利用这个父级div标签来获得iframe可以“撑起来”的最大宽度，如果直接拿原主题文件的类去获取宽度，那需要复杂的选择器实现。</p><p>得到父级标签的宽度之后就很容易通过当前宽度来配置iframe的高度了（宽度就是div的宽度）。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="嵌入的链接为http而被禁止"><a href="#嵌入的链接为http而被禁止" class="headerlink" title="嵌入的链接为http而被禁止"></a>嵌入的链接为http而被禁止</h4><blockquote><p><code>Mixed Content: The page at &#39;https://www.cxmoe.com/&#39; was loaded over HTTPS, but requested an insecure frame &#39;http://asus.myds.me:5080/photo/embed/embed.html?album=album_5745425f414c42554d&amp;autoplay=1&amp;lightbox=1&#39;. This request has been blocked; the content must be served over HTTPS.</code></p></blockquote><p>这也是个令人头痛的问题，基本上如果Server不是自己手写的代码，那就没法解决，只能换用https的安全链接。为此，我终于在群晖上把https的证书搞好了（之前一直拖着没弄）。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621161332.png" alt></p><p>之后通过https访问5001是可以了，但群晖相册却怎么也打不开了，在经过了一大堆尝试（端口映射、相册设置等等）之后，终于解决了这个问题。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621162243.png" alt></p><p>需要注意的是，群晖的相册默认是使用80端口，在内网是直接以  的形式访问，当然如果在外网，需要配置一个端口映射到80，在http时代，我使用5080-&gt;80，即访问地址是：<a href="http://nas.cz5h.com:5080/photo/#Albums" target="_blank" rel="external nofollow noopener noreferrer">http://nas.cz5h.com:5080/photo/#Albums</a></p><p>在https时代，相应的，应该再用一个端口映射到443（！非常重要），也就是这里的5443-&gt;443，之后访问地址应该是:<a href="https://nas.cz5h.com:5443/photo/#Albums" target="_blank" rel="external nofollow noopener noreferrer">https://nas.cz5h.com:5443/photo/#Albums</a></p><p>至此，iframe采用新的https链接，问题解决。</p><h4 id="群晖相册的灯箱模式失效"><a href="#群晖相册的灯箱模式失效" class="headerlink" title="群晖相册的灯箱模式失效"></a>群晖相册的灯箱模式失效</h4><p>经验证，引入如下的JavaScript源是会出现错误的，而且导致允许连接到群晖相册和单机进入灯箱模式的失效，解决方法就是简单地取消第一、三项的勾选，只保留基本的幻灯片模式。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621162942.png" alt></p><h3 id="其他可能的引入方法"><a href="#其他可能的引入方法" class="headerlink" title="其他可能的引入方法"></a>其他可能的引入方法</h3><h4 id="RSS订阅"><a href="#RSS订阅" class="headerlink" title="RSS订阅"></a>RSS订阅</h4><p>这是一个比较通用的解决方案，缺点是好像群晖相册的RSS源只包含了有限张照片，并没有将同一相册的全部照片都涵盖其中，亟待寻求解决方案。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621164917.png"></fancybox><p>如果一切正常的话，通过RSS解析到图片，然后再通过自己的想法构造页面就可以了，这种方法是最贴合的嵌入方式，但暂时还不知道如何获得包含全部图片的订阅源。</p><h4 id="待补充"><a href="#待补充" class="headerlink" title="待补充"></a>待补充</h4><p>…</p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>我已经将群晖相册做了整理并公开了部分相册，欢迎访问直接访问我的群晖相册。<br><a href="http://nas.cz5h.com:5080/photo/#Albums/album_5745425f414c42554d" target="_blank" rel="external nofollow noopener noreferrer">http://nas.cz5h.com:5080/photo/#Albums</a></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621163923.png"></fancybox><p>群晖相册点开图片后还可以<strong>留言</strong>，简直不要太方便！<br>另外，PhotoStation还允许你批量添加（显示层面的）自定义水印！</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621164216.png"></fancybox>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 插件 </tag>
            
            <tag> 群晖 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用R语言转存Excel到MySQL</title>
      <link href="/article/528.html"/>
      <url>/article/528.html</url>
      
        <content type="html"><![CDATA[<p>花了两天时间写了一个Excel数据转换脚本，原需求除了要把数据转存到Mysql中，还要对每一条数据进行拆分和重组，并不容易。最终我利用R语言完成了这个小需求，本着总结学习的想法，在此处将多余逻辑删除，抽离出了最基本的Excel转存Mysql的功能，这样也可以算一个小轮子了。（仅做学习用，Navicat等工具可以直接导入Excel）</p><a id="more"></a><p><strong>本项目已开源至Github，地址：</strong><a href="https://github.com/TianZonglin/transferExcelbyR" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/TianZonglin/transferExcelbyR</a></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621141106.png"></fancybox><h3 id="适用场景和使用要求（暂）"><a href="#适用场景和使用要求（暂）" class="headerlink" title="适用场景和使用要求（暂）"></a>适用场景和使用要求（暂）</h3><ul><li>需要处理的表文件以文件夹形式存储</li><li>全部的数据表均必须包含相同的列格式，切忌无关表的污染</li><li>每个表文件中只有一个Sheet</li><li>数据表必须在第三级目录（单文件亦是如此），例如</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ecProject\io_Input_Excel_Folder\simples\ORGDATA.XLS</span><br><span class="line"># 分别是：工作目录 -&gt; 输入文件夹(1st) -&gt; 内部自定义的文件夹(2nd) -&gt; 真正的表文件(3rd)</span><br></pre></td></tr></table></figure><h3 id="此脚本的特点"><a href="#此脚本的特点" class="headerlink" title="此脚本的特点"></a>此脚本的特点</h3><ul><li>批量处理全部输入文件夹下二级文件夹的全部Excel表文件</li><li>自动根据所需要转换的Excel表文件在Mysql中创建表</li><li>自动检测Excel表文件的数据边界</li><li>详细的debug统计信息</li><li>合并全部Excel表文件到单一的Mysql数据表</li><li>默认不需要对数据库进行操作</li></ul><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="使用对象"><a href="#使用对象" class="headerlink" title="使用对象"></a>使用对象</h4><p><strong>tool_excel2mysql.R</strong>，这是通用的转换工具，其他脚本面向特殊的需求。推荐使用** R Studio **运行此代码。</p><h4 id="所需要的软件和开发环境"><a href="#所需要的软件和开发环境" class="headerlink" title="所需要的软件和开发环境"></a>所需要的软件和开发环境</h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621115758.png"></fancybox><p>即需要Mysql的环境+Mysql的可视化工具+R环境+R可视化开发工具，上述所有软件均可在网上找到。</p><p><strong>注意：更新使用 Navicat 11 premium，原版本太过老旧。百度网盘：<a href="https://pan.baidu.com/s/18zg6NNogRVRHHD-fEj9UCg" target="_blank" rel="external nofollow noopener noreferrer">https://pan.baidu.com/s/18zg6NNogRVRHHD-fEj9UCg</a>  提取码：cbkj</strong></p><h4 id="安装所需要的程序包"><a href="#安装所需要的程序包" class="headerlink" title="安装所需要的程序包"></a>安装所需要的程序包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 注意这部分仅运行一次即可</span><br><span class="line"># near line 8</span><br><span class="line">#install.packages(&quot;RMySQL&quot;)</span><br><span class="line">#install.packages(&quot;stringr&quot;)</span><br><span class="line">#install.packages(&quot;readxl&quot;)</span><br><span class="line">#install.packages(&quot;readr&quot;)</span><br></pre></td></tr></table></figure><h4 id="修改工作路径"><a href="#修改工作路径" class="headerlink" title="修改工作路径"></a>修改工作路径</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># near line 14</span><br><span class="line">setwd(&quot;C:\\Users\\zonglin\\OneDrive - Universiteit Utrecht\\Desktop\\ecProject\\&quot;)</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="修改Mysql配置"><a href="#修改Mysql配置" class="headerlink" title="修改Mysql配置"></a>修改Mysql配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 默认数据库名称: test</span><br><span class="line"># near line 17</span><br><span class="line">conn &#x3D; dbConnect(MySQL(), user &#x3D; &#39;root&#39;, password &#x3D; &#39;root&#39;, dbname &#x3D; &#39;test&#39;,host &#x3D; &#39;localhost&#39;)</span><br><span class="line"></span><br><span class="line"># 默认生成的表名称: tb_from_excel</span><br><span class="line"># 如果需要修改，可以直接在代码中全局替换这个字段</span><br><span class="line"># use editor&#39;s find&#x2F;replace function to replace it all.</span><br></pre></td></tr></table></figure><h4 id="选择合适的起始列"><a href="#选择合适的起始列" class="headerlink" title="选择合适的起始列"></a>选择合适的起始列</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 默认起始列数: 1</span><br><span class="line"># 可以自由设置转存的起始列</span><br><span class="line"># near line 222</span><br><span class="line">tmp &#x3D; transExcel2MysqlDB(tmpPath, cnt, startmark &#x3D; 1)</span><br></pre></td></tr></table></figure><h4 id="设置仅测试部分数据"><a href="#设置仅测试部分数据" class="headerlink" title="设置仅测试部分数据"></a>设置仅测试部分数据</h4><p>如果你有大量的Excel文件，且你只想测试此代码或使用日志中的<code>errinfo with finally</code>来捕获Excel的调试信息（可以打开或打不开），则可以修改以下部分。 其只加载有限的表数据。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># near line 85</span><br><span class="line">edata &lt;- edata[30:35,]</span><br></pre></td></tr></table></figure><h3 id="日志-processRecord-csv"><a href="#日志-processRecord-csv" class="headerlink" title="日志 (processRecord.csv)"></a>日志 (processRecord.csv)</h3><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621113612.png"></fancybox><h4 id="errinfo-with-summary"><a href="#errinfo-with-summary" class="headerlink" title="errinfo with summary"></a>errinfo with summary</h4><p>这是插入SQL失败的记录。如果使用文件夹包含多个Excel，则每个Excel都可以输出单独的<code>errinfo with summary</code>。 使用此缓存信息，我们可以在Navicat的帮助下自动的找到错误的sql位置。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200621114705.png"></fancybox><p>然后你可以修改 <code>tool_excel2mysql</code> 的代码内容来修复或者直接给我相关反馈。 </p><h4 id="errinfo-with-finally"><a href="#errinfo-with-finally" class="headerlink" title="errinfo with finally"></a>errinfo with finally</h4><p>这部分是全局信息，包含无法读取的Excel表信息和最终的统计数据。 如果此处显示了某个excel，那你需要手动检查此文件以查找真正的问题。 有时重新保存（打开然后保存）就可以解决不能读取的问题。</p><p>基本上来说，该工具可以顺利地将数据从我的xls、xlsx文件转存到mysql，并且成功率几乎达到100％。 （上面的截图是为了演示errinfo的例子）</p><hr><p><a href="https://github.com/TianZonglin/transferExcelbyR/blob/master/README.md" target="_blank" rel="external nofollow noopener noreferrer">English Version</a></p><hr><p><strong>赶紧使用一下吧…</strong></p>]]></content>
      
      
      <categories>
          
          <category> ML/R学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R语言 </tag>
            
            <tag> SQL插入 </tag>
            
            <tag> 数据处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>那些年令人记忆深刻的电视剧</title>
      <link href="/article/d24e.html"/>
      <url>/article/d24e.html</url>
      
        <content type="html"><![CDATA[<p>二十年不长不短，刚好积攒一点人生阅历。面对那些年看过的电视剧，彼时孩童的我们满头雾水，而现在，深刻的、内在的、隐晦的暗示，会在我们重温时不断涌现，好的作品需要时间的沉淀，需要阅历的解读。温故方可知新，当越来越多的人认可当下电视传媒的荒芜时，不妨停下脚步，回头看看，看看那些儿时看过的老剧，同样会给你深刻的感悟：好剧如酒，历久弥香。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430201027.png" alt></p><a id="more"></a><hr><p><br><br></p><h4 id="2002《黑洞》"><a href="#2002《黑洞》" class="headerlink" title="2002《黑洞》"></a><strong>2002《黑洞》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430202457.png" alt></p><p><strong>简介：</strong> 副市长聂大海之子、天都市龙腾集团董事长、闻名全省的青年企业家，这些都是加诸在聂明宇（陈道明 饰）身上的称呼。但他最重要的身份则是天都市最大的地下黑社会的头目。平日里一表人才、斯文有礼的聂明宇实则道貌岸然。他利用其四通发达的人际网，收买海关人员，走私货物，牟取暴利。而他的左右手也能力非凡，手段毒辣。在他们的经营下，龙腾集团的业绩步步高升。但世上没有不透风的墙。一封匿名检举信被递到了省委组织部。聂明宇及龙腾集团的勾当引起了省委方面的高度警觉，责令天都市迅速查明原因。但聂明宇的势力早已覆盖整个天都市。市委把聂明宇的义兄，刑警队队长刘振汉（陶泽如 饰）安排调查此事，想继续掩盖聂明宇的罪恶事迹。一场关于亲情和正义的较量在刘振汉身上展开。邪与正的角逐，究竟谁胜谁负…</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLRWT6lKXUm2kHuqw0LJyIO04xdAbItS1e" target="_blank" rel="external nofollow noopener noreferrer">Youtube合集</a></p><p><strong>短评：刘振汉和聂明宇的战争非黑即白：正义必将战胜邪恶；庞天岳和聂大海的较量却讳莫如深：胜者为王败者寇。（这是《名义》的爸爸）</strong> </p><br><h4 id="2004《冬至》"><a href="#2004《冬至》" class="headerlink" title="2004《冬至》"></a><strong>2004《冬至》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430202711.png" alt></p><p><strong>简介：</strong> 齐州银行和平区支行柜台会计陈一平，妻子戴嘉和十二岁的女儿幼幼有一个不怎么富裕但是还算美满的三口之家。而身为北京市局刑侦处长的蒋寒比较起来生活可谓差强人意：虽然工作业绩突出，但是婚姻生活很不幸福。一个是平凡的银行小职员，一个是警察，他们的生活本是两条永不会相交的平行线。可是一场较量却在不知不觉中展开了。一宗看似平淡的银行库款失窃案这两位主人公的命运连在了一起…</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLRWT6lKXUm2kQxBz5zd4Ow1dxM6IOvpOJ" target="_blank" rel="external nofollow noopener noreferrer">Youtube合集</a></p><p><strong>短评：“好人”的堕落，往往只需要一个邪念；家破人亡，也只需要一纸支票。</strong> </p><br><h4 id="1999《一级恐惧-黑菌》"><a href="#1999《一级恐惧-黑菌》" class="headerlink" title="1999《一级恐惧/黑菌》"></a><strong>1999《一级恐惧/黑菌》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430202827.png" alt></p><p><strong>简介：</strong> 村外那条大清河早在几年前就已成了干涸的河床，在布满卵石的河床上往来劳作的农民 们绝对没有想到在他们脚步下的某个地方有一只深埋了半个世纪的罪恶的铁盒，那盒子将给他们、给生活在这个地球上的所有生命带来一场巨大的灾难。不幸的是，他们的铁锹碰到了那个盒子，他们的双手打开了那个瓶口，黑色的液体象当年日本军队肮脏的黑爪一样，伸向了每个人宝贵的生命…十八里坡倾刻间面临灭顶之灾。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLQwmsL4wzIwQLcIY4D94NVp7yBCu2OOkN" target="_blank" rel="external nofollow noopener noreferrer">Youtube合集</a></p><p><strong>短评：人物脸谱化的登峰造极；讽刺官派的出神入化；天灾还是人祸，二十年前就已经开始了讨论。</strong> </p><br><h4 id="1997《雍正王朝》"><a href="#1997《雍正王朝》" class="headerlink" title="1997《雍正王朝》"></a><strong>1997《雍正王朝》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430202913.png" alt></p><p><strong>简介：</strong> 康熙皇帝驾崩，继位者四阿哥胤禛，在当政后出现的“摊丁入亩、火耗归公”、“士绅一体当差一体纳粮”、“河南罢考案”、“铁帽子亲王大殿发难逼宫”、“含泪杀亲子”等一系列旨在推行新政、抑制官绅敛财和宫廷内部党争、挤压的历史事件贯穿雍正的一生和雍正王朝。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PL4U9STbe5zoITXpG8WRbloB2W0TmKZ0yG" target="_blank" rel="external nofollow noopener noreferrer">Youtube合集</a></p><p><strong>短评：羸弱帝国的苦皇帝，低开高走雍正王朝。皇帝不再高高在上，而更像是一位从群众中来的无产阶级领袖。</strong> </p><br><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="2001《康熙王朝》"><a href="#2001《康熙王朝》" class="headerlink" title="2001《康熙王朝》"></a><strong>2001《康熙王朝》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430203006.png" alt></p><p><strong>简介：</strong> 基于二月河小说《康熙大帝》改编，其背景故事是清朝世祖顺治帝的末年和圣祖康熙帝在位时的事迹。该剧从顺治皇帝哀痛爱妃董鄂妃病故时讲起，直至康熙在位61年驾崩而止。第一次以正剧的角度浓墨重彩刻画了清朝初期康熙皇帝充满传奇的一生。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLIj4BzSwQ-_v9n6qabRS2C1b1aGRwZbP4" target="_blank" rel="external nofollow noopener noreferrer">Youtube合集</a></p><p><strong>短评：准确的演绎出了大清帝国皇帝的王道之气和阴柔诡谲的心性。在位六十载无人能敌，统一华夏功德无量。</strong> </p><br><h4 id="2000《上车走吧》"><a href="#2000《上车走吧》" class="headerlink" title="2000《上车走吧》"></a><strong>2000《上车走吧》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200501224115.png" alt></p><p><strong>简介：（这个是电影哦）</strong> 98年，山东青年刘承强（高虎 饰）和同乡高明（黄渤 饰）相约来到首都北京。成为了小巴302线的司乘人员。同在一条营运线的大头和大英子出于利益的关系，处处与强子和小明作对，双方为此曾大打出手。在此期间，高明更与同住一个院子的四川女孩小辫子日久生情，而强子则喜欢上了小巴上的常客丽娟。北京，这座城市的人和事，给了这两个外地青年终身难忘的记忆。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/watch?v=6IC64XGJ2xo&t=328s" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：见微知著，北京的丑陋面，多年过去，并没有多少改变。每个人都在纷纷扰扰中找到自己的位置，等级森严、不可僭越，即使相识相知也终将平行向前。</strong> </p><br><h4 id="2005《生存之民工-春天里》"><a href="#2005《生存之民工-春天里》" class="headerlink" title="2005《生存之民工/春天里》"></a><strong>2005《生存之民工/春天里》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200512232436.png" alt></p><p><strong>简介：</strong> 松江市，一个东北边陲的小城，一群来自全国各地的农民工为了生存，来到了这里，他们把汗水浸透在这个城市的建筑工地上。而上百名民工们的血汗工资无情地被非法挪用，民工们养家糊口的工钱被无期限地拖延，为了生计他们被迫集体追讨，可是讨来的却是暴力威胁和致命的恐吓，这群缺乏人文关怀的弱势群体的生命骤然间危在旦夕。。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PL5MEeGH4X3Kl-0Qkv4t-FmvZqIqTHsnTz" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：谢老大的无奈、王家才的窝囊、王家慧的没人性、杨志刚的鲁莽、陆长发的自以为是…极尽农民工之散漫、无用、甚至有些废物，但正是这种氛围的营造，让剧情无限接近真实生活，他们就是那样的无知、那样的天真、那样的愚昧，导演巧妙的插入了栓子这样一个新时代农民工的形象，隐晦的代表了希望、代表了农民工的明天。本剧音效也是一大亮点，没有浮夸的配乐，只有深沉的伴奏。</strong> </p><br><h4 id="2010《外乡人》"><a href="#2010《外乡人》" class="headerlink" title="2010《外乡人》"></a><strong>2010《外乡人》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200512230927.png" alt></p><p><strong>简介：</strong> 讲述七八个外乡人，为了各自理想汇聚到上海，历经坎坷最终实现自我的悲喜人生。该剧围绕着小人物平凡琐碎的生活故事及情感纠葛，细致入微地刻画了人们熟知或陌生人们的内心世界。该剧以一种平实亲切的风格，以平民的视角，印证着都市乃至当今中国最近十年的发展脉络，是一幅反映中国社会进步、经济发展的市井风情画。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLA77ed283ovhUnF02_bvmabgLnlv2A5mo" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：本剧的点睛之笔是电视机，从南斯拉夫大使馆被炸开始，穿插了包括911恐怖袭击、五十年国庆、2003年非典、北京申奥成功、08年地震、雪灾、到最后全国取消农业税等等事件，把整个剧情牢牢的贴合在真实历史的轨迹之上，让每个人物的悲欢离合同祖国的发展同呼吸、共命运，把艺术源于生活演绎的淋漓尽致。</strong> </p><br><h4 id="2008《国家形象》"><a href="#2008《国家形象》" class="headerlink" title="2008《国家形象》"></a><strong>2008《国家形象》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200618133922.png" alt></p><p><strong>简介：</strong> 为了纪念国际禁毒日，主创团队决定拍摄一部缉毒禁毒的电视剧。该剧取材于公安部门缉拿的刘招华、谭晓林、陈炳锡、张启生四位毒枭的案例。编剧在公安部门的协助下，才从数以万计的资料中，把他们的关系捋出来，重新创作出看点极佳的故事情节。剧组先后来到厦门、西双版纳、北京、西安及泰国等地取景拍摄。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLRWT6lKXUm2l8WRmLTNvKvUKrB9Iu6h8i" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：毒贩的尔虞我诈、卧底的步步惊心，以及缉毒战士的无所畏惧，交织在一起还原了一段精彩的缉毒故事。</strong> </p><br><h4 id="2005《使命》"><a href="#2005《使命》" class="headerlink" title="2005《使命》"></a><strong>2005《使命》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200618135113.png" alt></p><p><strong>简介：</strong> 根据朱维坚长篇小说《使命：黑白道前传》改编的电视剧，是一部综合反黑、纪检、刑侦的电视剧。讲述了清水市公安局长林荫，铲除黑恶势力，扫除百姓心中的阴霾的故事。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLHOMQ6tK7YueCgko2kWENKSjHwL6a_WIK" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：当一个城市被黑恶势力所浸淫，执法机关被外部势力所渗透时，试想公安局长如何能够扭转局势、反客为主。对金钱的贪婪是堕落的根源，守住底线的根本就是牢记自己的‘使命’</strong> </p><br><h4 id="2009《沉默》"><a href="#2009《沉默》" class="headerlink" title="2009《沉默》"></a><strong>2009《沉默》</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200618140116.png" alt></p><p><strong>简介：</strong> 依旧是根据朱维坚创作的小说《黑白道：终结篇·沉默》改编，不同的是林荫来到了春城市春城分局做局长，相比较清水市，这里的权力交织更为盘根错节，甚至出现了枪杀警队人员的恶性事件，真相虚无缥缈，凶手亦敌亦友，在权力面前，选择沉默还是奋起反抗，这是一个值得深思的问题。</p><p><strong>观看：</strong> <a href="https://www.youtube.com/playlist?list=PLHOMQ6tK7Yud2RQ38_eF35BtpFY5Hz7qY" target="_blank" rel="external nofollow noopener noreferrer">Youtube地址</a></p><p><strong>短评：极度压抑的观看体验，几乎全程被升任的前任公安局长玩弄于手掌内，不同的是，除了忍气吞声外，林荫一直没有放弃对黑恶势力证据的收集，最终，拨云见日，成功的揪出了隐藏在警队内部的罪魁祸首，同时配合政法委一举肃清了执政队伍。看到结尾时，心中那种全程压抑的情感才得以集中释放。林荫再一次不负众望，凯旋而归。</strong> </p><br><h4 id="未完待续。。"><a href="#未完待续。。" class="headerlink" title="未完待续。。"></a><strong>未完待续。。</strong></h4>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>你有没有「厌网」情节？</title>
      <link href="/article/73f8.html"/>
      <url>/article/73f8.html</url>
      
        <content type="html"><![CDATA[<p>曾几何时，互联网的沟通方式是单调的，但人与人的沟通却是真诚的，但近年来网民数量直逼人口数量，互联网再也不是从前那一汪清泉，或许用波涛汹涌的汪洋大海来比喻比较贴切，太多人厌倦了、疲惫了，选择退网了，在他们眼中，当下互联网环境早已是恶臭漫天，烂的一发不可收拾，但事实如此吗？我想每个人有每个人的理解。</p><a id="more"></a><h4 id="先导"><a href="#先导" class="headerlink" title="先导"></a><strong>先导</strong></h4><p>写此文章的缘由是我看到了不止一个朋友、或朋友的朋友的退网经历，虽然我不知道事实如何，但我也理解他们的行为。互联网的膨胀，带来的是无穷无尽的话题和随之而来的讨论或争论。而恰恰是建立在互联网之上的<strong>「</strong>讨论<strong>」</strong>，是构成互联网生活的重要一环，也是影响人们体验的最重要因素。</p><p>因此，以下所述的互联网环境，特指<strong>「</strong>言论/舆论环境<strong>」</strong>，这也是导致人们对互联网产生厌烦情绪甚至退网的直接和最主要因素。</p><h4 id="互联网环境的发展"><a href="#互联网环境的发展" class="headerlink" title="互联网环境的发展"></a><strong>互联网环境的发展</strong></h4><p>如果用一句话概括现如今的互联网环境，那就是<strong>「</strong>整体杂乱有序、个体多维度交叉<strong>」</strong>。如果从互联网诞生之时说起，那么大概可以描绘出以下这么几个阶段：</p><p><strong>1. 混沌时代的个体觉醒：产生公知。</strong>起初的互联网由于在人们生活中的参与度非常有限，几乎不会对人们现实社会的决策产生影响。到了后来，国内第一批意见领袖出现，此时大多数人基本都是边缘OB大神输出，意见领袖/公知，很大程度上就是公信力的代名词。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200423011737.png" alt></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p><strong>2. 初生代网民和新生代网民的先后加入。</strong>这一过程从最初开始，延续到现在。看惯了神仙（公知）打架的初生代网民的加入，迅速使得互联网活跃起来，一系列优质的社区产生。由于初生代网民的骨子里是<strong>「</strong>问题导向<strong>」</strong>（公知打架）的，所以平均素质自然比较高，那时的互联网环境也自然比较好，那段时间也成了众多网友追忆的<strong>「</strong>黄金时代<strong>」</strong>。<br>后来，新生代（尤其是00后）的加入，彻底打破了这一美梦。有人说新生代网民的素质堪忧，究其原因可能有二：</p><ul><li><strong>一是经历：</strong>初生代网民看着公知打架过来的，而新生代呢，是看着粉丝互怼过来的。</li><li><strong>二是时间：</strong>初生代参与网络的（平均）年龄必然比新生代大的多，这直接导致了新生代网民过早的接触、参与、实施。</li></ul><p>总之，以微博为载体、粉丝为高地的新型互联网舆论战场已经在新生代的影响下形成规模，现在每天都有大大小小的<strong>「</strong>战争<strong>」</strong>爆发，并且实实在在的在影响人们的现实生活。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200423011813.png" alt></p><p><strong>3. 新生代力量的侵蚀和导致的群体分裂。</strong>续上。在新生代加入之后，除了上述的<strong>「</strong>自家战场<strong>」</strong>，他们还迅速洗劫其他<strong>「</strong>高龄<strong>」</strong>战场，凡无门槛可进入的地方，全部被低龄化所影响。新老的对立和互相嫌弃说到底，是老一代网民的错，错就错在自己没管好自己的娃，让他年纪轻轻（初中尤甚）就跑到网上参军。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200423011848.png" alt></p><p><strong>4. 重回混沌，但是更高水平的混沌。</strong>终于说到了现在。现在是个什么形式呢，个人更倾向于重回混沌状态：没有所谓的公知领袖，即便有也通常最后会死的很惨；人人都有粉丝效应，人人都可能是舆论中心。<br>至于这种混沌是更高质量还是更低质量，我觉得是前者，至少有思辨能力的人是越来越多的。不过恰恰是这些产生出思辨能力的人，往往是退网急先锋，因为他们受不了无脑的拥护，受不了不分青红皂白的辱骂，可转念一想，谁又不是这样过来的呢？</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200423011909.png" alt></p><p>前半段的最后说到了现今的互联网环境和退网人士，下面直接就他们为什么对现今的互联网环境心生厌恶做一下简要分析。</p><ul><li><strong>根本原因：个人觉醒和「同质化」的矛盾。</strong></li><li><strong>直接原因：「拥护者效应」的加害。</strong></li></ul><h4 id="从「意见垄断」说起"><a href="#从「意见垄断」说起" class="headerlink" title="从「意见垄断」说起"></a><strong>从「意见垄断」说起</strong></h4><p>字面来看，意见垄断就是发表意见的权力掌握在少数人手里，在公知时期确实是这样，那时的公知或者大V，需要很长时间的积累、或运营，新手入场难度很大，因此那时虽然少数人掌握发言权，但环境还算说得过去。</p><p>但自新生代加入后，伴随互联网的爆炸式发展，自媒体井喷、营销平民化都在刺激着言论的扁平化蜕变，言论场从原先的群峰矗立，变成了现在的丘陵起伏，由此，言论更亲民了，但也更杂乱无章了。</p><p>不过聚焦在某一问题，其又有一番景象：站队思维越来越严重。究其原因，我认为是言论的扁平化，致使个人言论地位的提升，加之个体意识的觉醒，导致<strong>「</strong>希望他人认同自己<strong>」</strong>的想法越发强烈，从而导致<strong>「</strong>站队互喷<strong>」</strong>。久而久之，<strong>「</strong>表明立场<strong>」</strong>便成了必修课，在不断地、重复地、多次地表明立场后，必然有部分人会疲倦、会厌恶，究其原因，便是个体意识过于强烈，缺少包容度，一次次的站队，一次次的参加战斗，直到自己发现，原来在另一场战斗中，战友赫然站立在自己最恶心的阵营中。</p><h4 id="何为「群体同质化」"><a href="#何为「群体同质化」" class="headerlink" title="何为「群体同质化」"></a><strong>何为「群体同质化」</strong></h4><p>当上述这种需要表明立场的话题构成一类话题，那么经过如此<strong>「</strong>训练<strong>」</strong>的网民，便会出奇的言论一致（这就是所谓的同质化），例如明星的脑残粉，爱guo的粉红等等，当这种<strong>「</strong>同质化<strong>」</strong>表现在某些反常识的话题（例如对日系车打砸）中时，往往就会令有<strong>「</strong>独立思维<strong>」</strong>的人心生厌恶，长此以往，或许某天他们就会大喊一声失望，然后悻然退网。如果他们忍辱负重下来，那么等待他们的还有<strong>「</strong>拥护者<strong>」</strong>的加害。</p><h4 id="副产物「拥护者效应」"><a href="#副产物「拥护者效应」" class="headerlink" title="副产物「拥护者效应」"></a><strong>副产物「拥护者效应」</strong></h4><p>前面说的<strong>「</strong>群体同质化<strong>」</strong>本身并没有什么害处，但坏就坏在其会催生出一类<strong>「</strong>拥护者<strong>」</strong>，这又是<strong>「</strong>潜在退网用户<strong>」</strong>最为恶心的一类人。往往自身并不十分拥护，但仍会借其外衣攻击自己的<strong>「</strong>敌人<strong>」</strong>。最典型的，自然就是“乱咬人”的<strong>「</strong>脑残粉<strong>」</strong>对路人的<strong>「</strong>无差别攻击<strong>」</strong>。</p><h4 id="参与者素质"><a href="#参与者素质" class="headerlink" title="参与者素质"></a><strong>参与者素质</strong></h4><p>这是个老生常谈的问题，但其实却又包含鲜明的时代色彩。由第一部分可知，十年前的互联网参与者和十年后的参与者（主力），已完全不同。如今的玩家，除了传统角色，更多的还有各色的<strong>「</strong>营销力量<strong>」</strong>，从本质上说，我认为当下的爱豆和粉丝，也应归类于媒体营销的一种。如果从营销的角度来看，那么参与者素质就显得不是那么重要，而流量导向才是根本目的，所以至此，互联网的新时代特性也凸显了出来，那就是<strong>「</strong>流量为王<strong>」</strong>，在此指导思想之下，内容的质量、提问者的素质、言论的真实性等等因素的重要性急剧下降，自然地，互联网的环境也随之越来越恶化。这也是构成部分人厌网情节的重要因素。</p><p>综上，可以发现，<strong>「</strong>潜在退网用户<strong>」</strong>的伤心地大多都是舆论场，是他们自己过于认真，从而让自己饱受<strong>「</strong>真实伤害<strong>」</strong>，实际呢，网络上的互相伤害比比皆是，不让自己深陷其中，才是面对如此环境的根本方法。</p><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h4><p>在现如今的互联网（言论环境），如果事事较真，那么你将寸步难行。自己接受不了的就远离，自己热爱的就去捍卫；不要让互联网世界影响现实中的自己，也不要把现实世界的事物过多的带入到互联网中去，保持合适的远距离，才能让互联网为我们所用。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>来自千里之外祖国的关爱</title>
      <link href="/article/c24c.html"/>
      <url>/article/c24c.html</url>
      
        <content type="html"><![CDATA[<p>盼星星盼月亮，终于把“健康包”给盼来了，大约一周前就在网上填了表格，没想到今天才送到手里，更没想到的是居然用的是顺丰快递，原来荷兰也是有顺丰的。虽然远在千里之外，但此健康包还是领自己深深的感受到了来自祖国的关爱，特此记录一下。</p><a id="more"></a><h4 id="健康包"><a href="#健康包" class="headerlink" title="健康包"></a><strong>健康包</strong></h4><p>根据荷兰大使馆的说法，这一次荷兰国内发来的健康包一共有四千份，内有消毒湿巾、口罩以及湖北1号方、湖北2号方等防疫药品。通过全荷学联组织发放，顺丰荷兰负责投递，整个申请过程总计有4750人报名申领。对于首次没有领到的750人，大使馆后续又筹措了750份健康包。也就是说，只要成功完成申请的留学生，全都被包含在此次健康包的投递对象中。</p><h4 id="申请一波三折"><a href="#申请一波三折" class="headerlink" title="申请一波三折"></a><strong>申请一波三折</strong></h4><p>由于一开始被告知的是健康包数量有限，并不能覆盖全部的申请者，所以一周前的那天晚上，我们全都准备好了准备抢填，结果到点一登录，表格居然崩溃了。事后我们分析，是因为学联使用了谷歌多人协作表格的锅。众所周知，这类协作表格，对并发的支持很差，几百人就不行了。由第一节可知当天总共有接近五千人申请，使用谷歌协作表格，那妥妥的是不行的，因此在等待了一个多小时之后，学联才又重新开通了申请渠道，这次采用的是调查问卷的方式，这种方法就好的多了，从技术上说，这种方式的并发支持要好的多，只需要一般性能的数据库，就可以轻松的支持几百上千的并发提交，所以后面我们就轻轻松松完成了表格填写。值得高兴的是，隔天的第一批确认名单中，就找到了我的名字！（田氏家族ohaha）</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200422205636.png" alt></p><h4 id="送货送到天荒地老"><a href="#送货送到天荒地老" class="headerlink" title="送货送到天荒地老"></a><strong>送货送到天荒地老</strong></h4><p>就在出名单的隔天，也就是填完表格后的第二天，就有同学晒出收到的健康包了，结果呢，我是等到了一周之后，也就是今天，才收到的，期间我还一度认为自己的健康包被放到了暂存点（因为收到了张暂存的单子），事后才知道那是室友的快递。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="晒晒里面的东东"><a href="#晒晒里面的东东" class="headerlink" title="晒晒里面的东东"></a><strong>晒晒里面的东东</strong></h4><p><code>卫生湿巾和防疫小册子：</code></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/ETRE7W73HONT9JBU4KK@TYC.jpg" alt></p><p><code>KN95和一般医用口罩（2+20），以及中药预防方（六剂）：</code></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200422211625.png" alt></p><p><code>还有一封“家信”：</code></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/QQ%E5%9B%BE%E7%89%8720200422212059_%E5%89%AF%E6%9C%AC.jpg" alt></p><h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200422214447.png" alt></p><p>到此为止已经度过了一个多月的居家隔离生活，疫情也逐渐的从每日生活的主旋律变成了配菜，虽然情势不容乐观，尤其是害人的天气（先前没隔离的时候天天下雨，我甚至因为淋雨都感冒过，但自从开始了居家隔离的政策，这天气就变得异常的好），这蓝天白云直接导致出去一趟外面全是出来玩的。但终究整体社会氛围还比较稳定，这些Coronavirus在乐观的荷兰人眼里都不是事儿。</p><p>不过即便如此，在此时节，能收到祖国寄来的救助包裹，心里也是热乎乎的，轻轻的包裹载着重重的情谊，不远万里从国内送到我的手中，除了说句感谢，更多的还有对祖国认同感和自豪感的提升。这让我不由的想起了《战狼2》结尾的那句话（也是护照反面的那句话）：</p><blockquote><p><strong>“中华人民共和国公民：当你在海外遭遇危险，不要放弃！请记住，在你身后，有一个强大的祖国！”</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 荷兰 </tag>
            
            <tag> 生活 </tag>
            
            <tag> CSC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>站点访问概况（近两月 2.29-4.29）</title>
      <link href="/article/ac94.html"/>
      <url>/article/ac94.html</url>
      
        <content type="html"><![CDATA[<p><strong>马上五一了，数据已更新至建站来的两个月。</strong> 以下为原文：终于告别三月，迎来了四月，在二月的最后一天，我把主题换成了Volantis，并且最近一段时间一直在对其进行美化和微调，现在是四月的第一天，整整一个月过去了，博客运行的如何呢？让我来借助统计分析来给大家康康。</p><a id="more"></a><h4 id="日均访客"><a href="#日均访客" class="headerlink" title="日均访客"></a><strong>日均访客</strong></h4><p>由下图可以看出，本博客还是个微型小站，每天基本也就几十个访客/IP，网页被浏览一百次左右（已排除本地调试干扰）。而且对于流量比较大的几天，其实都是知乎带来的流量。剩下的基本盘流量，基本是在 Hexo 水群时群友访问的，当然，现在不排除已经有部分老用户了，数据显示的是现在的访问量有 30% 是老用户/访客。</p><p>重要的一点是，从后面的分析可以得知，本博客站点的 <strong>UV : PV &lt; 1 : 3</strong>，个人认为这是十分正常的数据，如果 PV 是 UV 的四倍以上，那我一般认为就有水分了。</p><p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401015241.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430204047.png"><br></fancybox></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="总量和来源地区"><a href="#总量和来源地区" class="headerlink" title="总量和来源地区"></a><strong>总量和来源地区</strong></h4><p>可以看出，部署在 Coding 的新加坡机房，基本全球访问畅通，主要流量都来源于亚洲、欧洲和美国。这其中的国外访问量，我猜也基本是知乎带过来的，后面的对知乎的分析也会提及。对于中国的部分，我比较困惑的1是好像有大量访问的来源都是重叠在一起的，比如河南的访问量是最高的，我怀疑这些来源地区有运营商的根路由。关于具体来源的访客数，可以参照以下图示。</p><p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401010349.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430204559.png"><br></fancybox></p><br>下面可以更直观的看出来访问来源地的总访问时长。可以看出大部分访问并不是蜻蜓点水，停留时间比未改版以前的旧博客要好了不少。<p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401014215.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430205029.png"><br></fancybox></p><h4 id="高光时刻"><a href="#高光时刻" class="headerlink" title="高光时刻"></a><strong>高光时刻</strong></h4><p>下面是昨天下午的时候，博客被访问的情况，同时（五分钟内）被 8 人访问，可以称得上是高光时刻了。</p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200331163105.png"></fancybox><h4 id="来源分析"><a href="#来源分析" class="headerlink" title="来源分析"></a><strong>来源分析</strong></h4><p>下面可以看出来，主要的来源除了直接访问，就三个：知乎、十年之约和 Zonelyn.com。</p><ul><li>最后的域名是由于在知乎留的链接没及时换成新域名导致的访问跳转，到后面更换了就降下来了；</li><li>十年之约就是个博客汇总网站，贡献了小部分访问；</li><li>最后就是知乎了，可以说域名那部分也基本是知乎来的，可能直接的访问贡献了 570+ 的浏览。这基本算六分之一的访问量了。请记住蓝色折线的曲线，基本和知乎上的文章阅读量保持相同的趋势。</li></ul><p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401011958.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430205500.png"><br></fancybox></p><h4 id="受众最多的页面"><a href="#受众最多的页面" class="headerlink" title="受众最多的页面"></a><strong>受众最多的页面</strong></h4><p>非<a href="/csc/index.html">工具页</a>莫属了，这个小工具创建于三月初，此页面九成的访客来自于知乎的文章，下面顺带把知乎的近两个月的数据分析一下。由上面分析，剩下 100+ 的流量应该来自直接访问，因为这个链接被我放在主页顶部按钮中了，十分明显。</p><p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401012615.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430205844.png"><br></fancybox></p><h4 id="知乎近俩月的分析"><a href="#知乎近俩月的分析" class="headerlink" title="知乎近俩月的分析"></a><strong>知乎近俩月的分析</strong></h4><p>自从二月中旬开始，我陆陆续续的整理了下自己去年的申请材料，放到了知乎上，还搞了个专栏，事实证明，我这次的无心插柳，已经产生不小的影响了。主要的几篇文章，收藏率超过 10%，并且专栏的关注人数已经四百多人，传播效应已经开始，预计在近一个月还会继续增多，因为前天又把剩余的几份材料整理了一下放到专栏了，申请正好用到。</p><p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401013613.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430233223.png"><br></fancybox></p><br>对于这几篇介绍经验的文章，在前期（那时只有两篇）曾经一度异常火爆，每天的单篇收藏都能一两百，评论都有十几二十条。不过现在稳定了，基本上每天就几个提问，不会占据我太多时间。<p><strong><code>第一个月（2.29-3.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401013222.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）：</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430210307.png"><br></fancybox></p><br>目前的状态是专栏里的东西基本齐全了，我已经想不到还有什么能分享的了，借助这个专栏和这几篇文章，我也收获了几百关注，但就是没有爆款回答就是了（没精力回答那种细致的问题），赞同数还是少的可怜的，基本都来自专栏文章。后续的想法是，把我最近他们问我的问题和回答，大概得有两三百个问题（知乎文章和私信以及QQ上问的），搞一个问答系统，这样我就不用每次都回答了，构思中。<p><strong><code>第一个月（2.29-3.29）:</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401013939.png"><br></fancybox></p><p><strong><code>第二个月（3.29-4.29）:</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430232451.png"><br></fancybox></p><h4 id="结识朋友"><a href="#结识朋友" class="headerlink" title="结识朋友"></a><strong>结识朋友</strong></h4><p>在文章数据统计中的大约 400 条的留言里，大约有一半是我的回复。大概就是解答一下疑惑而已，而且大部分问题都可以被解决掉，但也有部分人加了我的QQ好友，为此，近一个月的时间里我收获了四十多位新朋友，当然最终有部分人问完问题之后还成了好朋友，里面又有几个是可能会来我这里的，到时候请我吃饭也说不定（偷笑。</p><p>总之，虽然是我给他们解答，但也非常感谢他们问我，他们基本上全都是很优秀的，除了一些TOP的大佬，还有些“明星”，比如里面竟然有一位是“<a href="https://www.baidu.com/s?wd=90%E5%90%8E%E9%A9%AC%E5%85%8B+%C2%B7%E5%90%90%E6%B8%A9&rsv_spt=1&rsv_iqid=0xb69b4625006da6cb&issp=1&f=8&rsv_bp=0&rsv_idx=2&ie=utf-8&rqlang=&tn=baiduhome_pg&ch=" target="_blank" rel="external nofollow noopener noreferrer">90后马克 ·吐温</a>”的老哥，我当时都惊到了，他们倒还是都很平易近人的，和他们交流起来也没什么，光环褪去，大家都是普通人。</p><p><strong><code>第一个月（44人）:</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200401023931.png"><br></fancybox></p><p><strong><code>第二个月（188人）:</code></strong><br><fancybox><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200430231712.png"><br></fancybox></p><h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h4><p>今天是愚人节，但却没心情愚人，还是希望疫情快点过去，好让正常的学习和生活重新回归。不过目前看来还是遥遥无期啊，什么时候出门大街上有人戴口罩了，疫情估计就快结束了。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 知乎 </tag>
            
            <tag> 站点统计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>引入基于LCloud的页面访问统计</title>
      <link href="/article/4e53.html"/>
      <url>/article/4e53.html</url>
      
        <content type="html"><![CDATA[<p>由于本主题（Volantis）使用的 Valine 暂时仍然无法正常开启 Counter 页面计数，所以，在单一页面上展示出该页面的访问量就成了一个问题。不蒜子是个解决方式，但其加载巨慢而且仍属于个人维护、并不稳定。所以综合到最后，选择采用 LeanCloud 来完成这一功能。其主要思路就是访问页面时到对应的 LeanCloud 数据表中更新访问次数。不过暂时只能记录PV值。</p><a id="more"></a><h3 id="从零开始引入计数代码"><a href="#从零开始引入计数代码" class="headerlink" title="从零开始引入计数代码"></a><strong>从零开始引入计数代码</strong></h3><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a><strong>第一步</strong></h4><p>新增leancloud代码主体（lc_visitors.ejs），主要实现的是访问页面时leancloud访问数+1，并且返回该页面已有的访问量。</p><figure class="highlight javascript"><figcaption><span>~\volantis\_third-party\lc_visitors.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">&lt;!--由于主题包含valine.js，所以只引入av.js--&gt;</span><br><span class="line">&lt;script src=<span class="string">"//cdn1.lncld.net/static/js/2.5.0/av-min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script type="text/</span>javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">if(true)&#123;</span></span><br><span class="line"><span class="string">    var leancloud_app_id  = 'WbLE88***********gzGzoHsz';  //y=偷懒直接硬写了</span></span><br><span class="line"><span class="string">    var leancloud_app_key = 'ycqjmt***********RkrdO';</span></span><br><span class="line"><span class="string">    AV.init(&#123;</span></span><br><span class="line"><span class="string">        appId: leancloud_app_id,</span></span><br><span class="line"><span class="string">        appKey: leancloud_app_key</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    var pageViewsLength = $("</span>.pageViews<span class="string">").length;</span></span><br><span class="line"><span class="string">    var isIndex = $("</span>.pageViews<span class="string">").length &gt; 1 ?true:false;</span></span><br><span class="line"><span class="string">    function showTime() &#123;</span></span><br><span class="line"><span class="string">        var Pageview = AV.Object.extend("</span>Pageview<span class="string">");</span></span><br><span class="line"><span class="string">        if(isIndex)&#123;</span></span><br><span class="line"><span class="string">            $("</span>.pageViews<span class="string">").each(function()&#123;</span></span><br><span class="line"><span class="string">                showPageViewsNum($(this), Pageview);</span></span><br><span class="line"><span class="string">            &#125;);</span></span><br><span class="line"><span class="string">        &#125;else&#123;</span></span><br><span class="line"><span class="string">            addPageViewsNum($("</span>.pageViews<span class="string">"));</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //仅显示阅读量</span></span><br><span class="line"><span class="string">    function showPageViewsNum(ele, Pageview)&#123;</span></span><br><span class="line"><span class="string">        var id = ele.attr('id').trim();</span></span><br><span class="line"><span class="string">        var query = new AV.Query("</span>Pageview<span class="string">");</span></span><br><span class="line"><span class="string">        query.equalTo("</span>post_id<span class="string">", id);</span></span><br><span class="line"><span class="string">        query.descending('createdAt');</span></span><br><span class="line"><span class="string">        query.limit(1);</span></span><br><span class="line"><span class="string">        query.find().then(function (results) &#123;</span></span><br><span class="line"><span class="string">            $(document.getElementById(id)).text(results &amp;&amp; results.length &gt; 0?  results[0].get("</span>count<span class="string">") : '0');</span></span><br><span class="line"><span class="string">        &#125;, function (error) &#123;</span></span><br><span class="line"><span class="string">             $(document.getElementById(id)).text('0');</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    //追加并显示阅读量</span></span><br><span class="line"><span class="string">    function addPageViewsNum(ele)&#123;</span></span><br><span class="line"><span class="string">        var id = ele.attr('id').trim();</span></span><br><span class="line"><span class="string">        var title = ele.attr('data-flag-title').trim();</span></span><br><span class="line"><span class="string">        var query = new AV.Query("</span>Pageview<span class="string">");</span></span><br><span class="line"><span class="string">        query.equalTo("</span>post_id<span class="string">", id);</span></span><br><span class="line"><span class="string">        query.descending('createdAt');</span></span><br><span class="line"><span class="string">        query.limit(1);</span></span><br><span class="line"><span class="string">        query.find().then(function (results) &#123;</span></span><br><span class="line"><span class="string">            if (results.length == 0) &#123;</span></span><br><span class="line"><span class="string">               saveNewPageview(id, title);</span></span><br><span class="line"><span class="string">               return;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            var pageview = results[0];</span></span><br><span class="line"><span class="string">            var count = pageview.get("</span>count<span class="string">");</span></span><br><span class="line"><span class="string">            count++;</span></span><br><span class="line"><span class="string">            pageview.set("</span>count<span class="string">", count);</span></span><br><span class="line"><span class="string">            pageview.set("</span>title<span class="string">", title);</span></span><br><span class="line"><span class="string">            pageview.save().then(function (pageview) &#123;</span></span><br><span class="line"><span class="string">                $(document.getElementById(id)).text(count);</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;, function (error) &#123;</span></span><br><span class="line"><span class="string">            saveNewPageview(id, title);</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    function saveNewPageview(id, title) &#123;</span></span><br><span class="line"><span class="string">       var Pageview = AV.Object.extend("</span>Pageview<span class="string">");</span></span><br><span class="line"><span class="string">       var query = new Pageview;</span></span><br><span class="line"><span class="string">       query.save(&#123;</span></span><br><span class="line"><span class="string">           post_id: id,</span></span><br><span class="line"><span class="string">           title: title,</span></span><br><span class="line"><span class="string">           count: 1</span></span><br><span class="line"><span class="string">       &#125;).then(function (pageview) &#123;</span></span><br><span class="line"><span class="string">           $(document.getElementById(id)).text(pageview.count);</span></span><br><span class="line"><span class="string">       &#125;, function (error) &#123;</span></span><br><span class="line"><span class="string">       &#125;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    if(pageViewsLength)&#123; //此处判断等于 1 在执行 可去除循环</span></span><br><span class="line"><span class="string">        showTime();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a><strong>第二步</strong></h4><p>将leancloud代码主体（lc_visitors.ejs）引入到原来的主题模板中，紧跟在jquery的后面。</p><figure class="highlight javascript"><figcaption><span>~\volantis\layout\_partial\scripts.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">&lt;%- js(theme.plugins.jquery) %&gt;</span><br><span class="line">&lt;!--引入代码--&gt;</span><br><span class="line">&lt;%- partial(<span class="string">'_third-party/lc_visitors'</span>) %&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.search &amp;&amp; theme.search.enable) &#123; %&gt;</span><br><span class="line">  ... ...</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><h4 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a><strong>第三步</strong></h4><p>在原页面中插入显示访问量的代码段，这里我直接紧跟在meta信息的阅读时长统计后面了。</p><figure class="highlight javascript"><figcaption><span>~\volantis\_meta\wordcount.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.plugins.wordcount) &#123; %&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"new-meta-item wordcount"</span>&gt;</span><br><span class="line">    &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">'notlink'</span>&gt;</span><br><span class="line">      &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"&lt;%- theme.meta.wordcount.icon_wordcount %&gt;"</span> aria-hidden=<span class="string">"true"</span>&gt;&lt;<span class="regexp">/i&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;&lt;%- __('post.wordcount', wordcount(post.content))%&gt;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"new-meta-item readtime"</span>&gt;</span><br><span class="line">    &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">'notlink'</span>&gt;</span><br><span class="line">      &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"&lt;%- theme.meta.wordcount.icon_duration %&gt;"</span> aria-hidden=<span class="string">"true"</span>&gt;&lt;<span class="regexp">/i&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;&lt;%- __('post.duration', min2read(post.content))%&gt;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">  &lt;!--添加显示访问量的代码（火焰图标+℃）--&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"new-meta-item readtime"</span>&gt;</span><br><span class="line">    &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">'notlink'</span>&gt;</span><br><span class="line">      &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"fas fa-fire"</span> aria-hidden=<span class="string">"true"</span>&gt;&lt;<span class="regexp">/i&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;&lt;span id="&lt;%= post.path %&gt;" class="pageViews" data-flag-title="&lt;%= post.title || post.path %&gt;"&gt;&lt;/</span>span&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>a&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;% &#125; %&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong>以上只有部署后访问才有作用，在本地访问无效果。</p><h3 id="LeanCloud并发查询429错误"><a href="#LeanCloud并发查询429错误" class="headerlink" title="LeanCloud并发查询429错误"></a><strong>LeanCloud并发查询429错误</strong></h3><p>这是第二次遇到了，每次鼓捣LeanCloud都会出现这个问题，主要还是其对访问做了限制。错误主要出现在列表页面，因为会同时查询多篇文章的访问量，所以会导致触发429错误。</p><p><strong>我上次的解决方案：</strong><a href="https://www.cxmoe.com/article/502d.html#%E5%9C%A8each%E5%BE%AA%E7%8E%AF%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%93%8D%E4%BD%9C">应对LeanCloud对于查询性能的限制</a></p><p>具体只需修改以下代码：</p><figure class="highlight javascript"><figcaption><span>~\volantis\_third-party\lc_visitors.ejs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">&lt;!--循环间隔地控制查询的触发--&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(isIndex)&#123;</span><br><span class="line"><span class="keyword">var</span> cnt = $(<span class="string">".pageViews"</span>).length;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>; </span><br><span class="line"><span class="keyword">var</span> interval = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(i &gt;= cnt) </span><br><span class="line">clearInterval(interval);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">showPageViewsNum($($(<span class="string">".pageViews"</span>)[i++]), AV.Object.extend(<span class="string">"Pageview"</span>));</span><br><span class="line">&#125;,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">addPageViewsNum($(<span class="string">".pageViews"</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><p><strong>最终效果：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200328050502.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JQuery </tag>
            
            <tag> LeanCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用ValineAdmin完善评论系统</title>
      <link href="/article/269.html"/>
      <url>/article/269.html</url>
      
        <content type="html"><![CDATA[<p>在更换主题后的这一段时间里，博客运行良好，内容我也在不断完善，评论自然是继承原来的 Valine 也运行正常，但是，其实从上个主题开始，我就没有配置邮件的评论系统，所以对于评论的查看，我一直都是登陆 LeanCloud 后台来完成的。当然，默认的邮件提醒我是配置了的，但那个太简陋了，几乎没有使用价值。关于 ValineAdmin，群友早就配置过了，这次终于轮到自己来配一下了。</p><a id="more"></a><h3 id="为什么我现在才配"><a href="#为什么我现在才配" class="headerlink" title="为什么我现在才配"></a><strong>为什么我现在才配</strong></h3><p>因为我一直有个误区，那就是完成该配置需要在LeanCloud完成实名认证，但实际是不需要的！<strong>配置 ValineAdmin 是不需要 LeanCloud 实名认证的！</strong>（目前我仍然没有进行实名认证）</p><p>而且依托于Valine使用的应用/仓库即可，完全没有其他要求。</p><h3 id="添加-ValineAdmin-步骤"><a href="#添加-ValineAdmin-步骤" class="headerlink" title="添加 ValineAdmin 步骤"></a><strong>添加 ValineAdmin 步骤</strong></h3><p><strong>明确：</strong></p><p>这里用的是“添加”，也就是说，ValineAdmin 和原来的 Valine 完全可以共存，互不影响，不需要重新配置。</p><h4 id="1-遵循-Valine-官方教程完成-Valine-的配置"><a href="#1-遵循-Valine-官方教程完成-Valine-的配置" class="headerlink" title="1. 遵循 Valine 官方教程完成 Valine 的配置"></a><strong>1. 遵循 Valine 官方教程完成 Valine 的配置</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;valine.js.org&#x2F;quickstart.html</span><br></pre></td></tr></table></figure><h4 id="2-进入配置页面"><a href="#2-进入配置页面" class="headerlink" title="2. 进入配置页面"></a><strong>2. 进入配置页面</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325221024.png"></fancybox><h4 id="3-源码部署填写以下仓库"><a href="#3-源码部署填写以下仓库" class="headerlink" title="3. 源码部署填写以下仓库"></a><strong>3. 源码部署填写以下仓库</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;DesertsP&#x2F;Valine-Admin.git</span><br></pre></td></tr></table></figure><h4 id="4-填写16个自定义变量"><a href="#4-填写16个自定义变量" class="headerlink" title="4. 填写16个自定义变量"></a><strong>4. 填写16个自定义变量</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325223141.png"></fancybox><p>注意事项：</p><ul><li>务必确认已开通SMTP服务，以QQ为例需要发送短信来获得授权码；</li><li>SMTP_USER 和 SENDER_EMAIL 务必正确<fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325224019.png"></fancybox></li><li><strong>AKISMET_KEY</strong> 请到<a href="https://akismet.com/" target="_blank" rel="external nofollow noopener noreferrer">akismet.com</a>注册并选择<strong>免费版</strong>获得秘钥，否则在LeanCloud实例日志内会出现“Akismet key 异常!”的错误。</li></ul><h4 id="5-给博主通知的邮件模板"><a href="#5-给博主通知的邮件模板" class="headerlink" title="5. 给博主通知的邮件模板"></a><strong>5. 给博主通知的邮件模板</strong></h4><ul><li>BLOGGER_EMAIL 就是博主的邮箱；</li><li>MAIL_SUBJECT_ADMIN 邮件标题；</li><li>MAIL_TEMPLATE_ADMIN 邮件正文，注意变量位置，其他完全是HTML标签，可自己重写：</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border-top:2px solid #12ADDB;box-shadow:0 1px 3px #AAAAAA;line-height:180%;padding:0 15px 12px;margin:50px auto;font-size:12px;"</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">"border-bottom:1px solid #DDD;font-size:14px;font-weight:normal;padding:13px 0 10px 0px;"</span>&gt;</span>您在<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"text-decoration:none;color: #12ADDB;"</span> <span class="attr">href</span>=<span class="string">"$&#123;SITE_URL&#125;"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>$&#123;SITE_NAME&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>上的文章有了新的评论<span class="tag">&lt;/<span class="name">h2</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>$&#123;NICK&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span>回复说：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;"</span>&gt;</span></span><br><span class="line">     $&#123;COMMENT&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span> 您可以点击<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"text-decoration:none; color:#12addb"</span> <span class="attr">href</span>=<span class="string">"$&#123;POST_URL&#125;"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>查看回复的完整內容<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>评论页面为<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>$&#123;POST_URL&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>效果：</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325231410.png"></fancybox><h4 id="6-给评论者通知的邮件模板"><a href="#6-给评论者通知的邮件模板" class="headerlink" title="6. 给评论者通知的邮件模板"></a><strong>6. 给评论者通知的邮件模板</strong></h4><ul><li>MAIL_SUBJECT 邮件标题，注意措辞；</li><li>MAIL_TEMPLATE 邮件正文，需要美化！</li><li><strong>不同于站长的通知邮件，这是给评论者看的，必须花里胡哨，这是面子工程！</strong></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border-radius: 10px 10px 10px 10px;font-size:13px; color: #555555;width: 666px;font-family:'Century Gothic','Trebuchet MS','Hiragino Sans GB',微软雅黑,'Microsoft Yahei',Tahoma,Helvetica,Arial,'SimSun',sans-serif;margin:50px auto;border:1px solid #eee;max-width:100%;background: #ffffff repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 1px 5px rgba(0, 0, 0, 0.15);"</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"width:100%;background:#49BDAD;color:#ffffff;border-radius: 10px 10px 0 0;background-image: -moz-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));background-image: -webkit-linear-gradient(0deg, rgb(67, 198, 184), rgb(255, 209, 244));height: 66px;"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"font-size:15px;word-break:break-all;padding: 23px 32px;margin:0;background-color: hsla(0,0%,100%,.4);border-radius: 10px 10px 0 0;color:#257db9"</span>&gt;</span>您在<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"text-decoration:none;color:#257db9"</span> <span class="attr">href</span>=<span class="string">"$&#123;SITE_URL&#125;"</span>&gt;</span>「程序萌部落」<span class="tag">&lt;/<span class="name">a</span>&gt;</span>上的留言有新回复啦！<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin:40px auto;width:90%"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>尊敬的 <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:#7777ff"</span>&gt;</span>$&#123;PARENT_NICK&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 您好，您曾在该页面/文章：<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;"</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">b</span>&gt;</span>$&#123;POST_URL&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>发布了如下评论：<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;"</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">b</span>&gt;</span>$&#123;PARENT_COMMENT&#125; <span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>刚刚，用户 <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:#7777ff"</span>&gt;</span>$&#123;NICK&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span> 给您的回复如下：<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background: #fafafa repeating-linear-gradient(-45deg,#fff,#fff 1.125rem,transparent 1.125rem,transparent 2.25rem);box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);margin:20px 0px;padding:15px;border-radius:5px;font-size:14px;color:#555555;"</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">b</span>&gt;</span>$&#123;COMMENT&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>您可以点击 <span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"text-decoration:none; color:#d25353"</span> <span class="attr">href</span>=<span class="string">"$&#123;POST_URL&#125;#comments"</span>&gt;</span>查看回复的完整內容<span class="tag">&lt;/<span class="name">a</span>&gt;</span>，欢迎再次光临<span class="tag">&lt;<span class="name">a</span> <span class="attr">style</span>=<span class="string">"text-decoration:none; color:#257db9"</span> <span class="attr">href</span>=<span class="string">"$&#123;SITE_URL&#125;"</span>&gt;</span> $&#123;SITE_NAME&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>。<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>&#123;<span class="attribute">text-decoration</span>:none&#125;<span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;<span class="attribute">text-decoration</span>:none&#125;<span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">text-decoration</span>:none&#125;<span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;<span class="attribute">text-decoration</span>:none&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">center</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">b</span>&gt;</span>由LeanCloud强力驱动<span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">b</span>&gt;</span>Copyright <span class="symbol">&amp;copy;</span> 2017-2020 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.cxmoe.com"</span> <span class="attr">style</span>=<span class="string">"color:auto;"</span>&gt;</span>CZ5H.COM<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://www.cxmoe.com"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">"height:25px !important;"</span> <span class="attr">src</span>=<span class="string">"https://i.loli.net/2020/03/25/NbrlqVpzLBj8Xta.png"</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">center</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span> /&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>收到邮件的评论者看到的效果：</strong></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325231904.png"></fancybox><h4 id="7-变量填写完毕后部署"><a href="#7-变量填写完毕后部署" class="headerlink" title="7. 变量填写完毕后部署"></a><strong>7. 变量填写完毕后部署</strong></h4><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200325230147.png"></fancybox><h4 id="完成之后的问题"><a href="#完成之后的问题" class="headerlink" title="完成之后的问题"></a><strong>完成之后的问题</strong></h4><p>以上全部完成，基本可以实现比较友善的评论系统，但仍然存在一个大问题：</p><p><strong>LeanCloud 的强制休眠！</strong></p><p>该休眠会导致有很大概率用户在评论时实例是休眠状态，从而导致邮件提醒的不可触发，即以上整个邮件系统并不是 100% 可用，迫切需要一种比较好的休眠策略。（好像每天必须休眠6小时）</p><p><strong>可能的解决措施：</strong></p><p>使用定时器激活：<code>*/20 7-23 * * *</code></p><fancybox><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200326233829.png"></fancybox><h3 id="附录，文字版"><a href="#附录，文字版" class="headerlink" title="附录，文字版"></a><strong>附录，文字版</strong></h3><p><strong>自定义环境变量：</strong></p><table><thead><tr><th align="left">NAME</th><th align="left">VALUE</th><th align="left">备注</th><th align="right">NO.</th></tr></thead><tbody><tr><td align="left"><code>SITE_NAME</code></td><td align="left"><code>程序萌部落(cz5h.com)</code></td><td align="left"><code>基本信息</code></td><td align="right"><code>01</code></td></tr><tr><td align="left"><code>SITE_URL</code></td><td align="left"><code>https://www.cxmoe.com</code></td><td align="left"><code>基本信息</code></td><td align="right"><code>02</code></td></tr><tr><td align="left"><code>SENDER_NAME</code></td><td align="left"><code>胖五</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>03</code></td></tr><tr><td align="left"><code>SENDER_EMAIL</code></td><td align="left"><code>tian*****@qq.com</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>04</code></td></tr><tr><td align="left"><code>SMTP_USER</code></td><td align="left"><code>tian*****@qq.com</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>05</code></td></tr><tr><td align="left"><code>SMTP_PASS</code></td><td align="left"><code>rekyxiqasdo*****</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>06</code></td></tr><tr><td align="left"><code>SMTP_SERVICE</code></td><td align="left"><code>QQ</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>07</code></td></tr><tr><td align="left"><code>SMTP_HOST</code></td><td align="left"><code>smtp.qq.com</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>08</code></td></tr><tr><td align="left"><code>SMTP_PORT</code></td><td align="left"><code>465</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>09</code></td></tr><tr><td align="left"><code>SMTP_SECURE</code></td><td align="left"><code>true</code></td><td align="left"><code>SMTP配置</code></td><td align="right"><code>10</code></td></tr><tr><td align="left"><code>BLOGGER_EMAIL</code></td><td align="left"><code>tian*****@qq.com</code></td><td align="left"><code>站长通知</code></td><td align="right"><code>11</code></td></tr><tr><td align="left"><code>MAIL_SUBJECT_ADMIN</code></td><td align="left"><code>${SITE_NAME}上有新评论！</code></td><td align="left"><code>站长通知</code></td><td align="right"><code>12</code></td></tr><tr><td align="left"><code>MAIL_TEMPLATE_ADMIN</code></td><td align="left"><a href="#5-%E7%BB%99%E5%8D%9A%E4%B8%BB%E9%80%9A%E7%9F%A5%E7%9A%84%E9%82%AE%E4%BB%B6%E6%A8%A1%E6%9D%BF">详见第五段代码</a></td><td align="left"><code>站长通知</code></td><td align="right"><code>13</code></td></tr><tr><td align="left"><code>MAIL_SUBJECT</code></td><td align="left"><code>尊敬的『${PARENT_NICK}』，您在${SITE_NAME}上的评论刚刚收到了一条新回复！</code></td><td align="left"><code>用户通知</code></td><td align="right"><code>14</code></td></tr><tr><td align="left"><code>MAIL_TEMPLATE</code></td><td align="left"><a href="#6-%E7%BB%99%E8%AF%84%E8%AE%BA%E8%80%85%E9%80%9A%E7%9F%A5%E7%9A%84%E9%82%AE%E4%BB%B6%E6%A8%A1%E6%9D%BF">详见第六段代码</a></td><td align="left"><code>用户通知</code></td><td align="right"><code>15</code></td></tr><tr><td align="left"><code>AKISMET_KEY</code></td><td align="left"><code>4b02d0d*****</code></td><td align="left"><code>评论过滤</code></td><td align="right"><code>16</code></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Valine </tag>
            
            <tag> LeanCloud </tag>
            
            <tag> 评论系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在中文维基百科新建用户框</title>
      <link href="/article/27ff.html"/>
      <url>/article/27ff.html</url>
      
        <content type="html"><![CDATA[<p>目前中文维基百科仍然由于某些原因无法在大陆被直接访问，但仍然有很多用户喜欢使用Wikipedia，关于Wiki，我的理解就是个协作的知识系统，可以多人编辑并且多人维护，这也是维基百科实际的壮大方式，非常浅显的方式但却在当时引领了一种新的内容组织方式，所以维基百科也就不断壮大。中文维基百科和原本的英文维基并不是镜像，属于交集模式，目前有专门的翻译小组做互相翻译的工作。</p><a id="more"></a><p>由以上我们也可以得知，其实维基百科的模式“可以被复制”，但这是个市场占有问题，你可以自建自己的Wiki服务，但不太可能壮大至维基百科的规模，但也有例外，比如 <a href="https://zh.moegirl.org/zh-hant/Mainpage" target="_blank" rel="external nofollow noopener noreferrer">萌娘百科</a>，但很显然，这是和普通百科几乎无交集的专业百科。扯远了…</p><p>对于用户框，就是种维基百科内自定义的显示框，可以直观的以词条的方式来展示用户的各方面，主要用来描述<strong>用户</strong>的属性，可以包罗万象，因为维基百科允许自建用户框，由此，各式各样的用户框被用户创造出来，一般你可以找到你想要的用户框。</p><h3 id="搜索现有用户框方式一"><a href="#搜索现有用户框方式一" class="headerlink" title="搜索现有用户框方式一"></a><strong>搜索现有用户框方式一</strong></h3><p><strong>注意：以下若出现Wiki或者维基百科均特指“中文维基百科”</strong></p><p><strong>1. 使用[Category:]来当种子</strong></p><ul><li>这样可以直接找到一类人，然后通过类别可以打开该类别下的全部用户<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319011030.png" alt><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319011237.png" alt></li></ul><p><strong>2. 拷贝该用户页面内的用户框</strong></p><ul><li>点击编辑找到对应内容即可，如果你偷懒，完全可以全部拷贝一份，然后再去掉你不需要的词条。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319033335.png" alt></li></ul><h3 id="搜索现有用户框方式二"><a href="#搜索现有用户框方式二" class="headerlink" title="搜索现有用户框方式二"></a><strong>搜索现有用户框方式二</strong></h3><p>通过<a href="https://zh.wikipedia.org/wiki/Category:%E7%BB%B4%E5%9F%BA%E7%99%BE%E7%A7%91%E7%94%A8%E6%88%B7%E6%A1%86" target="_blank" rel="external nofollow noopener noreferrer">维基百科用户框</a>汇总类别进行搜寻。</p><br><hr><br><p>那么如果某个用户框并不存在怎么办呢？当然可以自建，因为现存的用户框都是不同的用户自建的，当然你也可以创建你自己想展示的用户框。</p><p>在创建的过程中，需要注意几点：</p><ul><li>图片资源必须是维基百科的内部资源，也就是说，你必须将图片传到维基百科上，使用维基百科的内链才可以。</li><li>创建后的用户框可以被全部用户所搜索到并使用</li></ul><h3 id="创建新用户框的简单版一"><a href="#创建新用户框的简单版一" class="headerlink" title="创建新用户框的简单版一"></a><strong>创建新用户框的简单版一</strong></h3><p><code>图片+文字模式</code></p><h4 id="学习简单例子“非吸烟者”"><a href="#学习简单例子“非吸烟者”" class="headerlink" title="学习简单例子“非吸烟者”"></a><strong>学习简单例子“非吸烟者”</strong></h4><p><a href="https://zh.wikipedia.org/wiki/Template:User_%E9%9D%9E%E5%90%B8%E7%85%99%E8%80%85" target="_blank" rel="external nofollow noopener noreferrer">Template:User 非吸烟者</a></p><p>以上是用户框的固定格式，Template:User 后跟空格，再跟用户框名称，填入搜索框就可以搜出该用户框详细内容：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319014000.png" alt></p><p>点击编辑，即可看到这个用户框的源代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Userbox</span><br><span class="line">|id&#x3D; [[File:No smoking symbol.svg|45px]]</span><br><span class="line">|id-c&#x3D; #FFFFFF</span><br><span class="line">|info&#x3D; 这个用户&#39;&#39;&#39;[[吸烟|&lt;span style&#x3D;&quot;color:#0000FF;&quot;&gt;不吸烟&lt;&#x2F;span&gt;]]&#39;&#39;&#39;。</span><br><span class="line">|info-c&#x3D; #789CFF</span><br><span class="line">|info-s&#x3D; 10</span><br><span class="line">|info-fc&#x3D; #2E2E2E</span><br><span class="line">|border-c&#x3D; #000000</span><br><span class="line">&#125;&#125;&lt;includeonly&gt;[[Category:不吸烟的维基人]]&lt;&#x2F;includeonly&gt;&lt;noinclude&gt;</span><br><span class="line">&#123;&#123;Documentation&#125;&#125;</span><br><span class="line">&lt;&#x2F;noinclude&gt;</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="代码解读"><a href="#代码解读" class="headerlink" title="代码解读"></a><strong>代码解读</strong></h4><p>现在我们就可以得出构建方法了，对应上述内容每条的意义如下。</p><p><code>File:No smoking symbol.svg|45px</code></p><p>左侧贴图和贴图大小，一般是45×45，这个图片必须是属于维基百科站内的图片链接，如果你要用自己的图片，可以先上传到维基百科上，但一般偷懒可以直接搜索维基百科内已有的图片，直接复制图片链接改为 File:XX 的形式即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319014827.png" alt></p><p><code>id-c= #FFFFFF</code></p><p>左侧贴图图片的背景颜色（如果背景透明）。</p><p><code>info= AAA&#39;&#39;&#39;[[BBB|CCC]]&#39;&#39;&#39;</code></p><p>AAA：正常文本。</p><p>‘’’[[BBB|CCC]]’’’：这是维基百科的超链接语法，写BBB即表明超链接为 zh.wikipedia.org/wiki/BBB，竖线（|）之后的CCC是超链接的文本，可以写入html代码，比如用<span>控制文字的颜色。</span></p><p><code>info-c= #789CFF</code></p><p>右侧文本部分的背景颜色。</p><p><code>info-s= 10</code></p><p>右侧文本字体大小，一般是10。</p><p><code>info-fc= #2E2E2E</code></p><p>右侧普通文本字体颜色，使用html样式控制的字体的大小和颜色不受影响。</p><p><code>border-c= #000000</code></p><p>整个用户框的边框颜色，一般是黑色。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Userbox</span><br><span class="line">  ...</span><br><span class="line">&#125;&#125;</span><br><span class="line">&lt;includeonly&gt;</span><br><span class="line">    [[Category:不吸烟的维基人]]</span><br><span class="line">&lt;&#x2F;includeonly&gt;&lt;noinclude&gt;</span><br><span class="line">&#123;&#123;Documentation&#125;&#125;</span><br><span class="line">&lt;&#x2F;noinclude&gt;</span><br></pre></td></tr></table></figure><p>以上内容是整体的必要的用户框结构。</p><h4 id="以此新建用户框"><a href="#以此新建用户框" class="headerlink" title="以此新建用户框"></a><strong>以此新建用户框</strong></h4><p>比如我现在新建<strong>“这个用户喜欢使用Hexo搭建博客”</strong>这个用户框，基本步骤有以下几步：</p><ul><li><strong>1. 获取图片链接</strong></li></ul><p>懒得找，直接上传一张Hexo图片，按照引导上传即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319021539.png" alt></p><p>选择本地上传即可，即只上传至中文维基。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319022139.png" alt></p><p>上传成功我们就可以拿到文件链接了，此处文本链接就是 <a href="https://zh.wikipedia.org/wiki/File:Hexo-logo.png" target="_blank" rel="external nofollow noopener noreferrer">https://zh.wikipedia.org/wiki/File:Hexo-logo.png</a>，我们构造用户框只需要使用最后的那部分，即 File:Hexo-logo.png。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319022253.png" alt></p><ul><li><strong>2. 新建用户框词条</strong></li></ul><p>比如我们的用户框名称就叫<strong>Template:User 静态博客</strong>，那么就直接去搜索框搜索，然后进入新建页面。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319023128.png" alt></p><ul><li><strong>3. 构造代码</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Userbox</span><br><span class="line">|id&#x3D; [[File:Hexo-logo.png|45px]]</span><br><span class="line">|id-c&#x3D; #FFFFFF</span><br><span class="line">|info&#x3D; 这个用户喜欢使用&#39;&#39;&#39;[[Github|&lt;span style&#x3D;&quot;color:#0000FF;&quot;&gt;HEXO&lt;&#x2F;span&gt;]]&#39;&#39;&#39;搭建博客。</span><br><span class="line">|info-c&#x3D; #66ccff</span><br><span class="line">|info-s&#x3D; 10</span><br><span class="line">|info-fc&#x3D; #2E2E2E</span><br><span class="line">|border-c&#x3D; #000000</span><br><span class="line">&#125;&#125;&lt;includeonly&gt;[[Category:使用hexo的维基人]]&lt;&#x2F;includeonly&gt;&lt;noinclude&gt;</span><br><span class="line">&#123;&#123;Documentation&#125;&#125;</span><br><span class="line">&lt;&#x2F;noinclude&gt;</span><br></pre></td></tr></table></figure><p>注意：以上内容的Category并非我新建的，这是已有的分类，当然也可以新建分类，但最好的选择是讲我们新建的用户框归入其他已有分类，这样可以使更多人发现我们的用户框。</p><ul><li><strong>4. 填入词条新建页面</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319033547.png" alt></p><p>预览无误，点击发布即可获得最终的新鲜的用户框：<a href="https://zh.wikipedia.org/wiki/Template:User_%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2" target="_blank" rel="external nofollow noopener noreferrer">Template:User_静态博客</a>。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200319023802.png" alt></p><ul><li><strong>5. 使用</strong></li></ul><p>在所有的Wiki页面中，使用  {{User 静态博客}}  即可插入上述用户框了！</p><h3 id="创建新用户框的简单版二"><a href="#创建新用户框的简单版二" class="headerlink" title="创建新用户框的简单版二"></a><strong>创建新用户框的简单版二</strong></h3><p><strong>文字+文字模式</strong> </p><p>挖坑。</p><h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a><strong>进阶</strong></h3><p>挖坑。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中文维基 </tag>
            
            <tag> 花里胡哨 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>船新版本的个人博客</title>
      <link href="/article/6f83.html"/>
      <url>/article/6f83.html</url>
      
        <content type="html"><![CDATA[<p>终于花了些时间，把博客整体迁移到新主题Volantis了，原主题Indigo我还是非常喜欢，但感觉有点朴素，自己又瞎改主题改到无法更新最新版本，所以换个好看的主题就成了待办事项之一。</p><a id="more"></a><p>此外，原先的博客一直托管在Github Pages，在百度是0索引的，这就意味着国内搜索引擎是无法找到我的，所以换到Coding托管，也成了待办事项之一；最后，我也一直在物色好的域名，现在都快成米商了，不过还是找到了一个不错的域名，更新解析，也是待办事项之一。最终，昨天把三件事全做了，在这里记录下，顺便说一下博客一般需要的一些辅助显示模块。</p><h4 id="使用Volantis主题"><a href="#使用Volantis主题" class="headerlink" title="使用Volantis主题"></a><strong>使用Volantis主题</strong></h4><p>注意：我这里并不是单纯的“更新”，而是保留原站点的前提下用一个新主题而已，因为 Indigo 主题确实非常好用，并且自己也对其做了很多改动，已经比较稳定了，没必要丢弃不用，所以后面我用了二级域名 old.cz5h.com 来解析到原来的 Github 空间，对于新主题，我也只是把_post内的文章搞过来了而已，其他的小模块还需要慢慢完善，至于有哪些小模块，在文章最后会详细说明。</p><p>这次我换的主题是 Volantis，貌似是原先的 Materi-X （可能拼错了）主题，本来想用 butterfly 的，但是 bf 还是有点花哨，最终我感觉目前的这个主题比较不错，而且是有主页的主题哦！</p><p>新建个博客文件夹，hexo init，然后 clone 新主题，然后把 _post 复制过来，然后安装必要的主题插件，然后安装 deploy 插件，最后开始配置 yml 站点配置文件和主题配置文件（两个）：</p><ul><li>比对原站点的配置文件先修改一部分；</li><li>看到无关链接（主题自带的链接）或文字，要么注释掉要么改成你自己的；</li><li>修改 yml 配置文件后要 hexo s 本地测试下，如此反复；</li><li>填写一些和旧站点不一样的配置项，比如 deploy。</li></ul><p>完成之后，还要注意搜索并替换一下 post 文章文件夹中的旧域名，现在要统一换成新域名，虽然不换也可以访问到（做了重定向），但既然准备用这个新域名了，那就得做好逐渐清退旧域名的措施，首先就是文章内的链接内容。旧站点由于用 old.cz5h.com 来绑定了，所以也要把旧站点内（notepad++全局搜索替换）的 zonelyn.com 全部换成 old.cz5h.com。最终的解析托管示意图如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200228170857.png" alt></p><h4 id="换域名和旧域名重定向"><a href="#换域名和旧域名重定向" class="headerlink" title="换域名和旧域名重定向"></a><strong>换域名和旧域名重定向</strong></h4><p>目前手里的域名有六个，时间分先后，要是有看上的，欢迎联系我啊。</p><ul><li>whereareyou.site（301-&gt;zonelyn-&gt;cz5h）</li><li>z-tian.cn（未解析）</li><li>tzloop.cn（未解析）</li><li>zonelyn.com（301-&gt;cz5h）</li><li>cxmoe.com（挂了篇文章）</li><li>cz5h.com（主站）</li></ul><p>只用Github/Coding托管如何完成301重定向呢？答案是借助Pages服务+404页面，具体可以参见我之前写的 <a href="https://cz5h.com/article/2019-8-4%20Github%E6%89%98%E7%AE%A1%E7%AB%99%E7%82%B9%E7%9A%84%E5%9F%9F%E5%90%8D%E6%9B%B4%E6%8D%A2.html" target="_blank" rel="external nofollow noopener noreferrer">Github托管站点的域名更换</a>。</p><p>为了偷懒，我并没有更新最老的 whereareyou.site 这个域名的重定向，它还是被重定向到 zonelyn.com，因为我给 zonelyn 做了重定向，所以，最终连续两跳，whereareyou.site 还是能重定向到 cz5h.com。是的，你没猜错，两个域名重定向，我注册了两个Github小号。还有，虽然是从Github-&gt;重定向到了Coding的空间，但我实际体验完全感觉不出来，果然是单向墙。</p><p>Coding的域名绑定就很简单了，解析个A记录和WWW记录就OK了。</p><p><strong>二级域名 old.cz5h.com ：</strong>本来是不想动原来的域名的（因为用了新域名），但想了一下还是正规一点吧，而且也方便日后管理，所以就把 Github 托管的旧版本绑定了新域名的二级域名，最终域名的解析如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200227185839.png" alt></p><p>完成之后还要去 Github Pages 修改绑定的域名，同时注意需要将之前旧域名的解析一并删除，否则 Pages 服务会提醒报错的。</p><h4 id="博客模块之我见"><a href="#博客模块之我见" class="headerlink" title="博客模块之我见"></a><strong>博客模块之我见</strong></h4><p>本次也算是从零开始新建一个博客站点，当然对博客的美化也要从零开始，那么到底需要改动什么呢，简单写一下我的想法。（基本仅针对目前的Volantis主题）</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h5 id="主题色调"><a href="#主题色调" class="headerlink" title="主题色调"></a><strong>主题色调</strong></h5><ul><li>背景图：深色调还是浅色调，决定着前景标签内容的浅色调还是深色调。鄙人非常喜欢深色调的背景色，更可以突出文章主体的文字部分。</li><li>各种语法的颜色搭配：例如 tab 缩进的 code 段落，不同的主题样式肯定不同，我又很喜欢用这种方式写，所以要修改下对应的颜色搭配。</li><li>滚动条的样式：又宽又粗的滚动条实在是太丑了，必须要换掉。</li><li>整个页面 content 的宽度：目前很多主题的文章页宽度很窄，在台式机上看着更严重，所以一定要调宽一些，还更利于图片的展示。</li></ul><h5 id="访问统计"><a href="#访问统计" class="headerlink" title="访问统计"></a><strong>访问统计</strong></h5><p>这是一个重要的功能，但比较好加入。一般添加个不蒜子就可以了，但我喜欢追踪自己网站的访客，所以，我添加了 Google Analyse、百度统计、CNZZ的统计，并且加入了 revolvermaps 可视化小插件来做实时显示。</p><p><strong>其他：</strong>注意SEO用的sitemap需要重新生成，还有robots.txt也要重新搞。</p><h5 id="Posts属性类显示"><a href="#Posts属性类显示" class="headerlink" title="Posts属性类显示"></a><strong>Posts属性类显示</strong></h5><p>博客必备的一个部分，这个包括标签云、分类统计等，可以方便的放在这个主题右侧的插件部分。</p><h5 id="文章页的署名信息"><a href="#文章页的署名信息" class="headerlink" title="文章页的署名信息"></a><strong>文章页的署名信息</strong></h5><p>这个要根据自己的调整，最好要包含这部分。</p><h5 id="评论部分"><a href="#评论部分" class="headerlink" title="评论部分"></a><strong>评论部分</strong></h5><p>思来想后，还是决定采用Valine做评论吧，Gitalk得登陆啊，可有人连Github是什么都不知道，我的博客又不是正经的技术博客，所以…Valine真香。</p><h5 id="站点的头脚"><a href="#站点的头脚" class="headerlink" title="站点的头脚"></a><strong>站点的头脚</strong></h5><p><strong>前置index：</strong>虽然不是纯首页，但基本起到首页的作用了，而且效果还不错，准备把一些社交链接放在首页上。</p><p><strong>Header：</strong>这里对应旧站点的自定义页面，由于原先旧站点有些主题的自定义语法，所以直接拿过来会解析出错误，得花时间重新写一下这些自定义页面。</p><p><strong>Footer：</strong>由于用了深色背景，目前的页脚全黑的基本看不到东西，准备还是类似旧站点那样，在页脚写上基本信息，以及友链的链接，然后放上<strong>访问人数统计</strong>和<strong>全站文字统计</strong>的文本。</p><h5 id="SEO完善"><a href="#SEO完善" class="headerlink" title="SEO完善"></a><strong>SEO完善</strong></h5><p>默认的新建站点是没有这些SEO相关的文件的，需要借助第三方插件在渲染时生成 sitemap.xml 和 baidu_sitemap.xml，然后还需要自己新建一个 robots.txt 文件，因为是 hexo 站点，所以在生成xml文件之后，这个 robots.txt 文件的内容基本上是固定的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Allow: &#x2F;</span><br><span class="line">Allow: &#x2F;archives&#x2F;</span><br><span class="line">Allow: &#x2F;categories&#x2F;</span><br><span class="line">Allow: &#x2F;tags&#x2F;</span><br><span class="line">Allow: &#x2F;about&#x2F;</span><br><span class="line">Disallow: &#x2F;vendors&#x2F;</span><br><span class="line">Disallow: &#x2F;js&#x2F;</span><br><span class="line">Disallow: &#x2F;css&#x2F;</span><br><span class="line">Disallow: &#x2F;fonts&#x2F;</span><br><span class="line">Disallow: &#x2F;fancybox&#x2F;</span><br><span class="line">Sitemap: https:&#x2F;&#x2F;你的域名&#x2F;sitemap.xml</span><br><span class="line">Sitemap: https:&#x2F;&#x2F;你的域名&#x2F;baidusitemap.xml</span><br></pre></td></tr></table></figure><p>注意：以上文件放在 hexo 的source文件夹或者主题的source文件夹里都可以；另外，这里如果有自定义的路径，比如 /friends/（友链），也需要将其加入进去（添加新的 Allow 项），否则蜘蛛是不能爬到相关页面的。</p><h5 id="恢复卡片的tags"><a href="#恢复卡片的tags" class="headerlink" title="恢复卡片的tags"></a><strong>恢复卡片的tags</strong></h5><p>这是后续的改进了，现在的首页文章卡片没有标签信息，但我想把标签信息加上，这样会更加详细一点，初步想法就是在卡片的底部加个footer，然后把当前文章的tags读出来放到上面，再把footer贴到原来的卡片最下面。</p><h5 id="进阶的功能"><a href="#进阶的功能" class="headerlink" title="进阶的功能"></a><strong>进阶的功能</strong></h5><p><strong>相关文章：</strong>貌似这个主题支持。<br><strong>热门文章：</strong>调用统计的接口把。</p><p>还有很多功能可能主题内就带着，毕竟只接触了这个主题一天而已，后续慢慢探索，初步的感觉是这个主题比较完善，支持非常多的扩展功能（已经写好了），而且貌似作者还在更新这个项目。</p><h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h4><p>这也算半个新的开始吧，目前自己已经在博客里写了不少东西了，原先的主题也看厌烦了，本来是想用 typecho 的，但想了下还得备案，所以干脆不用了，还是用回老本行 hexo 吧，而且现在各种操作非常熟练了，写作模式也基本固定了（自从前几天确定用Github+jsdeliver当图床后）。搬回 coding 后，以后在百度就能见到我了，而且我在外网访问 coding 的站点没任何卡顿，希望 coding 的 pages 服务比以前提升了，可不要让我失望啊！</p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Indigo </tag>
            
            <tag> Volantis </tag>
            
            <tag> 重定向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>优雅的备份博客内的外链图片</title>
      <link href="/article/509f.html"/>
      <url>/article/509f.html</url>
      
        <content type="html"><![CDATA[<p>这是我早就想做的一件事情了，但没想到不得不做这件事的这一天这么快就来临了。其实从一开始，我就对免费图床并不放心，在国内一直使用的是付费的作业部落的图片存储（阿里云的对象存储），但到外面以后作业部落已经实质性歇菜了，只得找其他的替代产品，这时我才真正意义上的接触并使用到了免费图床。先后用过sm.ms、微博图床、即刻图床（聚合性质的单一图床），直到有一天…</p><a id="more"></a><p>我的几篇文章的图片打不开了！于此，我是非常惊恐的，因为这些图片往往是信手拈来，上传即丢，本地并没有备份，这样显示突然显示不出来，你让我怎么找补，太难受了，遂将备份图片的事情提上日程。</p><h4 id="备份Hexo博客的全部图片"><a href="#备份Hexo博客的全部图片" class="headerlink" title="备份Hexo博客的全部图片"></a>备份Hexo博客的全部图片</h4><p>这是我感觉还算可以的、比较傻瓜式的一种解决方案。不需要安装任何软件和环境，全部借助Chrome插件完成。思路简单来说，就是先把全部的博客页面打开，然后使用图片抓取插件把打开的页面中的图片全部下载下来。很疯狂吧！</p><ul><li><a href="https://chrome.google.com/webstore/detail/linkclump/lfpjkncokllnfokkgpkobnkbkmelfefj" target="_blank" rel="external nofollow noopener noreferrer"><strong>Linkclump</strong></a></li></ul><p><img src="https://pic.imgdb.cn/item/5e55a9f96127cc0713bd2f39.jpg" alt></p><p>这是个批量打开链接的插件，可以在页面上框选，会自动识别网页链接（很棒的一点是可以过滤掉中转页面），然后同时在Chrome中打开，接下来就要用到图片抓取插件了。</p><ul><li><a href="https://chrome.google.com/webstore/detail/fatkun-batch-download-ima/nnjjahlikiabnchcpehcpkdeckfgnohf" target="_blank" rel="external nofollow noopener noreferrer"><strong>Fatkun图片批量下载</strong></a></li></ul><p><img src="https://pic.imgdb.cn/item/5e55b0176127cc0713be59d0.jpg" alt></p><p>这个插件可以直接搜刮浏览器内打开的页面内的全部图片，然后我们就可以下载这些图片了，注意这个工具可以按照像素值过滤图片，这样对一些很小的图片（比如恶心的百度统计的加载图hm）就可以排除在外。下载后的图片被放置在以页面命名的文件夹内，还是比较人性化的。</p><p>总结来说，其实上述操作相当于冷备份，可能我并不会用到这些图片，但当某些外链坏掉时，那么我就有本地备份可以替换，不然就像我这次一样，图片丢了找都找不回来了。</p><h4 id="找补缺损图片"><a href="#找补缺损图片" class="headerlink" title="找补缺损图片"></a>找补缺损图片</h4><p>这真的很难，我只能有部分重新截图了，还有小部分是存在微博相册的，这部分图片还在相册里，只是微博防盗链了。丢的那部分基本是用即刻图床传到阿里云的图床上了，但目前那批图片全挂了，涉及的文章可能有五六篇。</p><h4 id="目前使用的稳妥的方案"><a href="#目前使用的稳妥的方案" class="headerlink" title="目前使用的稳妥的方案"></a><strong>目前使用的稳妥的方案</strong></h4><p>目前所使用的是一款聚合图床，这个不同于“聚合性质的单一图床”，而应该是“分发多地的聚合图床”，即其会将图片分发到多个图床之上（没错，还是多个免费图床），这样虽然单一图床有挂掉的风险，但三个（其目前的分发数量）图床同时挂掉的风险基本很小，而且其还提供上传记录来允许用户进行追溯，当然也可以定期输出备份。</p><p><img src="https://pic.imgdb.cn/item/5e55a55d6127cc0713bcc207.jpg" alt></p><p>我不确定这个图床的存活时间，但理论上其不是个图床，只是个聚合索引平台，所以无论他倒不倒闭，只要把我上传历史的列表给我保留就OK。</p><p><img src="https://pic.imgdb.cn/item/5e55aa5c6127cc0713bd38c3.jpg" alt></p><p><strong>使用痛点：</strong>图片会压缩，上传慢，仍然看不到图片的原文件。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="GitHub-jsDelivr-PicGo"><a href="#GitHub-jsDelivr-PicGo" class="headerlink" title="GitHub+jsDelivr+PicGo"></a><strong>GitHub+jsDelivr+PicGo</strong></h4><p>先马一个<a href="https://segmentfault.com/a/1190000020240864" target="_blank" rel="external nofollow noopener noreferrer">教程</a>。</p><p>貌似这是我所追求的终极方案：我可以忍受图片挂掉（jsDelivr过滤了），但同时全部图片在GitHub的仓库里，图片的安全性不用担心，备份+外链一举两得。</p><p><strong>但目前我的使用痛点是：</strong>PicGo貌似只能以桌面客户端的形式进行配置，然后才能进行图床的搭建，但我目前用了两台台式+一台笔记本三个电脑，且Linux和Windows混用，或者说，我想在任何一台机器上不用配置就完成上传，显然目前好像是实现不了的。所以暂时观望一下，不过仍然是未来的尝试方向，Githuh仓库存图片太适合我这种小博客了，图不多，又安全。</p><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h4><p>不用纠结了，直接用上了，花了十几分钟就配置好了，好像很简单。具体步骤如下：</p><ul><li>下载安装<a href="https://github.com/Molunerfinn/picgo/releases" target="_blank" rel="external nofollow noopener noreferrer">PicGO</a>，</li><li>新建个Github仓库，专门用来存储图片，</li><li>新建token，在 Setting/Developer Setting 里，<br><img src="https://pic.imgdb.cn/item/5e55b5486127cc0713befdcf.jpg" alt></li><li>打开安装好的PicGo，选择上传图床为 Github图床，然后进行配置，<br><img src="https://pic.imgdb.cn/item/5e55b7e46127cc0713bf3e58.jpg" alt></li><li>完毕。</li></ul><p>实验了一下，简直不要太好用，海外党的福音啊，上传非常快，而且比较易用，最关键的是不压缩！！没有质量损失！！下面这张图片就是放在Github图床的。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/20200226013518.png" alt></p><p><strong>感受一下 Github + jsDelivr 的绝佳体验吧</strong></p><p>下图就是放在Github的19.8M的长幅：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/IMG_20191026_141350-2.jpg" alt></p><p>第二个例子：带文字的QQ截图：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200226014944.png" alt></p><p><strong>放在我用的聚合图床的体验如下</strong></p><p>所使用的图床给他压缩成了3.9M：</p><p><img src="https://pic.imgdb.cn/item/5e55ba166127cc0713bf7272.jpg" alt></p><p>第二个例子：带文字的QQ截图：</p><p><img src="https://pic.imgdb.cn/item/5e55c0a46127cc0713c0447e.jpg" alt></p><p><strong>直观的比较（肉眼其实看不太出来，但某些图片差异会比较明显）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200226020006.png" alt></p><p><strong>总结：从今天开始，Github + jsDelivr 就是我的御用图床了，除非它俩死一个，否则我不会再换图床了！还有个漫长的工作，就是把图片全部迁移到 Github 上！</strong></p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 图床 </tag>
            
            <tag> Chrome插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建CUDA项目二周目翻车记录</title>
      <link href="/article/c85a.html"/>
      <url>/article/c85a.html</url>
      
        <content type="html"><![CDATA[<p>继上次的翻车之后，我算是有了些经验，同时机器上也装了些共通的依赖库，由于上项目最后的错误解决不了就放那里了，开始搞一下这个项目，这和上一个项目的目的是一样的，都是借助GPU进行加速计算的可视化工具，但此项目是用netbeans开发的，在文件结构上要比上一个复杂的多，而且采用的是CMakeList.txt的方式，应该算比较正式的C++项目了吧。</p><a id="more"></a><h4 id="题外话：nvcc和nvidia-smi显示的cuda版本不一样"><a href="#题外话：nvcc和nvidia-smi显示的cuda版本不一样" class="headerlink" title="题外话：nvcc和nvidia-smi显示的cuda版本不一样"></a><strong>题外话：nvcc和nvidia-smi显示的cuda版本不一样</strong></h4><p>这个问题最终被确定和程序运行的错误无关，但碰巧发现了，总觉得不一样怪怪的，而不一样的原因其实很简单，可以理解为一个版本是程序用的软件运行的Cuda版本，而另一个是开发用的Cuda版本。更多内容可以参见<a href="https://xbuba.com/questions/53422407" target="_blank" rel="external nofollow noopener noreferrer">这个帖子</a></p><p><img src="https://pic.imgdb.cn/item/5e554c3b6127cc0713b34bbb.jpg" alt></p><p>具体来说，就是确保Cuda安装后添加PATH：添加Cuda Bin的$PATH（即将以下行添加到您的~/.bashrc）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.1&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;cuda-10.1&#x2F;NsightCompute-2019.1$&#123;PATH:+:$&#123;PATH&#125;&#125;</span><br></pre></td></tr></table></figure><p>注意：确保首先存在以下两个路径：/usr/local/cuda-10.1/bin和/usr/local/cuda-10.1/NsightCompute-2019.1（NsightCompute路径的结尾可能略有不同，具体取决于安装的Nsight计算版本。<br>然后，更新$LD_LIBRARY_PATH（即添加以下行，在~/bashrc内）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.1&#x2F;lib64\$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;&#125;</span><br></pre></td></tr></table></figure><p>在此之后，两者nvcc和nvidia-smi（或nvtop）就应该打印相同版本的Cuda了</p><h4 id="尝试运行项目"><a href="#尝试运行项目" class="headerlink" title="尝试运行项目"></a><strong>尝试运行项目</strong></h4><p>构建这个项目，首先需要新建个cmake文件夹，然后进入该文件夹内，执行cmake命令，结果报错了，找不到Cuda（found 9.1），隐约感到这不是简单的路径问题，后来得到证实，这是在编译时没有指定版本导致的。</p><p><img src="https://pic.imgdb.cn/item/5e554c476127cc0713b34e06.jpg" alt></p><p>解决方案：在cmake时添加编译参数（参见<a href="https://groups.google.com/forum/#!topic/torch7/QkRk8eKAJLw" target="_blank" rel="external nofollow noopener noreferrer">这里</a>），如下所示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -DCUDA_TOOLKIT_ROOT_DIR&#x3D;&#x2F;usr&#x2F;local&#x2F;cuda-10.2</span><br></pre></td></tr></table></figure><h4 id="常规的配置修改"><a href="#常规的配置修改" class="headerlink" title="常规的配置修改"></a><strong>常规的配置修改</strong></h4><p>修改arch参数，改为compute_50，由于是CMakeList.txt构建的，所以这次在这里修改。之后，修改对应的模块路径，修改简单的引用错误。</p><p><img src="https://pic.imgdb.cn/item/5e554c4a6127cc0713b34eae.jpg" alt></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="make系列错误"><a href="#make系列错误" class="headerlink" title="make系列错误"></a><strong>make系列错误</strong></h4><p>做完以上操作后，cmake命令就基本没问题了，这里我们需要继续make，但是make到[66%]左右时会出现错误如下，我以为又是什么难以解决的问题，结果在make之前clean一下就ok了。</p><p>注意make之前一定要make -clean，不然会出错，详见<a href="https://stackoverflow.com/questions/38659115/make-fails-with-error-cannot-convert-stdistream-aka-stdbasic-istreamchar/48648056" target="_blank" rel="external nofollow noopener noreferrer">这里</a>，修改玩上述报错后会有新错误：</p><p><img src="https://pic.imgdb.cn/item/5e554c4d6127cc0713b34f27.jpg" alt></p><h4 id="链接时的recompile-with-fPTC"><a href="#链接时的recompile-with-fPTC" class="headerlink" title="链接时的recompile with -fPTC"></a><strong>链接时的recompile with -fPTC</strong></h4><p><img src="https://pic.imgdb.cn/item/5e554c576127cc0713b350f3.jpg" alt></p><p>可以看到已经编译完成了，但链接linking出错，在此，我推测是原有的静态链接文件（源代码带的）并不能在我的机器上正常工作，我需要重新编译生成一遍，之后我重新编译了ANN、Wordcloud、Cubu模块，发现大部分错误消失了，但又出现新错误，如下：</p><h4 id="恼人的Cubu模块"><a href="#恼人的Cubu模块" class="headerlink" title="恼人的Cubu模块"></a><strong>恼人的Cubu模块</strong></h4><p><img src="https://pic.imgdb.cn/item/5e554c616127cc0713b35299.jpg" alt></p><p>定位：graphdrawing 有问题，进而定位到Cubu，非常怀疑是libcubu.a这个静态链接库有问题，但我重新编译后生成的新文件去替换它之后，会出现以下错误，</p><p><img src="https://pic.imgdb.cn/item/5e554c656127cc0713b35339.jpg" alt></p><p>怀疑是Cubu的版本不对应，编译都不通过。用原来Cubu的include文件夹+新的libcubu.a，错误依旧：</p><p><img src="https://pic.imgdb.cn/item/5e554c616127cc0713b35299.jpg" alt></p><p>用新的include文件夹＋原来的libcubu.a，错误又会复现。基本确定是cubu重新编译的问题。原来的libcubu.a需要重新编译，但我现在编译出的静态链接文件libcubu.ａ又和原先的Cubu的版本好像不一样，所以导致上述错误。</p><p><strong>卡壳了。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 调试 </tag>
            
            <tag> Cuda </tag>
            
            <tag> CMakeList </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>重新编译运行C++/Cuda混编项目</title>
      <link href="/article/38ca.html"/>
      <url>/article/38ca.html</url>
      
        <content type="html"><![CDATA[<p>由于需要，最近得重新运行一个CUDA项目，但我苦于没有经验，只能从编译开始入门一下，不过还是不算难的，难的是原项目代码不保证质量，而且有若干无关文件，且运行环境未知、各模块的运行版本也不是很清楚，导致搞了一大堆操作（应该是正确的）最后却没跑起来，是的，这是一篇翻车笔记。</p><a id="more"></a><h4 id="从最简单的CMAKE示例开始"><a href="#从最简单的CMAKE示例开始" class="headerlink" title="从最简单的CMAKE示例开始"></a><strong>从最简单的CMAKE示例开始</strong></h4><p>为了打印文件结构，我们要先装一个tree来做准备。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1$ sudo apt install tree</span><br></pre></td></tr></table></figure><p>当前的例子的文件结构如下所示，这不是最简单的形式，但却是最接近项目结构的形式。具体的文件内容在<a href="https://blog.csdn.net/whahu1989/article/details/82078563" target="_blank" rel="external nofollow noopener noreferrer">这里</a>可以找到，在此仅做示例。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1$ tree -C -L 2</span><br><span class="line">.</span><br><span class="line">├── bin</span><br><span class="line">├── build</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── include</span><br><span class="line">│   ├── testFunc1.h</span><br><span class="line">│   └── testFunc.h</span><br><span class="line">└── src</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    ├── main.cpp</span><br><span class="line">    ├── testFunc1.cpp</span><br><span class="line">    └── testFunc.cpp</span><br></pre></td></tr></table></figure><p><strong>构建项目的步骤如下：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1$ cd build&#x2F;</span><br><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1&#x2F;build$ cmake ..</span><br><span class="line">... ... </span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: &#x2F;home&#x2F;tzloop&#x2F;Desktop&#x2F;test1&#x2F;build</span><br></pre></td></tr></table></figure><p>会发现：</p><ul><li>在build文件夹下已经出现一众的Cmake文件的src文件夹</li><li>并生成了Makefile文件，这是我们接下来进行cmake的保证</li><li>对于CmakeCache.txt，如果我们要重新cmake，则需要删除之</li></ul><p><img src="https://p.pstatp.com/origin/fe9d0001795727507df6" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1&#x2F;build$ make</span><br><span class="line">Scanning dependencies of target main</span><br><span class="line">[ 25%] Building CXX object src&#x2F;CMakeFiles&#x2F;main.dir&#x2F;main.cpp.o</span><br><span class="line">[ 50%] Building CXX object src&#x2F;CMakeFiles&#x2F;main.dir&#x2F;testFunc.cpp.o</span><br><span class="line">[ 75%] Building CXX object src&#x2F;CMakeFiles&#x2F;main.dir&#x2F;testFunc1.cpp.o</span><br><span class="line">[100%] Linking CXX executable ..&#x2F;..&#x2F;bin&#x2F;main</span><br><span class="line">[100%] Built target main</span><br></pre></td></tr></table></figure><p>在make（有百分比阶段）完成后，会发现编译完的o文件，被link（链接）完成，最后输出可执行的文件到bin目录，我们进入bin目录运行main会打印出正常结果。</p><p><img src="https://p.pstatp.com/origin/fed200015cf8f6ca112f" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1&#x2F;build$ cd ..&#x2F;bin</span><br><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;test1&#x2F;bin$ .&#x2F;main</span><br><span class="line">data is 100</span><br><span class="line">data is 200</span><br></pre></td></tr></table></figure><h4 id="开始调试项目"><a href="#开始调试项目" class="headerlink" title="开始调试项目"></a><strong>开始调试项目</strong></h4><p>项目简介：一个CUDA项目，使用GLUI构建的操作界面，使用OPENGL来利用GPU加速计算，整体上是C++混编CUDA程序，采用Makefile构建。按道理直接make即可，但遇到的错误没想到一大堆！</p><p><img src="https://p.pstatp.com/origin/fe42000182f8a15e83fe" alt="image.png"></p><h4 id="Error1-clang-not-found"><a href="#Error1-clang-not-found" class="headerlink" title="Error1: clang++: not found"></a><strong>Error1: clang++: not found</strong></h4><p><strong>解决方法，</strong>安装clang即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:sudo apt-get update</span><br><span class="line">tzloop@tzloop-GE62-6QC:sudo apt-get install clang</span><br></pre></td></tr></table></figure><h4 id="Error2-依赖的头文件找不到"><a href="#Error2-依赖的头文件找不到" class="headerlink" title="Error2: 依赖的头文件找不到"></a><strong>Error2: 依赖的头文件找不到</strong></h4><p>分析下Cmake文件，这里主要有三个模块需要引入到源文件中，分别是：ANN、TRIANGLE、CUBU。</p><p><img src="https://p.pstatp.com/origin/ff0e0000cceb02a06a34" alt="image.png"></p><p><strong>解决方法：</strong>重新安装。<br>要注意查看项目的源代码，是直接调用的，还是依赖编译环境的。前者需要将模块构建完成后放到项目中，而后者只需要在系统中安装相应模块，程序运行时会调用系统的库。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;ProjectionExplain$ make</span><br><span class="line">clang++ -c -I. -Iinclude -O3 -g -m64 -I..&#x2F;CUBu -I..&#x2F;Geometry&#x2F;tsANN&#x2F;include -I..&#x2F;Geometry&#x2F;Triangle -I&#x2F;Developer&#x2F;NVIDIA&#x2F;CUDA-6.0&#x2F;include -I&#x2F;Developer&#x2F;NVIDIA&#x2F;CUDA-6.0&#x2F;samples&#x2F;common&#x2F;inc  -stdlib&#x3D;libstdc++  -o main.o main.cpp</span><br><span class="line">In file included from main.cpp:2:</span><br><span class="line">In file included from .&#x2F;include&#x2F;vis.h:9:</span><br><span class="line">.&#x2F;include&#x2F;pointcloud.h:4:10: fatal error: &#39;ANN&#x2F;ANN.h&#39; file not found</span><br><span class="line">#include &quot;ANN&#x2F;ANN.h&quot;</span><br><span class="line">         ^~~~~~~~~~~</span><br><span class="line">1 error generated.</span><br><span class="line">Makefile:32: recipe for target &#39;main.o&#39; failed</span><br><span class="line">make: *** [main.o] Error 1</span><br></pre></td></tr></table></figure><p>相关链接：<a href="https://blog.csdn.net/RobertChenGuangzhi/article/details/39995833" target="_blank" rel="external nofollow noopener noreferrer">Ubuntu中c++项目引用第三方包库的方法</a></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="粗体文本Error3-Cubu-cmake-failed粗体文本"><a href="#粗体文本Error3-Cubu-cmake-failed粗体文本" class="headerlink" title="粗体文本Error3: Cubu cmake failed粗体文本"></a><strong>粗体文本</strong>Error3: Cubu cmake failed<strong>粗体文本</strong></h4><p>Cubu的安装要先下载，然后手动构建完后放到项目中，<a href="https://bitbucket.org/rmmartins/cubu/downloads/" target="_blank" rel="external nofollow noopener noreferrer">下载地址</a>。</p><p><strong>出现错误： missing: GLUI_INCLUDE_DIR GLUI_LIBRARY</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;rmmartins-cubu-ee034cafdaa2$ mkdir -p build &amp;&amp; cd build &amp;&amp; cmake .. &amp;&amp; make install</span><br><span class="line">-- The C compiler identification is GNU 7.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 7.4.0</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc</span><br><span class="line">-- Check for working C compiler: &#x2F;usr&#x2F;bin&#x2F;cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++</span><br><span class="line">-- Check for working CXX compiler: &#x2F;usr&#x2F;bin&#x2F;c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Found OpenGL: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libOpenGL.so   </span><br><span class="line">-- Found GLUT: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libglut.so  </span><br><span class="line">CMake Error at &#x2F;usr&#x2F;share&#x2F;cmake-3.10&#x2F;Modules&#x2F;FindPackageHandleStandardArgs.cmake:137 (message):</span><br><span class="line">  Could NOT find GLUI (missing: GLUI_INCLUDE_DIR GLUI_LIBRARY)</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  &#x2F;usr&#x2F;share&#x2F;cmake-3.10&#x2F;Modules&#x2F;FindPackageHandleStandardArgs.cmake:378 (_FPHSA_FAILURE_MESSAGE)</span><br><span class="line">  cmake&#x2F;FindGLUI.cmake:106 (find_package_handle_standard_args)</span><br><span class="line">  CMakeLists.txt:8 (find_package)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also &quot;&#x2F;home&#x2F;tzloop&#x2F;Desktop&#x2F;rmmartins-cubu-ee034cafdaa2&#x2F;build&#x2F;CmakeFiles&#x2F;CmakeOutput.log&quot;.</span><br></pre></td></tr></table></figure><p><strong>解决方法：</strong>Cubu有其他模块的依赖，最好是先安装其他模块。对于只需要在系统安装的模块，可以直接一条命令安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get install libtriangle-dev libann-dev libann-dev libfreeimage-dev libglew-dev libboost-all-dev libftgl-dev libfreetype6-dev libeigen3-dev</span><br></pre></td></tr></table></figure><h4 id="粗体文本Error4-glui-install-failed"><a href="#粗体文本Error4-glui-install-failed" class="headerlink" title="粗体文本Error4: glui install failed**"></a><strong>粗体文本</strong>Error4: glui install failed**</h4><p><strong>解决方法：</strong>我这里出现了安装 libglui-dev失败的提示，搜索后发现是Ubuntu不提供这个模块了，所以只能去github下载源代码手动构建。下载版本为glui-2.35，这里是<a href="https://github.com/libglui/glui/releases" target="_blank" rel="external nofollow noopener noreferrer">下载链接</a></p><p><img src="https://p.pstatp.com/origin/fed00000e7976cb49c5f" alt="image.png"></p><p>下载完成后进入目录，因为也是Makefile构建的，所以直接make：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;glui-2.35$ make</span><br><span class="line">mkdir -p bin</span><br><span class="line">mkdir -p lib</span><br><span class="line">g++ -O0 -Wall -pedantic -I.&#x2F; -I.&#x2F;include -I&#x2F;usr&#x2F;X11R6&#x2F;include -c glui_add_controls.cpp</span><br><span class="line">… …</span><br></pre></td></tr></table></figure><p><img src="https://p.pstatp.com/origin/fed400011de7745d897c" alt="image.png"></p><p><strong>ANN模块同理</strong>，下载源文件tar.gz，在<a href="https://launchpad.net/ubuntu/+source/ann/1.1.2+doc-4.1" target="_blank" rel="external nofollow noopener noreferrer">这里下载</a> ，然后注意编译的方式，使用linux-g++</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~&#x2F;Desktop&#x2F;ann-1.1.2+doc$ make linux-g++</span><br><span class="line">… …</span><br></pre></td></tr></table></figure><p><strong>Triangle模块同理</strong>，在<a href="https://launchpad.net/ubuntu/+source/triangle/1.6-2" target="_blank" rel="external nofollow noopener noreferrer">这里下载</a> ，最后Cubu也要放进来（项目lib目录），然后改下名字（随意），这里把版本号去掉了。然后修改Malefile的对应的模块路径。</p><p><img src="https://p.pstatp.com/origin/ff8d000126fdf275af26" alt="image.png"></p><h4 id="穿插GLUT教程"><a href="#穿插GLUT教程" class="headerlink" title="穿插GLUT教程"></a><strong>穿插GLUT教程</strong></h4><p>教程在，<a href="https://ywnz.com/linuxbc/2371.html" target="_blank" rel="external nofollow noopener noreferrer">这里</a>，按照教程，我成功的运行了所给的demo，这表明我的Glut模块是安装正常的。</p><p><img src="https://p.pstatp.com/origin/ffa700009088e087c3c2" alt="image.png"></p><h4 id="Error5-Unsupported-gpu-architecture-‘compute-12’"><a href="#Error5-Unsupported-gpu-architecture-‘compute-12’" class="headerlink" title="Error5: Unsupported gpu architecture ‘compute_12’"></a><strong>Error5: Unsupported gpu architecture ‘compute_12’</strong></h4><p><img src="https://p.pstatp.com/origin/ffc80000c1265f013f50" alt="image.png"></p><p>问题的详细 <a href="https://askubuntu.com/questions/960238/nvcc-fatal-unsupported-gpu-architecture-compute-20" target="_blank" rel="external nofollow noopener noreferrer">纠错指导</a></p><p><strong>解决方法：</strong>这里需要修改Makefile中的arch参数，看自己的Cuda参数而定，这里我使用compute_50即正常。</p><h4 id="Error6-skelf-cu-pointcloud-not-found"><a href="#Error6-skelf-cu-pointcloud-not-found" class="headerlink" title="Error6: skelf.cu: pointcloud not found"></a><strong>Error6: skelf.cu: pointcloud not found</strong></h4><p><strong>解决方法：</strong>修改skelf.cu内部的头文件引用名称。</p><p><img src="https://p.pstatp.com/origin/fff20000b5d1c7149863" alt="image.png"></p><h4 id="Error7-cuda-ruantime-h-not-found"><a href="#Error7-cuda-ruantime-h-not-found" class="headerlink" title="Error7: cuda_ruantime.h not found"></a><strong>Error7: cuda_ruantime.h not found</strong></h4><p><img src="https://p.pstatp.com/origin/ff480000bfdc7b40260b" alt="image.png"></p><p><strong>解决方法：</strong>这是Cuda路径配置错误导致的，查看makefile中对应cuda的路径CUDAROOT，修改成本地环境对应的cuda路径。相应的也要修改CUDALIB路径。</p><p><img src="https://p.pstatp.com/origin/ff4f0000edc20cee8f64" alt="image.png"></p><p><img src="https://p.pstatp.com/origin/ffd7000096b052d952ef" alt="image.png"></p><h4 id="Error8-undeclared-identifier-of-xxEXT"><a href="#Error8-undeclared-identifier-of-xxEXT" class="headerlink" title="Error8: undeclared identifier of xxEXT"></a><strong>Error8: undeclared identifier of xxEXT</strong></h4><p><img src="https://p.pstatp.com/origin/fecc00010e896c8994bd" alt="image.png"></p><p>因为上面是vis.app报错，所以找到vis.h，修改其头文件的引用方式：</p><p><img src="https://p.pstatp.com/origin/fe550001cfc67a5149a0" alt="image.png"></p><p>之后，出现找不到glui.h</p><p><img src="https://p.pstatp.com/origin/ff3700007716ed0f838d" alt="image.png"></p><p>拷贝libglui.a和glui.h到usr相应目录，之后再运行仍然又重复undeclared错误。</p><h4 id="总结重新构建的步骤"><a href="#总结重新构建的步骤" class="headerlink" title="总结重新构建的步骤"></a><strong>总结重新构建的步骤</strong></h4><p>首先是添加依赖模块，然后修改Makefile中对应的依赖模块的路径和Cuda的相关路径，顺带把arch的参数改为合适自己的compute_xx，之后修改一些头文件的引用错误（有的可能单纯是头文件名称错了），有的在不同系统下的路径不同，要改成对应的引用路径（比如glui在mac可能是GLUI/glui但在ubuntu是GL/glui），最后就到达这个错误了。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vis.cpp:343:2: error: use of undeclared identifier &#39;glGenFramebuffersEXT&#39;</span><br><span class="line">        glGenFramebuffersEXT(2,framebuffers);                   &#x2F;&#x2F;Make t...</span><br><span class="line">        ^</span><br><span class="line">vis.cpp:347:2: error: use of undeclared identifier &#39;glBindFramebufferEXT&#39;</span><br><span class="line">        glBindFramebufferEXT(GL_FRAMEBUFFER_EXT,framebuffer_lum);</span><br><span class="line">        ^</span><br><span class="line">vis.cpp:352:2: error: use of undeclared identifier &#39;glFramebufferTexture2DEXT&#39;</span><br><span class="line">        glFramebufferTexture2DEXT(GL_FRAMEBUFFER_EXT,GL_COLOR_ATTACHMENT...</span><br><span class="line">        ^</span><br><span class="line">vis.cpp:354:2: error: use of undeclared identifier &#39;glBindFramebufferEXT&#39;</span><br><span class="line">        glBindFramebufferEXT(GL_FRAMEBUFFER_EXT,framebuffer_rgba);</span><br><span class="line">        ^</span><br><span class="line">vis.cpp:359:2: error: use of undeclared identifier &#39;glFramebufferTexture2DEXT&#39;</span><br><span class="line">        glFramebufferTexture2DEXT(GL_FRAMEBUFFER_EXT,GL_COLOR_ATTACHMENT...</span><br><span class="line">        ^</span><br><span class="line">... ...</span><br></pre></td></tr></table></figure><p>貌似是某模块的EXT扩展引用错误，但目前暂时不知道怎么改，难顶…</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> 调试 </tag>
            
            <tag> Cuda </tag>
            
            <tag> Makefile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu的基本配置及界面美化</title>
      <link href="/article/a441.html"/>
      <url>/article/a441.html</url>
      
        <content type="html"><![CDATA[<p>本文介绍针对Ubuntu系统的一般操作，包括一些基本配置和界面美化，以及中间可能出现的一些问题。可能以后会比较多的用笔记本来做实验，虽然台式机性能更好，但是毕竟不能背来背去，所以还是用笔记本会好很多，正因为如此，所以把Ubuntu整的好看一点还是很重要的，因为实在找不到比较好的Win10美化主题，所以最终还是决定向MacOS方向美化，网上已经有很多资料了，这里只是记录下自己系统的配置及美化过程。</p><a id="more"></a><p><img src="https://ae03.alicdn.com/kf/U73008d1a0b404055b863f23ff040b5071.png" alt="image.png"></p><h3 id="基本配置和软件"><a href="#基本配置和软件" class="headerlink" title="基本配置和软件"></a><strong>基本配置和软件</strong></h3><h4 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a><strong>修改root密码</strong></h4><p>为了方便的执行命令，不用每次都sudo，我们可以直接修改root账户的密码，继而切换到root账户执行相关操作，并且在后续过程中，一旦出现开机异常，在具有root账户密码的情况下，我们可以方便的通过<code>Ctrl+Alt+F4</code>（或其他F1~F6）进入tty4通过命令行的方式修复相关的配置文件，从而修复开机失败的情况。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo passwd root</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入你的新密码</span></span><br></pre></td></tr></table></figure><p>注意：初始密码是随机的，只能通过重置来给定一个新密码。</p><h4 id="QQ-for-Linux"><a href="#QQ-for-Linux" class="headerlink" title="QQ for Linux"></a><strong>QQ for Linux</strong></h4><p><a href="https://im.qq.com/linuxqq/download.html" target="_blank" rel="external nofollow noopener noreferrer">https://im.qq.com/linuxqq/download.html</a></p><h4 id="Sogou-for-Linux"><a href="#Sogou-for-Linux" class="headerlink" title="Sogou for Linux"></a><strong>Sogou for Linux</strong></h4><p><a href="https://pinyin.sogou.com/linux/" target="_blank" rel="external nofollow noopener noreferrer">https://pinyin.sogou.com/linux/</a></p><p>在使用过程中有个问题，那就是使用输入法输入数字和英文字母的时候会出现异常的字符，“ｌｉｋｅ　ｔｈｉｓ”。</p><h4 id="重启报错的问题"><a href="#重启报错的问题" class="headerlink" title="重启报错的问题"></a><strong>重启报错的问题</strong></h4><p>如果每次开机重启都会出现“System program problem detected”的问题，我们可以通过配置忽略这个弹窗，其本身系统运行没有影响。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo gedit /etc/default/apport </span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 enabled=1 改为 enabled=0</span></span><br></pre></td></tr></table></figure><h3 id="主题和Dock"><a href="#主题和Dock" class="headerlink" title="主题和Dock"></a><strong>主题和Dock</strong></h3><p>这里包括两部分内容：</p><ul><li>一个是在Chrome插件中配置使用gnome插件，这可以调节一些细微的细节</li><li>一个是材质包的下载（包括主题资源、光标、图标）以及配合<strong>gnome-tweaks</strong>工具完成主要的主题配置</li></ul><h4 id="Chrome插件，修改细节"><a href="#Chrome插件，修改细节" class="headerlink" title="Chrome插件，修改细节"></a><strong>Chrome插件，修改细节</strong></h4><p>下载gnome管理插件，可以方便的下载并启用相关的gnome插件。下载地址<a href="https://chrome.google.com/webstore/search/gnome" target="_blank" rel="external nofollow noopener noreferrer">在这</a> ，之后可以在Chrome中打开<a href="https://extensions.gnome.org/" target="_blank" rel="external nofollow noopener noreferrer">插件主页</a>进行配置。</p><p><img src="https://ae05.alicdn.com/kf/U97dfea5c7ad04ac58bbf6c5c79d478cdX.png" alt="image.png"></p><p>这里列举几个用到的插件：</p><ul><li><strong>Top bar script executer</strong>：顶栏快捷方式运行自定义命令</li><li><strong>Keys indicator</strong>：顶栏显示当前按下了Caps Lock, Num Lock, Ctrl, Shift, Alt中的哪些键</li><li><strong>Hide activities button</strong>：隐藏顶栏活动按钮</li><li><strong>Launch</strong>：替换顶栏活动按钮为所有应用程序（9个点）</li><li><strong>Hide top bar</strong>：自动隐藏顶栏</li><li><strong>No title bar</strong>：直接将应用的标题栏和顶栏结合为一体，窗口操作按钮也被放在顶栏上（不推荐使用）</li></ul><h4 id="美化Dock也就是底部程序托盘"><a href="#美化Dock也就是底部程序托盘" class="headerlink" title="美化Dock也就是底部程序托盘"></a><strong>美化Dock也就是底部程序托盘</strong></h4><p><strong>第一步：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加软件源</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo add-apt-repository ppa:noobslab/macbuntu</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Plank</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get install plank</span><br></pre></td></tr></table></figure><p>将Plank固定在Dock上，可以进入文件夹/usr/share/applications，找到相关软件，拖到Dock上就OK。</p><p><strong>第二步：</strong></p><p><a href="https://zimocp.github.io/upload/Ubuntu-18-04-LTS-%E7%BE%8E%E5%8C%96-%E4%BB%BFMac-OS-X/frost-plank-theme-2.2.1.zip" target="_blank" rel="external nofollow noopener noreferrer">下载Frost</a>：在解压后的文件夹里找到名为Frost的文件夹，将他复制到<del>/.local/share/plank/themes里（没有就创建）<br><a href="https://zimocp.github.io/upload/Ubuntu-18-04-LTS-%E7%BE%8E%E5%8C%96-%E4%BB%BFMac-OS-X/plank-macOS-Themes-Pack.zip" target="_blank" rel="external nofollow noopener noreferrer">下载Mac OS Themes</a>：解压后进入文件夹，你会看到一大堆主题，根据名字复制你需要的文件夹到</del>/.local/share/plank/themes里（没有就创建）<br>最后在Plank上Ctrl+右键，点击首选项，选择相关主题。</p><p><img src="https://ae02.alicdn.com/kf/U3c5f3a38369a414dbfd6e562fbb9b6889.png" alt="image.png"></p><p><strong>第三步：隐藏原Dash</strong></p><p><a href="https://extensions.gnome.org/extension/307/dash-to-dock/" target="_blank" rel="external nofollow noopener noreferrer">安装Dash to Dock</a></p><ul><li>安装好之后进入GNOME Tweaks，进入左侧栏插件，将Dash to Dock打开，之后关闭之，如果发现没有变回Ubuntu默认dash，那么就完成关闭了。</li><li>点击Dash to Dock的设置按钮，打开自动隐藏，把两个开关都关掉，你会发现你找不到Dash了</li><li>设置Dock开机启动：打开GNOME Tweaks，左侧栏进入开机启动程序，</li></ul><p><strong>其他配置</strong></p><p>安装Slingscold，Slingscold是一个比GNOME原生启动器更轻量的全屏启动器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get install slingscold</span><br></pre></td></tr></table></figure><p>将Slingscold固定在Dock上，可以进入文件夹/usr/share/applications，找到相关软件，拖到Dock上就OK。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="使用Tweaks修改主题"><a href="#使用Tweaks修改主题" class="headerlink" title="使用Tweaks修改主题"></a><strong>使用Tweaks修改主题</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get install macbuntu-os-icons-v1804 macbuntu-os-ithemes-v1804 macbuntu-os-plank-theme-v1804</span><br></pre></td></tr></table></figure><p>通过以上命令安装Macbuntu的主题、图标和Plank主题，打开GNOME Tweaks，将左侧栏外观中的应用程序 光标 图标设成Macbuntu即可。</p><p><img src="https://ae05.alicdn.com/kf/Uad2412d3bd03446b8feb0f3eeebe5b34i.png" alt="image.png"></p><p><strong>最终的美化效果</strong></p><p><img src="https://ae02.alicdn.com/kf/U58f40493e8fb4873874cb4a915023acf3.png" alt="image.png"></p><h3 id="修改字体"><a href="#修改字体" class="headerlink" title="修改字体"></a><strong>修改字体</strong></h3><p>Ubuntu系统的英文字体很好看，但中文字体有时会觉得不是那么好看，所以可以自己替换相应的字体。这里首先需要检查是否安装了中文字体，在终端上输入下面指令查看已安装字体</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ fc-list :lang=zh</span><br></pre></td></tr></table></figure><p>如果没有中文字体可以到网络中下载，或者直接到windows系统中拷贝。中文字体安装完成后，需要修改默认的字体设置文件，修改默认字体找不到的时候的默认替代字体，进入下面路径找到配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ vim /etc/fonts/conf.d/64-language-selector-prefer.conf</span><br></pre></td></tr></table></figure><p>修改（添加）文件中的字体配置信息，每个<prefer>后面的第一行都是添加的默认新字体。</prefer></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">fontconfig</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"fonts.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Microsoft YaHei<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK KR<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK HK<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Microsoft YaHei<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK KR<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Microsoft YaHei<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK KR<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK HK<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用sudo权限保存后重启即可生效，原来的字体就会变为中文字体默认的繁体字体就变成了新的简体中文。</p><h3 id="调节Ubuntu亮度"><a href="#调节Ubuntu亮度" class="headerlink" title="调节Ubuntu亮度"></a><strong>调节Ubuntu亮度</strong></h3><p>这部分比较麻烦，可能出现很多种情况，下面分别讲解一下。</p><ol><li><strong>如果是Fn+亮度调节按钮可以出现亮度调节图标，但调节无效，那么可以使用如下方法：</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo gedit /etc/default/grub</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改文件中的字段：</span></span><br><span class="line">GRUB_CMDLINE_LINUX="" 改成　GRUB_CMDLINE_LINUX="acpi_backlight=vendor"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo update-grub</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ reboot</span><br></pre></td></tr></table></figure><p>如果想设置亮度的初始值，可以直接修改文件内的数值。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo gedit /etc/rc.local</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在打开文件里增加以下代码（加在<span class="built_in">exit</span> 0之前）</span></span><br><span class="line">echo 500 &gt; /sys/class/backlight/intel_backlight/brightness</span><br></pre></td></tr></table></figure><p><strong>2. 如果/sys/class/backlight/目录下是空的</strong></p><p><img src="https://ae02.alicdn.com/kf/U476af81a37864823ae59ef772d99f203y.png" alt="image.png"></p><p>可以通过安装第三方软件的方法来调节亮度，安装brightness-controller或者brightness-controller-sample这两个软件，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo add-apt-repository ppa:apandada1/brightness-controller</span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get update</span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get install brightness-controller</span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ brightness-controler</span><br></pre></td></tr></table></figure><p><img src="https://ae03.alicdn.com/kf/U6584a1e78a0942bd9d9682fbb7ced29av.png" alt="image.png"></p><p>左侧是正常版的调节软件，右侧是simple版本。</p><p><strong>3. 如仍然无效可以采用以下危险方案</strong></p><p>以下修改可能造成重启后无法进入系统，因为新增的驱动配置可能导致显示不正常，所以慎用，不过如果重启后进不去系统，也不要害怕，通过Ctrl+Alt+F4（或者F1~F6）进入tty4把新增的配置文件s删除即可，这里直接要用root用户登录，然后删除conf文件重启即可恢复。</p><p>进入/etc/X11/路径，如果没有xorg.conf文件的话，就自己新建一个，输入下面的内容，保存退出。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Section <span class="string">"Screen"</span></span><br><span class="line">Identifier<span class="string">"Default Screen"</span></span><br><span class="line">DefaultDepth<span class="number">24</span></span><br><span class="line">EndSection</span><br><span class="line">Section <span class="string">"Module"</span></span><br><span class="line">Load<span class="string">"glx"</span></span><br><span class="line">EndSection</span><br><span class="line">Section <span class="string">"Device"</span></span><br><span class="line">Identifier<span class="string">"Default Device"</span></span><br><span class="line">Driver<span class="string">"nvidia"</span></span><br><span class="line">Option<span class="string">"NoLogo"</span><span class="string">"True"</span></span><br><span class="line">Option <span class="string">"RegistryDwords"</span> <span class="string">"EnableBrightnessControl=1"</span></span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p>如果有这个文件的话在终端中输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo gedit /etc/X11/xorg.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 把fuiying对应内容改成以下内容</span></span><br><span class="line">Section "Device"</span><br><span class="line">Identifier "Device0"</span><br><span class="line">Driver "nvidia"</span><br><span class="line">VendorName "NVIDIA Corporation"</span><br><span class="line">Option "RegistryDwords" "EnableBrightnessControl=1"</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p>然后保存，退出，重启之后，或许正常，如果进不去系统了，那么请看本段开头的解决方案，命令行进入系统删除conf文件即可。</p><p><img src="https://ae04.alicdn.com/kf/U7278e9361e104a62af69e3baf5f839abn.png" alt="image.png"></p><p><strong>4. 如果还是没有效果</strong></p><p>合理的怀疑是因为显卡驱动的问题，我们知道在双显卡（独显加集显）的电脑上安装显卡驱动时，需要修改grub文件，添加nomodeset字段在slpash之后，这是为了禁止系统使用GTX的N卡驱动，具体在前一篇文章中详细说明，这里如果仍然无法调节亮度，请务必参看一下文件中是否仍然存在nomodeset字段。要将其删掉。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo vim /etc/default/grub</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除nomodeset字段，保存退出</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo update-grub</span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ reboot</span><br></pre></td></tr></table></figure><p>这是我的最终错误定位，去掉nomodeset之后，其实才是真正使用独显显示，重启后会发现一些变化，比如打开程序会出现动画，点击程序菜单也会出现动画，亮度随意调节，网页或程序渲染速度也变得更快，而且上述的两个亮度调节软件也可以使用了。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><strong>参考资料</strong></h3><p><a href="https://zimocp.github.io/2019/05/20/Ubuntu-18-04-LTS-%E7%BE%8E%E5%8C%96/" target="_blank" rel="external nofollow noopener noreferrer">https://zimocp.github.io/2019/05/20/Ubuntu-18-04-LTS-%E7%BE%8E%E5%8C%96/</a><br><a href="https://www.jianshu.com/p/4c95b708ae1d" target="_blank" rel="external nofollow noopener noreferrer">https://www.jianshu.com/p/4c95b708ae1d</a><br><a href="https://blog.csdn.net/redstone0001/article/details/17042011" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/redstone0001/article/details/17042011</a><br><a href="https://blog.csdn.net/u013406197/article/details/80773820" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/u013406197/article/details/80773820</a><br><a href="https://blog.csdn.net/TianliangQiu/article/details/51585398" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/TianliangQiu/article/details/51585398</a><br><a href="https://blog.csdn.net/HedWater/article/details/75465110" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/HedWater/article/details/75465110</a><br><a href="https://blog.csdn.net/weixin_41490463/article/details/80987654" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/weixin_41490463/article/details/80987654</a><br><a href="https://blog.csdn.net/gengyuchao/article/details/101215243" target="_blank" rel="external nofollow noopener noreferrer">https://blog.csdn.net/gengyuchao/article/details/101215243</a></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> Linux </tag>
            
            <tag> 系统设置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>双显卡笔电安装N卡驱动及CUDA</title>
      <link href="/article/891.html"/>
      <url>/article/891.html</url>
      
        <content type="html"><![CDATA[<p>由于工作需要，必须换操作系统了，一想到笔记本已经冗杂不堪，所以就索性重装成Linux系统，虽然显卡性能不如实验室的机器，但完全可以当做试验机，同时本身机子性能也不差，所以装个乌班图应该体验还不错。以上是我开始时的想法，后来装完了之后呢，体验总体也不错，但总归是有写麻烦，我总结一下放在开头。</p><a id="more"></a><p><img src="https://ae03.alicdn.com/kf/U73008d1a0b404055b863f23ff040b5071.png" alt="image.png"></p><h3 id="安装和使用Ubuntu的感受"><a href="#安装和使用Ubuntu的感受" class="headerlink" title="安装和使用Ubuntu的感受"></a><strong>安装和使用Ubuntu的感受</strong></h3><ul><li>初始安装时要修改配置，针对双显卡机器；</li><li>安装系统的过程非常快，这得益于我的固态硬盘；</li><li>系统的初始环境比Win10全，比如自带Python环境等等；</li><li>操作起来整体感觉圆滑，但比Win10要卡；</li><li>随便的小操作就可能导致开机黑屏，不过修复也比较容易；</li><li>开机关机要快点，因为不存在Win10那种更新；</li><li>系统的自定义程度高，基本哪里都可以改；</li><li>注意：微星笔电开启独显后会导致风扇一直运行在高转速；</li><li>注意：真不需要占用太多硬盘空间，后悔没装双系统！</li></ul><p>总体体验还不错，除了娱乐性差一点，我基本可以适应从Win10到Ubuntu的过度。有关于系统设置和美化的内容请转到 <a href="https://old.cz5h.com/article/2020-2-1%20Ubuntu%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%95%8C%E9%9D%A2%E7%BE%8E%E5%8C%96.html" target="_blank" rel="external nofollow noopener noreferrer">这篇文章</a>。</p><p>下面是安装系统及显卡驱动的步骤和需要注意的地方。</p><h3 id="安装系统及Nvidia驱动"><a href="#安装系统及Nvidia驱动" class="headerlink" title="安装系统及Nvidia驱动"></a><strong>安装系统及Nvidia驱动</strong></h3><h4 id="双显卡的系统安装及驱动安装的准备工作"><a href="#双显卡的系统安装及驱动安装的准备工作" class="headerlink" title="双显卡的系统安装及驱动安装的准备工作"></a><strong>双显卡的系统安装及驱动安装的准备工作</strong></h4><ol><li><p>Bios改成uefi，关闭安全启动；</p><p><img src="https://ae04.alicdn.com/kf/U1eae7fcd05134105b2d44edd7a8460ebC.png" alt="image.png"></p></li><li><p>插入启动U盘，启动安装，在try ubuntu　..install Ubuntu 的这个界面，按e，进入grub的调整界面；</p><p><img src="https://ae04.alicdn.com/kf/Uf7567e8722ae4e12a32b53782e381d04E.png" alt="image.png"></p></li><li><p>把里边的quiet splash修改为nomodeset idle=nomwait，修改完成以后Ctrl + X或F10，使之生效；</p><p><img src="https://ae03.alicdn.com/kf/U04f078be4fe94bd186385280342229e2a.png" alt="image.png"></p></li><li><p>然后继续安装，这样安装完成以后，应该可以顺利进入桌面；</p></li><li><p>正常进入桌面后，编辑 /etc/default/grub 这个文件，同样添加nomodeset字段到splash后面；</p></li></ol><p>此时重启，应该一切正常可以进入桌面，这时其实系统使用的集显，独显的显卡还没装，下面开始。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 自动探测显卡版本并列出可使用的显卡驱动编号</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ ubuntu-drivers devices</span><br><span class="line">… …</span><br><span class="line">vendor   : NVIDIA Corporation</span><br><span class="line">model    : GM107M [GeForce GTX 960M]</span><br><span class="line">driver   : nvidia-driver-440 - third-party free recommended</span><br><span class="line">driver   : nvidia-driver-415 - third-party free</span><br><span class="line">driver   : nvidia-driver-410 - third-party free</span><br><span class="line">driver   : nvidia-driver-430 - third-party free</span><br><span class="line">driver   : nvidia-driver-390 - third-party free</span><br><span class="line">driver   : nvidia-driver-435 - distro non-free</span><br><span class="line">driver   : xserver-xorg-video-nouveau - distro free builtin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看内核版本（高内核会引发显卡驱动的不兼容）</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ uname -r </span><br><span class="line">5.3.0-26-generic</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开始安装驱动时，先卸载之前的驱动</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get remove --purge nvidia*</span><br><span class="line">… …</span><br><span class="line">INFO:Disable nvidia</span><br><span class="line">DEBUG:Parsing /usr/share/ubuntu-drivers-common/quirks/put_your_quirks_here</span><br><span class="line">update-initramfs: deferring update (trigger activated)</span><br><span class="line">Processing triggers for initramfs-tools (0.130ubuntu3.8) ...</span><br><span class="line">update-initramfs: Generating /boot/initrd.img-5.3.0-26-generic</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加驱动的软件源</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class="line">… …       </span><br><span class="line">Fetched 88,7 kB in 0s (186 kB/s)                  </span><br><span class="line">Reading package lists... Done</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新下载器</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt-get update</span><br><span class="line">… …                        </span><br><span class="line">Reading package lists... Done</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="选择安装驱动的版本"><a href="#选择安装驱动的版本" class="headerlink" title="选择安装驱动的版本"></a><strong>选择安装驱动的版本</strong></h4><p>列出适用该笔记本电脑显卡的具体驱动版本。这里有三点需要注意：</p><ul><li><p>尽量选择高版本的显卡驱动，比如这里选择安装440，如果选择安装410，则会出现与内核不兼容的情况，我们面会谈到。</p></li><li><p>第二点就是，可能你运行下面的命令不能自动识别出显卡版型号，那么你就要去手动查询对应的Nvidia显卡型号和Ubuntu驱动编号的关系，手动选择一个版本安装。</p></li><li><p>最后，如果可以在&lt;软件和更新&gt;中找到相对应的驱动版本，也可以直接鼠标选择后应用即可。这是18.04及以后都支持的Nvidia驱动安装方法。（一般初始驱动是不完整的）</p><p><img src="https://ae01.alicdn.com/kf/U514ccf97da2d4fcc9e3838f5a96e740bi.png" alt="image.png"></p></li></ul><p><strong>如果错误的在高版本内核下安装了低版本驱动，会安装失败的：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt install nvidia-driver-410 </span><br><span class="line">… …</span><br><span class="line">Building initial module for 5.3.0-26-generic</span><br><span class="line">ERROR: Cannot create report: [Errno 17] File exists: '/var/crash/nvidia-kernel-source-410.0.crash'</span><br><span class="line">Error! Bad return status for module build on kernel: 5.3.0-26-generic (x86_64)</span><br><span class="line">Consult /var/lib/dkms/nvidia/410.104/build/make.log for more information.</span><br><span class="line">Setting up nvidia-driver-410 (410.104-0ubuntu0~18.04.1) ...</span><br><span class="line">Processing triggers for initramfs-tools (0.130ubuntu3.8) ...</span><br><span class="line">update-initramfs: Generating /boot/initrd.img-5.3.0-26-generic</span><br></pre></td></tr></table></figure><p>所以我们要安装高版本，直接安装其<strong>recommended</strong>的版本即可。安装过程中会有基佬紫对话框，可能会被要求输入密码。</p><p><img src="https://ae04.alicdn.com/kf/Ufa3975531a4b4df8ac41c929b355dd91x.png" alt="image.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tzloop@tzloop-GE62-6QC:~$ sudo apt install nvidia-driver-440 </span><br><span class="line">… …</span><br><span class="line">Processing triggers for initramfs-tools (0.130ubuntu3.8) ...</span><br><span class="line">update-initramfs: Generating /boot/initrd.img-5.3.0-26-generic</span><br><span class="line">Processing triggers for libc-bin (2.27-3ubuntu1)</span><br></pre></td></tr></table></figure><p>显卡驱动安装完成的判定：，重启后输入nvidia smi，如果正常的显示出以下信息则正常。</p><p><img src="https://ae01.alicdn.com/kf/Uee4572cfaf0e4539b9af9482472194a60.png" alt="image.png"></p><h4 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a><strong>可能出现的问题</strong></h4><ul><li><p><strong>重启后nvidia-smi通信失败</strong><br>如果安装非常顺利，但重启后nvidia-smi命令无效，切记要<strong>在重启后进入蓝色方框的界面输入安装驱动时的密码</strong>，再重启就可以啦。</p></li><li><p><strong>首次安装过程中，登录账户后桌面黑屏</strong><br>原因：安装时的grub配置没有修改，这时要重新安装系统，按照上述步骤，一定要注意修改grub文件。<br>请确认，这是在首次安装过程中出现的，我们可以看见登录界面，但登录进去后就是黑屏，可能有鼠标也可能没有。</p></li><li><p><strong>安装显卡驱动之后，重启黑屏</strong><br>原因：没有在grub配置文件内添加nomodeset字段。<br>请确认，这是在我们安装完成系统之后出现的问题，那么接下来的操作就与安装盘没有任何关系，所有操作都不要插着安装盘。只需要使用Ctrl+Alt+F4（也可能是F1~F6），进入tty4也就是黑框（微型Ge62系列是在出现MSI图标后就按下ESC进入，时机比较难把握，多试几次就行了），登录root账户后，找到/etc/default/grub文件，将里面的quiet splash后面添加上nomodeset这个字段，保存重启即可。 </p></li></ul><h3 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a><strong>安装CUDA</strong></h3><p>为什么重新安装Cuda，安装完成显卡驱动后的输出里已经能发现Cuda10.2了，这个问题我的理解是，我们要一个可控的开发环境，而不是运行环境，所以我们自己要重新装个Cuda，在Cuda官网可以找到对应显卡驱动的Cuda安装包，安装过程直接照官网来。</p><p><img src="https://ae05.alicdn.com/kf/Ua9112f823c834aed8becb2fe587fef4ds.png" alt="image.png"></p><p>那么如何知道我们安装成功了呢，这里可以通过编译Cuda自带的例子来看其是否通过测试。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 首先测试下运行环境是否正常，主要是GCC是否正常</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ cat /proc/driver/nvidia/version</span><br><span class="line">NVRM version: NVIDIA UNIX x86_64 Kernel Module  440.48.02  Tue Jan 14 06:22:51 UTC 2020</span><br><span class="line">GCC version:  gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1) </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入sample所在的目录</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ cp -r /usr/local/cuda-10.2/samples/ ~</span><br><span class="line">tzloop@tzloop-GE62-6QC:~$ cd ~/samples</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编译自带的例子</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~/samples$ make</span><br><span class="line">… …  </span><br><span class="line">arch=compute_75,code=sm_75 -gencode arch=compute_75,code=compute_75 -o cudaNvSci.o -c cudaNvSci.cpp</span><br><span class="line">In file included from cudaNvSci.cpp:12:0:</span><br><span class="line">cudaNvSci.h:14:10: fatal error: nvscibuf.h: No such file or directory</span><br><span class="line"><span class="meta"> #</span><span class="bash">include &lt;nvscibuf.h&gt;</span></span><br><span class="line">          ^~~~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>这里我们直接使用 <strong>make</strong> 的话会无法通过对例子的编译，参见 <a href="https://github.com/NVIDIA/cuda-samples/issues/22" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 的解释，这是一个已知的错误，我们可以通过 <strong>make -k</strong> 来忽略过程中的错误。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 -k 参数来跳过错误</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~/samples$ make -k</span><br><span class="line">… …</span><br><span class="line">mkdir -p ../../bin/x86_64/linux/release</span><br><span class="line">cp cuSolverRf ../../bin/x86_64/linux/release</span><br><span class="line">make[1]: Leaving directory '/home/tzloop/samples/7_CUDALibraries/cuSolverRf'</span><br><span class="line">make: Target 'all' not remade because of errors.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最终的测试，如果是PASS则Cuda运行正常</span></span><br><span class="line">tzloop@tzloop-GE62-6QC:~/samples/bin/x86_64/linux/release$ ./deviceQuery</span><br><span class="line">./deviceQuery Starting...</span><br><span class="line"> CUDA Device Query (Runtime API) version (CUDART static linking)</span><br><span class="line">Detected 1 CUDA Capable device(s)</span><br><span class="line">Device 0: "GeForce GTX 960M"</span><br><span class="line">  CUDA Driver Version / Runtime Version          10.2 / 10.2</span><br><span class="line">  … …</span><br><span class="line">  Compute Mode:</span><br><span class="line">     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;</span><br><span class="line">deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 10.2, CUDA Runtime Version = 10.2, NumDevs = 1</span><br><span class="line">Result = PASS</span><br></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a><strong>参考资料</strong></h3><p><a href="https://bbs.deepin.org/forum.php?mod=viewthread&amp;tid=41469" target="_blank" rel="external nofollow noopener noreferrer">https://bbs.deepin.org/forum.php?mod=viewthread&amp;tid=41469</a><br><a href="https://bbs.deepin.org/forum.php?mod=viewthread&amp;tid=41469" target="_blank" rel="external nofollow noopener noreferrer">https://bbs.deepin.org/forum.php?mod=viewthread&amp;tid=41469</a><br><a href="http://askubuntu.com/questions/162075/my-computer-boots-to-a-black-screen-what-options-do-i-have-to-fix-it" target="_blank" rel="external nofollow noopener noreferrer">http://askubuntu.com/questions/162075/my-computer-boots-to-a-black-screen-what-options-do-i-have-to-fix-it</a><br><a href="https://www.jianshu.com/p/fc5edbd6f480" target="_blank" rel="external nofollow noopener noreferrer">https://www.jianshu.com/p/fc5edbd6f480</a><br><a href="https://www.jianshu.com/p/e476e5ad6b56" target="_blank" rel="external nofollow noopener noreferrer">https://www.jianshu.com/p/e476e5ad6b56</a> </p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 双显卡 </tag>
            
            <tag> Ubuntu </tag>
            
            <tag> Nvidia </tag>
            
            <tag> Cuda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>家中为什么要用软路由</title>
      <link href="/article/e1b1.html"/>
      <url>/article/e1b1.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>这原本是我在知乎上的回答，偶然发现被折叠了，改了N次也无济于事，还是放在这里吧。</p></blockquote><h4 id="软路由能做的但硬路由不能做的"><a href="#软路由能做的但硬路由不能做的" class="headerlink" title="软路由能做的但硬路由不能做的"></a><strong>软路由能做的但硬路由不能做的</strong></h4><ul><li><strong>插件</strong>。不仅仅只是网络插件的差别，拿LEDE举例，网络插件恰恰被从酷软中心拿掉了，哈哈，求生欲很强。但剩下的那些插件可不是一无是处，比如ftp就很有用，还有很多插件，自己探索吧。</li></ul><a id="more"></a><ul><li><p><strong>小飞机</strong>。单独说下这个插件，对于软路由系统比如LEDE其支持更高级的Clash/Surge方式，这才是软路由使用网络查件的正确姿势。没错，这就是国内要想从TV看油管4K的必备，基本没什么其他解决方案。</p></li><li><p><strong>平台扩展</strong>。要搞清楚软路由是什么，它一般依托于工控机平台（MiniPC），拿我自己的软路由I57200U来说，我可以物理机装LEDE、装爱快；但当然，我也可以装PVM、装ESXi，然后以虚拟机的方式运行我的软路由系统，在网卡直通的条件下软路由性能基本不受影响。所以如果以ESXi的方式，你完全可以安装其他的虚拟机，打造自己的本地云主机。你可以装Linux挂脚本、可以装Win10/7挂机器人，总之，你可以有若干台24小时运行的虚拟机，结合公网IP或者DDNS，可以获得和阿里云主机基本一样的效果，说到这里，想想4核16G200M带宽（上行5M/s）的阿里云主机要多少钱一年。</p></li><li><p><strong>性能</strong>。终于说到性能了，我的看法，200M宽带及以上直接上软路由不用考虑其他（土豪钱多可以买高端路由）；其他的想全家网络番茄的，可以软路由，也可以硬路由刷梅林固件（梅林的插件的性能要差得多，但一般视频需求也足够了）。另外，看硬件，硬路由其实处理器性能很弱（比较同价位的软路由），外加需要同时支持无线网卡，这其实会影响整体的路由处理能力，但软路由+AP的模式，其实更适合高带宽场景。<br>总之，小水管无所谓性能，大水管才看的出来。</p></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="一些言论"><a href="#一些言论" class="headerlink" title="一些言论"></a><strong>一些言论</strong></h4><ul><li><p>关于<strong>路由系统</strong>，真不需要听别人的安利，LEDE是小白专属；</p></li><li><p>关于<strong>异地访问</strong>，动态公网IP现在并不难得到，相信我，在国外的我可以透过路由自由的访问到家中的每一台设备（只要被分配了内网IP），这种体验非常棒，尤其是搭配我的群晖NAS。当然这已经不太属于软路由的范畴了。</p></li><li><p>所谓<strong>优化</strong>，别被唬住，设备到位优化就到位了，说需要技巧的都是瞎扯；</p></li><li><p>所谓<strong>稳定</strong>，我上次的软路由完美运行了快半年了，其实是三个系统同时运行，Winserver2016、Ubuntu和爱快，爱快是我的主路由。最后为什么崩了？因为停电了！</p></li><li><p>所谓<strong>带机量</strong>，只要你家不是电影院，不来个百十号人，我相信中端路由（例如R7000）就完全可以满足。</p></li><li><p>所谓<strong>门槛</strong>，真没什么门槛，只要你认得汉字，都可以按照教程来，没人让你自己研究，网上的奶妈级教程多如牛毛~</p></li><li><p>所谓<strong>玩法</strong>，玩法真的太多了，硬路由功能相比之下太少了。</p></li></ul><p>最后，推荐几个土鳖上的软路由相关的频道：<a href="https://www.youtube.com/channel/UCaMih5WXqoXq7Hg0S_XJdOg" target="_blank" rel="external nofollow noopener noreferrer">Vedio Talk</a>、<a href="https://www.youtube.com/channel/UCpPswAyGzdRwWmiW5oTNnvA" target="_blank" rel="external nofollow noopener noreferrer">Big东东</a>、<a href="https://www.youtube.com/channel/UCxcuxsAjdnQaiRwYb5CVISw" target="_blank" rel="external nofollow noopener noreferrer">翼王</a></p><p>多看看这些实际操作的视频，也可以有个初步了解，尤其推荐VedioTalk，有很多很实用的入门知识和实际操作教程，如果对软路由跃跃欲试，那就赶快去看看吧。</p><blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>纵览全局的文档组织模式（下）</title>
      <link href="/article/99a8.html"/>
      <url>/article/99a8.html</url>
      
        <content type="html"><![CDATA[<p>本文详细记录了如何在Hexo博客中实现用图组织内容的方法，但是，<strong>请注意：以下内容并非操作教程，仅表明相信思路以供参考，或许您可以实现出更好的版本，但仅依照下文内容并不保证一定能重现，一些尝试和debug的细节过于繁琐并未列出，如有疑问欢迎留言。</strong></p><a id="more"></a><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a><strong>代码实现</strong></h3><h4 id="hexo-extend-helper-register"><a href="#hexo-extend-helper-register" class="headerlink" title="hexo.extend.helper.register"></a><strong>hexo.extend.helper.register</strong></h4><p><a href="https://hexo.io/zh-tw/api/helper.html" target="_blank" rel="external nofollow noopener noreferrer">文档说明</a>，借助该函数，可以在Hexo渲染生成页面文件<strong>之前</strong>，完成用户的自定义JavaScript代码。</p><p>其实，在Hexo的框架内，ejs（或其他类型的）模板中的代码就是渲染生成html的代码，在这些页面中，借助Hexo内建的对象，比如.post对象和.achieves对象，可以访问到其中保存的全部文章信息及关联信息。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> posts = hexo.locals.get(<span class="string">'posts'</span>);</span><br><span class="line"><span class="keyword">let</span> Xtags = posts.data[x].tags</span><br><span class="line"><span class="keyword">let</span> tagsY = Xtags.data[y].name</span><br></pre></td></tr></table></figure><p>上述内容，可以最终得到第<strong>X</strong>篇文章（POST）中的第<strong>Y</strong>个标签的文本。类似的方法同样可以得到某篇文章的Categories的信息。这就是构造可视化数据的基本方法。（在渲染前构造、借助.post对象）<br>关于位置，在ejs模板中放置构造代码当然可以，但是不优雅，Hexo中建议的插入方式是：</p><ol><li>在专门放置自定义JavaScript处理逻辑的文件中（plugin.js）放入代码，并使用内建函数。</li><li>在ejs（或其他）模板的相关位置，使用&lt;%%&gt;方式调用上述内建函数</li><li>使用console.log在渲染html时（hexo generate时的黑框）输出至Console里，拿到输出数据，放入到可视化的页面中即可。</li><li>或者一气呵成，直接将可视化的代码写入ejs模板中，即第一次渲染结束时产生的html就已经完成可视化页面的生成。</li></ol><p>由于处在尝试阶段，所以这里使用步骤3 的方法，这样各模块相对独立，对主题源代码入侵小。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="可视化页面"><a href="#可视化页面" class="headerlink" title="可视化页面"></a><strong>可视化页面</strong></h4><p>这里采用的是 D3.js 进行的可视化呈现，基本上是复用的 d3 的官方模板，但将文本信息一并和节点进行可视化展示。这段代码首先需要被抽取出来，这对于 d3 来说非常简单，只需注意引入的JavaScript库以及使用的json文本数据。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg width=<span class="string">"1000"</span> height=<span class="string">"1000"</span>&gt;&lt;<span class="regexp">/svg&gt; /</span><span class="regexp">/d3绘制的内容全部放置在该画布上</span></span><br><span class="line"><span class="regexp">&lt;script src="https:/</span><span class="regexp">/d3js.org/</span>d3.v4.min.js<span class="string">"&gt;&lt;/script&gt; </span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var sss = 'JSON字符串'; //这就是整个代码所可视化的数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var abc = parseInt($("</span>.card<span class="string">").css("</span>width<span class="string">").replace("</span>px<span class="string">","</span><span class="string">"));</span></span><br><span class="line"><span class="string">  if(abc&gt;1080) abc=1050;</span></span><br><span class="line"><span class="string">  else if(abc&gt;1040) abc=1020;</span></span><br><span class="line"><span class="string">  else abc=abc-40;</span></span><br><span class="line"><span class="string">  $("</span>svg<span class="string">").css("</span>width<span class="string">",abc);</span></span><br><span class="line"><span class="string">  $("</span>svg<span class="string">").css("</span>height<span class="string">",abc); //此部分将画布大小跟随文章页宽度变化</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var svg = d3.select("</span>svg<span class="string">"),</span></span><br><span class="line"><span class="string">    width = abc,</span></span><br><span class="line"><span class="string">    height = abc;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var color = d3.scaleOrdinal(d3.schemeCategory20);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var simulation = d3.forceSimulation()</span></span><br><span class="line"><span class="string">    .force("</span>link<span class="string">", d3.forceLink().id(function(d) &#123; return d.id; &#125;))</span></span><br><span class="line"><span class="string">      .force("</span>charge<span class="string">", d3.forceManyBody().strength(-180).distanceMin(10).distanceMax(300).theta(1))</span></span><br><span class="line"><span class="string">      .force("</span>center<span class="string">", d3.forceCenter(width / 2 - 40, height / 2 - 30));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var graph = JSON.parse(sss);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  var link = svg.append("</span>g<span class="string">")</span></span><br><span class="line">      .attr("class", "links")</span><br><span class="line">    .selectAll(<span class="string">"line"</span>)</span><br><span class="line">    .data(graph.links)</span><br><span class="line">    .enter().append(<span class="string">"line"</span>)</span><br><span class="line">      .attr(<span class="string">"stroke-width"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(d.value); &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> node = svg.append(<span class="string">"g"</span>)</span><br><span class="line">      .attr(<span class="string">"class"</span>, <span class="string">"nodes"</span>)</span><br><span class="line">    .selectAll(<span class="string">"g"</span>)</span><br><span class="line">    .data(graph.nodes)</span><br><span class="line">    .enter().append(<span class="string">"g"</span>)</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">var</span> circles = node.append(<span class="string">"circle"</span>)</span><br><span class="line">      .attr(<span class="string">"r"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) <span class="keyword">return</span> d.group/<span class="number">100</span>*(<span class="number">10.00</span>/<span class="number">48.00</span>)+<span class="number">1</span>; <span class="comment">//取整</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> d.group+<span class="number">1</span>;</span><br><span class="line">&#125;)</span><br><span class="line">      .attr(<span class="string">"fill"</span>,  <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) <span class="keyword">return</span> <span class="string">"#ff4081"</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="string">"#3f51b5"</span>;</span><br><span class="line">&#125;)</span><br><span class="line">      .call(d3.drag()</span><br><span class="line">          .on(<span class="string">"start"</span>, dragstarted)</span><br><span class="line">          .on(<span class="string">"drag"</span>, dragged)</span><br><span class="line">          .on(<span class="string">"end"</span>, dragended));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lables = node.append(<span class="string">"text"</span>)</span><br><span class="line">      .html(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> p = d.group/<span class="number">100</span>*(<span class="number">10.00</span>/<span class="number">48.00</span>)+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"&lt;a style='font-size:"</span>+p+<span class="string">"px;font-weight:600;color:red' href='/categories/"</span>+d.id.replace(<span class="string">"_"</span>,<span class="string">"-"</span>)+<span class="string">"'&gt;"</span>+d.id+<span class="string">"&lt;/a&gt;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">var</span> q = d.group+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"&lt;a style='font-size:"</span>+q+<span class="string">"px;' href='/tags/"</span>+d.id+<span class="string">"'&gt;"</span>+d.id+<span class="string">"&lt;/a&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .attr(<span class="string">'x'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) <span class="keyword">return</span> d.group/<span class="number">100</span>*(<span class="number">10.00</span>/<span class="number">48.00</span>)+<span class="number">5</span>; <span class="comment">//取整</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> d.group+<span class="number">3</span>;</span><br><span class="line">&#125;)</span><br><span class="line">      .attr(<span class="string">'y'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) <span class="keyword">return</span> d.group/<span class="number">100</span>*(<span class="number">3.00</span>/<span class="number">48.00</span>)+<span class="number">5</span>; <span class="comment">//取整</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">  node.append(<span class="string">"title"</span>)</span><br><span class="line">      .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.id; &#125;);</span><br><span class="line"></span><br><span class="line">  simulation</span><br><span class="line">      .nodes(graph.nodes)</span><br><span class="line">      .on(<span class="string">"tick"</span>, ticked);</span><br><span class="line"></span><br><span class="line">  simulation.force(<span class="string">"link"</span>)</span><br><span class="line">      .links(graph.links);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ticked</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    link</span><br><span class="line">        .attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span><br><span class="line">        .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span><br><span class="line">        .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span><br><span class="line">        .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span><br><span class="line"></span><br><span class="line">    node</span><br><span class="line">        .attr(<span class="string">"transform"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">"translate("</span> + d.x + <span class="string">","</span> + d.y + <span class="string">")"</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragstarted</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) simulation.alphaTarget(<span class="number">0.3</span>).restart();</span><br><span class="line">  d.fx = d.x;</span><br><span class="line">  d.fy = d.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragged</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">  d.fx = d3.event.x;</span><br><span class="line">  d.fy = d3.event.y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragended</span>(<span class="params">d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!d3.event.active) simulation.alphaTarget(<span class="number">0</span>);</span><br><span class="line">  d.fx = <span class="literal">null</span>;</span><br><span class="line">  d.fy = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h4 id="构造数据格式"><a href="#构造数据格式" class="headerlink" title="构造数据格式"></a><strong>构造数据格式</strong></h4><p>需要匹配示例的输入格式，这样才能最大化的复用代码。上述内容的官方示例中使用的格式是：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"nodes"</span>: [</span><br><span class="line">    &#123;<span class="attr">"id"</span>: <span class="string">"Myriel"</span>, <span class="attr">"group"</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    ... ...</span><br><span class="line">    &#123;<span class="attr">"id"</span>: <span class="string">"Mme.Hucheloup"</span>, <span class="attr">"group"</span>: <span class="number">8</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"links"</span>: [</span><br><span class="line">    &#123;<span class="attr">"source"</span>: <span class="string">"Napoleon"</span>, <span class="attr">"target"</span>: <span class="string">"Myriel"</span>, <span class="attr">"value"</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    ... ...</span><br><span class="line">    &#123;<span class="attr">"source"</span>: <span class="string">"Mme.Hucheloup"</span>, <span class="attr">"target"</span>: <span class="string">"Enjolras"</span>, <span class="attr">"value"</span>: <span class="number">1</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即，需要在可视化页面被渲染出来之前就得到上述格式的数据，这便是要借助Hexo的辅助函数来完成，将构造数据的代码封装成一个函数，然后在<strong>适当的</strong>ejs模板中调用一下，即可在 hexo generate 之后，从Console中拿到构造好的数据。</p><p>在此，构造规则是：<strong>类别永远单向的指向标签，类别不互连，标签不互连</strong>，同时，还需要计算的是类别和标签出现的<strong>次数</strong>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.helper.register(<span class="string">'getPostData'</span>, () =&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> posts = hexo.locals.get(<span class="string">'posts'</span>);</span><br><span class="line"><span class="keyword">var</span> tagsMap = <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">//counter</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 利用posts对象获取类名和标签名</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; posts.length; i++)&#123;</span><br><span class="line"><span class="keyword">var</span> nameCS;</span><br><span class="line">posts.data[i].categories.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">k, v</span>) </span>&#123;</span><br><span class="line">nameCS = k.name;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j&lt; posts.data[i].tags.length; j++)&#123;</span><br><span class="line"><span class="keyword">var</span> pname = posts.data[i].tags.data[j].name;</span><br><span class="line"><span class="keyword">var</span> pval = tagsMap.get(pname);</span><br><span class="line"><span class="keyword">if</span>(pval != <span class="literal">null</span>)&#123;  </span><br><span class="line"><span class="comment">// 将类名和标签名压制在一起</span></span><br><span class="line">tagsMap.set(nameCS+<span class="string">"&gt;"</span>+pname, <span class="built_in">parseInt</span>(tagsMap.get(pname))+<span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line">tagsMap.set(nameCS+<span class="string">"&gt;"</span>+pname, <span class="number">1</span>);  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//由此开始，构造符合特定格式的JSON字符串  </span></span><br><span class="line"><span class="keyword">let</span> obj= [];</span><br><span class="line"><span class="keyword">let</span> setss =  <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span>[k,v] <span class="keyword">of</span> tagsMap) &#123;</span><br><span class="line">    <span class="keyword">var</span> st = k.split(<span class="string">"&gt;"</span>);</span><br><span class="line">    <span class="keyword">var</span> str = &#123;&#125;;</span><br><span class="line">    str.source = st[<span class="number">0</span>];</span><br><span class="line">    str.target = st[<span class="number">1</span>];</span><br><span class="line">    str.value  = v;</span><br><span class="line">obj.push(str);</span><br><span class="line"><span class="keyword">if</span>(setss.get(st[<span class="number">0</span>]) != <span class="literal">null</span>)&#123;  </span><br><span class="line"><span class="comment">// 类节点 每次加100</span></span><br><span class="line">setss.set(st[<span class="number">0</span>], <span class="built_in">parseInt</span>(setss.get(st[<span class="number">0</span>]))+<span class="number">100</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">setss.set(st[<span class="number">0</span>], <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(setss.get(st[<span class="number">1</span>].trim()) != <span class="literal">null</span>)&#123;  </span><br><span class="line"><span class="comment">// 标签节点 每次加1</span></span><br><span class="line">setss.set(st[<span class="number">1</span>], <span class="built_in">parseInt</span>(setss.get(st[<span class="number">1</span>]))+<span class="number">1</span>);</span><br><span class="line">setss.set(st[<span class="number">0</span>], <span class="built_in">parseInt</span>(setss.get(st[<span class="number">0</span>]))+<span class="number">100</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line">setss.set(st[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">setss.set(st[<span class="number">0</span>], <span class="built_in">parseInt</span>(setss.get(st[<span class="number">0</span>]))+<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obk= [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [k,v] <span class="keyword">of</span> setss) &#123; </span><br><span class="line">   <span class="keyword">var</span> str = &#123;&#125;;</span><br><span class="line">   str.id = k.trim();</span><br><span class="line">   str.group = v; <span class="comment">//通过数量分类</span></span><br><span class="line">   obk.push(str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> d3str = &#123;&#125;;</span><br><span class="line">d3str.nodes = obk;</span><br><span class="line">d3str.links = obj;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(d3str).trim()); <span class="comment">//按第三步说的，可以手动放置数据到可视化页面</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">JSON</span>.stringify(d3str).trim(); <span class="comment">//或按第四步，将数据返回至ejs模板中，直接渲染出可视化页面</span></span><br><span class="line"> </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>注意上述代码中的注释，这里利用了类节点和标签节点出现的次数，来分辨两种节点的种类，因为绘制时类节点和标签节点都是一视同仁的被绘制。如何分辨呢？在可视化页面中有以下代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> circles = node.append(<span class="string">"circle"</span>)</span><br><span class="line">  .attr(<span class="string">"r"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(d.group&gt;=<span class="number">100</span>) <span class="keyword">return</span> d.group/<span class="number">100</span>*(<span class="number">10.00</span>/<span class="number">48.00</span>)+<span class="number">1</span>; <span class="comment">//取整</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> d.group+<span class="number">1</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>按照不同的次数计算步长，得到的类节点的次数一定是<strong>100</strong>的倍数，而标签节点的次数一定小于<strong>100</strong>，这个值可以设的很大，从而让两者不可能出现交集。在判断时“如果次数大于100”，那么就是类节点，取整百的好处是，<strong>归一化方便</strong>。例如上述代码需要给定节点的大小，类节点的次数统计可能是100-4800（1-48次），而标签节点的次数却是1-10（1-10次），如是，两者应绘制的一样大。这就需要归一化，只需要缩放100倍再乘比例系数即可。</p><h4 id="最终调用"><a href="#最终调用" class="headerlink" title="最终调用"></a><strong>最终调用</strong></h4><p>上文中<strong>hexo.extend.helper.register(‘getPostData’, () =&gt; {}）</strong>的“getPostData”即注册的函数名，在ejs（或其他）模板中直接调用即可。但由于我希望把这个可视化模块放在我的评论页或者关于页面，而这两个页面都不是渲染出来的，所以就只能采用先前第三步的做法，只构造出数据，再手动放入可视化页面。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 index.ejs 内添加：</span></span><br><span class="line">&lt;% <span class="keyword">var</span> arr = getPostData(); %&gt;</span><br></pre></td></tr></table></figure><p>所以，需要做的就是找一个渲染页面的ejs，调用下该函数即可，这里放在index.ejs里，注意由于分页可能该模板会构造很多次，所以就会重复输出很多遍JSON数据。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200229003149.png" alt></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><p>基本上还是抓住代码执行的输入输出做文章。从待改造代码的输入找格式，然后从原代码的框架中构造出该格式的数据（输出），就像适配一样，如此便可以利用Hexo可以获得的数据，借助D3.js等可视化库，把自己的博客（知识系统）做一个梳理和呈现，从而更好的帮助自己<strong>管理</strong>和<strong>维护</strong>，也给了自己<strong>二次挖掘</strong>自己知识的机会。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 力导向布局 </tag>
            
            <tag> 图数据 </tag>
            
            <tag> D3 </tag>
            
            <tag> 主题扩展 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>纵览全局的文档组织模式（上）</title>
      <link href="/article/65a9.html"/>
      <url>/article/65a9.html</url>
      
        <content type="html"><![CDATA[<p>对知识系统（eg.博客）而言，良好的组织结构是极为重要的，尤其是当内容增多，关联复杂后显得尤为重要。传统的“分类(Categories)+标签(Tags)”的二级模式虽足以应付大部分用户的需求，但本质上其还是需要用户对已有分类和标签有良好的组织，这对很多用户来说是根本做不到，因为我们往往缺的就是这种“纵览全局”的能力。</p><a id="more"></a><p>分类往往越分越多，标签也是随意放置，久而久之，不仅已有的分类和标签杂乱无章，更为甚者是新增内容时根本不知从何下手，往往需要遍历过往的标签和分类，才能做出最终定夺。现在，通过图布局的方式，可以以一种近乎完美的方式对复杂的内容进行组织，详细效果请查看 <a href="https://old.cz5h.com/other/page_comment.html" target="_blank" rel="external nofollow noopener noreferrer">该页面</a>。</p><h3 id="纵览全局"><a href="#纵览全局" class="headerlink" title="纵览全局"></a><strong>纵览全局</strong></h3><p>对于知识系统（之后均以博客代指）而言，传统的模式只是简单的分支，或者称其为树形结构，在探索过程中，用户就如同“蚂蚁”一样，只得选择先从哪进入，然后再进入到哪里。对于单篇内容而言并无影响，但当需要感知全局时，往往这种模式就会出现问题。</p><h4 id="分级-树形组织方式的不足"><a href="#分级-树形组织方式的不足" class="headerlink" title="分级/树形组织方式的不足"></a><strong>分级/树形组织方式的不足</strong></h4><ul><li><strong>用户开始便直接希望查阅某些内容，且不确定分类时，无法定位（局部要求）</strong><br>可以通过搜索功能完成该需求。</li><li><strong>新增分类和标签时，缺少对已有项的感知能力（全局要求）</strong><br>尤其对于标签，会更加的随意和杂乱，会出现重复、同义等等问题，在每次打标签时都要头疼一番。</li><li><strong>对于所打的标记，没有评价方法，永远不知道分类和标签是否匹配（全局要求）</strong><br>对于已存在的标签或分类，这样打标签是否合理，由于标签的“松散”特性，不同分类中可以出现同一标签，这样在传统分级模式下，分类和标签的契合程度如何，系统的维护者无从知晓。</li></ul><h4 id="天然的解决方案：图布局"><a href="#天然的解决方案：图布局" class="headerlink" title="天然的解决方案：图布局"></a><strong>天然的解决方案：图布局</strong></h4><p>分级/树形标记模式本身就是一个分类过程，自己的知识内容（博客文章）是对象，维护者将其放置在不同的类别下。<strong>标签(Tags)</strong>则更像是分类过程中的副产物，更贴近文章内容，但又言简意赅，通过分级的思考方式，分类和标签和文章的关系是：</p><p><strong>分类-标签-文章（1:M:N）</strong></p><p>对于上述关系，分别用A、B、C表示的话，则整个系统其实就是一个“Ai-Bi-Ci”的三元组集合。该集合的好坏（即质量）就是其在<strong>语义上的</strong>契合程度，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">分类:军事 -&gt; 标签:爆炸 -&gt; 文章:伊拉克遭遇恐怖袭击</span><br><span class="line">分类:娱乐 -&gt; 标签:爆炸 -&gt; 文章:阿富汗遭遇恐怖袭击</span><br></pre></td></tr></table></figure><p>当抽象为网络/图之后，军事类别和娱乐类别会通过“爆炸”这一标签相连，如是，明显的会发现“爆炸”位置不对。（虽然例子很蠢，但当语义区分模糊、标签数量繁多时，极易出现该情况）。下面直接拿已完成的布局来解释：</p><p><strong>粉红色为分类、蓝色为标签、节点半径为被使用的次数</strong></p><ul><li><p>语义不符的连接点（异常的跨类标签），如果连接点对某一方语义不匹配，那么很可能该文章是<strong>特殊的</strong>，或者该标签不应该出现在该文章。（下图里可视化的文章<a href="https://old.cz5h.com/article/2019-8-11%20%E5%91%8A%E5%88%AB%E3%80%8A%E9%95%BF%E5%AE%89%E5%8D%81%E4%BA%8C%E6%97%B6%E8%BE%B0%E3%80%8B.html" target="_blank" rel="external nofollow noopener noreferrer">在这儿</a>，属于特殊文章，正常“生活分类”和“可视化”的语义并不匹配）<br><img src="https://ae04.alicdn.com/kf/U2beb48a41f60408eb225a3dd6cb3d4552.png" alt="image.png"></p></li><li><p>合格的连接点（跨分类的标签）：虽然标签出现在不同分类中是非常正常的，例如“总结”，可以出现在任何分类中。但类似“总结”这类标签往往数量很多，即多次的出现在不同的类别中，那我们就说这是一个合格的<strong>跨分类标签</strong>。<br><img src="https://ae03.alicdn.com/kf/U9fa6ab6d5ea54f77a608c079bf4d74beP.png" alt="image.png"></p></li><li><p>对于分类点，以本博客为例，由于是对已存在数据进行分析，所以如果某分类下属节点不足，那么高度怀疑该分类不合理，除非是需要日后扩充的分类。这一需求在图布局的视图下非常容易分辨出来，合格的类别应该有众多叶节点，当叶节点不足，则应考虑<strong>将其降级至标签</strong>。（例如下图中的“朴素贝叶斯”，可将其降级为标签，并归类到“研究方向”中）<br><img src="https://ae03.alicdn.com/kf/U3a58982203d84a5facfdb5569c8f4da9u.png" alt="image.png"></p></li></ul><p><strong>值得注意的一点是：</strong> 这里使用的图布局使用力导向(Force-directed)布局算法，<strong>相关则相近，无关则疏远</strong>，又完美的给布局结果以语义上的解释，即：</p><ul><li>当两个类别及其叶子节点距离很远时，其两者基本无关</li><li>当两个类簇距离很近时，其高度相关</li></ul><p><img src="https://ae01.alicdn.com/kf/U9327897711f44e908795f20dd3b3f297T.png" alt="image.png"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="反推设计"><a href="#反推设计" class="headerlink" title="反推设计"></a><strong>反推设计</strong></h3><p>上节中的分析看似很有道理，布局结果的使用也非常方便，那么如何从无到有将其构建出来？主要有以下几个方面：</p><ul><li><strong>天然的三元组集合：</strong>文章的特性（篇幅长）决定了其不能参与整个构建和评价过程，那么剩下的二元组是天然的<strong>“关系数据”</strong>，对于关系数据的可视化，<strong>图布局算法/模式</strong>首当其冲。</li><li><strong>分析需要呈现的维度：</strong>对于任意节点（布局时类别和标签并无分别）来说，主要有以下维度信息：<ol><li>自己（如果是类别）包含哪些标签；</li><li>自己是什么类型的节点（类别？标签？）；</li><li>自己被使用了几次；</li></ol></li><li><strong>对应的可视化要素：</strong><br>a. 图中节点的邻节点（点、线）<br>b. 类别为粉色标签为蓝色（颜色）<br>c. 次数与节点的半径成比例（圆面积）</li><li><strong>还可以附着信息（扩展维度）的要素：</strong><ol><li>节点的形状（三角形、圆、方）</li><li>连线的颜色（红、蓝）</li><li>连线的线型（虚线、实线）</li></ol></li></ul><p>上述过程中，确定<strong>“图布局”</strong>模式是基础，剩下的无非是<strong>将信息绑定到可视化元素上</strong>，例如，已实现的布局将“类别/标签”用<strong>颜色</strong>区分，其实用<strong>形状</strong>等其他可视化元素区分也完全可以。</p><h3 id="垂直打击"><a href="#垂直打击" class="headerlink" title="垂直打击"></a><strong>垂直打击</strong></h3><p>到此为止，只是上层结构，类似数据库存储，搞了半天只是在搞索引，并没有触碰到数据，所以目前为止该网络并没有直通最底层（文章内容）的能力，这个问题恰好被<strong>Hexo的文件结构</strong>所解决，Hexo给每个标签和每个分类都渲染了单独的页面，关联的文章被放置在页面中，在此，直接通过<strong>节点的文本信息构造访问地址</strong>，将其绑定到文本上，即可点击后跳转到相关页面，虽然不是直接跳转文章，但也可以说具备相当的垂直打击能力了。</p><p><strong>进阶版本：变的更强</strong></p><p>简单粗暴的加入之前三元组被抛弃掉的文章信息，但由于加入后过于散乱，所以有必要将文章信息固定，以便于视觉呈现。如下图（d3.js实现的、用于可视化编程概念的可视化模型）：</p><p><img src="https://ae03.alicdn.com/kf/U2be0137ae48c4538a5bcb4e8da2d0db3u.png" alt="image.png"></p><p>上图就是简单的<strong>带固定节点的力导向布局</strong>，但其实现代码比较复杂，目前处在构造数据阶段。一般的可视化模型套用的步骤：</p><p><strong>阅读原站代码 -&gt; 从原站抽离可视化部分 -&gt; 搞清调用数据的方法及格式 -&gt; 构造同样的数据 -&gt; 独立运行 -&gt; 放回自己的站点内</strong></p><h3 id="问题迎刃而解"><a href="#问题迎刃而解" class="headerlink" title="问题迎刃而解"></a><strong>问题迎刃而解</strong></h3><p>到此，对于分级/树形分类的三点不足，可以发现很轻松就可以解决。既有全局视角，又可以同时具备直达的能力，对于组织内容数量较高（超过50）的站点非常适合该模式的导航、或辅助探索。</p><p>扯犊子完毕，下一篇（分为上下两篇）将详细说明一下如何遵循上节中的套用步骤、借助Hexo的辅助函數（Helper）来一步步实现的该可视化功能的。</p><p><img src="https://ae04.alicdn.com/kf/U726402819986478a9067261fe59f92a3w.png" alt="image.png"></p><p><a href="https://old.cz5h.com/other/page_comment.html" target="_blank" rel="external nofollow noopener noreferrer">传送门，请用PC查看</a></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 力导向布局 </tag>
            
            <tag> 图数据 </tag>
            
            <tag> D3 </tag>
            
            <tag> 主题扩展 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary and Review of 2019, B</title>
      <link href="/article/9c47.html"/>
      <url>/article/9c47.html</url>
      
        <content type="html"><![CDATA[<p><strong>This article is a set of memories, belonging to the list of RMBATS</strong>.</p><h3 id="August"><a href="#August" class="headerlink" title="*August *"></a>*<em>August *</em></h3><p><strong>From</strong> July, after I finished my master’s defense, I had been modifying my paper to try to publish it. It’s a long and boring time, which time I have to see the long papers and try to shorten it to a  condensed version. So, in the head of this month, I do this paperwork every day with the hot summer weather. To against the summer, my friend and I started to sleep in the lab. Because the lab has an air-condition that we can let it open all night to keep low temperatures. It’s a funny period, my friend slept with the foldable bed he bought. I didn’t have that bed, so I put the chairs together and slept on them. I have to admit that it’s not a good place to sleep, we have to wake up early in case someone else finds us. Anyway, at least it’s cold enough, we can overcome any problems but the hot temperature at that time.   </p><a id="more"></a><p><strong>After</strong> the main tasks finished, the day I have to leave finally come to see me. It’s time to say goodbye to NEU, although I want to say that many times before that time. No feelings about sadness, but I felt that I hadn’t prepared for that. I knew that I have wasted too much time here, continue to stay here could help me nothing. So, on August 16, I asked my supervisor that I want to go, he didn’t try to keep me anymore. I left my university in that afternoon, and my two friends come to see me off. I arrived home at about 11:00 pm. It’s a remarkable day cause it’s my birthday and I farewelled to my school on this unique day.   </p><p><strong>A</strong> few days later, I started to prepare the materials needed for going abroad. The first thing I need to do is to submit the contract to the scholarship council office in Beijing. So, father and I spent almost one week in Beijing and visited many attractions and scenic areas. But, unfortunately, we didn’t buy a ticket to enter the Forbidden City. Of course, we climbed the Great Wall. In those days, we lived in different hotels every night, and one day, we lived near. Most of the time we take the subway and ride the shared bikes. I need to say that is a wonderful way to travel around Beijing with this kind of bikes, not too expensive, but you can go anywhere you want.</p><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1gafrjvk2zlj31wq0x77wn.jpg" alt="image"></p><h3 id="September"><a href="#September" class="headerlink" title="September"></a><strong>September</strong></h3><p><strong>The</strong> time came to September, the longest summer vacation was coming. It could be more than three months, which means I need to stay at home for about 100 days. I supposed to finish many things, but actually, I wasted most of the time. The environment and atmosphere are not good for focusing. Sometimes, I watched TV all day and didn’t want to do anything. Generally speaking, it’s not a healthy period of time.  </p><p><strong>At</strong> the beginning of this month, I spent a lot of time to install the new router and build the new home network. Then, I tried to let my NAS work in the local network and connect it with the smart TV. The process was complex, I need to test them, then improve them. Finally, every component worked well. And with the DDNS service of Synology, I could let the whole system access to the Internet. Now, this system is still working very well. I can check and fix all problems with the remote connection, even though I stay on the other side of the earth!</p><p><strong>Then</strong>, one interesting experience is that I joined an activity about assisting-poverty. People come from the local educational department went inside the countryside by themselves. With the stuff of rice, eating-oil or white flour, they can help these poor people try to get rid of poverty. This is a very meaningful and useful measure to help poverty, but the question is obvious. These things could help them through away the current hard time, but can’t have any benefits on their hard life in the long run. Anyway, it’s a good trend for poverty, maybe we could find a better way to help them.</p><p><strong>At</strong> the end of September, I received the email to get the visa of the Netherlands from the embassy in Beijing. So, I came to Beijing again, after that, I came to Wuhan to meet my bachelor supervisor as I promised before. What I didn’t expect was that my classmate invited me to play together. So after leaving Wuhan, I went to Qinhuangdao with him and spent two days there. These things all happened before the National Day, the last week of September, which left me a deep impression. I met and talked with my supervisor again. I can’t imagine the uncertain way of my future we discussed last year incredible came true at that time. Although we shared a simple lunch together, we talked about many things. I can feel his happiness from his face. After saying goodbye to HZAU, I had a very enjoyable two days with my other friend. Then, I came to Tianjin right away and met with another friend in Qinhuangdao, and spent two days to visit Beidaihe. </p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1gafrjam9i0j31st0ykx6u.jpg" alt="image"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="October"><a href="#October" class="headerlink" title="October"></a><strong>October</strong></h3><p><strong>On</strong> the National Day, of course, I stayed at home and watched the celebration show on the TV.  The main theme for this month is watching TV and eating with others. I spent some good days with much meaningful time shared with my family members. Eating lunch or dinner with them actually is a way to say goodbye. After all, I need to leave them for more than one year, which means we can’t see each other face to face anymore. As I have a big family, so I ate many times with them outside this month. Besides that, I also visited some local interesting place and took some beautiful photos. This is my first serious attempt to explore my hometown. I admit that I supposed to do that early, but only then did I discover the beauty of my hometown.</p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1gafriikw76j31sf0ymu12.jpg" alt="image"></p><h3 id="November"><a href="#November" class="headerlink" title="November"></a><strong>November</strong></h3><p><strong>Since</strong> October, time passed very fast, and every day I worried about the coming of the day I need to leave. When the time came to November, I prepared everything and wait the final day. On November 6, I spent the last night at home, I have forgotten the feelings but that was definitely a hard time for me. Although it likes a normal leaving from home, I knew this time I would leave for a long time. The fight was not feeling well cause it covered the whole sleeping time. After solving some troubles, I finally arrived in the Netherlands. I finally touched the ground far away from my home. Not have too many strange feelings, I adapt to the foreign environment very quickly. With the help of an elder friend from Eindhoven, I came to my hostel smoothly. I surprised that it just about one hour from Amsterdam to Utrecht by car. </p><p><strong>In</strong> the start days, I suffered from the time difference, I spent a long time to adjust the sleeping time. Now I have fully adapted the life here. The most important thing then was the meeting with my supervisor. Before that, we didn’t meet each other, so it was nervous when I first met him, but he is a nice person and a good guide man. Actually we talked a lot, and he told me a lot of related things I need to learn. Then the long time of self-study came, till now, I still in the first step. Alex, my supervisor, said my horizon of this area could extend bigger and bigger, but I need to start from the smallest circle. This is a big difference compared with the speed of study in China. </p><p><strong>This</strong> month, the first remarkable time was to visit my friend in Eindhoven. The friend and I all come from the same place in China so that she is almost like a relative for me. We had a warmful dinner time and took part in the GLOW 2019 lighting show together. One week later, I followed my colleagues to come to Groningen to meet with some other friends. They are all my supervisor’s Ph.D. candidates. Because Alex worked in Groningen before, so some of his students still lived there, not moved to Utrecht with him. We ate hot-pot and played a table game together. What a good time! I even first meet a friend come from Taiwan, she is a nice girl and study in Groningen for her master degree. Compared with Utrecht, I like Groningen more, because of the low housing rent and the low cost of living. </p><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1gafrhcmo4wj31oo0ylu12.jpg" alt="image"></p><h3 id="December"><a href="#December" class="headerlink" title="December"></a><strong>December</strong></h3><p><strong>After</strong> Black Friday, I spent one week to pick up my delivery. At the end of the first week of December, I received them all, then I started to build my own mini-ITX computer. Now, the machine works very well, and thanks to the small pc, I can get rid of the feeling of alone. After the half of this month, people slow down to prepare the Christmas day and the New year. Although we Chinese don’t care about these two festivals too much, we still happy to join the different activities for them. I joined the final borrel drinks party of my faculty. And also joined the Christmas party of the Chinese Utrecht Christian Church. Besides, we Chinese colleagues also spent some special party, like making dumplings together in the winter solstice. And these days, I also developed a good relationship with my hoster, a nice man comes from Pakistan. He invited me to his home and I had a wonderful daytime with him and his son. What’s more, I also made some Chinese friends here, Mr. Wei and Ms. Wang are a Chinese couple here. I came to their home and ate dinner together many times. It’s Ms. Wang who takes me to the church activity, and then we visit the Castle De Haar by bike. I took some photos of her using my camera, she liked them very much. The other Chinese is the owner of a Chinese restaurant, I went to their restaurant to eat dinner for many times. One of her friends is a researcher from  Maastricht University, we talked a lot about life and study. </p><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1gafrgn6ih5j31r50yokjr.jpg" alt="image"></p><p><strong>Today</strong> is December 31, the last day of 2019, I will go to Eindhoven by train to attend the party. Tomorrow is no difference between today, but, it is a truly time point to have a new start. New beginning needs old ending. A good summary and review of the past are essential for a new and bright future. Try to do that, discover and explore yourself!</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> Summary </tag>
            
            <tag> Writing </tag>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary and Review of 2019, A</title>
      <link href="/article/9d07.html"/>
      <url>/article/9d07.html</url>
      
        <content type="html"><![CDATA[<p><strong>This article is a set of memories, belonging to the list of RMBATS.</strong></p><p>Say goodbye to 2019, the year that changed my life and destiny.</p><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1gaj51qzdc0j31z40gjnpe.jpg" alt="image"></p><h3 id="The-first-half-of-2019"><a href="#The-first-half-of-2019" class="headerlink" title="The first half of 2019"></a><strong>The first half of 2019</strong></h3><p><strong>F</strong>rom the second half of 2018, I’ve been working on the application of CSC. All things happened can be found in last year’s summary. This year is the harvest time. Here, I’ll put those important things together with some good pictures, which likes the mode of last year’s summary.</p><a id="more"></a><p><strong>T</strong>he part of the beginning of this year has been recorded in the summary of 2018, including the first two months. From March, I came back to school after finishing the winter vacation. This semester is a special period for me because all my classmates and roommates left school. They had finished their whole study and master’s defence before the winter vacation. But for me, I had to start the way with myself, I need to write my master’s thesis and finish the relative experiments in three months. Besides, in March, I also need to prepare all documents and fill in the online CSC applying system. And to prepare a second choice for myself, I got in touch with a professor of SDU. The professor, Mr Yunhai, gave me several hard questions that I need to take a lot of time to read his papers to make an answer. </p><p><strong>A</strong>fter March, I started a long time with paperwork and coding. I went to the lab every day, which is ironic to me that I hardly ever went to the lab before this semester. At that time, I got a good experience with other students. The whole lab just had one 3-grade student so that everyone else showed their respect for me and I helped them to solve some troubles. Most time I was writing my master’s thesis. It’s hard to have a good structure and start, I took much time to discuss with my professor. </p><p><strong>T</strong>ime escaped fast, after April, I started to worry about the result of my application. I worried about what I should do if the application was failed. This kind of feeling around me for the whole of May. On May 31, the final result came out, I still remember that afternoon. I refreshed the browser again and again and kept my eyes on QQ to catch every message. Someone started to post good news in the QQ group, I even can’t breathe at that time. Finally, the red pages jumped out and I almost cried when I see this good news. I can’t describe the happiness after I received the good news, I went to play the badminton with my friends. That day, I realized what is relaxation, and finally, the burden in my heart was put down.</p><p><img src="//tva4.sinaimg.cn/large/006YHUzUgy1gahvxt21esj31ua0yme87.jpg" alt="image"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="June"><a href="#June" class="headerlink" title="June"></a><strong>June</strong></h3><p><strong>T</strong>ime to June, the feeling of happiness almost disappeared after I came back from home. Instead, I was nervous about the master’s defence, I thought the final day would be mid of June, so I worked very hard to finish the thesis. I used April to develop the System and used two months to write, but actually, the content mostly finished in June. Finally, I finished the thesis with more than 70 pages and 30,000 Chinese characters. It’s a huge project, the system built with the cluster of 16 PCs, and the whole project contains more than 10,000 code lines. I finish them all in three months, maybe I will write one post to introduce my thesis and my research works. </p><p><strong>B</strong>esides, from that moment, I already started to pack my stuff. Because I delayed my ending time, I had moved out my original room to a new one, which means I’ve packed them once. But when I try to do this again, there were still too many things to order into my box. Finally, I used 3 big boxes to contain them, and deliver them to home with a high price.</p><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1gahvyyru1gj31wr0xyx6u.jpg" alt="image"></p><h3 id="July"><a href="#July" class="headerlink" title="July"></a><strong>July</strong></h3><p><strong>B</strong>efore July, every month has one Chinese festival so that we have at least one week of free time. With these small vacations, I could come back home every month in the first half of the year. But from this month, I didn’t come back until I left school. In this final period of time, I played a lot with my friend, mostly we play badminton in the gym, we shared a good time in the lab. </p><p><strong>I</strong>n the first week of July, I finally faced the day of master’s defence. To my surprise, we 3 students finished our defence with 7 professors in a small room. Almost all the respected professor attended our defence, including the leader of our faculty. The situation was more serious than the first time of defence. After that, I started to edit thesis, check the content and finally make them into one book. After finishing them all, the boring task came to me. I need to edit the long thesis to 6 or 7 pages. I did this for about one month from July to the mid of August.</p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1gahw062nspj31wj0yn4qv.jpg" alt="image"></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> Summary </tag>
            
            <tag> Writing </tag>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>导出七牛云的数据到本地服务器</title>
      <link href="/article/f2f2.html"/>
      <url>/article/f2f2.html</url>
      
        <content type="html"><![CDATA[<p>大概半年多以前，七牛云就失效了，一个是欠费再一个是没有绑定域名，听说是七牛云被举报了然后就必须要实名认证了，而且测试域名的时间也变得只有一个月之久，基本没什么作用了。如果绑定域名，需要该域名是备案的域名，这对于大部分自建博客的人来说基本就是死路一条了，备案的个人博主还是比较少的。</p><a id="more"></a><p>如上，我自然是没法再访问对象存储里的数据了，不过比较欣慰的是七牛云并不会删除上传的数据，数据仍然在相关的 bucket 里测试域名被回收了，现在要做的就是将数据导出，然后使用其他方案，例如阿里的oss或者自己服务器上，无论如何，将数据从七牛云导出是最重要的，但恶心人的是：七牛云的控制台里没有导出的功能，执行导出要借助额外的工具，全部工具列表如下：</p><p><a href="https://developer.qiniu.com/kodo/tools/1302/qshell" target="_blank" rel="external nofollow noopener noreferrer">https://developer.qiniu.com/kodo/tools/1302/qshell</a></p><p>这里我们使用 qshell，在命令行完成原数据的下载</p><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><strong>准备工作</strong></h4><ul><li><strong>下载 qshell</strong><br>qshell 是一个命令行工具，在 Win 系统下就是个 exe 可执行文件，官方教程还要配置环境变量，其实直接输入该 exe 名称运行也可以。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要在该文件的目录内</span><br><span class="line">$ .&#x2F;qshell-windows-x64-v2.4.0.exe -v</span><br></pre></td></tr></table></figure><ul><li><strong>配置密钥</strong></li></ul><p>在七牛云的web控制台中，个人中心里的密钥管理，可以找到自己的 AK 和 SK，帐号名称即用户名。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;qshell-windows-x64-v2.4.0.exe CBVEWIVBOI82391091231 284VSHDUAVBU98-vgyhsd 1805984583@qq.com</span><br><span class="line">该语句执行完无输出</span><br></pre></td></tr></table></figure><h4 id="库的整体移动"><a href="#库的整体移动" class="headerlink" title="库的整体移动"></a><strong>库的整体移动</strong></h4><ul><li><strong>利用新空间的测试域名</strong></li></ul><p>由于没域名，用 qshell get 下载总是失败，或许不是域名的原因，但总归是卡住了，找了半天找到了可行的新方案，即：</p><p><strong>实名认证 -&gt; 新建Bucket -&gt; 转移空间内的数据 -&gt; 用新空间的测试域名下载</strong></p><p>还是不用备案的域名，符合我的预期，认证也比较简单，上传身份证然后支付宝搞一下就行了，说是三个工作日审核其实完成认证操作后马上就能新建Bucket了，新建完后，记住新空间的名字，下面用 batchcopy 来完成移动。</p><p>注意：新建的空间要和原空间在同一个大区内。</p><ul><li><strong>获得文件名列表</strong><br>这里使用 listbucket 命令，将输出存到文件中，利用 awk 直接取出第一列即可（强烈推荐使用 git bash 运行，大家应该都有）。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;qshell-windows-x64-v2.4.0.exe listbucket whereareyou &gt; tocopy.txt</span><br><span class="line">只有一个参数即：空间名称</span><br><span class="line">其会列出该空间内的全部文件，带文件夹路径</span><br><span class="line"></span><br><span class="line">$ cat tocopy.txt | awk &#39;&#123;print $1&#125;&#39; &gt; only-name.txt</span><br><span class="line">去掉上面输出文件中的其他无关项，只留文件名</span><br></pre></td></tr></table></figure><ul><li><strong>执行 batchcopy</strong><br>其仍属于 qshell 内的命令，是个批量拷贝命令，输入是个文件名构成的文件，可以用 –forece 强制移动。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;qshell-windows-x64-v2.4.0.exe batchcopy --force whereareyou zonelyn -i only-name.txt</span><br><span class="line">参数分别是：旧空间名，新空间名，移动文件的名称列表</span><br><span class="line">...</span><br><span class="line">Copy &#39;whereareyou:image&#x2F;acger&#x2F;app.png&#39; &#x3D;&gt; &#39;zonelyn:image&#x2F;acger&#x2F;app.png&#39; success</span><br><span class="line">Copy &#39;whereareyou:image&#x2F;acger&#x2F;group.png&#39; &#x3D;&gt; &#39;zonelyn:image&#x2F;acger&#x2F;group.png&#39; success</span><br><span class="line">Copy &#39;whereareyou:image&#x2F;gif&#x2F;107659232.gif&#39; &#x3D;&gt; &#39;zonelyn:image&#x2F;gif&#x2F;107659232.gif&#39; success</span><br><span class="line">Copy &#39;whereareyou:image&#x2F;gif&#x2F;120094544.gif&#39; &#x3D;&gt; &#39;zonelyn:image&#x2F;gif&#x2F;120094544.gif&#39; success</span><br><span class="line">Copy &#39;whereareyou:image&#x2F;gif&#x2F;148607128.gif&#39; &#x3D;&gt; &#39;zonelyn:image&#x2F;gif&#x2F;148607128.gif&#39; success</span><br><span class="line">...</span><br><span class="line">移动后会打印出相关信息</span><br></pre></td></tr></table></figure><p><img src="//tvax1.sinaimg.cn/large/006YHUzUgy1gabz5hrs1kj31ec0lhwlv.jpg" alt="image"></p><p>上述操作后，新建的 bucket 中已经具有原空间的全部数据了，并且具有测试域名。这样就比较好办了，有多种方法，这里用 qdownload 批量进行下载，由于需要拼凑下载路径，这里可以直接通过补充配置文件完成。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="最后一步"><a href="#最后一步" class="headerlink" title="最后一步"></a><strong>最后一步</strong></h4><p>在 qshell-windows-x64-v2.4.0.exe 所在的目录新建下载配置文件 dcongf.txt：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;dest_dir&quot;: &quot;F:\七牛&quot;, &#x2F;&#x2F;本地目录</span><br><span class="line">  &quot;bucket&quot;: &quot;zonelyn&quot;, &#x2F;&#x2F;新空间名</span><br><span class="line">  &quot;cdn_domain&quot;: &quot;q35ajtip3.bkt.clouddn.com&quot; &#x2F;&#x2F;外链默认域名</span><br><span class="line">  &#x2F;&#x2F;注释要删掉，不能留</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>批量下载</strong><br>最后就可以执行批量下载的命令了，输入就是上述配置文件，这样会将整个空间内的全部文件下载到本地目录内：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ .&#x2F;qshell-windows-x64-v2.4.0.exe qdownload dconf.txt</span><br><span class="line">Writing download log to file C:\Users\zonglin\.qshell\qdownload\d2f9566497ad74e39755de09c8837d9b\d2f9566497ad74e39755de09c8837d9b.log</span><br><span class="line">...</span><br><span class="line">Downloading image&#x2F;gif&#x2F;165263167.gif [25&#x2F;1364, 1.8%] ...</span><br><span class="line">Downloading image&#x2F;gif&#x2F;166739693.gif [26&#x2F;1364, 1.9%] ...</span><br><span class="line">Downloading image&#x2F;gif&#x2F;170320182.gif [27&#x2F;1364, 2.0%] ...</span><br><span class="line">Downloading image&#x2F;gif&#x2F;174817916.gif [28&#x2F;1364, 2.1%] ...</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>慢慢等待上述过程完成，自此全部数据就从七牛云上弄出来了。全部数据大小在10G内是肯定没问题的，下载可能很慢，等着吧。</p><h4 id="开倒车"><a href="#开倒车" class="headerlink" title="开倒车"></a><strong>开倒车</strong></h4><ul><li>转存到自己的本地服务器</li></ul><p>使用自用服务器，用 nginx 驱动，直接把数据放在自己的机器上，也不用什么cdn加速，因为并没有多少下载量，让 <a href="https://old.cz5h.com/other/page_share.html" target="_blank" rel="external nofollow noopener noreferrer">资源分享面</a> 可用才是最重要的。</p><p><img src="//tvax1.sinaimg.cn/large/006YHUzUgy1gacrmdxnr6j31fn0lvgtw.jpg" alt="image"></p><p>没有 CDN 加速，也没有任何优化，怎么说呢，一个是本身下载的就基本没有，再一个家里的上行速度还可以，如果在国内的话下载体验应该不差，在国外亲自体验下载速度大约在 700kb/s 左右，够用了。</p><h4 id="七牛云的-BUG"><a href="#七牛云的-BUG" class="headerlink" title="七牛云的 BUG"></a><strong>七牛云的 BUG</strong></h4><p>对于带有空格文件名的文件，正常上传到七牛云是可以下载和访问的，但是：<strong>使用 qshell 读出文件列表时，会按空格分割并只能获取第一部分</strong>，这明显是个 <strong>大BUG</strong>，怎么说呢，七牛云的服务本身也就那样，照理说 qshell 这些东西完全可以放在前端页面上，总之令人感觉七牛云是个半成品，反正也不用了，在咋咋地吧。</p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 七牛云 </tag>
            
            <tag> 脚本 </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019圣诞节 — 徒步看风景</title>
      <link href="/article/b8d5.html"/>
      <url>/article/b8d5.html</url>
      
        <content type="html"><![CDATA[<p>今天是正经的圣诞节，应朋友的邀请和他一起去徒步散步，这位朋友来自巴基斯坦，他的荷兰妻子早早就回父母家欢度圣诞去了，显然他和他害羞的小儿子并不喜欢混在一群荷兰人中，所以他说今天我们可以一起去徒步，我自然是没什么事的，就干脆地答应了。当时他建议我要穿一双 <strong>nice shoes</strong>，先前并不晓得他的用意，结果后来走进步道的泥巴中，才明白确实得要一双“硬货”啊，往来的人群都穿着大皮靴，真是心疼我的运动孩。</p><a id="more"></a><h3 id="全程概览"><a href="#全程概览" class="headerlink" title="全程概览"></a><strong>全程概览</strong></h3><p>这次是第一次体验荷兰当地人是如何步行锻炼的，路线是这位朋友经常走的，他有点糖尿病所以每天都要通过走路来消耗掉摄入的多余糖分，自然路线的选择是非常棒的，沿途风景很赞，但美中不足的是，最近天天下雨所以有段路程道路泥泞，非常让人恼火。</p><p><strong>全程包含：公路、林中车道、林中小道、火车铁轨旁道、沿河小道</strong></p><p>整体基本没有海拔起伏，其实荷兰全境的海拔都比较平均。还有全程会发现几乎没有行人，因为是圣诞节！当地人都过节去了，可能非欧美的外国人才这么闲吧，路上还碰见过几次中国人（一看就看出来了）。</p><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9s8bdwawj31i80qmx6q.jpg" alt="image"></p><h3 id="愉快的开始"><a href="#愉快的开始" class="headerlink" title="愉快的开始"></a><strong>愉快的开始</strong></h3><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1ga9rywg91jj32tc1ao7wi.jpg" alt="IMG_20191225_114429"></p><p><img src="//tva4.sinaimg.cn/large/006YHUzUgy1ga9ryy6785j32tc1aokjm.jpg" alt="IMG_20191225_115014"></p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1ga9ryznzufj32tc1ao7wi.jpg" alt="IMG_20191225_115250"></p><p><img src="//tva1.sinaimg.cn/large/006YHUzUgy1ga9rz0zryhj32tc1aonpe.jpg" alt="IMG_20191225_115412"></p><h3 id="令人恼火的泥巴"><a href="#令人恼火的泥巴" class="headerlink" title="令人恼火的泥巴"></a><strong>令人恼火的泥巴</strong></h3><p><img src="//tva4.sinaimg.cn/large/006YHUzUgy1ga9rz33cq4j32tc1aoe84.jpg" alt="IMG_20191225_121336"></p><p><img src="//tvax1.sinaimg.cn/large/006YHUzUgy1ga9rz5iaurj32tc1aoqv8.jpg" alt="IMG_20191225_121433"></p><p><img src="//tva4.sinaimg.cn/large/006YHUzUgy1ga9rz7bbcqj32tc1ao1ky.jpg" alt="IMG_20191225_121555"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="河畔的美景"><a href="#河畔的美景" class="headerlink" title="河畔的美景"></a><strong>河畔的美景</strong></h3><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1ga9rzbwsa7j32tc1aonpe.jpg" alt="IMG_20191225_122927"></p><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1ga9rzdmve0j32tc1aou0x.jpg" alt="IMG_20191225_123227"></p><p><img src="//tva3.sinaimg.cn/large/006YHUzUgy1ga9rzg3x4lj32tc1ao4qs.jpg" alt="IMG_20191225_124618"></p><h3 id="小镇中的小路"><a href="#小镇中的小路" class="headerlink" title="小镇中的小路"></a><strong>小镇中的小路</strong></h3><p><img src="//tvax1.sinaimg.cn/large/006YHUzUgy1ga9rzhwdrgj32tc1aokjo.jpg" alt="IMG_20191225_125152"></p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1ga9rzl7b9pj32tc1aokjn.jpg" alt="IMG_20191225_125459"></p><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9rzo2sg7j32tc1aoe84.jpg" alt="IMG_20191225_125616"></p><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1ga9rzwdp5gj32tc1ao4qs.jpg" alt="IMG_20191225_130543"></p><h3 id="路边的足球场"><a href="#路边的足球场" class="headerlink" title="路边的足球场"></a><strong>路边的足球场</strong></h3><p>在路上我们边走边聊，当然大部分时间是在“作比较”，同一件事在中国会怎样、在巴基斯坦会怎样、在荷兰会怎样，我挺喜欢谈论这些的，因为有些事情非常有趣，比如在荷兰当地：</p><ul><li>如果步行时迎面走来陌生人，互相之间要问好，即使不认识</li><li>和荷兰人当面说话时不要看手机，他们会非常在意</li><li>没路灯的路并不是没人走的路，反而可能很多人走</li><li>基本看不见摄像头，女性单独跑步或散步很常见</li><li>不准酒驾，但喝一点点可以开车，基本没人查，靠自觉</li></ul><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9rzjeqn7j32tc1ao1ky.jpg" alt="IMG_20191225_125410"></p><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9rzq4dauj32tc1ao4qr.jpg" alt="IMG_20191225_125840"></p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1ga9rztv0fmj32tc1aoqv6.jpg" alt="IMG_20191225_130314"></p><h3 id="苍穹下的农场"><a href="#苍穹下的农场" class="headerlink" title="苍穹下的农场"></a><strong>苍穹下的农场</strong></h3><p><img src="//tva3.sinaimg.cn/large/006YHUzUgy1ga9rzyla20j32tc1aou0x.jpg" alt="IMG_20191225_130839"></p><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9s074rm1j38hs2f4he3.jpg" alt="IMG_20191225_132148"></p><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1ga9ryv1wsxj33k01n4qv6.jpg" alt="IMG_20191225_133111"></p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h3><p>在结束这次长途跋涉之后，还在这位朋友家里吃了午饭，巴铁是真的热情，因为孩子妈没在家，所以他亲自下厨，鼓捣了一些黑暗料理，其实味道还不错了。</p><p>说起来这是我第二次拜访他家了，还和他的小儿子聊了半天游戏，果然游戏是无国界的，我想这会是年轻人之间最容易想到的共同话题了，LOL、PUBG、Steam等等，虽然他高中还没毕业，但看来他真的是很喜欢玩游戏啊，没事基本就在家玩 XBOX，他爹也不管他，认为只要他高中毕业，那他就“自由”了，这可能也是一种东西文化的差异吧。</p><p>总之，这次圣诞节是真的体验到了一些不同的东西，当然也非常感谢这位巴铁朋友，中巴友谊万岁！</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 荷兰 </tag>
            
            <tag> 节日 </tag>
            
            <tag> 运动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自己动手丰衣足食</title>
      <link href="/article/e749.html"/>
      <url>/article/e749.html</url>
      
        <content type="html"><![CDATA[<h4 id="古老的传统"><a href="#古老的传统" class="headerlink" title="古老的传统"></a><strong>古老的传统</strong></h4><p>虽然冬至是中国古代流传至今的一个节气之一，但其可不是一个简单的节日，本文目的并不是探究其有趣之处，所以就不展开叙述。总之，在全国范围内，人们都比较看中这个节气，北方吃饺子，南方吃汤圆，或许各地习俗有别（北方还有冬至上坟的习俗），但演变至今日，已然已经成了一个家庭团聚，朋友会面的重要契机，使得人们在忙碌的工作之余，吃口饺子/汤圆，借着热气回味下久违的亲情和友情。</p><a id="more"></a><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1gamhpyjds2j319q0ufqv7.jpg" alt="image"></p><h4 id="饺子来啦"><a href="#饺子来啦" class="headerlink" title="饺子来啦"></a><strong>饺子来啦</strong></h4><p><strong><em>纵使远离家乡千万里，<br>尤恋故土那人那滋味。</em></strong></p><p>作为海外留学的我们，能做的不多，能做的又很多，自己动手丰衣足食。</p><p>今天，从格村远道而来的师兄师姐们，和我们乌特这本地四人小队来了个串联，七个人，挤在不小不大的房子里，叮叮当当做了一天的饭食。回来之后我甚至因为太累而睡了一觉，这一觉睡得安详，因为今天过得又充实又难忘。</p><h4 id="聚餐必备-火锅"><a href="#聚餐必备-火锅" class="headerlink" title="聚餐必备-火锅"></a><strong>聚餐必备-火锅</strong></h4><p>或许这算是最容易想到的形式了吧，容易准备，当然也容易吃。</p><p><strong><em>万物皆可下火锅，<br>吃了坏肚子可不好说，<br>要是为这停了筷，<br>吃货的脸面往哪搁？！</em></strong></p><p>如是，中午我们就吃的火锅，准备了肉和菜，切一切就开涮了，当然，吃火锅前每个人都是做好了最坏打算的，拉肚子这种小事不足挂齿，至少我是这么认为的。席间师兄师姐们表达了要逛古堡的想法，因为他们想逃避下午的包饺子环节，当然我们怎么能让客人劳动呢，所以匆匆吃过火锅后，他们就真的去古堡玩了。在他们走后，我至少又从锅里捞出了五个虾仁，没有享受到的人真是遗憾！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="冬至必吃-饺子"><a href="#冬至必吃-饺子" class="headerlink" title="冬至必吃-饺子"></a><strong>冬至必吃-饺子</strong></h4><p>认真对待每个节日，留下该有的美好回忆，这就不是我们活着的动力所在吗，冬至到了，饺子自然就来报道了。</p><p>下午刚开始包的时候，由于面太软了，我主动请缨，开始了揉面的试炼。最后的体验是，虽然很累，但是看着面粉被一点点揉进面里，感觉还挺不错，下次还揉。</p><p><img src="//tvax3.sinaimg.cn/large/006YHUzUgy1gamhqooe48j319p0u2kjn.jpg" alt="image"></p><p>在九九八十一下（大概）的揉搓之后，面终于硬了，师姐擀皮也找到了感觉，我随即便加入了包饺子小组，嗯，后来发现，我这水平（上图左下部分的）还可以拿个优胜奖，简直没有想到。</p><p>在此不得不提及一下师兄强烈建议加到馅子里的好东西——马蹄。一开始我以为是马的蹄子呢，结果原来是藕一样的东西。三下五除二，剁碎了加入海带、萝卜和肉馅，完成了第一种饺子馅。第二种馅就厉害了，是碎鸡蛋加虾仁，起初我还担心那么大虾仁包的进去不，后来发现自己还是多虑了。﻿</p><p><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1gamhre2kt0j30t00jkb29.jpg" alt="image"></p><p>饺子包好，我们收工，但宇哥的工作才刚刚开始：滚烫的热油在锅里翻滚，将刚包好的水饺直接放入锅中，在这层热油的煎炸下，水饺底部很快便被炸至金黄，这时将少量热水放入其中，盖上锅盖，沸腾的热水和蒸汽会将饺子完全闷熟，待水蒸发殆尽，水煎包就制作完成了。以上便是我在旁边偷师学艺的结果，最终的水煎包，当然也是非常的好吃。嗯，是正宗的味道！</p><p><img src="//tvax4.sinaimg.cn/large/006YHUzUgy1gamhs01y46j319l0wo7wk.jpg" alt="image"></p><p>晚上，我们等了好一会德哈尔城堡的来客，他俩好像走丢了一样很晚才回来，当然那时候我们已经解决完战斗了。师兄师姐们吃着这水饺，连连称赞美味，这或许是对我们最大的欣慰了。饭后，我们再师兄的建议下又玩了那个卡片游戏，这是自从上次在格村玩过之后的第二次完了，惊喜的是，我居然毫无悬念的大比分赢了。</p><p><img src="//tva3.sinaimg.cn/large/006YHUzUgy1gamhsgj2mgj319t0rvx6q.jpg" alt="image"></p><h4 id="离别在今日"><a href="#离别在今日" class="headerlink" title="离别在今日"></a><strong>离别在今日</strong></h4><p>当你觉得快乐、幸福的时候，往往也是感觉时间流逝最快的时候，匆匆告别后，这段时光便只能以记忆再见了。看着收拾一新的餐桌，干干净净的厨房，这一尘不染的样子仿佛我们从未来过，或这房子里的其他租客永远不会知道，我们在这里度过了多么美好的一天。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 荷兰 </tag>
            
            <tag> 节日 </tag>
            
            <tag> 美食 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo主题(EJS模板)自定义页面扩展</title>
      <link href="/article/b5cf.html"/>
      <url>/article/b5cf.html</url>
      
        <content type="html"><![CDATA[<p>自从初次接触 Hexo 到现在已经有两年多的时间了，时间过得飞快啊，关于 Hexo 的优点不再赘述，关于个人站点的优点，有必要在强调一下，那就是极高的自由度，这也是这篇文章的基础。现在有时间刚好总结一下我对于 Hexo 做的一些自定义扩展，虽然之前可能在别的文章中或多或少的涉及了，但并没有统一整理过。</p><a id="more"></a><p><strong>本人主题：Indigo，以下内容均基于此主题所写。</strong></p><p>首先需要明白的是，Hexo 的博客内容（静态内容）均由 generate 生成，其核心是一个 node 应用，提供了一系列帮助函数，或者说调用接口；而各种主题，只不过是在其规定的框架内，以一种特定的模板（ejs/swg/pug），调用特定的 Hexo 帮助函数来完成的。在构造时，这些模板文件每次都会重新生成对应文件，例如文章页面，就是对应的模板文件将编译后的 markdown 格式的文本填入 HTML 页面，同时也会插入进去其他东西（比如题目，尾注等等）。以EJS+LESS为例：</p><ul><li>EJS中包括全部的 html标签 和 JavaScript 脚本</li><li>Less是CSS的一种使用方式，这里可以理解为样式文件，但其样式参数可以用变量来表示，这样在开发主题的过程中就可以简化和统一整个样式所涉及的颜色高度等CSS属性。</li></ul><h4 id="原页面修改"><a href="#原页面修改" class="headerlink" title="原页面修改"></a>原页面修改</h4><p>由上面可知，对博客进行的任何修改，这里特指简单的、在已有界面上的修改，均需要找到渲染/生成该 HTML 页面（浏览器中我们可见的部分）的模板文件，在模板文件中进行我们想要的修改。如果涉及主题的CSS样式，则一般需要找到对应的 less 文件，如果里面用的变量代替，则还需要到存储变量值的文件里去修改变量的值，这样才完成样式的修改，但<strong>偷懒的方法</strong>是，直接在对应生成页面的模板文件中添加style代码段，然后用 !important 将你修改后的样式强制覆盖原先的主题样式。</p><p>总之，或许你的主题文件中包含很多的模板文件，但实际他们是有机的整体，都会在某个模板文件中被引用，从而组合成一个完整的整体，修改时要耐心的去找到最细粒度（对应html语句）的那部分。</p><h4 id="新增页面"><a href="#新增页面" class="headerlink" title="新增页面"></a>新增页面</h4><p>主要有两种方式，一种是添加一个 md 文件，一种是直接放一个 html 文件，前者在渲染时会生成相应的 html 内容，两者本质上没有什么区别，取决于你添加的新页面的内容，比如一般的文本则使用 md 就可以了，但如果是复杂的 js插件，那还是直接添加 html 较好，方便修改。</p><p>这两种方式均需要将 md 文件或者 html 文件放入到 Hexo 根目录的 source 文件夹中，Hexo 的机制是 source 文件夹中的全部文件都会被原封不动的生成到 public 文件夹内（只有 md 文件会被“翻译”成 html 格式）。</p><h4 id="基于-Hexo-参数的修改"><a href="#基于-Hexo-参数的修改" class="headerlink" title="基于 Hexo 参数的修改"></a>基于 Hexo 参数的修改</h4><p>这一部分可以在某些原有页面上添加，也可以是在新增页面上添加。主要是通过借助 Hexo 的程序接口，获取像 文章数量、分类数量、各种标签下分别有多少文章等等数据，通过这些数据，可以完成一些功能，比如：</p><p>主要基于的对象：<strong>分类（Category）、标签（Tags）、文章（Article）</strong></p><p>可以扩展的操作：<strong>过滤、匹配、重构</strong></p><p>其实扩展内容可以由阅读原先的主题文件的代码来理解，因为包括“归档”、“分类”等页面的显示，均用的 Hexo 的帮助函数，具体的函数接口定义与说明可以参照 <a href="https://hexo.io/zh-cn/api/" target="_blank" rel="external nofollow noopener noreferrer">Hexo的API说明</a>。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="案例一：添加关联文章"><a href="#案例一：添加关联文章" class="headerlink" title="案例一：添加关联文章"></a>案例一：添加关联文章</h4><p><img src="//tva1.sinaimg.cn/large/006YHUzUgy1ga64lm7246j30v20iyadk.jpg" alt="image"></p><p>扩展思路：这里使用 Tags 进行比对，相似越多的文章就越相关，在最后一步，Category 相同会优先入选，排序后只取最相关的 TOP3，不足三个则有多少显示多少；</p><p>扩展结构：</p><p><strong>1. 找合适的文件插入实现上述功能的新函数，一般在主题的 plugin.js，之后以注册函数的形式完成代码实现</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">hexo.extend.helper.register(<span class="string">'getTagsList'</span>, (archive, size) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> posts = hexo.locals.get(<span class="string">'posts'</span>);</span><br><span class="line">    <span class="keyword">var</span> articleArr = [];</span><br><span class="line">    <span class="keyword">var</span> small = [];</span><br><span class="line">    size = size || <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">var</span> ishere = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j&lt; archive.tags.length; j++)&#123;</span><br><span class="line"><span class="keyword">var</span> contnu = <span class="literal">true</span>; </span><br><span class="line"><span class="keyword">var</span> tname = archive.tags.data[j].name;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> p = <span class="number">0</span>; p&lt; posts.length; p++)&#123;</span><br><span class="line"><span class="keyword">var</span> tid = posts.data[p]._id;</span><br><span class="line"><span class="keyword">if</span>(small.length == size || !contnu ) </span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> k = <span class="number">0</span>; k&lt; posts.data[p].tags.length; k++)&#123;</span><br><span class="line"><span class="keyword">if</span>( tname === posts.data[p].tags.data[k].name &amp;&amp; ishere.indexOf(tid) == <span class="number">-1</span> &amp;&amp; archive._id != tid)&#123;  </span><br><span class="line"><span class="keyword">if</span>(posts.data[p].category === archive.category &amp;&amp; archive._id != tid)&#123;</span><br><span class="line">small.push(posts.data[p]);</span><br><span class="line">contnu = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">articleArr.push(posts.data[p]);</span><br><span class="line">ishere.push(tid);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(small.length &gt;= <span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> small; </span><br><span class="line"><span class="comment">//正常情况下返回文章数组</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">var</span> ln = articleArr.length;</span><br><span class="line"><span class="keyword">if</span> ( ln &lt; size)  </span><br><span class="line"><span class="keyword">return</span> articleArr.slice(<span class="number">0</span>, ln<span class="number">-1</span>);</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">return</span> articleArr.slice(ln<span class="number">-1</span>-size, ln<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>2. 新建子模板文件（为了模块分离）</strong></p><p><strong>注意：</strong>这里的<code>getTagsList(page, 3)</code>就是对上述代码的调用，<code>page</code>即整个文章对象，可以从中获取到该文章的所属分类和标签信息，<code>3</code>则时控制显示相关文章个数的参数。可以发现每篇文章都需要这样查找一遍，所以该代码最后在第三步中放到了文章页的ejs模板中，<strong>以确保在渲染每篇文章时将相关文章找出并放进页面中</strong>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>「 相关文章 」<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">            //页面全部内容，只有<span class="attr">TOP3</span></span></span><br><span class="line"><span class="tag">            <span class="attr">var</span> <span class="attr">arr</span> = <span class="string">getTagsList(page,</span> <span class="attr">3</span>);</span></span><br><span class="line"><span class="tag">            //每次生成文章都会执行</span></span><br><span class="line"><span class="tag">            <span class="attr">for</span>( <span class="attr">var</span> <span class="attr">i</span> <span class="attr">in</span> <span class="attr">arr</span>) &#123;</span></span><br><span class="line"><span class="tag">                <span class="attr">var</span> <span class="attr">article</span> = <span class="string">arr[i];</span></span></span><br><span class="line"><span class="tag">        %&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&lt;%- url_for(article.path) %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">%-</span> <span class="attr">article.title</span>%&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--显示文章的摘要--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%-</span> <span class="attr">truncate</span>(<span class="attr">strip_html</span>(<span class="attr">article.excerpt</span> || <span class="attr">article.content</span> ), &#123;<span class="attr">length:</span> <span class="attr">100</span>&#125;) %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">            &#125;</span></span><br><span class="line"><span class="tag">        %&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>3. 将上述新模板内容插入到原主题的对应位置内</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">这部分是整个文章页的汇总模板</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;%- partial(&#39;post&#x2F;toc&#39;, &#123; post: post&#125;) %&gt;</span><br><span class="line"></span><br><span class="line">&lt;article id&#x3D;&quot;&lt;%&#x3D; post.layout %&gt;-&lt;%&#x3D; post.slug %&gt;&quot;</span><br><span class="line">  class&#x3D;&quot;post-article article-type-&lt;%&#x3D; post.layout %&gt; fade&quot; itemprop&#x3D;&quot;blogPost&quot;&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    post-card 即文章的主体部分，包括题目、分类、字数、及最下方的标签和分享图标等</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;post-card&quot;&gt;</span><br><span class="line">        &lt;h1 class&#x3D;&quot;post-card-title&quot;&gt;&lt;%- post.title %&gt;&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;post-meta&quot;&gt;</span><br><span class="line">            &lt;%- partial(&#39;post&#x2F;date&#39;, &#123;date_format: config.date_format&#125;) %&gt;</span><br><span class="line">            &lt;%- partial(&#39;post&#x2F;category&#39;) %&gt;</span><br><span class="line">&lt;%- partial(&#39;post&#x2F;wordcount&#39;) %&gt;</span><br><span class="line">            &lt;%- partial(&#39;plugins&#x2F;page-visit&#39;) %&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;post-content&quot; id&#x3D;&quot;post-content&quot; itemprop&#x3D;&quot;postContent&quot;&gt;</span><br><span class="line">            &lt;%- post.content %&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;%- partial(&#39;post&#x2F;copyright&#39;) %&gt;</span><br><span class="line">        &lt;%- partial(&#39;post&#x2F;reward-btn&#39;) %&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;post-footer&quot;&gt;</span><br><span class="line">            &lt;%- partial(&#39;post&#x2F;tag&#39;) %&gt;</span><br><span class="line">            &lt;%- partial(&#39;post&#x2F;share-fab&#39;) %&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    下面的模块，第一个是左右导航栏，第二个是咱们的相关文章模块，第三个是评论</span><br><span class="line">    最后，还包括了打赏图标（reward）在文章最底部</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;%- partial(&#39;post&#x2F;nav&#39;) %&gt;</span><br><span class="line">&lt;%- partial(&#39;post&#x2F;postlist&#39;)%&gt;</span><br><span class="line">    &lt;%- partial(&#39;post&#x2F;comment&#39;) %&gt;</span><br><span class="line">&lt;&#x2F;article&gt;</span><br><span class="line">&lt;%- partial(&#39;post&#x2F;reward&#39;) %&gt;</span><br></pre></td></tr></table></figure><h4 id="案例二：Category-或-Tags-的数值展示"><a href="#案例二：Category-或-Tags-的数值展示" class="headerlink" title="案例二：Category 或 Tags 的数值展示"></a>案例二：Category 或 Tags 的数值展示</h4><p>实现思路：统计分类、标签的重复个数，并绑定其所载文章的创建日期，这样整体上就有变量值、时间值两个维度，可以借助 D3.js 等做一些复杂的分析展示模块。</p><p>假象模块：</p><ul><li>单一维度：分类及标签的名称及数量（柱状图）</li><li>两个维度：文章发布的频率：日历图（类似github贡献图）</li><li>复杂分析：以文章类别为一组，标签为一组，出现在同一文章中则算作有关联，分析全部文章，将分类和标签的关系用 Graph 进行可视化，从而更好的指导分类和标签的匹配关系。</li></ul><p>实现部分：与案例一类似，第二三步骤很简单，关键是上述假象模块的实现，主要包括 <strong>通过 Hexo API 得到相关数据</strong> 和 <strong>通过可视化库进行绘制</strong>。</p><h4 id="继续更新中"><a href="#继续更新中" class="headerlink" title="继续更新中"></a>继续更新中</h4><p><strong>19-12-20 新问题：引入资源文件</strong></p><p>例如想在 Hexo 博客中的某个页面，做成一个资源分享页面（自己用或者给别人用），这样就会涉及文件的下载。其实有以下几种方式实现：</p><ul><li><p>直接将该文件放在博客文件中一起发布，这对于单个小文件来说并无大碍，比如自己的头像完全可以这样放，但（以图片举例）图片过大，或者数量过多，就一定不能将其和其他文件放在一起，原因是：</p><ul><li>Hexo 每次发布都会重新生成博客的全部静态页面，如果资源也放在其中，那么也会每次都刷新一遍，如果是部署在云端或者用Pages服务进行托管的，这样每次的上传量将非常庞大，上传时间会非常长，且浪费时间的恰恰是基本不会修改的资源文件。</li></ul></li><li><p>将资源文件分离，放在其他地方（云空间或Github的其他仓库）。例如使用七牛云进行存储，这样的好处是：</p><ul><li>访问速度有保证，例如七牛云就有融合CDN加速</li><li>对资源的可控性高，可以知道请求的数量等指标，但如果自己去计算这些数据，则需要复杂的代码实现。</li><li>和 Hexo 分离，加快每次的上传更新速度</li></ul></li></ul><p>其实这个问题适用于博客中所涉及的全部资源文件，包括头像、文章中插入的照片等等。七牛云是个不错的对象存储平台（包括文档、图片、媒体文件等等），如果只是图片的话，推荐使用专职的图床进行存储（例如微博图床）。</p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Indigo </tag>
            
            <tag> 主题扩展 </tag>
            
            <tag> EJS模板 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次意义深刻的旅行</title>
      <link href="/article/9cf5.html"/>
      <url>/article/9cf5.html</url>
      
        <content type="html"><![CDATA[<p>此内容系回忆内容，归属于RMBATS列表。</p><p>事件主题是2018年12月 8 号 到 13 号的一次短暂的出国旅行。这是我第一次出国，第一次长途跋涉这么远，第一次… 体验了很多的第一次，自然印象深刻，现在趁着还记得拎出来晒一晒，免得记忆发了酶。</p><p>这次去的是<strong>越南的首都河内</strong>，主要目的是去考雅思的，从下决心到出发时间也就一个月，非常紧张，好在越南可以落地签，所以只要有护照就简单的多了。虽然着了一条龙的服务，但那人没给我弄好，导致我原本可以提前落地签办完的结果没办完，让我自己体验了一把怎么办落地签的流程，怎么说呢，由于是凌晨到达的，而且河内时间比北京时间慢一小时，所以最后到达酒店的时间也就差不多还是凌晨。</p><a id="more"></a><p>考试呢，分在了几天内考，我到的第二天就有场考试，最后看结果嘛自然是晕晕乎乎考的不好。此次同考的伙伴呢，有两位女生，应该都是来自暨南大学的已毕业学姐（去年我还是应届），打算申请香港的博士但卡英语了，所以来这边考。开始我们只是微信认识的，后面也不是一起去的，但总归是住在一个酒店里，一起吃吃饭什么的，她们都是学霸类型的，到后面我就大部分时间都跑出去逛街溜达拍照去了。</p><p>前面也说了，我们找了当地的代理，但为了节省开支，我们只要求住一晚代理安排的酒店（太贵了），然后剩下的几天我们自己找地方住。也就是说基本上正经的旅程是从第二个住处开始的，从第二天起，我们在<strong>南门市场</strong>附近找到了一个小酒店（<strong>Angel Palace Hotel</strong>）住着，位置可以说是非常中心了，后来我逛了才知道，这个位置简直就是来河内游玩的最佳住处之一啊，包括下面这么多的打卡地，都能在半小时或者一个小时内步行走到。而且，晚上的<strong>东京义塾广场</strong>，简直是外国游客的天堂，整个街区基本充斥着外国人，一直到一两点都还非常热闹。</p><p>附近的景点：主要有环剑湖区域、巴亭广场区域、圣若瑟主教堂、河内火车站、统一公园、国家博物馆、军事博物馆</p><p><img src="//tva2.sinaimg.cn/large/006YHUzUgy1gad7mx56oej31z4140e82.jpg" alt="image"></p><p>以上是本次到过的地方，拍了很多照片，下面就挑几张简单回忆一下。</p><h4 id="启程"><a href="#启程" class="headerlink" title="启程"></a><strong>启程</strong></h4><p>这次是从学校走的，从沈阳先坐一晚上的卧铺到北京，然后其二天下午在首都国际机场起飞，先去往 澳门 中转，是中国航空的机票但实际承运是澳门航空的飞机，由于买的是往返票，所以去的时候是 北京-澳门-河内，回来还是这样折腾一遍，不过令人高兴的是，返程的时候我被安排做了<strong>头等舱</strong>，第一次离登机口这么近，坐两个人一排的大椅子，后来分析，只可能是往返票的优惠了，可能知道我是第一次做中国国际航空，而且空间有富余。</p><p><img src="https://tvax1.sinaimg.cn/large/006YHUzUgy1gacvsaafn8j31r70zkahe.jpg" alt></p><p>下午从北京起飞，晚上到达澳门，在澳门逗留两个小时后，八点左右起飞飞往越南，到越南好像也九十点左右（慢一小时），整体这个航线还是可以的，并不影响休息，而且比直达要便宜多了。不过行李是需要下飞机然后在上飞机的，不过时间是完全充足的。</p><p><img src="https://tvax3.sinaimg.cn/large/006YHUzUgy1gacvssi2e6j31r70zkalc.jpg" alt></p><h4 id="抵达"><a href="#抵达" class="headerlink" title="抵达"></a><strong>抵达</strong></h4><p>真是基本去之前什么也没准备，越南盾是在机场的取款机直接取的，越南好些个取款机都支持银联的卡，不需要换汇就可以取出越南盾来，怎么说呢取了几百块钱，瞬间变百万富翁了。下面是两百多万越南盾，实际才六七百块人民币，这些钱省着花的话能花好几天了。</p><p><img src="https://tva1.sinaimg.cn/large/006YHUzUgy1gacvv4jrixj31r70zkk3v.jpg" alt></p><p>怎么说呢，在河内的街头，基本上沿街房都是小商铺，这跟中国的小城镇没什么区别，只是路上的外国人是真的太多了，混在一起多了一种奇妙的感觉。虽然整体很接地气，但却又这么的国际化，这就是河内街头给人的体验。</p><p><img src="https://tva2.sinaimg.cn/large/006YHUzUgy1gacwgecw6dj31r70zkdzv.jpg" alt></p><h4 id="还剑湖方向（Ho-Hoan-Kiem）"><a href="#还剑湖方向（Ho-Hoan-Kiem）" class="headerlink" title="还剑湖方向（Hồ Hoàn Kiếm）"></a><strong>还剑湖方向（Hồ Hoàn Kiếm）</strong></h4><p>这片区域是一片商业区，说是商业区，其实全部是三四层的片楼组成的街道，西起南门市场，东到东京义塾广场，这一片充斥着各种卖衣服的、卖纪念品的、卖水果的、卖画的等等，老外们真的是一堆一堆的，很有视觉冲击，一个这么东方的地方居然遍地是西方人。</p><p><img src="https://tvax4.sinaimg.cn/large/006YHUzUgy1gacw55izivj31r70zkwwt.jpg" alt></p><p>下图是夜晚的环剑湖，湖中间是<strong>玉山祠</strong>。红色的桥叫做<strong>栖旭桥</strong>，晚上非常漂亮。</p><p><img src="https://tvax3.sinaimg.cn/large/006YHUzUgy1gacw3q0ep7j31r70zkgyh.jpg" alt></p><p><img src="https://tvax2.sinaimg.cn/large/006YHUzUgy1gacw4ddwitj31r70zk7km.jpg" alt></p><p>环剑湖再往东方向，靠近<strong>红河</strong>的位置，就是越南国家博物馆和军事博物馆，下面是国家博物馆，里面基本介绍古代越南的历史，有趣的是其和我国的历史有很多交集，有一部分（例如元朝）内容是被美化了，元朝的骑兵止于越南边境或许只是因为气候原因，总之必然不是越南军队顽强抵抗住元军的攻击，仔细想一下是根本不现实的。</p><p><img src="https://tva3.sinaimg.cn/large/006YHUzUgy1gadal07gllj31r70zkax8.jpg" alt></p><p>下面是越南的国家军事博物馆，军事博物馆和国家博物馆是合在一起卖票的，而且它俩就隔着一条街，军事博物馆基本是介绍近代越南建国的历史，这中间的越南共产党和中共的联系就更多了，有很多内容基本都是我们熟悉的风格。你甚至可以看到下图中那面党旗上的汉字（越南共产党）。</p><p><img src="https://tvax4.sinaimg.cn/large/006YHUzUgy1gadailzyc0j31r70zkaif.jpg" alt></p><p>当然，十分微妙的是，关于上世纪中越之间的那场战争，并未出现在此，官方定调的越南近代的主轴仍然是在胡志明的领导下的反美抗争。对于其骚扰中国、亲美抗中等阶段，看不见任何记录。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="巴亭广场方向（Quang-Truong-Ba-Dinh）"><a href="#巴亭广场方向（Quang-Truong-Ba-Dinh）" class="headerlink" title="巴亭广场方向（Quảng Trường Ba Đình）"></a><strong>巴亭广场方向（Quảng Trường Ba Đình）</strong></h4><p>这片区域我觉得集中了大部分河内的行政单位，由于河内是首都，所以包括越南的国会等首都机关也在这一片区域，这附近还有有意思的越战纪念馆，里面有很多美军的飞机残骸，应该是宣扬越战时抗美成果的，时不时还可以看见河内的军人来参观。</p><p><img src="https://tva1.sinaimg.cn/large/006YHUzUgy1gacw6wntnzj31r70zkh3t.jpg" alt></p><p><img src="https://tvax4.sinaimg.cn/large/006YHUzUgy1gad9o5w1dyj31r70zkkc0.jpg" alt></p><p>关于巴亭广场，其实和天安门广场的结构和作用是类似的，只不过胡志明的陵墓成了绝对的主题，是整个广场的核心，而且广场大部分是草坪，不是石板，其对面就是越南的国会。</p><p><img src="https://tva2.sinaimg.cn/large/006YHUzUgy1gacw787nbyj31r70zkgyk.jpg" alt></p><h4 id="圣若瑟主教座堂附近"><a href="#圣若瑟主教座堂附近" class="headerlink" title="圣若瑟主教座堂附近"></a><strong>圣若瑟主教座堂附近</strong></h4><p>这部分其实在我们下榻的酒店和环剑湖之间偏下的位置，虽然也可以算商业区，但不同的是这里当地人更多一些，在这里你能发现更多的越南人生活的真实情况。</p><p>下面是当时东南亚足球锦标赛、越南国家队踢比赛的那晚，年轻球迷们在当街宣传越南队和发放头绳，好像是和菲律宾踢，虽然是区域性的足球赛，但那天晚上真的是整个街区都沸腾了，晚上更是到一两点还是喧闹的气氛。</p><p><img src="https://tva3.sinaimg.cn/large/006YHUzUgy1gacwcabehej31r70zkh2l.jpg" alt></p><p>甚至可以看见在街头下棋的越南人，没错，这就是中国象棋，在当地还是很受欢迎的。</p><p><img src="https://tvax1.sinaimg.cn/large/006YHUzUgy1gacw8hs8d7j31r70zk7i0.jpg" alt></p><p>而圣若瑟主教堂，作为非常有名的打卡地点，基本上百分百能在门口遇见来自中国的旅行团。</p><p><img src="https://tva2.sinaimg.cn/large/006YHUzUgy1gacwd2iw8aj31r70zk1aa.jpg" alt></p><h4 id="統一公園方向（Cong-Vien-Thong-Nhat）"><a href="#統一公園方向（Cong-Vien-Thong-Nhat）" class="headerlink" title="統一公園方向（Công Viên Thống Nhất）"></a><strong>統一公園方向（Công Viên Thống Nhất）</strong></h4><p>这部分在南边方向，非常靠近雅思的考点，人口密度显然没有商业区那么密集，最好玩的就属<strong>统一公园</strong>了，这个公园本身是个长方形的湖加周围一圈的绿植组成的，转一圈估计要一个点，是非常大的。不过在体验到了河内街头的摩托车大军的喧嚣之后，就会知道这里的安静是多么难能可贵了、</p><p><img src="https://tvax3.sinaimg.cn/large/006YHUzUgy1gad5jds6pnj31r70zkk7e.jpg" alt></p><p>摩托车大军。如果说荷兰是自行车王国，那么我真的想说越南是摩托车王国了，一到下班的时间点，嘟嘟嘟的摩托车声音真的是要把耳朵震聋了，而且在河内，Grab打车软件可以打到摩的，且可以看到绿色衣服的摩的数量是非常多的。</p><p>另外很特别的是，越南人骑摩托车非常有安全意识，一个质量好的头盔是必备的。基本人人都自觉地佩戴安全头盔。</p><p><img src="https://tvax4.sinaimg.cn/large/006YHUzUgy1gacwexcfc3j31r70zktof.jpg" alt></p><h4 id="返回北京"><a href="#返回北京" class="headerlink" title="返回北京"></a><strong>返回北京</strong></h4><p>往回走的时候呢，着实被打的滴滴（Grab）坑了一下，在下图的桥上，司机开着车轮胎竟然被爆了，无奈只好下来徒手换轮胎，我这赶着去坐飞机呢，那里还在换轮胎，无语了，这座桥应该算河内数一数二的大桥了，下面就是<strong>红河</strong>，总之耽误了我大概快一个小时。到机场的时候差点没赶上飞机，还是我在拿票的时候求助了国航的工作人员，他们带着我走了快速通道才赶上的，还有幸做了一次机场里的摆渡车。总之要吐槽一下河内机场的安检效率着实太低了。</p><p><img src="https://tvax4.sinaimg.cn/large/006YHUzUgy1gadaaapx1yj31r70zk46l.jpg" alt></p><p>回到北京后的那天早上。回程的时间比较蛋疼，时间是在凌晨，十二点从河内飞往澳门，然后等到早上五点飞北京，基本上那天是没怎么睡觉，还要等到晚上才能做卧铺回学校。就在北京溜达了一下，还去了CBD万达看了《海王》，简直不要太开心。</p><p><img src="https://tvax1.sinaimg.cn/large/006YHUzUgy1gad0c5xo2lj31r70zkk63.jpg" alt></p><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a><strong>后记</strong></h4><p>现在时间是 2019 年的 12 月了，距离这次美妙的旅途已经整整一年了，但一些事情仿佛还历历在目，真的像发生在昨天一样。那时的我偶尔也会幻想有一天自己的努力能换来回报，自己的尝试会有个好结果。那时候，光是这样想一下都觉得非常梦幻，感觉那是遥不可及的梦。不过人的心态是会随境遇不同而变化的，18年暑假开始学雅思的时候，自己连对过雅思都没有信心，第一次考试的结果也确实印证了我的担心，然后就是快两个月的自习室学英语，在临近毕业之际，众人皆找工作之时，我却在教室里看着枯燥的英语，做着不切实际的梦，现在想想，真的很佩服自己下决心的勇气。</p><p>从越南回来，到次年的一月，我才拿到了这次的成绩，因为是连考两次，所以分两天出成绩，第一次的分数出来时一看两个5.5，心里一下子就凉了半截。至于第二次的分数，我至今还记得查分的场景，那天是我们师门最后的一次聚餐，师弟们都参加的那种，我在校门口等着打车，结果收到了出分的消息，结果一查，只有口语5.5，其他都满足了，当时心情肯定是失落的，那天的聚会基本上就没这么说话，回到宿舍就给代理发消息，复议我的口语，当时心情是忐忑的，之前同行的那两位都拿到了自己想要的分数，而我还要等，等待对我来说已经是家常便饭了，终于等到了今年一月十五号，该给我发邮件说复议成功，结果是我所期望的，终于在春节回家前长舒了一口气，我记得那几天是真的高兴，恨不得第二天就回家等着过年。</p><p>那时我的心态稍稍好了一些，感觉着自己的短板被治好了，自己可以以一个各方面都合格的申请者申请CSC了，同事也感觉到那个梦越来越多真实了。这种感觉是一种质的变化，从胆战心惊的条件基本满足，到后来的条件完全满足，虽然对申请结果可能没什么影响，但对自己的心态影响是巨大的：从我有了英语成绩，感觉填系统填的也理直气壮，各种材料也准备的很顺利，提交完申请的那一刻，没任何感觉，只觉得就这样了，应该可以了吧。事实上当时也没有给自己找所谓的“后路”（尝试找过但不了了之），只想着成了就成了，至于不成的事，基本没想过。现在想想，其实也没什么感觉。不喜欢做预案、不喜欢PlanB可能就是我的性格了。</p><p>现在，先前的终极目标已经实现，我也体会到了理想变为现实的美好。从去年八月到今年六月，十个月的时间，我觉得非常好的诠释了什么是“延迟满足”，也让我更坚信了”有付出就有回报”这句话的正确性（但有多少付出并不一定就有多少回报）。</p><p>总之，这次旅途，非常非常的难忘且意义重大。一个是增长了见识，有了初步的国外生存经验；另一个是目标达成，拿到了成绩；最后就是增强了自己的信心，让自己在接下去的日子里坚定地熬下去，从而成就了今天的自己。每次想到考雅思这段记忆，我就想到“盘活”这个词，这就像一步棋，一步盘活死局的棋，下完之后，我不知道能不能赢的漂亮，但我知道一定不会输的难看。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 旅行 </tag>
            
            <tag> 回忆 </tag>
            
            <tag> 雅思 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新机常用软件及环境配置清单</title>
      <link href="/article/2239.html"/>
      <url>/article/2239.html</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面的评价"><a href="#写在前面的评价" class="headerlink" title="写在前面的评价"></a>写在前面的评价</h3><p>有些应用的选择需要单独说一下。</p><a id="more"></a><ul><li><strong>网易云音乐</strong>，海外有版权限制，真的是自掘坟墓，本身自己的资源就快被QQ音乐抢光了，还有这限制，9102年都过完了还有这些限制，真该学学QQ音乐啊，不然再多云村钉子户，也分分钟就弃坑了。</li><li><strong>Chrome</strong>，我现在已经彻底是Google用户了，从Map到YouTube到GPlay，我没有理由不选择Chrome作为我的主力浏览器，Firefox已经多年不用了，不晓得体验如何（只在Linux上用用）</li><li><strong>360安全浏览器</strong>，只是想用这个来当IE的替代品，极个别时候还必须得用IE，木的办法。</li><li><strong>Editplus</strong>，这个我要强调，这是我见过的能够打开文本文件最大的编辑器了，比如50M、100M的文本，用记事本和NPP等会直接卡死的。</li><li><strong>AIDA64</strong>，强大的硬件监控、查看、测试软件，其实前面说的全都能干，但我一般查看信息，里面的传感器部分很好，可以捕获全部的硬件传感器信息。</li><li><strong>HWIDGEN脚本</strong>，Win10专业版现在找激活秘钥太难了，基本不可用，而KMS类似的激活又有时效且不稳定。基于此网上有永久激活的方法，但亲测并不适用每个人，而这个脚本可以一键傻瓜式激活（虽然也是命令行运行），效果和使用秘钥激活一样。</li><li><strong>Anydesk</strong>，这个要说，非常轻便，真的是随下随用，安不安装都可以用，显示速度也不错，重要的是免配置，这个非常棒，就通过一个数字码连接，而且配置非常容易，适用全部的操作系统，手机、Linux、Windows全部可以互通。RealVNC可以实现相同的功效，但只是VNC分为Server和Viewer，而且都需要安装，方便性稍差一些。</li><li><strong>PUBG_Lite</strong>，我第一次用我的Win10平板玩就惊到了，平板的配置 core m 真的很差了，但我玩PUBG_Lite依旧可以畅玩，操作和视觉上和正常版差一些，但差归差该有的一点不少，只是画质稍差，当然可以调高，而且操作非常流畅，Lite真的降低了PC吃鸡的要求，看好这个版本。</li></ul><h3 id="日常使用"><a href="#日常使用" class="headerlink" title="日常使用"></a>日常使用</h3><table><thead><tr><th>No.</th><th>软件名称</th><th align="left">说明</th></tr></thead><tbody><tr><td>1</td><td>搜狗拼音</td><td align="left">基础</td></tr><tr><td>2</td><td>WinRAR</td><td align="left">最好用，不喜欢7z</td></tr><tr><td>3</td><td>Chrome</td><td align="left">浏览器主力</td></tr><tr><td>4</td><td>Office365</td><td align="left">学校给的账号，白嫖</td></tr><tr><td>5</td><td>HWIDGEN脚本</td><td align="left">永久激活Win10专业版</td></tr><tr><td>6</td><td>360安全浏览器</td><td align="left">用他的IE内核</td></tr><tr><td>7</td><td>Notepad++</td><td align="left">文档编辑主力</td></tr><tr><td>8</td><td>Editplus</td><td align="left">亲测适用于50M以上文件</td></tr><tr><td>9</td><td>迅捷PDF编辑器</td><td align="left">强大，当阅读器也不错</td></tr><tr><td>10</td><td>迅捷PDF转换器</td><td align="left">各种转换一步到位</td></tr><tr><td>11</td><td>Cmd_Markdown</td><td align="left">写作工具，最好无之一</td></tr><tr><td>12</td><td>360驱动大师</td><td align="left">主要更新下声卡驱动</td></tr><tr><td>13</td><td>360安全卫士</td><td align="left">只是想用加速球</td></tr><tr><td>14</td><td>TrafficMonitor</td><td align="left">替代360加速球</td></tr><tr><td>15</td><td>Adobe Flash Player</td><td align="left">Flash，谷歌已弃用</td></tr><tr><td>16</td><td>Potplayer</td><td align="left">4K播放环境-播放器</td></tr><tr><td>17</td><td>madVR</td><td align="left">4K播放环境-渲染</td></tr><tr><td>18</td><td>LAVFilters</td><td align="left">4K播放环境-解码</td></tr><tr><td>19</td><td>微信</td><td align="left">社交</td></tr><tr><td>20</td><td>QQ</td><td align="left">社交</td></tr><tr><td>21</td><td>Telegram</td><td align="left">社交</td></tr><tr><td>22</td><td>QQ音乐</td><td align="left">网易云海外体验极为差劲</td></tr><tr><td>23</td><td>CPU-Z</td><td align="left">简单的看下CPU和内存</td></tr><tr><td>24</td><td>AIDA64</td><td align="left">查看硬件信息必备</td></tr><tr><td>25</td><td>CrystalDiskMark</td><td align="left">硬盘测速，注意版本</td></tr></tbody></table><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="编码使用"><a href="#编码使用" class="headerlink" title="编码使用"></a>编码使用</h3><table><thead><tr><th>No.</th><th>软件名称</th><th align="left">说明</th></tr></thead><tbody><tr><td>1</td><td>Git_for_Windows</td><td align="left">基础环境，很重要</td></tr><tr><td>2</td><td>Java</td><td align="left">基础环境</td></tr><tr><td>3</td><td>node</td><td align="left">基础环境</td></tr><tr><td>4</td><td>python3</td><td align="left">基础环境</td></tr><tr><td>5</td><td>IntelliJ_IDEA_2019</td><td align="left">弃用eclipse了</td></tr><tr><td>6</td><td>VSCode</td><td align="left">写Python用这个了</td></tr><tr><td>7</td><td>VS2019</td><td align="left">可能C++会用到</td></tr><tr><td>8</td><td>Anydesk</td><td align="left">远程桌面的首选</td></tr><tr><td>9</td><td>Real_VNC</td><td align="left">全OS远程桌面</td></tr><tr><td>10</td><td>SecureCRT</td><td align="left">Linux远程SSH</td></tr><tr><td>11</td><td>WinSCP</td><td align="left">Linux传输文件</td></tr></tbody></table><h3 id="娱乐使用"><a href="#娱乐使用" class="headerlink" title="娱乐使用"></a>娱乐使用</h3><table><thead><tr><th>No.</th><th>软件名称</th><th align="left">说明</th></tr></thead><tbody><tr><td>1</td><td>Nvidia_Experience</td><td align="left">随时更新GameReady驱动</td></tr><tr><td>2</td><td>Steam</td><td align="left">必备</td></tr><tr><td>3</td><td>WeGame</td><td align="left">想玩一下国服，但幻想破灭了</td></tr><tr><td>4</td><td>LOL_EU</td><td align="left">玩玩欧服还是可以的</td></tr><tr><td>5</td><td>RedAlert2战网</td><td align="left">资深红警2菜鸡必备软件</td></tr><tr><td>6</td><td>PUBG_Lite</td><td align="left">正常版本太大了</td></tr></tbody></table><h3 id="该页面持续更新中…"><a href="#该页面持续更新中…" class="headerlink" title="该页面持续更新中…"></a>该页面持续更新中…</h3>]]></content>
      
      
      <categories>
          
          <category> Mini-ITX小钢炮 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 装机 </tag>
            
            <tag> 软件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>黑五剁手纪实 — ITX装机录</title>
      <link href="/article/772.html"/>
      <url>/article/772.html</url>
      
        <content type="html"><![CDATA[<p>我的上一任主力设备GE62-490已达三年的高龄，纵使宝刀未老，但也因我饱受松鼠症困扰而早早就将其存储空间挥霍一空，加之自己的新方向简直就是在显卡上跳舞，那原先的GTX960M可真的是力不从心了。于是乎，在寂寞的闲暇时间里，更新我的生产力工具就像个小雪球一样在我的脑海里越滚越大，终于滚到了黑色星期五，11月29日，就是你了！</p><a id="more"></a><fancybox><img src="http://tva3.sinaimg.cn/large/006YHUzUgy1g9ze431xxdj31wj0uyx6p.jpg"></fancybox><h3 id="德亚再见"><a href="#德亚再见" class="headerlink" title="德亚再见"></a><strong>德亚再见</strong></h3><p>由于地域关系，为了免除运费和关税，只能用德亚了，怀揣着一腔热血的我，高兴而来失望而归，和电脑相关的产品，真的是硬通货啊，那价格基本就没低多少，我机智的用谷歌搜了一下，果然，本地商家的价格要良心太多了，运费基本没有而且全部支持收件网点暂存！所以，拜拜了亚马逊，本地商家搞起。</p><fancybox><img src="http://tvax1.sinaimg.cn/large/006YHUzUgy1g9ze6jojzej30qt09cdkr.jpg"></fancybox><fancybox><img src="http://tva1.sinaimg.cn/large/006YHUzUgy1g9ze6l7u2ij30vi09mdlz.jpg"></fancybox><p>Google的产品搜索，虽然是个半广告的功能，但其实非常不错，商家的价格一目了然，直接就能知道谁家卖的最便宜，最后，显而易见 <a href="https://megekko.nl" target="_blank" rel="external nofollow noopener noreferrer">Megekko</a> 的价格是最有竞争力的（最便宜的），类似的网站还有 <a href="https://azerty.nl/" target="_blank" rel="external nofollow noopener noreferrer">Azerty</a>，而且这两家网站其实后面的送货速度都非常快，如果仓库有货的话，荷兰境内基本三天就可以到货，且支持通过 <strong>PostNL</strong> 来暂存，这对于租房子的外来人员来说太好了，不用在家等快递。</p><h3 id="装机配置选择"><a href="#装机配置选择" class="headerlink" title="装机配置选择"></a><strong>装机配置选择</strong></h3><h4 id="攒机环境"><a href="#攒机环境" class="headerlink" title="攒机环境"></a><strong>攒机环境</strong></h4><p>攒机，或者装机，其实最开始本就源自国外，是国外发烧友自己组装自己电脑的一种方式，但现在随着各大电脑品牌商的溢价，攒机也成了获得高性价比电脑的一种方式，在国内尤为盛行，比如在国内想要买台高性能的台式，基本上没人推荐购买整机了，性价比太低。其实后面看起来，国内外的攒机最大的区别就是 <strong>散热、机箱和电源</strong>，在主要配件上国内价格并没有明显优势，但在配件上则是天差地别，尤其是机箱方面，国内什么样的机箱都能买到还便宜，但在国外可选择的只有固定厂家的定制型号，基本是YouTube上攒机能看到的那些机箱，价格自然也非常高，虽然质量好，但着实没什么性价比，但这也没办法。</p><h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a><strong>需求</strong></h4><p>这是最终要的预备工作，因为攒机的配件高度相关，不确定好买来不适配那就抓瞎了，确定自己的需求可以按以下顺序完成（包括包含的类别）：</p><ol><li><strong>机箱（Case）：ATX、ITX、Mini-ITX</strong> 最高优先级，取决于你理想的电脑的样子，是大是小是方是圆。现在越来越多的人对台式机也追求便携，我也不例外，所以选择了 Mini-ITX 的机箱，最终主机的大小可以轻松的塞进15寸的笔记本电脑双肩包。</li><li><strong>核心（CPU）：主要是针脚</strong> 这里和主板强相关，Ryzen 和 Core 的CPU的安装方式并不相同，即选择其中一种，就必须要选择对应的主板型号，例如 R5 3600X 对应 B450，我的 i5 9400F 对应 B360。这里我为了后续的更新空间和更强的超频能力使用了 Z390 主板，当然也是可以的。</li><li><strong>主板（Motherboard）：ATX、ITX、Mini-ITX</strong> 主板跟随机箱的选择，比如我只能选择 Mini-ITX 主板，这里需要注意的是， <strong>ITX的机箱、主板、电源都要比ATX的更贵一些</strong>。</li><li><strong>电源（Power）：500W、600W</strong> 电源也有大小！ITX机箱强烈推荐买 SFX 的电源，且强烈推荐买大点功率的电源，以备硬件使用。以海盗船（Corsair）为例，按我的选择，我只能选择 SF600W，而不能买 CX600W 等型号。</li><li><strong>显卡（Graphics card）：全长、半长、单双三风扇</strong> 显卡的型号选择比较多样，视自己选择的机箱型号来看，切莫买来装不进去，我这款机箱支持全长显卡，也就是说支持三风扇的长卡，当然也可以选择半长的专为ITX设计的显卡，但其实那种卡有性能损失，所以最终我选择了比较大众的双风扇显卡。</li><li><strong>内存（Memory）：主要是频率</strong> 内存选择比较自由，因为就算买错了高频，其实使用中还是会自动降频，并不影响使用。但为了不浪费内存性能，这里务必要搞清楚<strong>主板和CPU支持的最高频率</strong>，搞清这个问题并不容易，以我的 i5 9400F 为例，<strong>其配合 Z390 这种主板，其CPU睿频可以稳定在 3.9Ghz，就连内存频率可以轻松稳定在 3200MHZ，可见下图。</strong><fancybox><img src="https://tva3.sinaimg.cn/large/006YHUzUgy1g9zeqapgfwj32tc1aonpd.jpg"></fancybox></li><li><strong>散热风扇（Cooler）：主要是尺寸</strong> 主要是针对CPU的散热，这里由于使用了ITX机箱，所以水冷就不再选择内了，而且由于使用的 9400F，发热量并不十分大，后来的使用过程中日常也就 30-40℃，所以这里使用的是 Noctua 的 NH-L9i，特别注意其散热方式，是立着的还是扁着的，安装完的厚度是多少，这个都要确认清楚，不然装上盖不上机箱盖就完蛋了。</li><li><strong>硬盘（SSD）：注意接口</strong> 目前的主板，一般板载一个 PCIe 的SSD插槽，可以插NVMe的固态，这种固态的速度极快，但价格高，所以一般买小容量做启动盘。</li><li><strong>可选（额外的风扇）：注意尺寸</strong> 这是机箱风扇，如果机箱空闲大，可以自己加装风扇，增强机箱内部的散热能力，机箱的风扇很简单，就是个叶片加电源线，主要有厚度和直径这两个尺寸，还要注意主板上预留的风扇电源插槽的数量，比如我的包括CPU散热在内只有三个插槽，加上原一个风扇，所以我只能再加装一个风扇。</li><li><strong>可选（额外的硬盘）：注意尺寸</strong> 有了系统盘，一般外加单独的硬盘做存储盘。视机箱情况而定，受限于机箱，我只能加装2.5寸的薄的硬盘，最后选择了西数的蓝盘固态做存储盘。</li></ol><h4 id="具体落实"><a href="#具体落实" class="headerlink" title="具体落实"></a><strong>具体落实</strong></h4><p>以上之谈了大致的类型选择，并没涉及具体的型号，所以下面开始列举我最终选择的配件型号，只给型号不给价格。</p><h5 id="机箱（Kolink-Rocket-Mini-ITX-Minitowermodel）"><a href="#机箱（Kolink-Rocket-Mini-ITX-Minitowermodel）" class="headerlink" title="机箱（Kolink Rocket Mini-ITX Minitowermodel）"></a><strong>机箱（Kolink Rocket Mini-ITX Minitowermodel）</strong></h5><p>这是在海外能找到的为数不多的 Mini-ITX 机箱了，其他的像 DAN 等机箱根本就是缺货状态，买国内的酷鱼什么的寄过来又太慢了（一个月左右），所以这款机箱是我能够获取的最合适的一款了，其特性有以下几点：</p><ul><li>支持全长显卡（竖着）</li><li>自带一个机箱风扇</li><li>体积9升，长宽比大（扁平）</li><li>支持两块2.5寸薄硬盘</li><li>前置电源键+两口USB</li></ul><fancybox><img src="http://tvax2.sinaimg.cn/large/006YHUzUgy1g9ze6s97nej31jz0vqkjl.jpg"></fancybox><h5 id="CPU（Intel-Core-i5-9400F-processor）"><a href="#CPU（Intel-Core-i5-9400F-processor）" class="headerlink" title="CPU（Intel Core i5 9400F processor）"></a><strong>CPU（Intel Core i5 9400F processor）</strong></h5><p>目前阶段，如果选英特尔，那这款性价比没的说，是非常良心的CPU了，目前可以稳定超在3.9GHz，真的很稳。所以这里的问题是到底选酷睿还是锐龙，这里根据自己需要把，没法选，不过网上看的一句话是娱乐选酷睿，剪视频选锐龙，毕竟多核玩的还是溜呀。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h5 id="主板（Gigabyte-Z390-I-AORUS-PRO-WIFI-moederbord-socket-1151）"><a href="#主板（Gigabyte-Z390-I-AORUS-PRO-WIFI-moederbord-socket-1151）" class="headerlink" title="主板（Gigabyte Z390 I AORUS PRO WIFI moederbord socket 1151）"></a><strong>主板（Gigabyte Z390 I AORUS PRO WIFI moederbord socket 1151）</strong></h5><p>前面说了，Z390+9400F是大学生配初中生，主板过于高端，但事实是这样搭配也给了9400F充足的性能发挥空间，连原本其（9400F）支持的DDR4-2666MHz的内存频率都可以轻松拉到 3200MHz，而且还可以以后上8700K 等等这些超频高端U。其特点是：</p><ul><li>板载WIFI，性能非常棒，自带延长天线基座</li><li>板载+扩展的 USB3.1 gen1 口有 6 个（蓝色）</li><li>板载 USB3.1 gen2 口有 1 个（红色）</li><li>板载 雷电3 接口 1 个</li><li>集成音频 5 个 + SPDIF口 1 个</li><li>板载风扇电源口 3 个</li><li>视频输出口两个（给集显的）</li></ul><fancybox><img src="http://tva1.sinaimg.cn/large/006YHUzUgy1g9ze6t6wb1j31cu0g74qp.jpg"></fancybox><h5 id="电源（Corsair-SF600-600W-SFX-PSU-PC-voeding）"><a href="#电源（Corsair-SF600-600W-SFX-PSU-PC-voeding）" class="headerlink" title="电源（Corsair SF600 600W SFX PSU / PC voeding）"></a><strong>电源（Corsair SF600 600W SFX PSU / PC voeding）</strong></h5><p>同样没什么品牌可选，就用最常见的海盗船了，选择600W 是因为需要充足的电力供应给主板，还有450W 等功率的电源，但这样在使用中或者后期扩展时可能会有电力供应不足的问题。</p><h5 id="显卡（KFA2-GeForce-RTX-2060-Super-1-Click-OC-Videokaart）"><a href="#显卡（KFA2-GeForce-RTX-2060-Super-1-Click-OC-Videokaart）" class="headerlink" title="显卡（KFA2 GeForce RTX 2060 Super (1-Click OC) Videokaart）"></a><strong>显卡（KFA2 GeForce RTX 2060 Super (1-Click OC) Videokaart）</strong></h5><p>这里最终选用了KFA2的 RTX 2060Super，国内代号影驰的骁将，影驰还有大奖，应该对应该显卡的 GALAXY 版本，有更好看的外形和风扇灯效。这一版叫一键超频版，其实跟自动超频差不多，也就是说性能还是那些性能，但控制器可能稍微简单一点，当然价格也就更便宜，综合考量还是这一版（骁将）性价比更高。至于为什么选择 2060Super，原因主要有以下几点：</p><ul><li>体验“入门级光追”嘛，实际买RTX显卡也赠送了《使命召唤:现代战争》</li><li>2060S 性能真的出众，比2060要好不少，改显存 6G 为 8G，<a href="https://www.bilibili.com/read/cv2990142/" target="_blank" rel="external nofollow noopener noreferrer">性能只会非常略微低于RTX 2070</a></li><li>和实验室的电脑（RTX 2060）保持基本一致，后续会跑些 CUDA 代码。</li><li>对比 2060 砍掉光追的 1660ti，在其砍掉了光追也附带损失了一些性能，且 1660ti 也不便宜。</li></ul><fancybox><img src="http://tvax2.sinaimg.cn/large/006YHUzUgy1g9ze6uq34ej31ej0htaoc.jpg"></fancybox><h5 id="内存（Corsair-DDR4-Vengeance-LPX-2x8GB-3200-White-Geheugenmodule）"><a href="#内存（Corsair-DDR4-Vengeance-LPX-2x8GB-3200-White-Geheugenmodule）" class="headerlink" title="内存（Corsair DDR4 Vengeance LPX 2x8GB 3200 White Geheugenmodule）"></a><strong>内存（Corsair DDR4 Vengeance LPX 2x8GB 3200 White Geheugenmodule）</strong></h5><p>前面也说过了，虽然 9400F 标配的是 DDR4-2666MHz 但实际在 Z390 主板上的表现完全可以稳定在 3200MHz，不过要首先在 BIOS 中设置一下才能超内存频率。</p><h5 id="CPU散热（Noctua-NH-L9i）"><a href="#CPU散热（Noctua-NH-L9i）" class="headerlink" title="CPU散热（Noctua NH-L9i）"></a><strong>CPU散热（Noctua NH-L9i）</strong></h5><p>选这个散热器也是实属无奈，其本身非常薄，是压合式的散热器，不过对于 9400F 来说实际完全够了，在使用中风扇的表现还是不错的，基本听不到声音，在安装完后其实并没有到达最大的可容纳高度，所以感觉以后可以买再厚一点的散热器来压火（如果上了大U的话）。</p><fancybox><img src="http://tvax3.sinaimg.cn/large/006YHUzUgy1g9ze6x8og9j31710hmkji.jpg"></fancybox><h5 id="启动盘（Samsung-970-EVO-Plus-500GB-Solid-state-drive）"><a href="#启动盘（Samsung-970-EVO-Plus-500GB-Solid-state-drive）" class="headerlink" title="启动盘（Samsung 970 EVO Plus 500GB - Solid state drive）"></a><strong>启动盘（Samsung 970 EVO Plus 500GB - Solid state drive）</strong></h5><p>这里没什么好讲的，用什么都行，但还是、、国外能选的太少了，怕翻车只能选大牌子，然后看着 Plus 和原版又没差多少，所以果断上 Plus 了。</p><h5 id="机箱风扇（Arctic-F8-PWM）"><a href="#机箱风扇（Arctic-F8-PWM）" class="headerlink" title="机箱风扇（Arctic F8 PWM）"></a><strong>机箱风扇（Arctic F8 PWM）</strong></h5><p>这个风扇的安装位置并不是机箱预制的，我只是单纯的希望增加机箱内的对流，虽然在不盖盖子的时候看上去没什么用，但实际如果两面的机箱盖装上，那么这个风扇的作用就体现出来了，考虑到吸气不如吹气，所以这个风扇其实是内吹的，这样在装上机箱盖后的比较封闭的机体内，有个强劲的冷气输入源可以更好的加速内部的空气对流，增加散热效果（我的理解）。此外，其对吹的正是电源的插线部分，估计也能带走一些电源散发的热量。</p><fancybox><img src="http://tvax1.sinaimg.cn/large/006YHUzUgy1g9ze7051s7j31a20is7wh.jpg"></fancybox><h5 id="存储盘（WD-Blue-2TB-SSD）"><a href="#存储盘（WD-Blue-2TB-SSD）" class="headerlink" title="存储盘（WD Blue 2TB SSD）"></a><strong>存储盘（WD Blue 2TB SSD）</strong></h5><p>非常巧妙的硬盘位设计，正好在外壳和内胆的缝隙中，所以空间很薄了，我很怀疑标准的 2.5寸HDD 能不能放进去，我这里很薄的 SSD 刚刚好能塞进去。使用的电源线是电源自带的 一拖四 的线，所以理论还能接三块，但实际空间还能塞一块。</p><fancybox><img src="http://tvax3.sinaimg.cn/large/006YHUzUgy1g9ze71jv7pj31e60iv1kx.jpg"></fancybox><h3 id="安装过程及最终结果"><a href="#安装过程及最终结果" class="headerlink" title="安装过程及最终结果"></a><strong>安装过程及最终结果</strong></h3><p>安装过程略，基本无难度，只是在最后接电源线的时候要好好理一下，以一个最梳顺的方式放置线材。其次是显卡延长线的整理，这个机箱需要把显卡延长线压在主板下面，所以需要提前压一下延长线。</p><p>结果如下图所示，上几张图（下图中显卡那一面还没加小风扇）。</p><fancybox><img src="http://tvax4.sinaimg.cn/large/006YHUzUgy1g9ze73qkq2j31dx0ii7wh.jpg"></fancybox><p>这是实际的尺寸大小，跟 A4 纸比较很明显，想携带到处走也不是不可能。</p><fancybox><img src="http://tvax1.sinaimg.cn/large/006YHUzUgy1g9ze75n8ckj31in0qd1kx.jpg"></fancybox><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h3><p>另一方面，整机的噪音非常小，如果显卡的风扇不转，那几乎听不到声音，真的听不到声音，不过一般情况下显卡会有一个风扇在转，所以噪音还是有一些，但对比我右边的笔记本，噪音我认为更小，是一种更低沉的嗡嗡声，而不是笔电的风扇呼呼声。</p><p>整体散热上，加显卡的两个风扇，目前全机箱内共有 6 个风扇，分别是：</p><ul><li>大颗的CPU散热风扇 × 1</li><li>显卡卡载风扇 × 2</li><li>机箱上下方向固定风扇 × 1</li><li>电源内置风扇 × 1</li><li>机箱左右方向风扇 × 1</li></ul><p>即，显卡一侧有 3 风扇（显卡的+自己后加的），CPU一侧有 2 风扇（CPU的+电源的），底板上固定 1 个垂直方向的风扇。日常使用中仅有CPU风扇、底板风扇、后加风扇和单个显卡风扇常转，所以噪音并不大。同时如果需要散热时，这些风扇全开应该会带来非常不错的散热效果。实际使用过程中CPU温度稳定在40℃左右，后面会专门对其进行测试。</p><p>目前，已经使用我的新设备几天了，感觉非常良好，开始的时候还担心自己第一次组装电脑会出什么差错，实际过程中也确实出了些问题（在拆卸机箱时一定要用大螺丝刀，小螺丝刀没劲还容易把螺纹磨掉！），不过后面基本就比较顺利了，其实这不仅是我第一次自己动手装电脑，也是我第一次使用“大卡”（显卡），使用体验确实和笔记本的不一样！英雄联盟高画质轻松两百FPS，非常舒爽。后面还装了Photoshop等软件，等有时间写一下软件的使用体验，侧面来对整个机器的性能做个评价（包括NVMe的启动盘和西数2T固态的性能）。</p><fancybox><img src="http://tva1.sinaimg.cn/large/006YHUzUgy1g9ze78pa7mj31a30u1hdt.jpg"></fancybox><h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a><strong>备注</strong></h3><p>作业部落在国外基本不可用了，编辑编辑文字还可以，但上传图片体验太差了，上传十次有一次成功就算万幸了，所以从现在起要换图床了，从 <a href="https://zhuanlan.zhihu.com/p/58863378" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 的推荐看还是 <strong>sm.ms</strong> 是最好的，那就用这个啦，以后的图片都会存在上面的，只是他不支持从剪切板上传，那只能转存一下再上传，有点麻烦了。</p><p>收回以上说的话，sm.ms 也开始拜金了，我上传了几张图片之后就不让上传了，总是显示上传超过数量限制，加了电报群问了下，说是冲会员就好了，我冲个鬼，再见吧。寻寻觅觅，终于又找到了微博图床，然后还找到了 <a href="https://chrome.google.com/webstore/detail/%E6%96%B0%E6%B5%AA%E5%BE%AE%E5%8D%9A%E5%9B%BE%E5%BA%8A/fdfdnfpdplfbbnemmmoklbfjbhecpnhf/reviews" target="_blank" rel="external nofollow noopener noreferrer">微博图床的Chrome插件</a>，使用了一下效果非常好，即便海外访问也完全没问题。</p><p>自此，博客内的图片会全部换成微博图床，特此说明。</p>]]></content>
      
      
      <categories>
          
          <category> Mini-ITX小钢炮 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 荷兰 </tag>
            
            <tag> 注意事项 </tag>
            
            <tag> 装机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初到荷兰的待办事项</title>
      <link href="/article/979e.html"/>
      <url>/article/979e.html</url>
      
        <content type="html"><![CDATA[<p>本文总结下近期在荷兰生活遇到的各种坑，以及在荷兰需要的方方面面，后续会持续更新。下文从入境荷兰之后开始介绍。此内容系回忆内容，归属于RMBATS列表。</p><a id="more"></a><h3 id="在国内要办完的事"><a href="#在国内要办完的事" class="headerlink" title="在国内要办完的事"></a><strong>在国内要办完的事</strong></h3><p>简单提一下，主要有以下几点：</p><ul><li><strong>开通国际漫游：</strong>这个一定要做，而且要确认已开通了在出境，不然你的所有验证码都会收不到，对于有登陆验证的页面或应用，如果不开通国际漫游，那基本上是别想登进去了。而且银行转账一般也要手机验证，工行的有工行信使还可以，但中行的没有，所以如果没有漫游，在国外想用自己的银行卡转账也是不行的。</li><li><strong>办理一张国内的VISA或万事达卡：</strong>如果是学生，推荐办理主副卡，家长是主卡，自己拿副卡，这样额度高而且还安全，同时主卡可以为副卡还钱，没有后顾之忧。</li><li><strong>确认签证信息：</strong>要注意核准荷兰移民规划局（IND）给你的回执信息，看清你的逗留日期，荷兰的人办事马大哈，给你写错了很正常（比如我就-），前面没发现后面再改的话，需要耗费非常长（可能几个月）的时间。</li><li><strong>搞定租房：</strong>国内租国外的房，两眼一抹黑，尽量按照以下几点租，应该是没问题的：<ul><li>优先租中国人房东的</li><li>优先租带独卫的Studio的</li><li>优先租距离学校近的</li><li>一定要有正规的租房合同</li><li>优先租可提供注册地址的</li><li>优先租短租（几个月最好），来了你会发现其实房源不少，所以为了不因为自己的合同未到期而错过好房源，尽量第一次租的时间短一点，来了再找更好的地方。</li></ul></li></ul><h3 id="入境后的待办事项"><a href="#入境后的待办事项" class="headerlink" title="入境后的待办事项"></a><strong>入境后的待办事项</strong></h3><p>以下事项基本都需要提前预约，有的是学校已经做了预约，有的需要自己预约。</p><h4 id="电话卡"><a href="#电话卡" class="headerlink" title="电话卡"></a><strong>电话卡</strong></h4><p>这个真的是下飞机的第一件事，荷兰的手机运营商我也不知道好坏，但目前来看，认识的人还是用 Lebara 的多。其也分匿名卡和实名卡，匿名卡你可以在大超市或者饭店见到，就跟广告一样，匿名卡开卡后在手机APP上可以充钱，没话费了会自动扣除。<br>注意：千万要少用流量，荷兰的流量非常贵，可能 2GB 就要上百人民币，所以尽量不要在移动流量下看视频等。关于流量，一个解决方案是使用天际通服务，比本地运营商的价格要便宜，但仍然比国内贵太多，可能一天要十块多人民币。</p><h4 id="学校的登记"><a href="#学校的登记" class="headerlink" title="学校的登记"></a><strong>学校的登记</strong></h4><p>这部分一般由学校的秘书完成，可能会单独约谈一次，不需要自己做什么，后续会涉及校园卡、门禁卡的发放。最主要目的就是确认你人到学校了。</p><h4 id="个人项目的注册登记"><a href="#个人项目的注册登记" class="headerlink" title="个人项目的注册登记"></a><strong>个人项目的注册登记</strong></h4><p>这部分是指完善学生在学校的个人信息，一般会很详细，并且和博士或硕士的毕业设计联系在一起。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="大市政厅领居留卡"><a href="#大市政厅领居留卡" class="headerlink" title="大市政厅领居留卡"></a><strong>大市政厅领居留卡</strong></h4><p>大市政厅是指所在辖区的市中心的市政厅，荷兰的划分和我们的省市县三级差不多，比如我住在乌特勒支省的宰斯特市，那么我的居留卡应该在乌特勒支的市政厅领取，而地址的注册应该在宰斯特市正厅完成。</p><h4 id="小市政厅注册"><a href="#小市政厅注册" class="headerlink" title="小市政厅注册"></a><strong>小市政厅注册</strong></h4><p>这部分需要提供自己的“地址”，也就是俗称的“报地址”，所以在租房时要寻问清楚可不可以报地址。在居住地当地的市政厅注册后，会有个漫长的等待过程，大概三周后会收到一封纸质信，里面有自己的 BSN 码，这个码非常重要，办保险和银行卡都需要。</p><h4 id="购买保险"><a href="#购买保险" class="headerlink" title="购买保险"></a><strong>购买保险</strong></h4><p>如果是学生，请不要购买类似 AON 的学生保险，该类保险虽然便宜，但其不属于荷兰的国民健康保险，因此不能申请荷兰的保险补助（资本主义国家的福利），把补助算进去实际保险的花费会很少，但 AON 每年六百多欧元是实打实的，所以不建议购买。注意：国民健康保险需要BSN码才能办理。</p><h4 id="办理银行卡"><a href="#办理银行卡" class="headerlink" title="办理银行卡"></a><strong>办理银行卡</strong></h4><p>如果是学生，一定要办理学生卡，因为非学生卡每个月都会收点钱，每年大概十几欧，也就是非学生卡一年要交一百多块人民币的管理费。注意学生卡的办理也需要提供 BSN 码，然后需要携带相关的证明材料。最后的卡仍旧以纸质信的方式邮寄给你。</p><h4 id="公交打折卡"><a href="#公交打折卡" class="headerlink" title="公交打折卡"></a><strong>公交打折卡</strong></h4><p>如果是学生，务必办理黑黄色的 OV打折卡，因为在荷兰坐公交非常昂贵，如果付现金（刷银行卡）单程每次要将近 3 欧元（不管远近）。办理打折卡同样需要 BSN 码。如果办不了打折卡，可以办理蓝色的 OV匿名卡，单程每次可能 1.5 欧元，打折卡的话会更便宜一些。如果每天公交车通勤，那必须要办一张打折卡。</p><h4 id="NS火车票"><a href="#NS火车票" class="headerlink" title="NS火车票"></a><strong>NS火车票</strong></h4><p>如果需要做城际火车，例如从乌特勒支去埃因霍芬，那么务必购买往返火车票，或者“天票”，如果直接用公交卡刷，费用会非常贵，往返火车票一般会便宜不少，然后天票一般是固定价格（15欧左右）单日往返随意乘坐。可见，天票是最划算的，不过天票不是想买就买的到的，其只在某些超市以特定的时间作为促销进行发售，一般有一段有效期，有效期内可以凭天票兑换的二维码，在某一天任意出入火车站，也就是说凭该票去哪都行（往返）。</p><h4 id="自行车"><a href="#自行车" class="headerlink" title="自行车"></a><strong>自行车</strong></h4><p>在自行车王国购买一辆自行车是在正常不过的了，可不要以为自行车王国自行车就便宜，反而，自行车在荷兰是相当的贵，车行里卖的车普普通通就上万人民币（2000欧），所以如果买新车，那是买不起啊，靠谱的二手车就完全可以。一百欧左右的二手车一般就非常好骑，Facebook的 Marketplace 是个很好的二手自行车交易平台。<br>注意，买车时一定要看看轮胎的好坏，自行车最容易坏的就是轮胎，就算是漏个气，在荷兰修一次也得10欧网上了，所以如果买个破车，可能修几次还不如再买一辆。<br>注：听说乌大有新生一千欧的自行车购买津贴，还未求证。</p><h4 id="超级市场"><a href="#超级市场" class="headerlink" title="超级市场"></a><strong>超级市场</strong></h4><p><strong>AH（Albert Heijn）</strong>，分布非常广泛，史基浦机场里就有的超市，购买“天票”的地方，不支持VISA卡。<br><img src="//tva2.sinaimg.cn/large/006YHUzUgy1ga9q5b0vw1j32tc1aonpd.jpg" alt="IMG_20191225_172036"></p><p><strong>LiDL</strong>，德国超市，价格明显低廉，吃的用的都有，比较杂。<br><img src="//tvax2.sinaimg.cn/large/006YHUzUgy1ga9q5glh0kj32tc1aoe81.jpg" alt="IMG_20191225_165743"></p><p><strong>Action</strong>，杂货超市，吃的和水果很少，可以买鼠标、键盘、晾衣架等等东西。<br><img src="//tva3.sinaimg.cn/large/006YHUzUgy1ga9q5f7iquj32tc1ao7wh.jpg" alt="IMG_20191225_165912"></p><p><strong>Jumbo</strong>，地方性的超市，只分布在荷兰中部。<br><img src="//tvax1.sinaimg.cn/large/006YHUzUgy1ga9q5e0s2vj32tc1aou0x.jpg" alt="IMG_20191225_170312"></p><p><strong>Kruidvat</strong>，专营日用品和药品，经常打折捆绑销售。<br><img src="//tva1.sinaimg.cn/large/006YHUzUgy1gaj5t3xv3ij31ad0jsnpe.jpg" alt="image"></p><p><strong>東方行</strong>，地道的中超，可以买到榨菜、泡面、老干妈等等国货，支持支付宝付款。</p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h3><p>一般而言，从注册到收到BSN码要很长时间，且注册可能就是入境后的一段时间之后，所以BSN码可能在入境后的一个多月后才能收到，在这一个多月的空窗期，就没法办理 OV打折卡、银行学生卡、买保险。所以，开头的国内信用卡就有用处了，基本上用（工行）信用卡可以在绝大多数超市（AH不行）、全部公交车、部分餐厅使用。</p><p>补充一点，对于电子产品控，荷兰的本地商家 MediaMarket 并不便宜，即使在黑五也是如此。bol.com 更是奇贵无比。这里推荐从本地的专营电子产品的网上电商平台购买（MediaMarket有线下店，除外），Megekko.nl 和 Azerty.nl 是我用过的两个不错的网商，我从上面买到了租装机的全部零件，价格基本全网最低了（得益于Google的商家产品检索），物流三至四天，支持PostNL寄存，感兴趣的可以尝试一下。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 荷兰 </tag>
            
            <tag> 注意事项 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSC申请结束到派出前的事项</title>
      <link href="/article/2275.html"/>
      <url>/article/2275.html</url>
      
        <content type="html"><![CDATA[<p>最新版本已更新至知乎<a href="https://zhuanlan.zhihu.com/p/149085994" target="_blank" rel="external nofollow noopener noreferrer">专栏文章</a>。<br>对于CSC的申请来说，得到结果后到约定派出的时间（一般是九月份）大约还有两三个月左右，虽然看起来时间很长，但实际上，有些时间节点如果不做完该做的事，就会严重影响后续的进度，下面就以我的经验（有些记不清楚了）说一下申请成功之后需要做的一些事项，顺便详细解释下关于荷兰签证<strong>（MVV，其他国家的不知道！）</strong>的申请流程。</p><a id="more"></a><p>按时间先后对各种事项进行排列（可能有遗漏），着重注意<strong>超链接网页文本</strong>，其中包含了更为详尽的内容。</p><h3 id="行前培训"><a href="#行前培训" class="headerlink" title="行前培训"></a><strong>行前培训</strong></h3><p>基本是得到结果几天后，学校就会办，如果不是申报单位的，关注就近学校的类似的活动，会给发些相关的手册，还是比较有用的。</p><p><strong>注意：</strong>行前培训一般会提到“留服代办签证”的内容，你可以让留服给你办理签证，但可能和我们个人办理所需要的材料有些许出入，办理的时间有些许的不同，留服办理MVV签证可以详见<a href="https://www.cscse.com.cn/publish/portal0/tab79/info4082.htm" target="_blank" rel="external nofollow noopener noreferrer">这个页面</a>。</p><h3 id="出入境检疫局办理健康证"><a href="#出入境检疫局办理健康证" class="headerlink" title="出入境检疫局办理健康证"></a><strong>出入境检疫局办理健康证</strong></h3><p>这个证有没有用，我目前并没有确切答案（如果让留服代办，是需要这个证的），在我办理签证的流程中，并没有环节需要出示此证件，也不排除某些环节内有联机查询是否符合条件的操作，总之作为一个出国学习一年甚至是四年的学生，一次全面的身体检查还是很有必要的，就把其当做一次查体即可，免费哦！出具《留学资格证书》可以免费检查、拿证。</p><p>关于体检的要求，详情参见<a href="https://www.cxmoe.com/article/b8a6.html">《出入境检疫局办理健康证流程》</a>。</p><h3 id="签证事宜（点击查看-gt-官方指导流程）"><a href="#签证事宜（点击查看-gt-官方指导流程）" class="headerlink" title="签证事宜（点击查看-&gt;官方指导流程）"></a><strong>签证事宜（点击查看-&gt;<a href="https://www.niyuhelan.nl/%25E6%2597%2585%25E6%25B8%25B8%25E4%25B8%258E%25E5%25B1%2585%25E4%25BD%258F/%25E8%258D%25B7%25E5%2585%25B0%25E7%25AD%25BE%25E8%25AF%2581/%25E9%2595%25BF%25E6%259C%259F%25E5%25B1%2585%25E7%2595%2599%25E7%25AD%25BE%25E8%25AF%2581%25EF%25BC%2588mvv%25EF%25BC%2589" target="_blank" rel="external nofollow noopener noreferrer">官方指导流程</a>）</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/img/20200618131359.png" alt></p><p>开始准备的时间：拿到《留学资格证书》之后，一般是出结果后<strong>1-3周左右</strong>寄到。</p><h4 id="3-1-联系外导"><a href="#3-1-联系外导" class="headerlink" title="3.1 联系外导"></a><strong>3.1 联系外导</strong></h4><p>拿到资格书后就联系外方的反签/学校注册事宜（没有护照的抓紧办一个）。之后需要<strong>两个月左右</strong>的时间才能收到回执，收到回执后才能到大使馆完成最后一步（<a href="https://www.cxmoe.com/article/2275.html#3-6-%E4%BA%B2%E8%87%AA%E5%89%8D%E5%BE%80%E8%8D%B7%E5%85%B0%E9%A9%BB%E5%8D%8E%E5%A4%A7%E4%BD%BF%E9%A6%86">步骤3.6</a>，之前的若干步骤可以在这个空档内完成）。可见开始一定不能松懈，抓紧时间联系外导询问这些事。</p><p>一般是提供给导师/秘书：成绩单、毕业证、学位证、留学资格证书的英语扫描件即可。两件事情（递交材料给荷兰移民归化局+学校注册）都用这些材料即可。</p><h4 id="3-2-材料公证"><a href="#3-2-材料公证" class="headerlink" title="3.2 材料公证"></a><strong>3.2 材料公证</strong></h4><p>户籍所在地公证处，公证原始材料 -&gt; 胶装成册的‘公证材料’ （一周内即可完成）</p><p>公证是‘认证’之前的必备步骤，公证的单位找位于自己家附近的公证处即可，我的经验是：小县城里的公证处也完全可以办涉外的公证，只要和他们说你是办留学签证材料的公证，一般他们就明白怎么做（对他们来说你不是第一个也不是最后一个，大胆去交流）。 可能需要的证的材料：出生证明、户口本、学位证、毕业证。我公证了四本，不确定是不是这四项，但公证这些肯定是符合要求。以上公证材料的直接目的就是办理签证，所以详细要求可以仔细阅读签证材料的要求：<strong>汗颜、找不到当时那份详细的材料要求了。。</strong></p><p>公证材料准备好之后，应该是胶装成册，原来可能是四张纸，但现在多了公证文、翻译件、落款页等等，每张纸都变成了一本册子，也就是四本册子。</p><h4 id="3-3-直接去代办的源头"><a href="#3-3-直接去代办的源头" class="headerlink" title="3.3 直接去代办的源头"></a><strong>3.3 直接去代办的源头</strong></h4><p>一般的签证，只需要X国驻华大使馆的认证即可，甚至像越南这种落地签，直接将审核下放到越南入境海关；但对于荷兰的签证，其需要外交部+荷兰驻华大使馆的双认证，比较麻烦。</p><p>人力/快递‘公证材料’给代办机构 -&gt; 代办时间（2-3周） -&gt; 人力/邮寄拿到双认证过的‘公证材料’。下面的机构位于<a href="https://www.google.com/maps/place/Xiaozhang%2BDengxiangguo/%4039.9165065%2C116.4303716%2C53m/data%3D%213m1%211e3%214m13%211m7%213m6%211s0x0%3A0x0%212zMznCsDU0JzU5LjQiTiAxMTbCsDI1JzQ5LjgiRQ%213b1%218m2%213d39.9165%214d116.430496%213m4%211s0x35f1ad2db1f22a6b%3A0x90f2279794ac9187%218m2%213d39.9161761%214d116.4299056" target="_blank" rel="external nofollow noopener noreferrer">(39.9165N, 116.430496E)</a>，市面上的第三方盈利机构的代办，最后都会汇总到这里。（这里需要<strong>2-3周左右</strong>即可，比第三方代办要快一些）</p><p><strong>注意：</strong>外交部认证是不接收个人申请的，这里必须通过“代办机构”，上一步骤的公证的费用可能是100左右/本，代办双认证的费用可能是300-500左右/本。</p><p>具体的代办机构不必须是以下这个，原则上任何北京的、大一点的代办机构都可以，不过非北京的代办不建议使用，因为你材料寄给他们后、他们还要再送到北京\上海…时间慢，如果你想时间安排的紧凑，(又是北方人)那就选择北京的代办。</p><p>具体怎么找到这里的已经忘了</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="3-4-等待第1步的结果"><a href="#3-4-等待第1步的结果" class="headerlink" title="3.4 等待第1步的结果"></a><strong>3.4 等待第1步的结果</strong></h4><p>第一步审核时间可能很久-&gt; 拿到外方发给你的邮件（告知你荷兰移民规化局已经审核完成）</p><h4 id="3-5-预约荷兰大使馆的签证申请时间"><a href="#3-5-预约荷兰大使馆的签证申请时间" class="headerlink" title="3.5 预约荷兰大使馆的签证申请时间"></a><strong>3.5 预约荷兰大使馆的签证申请时间</strong></h4><p><a href="https://www.vfsvisaonline.com/Netherlands-Global-Online-Appointment_Zone1/AppScheduling/AppWelcome.aspx%3FP%3DltLn8sB713pXho9S%252BnODEomPmYxj9NlLPuyVgtwptqY%253D" target="_blank" rel="external nofollow noopener noreferrer">预约网站</a>-&gt;<a href="https://www.vfsvisaonline.com/Netherlands-Global-Online-Appointment_Zone1/AppScheduling/AppWelcome.aspx%3FP%3DltLn8sB713pXho9S%252bnODEomPmYxj9NlLPuyVgtwptqY%253d" target="_blank" rel="external nofollow noopener noreferrer">Schedule Appointment</a>-&gt;选择城市-&gt;选择MVV签证-&gt;选择日期….</p><p>由于疫情原因，目前预约系统是没有可选择日期的，不过大家知道这回事即可。预约是到大使馆之前的必备步骤，否则人家门都不让你进。</p><h4 id="3-6-亲自前往荷兰驻华大使馆"><a href="#3-6-亲自前往荷兰驻华大使馆" class="headerlink" title="3.6 亲自前往荷兰驻华大使馆"></a><strong>3.6 亲自前往<a href="https://map.baidu.com/poi/%25E8%258D%25B7%25E5%2585%25B0%25E5%25A4%25A7%25E4%25BD%25BF%25E9%25A6%2586-%25E7%25AD%25BE%25E8%25AF%2581%25E5%25A4%2584/%4012965102.945%2C4831305.2%2C19z%3Fuid%3D21ac02717b8acaa7c1f1cf16%26info_merge%3D1%26isBizPoi%3Dfalse%26ugc_type%3D3%26ugc_ver%3D1%26device_ratio%3D2%26compat%3D1%26querytype%3DdetailConInfo%26da_src%3Dshareurl" target="_blank" rel="external nofollow noopener noreferrer">荷兰驻华大使馆</a></strong></h4><p>带好‘外交部认证过的公证材料’+护照+照片 -&gt; 按时到达位置 -&gt; 填表、交护照 -&gt; 填顺丰的邮寄单（整个过程如果不排队不会超过10分钟，注意上下班时间）。(这个审核+邮寄大概只用<strong>一周</strong>就能完成，前提是提前预约时间，否则错开的时间就浪费了)</p><h4 id="3-7-完成"><a href="#3-7-完成" class="headerlink" title="3.7 完成"></a><strong>3.7 完成</strong></h4><p>等待收接收经‘大使馆认证’过的最终的签证（已经贴进护照里了）</p><p>以上整个过程花费的时间总和是：</p><p><strong>步骤3.1</strong>(2-3个月左右，这个空档内完成3.2和3.3和3.5)<strong>+步骤3.6</strong>(1周左右)<strong>=2-3月左右</strong>，期间的空档期内把材料公证、认证、预约和最后一步无缝衔接比较困难，所以给自己留好充分的时间来办理签证，切忌迷茫怠工，错过时间。</p><p><strong>附：</strong>我的时间节点(基本没怎么浪费时间)</p><ul><li>05/31 出结果</li><li><strong>06/20</strong> 收到红头文件《资格证书》</li><li>06/22 (外)导师开始帮我向学校交材料</li><li>07/02 (外)收到学院的Agreement</li><li>08/?? (内)完成材料公证</li><li>08/22 (内)材料交给代办双认证</li><li><strong>09/11</strong> (内)双认证结束</li><li><strong>09/16</strong> (外)收到IND回执</li><li>09/23 (内)材料交给大使馆出签</li><li><strong>09/28</strong> (内)拿到签证</li><li></li></ul><p><strong>注意：</strong>内，指国内办理，外，指外方协助办理。<strong>黑体字时间节点</strong>是我们不能控制的，一个是出结果到收到资格证书；再一个是双认证递交材料到完成；再一个是从六月提交材料后到收到IND的回执；再一个是出签时间。<strong>虽然我们不能准确知道这些时间点，但我们知道大概需要花费多少时间，我们要做的就是尽量穿插的准备材料，利用好时间空档，尽量不浪费时间去等待。</strong>(这些步骤都是有顺序的，比如IND回执来了，但你还没双认证，那双认证的时间就会拖慢整个流程)</p><h3 id="提前租房"><a href="#提前租房" class="headerlink" title="提前租房"></a><strong>提前租房</strong></h3><p>开始时间：收到红喜报那天晚上就可以开始找房了（自己找房），如果是希望租住到学生房，那就得等到完成学校注册（步骤3.1中的一项）后开始。当时学校注册花了<strong>一个多月</strong>的时间，所以如果目的地是国际生很多的地方，那么像荷兰的SSH等租房网站必定存在排队现象，排队的时间时长可达四个月（学校官方推荐提前四个月开始找房），那么不要孤注一掷，自己也要积极的通过各种渠道来租房子。</p><p>关于<strong>学生房vs.自租房</strong>，各人喜好不同。</p><p>我比较讨厌住在学生房里。我所在的学校学生房基本都是集中在一起的大楼，类似国内的宿舍，但都是单间独卫，环境不错，但没朋友的话着实容易抑郁！</p><p>自租房的范围就比较广了，也可能包含学生房，但更多的是房东直接租给你和其他人合住这种形式，一般只有单间，合用的洗浴、厨房、卫生间，有人可能觉得不卫生，但这种生活更丰富一点，可以有固定的邻居室友（强制你们交朋友，学生房的话可能互不搭理也没关系）。另外，优先选择华人房东，不要怕自己人宰自己人，宰的再狠也就那点钱，关键的好处是租住在华人房东房子里，有紧急事情可以方便的找到能无障碍沟通、且生活经验丰富的人。</p><h3 id="一切准备就绪后，订机票"><a href="#一切准备就绪后，订机票" class="headerlink" title="一切准备就绪后，订机票"></a><strong>一切准备就绪后，订机票</strong></h3><p>这里的一切指的是：</p><ul><li>学校注册完成</li><li>MVV签证办理完成</li><li>切记《留学协议书》交一份给留学基金委</li><li>租房手续/协议完成</li></ul><p>在这些完成之后，距离正式开学时间<strong>至少前两周左右</strong>就要定好机票，选择好时间，选择好航班，<strong>注明学生票，不要在乎价格，万把块钱的直航都是可以的</strong>，在留服CSC<a href="https://zwfw.cscse.edu.cn/" target="_blank" rel="external nofollow noopener noreferrer">网上业务办理页面</a>提交你的意向航班信息，留服人员会给你购买后，将单据（电子客票行程单）以邮件形式发给你，打印出来，到时候去机场换登机牌即可。（一周左右即可收到回执）</p><h3 id="之后去留服提交派出申请"><a href="#之后去留服提交派出申请" class="headerlink" title="之后去留服提交派出申请"></a><strong>之后去留服提交派出申请</strong></h3><p>申请通过后，可以看到报到证，这个后续在抵达目的国之后（尽量一个月内完成）需要打印出来，和其他相关材料一起邮寄给（一般是）中国驻X国大使馆教育处，审核后完成整个派出环节，三个月后（出国前会预付三个月的奖学金，用来支付房租等）开始正常发放奖学金。</p><h3 id="打包行李，坐飞机"><a href="#打包行李，坐飞机" class="headerlink" title="打包行李，坐飞机"></a><strong>打包行李，坐飞机</strong></h3><p>关于行李打包，切记不要放违禁物品，否则开包检查可就麻烦了；</p><p>切记不要超重太多，以南航为例，可以去官方 查阅行李要求，学生票的话应该是两件23KG的行李箱+?KG背包，实际体验是24公斤也不会管你的，背包多重也没人管，外加手提行李好像也没有重量检查。</p><p>我携带的重量大概是 <strong>24KG×2</strong>(皮箱)<strong>+14KG</strong>(背包)<strong>+3KG</strong>(手提)。</p><p>关于落地的海关查验，我没有被查，同一时段也没有人被查，因为那时候是凌晨5点，所以，强烈建议购买类似时间点的航班，免去很多麻烦，否则你要出具租房协议、回答问题等等等等，尽量选择时段避开之。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Summary </tag>
            
            <tag> 材料准备 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>出入境检疫局办理健康证流程</title>
      <link href="/article/b8a6.html"/>
      <url>/article/b8a6.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证正确性和完整性，请酌情参考</p></blockquote><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1di37q7eg14k517b4ptle8j1l5hm.png" alt="image_1di37q7eg14k517b4ptle8j1l5hm.png-808kB"></p><h4 id="准备事项"><a href="#准备事项" class="headerlink" title="准备事项"></a><strong>准备事项</strong></h4><ul><li><strong>地点：</strong>出入境检疫局（地市区的海关）</li><li><strong>时间：</strong>上午、下午两点之前</li><li><strong>事项：</strong>办理健康证（体检）</li><li><strong>要求：空 腹</strong></li><li><strong>材料：</strong><ul><li>两寸照片 1-2 张</li><li>身份证原件、复印件一张</li><li>护照原件、首页复印件一张</li><li>基金委红头文件（可免体检费）</li></ul></li></ul><h4 id="办理步骤"><a href="#办理步骤" class="headerlink" title="办理步骤"></a><strong>办理步骤</strong></h4><p>以下针对的是浑南海关（检疫局），各地要求可能不一样，比如免费体检这项，我只被要求提供红头文件（资格证书）即可，有些地方需要提供签证（那就比较头大）。</p><h4 id="填业务表、叫号、排队"><a href="#填业务表、叫号、排队" class="headerlink" title="填业务表、叫号、排队"></a><strong>填业务表、叫号、排队</strong></h4><p>（和银行办业务差不多）</p><h4 id="核对材料"><a href="#核对材料" class="headerlink" title="核对材料"></a><strong>核对材料</strong></h4><p>在柜台会被要求出示照片、复印件和基金委资格证书，照片复印件必须提供，核对无误后会发给你一份体检单，同时会问你<strong>要不要接种疫苗</strong>，这个一般不用，打疫苗在哪里打都可以，只需体检就行。体检单上自己看一下，人员类别一定是<strong>留学人员</strong>。</p><p>拿到体检单后去交费处缴费盖章，我只拿去盖个章就走了（免费用）。</p><h4 id="开始体检"><a href="#开始体检" class="headerlink" title="开始体检"></a><strong>开始体检</strong></h4><p>以下是我体检的顺序，体检项目各地应该都差不多，除了抽血和尿检，基本都能马上问医生正不正常，一般都是没事的，好奇可以问问。</p><p>下午去的话，整个体检过程务必在下午三点之前搞完（尤其是验尿）。</p><ul><li><strong>身高、体重、血压</strong></li><li><strong>视力、色弱色盲</strong></li><li><strong>B 超、心电图</strong></li><li><strong>抽血、尿检</strong></li><li><strong>X 射线</strong></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="取证"><a href="#取证" class="headerlink" title="取证"></a><strong>取证</strong></h4><p>上述全部流程完成后，将体验单交回前台，一天后的下午 16:00 - 16:30 拿回执单取化验结果及健康证，不同地方肯定是不一样的，但一般都支持自取和邮寄，我这里邮寄是顺风，邮费当场交上。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1di37lukf7o0rveupp19q91ua39.png" alt="image_1di37lukf7o0rveupp19q91ua39.png-822.1kB"></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Summary </tag>
            
            <tag> 材料准备 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>告别《长安十二时辰》</title>
      <link href="/article/b5dc.html"/>
      <url>/article/b5dc.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1di89vqmd110uvdkntg19l2hitm.png" alt="image_1di89vqmd110uvdkntg19l2hitm.png-864.2kB"></p><p>在刚刚过去的几天，《长安十二时辰》迎来了谢幕，全剧剧情时长仅为一天，内容非常紧凑，主线明确，支线丰富，角色感情饱满，剧情张力十足，服饰道具异常考究，是一部最近难得的且非常有特色的古装剧。</p><a id="more"></a><h3 id="主线剧情"><a href="#主线剧情" class="headerlink" title="主线剧情"></a>主线剧情</h3><p>细细回想，该剧情节从巳正开始，历经十二个时辰结束，期间剧情完全在长安城展开，中间穿插了关键的一些回忆情节，这些支线对主线中角色的行为起到了非常重要的解释作用，从而使整剧虽展开的时间有限，但表现的内容却很完整。</p><p>这里简单的利用<code>Gephi</code>对整部剧中的人物角色做个梳理，主要的角色设定及相关性如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dida6fho13s5p011b2neaj10oj9.png" alt="image_1dida6fho13s5p011b2neaj10oj9.png-156.8kB"></p><ul><li>上述内容并不完整，有些缺漏（比如没有何监的傻儿子）</li><li>李必和张小敬是本剧的核心，其构成了关键的人物组，包括檀棋、徐斌等</li><li>圣人和林九郎、何监则构成了互相牵扯的权力组，其中的勾心斗角。相互制衡，非常精彩</li><li>最后就是本剧的核心大反派龙波，其与闻无忌和张小敬的奇妙连结，是本剧情节升华的关键；在本剧中反派的发展经历了两个基本独立的阶段，一个是由曹破延主导的炮灰组，其中也包括何监的傻儿子，其“阙勒霍多”就是简单的闹市区自爆炸弹；再一个就是真正的幕后黑手龙波，在炮灰组吸引靖安司注意力的情况下，其才在有条不紊的实施“阙勒霍多”——将整个巨型花灯打造为一个炸药桶，并通过机关达到击杀圣人的目的。</li></ul><p>在地点上主要涉及几个坊市、靖安司以及花萼楼。整体情节的变换紧跟反派的变换，从最初简单的炮灰组，到最后复杂的暗杀圣人阶段，主角们遇到的问题各不相同。</p><p>在反派的合理性上，本剧设计也很出彩，层层递进逐渐揭开大反派的面目，结果原来是主角最亲密的挚友，是典型的“官逼良民反”，其实就连炮灰组曹破延和何监的傻儿子，都有他们作恶的苦衷，这种好人作恶的情节很容易让人产生同情、共鸣和感慨。在龙波身上体现的尤为明显。</p><p>最终的结局，感觉是情理之中但又是意料之外，虽然知道大的情节走向是圣人并没有遇刺（本剧符合正常的历史观），但最终还是没想到，决心行刺的龙波最后会放弃，但放弃的原因也说得过去，因为他直接对话圣人了，也在侧面完成了他的终极目标，解开了他郁结在内心的心结，这点也还是得佩服圣人的嘴炮，一点也不比主角俩人差。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>总体上来说，这部剧场景虽然设计简单，但设置却非常精致，没有太多的修饰感，服装设计拿捏的很棒；加之分集的巧妙，使得此剧虽篇幅不短但张力十足，一开始就引人入胜，值得推荐！</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 观后感 </tag>
            
            <tag> 胡乱评价 </tag>
            
            <tag> 剧透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Github托管站点的域名更换</title>
      <link href="/article/7f0e.html"/>
      <url>/article/7f0e.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote><h4 id="单纯的修改站点的域名"><a href="#单纯的修改站点的域名" class="headerlink" title="单纯的修改站点的域名"></a>单纯的修改站点的域名</h4><a id="more"></a><ul><li><p>第一步，到阿里云域名管理页面，找到旧域名的解析页，点击导出配置，选择xlsx导出即可。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dheoc42rfov36s1fv5n2tkm09.png" alt="image_1dheoc42rfov36s1fv5n2tkm09.png-245.5kB"></p></li><li><p>第二步，打开新域名的解析设置，导入刚才的xlsx配置。由于使用 Github 托管，上述步骤不涉及托管端的修改，所以整个导入后不需要任何修改就算配置完成了。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dheof6dk14991h5c1u241ge0iprm.png" alt="image_1dheof6dk14991h5c1u241ge0iprm.png-38.1kB"></p></li><li><p>第三步，需要将原站点内的所有硬编码旧域名的地方，全局替换为 新域名，使用 notepad++ 直接对文件夹进行全局查找替换，十秒钟搞定。</p></li><li><p>第四步，打开Hexo博客文件夹目录下的 CNAME 文件，看看是否自动替换为了为新域名，CNAME是会自动更新的：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dheopgll1tf3bke65a8ert721g.png" alt="image_1dheopgll1tf3bke65a8ert721g.png-5.4kB"></p></li><li><p>第五步，部署上传一遍（clean + generate + deploy）</p></li><li><p>第六步，测试，至此，把旧域名完全清除干净了，无论是博客的源文件部分，还是打包部署托管到Github上的部分，均与旧域名无关，可以说此时已经完成了域名的更改。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dheotu06o3912p4jc1e5gv2a1t.png" alt="image_1dheotu06o3912p4jc1e5gv2a1t.png-84.7kB"></p></li></ul><h4 id="旧站点链接的重定向"><a href="#旧站点链接的重定向" class="headerlink" title="旧站点链接的重定向"></a>旧站点链接的重定向</h4><p>首先说明，到现在我也不太理解到底 301重定向 是什么意思，但关于借助 Github Pages 服务的重定向我是整明白了，对于我这种使用 Github 托管静态资源站点的用户来说，要重定向目测只能通过这种方式（JS页面重定向），其本质是将旧域名绑定到一个新的 github.io（Github Pages） 上，再通过这个新 Pages 站点的 index.html（主页访问） 和 404.html（子页面访问） 来完成页面的重定向。原理如下：</p><ul><li>开始配置重定向之前需要两个准备环节，第一个环节，新建一个 Github 账号（因为一个账号仅允许绑定一个 username.github.io），新建Github账号（我这里是zonelyn），并创建同名的项目，默认 Github Pages 服务会自动启动。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhet8sj8oo1hkk1pml107ghl141.png" alt="image_1dhet8sj8oo1hkk1pml107ghl141.png-506kB"></p><ul><li><p>第二个环节，去阿里云域名解析设置页面，将 旧域名 解析到 新的.github.io 地址，主要是以下两个配置项，完成之后，即，此时访问的流程是 <strong>旧域名 → 新的.github.io</strong>。下面开始讲解使用 Github Pages 进行重定向的操作，主要分两种情况：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhemu45dhnp1fqf9v6fbm1dtd9.png" alt="image_1dhemu45dhnp1fqf9v6fbm1dtd9.png-88.8kB"></p><ul><li>直接访问旧域名时，默认跳转到 新 Pages 站点的 index.html 页面，这时我们在该页面只写一句话，即：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhenhlbm134562d19duu601lk7m.png" alt="image_1dhenhlbm134562d19duu601lk7m.png-61.1kB"><br>访问旧域名时完成了如下跳转：</li></ul><p>  <strong>旧域名 → 新的.github.io → index.html → 执行JS跳转到新域名 → 旧的.github.io</strong><br>  上述跳转对用户来讲就是 <strong>旧域名 → 旧的.github.io</strong>，也就是我们在更换了新域名后，仍然可以通过旧域名访问到原站点。</p><ul><li>访问含域名的其他子页面时，比如先前被搜索引擎收录的链接、被好友保存的友链等等，这些我们无法去更改，同时也获取不到全部的列表，即无法做一对一的重定向映射。这时如果不做任何操作直接访问的话，由于访问的是子页面，新的.github.io 中必然没有对应项（实际只有个index.html），结果就是会显示 github 的 404页面（默认）。至此，我们需要一个访问的阀门来对所有 旧域名子链 的访问进行重定向，而 Github Pages 允许用户自定义 404.html（像index那样），如果站点中有用户自定义的 404.html 那么出现异常时就会转到用户自定义的 404，我们正是借助这一特点，来完成对所有子链的重定向。同样的，通过JS来更改被访问的子链，从而完成重定向，整个流程完成如下跳转：</li></ul><p>  <strong>旧域名子链 → 新的.github.io → 404.html → 执行JS替换为新域名子链 → 旧的.github.io的子链文件</strong><br>  即，对用户来说是 <strong>旧域名子链 → 旧的.github.io的子链文件</strong>，也就是在更换新域名后，旧域名子链也正常访问到了文件位置。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhetjuif12o917en28gs2ckcj4e.png" alt="image_1dhetjuif12o917en28gs2ckcj4e.png-459kB"></p></li></ul><p>至此，托管于 Github Pages 服务的站点的 域名重定向 设置就全部完成了，达到的效果就是，全站均采用新域名访问，同时如果使用旧域名访问，无论是主页还是子链，均可以利用 新的.github.io（Pages服务）进行重定向到原页面。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h4><ul><li>基本信息<ul><li>旧域名：<a href="http://www.whereareyou.site" target="_blank" rel="external nofollow noopener noreferrer">www.whereareyou.site</a></li><li>旧站点：TianZonglin.github.io</li><li>新域名：<a href="http://www.zonelyn.com" target="_blank" rel="external nofollow noopener noreferrer">www.zonelyn.com</a></li><li>新站点：zonelyn.github.io</li></ul></li><li>目的<ul><li>在“单纯的修改站点的域名”这一节中，完成的是新域名绑定旧站点；</li><li>在“旧站点链接的重定向”这一节中，完成的是旧域名绑定旧站点；</li><li>新建的站点只起到中转作用（利用了一下他的 Github Pages 服务）</li></ul></li><li>效果：<ul><li>访问 <a href="http://www.zonelyn.com" target="_blank" rel="external nofollow noopener noreferrer">www.zonelyn.com</a> → 最终访问 TianZonglin.github.io；</li><li>访问 <a href="http://www.zonelyn.com/tags" target="_blank" rel="external nofollow noopener noreferrer">www.zonelyn.com/tags</a> → 最终访问 TianZonglin.github.io/tags；</li><li>访问 <a href="http://www.whereareyou.site" target="_blank" rel="external nofollow noopener noreferrer">www.whereareyou.site</a> → … → 最终访问 TianZonglin.github.io；</li><li>访问 <a href="http://www.whereareyou.site/tags" target="_blank" rel="external nofollow noopener noreferrer">www.whereareyou.site/tags</a> → … → 最终访问 TianZonglin.github.io/tags；</li></ul></li></ul><h4 id="百度统计的更新"><a href="#百度统计的更新" class="headerlink" title="百度统计的更新"></a>百度统计的更新</h4><p>域名更改后，还会受到影响的就是百度统计等若干统计了，这里采取的方案分以下几步：</p><ul><li>新建统计站点（zonelyn）；</li><li>重新安装统计代码<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhf1f2n71sjb1jaqoeb1ftp4j59.png" alt="image_1dhf1f2n71sjb1jaqoeb1ftp4j59.png-122.4kB"></li><li>20分钟后，会检测到代码正常</li><li>合并为百度统计中的“汇总网站”<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhf1hgpm1hk019i51j5fgaulkm.png" alt="image_1dhf1hgpm1hk019i51j5fgaulkm.png-129.2kB"></li></ul><p>由于仅仅是替换原站点中的统计代码，不会删除访问量等数据，原站点的访问数据同原域名一起，停止在了某个状态，重新安装完百度统计的代码后，访问数据便均为新域名的，旧域名将和新域名一起组成汇总网站，此后我们只需查看汇总网站的报告即可！</p><h4 id="其他相关更新"><a href="#其他相关更新" class="headerlink" title="其他相关更新"></a>其他相关更新</h4><ul><li>Valine评论插件在更换完域名后也得重新添加下安全域名，之前出于安全考虑，在 LeanCloud 的配置页面添加了 Web安全域名，将新域名填进去保存即可。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhf28vpe7tekkf1719pik6od13.png" alt="image_1dhf28vpe7tekkf1719pik6od13.png-82.4kB"></li></ul><hr><p>我的博客即将同步至腾讯云+社区，邀请大家一同入驻：<a href="https://cloud.tencent.com/developer/support-plan?invite_code=1uwztntxoqyyn" target="_blank" rel="external nofollow noopener noreferrer">https://cloud.tencent.com/developer/support-plan?invite_code=1uwztntxoqyyn</a></p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 域名 </tag>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网站域名到底加不加 WWW</title>
      <link href="/article/bcad.html"/>
      <url>/article/bcad.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文系【转载】，感谢作者的总结！<br>原作地址：知乎日报<br>原文作者：Rio<br>转载文本请注明出处和原作出处，下文不保证百分百正确性和完整性，请酌情参考</p></blockquote><a id="more"></a><h4 id="不加-www-的裸域名的好处和坏处"><a href="#不加-www-的裸域名的好处和坏处" class="headerlink" title="不加 www 的裸域名的好处和坏处"></a>不加 www 的裸域名的好处和坏处</h4><ul><li><p>好处：主要是域名更加简短、容易记忆。</p></li><li><p>坏处：</p><ul><li><p><strong>裸域名只能绑定 DNS 的 A 记录，不能绑定 CNAME 记录。</strong><br>也就是说你不能把裸域设定为另外域名的别名。很多时候这对管理不是很方便，特别是使用第三方托管服务的时候。如果第三方迁移服务器导致 IP 地址变更，你必须自己去更改 DNS 的 A 记录。<br>比如你的个人博客采用 Tumblr 的服务，如果使用裸域，你需要手动将你域名的 A 地址指向 Tumblr 指定的 IP 地址。Tumblr 如果迁移了机房，所有通过这种方式设定个人域名的用户都必须更改自己的 DNS 才能继续使用，否则服务就会中断。使用子域名的 CNAME 记录就相对简单很多，只需要将 www 子域名的 CNAME 字段指向 <code>http://domains.tumblr.com</code> 这个域名，之后如果 Tumblr 更改 IP 地址，他们只需要重新设置 <code>http://domains.tumblr.com</code> 这个域名的 A 记录，而无需要求每个用户去更改 DNS 记录。<br>这个技术上的限制导致许多大型的第三方服务商不支持使用裸域。典型的如 Google 的服务，现在都不能使用裸域。Google 的服务用户基数大，不得不采用 DNS 级别的分布式，使用到的 IP 地址太多，而且变动大。让用户绑定 A 记录的话不利于负载均衡，维护起来也是几乎不可能完成的任务。同理，大部分 CDN 也不支持裸域。</p></li><li><p><strong>裸域的 cookie 的作用范围太大。</strong><br>假如知乎也采用裸域，那么知乎所有 cookie 的作用范围就包括 <code>http://zhihu.com</code> 下的所有子域名。也就是说访问 <code>http://foo.zhihu.com</code> 和 <code>http://bar.zhihu.com</code> 的时候都会带上 <code>http://zhihu.com</code> 裸域页面设置的 cookie。从安全、隐私、可扩展性、以及管理的角度而言，这对很多大型网站来说是不可接受的。</p></li><li><p><strong>URL 的正则匹配，如果带 www 前缀的并且以 .com/.net/.org 结尾的，通常成功的机会要大很多</strong>。<br>这个你会在许多文本编辑器里面遇到。如果 URL 不是 www 开头，并且也不是三大顶级域名结尾的，匹配成功的概率就要小很多。这是使用过程中有时候会让人很抓狂的点，重不重要全看你的用途和场合了。</p></li><li><p>非技术上的考量：用 www 子域名的好处体现在线下的环境，比如户外广告、报纸杂志、语音广播、语音电话等使用场合，www 这个前缀（不管是视觉的还是听觉的）能够很明确的提醒受众，这个信息片段是一个网站。有人会说加上 http:// 前缀也能解决这个问题，但现在随着以 Chrome/Safari 为首的浏览器都开始在地址栏里隐藏 http:// 协议前缀了，普通用户对于 http:// 这几个字符的理解会越来越模糊，所以如果是线下的话，保留 www 这个 visual/vocal cue 还是有一定意义的。</p></li></ul></li></ul><p>总的来说对于大访问量或多子域名的网站来说，不建议使用裸域。小流量或子域名少的网站的话就看个人爱好了。我挺喜欢裸域的。最近几年流行起来的「单页网页应用」 ( Single Page Web App ) 也是以采用裸域的居多，Twitter 算是一例。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="去掉-www-是否会影响网站的-SEO（主要是排名和收录）"><a href="#去掉-www-是否会影响网站的-SEO（主要是排名和收录）" class="headerlink" title="去掉 www 是否会影响网站的 SEO（主要是排名和收录）"></a>去掉 www 是否会影响网站的 SEO（主要是排名和收录）</h4><p>（前提是过去有加 www）早先裸域刚开始流行的时候确实有传闻说不利于 SEO，但现在看来似乎并无任何问题。如果有的话也是搜索引擎的 bug，给他们提一下他们应该会很乐意去改。Google 的站长工具里面有工具可以帮助你做 URL 迁移的，可以有效的解决这个问题，再配合下一部分的跳转，不用担心对 SEO 有任何负面影响。</p><h4 id="用什么方式去跳转最好？"><a href="#用什么方式去跳转最好？" class="headerlink" title="用什么方式去跳转最好？"></a>用什么方式去跳转最好？</h4><p>（如 301）不管你决定使用还是不使用裸域，最好不要在同时保留 www 和非 www 前缀的 URL，这样既不方便用户的浏览器区分访问历史，也会对你做访问统计带来不少麻烦。最佳的方式是采用 301 跳转，并且跳转的时候保留 URL 里域名后的全部内容。比如，如果你决定使用裸域 <code>http://example.com</code>，那么请务必将 <code>http://www.example.com/foo/bar?spam=egg</code> 301 跳转到 <code>http://example.com/foo/bar?spam=egg</code> 。或者反过来，如果你决定不使用裸域，那么请务必将 <code>http://example.com/foo/bar?spam=egg</code> 301 跳转到 <code>http://www.example.com/foo/bar?spam=egg</code>，这样的跳转需要在 web 服务器里单独配置，很多 DNS 管理界面提供的简单的跳转到新域名的根目录无法实现这样的功能（仅仅跳到 <code>http://example.com/</code> ) ，对用户体验和搜索引擎 SEO 而言都是非常糟糕的。</p><p>下面给出如何在 nginx 里面实现上述的跳转：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># redirect http:&#x2F;&#x2F;www.example.com to http:&#x2F;&#x2F;example.com</span><br><span class="line">server &#123;</span><br><span class="line">    server_name www.example.com;</span><br><span class="line">    return 301 $$scheme:&#x2F;&#x2F;http:&#x2F;&#x2F;example.com$$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># redirect http:&#x2F;&#x2F;example.com to http:&#x2F;&#x2F;www.example.com</span><br><span class="line">server &#123;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    return 301 $$scheme:&#x2F;&#x2F;www.$$host$$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>综上，总结个小结论，即加或不加，必须要确定一种，相应地，另一种形式务必通过 301 重定向到前者的地址，这样就统一定向到唯一的主打域名上。另外，最好还是加上 www 前缀显得正式和规范。</p><p>在确定使用方案后，接下来就开始操刀域名的更换了，site域名虽然便宜，但接受度较差，在QQ及微信内均已无法直接访问，考虑到长远的发展，现已购入新的 COM 域名，稍后给出详细的更改过程。</p><blockquote><p>本文系【转载】，感谢作者的总结！<br>原作地址：知乎日报<br>原文作者：Rio</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 域名 </tag>
            
            <tag> 建站 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LEDE+iKuai双软路由整合</title>
      <link href="/article/fe88.html"/>
      <url>/article/fe88.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote><h4 id="首先明确"><a href="#首先明确" class="headerlink" title="首先明确"></a>首先明确</h4><p>LEDE 同 iKuai 可以说是目的相近的两种不同的路由系统，其均能够完成一些路由的基本功能，在这方面来说两者并无差别，但在扩展功能上，二者各有所长：</p><a id="more"></a><ul><li>LEDE 具有强大的插件扩展能力，作为 Openwrt 的发行版之一，其本身有着丰富的插件工具支持，同时也非常适合有能力的玩家自己编译自己的路由系统，好用的插件（出国留学+广告拦截）和强大易用的编译扩展能力是其特色；</li><li>iKuai 的特色在于其出色稳定的 单线多拨 功能和 流控分流 功能，这使之更加贴近真正的路由器设备，从而被大多数玩家应用为主路由，通过单线多拨功能，可以完成 宽带叠加 的效果，对于有大带宽需求的用户来说是非常好的选择。</li><li>综上，这里使用 iKuai 作为主路由，使用 LEDE 作为旁路由 来搭建网络，整个路由系统以虚拟机形式安装在 ESXi 上，通过网卡直通，使虚拟机的带宽损失降到最低。</li></ul><h4 id="承载设备"><a href="#承载设备" class="headerlink" title="承载设备"></a>承载设备</h4><p>安装设备：YANLING-SKUL6, 2 × i5-7200U 2.5GHz, 16GB RAM, 500GB SSD<br>设备接口：6 × LAN, 4 × USB, COM, HDMI<br>系统版本：VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01<br>其他需求：需首先安装好 ESXi<br>软件镜像：</p><ul><li>iKuai <a href="https://www.ikuai8.com/component/download" target="_blank" rel="external nofollow noopener noreferrer">网址/选择ISO,64位</a>， <a href="https://www.ikuai8.com/download.php?n=/3.x/iso/iKuai8_x64_3.2.4_Build201907151220.iso" target="_blank" rel="external nofollow noopener noreferrer">直接下载文件</a></li><li>LEDE <a href="https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/" target="_blank" rel="external nofollow noopener noreferrer">网址/选择combined,vmdk</a>，  <a href="https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/openwrt-koolshare-mod-v2.31-r10822-50aa0525d1-x86-64-combined-squashfs.vmdk" target="_blank" rel="external nofollow noopener noreferrer">直接下载文件</a></li><li>StarWind V2V Image Converter <a href="http://www.38hack.com/1894.html" target="_blank" rel="external nofollow noopener noreferrer">网址</a>， <a href="https://www.starwindsoftware.com/tmplink/starwindconverter.exe" target="_blank" rel="external nofollow noopener noreferrer">直接下载文件</a> </li></ul><h4 id="网口的映射"><a href="#网口的映射" class="headerlink" title="网口的映射"></a>网口的映射</h4><p>需要明确以下几点：</p><ul><li>我们将拥有两层路由，第一层是 iKuai 主路由，第二层是 LEDE 旁路由；</li><li>第一层路由需要具备 WAN 口，作为整个路由系统的网络来源；</li><li>第二层路由需要具备多个 LAN 口，作为路由系统的输出（连接设备）；</li><li>若拿一般路由器举例，WAN 即为头、LAN 为脚，则 主路由 iKuai 有头无脚，旁路由 LEDE 有脚无头；</li><li>结合：iKuai 虚拟出一只脚（LAN口），LEDE 把这只脚当做头（iKuai 的这个 LAN 口会被 LEDE 当做 WAN 口）；</li><li>在虚拟映射方面：<ul><li>iKuai 只需要单单映射一个网卡直通的网口（WAN），给 LEDE 使用的 LAN 口不用做网卡直通，因为双软路由对外作为一体使用，中间的映射只用逻辑的 虚拟网卡即可；</li><li>LEDE 需要将 WAN 口之外剩余的网口全部做网卡直通，此处，剩余的各网口和一般路由器的 LAN 口没什么区别，直通只是减少损耗；</li></ul></li></ul><h4 id="iKuai-的安装"><a href="#iKuai-的安装" class="headerlink" title="iKuai 的安装"></a>iKuai 的安装</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnnf4uves1bps76m6191pfq9.png" alt="image_1dftnnf4uves1bps76m6191pfq9.png-146.5kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnnll2oc91omg1dl2ijf1jivm.png" alt="image_1dftnnll2oc91omg1dl2ijf1jivm.png-155.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnnrqd1efg1ssjl5v1pok82m13.png" alt="image_1dftnnrqd1efg1ssjl5v1pok82m13.png-199.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftno03q1rnabilq2017lc16841g.png" alt="image_1dftno03q1rnabilq2017lc16841g.png-189.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftno48l1ifqv361lej1d721it1t.png" alt="image_1dftno48l1ifqv361lej1d721it1t.png-196.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftno89kgel12bj1mfk1158b162a.png" alt="image_1dftno89kgel12bj1mfk1158b162a.png-236.8kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnociti72tsasu7ij41da02n.png" alt="image_1dftnociti72tsasu7ij41da02n.png-197.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnoh3frs71s441lej6q3gsu34.png" alt="image_1dftnoh3frs71s441lej6q3gsu34.png-156.5kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnolh7oab1anm6n618etir3h.png" alt="image_1dftnolh7oab1anm6n618etir3h.png-206.6kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnoq8ae38365lt1gkdsq43u.png" alt="image_1dftnoq8ae38365lt1gkdsq43u.png-224.1kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnottikb4vrt30qshvl354b.png" alt="image_1dftnottikb4vrt30qshvl354b.png-221.8kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnp29a1t4r1u701efpgrmsuu4o.png" alt="image_1dftnp29a1t4r1u701efpgrmsuu4o.png-192.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnp71619e913nd1auvgcii0555.png" alt="image_1dftnp71619e913nd1auvgcii0555.png-197kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnpapm141jrgh67qddjkhm5i.png" alt="image_1dftnpapm141jrgh67qddjkhm5i.png-178kB"></p><h4 id="iKuai-的初始网络设置（黑框）"><a href="#iKuai-的初始网络设置（黑框）" class="headerlink" title="iKuai 的初始网络设置（黑框）"></a>iKuai 的初始网络设置（黑框）</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnpf3913l0t2j1l771ha227e5v.png" alt="image_1dftnpf3913l0t2j1l771ha227e5v.png-226kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnpj3oeph1lqr1gefokv3t46c.png" alt="image_1dftnpj3oeph1lqr1gefokv3t46c.png-242.6kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnpmt0b8d4t4l6t1qiseae6p.png" alt="image_1dftnpmt0b8d4t4l6t1qiseae6p.png-240kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnprvi1rmq1644a6s1o3t1tb076.png" alt="image_1dftnprvi1rmq1644a6s1o3t1tb076.png-215.7kB"></p><h4 id="iKuai-的系统配置（Web端）"><a href="#iKuai-的系统配置（Web端）" class="headerlink" title="iKuai 的系统配置（Web端）"></a>iKuai 的系统配置（Web端）</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/py7i910g0mprotdrgkaurq4f/ikuai.jpg" alt="ikuai.jpg-98kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%981.png" alt="无标题1.png-151.6kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716222911.png" alt="QQ截图20190716222911.png-122.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%982.png" alt="无标题2.png-105.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%983.png" alt="无标题3.png-118.5kB"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="LEDE-镜像的合并处理"><a href="#LEDE-镜像的合并处理" class="headerlink" title="LEDE 镜像的合并处理"></a>LEDE 镜像的合并处理</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnq1ol17btnv11p0117pr4k27j.png" alt="image_1dftnq1ol17btnv11p0117pr4k27j.png-33.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dftnq6sfnio1t2gem213ki11aj80.png" alt="image_1dftnq6sfnio1t2gem213ki11aj80.png-41kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716224636.png" alt="QQ截图20190716224636.png-36.1kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716224712.png" alt="QQ截图20190716224712.png-41.6kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716224849.png" alt="QQ截图20190716224849.png-69.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716224930.png" alt="QQ截图20190716224930.png-40.4kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716225017.png" alt="QQ截图20190716225017.png-41.5kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716225037.png" alt="QQ截图20190716225037.png-48.5kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716225146.png" alt="QQ截图20190716225146.png-40.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%984.png" alt="无标题4.png-138.3kB"></p><h4 id="LEDE-在-ESXi-上的安装"><a href="#LEDE-在-ESXi-上的安装" class="headerlink" title="LEDE 在 ESXi 上的安装"></a>LEDE 在 ESXi 上的安装</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716230109.png" alt="QQ截图20190716230109.png-171kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716230451.png" alt="QQ截图20190716230451.png-196.5kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%985.png" alt="无标题5.png-180.6kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%97%A0%E6%A0%87%E9%A2%986.png" alt="无标题6.png-174.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716231438.png" alt="QQ截图20190716231438.png-197.3kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716231613.png" alt="QQ截图20190716231613.png-168.8kB"></p><h4 id="LEDE-的初始网络配置（黑框）"><a href="#LEDE-的初始网络配置（黑框）" class="headerlink" title="LEDE 的初始网络配置（黑框）"></a>LEDE 的初始网络配置（黑框）</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716231728.png" alt="QQ截图20190716231728.png-214.4kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716231858.png" alt="QQ截图20190716231858.png-197.3kB"></p><h4 id="LEDE-路由配置（Web端）"><a href="#LEDE-路由配置（Web端）" class="headerlink" title="LEDE 路由配置（Web端）"></a>LEDE 路由配置（Web端）</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716232046.png" alt="QQ截图20190716232046.png-58.7kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716232140.png" alt="QQ截图20190716232140.png-100.4kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716232538.png" alt="QQ截图20190716232538.png-135.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716232745.png" alt="QQ截图20190716232745.png-127.8kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716233108.png" alt="QQ截图20190716233108.png-106.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190716233415.png" alt="QQ截图20190716233415.png-129.7kB"></p><h4 id="最后：配置LEDE的网卡直通"><a href="#最后：配置LEDE的网卡直通" class="headerlink" title="最后：配置LEDE的网卡直通"></a>最后：配置LEDE的网卡直通</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717102029.png" alt="QQ截图20190717102029.png-119.7kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717103018.png" alt="QQ截图20190717103018.png-112.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717103104.png" alt="QQ截图20190717103104.png-81.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717103839.png" alt="QQ截图20190717103839.png-166.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717104019.png" alt="QQ截图20190717104019.png-140.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717132218.png" alt="QQ截图20190717132218.png-163.1kB"></p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟化系统ESXi的安装使用</title>
      <link href="/article/9d39.html"/>
      <url>/article/9d39.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote><h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>动机在先前的文章中已经说的很清楚了，现在直接开干，下面 Step by Step 的详细介绍 ESXi 的安装以及 LEDE、iKuai、Win7 等虚拟机的安装及使用。</p><a id="more"></a><h4 id="承载设备"><a href="#承载设备" class="headerlink" title="承载设备"></a>承载设备</h4><p>安装设备：YANLING-SKUL6, 2 × i5-7200U 2.5GHz, 16GB RAM, 500GB SSD<br>设备接口：6 × LAN, 4 × USB, COM, HDMI<br>系统版本：VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01<br>其他需求：普通双头网线一根，优盘一个，显示器+HDMI线+鼠标+键盘（有线即可）<br>软件镜像：</p><ul><li>ESXI <a href="http://www.5sharing.com/m/view.php?aid=705" target="_blank" rel="external nofollow noopener noreferrer">网址</a>， <a href="https://downloads.dell.com/FOLDER04945360M/1/VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01.iso?uid=36824895-721d-4bb9-252b-e6808049e8d3&fn=VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01.iso" target="_blank" rel="external nofollow noopener noreferrer">直接下载文件</a> </li></ul><p>叙述别名：安装设备下文称为 &gt; 软路由/工控机<br>          配置设备下文称为 &gt; 主机/笔记本</p><p>角色关系：ESXI为工控机主系统，iKuai、LEDE、Win7、黑裙等均为其上的虚拟机</p><p>可能的驱动驱动：<a href="http://drivers.mydrivers.com/drivers/494_197817.htm" target="_blank" rel="external nofollow noopener noreferrer">链接</a></p><h4 id="工控机安-ESXI-系统的注意事项："><a href="#工控机安-ESXI-系统的注意事项：" class="headerlink" title="工控机安 ESXI 系统的注意事项："></a>工控机安 ESXI 系统的注意事项：</h4><ul><li>BIOS设置优盘启动</li><li>PE系统内清除硬盘分区</li><li>ESXI在工控机安装配置就两步：配置静态地址（IP1+掩码+网关），检查插网线LAN口</li><li>上述操作需要显示器+键鼠，之后便不用</li></ul><h4 id="主机-笔记本配置的注意事项："><a href="#主机-笔记本配置的注意事项：" class="headerlink" title="主机/笔记本配置的注意事项："></a>主机/笔记本配置的注意事项：</h4><ul><li>在笔记本用网线连接后，笔记本需配置：静态地址（IP2+掩码+网关）</li><li>在笔记本测试连接时：只需Ping通IP1即可，然后浏览器访问 IP1</li><li>6.7.0 (Build 8169922) 许可证：0U0QJ-FR1EP-KZQN9-J1C74-23P5R</li><li>关闭Web端的视觉效果以加速</li></ul><h4 id="详细安装步骤截图"><a href="#详细安装步骤截图" class="headerlink" title="详细安装步骤截图"></a>详细安装步骤截图</h4><ul><li><p>首先制作 U盘 镜像</p></li><li><p>然后设置 BIOS U盘引导启动</p></li><li><p>之后进入系统安装界面，选择 ESXi 系统的所在盘符<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhar1ais1sh079s106j55l11pn9.png" alt="image_1dhar1ais1sh079s106j55l11pn9.png-1507.6kB"></p></li><li><p>一路 “同意” 下一步<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhar2fu71ki1j805ue1hn9uoom.png" alt="image_1dhar2fu71ki1j805ue1hn9uoom.png-1364kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhar3nhs11s11s0o9g51thj36d13.png" alt="image_1dhar3nhs11s11s0o9g51thj36d13.png-1127.7kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharc7kv1trd15t21vgrdvfvq1g.png" alt="image_1dharc7kv1trd15t21vgrdvfvq1g.png-1409.6kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharcv629g1e841njo1o73dpc1t.png" alt="image_1dharcv629g1e841njo1o73dpc1t.png-628.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharepeauobi1511hdjssi302a.png" alt="image_1dharepeauobi1511hdjssi302a.png-1500.5kB"></p></li><li><p>安装完成后选择 reboot 重启<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharh2i418bg11elciuv9l17oe9.png" alt="image_1dharh2i418bg11elciuv9l17oe9.png-2233.8kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharib1uncu1eovgc117n9413m.png" alt="image_1dharib1uncu1eovgc117n9413m.png-2209.5kB"></p></li><li><p>进入黄色的 ESXi 系统后台界面（输入密码）<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dharvmba9gv1vf11rcn1r9764d1j.png" alt="image_1dharvmba9gv1vf11rcn1r9764d1j.png-1089.7kB"></p></li><li><p>进入管配置页，选择配置网络<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhas0ndk1mi01e0er3t1vio1fgm20.png" alt="image_1dhas0ndk1mi01e0er3t1vio1fgm20.png-2420.5kB"></p></li><li><p>此时，将网线插入 LAN1 - LAN6 中的一口，另一端插入电脑/笔记本的网口，接下来就用该笔记本来登录ESXi的WEB配置页面</p></li><li><p>然后在下面页面勾选“Connected”选项，用空格键在中括号内打叉<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhas1ied1bre12431s7qkr8127r2d.png" alt="image_1dhas1ied1bre12431s7qkr8127r2d.png-2196.9kB"></p></li><li><p>选择静态IP地址，设置完成后保存，这是关键步骤，Web端的访问需要IPv4的地址，同时笔记本电脑的网关要设置成该网关。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhas2o391knb021f8pqa71mk72q.png" alt="image_1dhas2o391knb021f8pqa71mk72q.png-1574.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhas3g4b106ebkb99a106pv537.png" alt="image_1dhas3g4b106ebkb99a106pv537.png-1014.3kB"></p></li><li><p>以上内容需要鼠标键盘和显示器的参与，但至此，机器上的配置已经完成，接下来，使用笔记本配置IPv4的选项，需要：</p><ul><li>使用静态IPv4地址，随意指定，但不可与上一步中的地址个重复</li><li>使用固定的网关，即上一步中的网关</li><li>配置完成后，在浏览器访问上一步中ESXi的IPv4地址，即可进入Web后台页面</li><li>注意：此时只有工控机和笔记本网口通过一根网线相连，即这时的设备均无网络连接，也不需要网络连接，待到安装好路由系统后，将外部网线插入工控机的某网口（WAN口）并在路由系统内完成配置后方可顺利上网。</li><li>对 ESXi 的远程操控：<ul><li>操控内容：虚拟机的安装、虚拟机的管理</li><li>方式一：Web 后台，简单粗暴，但有时会受浏览器影响；</li><li>方式二：Vmware 软件远程，用过PC端Vmware的可以说是非常人性化了；</li><li>方法三：vSphere，没用过，正规企业级应该用这个；</li></ul></li></ul></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="小试牛刀：安装Win7"><a href="#小试牛刀：安装Win7" class="headerlink" title="小试牛刀：安装Win7"></a>小试牛刀：安装Win7</h4><p>需要明确的是，ESXi的虚拟机安装流程及镜像要求和PC上的Vmware基本完全一样，即，一般的装机映像无论是Linux还是Windows都可以顺利安装，需要特别注意的有以下几点：</p><ul><li>镜像首先要上传至ESXi的文件系统，一般给每个虚拟机单独建个文件夹最好，之后在安装虚拟机时直接选择上传好的镜像；</li><li>网卡的虚拟是否可以直通，对于Win7来说，具备Wifi功能可以很好的提升使用体验，研凌的主板允许用户自己搭载一粒mini-pcie接口的网卡（半高），但安装完ESXi后，一般的无线网卡是不被ESXi识别的，这时就要用到网卡直通，单独将该无线网卡配置到Win7的虚拟机中，这样在Win7中就可以顺利使用Wifi或发射热点。</li><li>显卡的直通，研凌板载的集显是 Intel Graphics 630 对于路由系统来说毫无用处，但对于HTPC来说则是非常重要的，由于我想利用Win7来做媒体中心，自然需要其解码能力，这时显卡直通可方便地完成该需求。</li><li>对于 Win7 + Plex Server：需注意，在基础版本会缺失很多功能，导致 Plex Server 无法启动，解决方法是安装 SP1（Service Package 1） 及以上的版本，即可顺利开启 Plex Server，之后，挂载影音资料的磁盘，在 Plex 中扫描即可，和在群晖中的使用类似。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717073812.png" alt="xxx"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/QQ%E6%88%AA%E5%9B%BE20190717073718.png" alt="QQ截图20190717073718.png-298kB">  </li><li>对于 Win7 的远程操控，方法比较多样，主要有：<ul><li>Windows 远程桌面：使用体验最好</li><li>TeamViewer：比较臃肿</li><li>AnyDesk：最轻量便捷</li><li>VNC：通用性强</li></ul></li></ul><hr><p>本文详细的说明了 ESXi 的安装过程、注意事项及简单应用，不过，完成上述过程才只是使用了研凌工控机的一小部分功能，真正发挥功效的软路由部分还未做介绍，有关于 LEDE + iKuai 的双软路由搭建将在今后同大家见面。</p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
            <tag> HTPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何组建高效的家庭网络</title>
      <link href="/article/13d5.html"/>
      <url>/article/13d5.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dh68qqed164p1os614cf1p091o2m9.png" alt="image_1dh68qqed164p1os614cf1p091o2m9.png-312.1kB"></p><p>在“<a href="https://old.cz5h.com/article/2019-7-4%20%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%B6%E9%87%8C%E8%A6%81%E6%9C%89%E5%85%AC%E7%BD%91IP.html" target="_blank" rel="external nofollow noopener noreferrer">为什么家里要有公网IP</a>”一文中已经简要的说明了一下网络环境对于NAS的重要性，这里专门就此问题展开讨论。</p><h4 id="首要任务"><a href="#首要任务" class="headerlink" title="首要任务"></a>首要任务</h4><p>首先要确定自己宽带是否具备公网IP（已办用户），一般情况下，按网络的接入情况，可将家庭网路（宽带业务）分为三种：</p><ul><li><p><strong>入户即为局域网IP</strong></p><ul><li>区分：路由器配置页面中，WAN口IP地址是局域网IP，例如192.168开头、10.XX开头等等</li><li>判定：直接在百度搜索上述IP地址，公网IP会有详细的运营商等信息，局域网IP的搜索结果则没有有效信息；或者电询运营商。</li><li>特点：向外访问一切正常，但向内访问无法完成，即该类型的IP无法直接在公网访问，需通过FRP（内网穿透）来中转连接，无法直连。</li></ul></li><li><p><strong>入户为专线（静态公网IP）</strong></p><ul><li>区分：路由器WAN口的地址非局域网特征的IP</li><li>判定：直接搜索会有明确的运行商名称、及大概的地理位置</li><li>特点：公网环境向内访问可实现，直接访问IP即可，由于IP固定，所以只需简单的采用DNS映射就可以满足绝大多数场景</li></ul></li><li><p><strong>入户为动态公网IP</strong></p><ul><li>区分：同上</li><li>判定：同上</li><li>特点：不定期的动态变更IP地址，但在非变更期间内，其所有特征同静态公网IP一致，但由于IP动态更新，所以通过IP直连的方式不可取（单次可直连但变更后无法追踪），所以一般需要采用DDNS（动态域名服务）来绑定动态IP，其和DNS的区别就是一个解析静态IP一个解析动态IP，对用户使用来说均是透明的，做完映射解析后，在公网环境中访问域名即可，动态变化的IP由DDNS负责动态绑定。</li></ul></li></ul><h4 id="次要任务"><a href="#次要任务" class="headerlink" title="次要任务"></a>次要任务</h4><p>公网IP是第一重要的，这是硬性条件，除此之外，为了获得更好的使用体验，还还需考虑：</p><ul><li><p><strong>上行、下行的带宽大小</strong><br>  与所办宽带的业务直接相关，对于我们将要使用的若干功能（在前一篇文中提及的），都要有较大下行带宽的前提下，具备足够的上行带宽，个人意见上行 &gt;20Mbps 下行 &gt;50Mbps 方可流畅使用各功能。</p></li><li><p><strong>路由器中转后的带宽损失</strong></p><ul><li>原因：随着带宽的变大，一般低端路由的处理芯片便会出现吃力的情况，加之长期高温会进一步降低处理器的处理性能，所以建议 200M 带宽以上的用户使用中高端路由，或使用处理性能更强的处理器，目前多是直接使用研凌等品牌的工控机或者Intel的NUC微型计算机来做软路由。</li><li>判定：找到良好的下载资源（不要仅看网速测试），用迅雷等软件下载进行实测，看一段时间内的下载速度的波动和速度值是否匹配带宽。</li><li>改善：如若确定路由器是瓶颈，那就需要升级路由器，中高端硬路由性价比没什么优势，推荐使用软路由，即将工控机装入路由系统，从而使其充当路由器，一般软路由主板的处理器性能要比中端路由器强许多，例如J1900或更强大的i5 7200U，要比 网件R7000 的博通BCM4709A双核处理器若干倍了。</li></ul></li></ul><h4 id="对接配置"><a href="#对接配置" class="headerlink" title="对接配置"></a>对接配置</h4><p>在确认具备公网IP的环境之后，要想将内部的原有服务及应用暴露在公网内，还需两步设置，即 DDNS 和 端口映射，二者缺一不可（对于动态公网IP来说）。</p><ul><li><p><strong>DDNS</strong><br>一般直接去阿里云就有DDNS服务，但其实群晖也好、网件的路由器也好，都已经提供了相应的 DDNS 服务，例如群晖内的“外部访问”页面可以配置 DDNS，对于硬路由 R7000（实际是梅林固件的作用）来说，其也提供 DDNS 服务，实测后者较好，目前使用的是 xxx.asuscomm.com，配置完之后，对公网环境来说，只需访问该域名就可以访问到真实的物理IP，但像群晖提供的各种功能均在路由器下级，正常以“内网IP+端口号”的形式进行访问，现在 xxx.asuscomm.com 仅仅访问到了路由器，之后还需要路由器的端口映射，来指导具体的请求流向。 </p></li><li><p><strong>端口映射</strong><br>正常的端口有 0-65535 这么多，除了已被占用的端口和保留端口，以及被封禁的 80/443 端口，还有上万个自定义端口可以使用，即路由器可以事先约定：凡是公网的用户访问 xxx.asuscomm.com:5000，那么就转到 群晖内网IP:5000，默认DSM的端口是5000，即原来在内网环境中通过 群晖内网IP:5000 来访问DSM，但现在可以在公网环境中通过 xxx.asuscomm.com:5000 来访问，唯一的不同就是多了一步“约定”，而这个约定，就是一张端口映射表，将向内的访问分发到不同的内部网址+端口号，从而完成内部应用的“暴露”。<br>注意：通常路由器的端口映射部分还有个 DMZ主机 选项，可以将一台内部电脑的全部端口暴露在公网内，在某些情况下适用，但在家用环境中这是十分危险的，可以给恶意攻击者当做跳板进而攻击内网设备，所以尽量适用手动配置端口映射，避免使用 DMS主机。</p></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="软路由的作用及使用"><a href="#软路由的作用及使用" class="headerlink" title="软路由的作用及使用"></a>软路由的作用及使用</h4><p>有机会单独成文介绍，下面简要说一下软路由在整个家庭网络环境中的作用。（注意，当软路由接管整个家庭网络之后，原先的硬路由一般会充当 AP 进行使用，只负担 WIFI 功能，所以对应的 DDNS 和 端口映射的位置要调整，使安装情况来看是在 LEDE 还是 iKuai 中配置）</p><ul><li><p><strong>基础</strong>：如前所示，软路由的使用者一般是不希望路由成为整个网络环境的瓶颈，而事实是软路由确实做得不错。开源的路由系统Openwrt目前已经拥有了活跃的社区，衍生出了若干版本，LEDE便是其中之一；此外，还有商业化十分成功的iKuai，以及海蜘蛛、高恪等等。目前主要使用LEDE+iKuai。</p><ul><li>LEDE：作为Openwrt的发行版之一，其拥有丰富的插件系统，可以允许用户安装ad屏蔽、出国留学等插件，从而路由器端进行过滤或代理，十分强大有效；其他还有许多功能，但出国留学是其特色和优势。</li><li>iKuai：商业化公司提供的免费版本，UI十分精美，负载均衡和单线多拨是其特色和优势。单线多拨需要特别说明，其可实现宽带叠加的效果（宽带运营商未屏蔽该操作的前提下），例如 200M 在三拨的情况下理论可达 600Mbps 的带宽。</li></ul></li><li><p><strong>扩展</strong>：诸如 i5 7200U 这样的路由器，直接安装 LEDE 这样的路由系统是在是对处理能力的浪费，所以，为了具有更多的可扩展性，通常是在工控机上安装 ESXi （或KVM等其他虚拟化系统）系统，各路由系统退化一级，作为ESXi的一个虚拟机运行，如此，便可以有更佳灵活的路由组织方式：<strong>双软路由</strong></p><ul><li><p>双软路由</p><ul><li>概念：由于目前各软路由系统分属不同的社群或公司，各自独立的发展导致目前不存在完美涵盖各种功能的路由系统，各系统各有所长，所以，在使用时可以结合使用，由于采用虚拟机方式安装，对于 主路由 和 旁路由 的物理区分不复存在，有的只是逻辑上的主次，有关于物理网口和虚拟网口的映射，以后单独讲解。需要注意的是，网卡直通对于虚拟机安装软路由系统是非常重要的，直通后基本不存在带宽损失。</li><li>搭配：本着取长补短的原则，目前采用的是比较成熟的方案之一，即使用 LEDE 做旁路路由，为的是其留学及禁广告插件；使用 iKuai 做主路由，为的是其 单线多拨 及可能用到的流控功能。虽然双软路由配置繁琐，但配置完成后基本无需改动，且能最大化的利用各系统的优势，提升网络使用体验。</li></ul></li><li><p>其他虚拟机<br>本质上，ESXi同桌面版的VMware是一个东西，即都可以虚拟出各种设备来安装各镜像文件，所以，在ESXi中支持安装Windows、Linux、Mac等等系统，且对于7200U来说，其本身双路由仍然是性能过剩的，这就允许我们可以安装更多的虚拟机来满足我们的需求，唯一需要注意的就是工控机上的内存要大一些，一般16G比较好。所以，重要的不是能不能安装，而是装了有什么用：</p><ul><li>Windows7：安装一个纯净版Win7可以满足大部分 挂机需求，例如直接迅雷挂机下载，或者是淘宝助手等需要挂机运行的软件，此外，Win7用作HTPC也不错，搭配 PLEX Server 可以摇身一变变为影音中心，从而充分利用7200U的性能进行编解码。总之，这就相当于一个免费的物理云主机，且硬盘够大、带宽够大、无流量限制，想想阿里云的相同配置的独立云主机，估计要 &gt; 1000 RMB/年 了。</li><li>Ubuntu：作为Linux系统的一种，其桌面操作性十分舒适，如果性能捉急，可以安装CentOS等Linux系统。对于Linux系统来说，可做的事情也非常多，比如搭建Gitlab、Web环境、搭建图床、编译软件等等作用，同样地，这也算一个配置超级豪华的独立云主机，如果买阿里云的，那估计要吃土了。</li><li>其他：目前只装了上述虚拟机，下一步想探索的是 Xmbcbuntu 系统，作为Kodi的主系统，不知其流媒体处理能力如何，准备安装一试。</li></ul></li></ul></li></ul><h4 id="附：当前设备清单"><a href="#附：当前设备清单" class="headerlink" title="附：当前设备清单"></a>附：当前设备清单</h4><ul><li><strong>安装设备</strong>：YANLING-SKUL6, 2 × i5-7200U 2.5GHz, 16GB RAM, 500GB SSD </li><li><strong>设备接口</strong>：6 × LAN, 4 × USB, COM, HDMI </li><li><strong>系统版本</strong>：（ESXi）VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01</li><li><strong>其他设施</strong>：普通双头网线一根，优盘一个，显示器+HDMI线+鼠标+键盘（有线即可） </li><li><strong>系统镜像</strong>：<ul><li>ESXI <a href="http://www.5sharing.com/m/view.php?aid=705" target="_blank" rel="external nofollow noopener noreferrer">网址</a>， <a href="https://downloads.dell.com/FOLDER04945360M/1/VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01.iso?uid=36824895-721d-4bb9-252b-e6808049e8d3&fn=VMware-VMvisor-Installer-6.7.0-8169922.x86_64-DellEMC_Customized-A01.iso" target="_blank" rel="external nofollow noopener noreferrer">文件</a> </li><li>iKuai <a href="https://www.ikuai8.com/component/download" target="_blank" rel="external nofollow noopener noreferrer">网址/选择ISO,64位</a>， <a href="https://www.ikuai8.com/download.php?n=/3.x/iso/iKuai8_x64_3.2.4_Build201907151220.iso" target="_blank" rel="external nofollow noopener noreferrer">文件</a></li><li>LEDE <a href="https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/" target="_blank" rel="external nofollow noopener noreferrer">网址/选择combined,vmdk</a>，  <a href="https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/openwrt-koolshare-mod-v2.31-r10822-50aa0525d1-x86-64-combined-squashfs.vmdk" target="_blank" rel="external nofollow noopener noreferrer">文件</a></li><li>Image Converter <a href="http://www.38hack.com/1894.html" target="_blank" rel="external nofollow noopener noreferrer">网址</a>， <a href="https://www.starwindsoftware.com/tmplink/starwindconverter.exe" target="_blank" rel="external nofollow noopener noreferrer">文件</a> </li></ul></li></ul><hr><p>关于 ESXi，LEDE + iKuai，以及 Win7 的安装及注意事项，会在今后单独进行详细讲解。 </p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
            <tag> Synology </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>功能强大的NAS云存储</title>
      <link href="/article/8d84.html"/>
      <url>/article/8d84.html</url>
      
        <content type="html"><![CDATA[<p>NAS，Network Attached Storage，直译是网络附属存储，但实际上就是一种网络存储器，一般常见的存储设备如3.5寸的机械硬盘（用于台式机）、2.5寸的机械硬盘（用于笔记本或移动硬盘）、固态硬盘、U盘等，各种类型的硬盘接口规格都不相同，有SATA、mSATA、PCI-E、mini-PCIE等等，目前都支持相互转接。</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dh5p391q14c9igi1pu51jrj6sqm.png" alt="image_1dh5p391q14c9igi1pu51jrj6sqm.png-790.9kB"></p><h3 id="初识NAS"><a href="#初识NAS" class="headerlink" title="初识NAS"></a>初识NAS</h3><p>需要强调的是，上述硬盘（存储器）通过硬件插槽或者传输线直接连到电脑主板、然后开机识别出硬盘空间这种流程，是一般存储器的使用方式，其要求硬盘和主机不能存在地理隔离（即便使用传输线也有距离限制），且这种情况下主机向外提供数据只能在上层应用中实现，这限制了设备的可扩展性和灵活性。网络存储器应运而生，其发展速度非常迅速，后期又伴随着硬件虚拟化技术的发展，衍生出了若干种网络传输协议（NFS、iSCSI等），对于家用NAS来说，主要使用NFS（还有SMB）。</p><p>为了提供相关服务（协议），NAS通常具备主控（主板）模块，其不再是单纯的硬盘堆叠（硬盘盒或硬盘架），而是对硬盘空间的有效组织，目前市面上存在包括FreeNAS（开源）和Synology的DSM（群晖的闭源系统）在内的多种NAS系统，商业化比较成功的厂家有Synology（群晖）、QNAP（威联通）等，其产品核心价值在于 主板 + 系统，硬件层面没有限制，故而允许通过第三方主板硬件刷入群晖系统来使用，通常这种机器称为“黑群晖”，在某些功能上有许多限制，后续可以通过相关操作进行“洗白”，这样可以用更强的硬件设备搭载群晖的系统从而获得更好的性价比（白群晖价格有相当一部分摊到了系统上），当然这是不正确的、盗版的行为，商用会被追究法律责任。支持正版从我做起。</p><h3 id="NAS的特点"><a href="#NAS的特点" class="headerlink" title="NAS的特点"></a>NAS的特点</h3><ul><li>有主（控）板，带有内存插槽、网卡网口、CPU、显卡（一般是集显）、USB等等</li><li>有若干盘位，一般最少是 2 盘位，插入3.5寸机械硬盘</li><li>基于多种网络协议，包括NFS、SMB等等，一根网线即可让任何位置的电脑通过网络访问硬盘空间</li><li>提供上层应用，包括多媒体的编码解码，进而可向外提供丰富的流媒体资源</li></ul><h3 id="NAS可能的日常使用场景"><a href="#NAS可能的日常使用场景" class="headerlink" title="NAS可能的日常使用场景"></a>NAS可能的日常使用场景</h3><h4 id="多媒体"><a href="#多媒体" class="headerlink" title="多媒体"></a>多媒体</h4><ul><li><strong>视频</strong>：NAS端（异地）下载，本地观看。例如身在学校内，每月流量有限，NAS在家中，家中宽带无限制，这时通过远程下载，可以在学校内观看经过编码后的视频流，一是借助家里的大带宽的高网速加速下载过程，二可以通过编解码后的多媒体资源会占用更小的空间（使用更少流量），而实质上的观看体验肉眼基本不可见。上述内容实现需要NAS端的带宽有足够大的上行，一般＞20Mbps即可。</li><li><strong>音频</strong>：可用作珍贵资源保存，同时也提供完备的音频在线解码服务，可以用类似QQ音乐的方式来访问NAS中的音频文件。</li><li><strong>图片</strong>：这是NAS的重要功能之一，也是群晖的重要功能之一，为此官方套件有两个是针对图片管理的。从我们使用智能手机、数码相机的第一天开始，我们的手机里、相机里就存满了我们的照片，如何管理是个大问题，一般我们直接存在电脑的某硬盘里就可以，但如果我们想随时随地翻看过去某一天的某张照片、或是在公网环境浏览我们的全部照片，那一般的保存就不够用了，需要专门的照片管理软件，在这里，群晖提供了丰富的照片管理软件，不仅可以很好的对图片进行重新组织；同时，也提供照片的对外发布服务。</li><li><strong>电子书</strong>：附加功能。Kindle重度用户会比较感兴趣，一般是依靠第三方的docker套件完成。</li></ul><h4 id="网盘系统"><a href="#网盘系统" class="headerlink" title="网盘系统"></a>网盘系统</h4><p>或者叫私有网盘（私有云）。目前，群晖可以快速搭建可道云（KodExplorer）基础版，基础版可道云已完全能够满足个人使用，使用上同115等云盘基本一样，只是所有文件均存储在NAS中，故名“私有云”。上述内容实现需要NAS端下行带宽要大，一般需要50Mbps以上。</p><h3 id="上述对应的实现方式"><a href="#上述对应的实现方式" class="headerlink" title="上述对应的实现方式"></a>上述对应的实现方式</h3><p>需注意：基于群晖的各功能可由以下几种方式提供：</p><ul><li><strong>官方随机套件</strong>（系统安装后的套件中心内默认列表）</li><li><strong>附加套件</strong>（同样在套件中心内，但需要手动添加第三方源，之后才能扫描到套件列表）</li><li><strong>docker应用</strong>（强大的功能！可搜素到99%的docker镜像并安装，但需注意要专门为群晖做过适配的镜像才能正常使用：一般必须得配置端口映射+存储空间的映射）</li><li><strong>Web Station自建应用</strong>（Web Station套件实际上是群晖提供的具有php + apache server/nginx + mysql 建站环境的套件，显而易见，其可以支持自定义的网站搭建。WordPress等Web应用均可搭建）</li><li><strong>Virtual Machine</strong>（利用群晖的虚拟机套件可安装Win7、XP等系统，作用等同于VMware或VritualBox）</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="多媒体-1"><a href="#多媒体-1" class="headerlink" title="多媒体"></a>多媒体</h4><ul><li><p><strong>视频</strong>： </p><ul><li>下载：<ul><li>BT资源下载：Download Station（官方套件）、thunder-xware（docker应用）、Transmission（docker应用）、qBittorrent（docker应用）。（一般用Download Station下载即可，若无下载速度则可能是种子原因）</li><li>百度网盘资源下载：baidupcs（docker应用）、CloudSync（官方同步套件，利用指定文件夹的同步进行下载）</li><li>人人影视：专职美剧英剧的字幕翻译、压制及发布，群晖上可使用 rrshare（docker应用）</li></ul></li><li>串流：可通过群晖自带的 Video Station 或者第三方PLEX（Server）实现。</li><li>客户端：手机应用（DS Video、Plex），电脑使用（DSV只能用Web页面访问，而Plex在Web之外还有独立的桌面应用）</li></ul></li><li><p><strong>音频</strong>：</p><ul><li>下载：除了以文件形式的下载外（BT下载或百度网盘下载），还未发现专门的音乐下载应用，目前采用的方式是电脑用QQ音乐、网易云音乐等下载音乐文件，然后上传到群晖NAS中，一般音乐使用场景较少，不过可以当做稀有资源的备份（越来越多的歌曲正在下架）</li><li>串流：使用官方套件 Audio Station 或者第三方PLEX实现</li><li>客户端：手机应用（DS Audio、PLEX），电脑使用（对应的Web页面）</li></ul></li><li><p><strong>图片（照片）</strong>：</p><ul><li>一般由本地上传，系个人拍照、摄影、截图等等</li><li>组织管理：<ul><li>Photo Station，官方套件，提供时间线、地图坐标等视图，占用资源较小，功能较单一；</li><li>Moments，官方套件，已被集成在Drive（官方网盘套件）中，提供主题分析、地点分类等功能，占用资源较多，功能丰富，若使用Drive则推荐使用Moments，否则可只用Photo Station</li><li>PLEX，主要用于媒体资源管理，同样支持照片的管理</li></ul></li><li>客户端：前两者对应官方套件，后者是PLEX客户端，三者均可通过Web页面访问</li></ul></li><li><p><strong>电子书（Kindle）</strong>：</p><ul><li>最近购入了Kindle，有必要说下电子书的下载，采用 my-calibre-webserver（docker应用）可自建一个图书管理系统，其带有电子书推送功能，可以将指定书目推送到Kindle上。 </li></ul></li></ul><h4 id="网盘系统-1"><a href="#网盘系统-1" class="headerlink" title="网盘系统"></a>网盘系统</h4><ul><li><strong>Drive</strong>：群晖官方套件，这是同其他官方套件（Moments、CloudSync等）高度耦合的一款网盘服务套件，其可以实现文件的上传、下载、文档的多人协作、版本控制等等功能，功能丰富，但占用资源较大，版本控制也容易产生大量垃圾文件，因此我并没有使用该套件（对应的我也没用Moments）。</li><li><strong>KodExplorer</strong>：可道云（第三方）套件，该套件为用户搭建了一个基础版的可道云服务，可道云在使用上同一般网盘无异，同时提供简洁的Kod云手机APP应用，本质上是利用Web Station搭建的一个Web应用，故而相对独立，占用资源也较少，因此我使用了该套件搭建网盘系统。</li></ul><h4 id="附：我的应用"><a href="#附：我的应用" class="headerlink" title="附：我的应用"></a>附：我的应用</h4><p>下面是目前我使用的全部套件/应用 → 以及对应的手机端应用</p><ul><li>远程管理<ul><li>DSM → Web</li><li>WebSSH → Web</li></ul></li><li>文本（简单上传下载）<ul><li>File Station → DS File APP</li><li>FTP → WinSCP（PC）</li></ul></li><li>音乐视频（解码、在线播放）<ul><li>Video Station → DS Video APP</li><li>Audio Station → DS Audio APP</li><li>PLEX Server → PLEX APP</li></ul></li><li>图片照片（管理、重新组织）<ul><li>Photo Station → DS Photo APP</li><li>Moments → Moments APP（我没用）</li></ul></li><li>上层应用<ul><li>文件的上传下载/云盘映射<ul><li>Webdev → 服务</li><li>Cloud Sync → DSM内操作</li><li>KodExplore → KodExplore APP</li></ul></li><li>电影的下载<ul><li>迅雷远程 → Web</li><li>人人Web版 → Web</li><li>百度网盘Web版 → Web</li><li>Download Station → DS Get APP</li></ul></li><li>电子书的下载<ul><li>kindle图书管理Web版  → Web</li></ul></li><li>网站环境<ul><li>Nginx → 服务</li><li>Apache Server → 服务</li><li>Tomcat → 服务</li><li>PHP 5-7 → 服务</li></ul></li><li>扩展容器<ul><li>第三方套件源</li><li>Virtual Machine → DSM内操作</li><li>Docker → DSM内操作</li></ul></li></ul></li></ul><p>承载以上内容的设备的各项基本信息：</p><ul><li><strong>产品型号</strong>：DS418play</li><li><strong>CPU</strong>：Intel Celeron J3355, 2GHz × 2</li><li><strong>内存</strong>：6 GB</li><li><strong>DSM版本</strong>：DSM 6.2.1-23824 Update 6</li></ul><hr><p>弄清楚上述应用的使用方式后，还有最最最最重要的一点，即外网访问。对于绝大多数家庭用户，其NAS均放在路由器之后，即NAS处于家庭子网（局域网）内，正常是无法在公网环境中直接访问到的。如何做？自然地想到公网环境应该可以直接访问到家中的路由器，但真的访问的到吗？关于家庭网络的若干问题，请参见下一篇文章内容。</p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
            <tag> Synology </tag>
            
            <tag> HTPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端快速入门之概述</title>
      <link href="/article/f8f5.html"/>
      <url>/article/f8f5.html</url>
      
        <content type="html"><![CDATA[<p>以下是对（前端）可视化工作的并不系统的总结，<strong>新手向</strong>，主要是想说一下前端如何组成、功能如何实现、资源如何请求，进而说到数据如何显示，并在最后列举了一些十分重要的参考资料（非常重要）。</p><a id="more"></a><h3 id="前言：从百度说起"><a href="#前言：从百度说起" class="headerlink" title="前言：从百度说起"></a>前言：从百度说起</h3><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><blockquote><p>点击百度搜索框显示出搜索结果</p></blockquote><p>涉及前端的三大要素，从初级到高级的应用都可以由其完成，三者即：</p><ul><li>HTML(5)<br>// 页面所有呈现元素（按钮、输入框、图片…）的“附着点”，所有页面可见元素都有对应的html标签，而动态交互的事件（JS完成）实际就是绑定在某些html标签上，例如按钮的点击。</li><li>CSS<br>// 页面呈现元素的所有样式均可以由CSS进行控制，即文字的颜色、字号、间距，区块的排列等均由CSS指定，本质上仍然是对html标签的控制，只有该html标签具有某一属性，这时才能通过CSS对其进行控制，例如，table标签具有width属性，所以可以通过CSS对width进行赋值，来达到控制table宽度的目的。</li><li>JavaScript<br>// 页面所有的（动态）事件，均由JavaScript绑定到html标签上，并由JavaScript完成整个交互动作的执行，包括鼠标事件、前后端的请求事件等等。</li></ul><p>分析上述例子中的词语：</p><ul><li>点击：由JavaScript完成，会触发一个request请求</li><li>百度搜索框：本质是input标签，通过CSS样式修饰为用户所见的样子</li><li>显示搜索结果：先前的请求到达后台后，经过处理返回查询结果（response），注意此刻的结果一般是一些数据（字符串），并非带样式（CSS）的html标签，所以还需要进行转换，这个将数据转换为html代码的过程仍然由JavaScript来完成。</li></ul><h4 id="已知的发展（局部）"><a href="#已知的发展（局部）" class="headerlink" title="已知的发展（局部）"></a>已知的发展（局部）</h4><ul><li>HTML -&gt; HTML5</li><li>CSS -&gt; Sass, Less, Stylus</li><li>JavaScript -&gt; jQuery -&gt; Vue/Node -&gt; 已不单单是前端语言</li></ul><h4 id="如何学习（路线图）"><a href="#如何学习（路线图）" class="headerlink" title="如何学习（路线图）"></a>如何学习（路线图）</h4><p>先易后难；先实践，后理论；</p><ul><li>三要素的简单组合（易）<ul><li>学习HTML的块/div、段落/p、表格/table、按钮/button等基本标签，并熟悉其具有的属性</li><li>学习CSS的盒模型，理解边距/padding、间隔/margin、浮动方式/float等的控制命令</li><li>学习原生JavaScript的选择器、事件绑定、资源请求等（之后）</li><li>增强版本<ul><li>添加资源请求（<strong>数据的读取</strong>）<ul><li>form</li><li>ajax(jQuery)</li><li>get(jQuery)</li><li>getjson(jQuery)</li><li>websocket</li></ul></li></ul></li><li>结合IDE进行开发<ul><li>WebStorm/IDEA</li></ul></li></ul></li></ul><h3 id="数据的展示"><a href="#数据的展示" class="headerlink" title="数据的展示"></a>数据的展示</h3><h4 id="图形绘制"><a href="#图形绘制" class="headerlink" title="图形绘制"></a>图形绘制</h4><ul><li>Canvas<br>//画布标签/容器，显示元素（点线面）的载体，本身有构造点线面的语法规则，嵌入HTML内需要放在Canvas标签内</li><li>SVG<br>//本身是一种可视标签，可以直接嵌入在HTML内</li><li>绘图库/引擎<ul><li>D3.js //高自定义图形</li><li>Echats.js //图表+地图(baidu地图)</li><li>Highcharts.js //图表绘制</li><li>Tree.js(WebGL,3D) //3d绘制引擎</li><li>Mapbox.js(Map) //专注地图</li></ul></li></ul><h4 id="后端操作"><a href="#后端操作" class="headerlink" title="后端操作"></a>后端操作</h4><ul><li>Node.js<ul><li>fs //文件操作</li><li>child_process //线程管理</li><li>body-parser //请求解析</li><li>nodejs-websocket //ws协议</li><li>express //路由请求拦截</li></ul></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="其他细节内容"><a href="#其他细节内容" class="headerlink" title="其他细节内容"></a>其他细节内容</h4><ul><li>前后端的跨域资源访问</li><li>前端的异步执行顺序控制<br>主要体现在ajax请求方式（如$.ajax()）和同级代码之间的执行先后顺序，一般可将ajax请求方式设为同步执行即可解决，在包含复杂的数据请求时尤其要注意这一隐含问题。</li><li>浏览器debug技巧（一般使用）<ul><li>F12/network 看加载的请求</li><li>F12/console 看加载出现的异常（info、error、warning）</li><li>F12/Elements/Style 看样式（盒模型）</li></ul></li><li>Chrome调试插件（生产工具）<ul><li>测试WebAPI/请求 Restlet、Postman</li><li>清缓存刷新 Clearcache</li><li>其他 <a href="https://chrome.google.com/webstore/category/extensions" target="_blank" rel="external nofollow noopener noreferrer">网上应用商店</a></li></ul></li><li>前段环境搭建<ul><li>Tomacat -&gt; （webapp文件夹内）</li><li>Apache -&gt; （www文件夹内）</li><li>IDEA -&gt; （内嵌服务器，一般是tomcat）</li><li>WebStorm -&gt; （同上）</li><li>Node -&gt; （http-server等）</li></ul></li><li>请求资源的方式（常见的）<ul><li>servlet方式<br>//前端发送请求url，后端拦截匹配对应后台处理，完成后返回结果（全局、需刷新）</li><li>ajax方式<br>//流程同上，但返回结果被控制在提交请求的ajax域内（局部结果，无刷新），可在不全局刷新页面的情况下对局部内容进行更新。其有各种实现方式：原生方式、$.ajax()、$.get()、$.getjson()等等。</li><li>websocket方式<br>//socket作为后端代码常用的传输手段，其实是一种实现了给定规范（n次握手）的代码接口<ul><li>优点<br>//通信双方一直保持连接（长连接），在连通情况下双方可以任意的收发消息</li><li>实现方式<br>//前端为固定的调用方式，后端有多种实现形式（Java、Node），例如Node的websocket</li><li>意义<br>//真正意义上的长连接，在此之前一般只能通过ajax轮询来实现；多次轮询只是多个请求返回各时间点的结果（前端主动发起，后台被动相应），长连接则是建立连接后，后台主动推送（生产出一组数据就发送一组），前端被动接收。符合朴素的设计直觉（前端专职显示/View，不应存在过多请求），优化整体前后端响应性能。</li><li>应用场景（刷新率高）<br>//前端仪表盘、实时折线等、图形的连续变化等</li></ul></li></ul></li></ul><h4 id="待补充…"><a href="#待补充…" class="headerlink" title="待补充…"></a>待补充…</h4><h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><h4 id="引导资源"><a href="#引导资源" class="headerlink" title="引导资源"></a>引导资源</h4><ul><li><p>【W3Cschool前端路线图】<a href="https://www.cnblogs.com/w3cschool/p/6527337.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>非常全面的知识汇总，基础弱的可以详细看下这个</p></li><li><p>【菜鸟教程的WEB开发路线图】<a href="https://www.runoob.com/w3cnote/web-developer-learn-path.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>这里是覆盖前后端的学习路线，思维导图形式，可以了解下有个大致概念</p></li><li><p>【可视化学习路线图】 <a href="https://old.cz5h.com/article/2019-7-11%20%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></p></li></ul><p><strong>强力推荐，内容不多，但可以说明白可视化到底在做什么，以及如何做</strong></p><ul><li>【JS的DOM操作】<a href="https://blog.csdn.net/thorLei/article/details/49127403" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【JS的选择器】<a href="https://www.cnblogs.com/codingcc1/p/11073083.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【JS的AJAX请求】<a href="https://www.cnblogs.com/Scar007/p/7607392.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>看完这几个JavaScript的操作就会一大半了</li></ul><ul><li>【Node路线】<a href="https://www.cnblogs.com/callmeguxi/p/6879688.html" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>Node还是非常强大的，夸张一点可以基本实现现有后台的所有功能</li></ul><h4 id="知识点在线查询-在线练习-测试"><a href="#知识点在线查询-在线练习-测试" class="headerlink" title="知识点在线查询+在线练习/测试"></a>知识点在线查询+在线练习/测试</h4><ul><li>【W3CSCHOOL】<a href="http://www.w3school.com.cn/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【菜鸟教程】<a href="https://www.runoob.com" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li></ul><h4 id="快速测试"><a href="#快速测试" class="headerlink" title="快速测试"></a>快速测试</h4><ul><li><p>【引用库】<a href="https://www.bootcdn.cn/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>有网络资源就引用网络资源，一些大库可以在上述网站搜索，直接引用网络资源，省去本地保存的多余操作</p></li><li><p>【构建Node环境】<a href="https://www.npmjs.com/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a><br>需要后端支持时可以用node迅速进行搭建，使用上述网站查询相应的包</p></li><li><p>【官方文档】<br>使用某JS库（例如D3、Echarts）的最好方法没有之一，就是查看官方文档，基本能涵盖八成所需内容</p></li></ul><h4 id="debug常用网站"><a href="#debug常用网站" class="headerlink" title="debug常用网站"></a>debug常用网站</h4><ul><li>【csdn、cnblog、github issues】</li><li>【V2EX】<a href="https://www.v2ex.com/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【StackOverflow】<a href="https://stackoverflow.com/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【OutOfMemory】<a href="http://outofmemory.cn/#csdn" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li><li>【SegmentFault】<a href="https://segmentfault.com/" target="_blank" rel="external nofollow noopener noreferrer">&gt;&gt;LINK&lt;&lt;</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 可视化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据可视化学习路线</title>
      <link href="/article/69dc.html"/>
      <url>/article/69dc.html</url>
      
        <content type="html"><![CDATA[<h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>有幸看到了这篇关于数据可视化学习的指导文章，由于原作链接访问异常，只得从百度快照中看到原文，所以这里搬运过来，特此声明本文系【转载】，在此感谢原作者，以下为原文正文（略有删减）。</p><a id="more"></a><blockquote><p>原作者: 张迪 2018年01月03日 于 张迪的blog 发表<br><a href="http://www.storagelab.org.cn/zhangdi/2018/01/03/%e5%8f%af%e8%a7%86%e5%8c%96%e7%9b%b8%e5%85%b3%e6%af%95%e4%b8%9a%e8%ae%be%e8%ae%a1%e5%ad%a6%e4%b9%a0%e8%b7%af%e7%ba%bf%e5%9b%be/" target="_blank" rel="external nofollow noopener noreferrer">原文链接</a></p></blockquote><p>本文将从可视化设计、数据分析、技术实现三个角度来阐述要学习的内容。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dg9uuqnji8f198l1g8u18ls12f89.png" alt="image_1dg9uuqnji8f198l1g8u18ls12f89.png-126kB"><br><strong>（*图中的chinaviz应为chinavis）</strong></p><h4 id="可视化设计"><a href="#可视化设计" class="headerlink" title="可视化设计"></a>可视化设计</h4><p>首先是可视化设计。可视化设计是指数据可视化过程中的表达方式，是我们最终设计的软件的灵魂。然而这个灵魂不可能一开始就得到。需要我们在分析前人工作的基础上，通过不断模仿和摸索才能获得。具体的说，可分为如下几步进行：</p><ul><li>收集资料：从chinavis官网上收集所有挑战赛获奖作品、通过百度学术、知网等平台上下载相关论文。</li><li>总结：写多篇竞品分析类文章：总结挑战赛获奖作品中所用的可视化设计、分析方法和采用的技术。这些可视化设计、分析方法和技术必须能找到对应的论文。</li><li>提炼：以思维导图的形式归纳这几篇文章的核心内容。并得到：哪些可视化设计、分析方法和技术是必须的，哪些是可选的，哪些是可以改进的。</li><li>分析探讨：将提炼出的结果，跟其他同学和老师进行探讨。从而形成设计方案。</li><li>形成设计方案：将设计方案，用图片+文字的方式加以描述。</li></ul><h4 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h4><p>然而可视化设计不能独自进行，在总结、提炼、分析探讨的过程中，必须不断地与数据分析过程结合，从而验证方法的有效性。数据分析与可视分析通常是循环进行，互为补充，具体分为如下几个步骤：</p><ul><li>收集资料：从chinavis官网上下载数据集，以及从其他数据源上获取数据。</li><li>数据概览：要从数据集的描述信息中了解大致内容（例如，字段的大致内容和数据类型，表之间的关联关系等）然后确保可以通过商业数据可视化软件如tableau、Excel、Gephi、cytoscape将之打开。</li><li>经典复现：试着用商业数据可视化软件复现获奖作品和经典论文中的可视化设计。从而确认</li><li>哪些可视化设计、分析方法和技术是必须的，哪些是可选的，哪些是可以改进的。</li><li>摸索试错：尝试用依赖自己的想法，使用商业数据可视化软件展示数据中的规律。从而帮助形成可视化设计方案。</li><li>实践检验：把最后实现的可视分析软件，套用真实数据进行检验，确保其有可用性。</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a>技术实现</h4><p>为了支撑以上的可视化设计与数据分析，还需要学生掌握一些基础技术。这些基础技术包含两大类，其一是商业可视化软件的使用，这个比较简单，要求2周内可以实现示例（例如tableau可以轻松地用它是现实教程示例）。其二是web开发技术。这个比较复杂。每个同学的侧重点各有不同：</p><ul><li>编程能力比较好的同学：直接实现web应用的基础框架。通过这个基础框架实现一个API，该API可以从数据库读取数据，然后封装成Json格式发送到前端即可。API的设计风格建议restful。至于具体采用什么技术栈，看自己的特长而定。</li><li>对于编程能力比较弱的同学：先学习web前端基础，要求必须学会使用HTML/CSS/JQuery和Bootstrap构建网页。为了保证学习进度和成效，推荐去Github上追这个最火的编程学习项目：freecodecamp。这个项目课程设置得很平滑，既有循序渐进的基础知识，又有自由发挥的小项目，一边实践一边学习，更打游戏闯关一样的体验，比看教学视频、w3cshool之类强的多。</li></ul><p>此外，所有同学都要学习前端数据可视化编程的知识，具体的说就是要掌握百度echarts类库的实现一般可视化图例的方法，和使用D3js类库实现自定义可视化图例的方法。对于某些选择了特殊题目的同学来说，webGL的threejs类库也是必须了解的。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dg9v5jhs149v1dds1r9a1n3p4ptm.png" alt="image_1dg9v5jhs149v1dds1r9a1n3p4ptm.png-166kB"></p><p>考虑可视化整套流程下来要学习的内容较多、较杂，因此定时的知识总结和强力的工作监督必不可少。故而最好在学习过程中每周总结一篇博客，要求有图有真相。内容可以是最近学习的软件或JS库的使用方法总结、技术开发总结、数据分析说明、可视化设计案例总结等等。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 可视化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为什么家里要有公网IP</title>
      <link href="/article/abd.html"/>
      <url>/article/abd.html</url>
      
        <content type="html"><![CDATA[<p>最近家里换了宽带，并且在我的强烈要求下选择了能提供公网IP的联通宽带，当然这里是动态公网IP，期间，包括光猫的桥接+路由器拨号，都已经做完，基本上到这里为止家里的网络环境就是外部可访问的了，从此可以抛弃内网穿透，直连站起来重新做人了。为什么要折腾外部访问呢，因为我把群晖放家里了，自然是想随时随地访问一下子的，现在有了公网IP，虽然是动态的，但只需在群晖的DDNS页面配置下，就可以使用域名进行访问了，非常的方便和舒服，速度快的飞起来。欢迎访问ZoneCloud -&gt; <a href="http://asus.myds.me:5000/" target="_blank" rel="external nofollow noopener noreferrer">http://asus.myds.me:5000/</a></p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df129t0skup15hqvvtlga1ls1m.png" alt="image_1df129t0skup15hqvvtlga1ls1m.png-97.9kB"></p><p>下面就安装宽带的注意事项做一下记录：</p><h3 id="宽带商的选择"><a href="#宽带商的选择" class="headerlink" title="宽带商的选择"></a>宽带商的选择</h3><p>一般只有三种选择，联通、移动和电信，其中移动手中有的IP资源是最少的，这是事实，但对于宽带是否提供（动态）公网IP，这在不同地域或有差别，但移动肯定是最不靠谱的一家；剩下的两家没太听到过槽点，所以酌情看套餐办理吧。</p><h3 id="安装过程的操作"><a href="#安装过程的操作" class="headerlink" title="安装过程的操作"></a>安装过程的操作</h3><p>一般装宽带是得安装师傅本身到家里来装的，且现在基本是光纤入户，所以“光猫”是必不可少的一个硬件，主要完成的是光信号转换的任务（部分高端路由器也可以完成光信号转换）。一般而言，正常的上网流程是光纤入户后，在光猫处随机完成拨号上网，这种方式的缺点是：</p><p>光猫作为家庭网络同外部网络沟通的最后一层，端口转发工作应在最外层即这一层完成，在此处，光猫得完成端口转发的工作，但要命的是光猫并不是路由器，无法替代路由工作，家里的设备总归要通过路由器汇集。这时问题来了，光猫拨号的前提下，路由器变为了二级路由，端口映射会变得非常复杂，DMZ+端口映射或许可以解决问题，但并不完美。</p><p>真正方便快捷的方式是<strong>在安装时让师傅改光猫为桥接</strong>，这样光猫的功能退化为单一的光信号转换，而拨号、端口映射等任务全部交给路由器完成（<strong>稍高端的路由器均可支持</strong>），此时的网络结构，虽然光猫仍然是最前沿的阵地，但实际对网路信号而言路由器成了排头兵，所有的内外交换数据均通过路由器协调、中转，光猫只是开闸放水不加以任何干涉。</p><p>此时，在路由器上设置的端口转发，会直接作用到IP上，即整个环境中只有一级路由，非常清晰和方便，类似群晖这类存储系统的外部访问，只需在路由上配置一连串的端口映射，即可以通过<strong>IP+端口</strong>的形式在公网环境中进行访问了。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df4djnaubjpjrg1jn91cvnnbs9.png" alt="image_1df4djnaubjpjrg1jn91cvnnbs9.png-379.8kB"></p><h3 id="关于动态公网IP的变动"><a href="#关于动态公网IP的变动" class="headerlink" title="关于动态公网IP的变动"></a>关于动态公网IP的变动</h3><p>固定公网IP的宽带业务一般叫“专线”，属于企业宽带的范畴，动辄月付几百大洋，和普通家用宽带年付几百块相比要贵的多得多，所以，这里讨论的都是基于动态公网IP的各种操作。</p><p>顾名思义，动态公网IP的IP地址是会变的，但变前和变后均为公网IP，变动的时机往往是重新拨号上网后，这和路由器的动态分配IP是一样的，每次断开重连都会回收原有IP并分配新的IP，但在分配后，设备会一直独占此IP，因此如果不是经常断电重启，那么动态公网IP也可以看作是短时的固定IP。</p><p>但是，可能变化的IP对于外部访问是非常困扰的，例如你跟朋友刚分享了自己看的电影，结果下午你朋友通过IP就访问不到了（可能是经历了路由器重新拨号），杜绝这一现象的手段就是，将多变的IP绑定到单一固定的域名上，这样，在访问该域名时，即会解析到当前的IP（IP同域名之间的绑定关系会一直更新），整个上述过程即叫做<strong>DDNS</strong>，即动态域名解析。</p><p>相比于域名解析，这里的动态体现在域名映射的IP地址不固定，而是变化的，而对于域名同IP的映射的更新，是群晖提供的DDNS功能中的一部分。12即，除了群晖（必须为白群）提空的DDS服务之外，使用阿里云等DNS域名解析服务也能完成此功能，只是可能需要自己来实现“动态绑定”的功能。</p><hr><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>暂时写到这里，换了宽带只是万里长征第一步，只是，原来可能通过FRP内网穿透来访问的东西（非常慢），现在直接访问就行了，现在一步顶原来十步，果然是科技改变生活。关于其他的各种公网IP具备的或者是带来的功能及玩法，在以后有时间在写！</p><h3 id="补充一：使用人人影视Web版来批量下载剧集"><a href="#补充一：使用人人影视Web版来批量下载剧集" class="headerlink" title="补充一：使用人人影视Web版来批量下载剧集"></a>补充一：使用人人影视Web版来批量下载剧集</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df4dvd9914s01dglqg71sc75cqm.png" alt="image_1df4dvd9914s01dglqg71sc75cqm.png-84.6kB"></p><p>这里采用的是在镜像库中评价最好的<code>oldiy/rrshare64</code>（第一个），使用方式很简单，在注册表找到并选中点击下载，在映像中能够找到它，然后双击可以弹出设置页面，初始可以不进行配置，直接点击下一步到最后，之后docker镜像会自动启动，然后在容器中就可以看到它了。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df4efrc3patd03hpd1sd41jq13.png" alt="image_1df4efrc3patd03hpd1sd41jq13.png-136.9kB"></p><p>对该镜像的配置需要首先停止其运行，然后点击上方的<code>编辑</code>按钮即可进入配置页，<strong>重中之重是对“卷”的配置</strong>，这个直接关系到下载文件所在的位置。如上图红圈所示的路径和配置页是一致的，这里要注意：</p><ul><li>左侧的<code>文件/文件夹</code> 对应群晖中文件系统的路径（<strong>必须是FileStation可见的路径</strong>）</li><li>右侧的<code>装在路径</code> 对应Web页面的设置中的下载路径（默认就是<strong>/opt/work/store</strong>）</li></ul><p>一定要注意对应关系，在这个地方浪费了好多时间。上述内容需要在配置页的“卷”这页，手动新建一个并配置（<strong>默认是空的，下载文件会找不到</strong>）</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df4errtmms8bnh2h109k5ch1s.png" alt="image_1df4errtmms8bnh2h109k5ch1s.png-57.2kB"></p><p>上述配置过程结束后整个配置过程就完成了，然后就是使用人人Web端进行批量下载了，网站非常易用，下载页很给力，经过路径配置后，可以在<code>FileStation</code>中找到对应的文件，可以把上级文件夹绑定到<code>Plex</code>或者<code>DSVideo</code>的视频列表中，这样就可以下载转码一条龙搞定了！</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1df4f385t1rnie1jmd7fpo14lq29.png" alt="image_1df4f385t1rnie1jmd7fpo14lq29.png-129kB"></p>]]></content>
      
      
      <categories>
          
          <category> 建站组网 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 组网 </tag>
            
            <tag> 路由 </tag>
            
            <tag> Synology </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSC公派读博申请之经验</title>
      <link href="/article/bdbd.html"/>
      <url>/article/bdbd.html</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考。本文已整理发布到知乎专栏，这里的信息可能时过时的，所以如需阅读请前往我的知乎专栏阅读最新更新的版本，此处仅作备份。</strong></p></blockquote><a id="more"></a><btns rounded grid5><a href="https://www.csc.edu.cn" target="_blank" rel="external nofollow noopener noreferrer"><i class="fas fa-book-open"></i>官网|公派留学基金委</a><a href="https://zhuanlan.zhihu.com/cscer" target="_blank" rel="external nofollow noopener noreferrer"><i class="fas fa-book-open"></i>专栏|关于CSC的一切</a><a href="https://zhuanlan.zhihu.com/p/107347132" target="_blank" rel="external nofollow noopener noreferrer"><i class="fas fa-book-open"></i>文章|CSC申请经验</a><a href="https://zhuanlan.zhihu.com/p/107347132" target="_blank" rel="external nofollow noopener noreferrer"><i class="fas fa-book-open"></i>文章|CSC填报指南</a><a href="https://zhuanlan.zhihu.com/p/107347132" target="_blank" rel="external nofollow noopener noreferrer"><i class="fas fa-book-open"></i>工具|填报文字统计</a></btns><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a><strong>写在前面</strong></h3><p>2019 年的公派留学申请已经结束，长达半年之久的长跑戛然而止，这其中伴随的辛酸、不安、迷茫、无助，或许只有自己能体会，这一路走来自己最大的收获或许就是苦中作乐的能力了，如何调整心态、如何缓解压力，这都是对我今后很长一段时间大有裨益的经验和财富；当然，台面上的能力也得到了提升，和导师沟通、和外导沟通、和辅导员沟通、和国际处老师沟通、和口语陪练沟通、和自己沟通，总结这个总结那个，审视自己确定研究方向等等等等。不善言谈的我（虽然现在依旧）完成这一大圈事情，还是值得小骄傲一下的，但写这些文字时，我是完全没什么激动的感觉了，或许事情经历多了，人就变得麻木了，但也可能这在别人眼里是优点呢 ?.?</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhgamar4lmg16ugcdg193tbuf19.png" alt="image_1dhgamar4lmg16ugcdg193tbuf19.png-910.6kB"></p><p>话不多说，下面以申请2020年的CSC攻读博士项目为例（申请项目为“高水平大学公派研究生项目”，共计 10000 人，攻读博士名额 2500 人），在申请过程中可能的关键的阶段如下：</p><h3 id="准备阶段"><a href="#准备阶段" class="headerlink" title="准备阶段"></a><strong>准备阶段</strong></h3><h4 id="首先明确必须搞定的材料"><a href="#首先明确必须搞定的材料" class="headerlink" title="首先明确必须搞定的材料"></a><strong>首先明确必须搞定的材料</strong></h4><p><strong>1. 套磁材料（联系国外导师）</strong></p><ul><li>个人简历（CV）</li><li>成绩单英文扫描件（本+硕）</li><li>第一封套磁信（表明意向）</li><li>对自己已有成果的梳理，没有明确的材料要求，主要是为了应对可能的对方导师对这方面的发问！</li></ul><p><strong>2. 语言（可与联系导师一起进行）</strong><br>以下条件满足其一即可，但强烈推荐要考一个托福或雅思成绩，不然CSC这里是通过了，但外校那里还是没有说服力的，尽量不要用最后的语言证明的形式，风险较大。（详见<a href="https://www.csc.edu.cn/article/1410" target="_blank" rel="external nofollow noopener noreferrer">选派办法</a>）</p><ul><li>外语专业本科（含）以上毕业（专业语种应与留学目的国使用语种一致）。</li><li>近十年内曾在同一语种国家留学一学年（8-12个月）或连续工作一年（含）以上。</li><li>参加“全国外语水平考试”（WSK）并达到合格标准。</li><li>参加雅思（学术类）、托福、德、法、意、西、日、韩语水平考试，成绩达到以下标准：雅思6.5分，托福（IBT）95分，德、法、意、西语达到欧洲统一语言参考框架（CECRL）的B2级，日语达到二级（N2），韩语达到TOPIK4级。</li><li>曾在教育部指定出国留学培训部参加相关语种培训并获得结业证书（英语为高级班，其他语种为中级班）。</li><li>通过国外拟留学单位组织的面试、考试等方式达到其语言要求。应在外方入学通知书（正式邀请信）中注明或单独出具证明。</li></ul><h4 id="暑假期间（2019-7-9）"><a href="#暑假期间（2019-7-9）" class="headerlink" title="暑假期间（2019.7-9）"></a><strong>暑假期间（2019.7-9）</strong></h4><ul><li><p><strong>学英语</strong></p><ul><li>暑假期间时间充足，视自己英语水平来决定要不要报个辅导班（非常贵！），如果是考雅思，我的建议：<ul><li>剑桥雅思黑皮书，6-14（不知道到第几本了，到最新的一本）要基本浏览完一遍，能做完一遍是最好的，但做不完也没事，尽量看一遍，尤其是作文，看答案也要看完一遍；</li><li>最好是专项练习，不建议直接做套题，本身雅思考试就不是连贯的，两次收发卷子，练习专项往往会有更好的做题节奏；</li><li>听力的练习做剑雅的就可以，配合 小站雅思APP，吧错误的题目看明白；</li><li>阅读也做简雅就OK，同样是使用 小站雅思，可以有详细的解析；</li><li>写作是易翻车的部分，这部分可以看 顾北家的作文，但无论看谁的，最后总归是自己写，还是得靠自己的思路，尤其要注意英语行文的逻辑性；</li><li>口语是最最不稳定的部分了，因为是人为打分，主观因素非常大，我们能做的就是尽量不要让考官感到异样，不要背素材、不要停顿、不要泛泛而谈，要具象，老外思维只能理解这么多；推荐使用淘宝的 同桌英语，一般是东南亚的留学生陪练，三四十块钱一节课/一小时，具体是练习题目还是对话练习得和陪练沟通，上课就是一对一，用Zoom共享屏幕，总结对话时的问题；考前连续练习个两周，会对语感和语速有非常大的提升，口语不是很强的强烈建议试一下。</li></ul></li></ul></li><li><p><strong>检索、确定导师</strong><br>这个阶段不一定非要到发邮件的地步，但要确定下可能的意向导师人选，这是个漫长的过程，可能要通过读论文、查询会议网站等等方法来找到一些相关领域的大佬，然后再筛选出合适自己的人选，然后再确定这些人是否在职（有的是会退休的），然后找到邮箱或联系方式备用，结合所在学校的 四大榜 排名做个排序，最后形成一个意向导师列表（这个列表已经综合了学校实力等等因素）。待到9月份开学，就可以逐个发送套磁信了。</p></li></ul><p>注意：这个导师人数最好不超过 20 人，学校最好是分散开（一人一校最好了），针对性的发送套磁邮件，不要海投，每间隔三天发一封，同一时段内沟通导师数量控制在三人内，如果这个拒了再发下一封。</p><h3 id="找导师阶段（2019-9-12）"><a href="#找导师阶段（2019-9-12）" class="headerlink" title="找导师阶段（2019.9-12）"></a><strong>找导师阶段（2019.9-12）</strong></h3><h4 id="下半学期开始"><a href="#下半学期开始" class="headerlink" title="下半学期开始"></a><strong>下半学期开始</strong></h4><p>集中套磁（找导师），新学期开始就要正式找导师了，按上述提到的规则，可以一直套磁到11月，时间充裕，连续套两三个月基本就成了，关于如何套磁，怎么写邮件，可以关注小木中的帖子，有非常多经验贴，我的建议：</p><ul><li>第一封邮件就附上成绩单，这样拒绝也拒绝的干脆些，避免无用的沟通</li><li>有推荐信（英文，和提交的推荐信不是一回事）的附上推荐信</li><li>附上自己的成果（论文等）</li><li>要说明自己可以申请CSC，关于中国政府奖学金（CSC奖学金的英文名）这些年早就被人熟知了，如果不是对申全奖有执念，那么不妨写上这句话，往往会大大提高老师接收的可能。</li></ul><h4 id="尽快确定人选"><a href="#尽快确定人选" class="headerlink" title="尽快确定人选"></a><strong>尽快确定人选</strong></h4><p>尽量在年底确定导师人选，确定的意思是对方同意发出邀请信即可，不需要年底就拿到，可以年后继续讨论研究计划，年后再发邀请信，但总之是要确定下一个固定的接收导师。元旦后马上是过年，过年回来就是三月了，时间非常紧张！此外，有多个 offer 的申请者最好在年前就确定跟不跟，不要等到年后申请前的这一小段时间再确定，这会让外校导师非常难受。</p><h3 id="填报阶段（2020-2-3）"><a href="#填报阶段（2020-2-3）" class="headerlink" title="填报阶段（2020.2-3）"></a><strong>填报阶段（2020.2-3）</strong></h3><p>这一阶段主要是填报<a href="http://apply.csc.edu.cn" target="_blank" rel="external nofollow noopener noreferrer">网上报名系统</a>，主要工作量在于四个文本框的填写，原则上突出重点、惜字如金（3000字真的很少，实际2800汉字左右）、不浪费一个字符：</p><ol><li><strong>中文计划（3000字）</strong><br>这个根据之前拿到的英文的研究计划来改写，主体就是英文研究计划的翻译，但要重新调整文章的组织结构；</li><li><strong>成果概述（3000字）</strong><br>包括自己的已有论文、参加项目、获得奖项等等，不论大小奖励均可详细介绍；</li><li><strong>国内导师简历（1000字）</strong><br>和自己导师沟通，挑重点的写；</li><li><strong>国外导师简历（1000字）</strong><br>要单独跟外导要这个，并且一定要说明 1-2 页，不要发来冗长的简历还得自己改，拿到PDF的简历后，还是要重新组织下语句，独立成文填到文本框里；</li></ol><p>上述内容基本上得全部手动打一遍，这大概七八千字的文字描述，其实是评委能看到的、产生主观印象的重要支持材料，所以对申请时非常非常重要的，一定要认真对待！</p><p>除上述内容外，其余的就是基本信息的填写了，填写的原则是实事求是！奖励不够级别的就最好不要写，科研项目这块据老师交代可以宽松一点，本身研究生也不太会独立承担课题，所以可以写上参与的基金项目，然后负责职位写参与就可以了。</p><p>对于一些模棱两可的边角料信息，一定要问清楚在填写，谁负责收材料就问谁，一般是自己学校国际处的负责老师。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhg5h2c11f861qll1khj1in9piv13.png" alt="image_1dhg5h2c11f861qll1khj1in9piv13.png-784.4kB"></p><p>最后，有个单独的提交申请材料模块，目的就是上传下面的PDF扫描件，对于攻博的申请来说主要有下面需要提交的材料（详见<a href="https://www.csc.edu.cn/article/1411" target="_blank" rel="external nofollow noopener noreferrer">这里</a>），由于某些表格是最后自动生成的不用准备，所以按准备的先后顺序对原材料进行重排如下（1-9项需全部上传）：</p><ol><li>成绩单复印件（自本科阶段起）/PDF</li><li>最高学历/学位证书复印件/PDF</li><li>有效的《中华人民共和国居民身份证》复印件/PDF</li><li>外语水平证明复印件/PDF</li><li>邀请信/入学通知书复印件/PDF</li><li>学习计划（外文）/PDF</li><li>国外导师简历/PDF</li><li>国内导师推荐信（攻读博士学位研究生和联合培养博士研究生均需提交）/PDF</li><li>两封专家推荐信（攻读博士学位研究生需提交）/PDF <strong>（*和上面的推荐信合成一个PDF上传）</strong></li><li>在系统最后是《单位推荐意见表》，需下载并由院办盖章，并发电子版到学校国际处审核</li><li>全部信息填写完成后，系统会自动生成《国家留学基金管理委员会出国留学申请表》（研究生类），一般要求打印这个文档，并交给学校国际处。</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhg41mlo1mcggmlcb11k0g6n39.png" alt="image_1dhg41mlo1mcggmlcb11k0g6n39.png-948.6kB"></p><h3 id="等待阶段（2020-4-5）"><a href="#等待阶段（2020-4-5）" class="headerlink" title="等待阶段（2020.4-5）"></a><strong>等待阶段（2020.4-5）</strong></h3><p>这段时间基本上可以把申请放一边，该干嘛干嘛了，需要整毕设的整毕设，需要补英语的补英语，出结果的日期一般在五月下旬，从报完名到五月中旬大概有快两个月的中断期，其实比较好熬，但从五月中旬开始的两周，可以说非常难熬了，每天都有人问这问那，也有不少人关注自己页面HTML代码的变更，搞得天天风声鹤唳，非常紧张，加之出结果的时间其实很晚才会确定，这种不确定性会导致一堆人在群里天天分析来分析去，心理承受能力差的人估计要受不了了。</p><p>关于代码变化这个事情，我从一开始就是不信的，本身就是写代码的，从前端页面的某个值的变化推测数据库中值的变化，本身我对此持怀疑态度，去年听说是比较准的，但也是因为基金委估计也没想到学生们这些手段，今年已经明确说网站代码改动了，但还是有部分人乐此不疲的每天刷着自己的状态码，对此理解但不加入，这是我的态度，直到查结果前我一次都没有看过，查完结果后看了一下，自己好像是 2，关于 1 和 2 的具体意义，出结果后会发现其实没有什么代表性，所以今年再申请的话，务必不要在这些代码上浪费精力了。</p><p>总之，在这段时间的最后，一定要稳住心态，可以水水群聊聊天缓解压力，最终发现，群里的话痨基本上都成功了，这不是巧合，参与的多获得的信息就多，信心也大些，一结合成功率可能就高些。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="后续材料办理（更新中）"><a href="#后续材料办理（更新中）" class="headerlink" title="后续材料办理（更新中）"></a><strong>后续材料办理（更新中）</strong></h3><ul><li><strong>选择留学生服务中心</strong><ul><li>可选背景、上海、广州，三选一</li><li>主要负责为留学生提供后续服务（订机票等）</li></ul></li><li><strong>公派出国留学协议书</strong><ul><li>两位担保人</li><li>公派无需财产证明和资金证明</li><li>交付学校国际处一份</li><li>交付国家留学基金委一份</li><li>自己拿一份</li></ul></li><li><strong>体检</strong><ul><li>出入境检疫局</li><li>健康旅行证</li></ul></li><li><strong>外校注册</strong><ul><li>重新发送一些相关文件给国外秘书</li></ul></li><li><strong>国外当地租房</strong><ul><li>视情况而定，花费时间有长有短 </li></ul></li><li><strong>办理签证</strong><ul><li>具体办什么签证，去对方国家的中国大使馆官网查询</li></ul></li><li><strong>订机票</strong><ul><li>提前 20 天左右向留服提交申请</li><li>会提供联程票（费用全免）</li></ul></li><li><strong>银行卡</strong><ul><li>填报申请系统时就选择过了，一般是中行或建行；</li><li>A类地区 一个月往卡里打 1350 欧元；</li><li>出国前务必开通激活银行卡，基金委会预付三个月奖学金到卡里，以免去了没钱花；</li><li>此卡为一般储蓄卡，非VISA，保险起见尽可能再带一张 VISA 卡，国外可没有蚂蚁呗和京东白条什么的了。。</li></ul></li></ul><hr><p>以上基本涵盖了整个申请过程的全部内容，但真正的申请过程要远比这个复杂，可能会出现各种不确定的情况，还需要各位申请者自己斟酌把握，做出抉择。</p><p>整体而言，国家公派留学（攻博）的申请过程过于冗长了，远没有申请全奖来的雷雷风行，但相应的，也没有全奖那样对GPA等的拔高要求。可以说，全奖看成绩、看GPA，CSC看的更多的是发展潜力。</p><p>就申请而言，全奖基本是分化到外校每个学校进行竞争，而CSC是对外各找各的，对内评审时全国高校加各省教育厅加海外大使馆的申请人，混在一起，由评审专家评出这 2500 人，和全奖的难易程度机制不同没法比较，但总归CSC有着更多的可能性，评价指标也更加多元，如果不是纯粹的 GPA学霸大佬，那么申请 CSC 或许是一个很棒的途径。</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSC </tag>
            
            <tag> 攻博 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>国内外攻读博士之我见</title>
      <link href="/article/995.html"/>
      <url>/article/995.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：转载请注明出处，以下内容均为个人总结，不保证百分百正确性和完整性，请酌情参考</p></blockquote><h3 id="由毕业出路说起"><a href="#由毕业出路说起" class="headerlink" title="由毕业出路说起"></a>由毕业出路说起</h3><a id="more"></a><p>目前的形式是，虽然国内顶尖高校发展迅速，但各大排行榜整体上仍被境外学校占据大多数，一定程度上也说明了内陆的高校仍然有很大提升空间，这也是为什么很多人选择外出求学的原因。现阶段国际上评价学校的方式中，各大排名是很具有参考意义的，即便是存在一些倾斜或者对国内高校的歧视，但不妨碍我们对国外一些学校水平的判读，现阶段公认的四大排行榜如下：</p><ul><li><strong>泰晤士高等教育排名，THE</strong><br>由英国《泰晤士高等教育》发布，早先与 QS 联合发布排名，现已各自独立发布，由普华永道（PWC）进行独立审计，因存在商业因素和偏向英语国家而经常受到批评。</li><li><strong>世界大学学术排名，ARWU</strong><br>前身由上海交通大学高等教育研究院发布，现由“上海软科”（公司）发布，仅针对前500排名进行发布，排名以评价方法的客观、透明和稳定而著称，但也被指责过度偏重理工领域及过多采纳美国的知名期刊与论文发表平台为数据基准。</li><li><strong>QS 世界大学排名</strong><br>由英国国际教育市场咨询公司 Quacquarelli Symonds 发布，是参与机构最多、世界影响范围最广的排名之一，因其问卷调查形式的公开透明而获评为世上最受注目的大学排行榜之一，但也因具有过多主观指标和商业化指标而受到批评；很多高校的分项数据缺失，总分出现大幅偏差。</li><li><strong>USNEWS 世界大学排名</strong><br>其由《美国新闻与世界报道》发布，榜单排名常被评价为过度钟爱美国本土公立学校。</li></ul><p>目前的海外留学归国就业情况：可由各高校对博后（一般应聘这个）的要求看出一点风向，目前大部分高校对博后的要求都有这么几条：年龄限制、学术论文要求、一流高校毕业。其中，对一流高校的衡量比较模糊，国内一般以双一流做标准，国外及港澳台则通过排名确定，下图可见部分高校直接给出定量的指标参考，目前来看世界排名前100的高校是比较有牌面的（*世界排名一般是四大榜之一即可），但这也不是硬性条件，只有少部分学校直接给出这种硬性指标，大多数高效只要求毕业于一流学校。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhdkb6779i2ves13br1lf7104s9.png" alt="image_1dhdkb6779i2ves13br1lf7104s9.png-45.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dhe3ojj21iivddv1k1c1k0v84n9.png" alt="image_1dhe3ojj21iivddv1k1c1k0v84n9.png-307.7kB"></p><p>不过，总体而言随着博士毕业生的增多，整个就业形势会更严峻，就业要求也会水涨船高，所以，在决定攻读博士这件事上更要思考再三，除了自己的不懈努力外，现在看来更优秀的平台也是我们绕不过去的坎，那么如何选择升学去向就显得尤为重要，选择国内还是国外、自费还是全奖，这都需要认真考虑，唯一的原则就是：宁做凤尾，不做….。</p><p>这句话可以有不同的理解，凤，要么是好的平台，要么是好的导师，理想状态下是二者皆占，但如若只能二中选一，那么前者的容错性要远大于后者，虽然有种说法是读博士导师最重要，但我认为读博士首先方向是第一位的、其次是平台（研究组、实验室）、再次是导师（大佬级除外），如果有大佬级导师，可以无视一些限制，但何为大佬级导师？院士一定是、其他的就需自己衡量和承但风险了；原则就是看其发展前景，如果退守二线的大boss并无斗志，那么追随其完成学业估计也不会有什么作为，反而，某些“蠢蠢欲动”的boss会最终跳槽到更好的平台，这种情况一般会让其团队整体迁移，所以能否找到这种野草中的百合花，就看自己的本事了。</p><p>话说回来，从本到硕再到博，研究领域逐渐固化、精细，如果我们想做出一些成果，必然地需要接触最前沿的知识，而目前，这些资源都很不平衡地被顶尖平台吸引，即在好的平台或许你可以直接去面对面和研究领域内的各种leader对话、探讨，而在稍差一些的地方，或许就只能咀嚼二手信息；知识的滞后性虽然在互联网时代会被冲淡，但毫无疑问对整个领域研究进展的把握并非善用互联网就可以完成。</p><p>郑重声明：以上叙述仅在于突出选择的重要性，科研本无三六九等，但今天我们的社会也不是天堂，所以面对社会资源的分配不均，我们只能遵守当下的游戏规则。世界学校千千万，顶尖学府一小半；或许现在不能被他们接收，但这颗向往的心请务必保持。都说高考是一锤定音，可对于真正一心向上的人只是一次小小的转折，从高到本、到硕、到博、到博后，不要再说自己没机会，装睡的人叫不醒，有梦的人不睡觉！不管现在你身处什么位置，要坚信有若干向上的大门为你打开，偏安一隅一时，往往就会偏安一隅一世。是要活的精彩，还是平淡是真，这取决于自己内心的声音，想，就去做，不要考虑太多，这个想法才是最珍贵的东西：有了方向才能打包行囊！</p><h3 id="真正的抉择"><a href="#真正的抉择" class="headerlink" title="真正的抉择"></a>真正的抉择</h3><p>下面是目前我所知的全部的几种攻读博士的方式及一些注意事项，仅供参考。</p><h4 id="大陆境内的选择"><a href="#大陆境内的选择" class="headerlink" title="大陆境内的选择"></a>大陆境内的选择</h4><p>下述时间花费是指高等教育时间花费；</p><ul><li><strong>本硕博连读</strong><ul><li>确定节点：高考后报志愿时</li><li>时间花费：3 + 2 + 3 或其他分配方式，一般 8 年完成</li></ul></li><li><strong>硕博连读</strong><ul><li>确定节点：考研/保研时</li><li>时间花费：一般是 2 + 3 或其他分配方式，一般 9（5+4） 年完成</li></ul></li><li><strong>硕士转博（本校内）</strong><ul><li>确定节点：正常研二上学期（提前答辩）</li><li>时间花费：一般是 2 + 4 或其他分配方式，一般 10（6+4） 年完成</li></ul></li><li><strong>申请考核（外校）</strong><ul><li>确定节点：硕士毕业前半年/一年</li><li>时间花费：正常学制，一般 11（4+3+4） 年完成</li></ul></li><li><strong>统考</strong><ul><li>确定节点：硕士毕业前半年/一年</li><li>时间花费：正常学制，一般 11（4+3+4） 年完成</li></ul></li></ul><h4 id="大陆境外的选择"><a href="#大陆境外的选择" class="headerlink" title="大陆境外的选择"></a>大陆境外的选择</h4><p>主要分为直博和硕士攻博，两者博士攻读年限并无太大差别，均为 4-5 年，但美国等部分国家会要求本科生学习相关研究生课程，会一定程度上拉长时间，但总体国外提前毕业的案例也非常多，也存在工科 3 年毕业的同学；大部分硕攻博学生属于正常学制，即整体时间花费为 11（4+3+4）年，本科生直博也一般需要 8（4+4）年；</p><p>需要明确的是，同大陆国内院校不同，境外攻读博士一般给的“补助”要高的多（自费除外），完全可以将境外攻博看做一份月薪一万rmb左右的工作，事实上欧洲大部分国家就是这样做的。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h5 id="外校全奖"><a href="#外校全奖" class="headerlink" title="外校全奖"></a><strong>外校全奖</strong></h5><p>全奖区别于半奖，一般是负担学生的全部学习和生活开支，主要包括学费+生活费，在没有学费的学校就主要包括生活费；半奖的形式比较多样，主要的区别就是Cover的费用不够全面，需要自掏腰包一部分，比如包括学费和生活费的学校，只减免学费生活费自理，这就算一种半奖。</p><ul><li><strong>英美加澳新</strong><ul><li>好处：<ul><li>学校数量庞大，申请全奖机会多</li><li>文化大熔炉，生活更加多元</li></ul></li><li>坏处：<ul><li>强委员会制度，即学校主导性强，导师话语权弱，能否给offer要看学校/院的意见，而学校/院往往会卡死各种条件，甚至导师都无法argue</li><li>普遍需要托福，及一系列考试，难度及时间花费明显高于雅思</li></ul></li></ul></li><li><strong>欧洲大陆</strong><ul><li>好处：<ul><li>名牌学校众多，不过分散于各国，国内名气不如美帝学校来的响亮，但实则排名都非常靠前；</li><li>申根国优势，可一国留学，游遍多国，亦方便学术交流</li><li>一般无学费，各种职位、全奖其实解决的是生活费</li><li>弱学委会制度，导师话语权大，一般是导师拍板、学院辅助的套路</li><li>一般要雅思成绩，语言学习成本不高</li></ul></li><li>坏处：<ul><li>区别于英美派系，欧洲教育普遍将博士视为全职工作人员，即需要按月发放工资，自然是没学费的概念，也就是说全奖机会不多，多的是职位机会，但不幸的是其职位竞争激烈，且多最终发放给了欧盟学生 </li><li>即需要自己找钱，机会较大的除了职位和小部分全奖，还有导师的项目经费、政府层面的奖学金</li></ul></li></ul></li><li><strong>港澳</strong><ul><li>好处：<ul><li>离家乡不远，离世界很近，足不出户就体验到各种异域文化的交融</li><li>高校实力强劲，和国内学校联系密切，发展前景好</li><li>雅思托福都承认，导师和学院的权力较平衡，申请可以比较个性化</li></ul></li><li>坏处：<ul><li>近些年港大等学校竞争非常激烈，导致某种程度上出身很重要</li><li>接触不到原本的西方文化及生活方式，有的只是跟深圳类似的高强度快节奏生活</li><li>最近各种事件体现出整体社会氛围较急躁，虽对科研没有影响，但毕竟需要在当地生活，还是需要一个稳定向上的社会风气；</li></ul></li></ul></li></ul><h5 id="政府类奖学金"><a href="#政府类奖学金" class="headerlink" title="政府类奖学金"></a><strong>政府类奖学金</strong></h5><p>这类奖学金是以国家的名义对部分学生进行学业资助，一般有指定的年限，到时间后需要返回原国家进行工作，资助水平一般不低于当地国家的全奖水平，大多是给本国学生申请，但也面向外籍学生申请，比如日本文部省奖学金，中国学生赴日留学的也可以申请该奖学金。目前我比较熟知的政府奖学金有以下几个：</p><ul><li><strong>中国政府奖学金（国家公派留学，CSC）</strong><ul><li>项目解释：类似项目在我国最早可追溯至清朝洋务运动时期的留美幼童，詹天佑等等一些人的名字我们耳熟能详，今天的公派留学就是做类似当年的事情，只不过现在规模更大（全国外派攻博人数2500人/年），流程更正规（严格申请资料和指标及资格审查），批评更公平（又各高校抽调评议专家评审）。现在，这项工作由教育部牵头，国家留学基金委负责实施。</li><li>申报条件：<ul><li>英语有量化要求，雅思、托福、PET5等等</li><li>需提前联系外校导师接收，拿到邀请信</li><li>需满国内导师推荐信若干</li><li>文章、项目无硬性要求</li></ul></li><li>时间节点：<ul><li>每年的三月份填写申报系统</li><li>一般需要上一年年底前确定接收意向</li><li>也就是说下半年九十月份就需开始联系外校老师</li></ul></li><li>先前我就是申请的该项目，项目时间跨度要长达半年多，远多于申请全奖的时间花费，有关于更多我的信息可以访问 <a href="https://old.cz5h.com/other/page_about.html" target="_blank" rel="external nofollow noopener noreferrer">关于我</a> 页面，或直接“番茄”后访问 <a href="https://docs.google.com/document/d/e/2PACX-1vT3hHQ2WLxgtfT80-C40vekvoYcYmd-kRHaTkFyRma5VE35AIH6PFKyYTGdXRmAzhiNmFy4-Ly1K_-_/pub" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 。</li></ul></li></ul><ul><li><p><strong>德国政府奖学金（DAAD）</strong></p><ul><li>和中国国家留学基金委的奖学金项目合作多年，现在一般以 CSC-DAAD 联合奖学金的形式进行申请，即目前对于国内学生来说，申请该奖学金就是申请 CSC奖学金。</li></ul></li><li><p><strong>日本文部省奖学金</strong></p><ul><li>该奖学金同样和 CSC 有合作关系，申请该奖学金需先通过 CSC 的申请，可以看出目前国家留学基金委的合作项目都是这样的套路，除了和政府奖学金的合作项目外，还有一大批CSC和国外院校的合作项目，这部分项目在申请时单列指标，更多奖学金项目请查看国家留学基金委项目检索页面：<a href="https://bg.csc.edu.cn/" target="_blank" rel="external nofollow noopener noreferrer">https://bg.csc.edu.cn/</a></li></ul></li></ul><hr><p>以上是我目前粗略的总结，主要的时间节点没有叙述的很明确，详细的内容我会在今后慢慢更新。祝福努力的各位都能有个好的结果，要坚信有付出就会有回报！</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSC </tag>
            
            <tag> 攻博 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图布局算法的发展</title>
      <link href="/article/f8d9.html"/>
      <url>/article/f8d9.html</url>
      
        <content type="html"><![CDATA[<p>图数据的可视化，核心在布局，而布局算法通常是按照一些特定的模型，将抽象数据进行具象展示，这一过程伴随大量的迭代计算，例如朴素的 FR 力导向算法其在计算斥力时的算法时间复杂度达到了 O(n 3 )，这在小规模数据量下可能并不会出现问题，但随着规模的不断增大，采用如此“高昂”计算复杂度的算法变得不能接受，所以，出现了许多针对算法时间复杂度进行改进的方法，需要说明的是，在这一阶段，数据集的规模仍未达到单机处理上限，例如 OpenOrd算法采用多线程并行来加速计算过程。随着数据规模的进一步扩大，图数据节点达到百万级别时，单机并行策略也变得无能为力，这时，分布式并行计算的方式为这种“大规模图数据”的处理提供了可能性。</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dfde33au174v1picbhc7i419fb2t.png" alt="image_1dfde33au174v1picbhc7i419fb2t.png-69.8kB"></p><p>图在数学上通常用 G = (V, E) 来表示，其中 V 是顶点的集合，E 是边的集合，且每条边 e ∈ E 都连接两个顶点 &lt; v i ,v j &gt;，且边 e 通常由 &lt; v i ,v j &gt; 来存储表示，在本文中，我们将图数据的表示限定在二维平面内，因此对于每个顶点 v i来说，布局的最终目的是确定 v i 在画布上的位置 (x i , y i )。对于整个图数据可视化的发展趋势，大致经过了单核串行、单机多核并行和多机分布式并行三个阶段，各阶段存在时间的先后顺序，且由于各阶段的程序运行机制的差异，导致了对可视化处理流程（布局）实现和优化方面的差异。下面就图数据可视化的各个发展阶段进行回顾。</p><h3 id="单核串行阶段"><a href="#单核串行阶段" class="headerlink" title="单核串行阶段"></a>单核串行阶段</h3><p>在这一阶段产生了非常多经典的可视化工具，例如 Gephi [7]，一个能够展现和操作布局的软件，其允许用户进行二次开发加入其自定义算法或实现更复杂的功能，由于它的通用性和开放性，现在已成为最为普遍的网络可视化工具软件。除此之外还有许多类似的可视化分析工具软件，像 Ucinet 是早期针对对网络分析工具 [8] ，不过由于软件本身设计较早，导致整体对数据的处理能力严重不足，在 2011 年被停止维护；Pajek 也是一款诞生很早的网络分析挖掘工具 [9] ，可以对布局进行复杂的分层、置换等操作，其一直发展至今衍生出了多个版本，社区也非常活跃。在 2001 年出现的 NetMiner [10] ，将易用性和扩展性提高到了新的高度，并由此创造了成功的商业模式。在 2008 年，微软研究团队发布了 NodeXL [11] ，通过作为 Microsoft Excel 插件的形式，NodeXL 可以获得良好的易用性，不过由于其采用的.Net 平台开发，也使得其没有跨平台的能力，且 NodeXL Pro 属于付费模块，开源部分有限，总体开发扩展性不高。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dfde41v610er1nf2hml1qkg10u93a.png" alt="image_1dfde41v610er1nf2hml1qkg10u93a.png-182.5kB"></p><p>表 2.1 针对部分指标对以上软件做了对比，其中，Gephi 是目前适用范围比较广泛的网络可视化工具，对于 Gephi 来说，基于 NetBeans 的模块项目构建、以可视和交互为主的分析模式以及开源的社区支持，都使得 Gephi 成为一款更为纯粹的针对图数据可视化的工具。因此，在本文的实验部分，Gephi 被选做用来完成相关比较。还有一点值得关注的是，上述工具均不支持分布式运行环境，即处理数据的规模严重依赖主机的内存和处理器，虽然在 16G 甚至更大 RAM 的条件下，个别工具依靠多核并行的布局算法可以完成数十万节点规模的粗略布局，但对于更大规模的图布局来说，其高迭代性和高时间复杂度的特性使得上述软件均不能很好的完成大规模图数据的布局操作。</p><p>不过在早期的研究阶段中，针对的图数据规模一般较小，并未达到单机处理极限，可视化研究的重点大都集中在布局模型的探索，这一时期出现的力导向模型为图布局的发展起到了重要作用，众多图布局算法均由其改进而来。除此之外，这一阶段也产生了许多基于其他模型的图布局算法。力导向布局算法也称 FDP（Force-Directed Placement）算法是目前在图布局算法上应用最为广泛的算法，其在自然规则模型（弹簧或电荷力）的指导下，能以人类易理解的形式充分展现图的整体结构，通用性强，在图的布局算法中占据主导地位。根据力导向算法得到的布局结果，具有节点间相关的特性，即布局过程取决于节点间的连接而非节点具有的属性，这种方法的缺点是其对初始状态十分敏感，且布局过程可能会陷入局部最优解，同时整个过程具有不确定性，不能确保每次得到相同的结果。尽管该方法存在这些问题，但其仍然是对数据在结构上进行视觉解释的通用方案，并在随后的几十年时间里，有不少的研究都基于这一理论，且同样对图布局的研究产生了很深远的影响。对于力导向布局的改进，主要体现在能量模型和计算方式上。</p><p>以图布局为核心的图数据可视化的起点，可以追溯到 1984年，在这一年，Eades提出将图数据的布局模拟为弹簧和铁环的物理系统 Eades[12]，但在实现上其并没有反应真实的胡克定律，且时间复杂度为 O(|V| 2 )。之后，Kamada 和Kawai[13]对其做了改进，引入了非邻居节点间最佳距离的概念（最佳距离l同非邻两节点间的最短路径成正比），并首次将整个布局过程抽象为能量降低（最优化）的问题，通过最小点间斥力和引力的和，来将节点放置在合理的位置，整个系统中的能量模型可用公式2.1表示，</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dfde51l31b4j1dnnlsrvqu11ju3n.png" alt="image_1dfde51l31b4j1dnnlsrvqu11ju3n.png-19.2kB"></p><p>其中 x i 为顶点 v i 对应的坐标位置，k ij 为 x i 与 x j 之间连接弹簧的弹力系数，l ij 为顶点 v i 与 v j 之间的最佳距离。该方法每次只求取一个点的最佳位置，即其内循环（单次算法执行）时间复杂度为 O(|V|)。</p><p>之后，Davidson 和 Harel [14] 首次在布局过程中引入模拟退火算法，Fruchter-man 和 Reingold [15] 在此基础上使用了简化的“弹簧-电荷”模型（SEM, Spring-Electrical Model）来指导布局，在其算法中两节点间的斥力 f r 和引力 f a 可由公式2.2表示，并首次在布局时采用画布面积来计算得到最佳的节点间的距离。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dfde6emtuhiln1glq17ujs855m.png" alt="image_1dfde6emtuhiln1glq17ujs855m.png-26.3kB"></p><p>其中，K 即为最佳节点距离，C 是调节斥力引力相对强度的参数，∥ x i − x j ∥即为点 x i ,x j 之间的距离。</p><p>在力导向布局算法出现后的近十年中，研究者们主要的研究内容集中在模型的改进和减少绘制时的边交叉等问题，主要偏重于理论研究，在数据集的选取上均为规模较小（几十至几百顶点数）的、具有特定结构的图数据。由于这部分算法包含的内容一部分已经不具有时效性，所以这里仅列举了上述对布局算法有很大影响的基础性的工作。</p><p>在图布局算法发展的第二个十年里，研究者们不在满足于算法仅适用于小规模数据集的现状，开始向更大规模的数据发起了挑战，这一时期，布局过程中使用多尺度布局算法来加速布局过程逐渐成为研究热点，多尺度算法的最初思路是：对于图 G = (V, E)，G 0 是整体图结构，G 0 在开始生成一系列小尺寸的图G 1 ,G 2 ,…,G k 。然后用经典的力导向算法绘制级别最小的图 G k ，在 G k 的基础上来绘制 G k−1 的布局，递归地执行此过程直至完成 G 0 的绘制。在 1999 年，Hadany和 Harel 首次将多尺度算法 [16] 应用到图布局的过程中，使用简单的梯度下降来最小化计算模型的能量。其算法时间复杂度为 O(|VE|)，但需要的空间复杂度为O(|V| 2 )。不久后，Walshaw 将该思想做了更为细致的阐述，提出了多尺度 FDP 算法 [17] ，并对多尺度算法的时间复杂度做出了详细的分析。2003 年，Chan 等人针对符合幂律分布的网络提出了 ODL 算法 [18] ，首次提出通过图的拓扑结构来分层布局以加速布局过程，这一简单思想对后来的大规模图布局研究产生了很大的影响。第二年，Hachul 和 Jünger 提出了 FM 3 算法 [19] ，其通过一种“势能”系统来完成多尺度的布局思路，且首次将四叉树进入到布局过程来计算节点的近似势能信息。2006 年，HuYifan 从另一个角度出发，采用 Barnes-Hut 技术，通过构造八叉树来计算节点间的近似斥力 [20] ，得到了和 Walshaw 的多尺度布局算法相近的绘制效率。</p><p>同期，国内黄竞伟等人开始对“画图”问题（图布局）展开研究 [21]，他们将布局问题抽象为函数优化问题，然后利用遗传算法来求解目标函数的最优解的近似值。随后，孙炜等人又在其基础上引入模拟退火算法来克服遗传算法局部搜索能力较差的缺点 [22] 。在多尺度布局方面，最近几年国内研究者们针对分层布局提出了许多新的解决方案，包括基于图匹配 [23] 及基于改进力导向 [24] 的分层布局方法。</p><p>由于数据规模的增大，不可避免的出现了表示混乱的问题，在2009年，Holten等人首次提出边捆绑的概念（Edge bundling）并将其应用到图布局的展现上 [25] ，其提出在边绑定时要遵循一种“位置关联”的规则，即像长短差异很大或是距离间隔很远的边不应该捆绑在一起，这种方法的使用大大提高了图布局结果的展现能力，直到最近边捆绑技术仍然是图可视化研究的热点 [26] 。在这之后的布局算法中，美学设计被提到了和算法本身同等的位置，边捆绑等技术得到了快速的发展。同年，斯坦福大学推出了 SNAP 数据集服务 [27] ，其旨在搜集整理不同种类的网络数据并以公开的方式将这些数据提供给研究者，还是在这一年，Gephi的问世使得图数据的可视化研究变得更为方便，虽然在这之前有包括 Pajek 在内的许多工具软件，但 Gephi 仍然以其通用的开放编程模型和易用的界面使对图数据的可视化研究成为了一款通用可视化工具，同时随着边捆绑等视觉呈现方式的改进，图数据的可视化逐渐进入了一个新阶段：对真实社会网络的描述。</p><p>社会网络是复杂网络的一个重要分支，其描述真实的数据关系，同时也具有真实数据集的一些特点：符合幂律分布、易出现小世界网络等等，指虽然之前的FM 3 算法已经能够完成 20 万节点规模的绘制（AT&amp;T 当时规模最大的数据集），但其侧重点仍然放在对算法的原理分析上。视觉展现技术和可视化软件的成熟，使得像社交网络分析等学科通过可视化来辅助验证或直接分析相关问题成为了可能，这也促进了图数据可视化同社交网络等学科的进一步融合。在这一阶段，图数据的可视化进入了第三个十年，将目标转移到描述真实的社会网络之后，如何更好的展现数据的结构似乎成为了首要目的，这一阶段有相当一部分的研究都侧重在美学设计方面，即如何减少混乱、如何呈现小世界网络 [28] 等；同时，在处理数据的规模进一步增大和算法的复杂度不断提高的前提下，传统单机单线程的算法遇到了性能瓶颈，此外，一些边捆绑技术要求更高的计算代价，这也进一步促进了并行算法的出现。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="单机并行阶段"><a href="#单机并行阶段" class="headerlink" title="单机并行阶段"></a>单机并行阶段</h3><p>在这一阶段，传统的图布局算法引入了很多新的技术，例如采用并行计算来加速迭代过程，或是使用 GPU 编程来加速计算渲染过程。2009 年，在 FM 3 算法出现几年后，Godiyal 等人同 NVIDIA 公司的 Garland 对其提出了基于单指令多数据流处理器（SIMD，例如 GPU）的并行计算版本，他们的算法采用了一种基于CPU 和 GPU 结合构建的 kd 树，在布局计算上的时间复杂度保持在 O(NlogN)内。此后，GPU 并行技术正式被引入到图可视化领域，直到目前为止，其仍然图形骨骼绘制（Skeletons）技术的有效手段 [29,30] 。最初，研究者们尝试使用多显示器的方式对图布局进行显示 [31,32] ，这样顶点均匀的分布在不同显示器上，每个显示器关联自己的处理器，各处理器分别计算顶点的位置。该类算法并不具备良好的伸缩性，实验仅限于处理包含数千个顶点的图。之后，Tikhonova 和 Ma 提出了一种并行的力导向算法 [33] ，可以在具有几十万个边的图上运行。其算法运行在 Cray XT3 的 32 个处理器上（类似超级计算机），布局包含 260385 条边的图大约需要 40 分钟，效率仍有提升空间。在 2011 年，美国橡树岭国家实验室提出了 OpenOrd 算法，能够完成百万节点规模的数据布局，这是一个典型的分段布局算法，即对图数据的布局不再是多次布局算法的迭代，而是整个布局算法分为几个阶段，布局时分别执行这几个阶段，执行结束时布局结束，整个布局算法只执行一次，不存在外循环。OpenOrd算法主要采用了四种思想，即多尺度布局、节点聚集、并行计算和启发式的边切割，主要贡献即提出了可行的并行图布局思路和具体实现（在 Gephi 0.9.0 版本被纳入到布局算法中 [34] ），在模型上其沿用了 VxInsight [35] （其前身算法）使用的网络密度模型，其整个系统的能量可由公式2.3表示。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1dfde7qedekqqsr1blp1honj316j.png" alt="image_1dfde7qedekqqsr1blp1honj316j.png-24.5kB"></p><p>其中，D x i 会向画布中靠近点 x i的点 x 1,…, x n 贡献密度值，上式的求和包括斥力和引力两部分，在计算引力时通过公式中的 w ij （边的权值）来作用使之将关联性强的节点放置在相近的位置，斥力部分通过密度项 D x i 表示，其目的是将节点低密度的填充到画布中，对这两部分的和求取最小值来达到最终的布局状态，即关联性强的节点彼此靠近，但又必须满足低密度放置的要求。这样，在进行布局时，OpenOrd 算法采用多线程模式将带密度信息的画布复制多个副本，每个线程处理不重叠的部分数据，且都对自己的画布密度进行更新，然后在合并步骤将各处理线程的画布密度信息进行统一合并更新并调整节点的位置，循环迭代过程完成布局。该算法依靠多核处理器的并行能力，可以将单机（四核八线程）处理能力提高到百万节点级别。值得注意的是，这一阶段图数据的抽象表示也十分受到研究者的重视，这部分布局算法通常从社交网络分析的角度入手，常常伴随节点聚类和抽象图形表示等方法，例如 Vehlow 等人从重叠社区的展现出发，将不同级别的社区结构通过不同的图形抽象来显示 ；国内研究者也开始关注这一内容，2015年，赵玉聪等人根据分层扩展的思想，提出了一种基于图匹配的分层布局算法 [23] ，递归的对大图进行简化和布局，同时还研究了对简化布局结构的反向扩展，为分层布局算法提供了一种新的思路。此外，结合社区发现等研究领域，出现了以“社区划分/聚类-&gt; 节点抽象-&gt; 分层布局”的布局算法，代表作有朱志良等人提出的方法。 ，先构建社区网络，然后对其进行布局，之后确定社区区域范围，最后在每个社区范围内对社区进行节点填充。在这之后，2016 年汤颖等人提出了一种基于改进 FDP 算法的层级视觉抽象方法 [24] ，通过树结构来构建节点的分层结构，取得了十分明显的分层布局效果。</p><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>[7] BASTIAN M, HEYMANN S, JACOMY M. Gephi: an open source software for exploring and manipulating networks[C]//Third international AAAI conference on weblogs and social media. 2009.<br>[8] BORGATTI S P, EVERETT M G, FREEMAN L C. Ucinet[J]. Encyclopedia of social network analysis and mining, 2014: 2261-2267.<br>[9] MRVAR A, BATAGELJ V. Analysis and visualization of large networks with program package pajek[Z]. 2016.<br>[10] GHIM G H, CHO N, SEO J. Netminer[M]. 2014.<br>[11] SMITH M A, SHNEIDERMAN B, MILIC-FRAYLING N, et al. Analyzing (social media) networks with nodexl[C]//Proceedings of the fourth international conference on Communities and technologies. ACM, 2009: 255-264.<br>[12] EADES P. A heuristic for graph drawing[J]. Congressus numerantium, 1984, 42: 149-160.<br>[13] KAMADA T, KAWAI S, et al. An algorithm for drawing general undirected graphs[J]. Information processing letters, 1989, 31(1): 7-15.<br>[14] DAVIDSON R, HAREL D. Drawing graphs nicely using simulated annealing[J]. ACM Trans- actions on Graphics (TOG), 1996, 15(4): 301-331.<br>[15] FRUCHTERMAN T M, REINGOLD E M. Graph drawing by force-directed placement[J]. Software: Practice and experience, 1991, 21(11): 1129-1164.<br>[16] HADANY R, HAREL D. A multi-scale algorithm for drawing graphs nicely[C]//International Workshop on Graph-Theoretic Concepts in Computer Science. Springer, 1999: 262-277.<br>[17] WALSHAW C. A multilevel algorithm for force-directed graph drawing[C]//International Sym- posium on Graph Drawing. Springer, 2000: 171-182.<br>[18] CHAN D M, CHUA K S, LECKIE C, et al. Visualisation of power-law network topologies[C]// The 11th IEEE International Conference on Networks, 2003. ICON2003. IEEE, 2003: 69-74.<br>[19] HACHULS,JüNGERM. Drawinglargegraphswithapotential-field-basedmultilevelalgorithm [C]//International Conference on Graph Drawing. 2004.<br>[20] HU Y. Efficient, high-quality force-directed graph drawing[J]. Mathematica Journal, 2005.<br>[21] 黄竞伟, 康立山. 基于遗传算法的无向图画图算法[J]. 数学杂志, 1998(s1): 68-72.<br>[22] 孙炜, 吴伟民, 陈志峰. 基于遗传模拟退火算法的图的三维可视化[J]. 广东工业大学学报, 2002, 19(1): 37-41.<br>[23] 赵玉聪, 钟志农, 吴烨, 等. 基于图匹配的分层布局算法[J]. 计算机与现代化, 2015(8): 107-111.<br>[24] 汤颖, 盛风帆, 秦绪佳. 基于改进力导引图布局的层级视觉抽象方法[J]. 计算机辅助设计与图形学学报, 2017, 29(4): 641-650.</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识图数据的可视化</title>
      <link href="/article/65fe.html"/>
      <url>/article/65fe.html</url>
      
        <content type="html"><![CDATA[<h3 id="图数据的产生和发展"><a href="#图数据的产生和发展" class="headerlink" title="图数据的产生和发展"></a>图数据的产生和发展</h3><p>图是信息科学中最常用的一类抽象数据结构，能够直观的表达现实世界中对象之间的真实关系。许多重要应用都需要用图结构表示，传统应用如最优运输路线的确定、疾病爆发路径的预测、科技文献的引用关系等；新兴应用如社交网络分析、语义 Web 分析、生物信息网络分析等，与图相关的处理和应用几乎无所不在 [1] 。</p><a id="more"></a><p>随着技术的不断发展，网络在我们的生活中比以往任何时候都更加突出，上述一系列网络或图结构中都蕴含了越来越多的隐含信息，对这些网络的进行高效的分析和挖掘是亟待解决的一个问题，可视化技术在这一问题上具有无可比拟的优势，其视觉呈现可以给人们带来直观的对数据的理解和感知，Palmer等人在其文章中证明，图比其他可视化展现形式更适合探索数据的内部关系 [2] 。</p><p>面对飞速发展的信息社会，各式各样的数据集均迅速增长，部分原因是它们越来越多地被廉价且众多的信息传感物联网设备收集，如移动设备，航空（遥感），软件日志，照相机，麦克风，射频识别（RFID）阅读器和无线传感器网络。身处大数据时代，其对数据的分析和挖掘显得尤为重要，2016年的大数据的定义在指出大数据代表的数据信息具有 4V 特性之外，还强调了其需要特定的技术和分析方法才能转化为价值。随着技术的不断进步，各大分布式计算框架相继产生，其为大数据处理提供了有力的支撑，作为分布式计算、并行计算和网格计算的发展和延续，其对于单机串行处理性能不足的问题，给出了新的解决方案。</p><p>在万物互连的今天，我们已经拥有经典的大规模数据的处理方案，可以借助诸如 Spark 或 Hadoop 等分布式计算框架来实现大规模数据集的各种数据挖掘算法，在此趋势下越来越多的由于数据规模过大而导致的分析难题都被解决，但与此同时，在数据集规模和数据维度的极度膨胀下，我们对分析结果的准确性和可解释性的把握正在逐渐降低，追求可视化的宏观展现与细粒度的数据分析结果的一致性从来都是一个美好的愿景，前者可以对后者提供视觉上的强有力的支持和解释，在信息可视化领域，有越来越多的研究者在为此而努力。</p><h3 id="图数据的可视化技术"><a href="#图数据的可视化技术" class="headerlink" title="图数据的可视化技术"></a>图数据的可视化技术</h3><p>从可视化技术诞生伊始，其目标就是为了帮助人们理解抽象、混乱的数据，至今这一目标依然不曾改变。现在，数据可视化已经发展成为一个广泛的研究领域领域，处于数学、计算机科学、认知和感知科学以及工程学的交叉领域。从信号理论到成像，从计算机图形学到统计学，涵盖所有与可视化原理相关的学科 [3] 。可视化的目的是通过具象的、可交互的图形，让们深入了解我们感兴趣的过程（算法流程、科学模拟或一些真实的过程）的各个方面。可视化本身有许多定义，按照 Williams 等人的观点，可视化是人类在一个空间内构建图像时所进行的认知过程。在计算机和信息科学中，它更具体地说，是使用图形、图像、动画和声音来更详细的表示目标对象的数据、结构和动态行为的空间具象表示 [4] ，这里的目标对象可以指系统、事件、过程、对象和概念的大型复杂数据集。</p><p>目前，由于互联网及物联网技术的发展，网络这一名词正在被赋予越来越多的应用场景，随之而来的是我们自身正在越来越多的网络中扮演着重要的角色：大到 Facebook 的全球社交关系网络，小到家庭智能电器组网，都成为我们日常生活中不可或缺的一部分。这些复杂的网络中往往隐含着非常有价值的信息，例如，通过分析特定的社交网络来挖掘犯罪嫌疑人的相关信息 [5] 。经典的社交网络等复杂网络，其本质可用图这一数据结构相对应，自然地，图论中的各种理论也可以被应用到网络分析中，复杂网络分析方法的发展也验证了这一结论，在本文中，将统一称研究对象为“图数据”，将对其可视化呈现称为“图数据的可视化”，这里的图数据除了包含经典的社交网络之外，还包括各种可以抽象为网络的数据，总体上可以将其称为“社会网络”。</p><p>根据 IEEE VIS [6] 的分类，可视化研究领域主要分为信息可视化（InfoVIS）、科学可视化（SCIVIS）和可视分析（VAST）三部分，其中以信息可视化最为基础，其核心目的即：将给定的数据集 D 按特定的转换（Transform）规则 T，转换为对应的带空间信息的数据集 V(D) 并显示，以此来帮助人们理解大量、复杂、抽象的原始数据。对于图数据的布局过程，这一转换 T，即数据集 D 在给定二维（或三维）空间内的一组坐标映射 V(D)。</p><h3 id="大规模图数据可视化的重要性"><a href="#大规模图数据可视化的重要性" class="headerlink" title="大规模图数据可视化的重要性"></a>大规模图数据可视化的重要性</h3><p>在对传统的计算技术带来了挑战的同时，大数据技术的发展也促进了数据可视化的研究。作为数据最上层的展示方法，数据可视化使用图形化的手段，可以传达清晰有效的信息，促进人们对信息的理解。目前数据可视化技术可分为这几类：基于几何投影技术的方法、基于图表的方法、基于像素的方法、基于图符的方法、基于层次的方法和组合方法。作为可视化展现形式之一的网络图，是一种简单直观的图数据可视化展现形式；由于高密度数据区域的聚集特征，散点图可以更为直观的发现群体的存在；在探索大规模数据集时，网络拓扑结构的高度重叠是最严重的缺点之一，这常常会导致数据相互的关系被隐藏或很难被发现。</p><p>分布式计算框架的飞速发展极大地提高了人们对数据的处理能力，使得人们有机会可以直接研究大规模的数据集，在这方面，图数据占据了重要的位置。随着移动互联网的飞速发展，以经典的“网络”为主的图数据越来越多的出现在我们的日常生活中。在针对图数据的可视化中，提供有效的洞察力非常重要，这具体体现在以下两个方面：</p><ul><li><p>通过布局来展现图数据的具体特征<br>在这方面可以回答用户关于图数据本身的定量问题，例如在数据中拥有邻居最多的节点的信息、数据可以被划分为几个聚簇等等。这类问题的特点，是有明确的“问题驱动”，往往在没有可视化结果的帮助下用户也能得到准确的结果，但对于图数据而言，诸如想聚簇等特征，只有通过具体的布局呈现，才能更直观的得到一些运行结果的评价，像划分的聚簇间有无重叠这一问题，既需要数值上的（重叠度）准确度量，也同样需要布局上的清晰的边界划分。</p></li><li><p>为产生布局结果的过程提供信息<br>这部分内容并不针对具体问题，但对布局过程的尽可能详细的展现，使用户能够更容易的针对布局结果呈现的状态来反推出一些非常规问题的答案，例如在两方对立的意见网络中，中间（中立）节点对整个布局质量的影响（更紧密或更清晰），对于这个列子，研究者可能在一开始只发现了布局混乱这一现象，而并不知道中间节点对布局的影响，在经过对布局过程的可视化过程研究以后才得到最终结论。这类问题即 Telea 所说的“研究者对一种现象感兴趣，是为了发现数据新的特性并建立意想不到的关联”[3] ，这对于进一步理解数据中的信息起到了至关重要的作用.</p></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="分布式大图布局计算的特点和挑战"><a href="#分布式大图布局计算的特点和挑战" class="headerlink" title="分布式大图布局计算的特点和挑战"></a>分布式大图布局计算的特点和挑战</h3><p>面对大规模图数据的处理需求，分布式图数据布局计算往往有以下特点：</p><ul><li><p>需要进行计算的数据量巨大。节点规模在百万以上，单机甚至无法将全部顶图数据加载到内存中，虽然使用 Spark 等基于内存的分布式框架可以完成对此规模数据的处理，但如此规模的数据量仍然对集群的 IO 性能、网络传输性能提出了很高的要求；</p></li><li><p>需要完成逻辑上的多次迭代。应用广播等方式可以避免显式的循环使用，但布局计算的完成仍然离不开动辄几百次的迭代步骤，这对于传统 MapReduce计算框架来说是一个灾难，Spark 的 RDD 有效的避免了中间结果的 IO 操作，但上百次的迭代仍需要研究者十分小心的处理 RDD 的各种转换；</p></li><li><p>必须重写已有布局算法。显而易见，在布局算法的运行机制和环境发生改变后，布局算法也需要重新进行设计以适应不同的计算框架，虽然这和原有布局算法有着相同的算法思想，但在特定分布式计算框架上设计出完全适合且能够高效运行的算法，往往考验着研究人员对特定分布式计算框架的理解程度；</p></li><li><p>布局结果难以查看。单机布局算法往往能够轻松的对每次迭代的结果进行展示，像可视化布局工具 Gephi [7] 可以通过显示每次布局的结果来呈现动态的布局过程，但在分布式计算框架中这一操作往往很难实现，因为在此环境下数据会分片发往不同的工作节点进行计算，如果每次迭代完成都要汇总一次来展现<br>当前布局结果，这将直接导使用基于内存的计算框架的优点的丧失。</p></li></ul><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1] 于戈, 谷峪, 鲍玉斌, 等. 云计算环境下的大规模图数据处理技术[J]. 计算机学报, 2011,34(10): 1753-1767.<br>[2] PALMER S, ROCK I. Rethinking perceptual organization: The role of uniform connectedness[J]. Psychonomic bulletin &amp; review, 1994, 1(1): 29-55.<br>[3] C T A. Data visualization: principles and practice[M]. AK Peters/CRC Press, 2007.<br>[4] WILLIAMS M. Visualization.[J]. Annual Review of Information Science and Technology(ARIST), 1995(30): 161-207.<br>[5] JOHNSON J, REITZEL J D, NORWOOD B, et al. Social network analysis: A systematic approach for investigating[J]. FBI Law Enforcement Bulletin., 2013, 350.<br>[6] IEEE VIS[EB/OL]. 2019. <a href="http://ieeevis.org/year/2019/welcome" target="_blank" rel="external nofollow noopener noreferrer">http://ieeevis.org/year/2019/welcome</a>.<br>[7] BASTIAN M, HEYMANN S, JACOMY M. Gephi: an open source software for exploring and manipulating networks[C]//Third international AAAI conference on weblogs and social media.<br>2009.</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>To Avengers</title>
      <link href="/article/57e6.html"/>
      <url>/article/57e6.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97tgb3fivt1qd51nhq1nt1mig3k.png" alt="image_1d97tgb3fivt1qd51nhq1nt1mig3k.png-502.7kB"></p><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h3><p>复仇者联盟又出来打架了，作为粉丝怎么能不围观，所以电影票是少不了地，4DX吹吹风也是必备地…</p><a id="more"></a><p>是的，就在刚刚，如约看完了爽片《复联4》，说是特效爽片，但这次看完总觉得电影里还是多了些难等可贵的东西，不吹不黑，在后半场钢铁侠挂掉后我清晰的听到了场内不止一处的哭泣声，由于我平时也不怎么去电影院看感动人的电影，所以这还是让我十分惊讶的。<br>无论如何，看完之后内心有种诉说的冲动，因为这已经不是复联的一次精彩战役，亦或是一次精彩拯救，而是复联的完结，是漫威宇宙这个阶段的完结。写到这里，时间仿佛回到了奥创时代，每每漫威一个阶段的结束，都预示着有些我们印象深刻的角色，可能在将来不会再出现了。让我们和</p><ul><li>小罗伯特唐尼饰演的钢铁侠</li><li>克里斯埃文斯饰演的美国队长</li><li>斯嘉丽约翰逊饰演的黑寡妇</li></ul><p>说声再见，See you ~</p><blockquote><p>注：下文是【回忆文】，是我在看完电影后，在回学校的路上用手机码的，现在用电脑稍作整理，所以记忆或许有偏差，记不清的时间都已模糊处理，记不得的具体名词，比如无限宝石等都用别名代替，然后在叙述中出现穿插已有电影的镜头时会使用【《电影名》】注明。以下内容不打算勘误，本身就是速成，也相当于对自己记忆力的一个考验，原电影本没有分幕和段首句，为了易于理解后加的。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97tluh91v8p1ohn1idhji95q841.png" alt="image_1d97tluh91v8p1ohn1idhji95q841.png-864.2kB"></p><h3 id="第一幕-愤怒、放逐、希望"><a href="#第一幕-愤怒、放逐、希望" class="headerlink" title="第一幕 愤怒、放逐、希望"></a><strong>第一幕 愤怒、放逐、希望</strong></h3><p><strong>灭霸毁宝石令众人幻想破灭<br><br>蚁人谈量子使时间劫持可行</strong></p><p>开局承接上文，惊奇女侠帮助斯塔克及飞船回到地球，众人士气低迷斯塔克自暴自弃，后来惊奇女侠携众人通过星云找到灭霸，然而宝石已被灭霸摧毁，再打响指恢复世界的想法破灭，雷神一怒之下砍了灭霸的头。</p><p>回到地球后，一只老鼠碰到《蚁人2》最后的面包车里的装置开关，使得被困的蚁人重新变大，虽然在量子空间蚁人才过了五小时，但真实世界已经是灭霸打响指过后的五年。蚁人存活使得众人意识到“时间劫持”的可能性，最终，斯塔克觉悟研发出时间机器，众人分三组回到过去夺去宝石：</p><blockquote><p>注：回到过去取得宝石的部分电影为乱序插叙，这里按回忆分片整理为以下几部分，下面，从未来返回过去的角色均以【角色名+F】的形式出现，过去时间的角色即原名称。</p></blockquote><h3 id="第二幕-万分之一的机会"><a href="#第二幕-万分之一的机会" class="headerlink" title="第二幕 万分之一的机会"></a><strong>第二幕 万分之一的机会</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97snkg0th11no331n11nscgim.png" alt="image_1d97snkg0th11no331n11nscgim.png-536.8kB"></p><h4 id="第一节"><a href="#第一节" class="headerlink" title="第一节"></a><strong>第一节</strong></h4><p><strong>钢铁侠蚁人意外失手搞丢魔方<br><br>美队救场携斯塔克返七零年代</strong></p><p>斯塔克F、美队F、蚁人F返回201X，时值洛基被众人抓住【《复仇者联盟2》】，蚁人故意破坏过去的钢铁侠的心脏，使返回过去的斯塔克拿到宇宙魔方，但最后被下楼的浩克撞倒，洛基拿到魔方瞬间消失，宇宙魔方抢夺失败；<br>另一边，美队F巧妙利用九头蛇暗示把正在神盾局手中押送的宝石权杖骗了到手，但不料被美队撞到被误以为是伪装后的洛基，美队F和美队撕打过后成功取得宝石权杖。<br>蚁人F拿着宝石权杖返回未来，美队F和斯塔克F则选择赌一把，把用于返回的“红粒子”用在了另一次时间穿梭，穿越到197X年美队诞生的军事基地【《美国队长》】，在基地内美队F和斯塔克F分别顺利取得当时的红粒子和当时的宇宙魔方，然后美队F看到了当时的女友，斯塔克F则和貌似是他老爸的男人攀谈至离别，随后二人返回。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97sok9a12s210desp41esi1qmm13.png" alt="image_1d97sok9a12s210desp41esi1qmm13.png-517.4kB"></p><h4 id="第二节"><a href="#第二节" class="headerlink" title="第二节"></a><strong>第二节</strong></h4><p><strong>绿巨人苦口婆心未能说服古一<br><br>奇异博士冥冥之中令师傅妥协</strong></p><p>另一边，浩克F其实和斯塔克F一行人一起回去的，但他去另外找奇异博士的师傅光头大师，那时她还没去世【《奇异博士》】，两人见面后开始攀谈，最后光头大师听到浩克F说奇异博士在将来亲手把时间宝石给了灭霸后，便将时间宝石给了浩克F，并强调一定要将宝石物归原主，否则会对原世界线有灾难后果。之后，浩克带时间宝石返回。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97sps5g1gm1kave7bdo2fk41g.png" alt="image_1d97sps5g1gm1kave7bdo2fk41g.png-520.6kB"></p><h4 id="第三节"><a href="#第三节" class="headerlink" title="第三节"></a><strong>第三节</strong></h4><p><strong>胖雷神对话母亲解重负<br><br>小浣熊背后偷袭得宝石</strong></p><p>胖雷神F和浣熊F回到201X年的阿斯加德，时值《雷神》里的人类女主在阿斯加德【《雷神》】，返回当天恰是雷神母亲被谋杀的日子，肥雷神F由于痛苦回忆而未和浣熊F一起行动，最后浣熊F成功潜入人类女主背后将融合在其体内的红色宝石取出，肥雷神F也被其母亲发现，攀谈至离别，二人最终成功取得红色宝石。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97sr5721fi2m4o70lbek1c6i2d.png" alt="image_1d97sr5721fi2m4o70lbek1c6i2d.png-448.5kB"></p><h4 id="第四节"><a href="#第四节" class="headerlink" title="第四节"></a><strong>第四节</strong></h4><p><strong>黑寡妇牺牲自己换宝石<br><br>罗德斯设下埋伏锤星爵<br><br>灭霸巧借星云了解一切<br><br>坏星云打入复联埋隐患</strong></p><p>最复杂的一条线：由星云F、战争机器F、黑寡妇F、鹰眼F四人组成，四人首先在x星泊停，然后黑寡妇F和鹰眼F两人来到沃弥尔星球找到红骷髅【复仇者联盟3】，得知必须牺牲自己心爱之人才可让另一人得到宝石，二人都想牺牲自己但最终黑寡妇F卒，鹰眼F得到黄宝石返回。<br>同时，在停播母船的地方，战争机器F同星云F埋伏了偷圆球宝石的星爵【银河护卫队片段】，顺利拿到宝石并返回，但实际星云F由于原星云的靠近脑袋短路，并没有成功返回，随后被灭霸抓获。<br>在另一边稍早之前，星云F的出现使得原世界线星云脑袋短路，灭霸随即看出端倪，通过观看原星云共享星云F的回忆，灭霸知道了来龙去脉，并将星云F囚禁让原星云冒牌回去抢夺宝石。</p><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a><strong>小结</strong></h4><p>至此，六颗宝石全部集齐，下面人物不再带F，均发生在同电影开始时时间一致的世界。</p><ul><li>获得2颗：斯塔克 + 美队 </li><li>获得1颗：星云 + 战争机器 (返回的是冒牌星云)</li><li>获得1颗：黑寡妇 + 鹰眼 (黑寡妇卒)</li><li>获得1颗：浩克 </li><li>获得1颗：雷神 + 浣熊 </li></ul><p>随后，斯塔克制作出宝石手套，由于辐射只能浩克穿戴，打完响指后众人回归世界恢复，但与此同时，冒牌星云操作时间机器让灭霸的星舰母船穿越到了当前世界，并就在斯塔克科技大楼的头顶…</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97suqta7q71ur3pci1lf418im2q.png" alt="image_1d97suqta7q71ur3pci1lf418im2q.png-2124.5kB"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="第三幕-复联终极之战"><a href="#第三幕-复联终极之战" class="headerlink" title="第三幕 复联终极之战"></a><strong>第三幕 复联终极之战</strong></h3><p><strong>三打一群殴灭霸却险遭反杀<br><br>奇异博士携众人怼灭霸军团<br><br>钢铁侠拼死戴手套打出响指<br><br>美队听建议度过了完美一生</strong></p><p>随即，灭霸导弹齐射把斯塔克大楼扎了个粉碎，众人皆震落摔晕掉到炸出的坑里，手套被鹰眼捡到。<br>同时，在地面，斯塔克、雷神、美队三人爬出来了，灭霸也坐在对面等待冒牌星云给他们找宝石手套，双方随即开锤，三人显然不是灭霸对手，不过美队中途操作了雷神的小锤子打出了一波小高潮，但最终还是打不过，之后，灭霸发动母舰军队向地球正式进攻。同时，空气中出现无数黄色圈圈，奇异博士带众人回归，包括：小蜘蛛侠、绯红女巫、阿斯加德人、黑豹众人、冬兵等。</p><p>双方展开大战，另一边，卡魔拉和星云F达成同盟，将宝石手套从冒牌星云手中夺回，之后，由于灭霸仍试图得到手套，众人随即开始保护手套远离战场，手套在小蜘蛛侠手中时被人围殴，这时惊奇队长加入战局，起手就将灭霸母舰穿堂破肚，然后接过小蜘蛛侠手中的手套继续向战场外飞，但被灭霸拦截，双方纠缠中手套还是被灭霸戴上，这时间 奇异博士给斯塔克示意，意思是这是唯一一次机会，看罢斯塔克强行将宝石戴在了自己手上(通过后来斯塔克的遗留视频可以知道斯塔克预先想到了这个操作)，带上之后随即打了响指，灭霸众人全部完结变成灰，但斯塔克也由于辐射原因挂掉。</p><p>时间来到斯塔克的葬礼后，美队带着宝石返回过去归还，一来一回虽只有五秒但在时间劫持后的过去，美队可以停留随意时间，他选择了和最心爱的女友过了一辈子，所以，当浩克操作时间机器让美队回来时，他已经变成了垂垂老矣的年纪。老美队亲手将盾牌交到猎鹰手中，完成新老交替，电影在老美队的回忆中落下帷幕。回忆里美队和女友正值年轻模样，在古典乐曲中一起偏偏起舞。</p><h3 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a><strong>彩蛋</strong></h3><p>彩蛋的作用，即暗示故事接下来的走向，然而对于复仇者联盟来说，或许再无续集…<br>就这样，美队也选择了自己新的接班人…<br>钢铁侠在全体漫威人物的送别中长眠不醒…<br>黑寡妇的灵魂也永远留在了沃弥尔星冰冷的悬崖之下…</p><p><strong>复仇者联盟系列就此完结，告别过去放眼未来，复联的终结也意味着漫威演职人员新老交替的完成，同时，这也预示着：漫威电影的宇宙世界观会加速到来，这一点在惊奇队长身上已经开始显现，所以，作为漫威粉丝唯一能做的，除了贡献一张电影票，就是静静的等待新作了！期待漫威能拍出更好的作品！</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d97t9vbv11rn2sk15mth1513r637.png" alt="image_1d97t9vbv11rn2sk15mth1513r637.png-1764.8kB"></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Writing </tag>
            
            <tag> Memory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分享我的一些对拍照的理解与认识</title>
      <link href="/article/2690.html"/>
      <url>/article/2690.html</url>
      
        <content type="html"><![CDATA[<p>自己拿到相机也有两个多月了，这两个多月乱拍也好，认真构图也好，总归是积累了一点点拍照的经验，说是拍照，是因为万万不敢说自己是摄影啊，还有太多的东西自己一知半解，所以，纯粹是摸索着拍、当然，这完全契合我原本的诉求，即拿相机是用来记录的，重在发生的事情而非相片本身，而且我也不对自己做什么专业的要求。每当看到这张照片，能够回忆起当时的记忆，这就足矣！下面就简单介绍下我已有的器材。</p><a id="more"></a><p><strong>注：</strong>下述照片如果没有特别说明，即为相机所拍，<strong>图片存在压缩，不等同于原画质</strong>，机身均为 α6000，ASP-C 画幅，也就是残画幅，即下面介绍的三款镜头也都是残幅镜头。此外，α6000 是款微单相机，非单反相机。</p><h4 id="机身α6000-16-50mm套机头"><a href="#机身α6000-16-50mm套机头" class="headerlink" title="机身α6000+16-50mm套机头"></a><strong>机身α6000+16-50mm套机头</strong></h4><p>这是购入时套机的配置，当初是从某鱼捡的，也不便宜但比全新还是便宜太多，机身性能及参数在这里不做赘述，这里主要说下其套机镜头和其他方面。<br>对于此1650套机头，是索尼原厂镜头且自带机身防抖，即OSS。其光圈3.5并不十分的大，因此提供的景深不高；不过由于其是变焦镜头，且本身焦段涵盖广角到人像的很大一个范围，所以日常使用中，即可以拍拍近景人像，也可以有很好的广角视野。不过在照片质量上，其锐度并不是很好，不过这并不妨碍其成为大众用户的挂机镜头，因为其还有一个特点就是小，我不知道在这算不算饼干头，但其镜头的长度已经算是非常短的了，这样的好处是用此当作挂机头可以十分方便的进行携带，比如我有时会直接塞在羽绒服口袋里。下面是一些机身加1650镜头的实拍图。[ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r6cs3g13heska5lgpg2ej9.png" alt="1650mm"><br><strong>图例：</strong>这是1650的实拍样张，11月份在北京的一个下午，可以看出其整体表现还是不错的，这是16mm焦距下的画面，已经比较广了，不足之处也很明显，边缘不锐利，整体偏肉。 [ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r6tc7q1f27s581kj911491q9e61.png" alt="1650-yangpian"></p><h4 id="适马30mm-1-4光圈定焦头"><a href="#适马30mm-1-4光圈定焦头" class="headerlink" title="适马30mm/1.4光圈定焦头"></a><strong>适马30mm/1.4光圈定焦头</strong></h4><p>下面是我接触的第一款算是上档次的镜头了，作为微单加残幅相机的用户，这款适马30mm镜头可谓是名声远扬，其以锐度高著称，即‘锐不可挡’。不过由于其是定焦头，即只有一个焦段，对于变焦头用户使用起来可能需要点时间过度，不过适马的黑可以让其可以匹配索尼机身的电子对焦，即如果你很懒，你完全可以不用亲自手动去拧镜头的对焦环，而且配合机身的峰值对焦，其可以让拍照变得非常简单。然后是其具有 1.4 的大光圈，这对于一款平价镜头来说是非常值得肯定的了，大光圈意味着可以提供很好的景深，而且就适马的这款镜头来说，其背景虚化做的也相当不错，当然在部分高端用户的眼里还是不够好，但这款镜头派出的画质及照片质量，已经远胜于套机头了，毕竟价格是其大约六倍，虽然如此，还是可以称得上是一款性价比极高的镜头了。可以看看索尼原厂类似镜头的价格，除去索尼的信仰税，估计也比适马不知道高到哪里去了。回到照片质量上来，总的来看照片质量时非常不错的，锐度和细节刻画的都很不错，算是缺点的地方是其‘紫边问题’，这是这款镜头最大的诟病了，主要体现在照片边缘，虽然对比其他同类镜头其在边缘仍然可以保持很高的锐度，但是同样出现的还有烦人的紫边，当然这在后期是可以通过诸如Lightroom的软件去除的。其他小问题是画面的畸变，我不再赘述，因为在实际使用中我并没有感到十分严重的图像畸变。整体来说，其完全对得起它本身在市面上的地位[ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r6l9ojgq81k041kl71bb91ebvm.png" alt="30mm"><br><strong>样张：</strong>沈阳十一月份的一个下午，在下面的照片中可以清楚的看出，其具有非常好的景色还原度，而且如上所述，其锐度是十分不错的，即使是在边缘也具有非常高的锐度。对于景深，可以参考上图右侧的两张图，其背景虚化的我认为已经非常自然了，光斑显得也很柔和圆润。[ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r7348bhc71v84aa69dfn7r6r.png" alt="30mm-yangpian"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="七工匠15mm-2-8光圈定焦头"><a href="#七工匠15mm-2-8光圈定焦头" class="headerlink" title="七工匠15mm/2.8光圈定焦头"></a><strong>七工匠15mm/2.8光圈定焦头</strong></h4><p>使用过上述两款镜头以后，我经常在想到底有没有一种接近人眼可视范围的镜头，后来我了解到，这应该是属于广角镜头的范围，在经过一段时间的接触之后，我拿到了下面的这款15mm镜头，跟适马的30mm一样是定焦头，不同于前两款镜头，其是由中国厂家七工匠生产，上面的适马和索尼原装都是日本产。还有各可能比较别扭的地方是，其不能使用机身内的电子对焦，也就是说，如果你想拍照只能手动去拧镜头上的对焦环，不过作为一款广角镜，一般直接对焦到最远处就可以肆意拍照了。其他方面，其具有2.8的光圈，是一个可以接受的光圈大小，当然，其最最吸引人的地方就是价格，基本是一次短程国内机票的价格。然后买这款镜头最大的目的就是使用其大广角，自然地，大广角导致其镜头是所谓的灯泡头，这也就给后续安装UV镜造成了不便。还有个小特点需要讲的是这款机身是全金属机身，即镜头非常的重，他和适马30mm 1.4 的镜头比起来还要重些，虽然其个头比其小了很多很多。[ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r6p9ee1iuoc3u10hp15ul17qo3k.png" alt="15mm"><br><strong>样例：</strong>这是七工匠15mm 2.8拍摄的样张，一月份的下午，可视角度非常的广，而且整体锐度表现的很不错，尤其是中心锐度。值得一提的是其‘畸变’控制的非常好，通俗体现就是呈现的画面该直的地方非常直。几乎看不出有什么畸变，这在‘灯泡头’甚至是‘鱼眼头’上是个很常见的问题，由此可见这款镜头还是很强大的。但美中不足，其光圈在如此广的视角下，在图像的四角会出现暗角，即越到四个角图片就越暗，这在下面体现的很明显。不过追求大广角来拍风景，暗角问题在这价格面前完全不是问题，后期也可以消除。[ ↓ ]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r6u0pmhi061fkc61chr1je66e.png" alt="15mm-yangpian"></p><h4 id="我的图虫"><a href="#我的图虫" class="headerlink" title="我的图虫"></a><strong>我的图虫</strong></h4><p>从去年十二月份起，我开始加入了图虫大家庭，在一个多月的使用在之后，我认为这是一个非常好的照片分享平台，不止是单反还是手机，都可以将所拍的照片分享在这里。每次分享完照片之后，都会有游客热心的点赞，这是我认为对自己作品的最大鼓励，另外，图虫对版权保护的也比较好，整体来说，其已经是一个非常不错的照片分享平台了，希望图虫越来越好。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r7eag819236ag1rcg1ga31p4i78.png" alt="tuchong"><br>欢迎访问我的 <a href="https://tuchong.com/5634772/" target="_blank" rel="external nofollow noopener noreferrer"><strong>图虫主页</strong></a>，我会不定期的更新照片，记录并分享每一个值得记忆的时刻！<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1r7g38o1j1vrum44jrvftq07l.png" alt="myid"></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Summary </tag>
            
            <tag> Writing </tag>
            
            <tag> Memory </tag>
            
            <tag> Photos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary and review of 2018, B</title>
      <link href="/article/aa5f.html"/>
      <url>/article/aa5f.html</url>
      
        <content type="html"><![CDATA[<p><strong>This article is a set of memories, belonging to the list of RMBATS</strong>.</p><p>About this test happened on October 20th, I‘ve to say that the nervousness indeed made a negative impact for me, especially when I attended the speaking test. I almost couldn’t fluently speak a complete sentence when I first sat in front of the examiner, which, of course, was the first time for me to talk with the real foreigner. So that it was no surprising that the score of my first speaking test was just 4.5, which was a quiet low score for examinees. Besides, the score of other parts of the test were not good as well, e.g. the listening score was just 5.5, which normally, I need to get 6.5 to reach my target. If I have to find a key reason for this failure, I would say that my preparation was obviously not enough. Also, the failure taught me a lesson that, no pain no gain. [ ↓ ]</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1mbl3cuil112ff1cpq16u1v5i99.png" alt="first test"></p><p>Time came to the second half of the year, new semester was approaching, and I told my whole plan about PhD to my supervisor, which was a quiet difficult task for me. But, surprisingly, my supervisor showed a fully encouragement to my idea. It seems that people with high-level knowledge always reach the same view. After that, I returned back to the classroom to prepare the IELTS test again. When others prepared their graduated thesis, I spent almost whole time to learn English and contact with foreign supervisor. During this time, I always suffer from the sense of lonely: trying to imagine that everyone was working with a specific target except yourself, worse, you didn’t know what would happen in the future. What a complex feeling! I spent the last two month of last year with this terrible feeling. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1mccqpj1b7ja771r6m16d114639m.png" alt="continue studying English"></p><p>In November, there were several things need to be said, the first one is that I took a speaking lesson form taobao.com, which made my speaking ability up to a new level. My speaking teacher named Daisy, a kind lady, was always talking warmly with me and taught me speak English sentence by sentence with a great patience. We spent exactly 16 class hours together in about half a month. Almost every day at that moment, I spent about one hour to practice my speaking with Daisy. Another important thing is that I bought my first camera, a second-hand ICLE-6000 with the 16-50mm lens. But I didn’t take any formal photos until Dec. What’s more, I attended the yearly PhD Workshop, which made me be able to directly talk with foreign supervisors face to face. The last one was the order of taking IELTS test in Vietnam, and as a consequence, I flied back to my hometown to handle my passport, which is the first time for me to deal with these things. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1m42tiichu16di2lsboh1oi151.png" alt="November"></p><p>In the last month, I experienced too many FIRST things in my life. Mainly speaking, I attended IELTS test twice in one month, which was the first and maybe also the last time for me to do this in my lift. Then the first time to go to Beijing International Airport, the first time to use my passport, the first arrival in Macao, the first experience to travel at first class (as a gift from China International Airline) and the first time to live one week abroad (Hanoi, Vietnam). At that time, too many fresh things came into my life in a very short time (approximately seven days). During this travel or test travel, I had two partners with me, actually they are two enthusiastic little girls, but they both elder than me. We three people spent one week together in Hanoi. The biggest problem for us was to decide what to eat everyday. In these days, they spent much time to prepare test, but I actually walked around in Hanoi with my camera every day time or evening time. Hanoi, the capital of Vietnam, has very crowded streets, and you can see motorbikes anywhere. Moreover, there are too many foreign visitors, of course there are restaurants in every corner of street. This 7-days exprience maybe the most remarkable trip in my life, because I’m not really into traveling as usual. As for the IELTS test, the final result was that I reached the required score (overall = 6.5, each part &gt; 6.0). Generally, I was a little bit excited when I got the final transcript, before that, I sometimes suspected that if it was right for me to walk into this way, but now, the result gave me a big courage. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1m5o5531lfaa8t6du3nkavc60.png" alt="remarkable things"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>Above all, I simply finished writing these important things of 2018. This is a good way, I think, to share my experience to every reader. 2018 has gone in the wind, and we all walk into the new year whether we want or not. In the past twenty days of 2019, which also belong to this semester, there also happened many things, participating the Graduation Ceremony, seeing graduated classmates off or receiving the invited letter from foreign supervisor, each thing left a deep impression on me. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1nug2sg1epj1qktdr4pc41hfk3f.png" alt="new year"></p><p>Totally, by this time, I’ve probably finished all I want to say. Everything above could be expended a long story and all of them impressed me deeply, as I said, maybe, many of them would not happen again in my rest life. So, I told myself I need to write something to record them, since memories could dissipate in my brain, but these words not. In the new year, I also have many things to do, have many problems to solve, have many challenges to overcome, perhaps I would be anxious before to face the situation, but now, I don’t fear them anymore, and I will make full of my afford to beat every monster in the road to the final success! Come on, 2019!!!</p><p><strong>Note [ ↓ ]</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1o66srq104j11t1s4c3v61lua4j.png" alt="image_1d1me06dc1kh015epebrvgj1d379.png-29.8kB"></p><p>I spent about six hours to finish this long article in one time, so perhaps there are some wrong places in sentences, please don’t be too harsh. After it was done, I spent about 5 hours to collect these previous photos and make them into one picture. BTW, what I need to clarify is that <strong>I published these three parts in three dates, cause I want them to be arranged in order.</strong> Now, the time is as follows, obviously it’s time to sleep, see you tomorrow! </p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Summary </tag>
            
            <tag> Writing </tag>
            
            <tag> Memory </tag>
            
            <tag> Photos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Summary and review of 2018, A</title>
      <link href="/article/ab1f.html"/>
      <url>/article/ab1f.html</url>
      
        <content type="html"><![CDATA[<p><strong>This article is a set of memories, belonging to the list of RMBATS</strong>.</p><p>It’s time to make a summary for the past whole year. To be honest, I had to say I exprienced a really momerabe year, during which happened a lot of things, all of them are mainly about my further education. Here, I will use some words to write these memories down, for myself and also for all of you. <strong>Because of the length of this article, I divided it into three parts, named part A and B. The first part (A) is as follows.</strong></p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1ncdfcfi7218e91l6o1ttvboe1l.png" alt="image_1d1ncdfcfi7218e91l6o1ttvboe1l.png-27.9kB"></p><p>At the beginning of last year, of course the big point was the Chinese traditional festival, last year, I spent the festival day with my family in our home instead of returning back to the hometown, although we planned to do this for several years, however last year we did that for the first time, so that I didn’t spent the festival with my grandma, I don’t know her thoughts but, for myself, absolutely I want to stay with them as before. The new festival is approaching again, I don’t know the arrangement of my parents, speaking out my own thought is seemly a very tough task for me. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1m7sfqd1o4bu61b821rvvjsn78.png" alt="place where I was born, Zibo, Shandong"></p><p>Well, time went to the new semester, during this whole semester, the biggest problem surrounding me was that if I need to apply for a PhD education, which spent my a lot of time to think about. Another thing I need to mention is that I built this website as my own blog, which I think, is a perfect way to show my thoughts of my daily life, comparing with using the IM applications or the open blogs offered by the third publisher, I think this kind of independence blog, like HEXO, is quiet easy to use, because I don’t care about the end components, e.g., database, of this blog, and there is no trouble about the advertisement, which means the mainly weakness of those public open blogs, such as csdn.net, would not be appeared in my blog. Back to the topic, I spent much time to maintain the blog, which I think, is worth to do. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1mdr5o6abgthq1ulvno61fcfag.png" alt="a unique hobby"></p><p>In the middle of this semester, I also experienced a very remarkable trip in Wuhan. Originally, I went back there for my driving test, but finally, I met my old friend and tutor of my Alma Mater. Specially, I asked my previous tutor for help about the matter of applying PhD, and he gave me an extremely encouragement. At that time, however I didn’t have any confidence about the application, as a consequence we discuss a lot about the necessity of PhD, the main idea of my tutor was that PhD is an essential step for a high quality life, especially beneficial for the next generation, which I fully understand now. Now, actually, I am working hard for the PhD as he told me. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1m1u1vatm6cbi1kgm17br1j8j37.png" alt="my mother university, Wuhan, Hubei"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>Several days later, my cousin’s wedding was coming. In last Labor Day, I came back home and attended his wedding, this was the first time for me to take planes. Such as the airport, check-in, etc. these things are all fresh for me, at that moment I didn’t imagine that in the rest of last year, I went outside by plane for nine times and flying distances exceeded tens of thousands of kilometers. I spent a happy time in my cousin’s wedding, and took a lot of photos of landscape there, which let me start to determine to buy a professional equipment, just like a camera. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1o3pnno14e91r0najb1f7ejff41.png" alt="shot during the wedding time, Zibo, Shandong"></p><p>At the end of March, we started to prepare the final check of the project we working on from 2017 to 2018. Later, several students including me were asked to re-build the whole platform in the customer’s machines. The whole process executed in a very slow speed, and after finishing this re-construction, actually the summer vocation was coming. For usual students, this vocation was the time to practice their technical abilities in companies, but for me, as the plan I’ve made, I need to prepare for the PhD application, so those days, I almost used the SWW (small wood worm), a specific application about scientific research, everyday, in which has many advertisement about PhD. At the same time, I found the news about the China Scholarship Council, which had a most important impression for me. After that, I realized that I need to have an English score at first, e.g., IELTS or TOLFE, if I apply for the CSC program. So, an extremely hot and hardworking summer vocation was coming. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1m95oh8v4m19j15kvctv1pff82.png" alt="project final check"></p><p>On July 23th, I took my first English lesson in the IELTS training institution. Every morning, I need to spend about one hour to go across several district to arrive the classroom due to the location of my university. What’s more, last summer, the whole Shenyang was in a really high temperature, which gave me a deep impression that I need to change the clothes every day. We eight guys spent about twenty days together to study for the IELTS, during which, there were four teachers teach us reading, listening, speaking and writing respectively. This training let me learn more about IELTS, though the first test after that was failed. [ ↓ ]</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1d1o74v70gqu1s4c1v8te8hs7g63.png" alt="summer English training"></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Summary </tag>
            
            <tag> Writing </tag>
            
            <tag> Memory </tag>
            
            <tag> Photos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>美国版战狼—12勇士</title>
      <link href="/article/9a85.html"/>
      <url>/article/9a85.html</url>
      
        <content type="html"><![CDATA[<center><p><b><span style="font-size:20px;">电影海报Ⅰ</span></b><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cc9b249khe5mhg1suhi8b19ud2l.png" alt></p><a id="more"></a><p><b><span style="font-size:20px;">电影海报Ⅱ</span></b><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cc9b41b4b4ebo21iot11uit32.png" alt></p><p><b><span style="font-size:20px;">场景Ⅰ</span></b><br><img src="http://asus.myds.me:6543/movie/gif/1.gif" alt><br>队长失去将军的支持<br>率12人小队孤军奋战<br>在队友附上急需转移但基地组织有火箭炮的情况下<br>队长孤身一人发起冲锋<br>此时赶到的将军的部下也紧随其后<br>一向看不起他的将军也握拳目送他<br><strong>“他要冲了，跟他走！”</strong></p><p><b><span style="font-size:20px;">场景Ⅱ</span></b><br><img src="http://asus.myds.me:6543/movie/gif/2.gif" alt><br>将军同另一位捷足先登的军阀见面<br>本以为双方要发生冲突<br>但将军却选择了<strong>握手言和</strong><br>和平<br>再一次短暂的降临</p><p><b><span style="font-size:20px;">场景Ⅲ</span></b></p><p><img src="http://asus.myds.me:6543/movie/gif/3.gif" alt><br>意味深长的对话：<br>你做了正确的选择<br><strong>正确的选择？这里没那回事</strong><br><strong>这里是阿富汗</strong><br><strong>许许多多帝国的坟场</strong><br><strong>今天是朋友 明天就是敌人</strong><br><strong>就算是你们也一样</strong><br><strong>美国将成为这里的另一个族群</strong><br><strong>如果你们离开就是懦夫，留下来就是我们的敌人</strong><br><strong>只要记住</strong><br><strong>你永远都是我的兄弟</strong><br><strong>等我走进那座城市，我会升起你的旗帜</strong></p><p><b><span style="font-size:20px;">场景Ⅳ</span></b><br><img src="http://asus.myds.me:6543/movie/gif/4.gif" alt><br>最后的报幕：<br>尽管困难重重<br>第5特战群3营C连第5小队12人<br>仍全数平安归来<br>这支骑兵与友军部队一起攻下马扎里沙里夫<br>为美军最惊人的成就之一<br>军事战略家预计需耗时2年的任务<br>特遣队3周就完成了<br>基地组织视此事为他们所遇到的最惨痛的失利<br>由于是机密任务<br>595小队的队员们低调返家<br>未受到任何英雄式的欢迎或公开致意<br>2014年<br>杜斯塔姆将军出任阿富汗副总统<br>他与米奇·尼尔森至今仍是挚友<br>2012年<br>为了向他们的英勇表现致敬<br>民间团体捐赠<br>在世贸遗址前建立了一座骑兵雕像</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><hr style="height:1px;border:none;border-top:1px dashed #0066CC;"><p>尽管本片有极强的主观上的国家主义色彩，<br>但，还是要<br><strong>向保卫世界和平的战士们</strong><br><strong>致敬！</strong></p></center>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 观后感 </tag>
            
            <tag> 胡乱评价 </tag>
            
            <tag> 图文 </tag>
            
            <tag> 剧透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>应对LeanCloud对于处理性能的限制</title>
      <link href="/article/502d.html"/>
      <url>/article/502d.html</url>
      
        <content type="html"><![CDATA[<p>最近一直想如何才能统计<a href="https://old.cz5h.com/other/page_share.html" target="_blank" rel="external nofollow noopener noreferrer">资源分享</a>页面里的资源的下载次数，由于是直接放的资源链接，即点击即可获取，所以没有所谓的拦截页面进行统计，同时作为静态博客也几乎没有带数据存储的动态扩展能力，这时想到了用<code>LeanCloud</code>来实现下载的计数，最后基本实现了这个想法，有兴趣的可以去<a href>资源分享</a>里看看效果。</p><a id="more"></a><h3 id="更广泛的应用场景"><a href="#更广泛的应用场景" class="headerlink" title="更广泛的应用场景"></a>更广泛的应用场景</h3><p>其实上面说的对下载次数进行统计实际上就是统计点击的计数，这就可以应用到更多的场景，比如给文章<strong>添加喜欢数、顶数、踩数</strong>等等，这是可以直接用的，处理逻辑都不变。<br>还有就是类似<strong>淘宝五颗星打分数</strong>的这种评分机制，也是可以稍作改变就可以。<br>总之，只要是由点击后触发数据更新的场景都可以用此来实现。</p><p>这里，对如何实现整个需求暂不细说，主要说一下遇到的主要问题。</p><h3 id="LeanCloud查询处理的性能局限"><a href="#LeanCloud查询处理的性能局限" class="headerlink" title="LeanCloud查询处理的性能局限"></a>LeanCloud查询处理的性能局限</h3><blockquote><p><strong>QPS</strong><br>因特网上，经常用每秒查询率来衡量域名系统服务器的机器的性能，其即为QPS。<br>对应fetches/sec，即每秒的响应请求数，也即是最大吞吐能力。<br>计算关系：<br>QPS = 并发量 / 平均响应时间<br>并发量 = QPS * 平均响应时间</p></blockquote><p>这里，<code>LeanCloud</code>对免费实例的<code>QPS</code>做了限制，可以理解，如果同时的查询发送的过多，则会使Lean返回错误代码，如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cgcl6rvj125disn1qjr1fgi7lb9.png" alt></p><p><a href="https://leancloud.cn/docs/error_code.html" target="_blank" rel="external nofollow noopener noreferrer">错误码详解</a></p><blockquote><p><strong>429</strong><br>信息 - <strong>Too many requests.</strong><br>含义 - 超过应用的流控限制，即超过每个应用同一时刻最多可使用的工作线程数，或者说同一时刻最多可以同时处理的数据请求。通过 <strong>控制台 &gt; 存储 &gt; API 统计 &gt; API 性能 &gt; 总览</strong> 可以查看应用产生的请求统计数据，如平均工作线程、平均响应时间等。使用 LeanCloud 商用版或企业版 的用户，如有需要，可以联系我们来调整工作线程数。</p></blockquote><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>第一遍打开时需要循环发一遍查询来查询每个资源已有的下载数。</p><p>这里注意，为什么要循环每次发一次查询呢，因为在<code>LeanCloud</code>中创建的实例场景是广义的计数实例，即我只发一次查询然后处理返回结果，这种方式理论上是可行的，但是在实现上需要附加查询条件，还要考虑在库中的实例不一定只是一个地方的计数统计，总之较为复杂。</p><p>更简单的处理方式就是一一对应，一个计数实例（表中的一行记录）就是对应页面某处的一个计数器，只是在这里，由于分享下载的资源有点多，大概200元素，所以如果不加处理的发送查询请求，那几乎算是同时对<code>LeanCloud</code>发起这200次查询请求，由于其访问性能有限，所以需要对请求的发送做一定调整。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$(tar).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">"id"</span>);</span><br><span class="line">    <span class="keyword">var</span> texts = $(<span class="keyword">this</span>).parent().find(sp).eq(cnt);</span><br><span class="line">    <span class="keyword">var</span> url = $(<span class="keyword">this</span>).attr(<span class="string">"id"</span>);</span><br><span class="line">    query.equalTo(<span class="string">"url"</span>, url);</span><br><span class="line">    query.find(&#123;</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (results.length == <span class="number">0</span>) &#123;</span><br><span class="line">    texts.text(<span class="string">"0"</span>); <span class="comment">//初始是 0</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; results.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> object = results[i];</span><br><span class="line">    texts.text(object.get(<span class="string">'time'</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cge7og1n2h510su1h5deno18oq13.png" alt></p><p>我们主要关注<code>QPS</code>的变化，上图中较高的曲线是未经处理时发送查询请求的QPS曲线，这时由于并发的查询数过多，导致<code>LeanCloud</code>达到瞬时的负载上限而出现<code>429</code>错误。官方的错误代码解释为：</p><blockquote><p><strong>429</strong><br>信息 - <strong>Too many requests.</strong><br>含义 - 超过应用的流控限制，即超过每个应用同一时刻最多可使用的工作线程数，或者说同一时刻最多可以同时处理的数据请求。通过 <strong>控制台 &gt; 存储 &gt; API 统计 &gt; API 性能 &gt; 总览</strong> 可以查看应用产生的请求统计数据，如平均工作线程、平均响应时间等。使用 LeanCloud 商用版或企业版 的用户，如有需要，可以联系我们来调整工作线程数。</p></blockquote><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>解决此问题自然的会想到使用降低同时请求的查询数量，进而想到可以使用延迟执行来实现，这里可以使用<code>setTimeout</code>来针对循环内的每一次查询都进行延时操作。</p><p>这里又引出一个问题，那就是如何在<code>each</code>循环中进行延时操作</p><h3 id="在each循环中进行延时操作"><a href="#在each循环中进行延时操作" class="headerlink" title="在each循环中进行延时操作"></a>在<code>each</code>循环中进行延时操作</h3><p><code>JQuery</code>中的循环<code>each</code>的工作原理，其并不是类似<code>Java</code>那样的顺序循环，即第一次循环代码的执行总是先于第二次循环中代码的执行，这里要特别注意，<code>each</code>中循环的的代码的执行理论上是同时进行的（<strong>异步执行</strong>），即没有严格的先后执行顺序，对于这一问题，可以统一归类为 <strong>JQuery异步执行的代码如何顺序执行</strong> 的问题。可以看看这篇文章，<a href="https://www.cnblogs.com/yangjunhua/p/3509342.html" target="_blank" rel="external nofollow noopener noreferrer">JQuery回调、递延对象总结</a>，注意，使用<code>then</code>等对逻辑进行严格控制是正确的，但不是唯一的方法，如果你想完成的按顺序执行仅仅是<strong>时间上的先后</strong>而没有<strong>逻辑上的先后</strong>，那么还是用<strong>延时</strong>来实现比较容易理解。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(tar).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, item</span>) </span>&#123;</span><br><span class="line">    send.leancloud.query(item); <span class="comment">// 伪代码</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上述执行后几乎是同时发送循环总数的查询请求，这样就容易导致<code>429</code>错误；</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(tar).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, item</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">     send.leancloud.query(item); <span class="comment">// 伪代码</span></span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上述延时的代码是经典的错误做法，误认为<code>each</code>是同步的顺序的循环，但其实不是，这样添加之后的效果是，全部查询同时在延时1000ms后发出，其结果还是几乎同时发向了LeanCloud。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(tar).each(<span class="function"><span class="keyword">function</span>(<span class="params">index, item</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">     send.leancloud.query(item); <span class="comment">// 伪代码 </span></span><br><span class="line">    &#125;,<span class="number">100</span>*index);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>上述为正确的写法，注意<code>100*index</code>，这是利用了其异步执行的特点来进行延时，每次循环后的查询请求还是跟之前叙述一样会几乎同时被执行，但是这里执行时的延时时间不一样了，这里变成了<code>0,100,200...</code>，即查询请求会在<code>0ms,100ms,200ms...</code>后被发送给LeanCloud，显然的，达到了控制<code>QPS</code>的要求。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cge7qlcu1m82fj0i7k8g11tjv1g.png" alt></p><p>上图是查询发送处理后的<code>QPS</code>曲线，可以看出其值下降了很多，但仍有时很<strong>尖锐</strong>，可以通过加大查询的发送间隙来降低，当然，图示状态已经可以正常查询且不触发<code>429</code>错误。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h3><p>对于时间间隔来说，要综合查询的数量考虑，但总体上不能过大，这样会在前端显示过慢而损失交互性。<br><img src="/EVA001/8uttol7g62infft0sdfqmgkj/1111112.gif" alt></p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>偶发的断线异常，非本地错误!：</p><blockquote><p><strong>0</strong><br>信息 - (无)<br>含义 - WebSocket 正常关闭，可能发生在服务器重启，或本地网络异常的情况。SDK 会自动重连，无需人工干预。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> JQuery </tag>
            
            <tag> LeanCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分布式执行代码的认知纠正</title>
      <link href="/article/f5a4.html"/>
      <url>/article/f5a4.html</url>
      
        <content type="html"><![CDATA[<p><code>Spark</code>是一个分布式计算系统/组件/平台，这是都知道的，其用<code>Scala</code>实现<code>Spark</code>任务也是最原生的，但万万不能认为<strong>只要是在Spark环境下执行的Scala代码都是分布式执行的</strong>，这是大错特错的，一开始一直有错误的认识，但现在想想，如果拿<code>Java</code>和<code>Hadoop</code>的关系来作对比，其就很容易理解了。</p><a id="more"></a><h3 id="思维纠正"><a href="#思维纠正" class="headerlink" title="思维纠正"></a>思维纠正</h3><ul><li><code>Java</code>&amp;<code>Hadoop</code>的关系<ul><li><code>Java</code>是独立的语言，<code>Hadoop</code>本身由<code>Java</code>实现，可以由<code>Java</code>调用；</li><li><code>Java</code>编写的一般代码不能够分布式执行，缺少计算模型的支持；</li><li><code>Java</code>调用<code>Hadoop</code>实现的具体类方法（如<code>Mapper</code>、<code>Reducer</code>）实现的代码可以在<code>Hadoop</code>之上分布式执行；</li></ul></li></ul><p>同理，</p><ul><li><code>Scala</code>&amp;<code>Spark</code>的关系<ul><li><code>Scala</code>是独立的语言，<code>Spark</code>本身由<code>Scala</code>实现，可以由<code>Scala</code>调用；</li><li><code>Scala</code>编写的一般代码不能够分布式执行，缺少计算模型的支持；</li><li><code>Scala</code>调用<code>Spark</code>实现的具体类方法（如<code>Pregel</code>）实现的代码可以在<code>Spark</code>之上分布式执行；</li></ul></li></ul><p>另外值得注意的是，<code>Spark</code>的<code>RDD</code>的<code>Transform</code>和<code>Action</code>操作也都可以分布式执行，这里可以理解为<code>RDD</code>内部的各种算子操作都是基于分布式设计的。除此之外的诸如使用<code>scala</code>基本数据类型实现的代码，都是不能分布式执行的（<code>sacla</code>本身的不可变特性和能不能分布式执行没有关系）。</p><h3 id="纠错场景"><a href="#纠错场景" class="headerlink" title="纠错场景"></a>纠错场景</h3><h4 id="文件的读写"><a href="#文件的读写" class="headerlink" title="文件的读写"></a>文件的读写</h4><p>如果调用<code>java.util.File</code>来进行文件写入，Local模式自然是没有问题，但是集群分布式运行时，必须先执行<code>collect</code>操作来取回数据到本地，这就造成一个问题，假如在<code>100</code>个节点的集群中执行任务，现在要将文件写入到<code>Linux</code>文件系统，这本身就很搞笑，这样做的后果是，写操作在某个节点上被触发，全部数据都被收集到这个节点，然后此<code>Worker</code>将数据写入到<code>本地</code>，注意，这里的本地就是该<code>Worker</code>所在的节点，如果使用者要查看结果，那么他必须去到该节点的文件系统中查看。</p><p>上述就是为什么<code>Spark</code>运行时要将输出写入<code>hdfs</code>的原因，对于<code>hdfs</code>来说，其对于使用者来说就变成了一个存储环境，使用者无需关心数据具体哪部分存在哪个节点上。</p><p>所以，对于有写文件操作的代码在提交分布式执行时，切记检查是否调用的<code>java.util.File</code>.</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="对象的遍历"><a href="#对象的遍历" class="headerlink" title="对象的遍历"></a>对象的遍历</h4><p>这是最具迷惑性的部分，一开始写Spark代码时可能会在其中充斥着<code>List</code>、<code>Map</code>等等操作对象，更有甚者甚至引用<code>java.util.List</code>，并且希望在循环中对其进行更新，这在本地模式时显然也是正确的，但是其显然也不是分布式执行的代码。</p><p>那么，如果我就想维护一个大的<code>K,V</code>结构，并且想分布式执行地更新，那应该怎么做，答案是使用<code>RDD</code>，当然可以使用之前说过的<code>IndexedRDD</code>，这都是<code>RDD</code>做的封装，可能用起来非常别扭，比如由于<strong>不可变性</strong>，必须每次迭代都重新创建新的<code>RDD</code>等。</p><h3 id="正确的分布式执行代码"><a href="#正确的分布式执行代码" class="headerlink" title="正确的分布式执行代码"></a>正确的分布式执行代码</h3><p>到底什么才是正确的正规的分布式执行代码呢，其实一句话就可以概括，那就是<strong>全部逻辑都用RDD操作实现</strong>，即如果有个单机串行算法要分布式并行化，如果目标是在Spark上运行，那么最好的方式就是将原算法中的全部逻辑用<code>RDD</code>的操作来实现。</p><p>比如，原算法要求<strong>度分布</strong>，串行版本的程序一般需要遍历一遍数据集并且维护多个集合来完成，那么在这里，只需要句行代码：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> maxd = rdd.map( x =&gt; &#123; (x._2,<span class="number">1</span>) &#125; )</span><br><span class="line">              .reduceByKey( (a,b) =&gt; a+b ).sortBy(x =&gt; x._1)</span><br></pre></td></tr></table></figure><p><code>map</code>、<code>reduceByKey</code>、<code>sortBy</code>都是<code>RDD</code>的操作，具体特性以后在细说，这里的实现由于是建立在<code>RDD</code>之上，所以其可以被分布式执行，即原数据量巨大时，其内部实现会令其分发到多个节点的<code>worker</code>进行计算，计算完毕后的结果仍然存储在一个分布式内存数据集<code>RDD</code>中。</p><p>后续会继续对<code>RDD</code>的各种操作进行分析。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> Scala </tag>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA-2017.2-bug-SBT项目初始化的失败</title>
      <link href="/article/a61a.html"/>
      <url>/article/a61a.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf8c851mr18qrhbif17c11b9.png" alt></p><p>这个错误出现过若干次了，每次出现都想记录一下可是都忘了，然后下一次再遇见就又要搞很久才能解决，其实这本身是<code>IntelliJ IDEA 2017.2</code>的一个<code>bug</code>，只要修改一处配置就好了。</p><p>注：先前的文章里记得有个地方对这个问题表述的不正确，有时间再改。</p><a id="more"></a><h3 id="原错误信息"><a href="#原错误信息" class="headerlink" title="原错误信息"></a>原错误信息</h3><p>原错误出现的<code>IDEA</code>版本：2017.2；<br>原错误的出现场景：每次新建SBT项目并添加完SBT依赖之后出现；<br>原错误的表现：<code>build.sbt</code>文件内容解析全部是红的，并且<code>sbt shell</code>报错；<br>原错误报错如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[info] Loading settings from idea.sbt ...</span><br><span class="line">[info] Loading global plugins from C:\Users\msi\.sbt\1.0\plugins</span><br><span class="line">[info] Loading settings from plugins.sbt ...</span><br><span class="line">[info] Loading project definition from I:\IDEA_PROJ\Visualization\project</span><br><span class="line">[info] Loading settings from build.sbt ...</span><br><span class="line">[info] Set current project to Visualization (in build file:/I:/IDEA_PROJ/Visualization/)</span><br><span class="line">[info] sbt server started at local:sbt-server-a45abbca777ea4158128</span><br><span class="line">sbt:Visualization&gt;</span><br><span class="line">[info] Defining Global / sbtStructureOptions, Global / sbtStructureOutputFile, shellPrompt</span><br><span class="line">[info] The new values will be used by no settings or tasks.</span><br><span class="line">[info] Reapplying settings...</span><br><span class="line">[info] Set current project to Visualization (in build file:/I:/IDEA_PROJ/Visualization/)</span><br><span class="line">[info] Applying State transformations org.jetbrains.sbt.CreateTasks from C:/Users/msi/.IntelliJIdea2017.2/config/plugins/Scala/launcher/sbt-structure-1.1.jar</span><br><span class="line">[error] java.lang.ClassNotFoundException: org.jetbrains.sbt.CreateTasks$</span><br><span class="line">[error] at java.net.URLClassLoader.findClass(URLClassLoader.java:381)</span><br><span class="line">... ... ...</span><br><span class="line">[error] at xsbt.boot.Boot$.main(Boot.scala:17)</span><br><span class="line">[error] at xsbt.boot.Boot.main(Boot.scala)</span><br><span class="line">[error] java.lang.ClassNotFoundException: org.jetbrains.sbt.CreateTasks$</span><br><span class="line">[error] Use 'last' for the full log.</span><br><span class="line">[info] shutting down server</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=384M; support was removed in 8.0</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="Bug解决方法"><a href="#Bug解决方法" class="headerlink" title="Bug解决方法"></a>Bug解决方法</h3><p><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Build Tools</code>-&gt;<code>SBT</code>，勾选<code>Use SBT Shell for ...</code></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf8d2bu62jnjhhffh1l1jad9.png" alt></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/115000671044-What-is-estimate-to-support-SBT-1-0-x-or-java-lang-ClassNotFoundException-org-jetbrains-sbt-CreateTasks-" target="_blank" rel="external nofollow noopener noreferrer">IDEA官方社区的帖子</a></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf8dgfea130516sg196i1brl1lgc9.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> SBT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>音频格式的汇总及压缩比较</title>
      <link href="/article/2b07.html"/>
      <url>/article/2b07.html</url>
      
        <content type="html"><![CDATA[<p>数字音源，也就是数字音频格式，最早指的是CD，CD经过压缩之后，又衍生出多种适于在随身听上播放的格式，这些压缩过的格式，我们可以分为两大类：有损压缩的和无损压缩的。这里所说的压缩，是指把PCM编码的或者是WAV格式的音频流经过特殊的压缩处理，转换成其他格式，从而达到减小文件体积的效果。有损／无损，是指经过压缩过后，新文件所保留的声音信号相对于原来的PCM/WAV格式的信号是否有所削减。</p><a id="more"></a><blockquote><p>本文转自：<a href="https://www.ggdoc.com/" target="_blank" rel="external nofollow noopener noreferrer">果果文本库</a><br>原文标题：19种音频格式介绍及音质压缩比的比较</p></blockquote><h3 id="音频相关参数"><a href="#音频相关参数" class="headerlink" title="音频相关参数"></a>音频相关参数</h3><h4 id="速率"><a href="#速率" class="headerlink" title="速率"></a>速率</h4><p>什么是速率？当然我不能直接给你解释说“速率就是比特率”。大家在用一些软件播放声音文件的时候应该注意到了一个小小的信息。比如“128Kbps”、“1411Kbps”…也有朋友知道了，通常情况下，”Kbps”前面的数字越大，声音效果越好，比如CD就是“1411Kbps”。那么，到底这些数字代表什么呢？简单的说来就是在每秒钟时间内，有多少数据被转换成声音。之所以CD的音质比MP3好，是因为CD在每一秒内的信息比MP3多。比如，128Kbps的MP3文件相比1411Kbps的CD文件，其每秒被转换的数据量，MP3比CD少了近12倍。同样的一首歌曲，CD听来就要细腻得多（当然人群中有这么一群号称“木耳”的人可能觉得效果是一样的）MP3用较少的数据表达相同的内容，其详细程度当然就不如CD了。</p><h4 id="采样率"><a href="#采样率" class="headerlink" title="采样率"></a>采样率</h4><p>采样率也是很常见的一个词语。具体表现形式为“XXHz”，其中“XX”是一个具体数字。比如“44100Hz（44.1KHz）”，“32000Hz（32KHz）”等。之前已经说过了，数码音频文件是由很多个“点”来组成的，那么采样率其实就是采集这些“点”的一个“数量”标准。很显然“44100Hz”比“32000Hz”的采样率要高，所以单位时间内（1秒）搜集到的点就更多。单位时间的点越多声音的信息也就越完善，当然也就更接近于真实。所以，如果在保证速率相同的条件下，“44100Hz”的文件要好于“32000Hz”（当然，这也不是绝对的）。</p><h3 id="有损压缩"><a href="#有损压缩" class="headerlink" title="有损压缩"></a>有损压缩</h3><p>有损压缩的音源，其实我们都比较熟悉，目前流行的有损格式主要有MP3、WMA、OGG、MP3pro、AAC、VQF、ASF等。</p><h4 id="WMV格式"><a href="#WMV格式" class="headerlink" title="WMV格式"></a>WMV格式</h4><p>WMA的全称是WindowsMedia Audio，是微软力推的一种音频格式。WMA格式是以减少数据流量但保持音质的方法来达到更高的压缩率目的，其压缩率一般可以达到1:18，生成的文件大小只有相应MP3文件的一半。</p><h4 id="MP3格式"><a href="#MP3格式" class="headerlink" title="MP3格式"></a>MP3格式</h4><p>MP3的全称是MovingPicture Experts Group Audio Layer Ⅲ。简单的说，MP3就是一种音频压缩技术，由于这种压缩方式的全称叫MPEGAudio Layer 3，所以人们把它简称为MP3。它诞生于1993年，其“父母”是德国夫朗和费研究院（FaunhofeIIS）和法国汤姆生（Thomson）公司。</p><p>MP3是利用MPEGAudio Layer 3的技术，将音乐以1:10甚至1:12的压缩率，压缩成容量较小的文件，换句话说，能够在音质丢失很小的情况下把文件压缩到更小的程度。而且还非常好的保持了原来的音质。正是因为MP3体积小，音质高的特点使得MP3格式几乎成为网上音乐的代名词。每分钟音乐的MP3格式只有1MB左右大小，这样每首歌的大小只有3-4兆字节。使用MP3播放器对MP3文件进行实时的解压缩（解码），这样，高品质的MP3音乐就播放出来了。</p><p>MP3编码质量分为：固定码率（CBR），平均码率（ABR）和动态码率（VBR）。早期的MP3编码技术并不完善，很长的一段时间以来，大多数人都使用128Kbps的CBR（固定编码率）格式来对MP3文件编码，直到最近，VBR（可变编码率）和ABR（平均编码率）的压缩方式出现，编码的比特率最高可达320Kbps，MP3文件在音质上才开始有所进步，而LAME的出现，则为这一进步带来了质的飞跃。</p><p><strong>补充：最高比特率320K，高频部分一刀切是它的缺点。音质不高！</strong></p><h4 id="WMA格式"><a href="#WMA格式" class="headerlink" title="WMA格式"></a>WMA格式</h4><p>WMA的全称是WindowsMedia Audio，是微软力推的一种音频格式。WMA格式是以减少数据流量但保持音质的方法来达到更高的压缩率目的，其压缩率一般可以达到1:18，生成的文件大小只有相应MP3文件的一半。</p><p>WMA与MP3音质和体积上的对比特点，可以总结为：低比特率（小于128Kbps）时，WMA体积比MP3小，音质比MP3好；而在高比特率（大于128K）时，MP3的音质则比WMA好。</p><p>WMA相对于MP3的最大特点就是有极强的可保护性，可以说，WMA的推出，就是针对MP3没有版权保护的缺点来的。WMA可以通过DRM（Digital Rights Management）方案加入防止拷贝，或者加入限制播放时间和播放次数，甚至是播放机器的限制，可有力地防止盗版。</p><p><strong>补充：128kbps为wma最优压缩比，128kbpswma=192kbps mp3</strong></p><h4 id="OGG格式"><a href="#OGG格式" class="headerlink" title="OGG格式"></a>OGG格式</h4><p>Ogg全称应该是OGGVobis（oggVorbis）是一种新的音频压缩格式，类似于MP3等现有的音乐格式。但有一点不同的是，它是完全免费、开放和没有专利限制的。OGGVobis有一个很出众的特点，就是支持多声道，随着它的流行，以后用随身听来听DTS编码的多声道作品将不会是梦想。</p><p>Vorbis 是这种音频压缩机制的名字，而Ogg则是一个计划的名字，该计划意图设计一个完全开放性的多媒体系统。目前该计划只实现了OggVorbis这一部分。</p><p>Ogg Vorbis文件的扩展名是。OGG。这种文件的设计格式是非常先进的。现在创建的OGG文件可以在未来的任何播放器上播放，因此，这种文件格式可以不断地进行大小和音质的改良，而不影响旧有的编码器或播放器。</p><p><strong>补充：目前最好的有损格式之一，MP3部分支持，智能手机装软件部分可以支持，最高比特率500kbps。</strong></p><h4 id="Mp3Pro格式"><a href="#Mp3Pro格式" class="headerlink" title="Mp3Pro格式"></a>Mp3Pro格式</h4><p>在WMA刚开始流行的时候，还没有高品质的MP3，所以当时MP3的地位真的有点动摇了，于是Thomson公司在2001年6月，携手FaunhofeIIS，发布了一种新的格式MP3pro，这是对MP3格式的改良，编码算法比MP3要复杂得多，简单的说，就是分两层编码，在MP3的基础上，再与另外一种技术（SB频段复制技术）混合编码。</p><p>Mp3Pro是Mp3编码格式的升级版本。MP3Pro是由瑞典Coding科技公司开发的，在保持相同的音质下同样可以把声音文件的文件量压缩到原有MP3格式的一半大小。而且可以在基本不改变文件大小的情况下改善原先的MP3音乐音质。它能够在用较低的比特率压缩音频文件的情况下，最大程度地保持压缩前的音质。这种格式在低位率的时候，压缩效率非常高，所以在一般音质情况下，同位率的MP3pro的体积要比MP3甚至WMA都小得多，而音质却是三者中最好的。</p><p>MP3pro可以实现完全的兼容性。经过mp3Pro压缩的文件，扩展名仍旧是。mp3。可以在老的mp3播放器上播放。老的mp3文件可以在新的mp3pro播放器上进行播放。实现了该公司所谓的“向前向后兼容”。</p><p><strong>从技术上讲，MP3pro是一种非常优秀的编码方式，但是它高昂的专利费，使它没有真正流行起来。</strong></p><h4 id="RA系列"><a href="#RA系列" class="headerlink" title="RA系列"></a>RA系列</h4><p>RA、RAM和RM都是Real公司成熟的网络音频格式，采用了“音频流”技术，所以非常适合网络广播。在制作时可以加入版权、演唱者、制作者、Mail 和歌曲的Title等信息。</p><p>RA可以称为互联网上多媒体传播的霸主，适合于网络上进行实时播放，是目前在线收听网络音乐最好的一种格式。</p><h4 id="MOD格式"><a href="#MOD格式" class="headerlink" title="MOD格式"></a>MOD格式</h4><p>MOD是一种类似波表的音乐格式，但它的结构却类似MIDI，使用真实采样，体积很小，音质好，在以前的DOS年代，MOD经常被作为游戏的背景音乐。现在的MOD可以包含很多音轨，而且格式众多，如S3M、NST、669、MTM、XM、IT、XT和RT等。</p><h4 id="MD格式"><a href="#MD格式" class="headerlink" title="MD格式"></a>MD格式</h4><p>MD（即MiniDisc）是SONY 公司于1992年推出的一种完整的便携音乐格式，它所采用的压缩算法就是ATRAC技术（压缩比是1∶5）。MD又分为可录型MD（Recordable，有磁头和激光头两个头）和单放型MD（Pre-recorded，只有激光头）。</p><p>强大的编辑功能是MD的强项，可以快速选曲、曲目移动、合并、分割、删除和曲名编辑等多项功能，比CD更具个性化，随时可以拥有一张属于自己的MD专辑。MD的产品包括MD随身听、MD床头音响、MD汽车音响、MD录音卡座、MD摄像枪和MD驱动器等。</p><h4 id="ASF格式"><a href="#ASF格式" class="headerlink" title="ASF格式"></a>ASF格式</h4><p>ASF的全称是AdvancedStreaming Format，是微软所制订的一种媒体播放格式，适合在网络上播放。而WindowsMedia On-Demand Producer则是制作ASF档案的免费软件，让即使是初学者也能很轻易的利用现成的WAV或AVI档案制作ASF文件。</p><h4 id="AAC格式"><a href="#AAC格式" class="headerlink" title="AAC格式"></a>AAC格式</h4><p>AAC实际上是高级音频编码的缩写。AAC是由Fraunhofer IIS-A、杜比和AT&amp;T共同开发的一种音频格式，它是MPEG-2规范的一部分。AAC所采用的运算法则与MP3的运算法则有所不同，AAC通过结合其他的功能来提高编码效率。AAC的音频算法在压缩能力上远远超过了以前的一些压缩算法（比如MP3等）。它还同时支持多达48个音轨、15个低频音轨、更多种采样率和比特率、多种语言的兼容能力、更高的解码效率。总之，AAC可以在比MP3文件缩小30%的前提下提供更好的音质。</p><p><strong>补充：目前最好的有损格式之一。有多种编码，faac，nero为常见，比特率最高448kbps。硬件支持方面，高级mp3和现在手机普遍支持。</strong></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="MID格式"><a href="#MID格式" class="headerlink" title="MID格式"></a>MID格式</h4><p>MID是midi的简称，是它的扩展名。MIDI是英语MusicInstrument Digital Interface 的缩写，翻译过来就是“数字化乐器接口”，也就是说它的真正涵义是一个供不同设备进行信号传输的接口的名称。我们如今的MIDI音乐制作全都要靠这个接口，在这个接口之间传送的信息也就叫MIDI信息。MIDI最早是应用在电子合成器一种用键盘演奏的电子乐器上，由于早期的电子合成器的技术规范不统一，不同的合成器的链接很困难，在1983年8月，YAMAHA、ROLAND、KAWAI等著名的电子乐器制造厂商联合指定了统一的数字化乐器接口规范，这就是MIDI1.0技术规范。此后，各种电子合成器已经电子琴等电子乐器都采用了这个统一的规范，这样，各种电子乐器就可以互相链接起来，传达MIDI信息，形成一个真正的合成音乐演奏系统。</p><p>由于多媒体计算机技术的迅速发展，计算机对数字信号的强大的处理能力，使得计算机处理MIDI信息成为顺理成章的事情了，所以，现在不少人把MIDI音乐称之为电脑音乐。事实上，利用多媒体计算机不但可以播放、创作和实时地演奏MIDI音乐。甚至可以把MIDI音乐转变成看的见的乐谱（五线谱或简谱）打印出来，反之，也可以把乐谱变成美妙的音乐。利用MIDI的这个性质，可以用于音乐教学（尤其是识谱），让学生利用计算机学习音乐知识和创作音乐。</p><h4 id="M4A格式"><a href="#M4A格式" class="headerlink" title="M4A格式"></a>M4A格式</h4><p>M4A是MPEG4音频标准的文件的扩展名。在MPEG4标准中提到，普通的MPEG4文件扩展名是。mp4。自从Apple开始在它的iTunes以及iPod中使用。m4a以区别MPEG4的视频和音频文件以来，。m4a这个扩展名变得流行了。目前，几乎所有支持MPEG4音频的软件都支持。m4a。最常用的。m4a文件是使用AAC格式的（文件），不过其他的格式，比如AppleLossless甚至mp3也可以被放在。m4a容器里（TC注：这个container的概念类似于。mkv文件）。可以安全的把只包含音频的。mp4文件的扩展名改成。m4a，以便让它能在你喜欢的播放器里播放，反之亦然。</p><h4 id="VQF格式"><a href="#VQF格式" class="headerlink" title="VQF格式"></a>VQF格式</h4><p>VQF格式是由YAMAHA和NTT共同开发的一种音频压缩技术，它的核心是减少数据流量但保持音质的方法来达到更高的压缩比，它的压缩率能够达到1:18，因此相同情况下压缩后VQF的文件体积比MP3小30%～50%，更便利于网上传播，同时音质极佳，接近CD音质（16位44.1kHz立体声）。可以说VQF技术上也是很先进的，但VQF未公开技术标准，由于宣传不力，这种格式难有用武之地，至今未能流行开来。</p><h4 id="AAC-格式"><a href="#AAC-格式" class="headerlink" title="AAC+格式"></a>AAC+格式</h4><p>AAC+也称之为HE-AAC。</p><p>HE意思是”highefficiency”（高效性）。HE-AAC混合了AAC与SBR技术。SBR代表的是SpectralBand Replication（频段复制）。SBR的关键是在低码流下提供全带宽的编码而不会产生多余的信号。传统认为音频编码在低码流下意味着减少带宽和降低采样率（见MP3FAQ #7）或产生令人不快的噪音信号。SBR解决问题的方法是让核心编码去编码低频信号，而SBR解码器通过分析低频信号产生高频信号和一些保留在比特流中的指导信号（通常码流极低，~2kbps）。这就是采用无SBR解码器的原因，这样你的带宽（frequencyresponse）（频率响应）会被严重浪费。这也是为什么被叫做SpectralBand Replication的原因，它只是增加音频的带宽，而非重建。</p><h4 id="AIFF与AU格式"><a href="#AIFF与AU格式" class="headerlink" title="AIFF与AU格式"></a>AIFF与AU格式</h4><p>这里顺便提一下由苹果公司开发的AIFF（Audio Interchange FileFormat）</p><p>格式和为UNIX系统开发的AU格式，它们都和WAV非常相像，在大多数的音频编辑软件中也都支持它们这几种常见的音乐格式。</p><h3 id="无损压缩"><a href="#无损压缩" class="headerlink" title="无损压缩"></a>无损压缩</h3><p>对于我们最常说的“无损音频”来说，一般都是指传统CD格式中的16bit/44.1kHz采样率的文件格式，而知所以称为无损压缩，也是因为其包含了20Hz-22.05kHz这个完全覆盖人耳可闻范围的频响频率而得名。</p><p>音频的无损压缩，大家可能还比较陌生，但这并不意味着无损压缩技术发展得不好，相反，在无损压缩领域，早就有许多很出色的作品，比如APE、FLAC、WavPack、LPAC、WMALossless、AppleLossless、La、OptimFOG、Shoten等。</p><h4 id="CD格式"><a href="#CD格式" class="headerlink" title="CD格式"></a>CD格式</h4><p>即CD唱片，一张CD可以播放74分钟左右的声音文件，Windows系统中自带了一个CD播放机，另外多数声卡所附带的软件都提供了CD播放功能，甚至有一些光驱脱离电脑，只要接通电源就可以作为一个独立的CD播放机使用。</p><p>标准CD格式为44.1K的采样，速率88K/秒，16位量化位数，因为CD 可以说是近似无损的，因此它的声音基本上是忠于原声的，因此如果你如果是一个音响发烧友的话，CD是你的首选。它会让你感受到天籁之音。CD光盘可以在CD唱机中播放，也能用电脑里的各种播放软件来重放。但注意：不能直接的复制CD格式的文件到电脑硬盘上播放，需要使用像EAC这样的抓音轨软件把CD格式的文件转换成WAV，这个转换过程基本上是无损的。推荐大家使用这种方法。</p><h4 id="WAV格式"><a href="#WAV格式" class="headerlink" title="WAV格式"></a>WAV格式</h4><p>WAV格式是微软公司开发的一种声音文件格式，也叫波形声音文件，是最早的数字音频格式，被Windows平台及其应用程序广泛支持。WAV格式是以RIFF格式为标准的。RIFF是英文ResourceInterchange File Format的缩写，每个WAVE文件的头四个字节便是“RIFF”。WAVE文件由文件头和数据体两大部分组成。</p><p>WAV格式支持许多压缩算法，支持多种音频位数、采样频率和声道，采用44.1kHz的采样频率，16位量化位数，因此WAV的音质与CD相差无几，但WAV格式对存储空间需求太大不便于交流和传播。</p><p><strong>补充：WAV属于无损音乐格式，缺点：体积十分大！</strong></p><h4 id="FLAC格式"><a href="#FLAC格式" class="headerlink" title="FLAC格式"></a>FLAC格式</h4><p>FLAC即是FreeLossless Audio Codec的缩写，全称应该叫OGGFLAC，中文可解为无损音频压缩编码。它是OGG计划的一部分，当然也就是开源、免费的了，这也难怪它这么快就得到了多家MP3厂商的支持。</p><p>FLAC是一套著名的自由音频压缩编码，其特点是无损压缩。FLAC压缩比可以达到2：1，对于无损压缩来说，这已经是相当高的比例了；而且它解码速度快，只需进行整数运算即可完成整个解码过程，对CPU的运算能力要求很低，所以普通的随身听，都可以轻松实现实时解码。</p><p>不同于其他有损压缩编码如MP3 及AAC，它不会破坏任何原有的音频资讯，所以可以还原音乐光盘音质。现在它已被很多软件及硬件音频产品所支持。简而言之，FLAC与MP3相仿，但是是无损压缩的，也就是说音频以FLAC方式压缩不会丢失任何信息。这种压缩与Zip的方式类似，但是FLAC将给你更大的压缩比率，因为</p><p>FLAC是专门针对音频的特点设计的压缩方式，并且你可以使用播放器播放FLAC压缩的文件，就象通常播放你的MP3文件一样。</p><p><strong>补充：为无损格式，较ape而言，他体积大点，但是兼容性好，编码速度快，播放器支持更广</strong></p><h4 id="APE格式"><a href="#APE格式" class="headerlink" title="APE格式"></a>APE格式</h4><p>APE是目前流行的、由Monkey’sAudio出品的一种数字音乐文件格式，它出现得比FLAC早，而且名气也比FLAC大。与MP3、OGG这类有损压缩方式不同，APE是目前世界上惟一得到公认的音频无损压缩格式，也就是说当您将从音频CD上读取的音频数据文件压缩成APE格式后，您还可以再将APE格式的文件还原，而还原后的音乐文件与压缩前一模一样，没有任何损失。而现在越来越多的人将它在网络传播，因为被压缩后的APE文件容量要比WAV源文件小一半多，可以节约传输所用的时间，也更方便传播！由于APE的采样率高达800kbps～1400kbps，接近于音乐CD的1411.2kbps，远远高于MP3的128kbps，因此它在压缩后的音质和源文件音质几乎毫无差异，其音质之佳已经过了严格的盲听测试，得到了全世界发烧友的公认。APE的这些特点，都是其他无损压缩格式所争相效仿的。</p><p>在APE出现之前，音乐迷们都认为以CD或者WAV来保存自己喜欢的音乐素材是最好的方法了，但APE的出现，足以使他们改变这种看法，因为APE既可以保持音乐信号的无损，又可以以比WAV高得多的压缩率（接近2：1）压缩WAV文件，而且可以无须解压而直接播放。由于压缩后的APE文件只有原文件一半左右大小，APE格式受到了许多音乐爱好者的喜爱，特别是对于希望通过网络传输音频CD的朋友来说，APE可以帮助他们节约大量的资源。APE如此流行，在网上也比较容易能下载到APE格式的文件。</p><p><strong>补充：为无损压缩格式，较flac而言，他体积较小。编码速度偏慢。</strong></p><h3 id="压缩比较"><a href="#压缩比较" class="headerlink" title="压缩比较"></a>压缩比较</h3><h4 id="压缩比"><a href="#压缩比" class="headerlink" title="压缩比"></a>压缩比</h4><p><code>aac &gt; ogg &gt; mp3（wma） &gt; ape &gt; flac &gt; wav（同一音源条件下）</code></p><p>mp3和wma以192kbps为分界线，192kbps以上mp3好，192kbps以下wma好。</p><h4 id="音质"><a href="#音质" class="headerlink" title="音质"></a>音质</h4><p><code>wav = flac = ape &gt; aac &gt; ogg &gt; mp3 &gt; wma</code></p><h4 id="综合音质体积编码率"><a href="#综合音质体积编码率" class="headerlink" title="综合音质体积编码率"></a>综合音质体积编码率</h4><p><code>aac &gt; ogg &gt; flac &gt; ape &gt; mp3 &gt; wav、wma</code></p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 音频 </tag>
            
            <tag> 压缩 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用D3.JS进行坐标轴绘制和图绘制</title>
      <link href="/article/30b8.html"/>
      <url>/article/30b8.html</url>
      
        <content type="html"><![CDATA[<p>前面已经说过<code>D3</code>的功能十分强大，但是往往实际使用时只需要用到一部分内容，在这里，就只用到了 *<em>比例尺 *</em>和 *<em>布局 *</em>两部分，外加 *<em>核心 *</em>的请求部分（请求数据），分别用来绘制<code>Graph</code>的显示坐标轴和图的顶点及边；</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7ps52512q6cgj1n3qr501ab79.png" alt></p><h3 id="绘制坐标轴"><a href="#绘制坐标轴" class="headerlink" title="绘制坐标轴"></a>绘制坐标轴</h3><h4 id="传统坐标轴"><a href="#传统坐标轴" class="headerlink" title="传统坐标轴"></a>传统坐标轴</h4><p>这里指的是 *<em>第一象限 *</em>的坐标轴，即两轴的坐标均为正数，坐标原点为<code>(0,0)</code></p><p>具体可以看 <a href="https://blog.csdn.net/ning0_o/article/details/54948236" target="_blank" rel="external nofollow noopener noreferrer">这里</a>，说的比较详细。</p><h4 id="十字坐标轴"><a href="#十字坐标轴" class="headerlink" title="十字坐标轴"></a>十字坐标轴</h4><p>这里指的是 *<em>全象限 *</em>坐标轴，即两轴的坐标均从<code>-∞</code>开始，坐标原点为<code>(0,0)</code></p><p>本质上，仍然是一般坐标轴的变形，主要原理有两点：</p><ul><li>一是利用 *<em>比例尺 *</em>对源数据做符合中心坐标轴的变换；</li><li>二是创建坐标轴时利用<code>attr(&quot;transform&quot;,&quot;translate(0,&quot;+0.5*svgHight+&quot;)&quot;)</code>来对坐标轴进行平移，从而达到原点在画布中心的十字坐标轴的效果。</li></ul><h5 id="创建比例尺"><a href="#创建比例尺" class="headerlink" title="创建比例尺"></a><strong>创建比例尺</strong></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建比例尺  </span></span><br><span class="line"><span class="keyword">var</span> xScale = d3.scale.linear()  </span><br><span class="line">  .domain([<span class="number">-50</span>,<span class="number">50</span>]).range([<span class="number">0</span>,<span class="number">1000</span>]); </span><br><span class="line"><span class="comment">//意思为生成数据是[-50,50]，现在要映射到[0,1000]</span></span><br><span class="line"><span class="keyword">var</span> yScale = d3.scale.linear()  </span><br><span class="line">  .domain([<span class="number">-50</span>,<span class="number">50</span>]).range([<span class="number">1000</span>,<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><h5 id="添加坐标轴"><a href="#添加坐标轴" class="headerlink" title="添加坐标轴"></a><strong>添加坐标轴</strong></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> formatPrecision = d3.format(<span class="string">''</span>);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义X轴  </span></span><br><span class="line"><span class="keyword">var</span> xAxis = d3.svg.axis()  </span><br><span class="line">  .scale(xScale)</span><br><span class="line">  .ticks(<span class="number">11</span>)  <span class="comment">// 粗略的设置刻度线的数量，包括原点</span></span><br><span class="line">  .orient(<span class="string">'bottom'</span>)</span><br><span class="line">  .tickFormat(formatPrecision); <span class="comment">// 设置刻度格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义Y轴  </span></span><br><span class="line"><span class="keyword">var</span> yAxis = d3.svg.axis()  </span><br><span class="line">  .scale(yScale)  </span><br><span class="line">  .orient(<span class="string">'left'</span>)  </span><br><span class="line">  .ticks(<span class="number">11</span>)  </span><br><span class="line">  .tickFormat(formatPrecision);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建X轴, svg中： g元素是一个分组元素  </span></span><br><span class="line">svg.append(<span class="string">'g'</span>)  </span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">  .attr(<span class="string">"transform"</span>,<span class="string">"translate(0,"</span>+<span class="number">0.5</span>*svgHight+<span class="string">")"</span>)<span class="comment">// 平移到水平中间</span></span><br><span class="line">  .call(xAxis);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Y轴  </span></span><br><span class="line">svg.append(<span class="string">'g'</span>)  </span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'axis'</span>)</span><br><span class="line">  .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span>+<span class="number">0.5</span>*svgWidth+<span class="string">",0)"</span>)<span class="comment">// 平移到竖直中间</span></span><br><span class="line">  .call(yAxis);</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="绘制图（circle-line）"><a href="#绘制图（circle-line）" class="headerlink" title="绘制图（circle+line）"></a>绘制图（circle+line）</h3><p>关于图的绘制，本质上就是圆点和线的绘制，所以这也解释了为什么输入文件中的边数据也需要包含坐标的原因，因为在<code>d3</code>中绘制顶点和绘制边是互不相关的。</p><p>另外需要注意的是，这里不要直接返回源数据坐标，要带入到上述定义的 *<em>比例尺 *</em>中。</p><p>话不多说直接上代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建SVG  </span></span><br><span class="line"><span class="keyword">var</span> svg = d3.select(<span class="string">'#div'</span>+index)  </span><br><span class="line">  .append(<span class="string">'svg'</span>)  </span><br><span class="line">.attr(<span class="string">'width'</span>, svgWidth)  </span><br><span class="line">.attr(<span class="string">'height'</span>, svgHight);  </span><br><span class="line"><span class="comment">// 设置标题  </span></span><br><span class="line">svg.append(<span class="string">'text'</span>)  </span><br><span class="line">  .attr(<span class="string">'x'</span>, svgWidth / <span class="number">2</span> - <span class="number">120</span>)  </span><br><span class="line">  .attr(<span class="string">'y'</span>, <span class="number">30</span>)  </span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'title'</span>)  </span><br><span class="line">  .text(<span class="string">'这是一个用d3画的简略坐标轴'</span>);  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// 画点，即绘制图的顶点</span></span><br><span class="line">svg.selectAll(<span class="string">'circle'</span>)  </span><br><span class="line">.data(data.nodes)           <span class="comment">// json对象</span></span><br><span class="line">  .enter()  </span><br><span class="line">  .append(<span class="string">'circle'</span>)  </span><br><span class="line">.attr(<span class="string">'cx'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">return</span> xScale(d.cx);      <span class="comment">// 使用比例尺返回合适的变换</span></span><br><span class="line">&#125;)  </span><br><span class="line">.attr(<span class="string">'cy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">return</span> yScale(d.cy);      <span class="comment">// 同上</span></span><br><span class="line">&#125;)  </span><br><span class="line">.attr(<span class="string">"fill"</span>,<span class="string">"#6495ed"</span>)     <span class="comment">// 填充颜色</span></span><br><span class="line">.attr(<span class="string">"origin"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;  </span><br><span class="line"><span class="keyword">return</span> d.cx+<span class="string">","</span>+d.cy;</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">'r'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123;    <span class="comment">// 圆点直径（大小）</span></span><br><span class="line">  <span class="keyword">if</span>(d.value === <span class="number">0</span>||d.value/<span class="number">2</span>===<span class="number">0</span>)<span class="keyword">return</span> <span class="number">2</span>; </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> d.value/<span class="number">2</span>;</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 画线，即绘制图的边</span></span><br><span class="line">svg.selectAll(<span class="string">'line'</span>)</span><br><span class="line">.data(data.links)            <span class="comment">// json对象</span></span><br><span class="line">.enter()</span><br><span class="line">.append(<span class="string">'line'</span>)</span><br><span class="line">.attr(<span class="string">'x1'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> xScale(d.x1);</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">'y1'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> yScale(d.y1);</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">'x2'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> xScale(d.x2);</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">'y2'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> yScale(d.y2);</span><br><span class="line">&#125;)</span><br><span class="line">.attr(<span class="string">"stroke"</span>,<span class="string">"gray"</span>)  <span class="comment">// 边的颜色</span></span><br><span class="line">.attr(<span class="string">'stroke-width'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0.2</span>;         <span class="comment">// 边的宽度（粗细）</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="数据读入"><a href="#数据读入" class="headerlink" title="数据读入"></a>数据读入</h3><p>在数据读取方面，<code>d3.js</code>本身提供了一套请求操作，属于 *<em>核心 *</em>部分。具体的操作如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7se3aa1vfe1cct11ai1pgo1mbam.png" alt></p><p>可以直接使用上述的API进行文件读取，非常方便</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d3.csv(<span class="string">"data.csv"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error,data</span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">if</span>(error)&#123;...&#125;</span><br><span class="line">    esle&#123;...&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>当然可以完美的结合<code>JQuery</code>进行数据操作：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.getJSON(<span class="string">"data.json, "</span><span class="string">", function(data) &#123;</span></span><br><span class="line"><span class="string">    // 前面各部分内容，对data进行解析即可</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h3><p>数据格式，见文章 <a href="#">D3+Node快速实现图数据的可视化</a></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf8beqjs1b1i1j5ntjftg31ric9.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 图数据 </tag>
            
            <tag> D3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D3+Node快速实现图数据的可视化</title>
      <link href="/article/45f4.html"/>
      <url>/article/45f4.html</url>
      
        <content type="html"><![CDATA[<p>这里的图数据特指布局后的图数据，主要包括顶点信息（ID和坐标等）以及边信息，先前已经写过如何使用<code>Gephi</code>来进行数据的可视化，具体文章见：</p><a id="more"></a><p><a href>Gephi-Toolkit的引入与使用</a></p><h3 id="Gexf"><a href="#Gexf" class="headerlink" title="Gexf"></a>Gexf</h3><p> <code>Gexf</code>是<code>Gephi</code>的输入数据格式，其本质上是XML文件格式，标注了顶点信息和边信息。</p><p> <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7mj8lb19471bm2k4vjj61ag19.png" alt></p><p>如果我们想让自己的布局代码生成的数据直接拿到<code>Gephi</code>中展示，那就还需要有一步将数据构造成上图的格式，说道使用<code>Gephi</code>进行布局的可视化，虽然可以使用<code>Gephi-Toolkit</code>进行，已经是比较轻量的嵌入到原有项目中，但还是耦合较高，需要多处硬编码联动，并且在二次利用时针对XML的解析往往是不够高效的。</p><h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p>JSON格式大家都十分耳熟能详了，针对上述的<code>Gexf</code>的种种局限，使用前端可视化工具可以作为一个解决方案，布局程序只需生成指定格式的<code>JSON</code>数据，然后由<code>D3.js</code>进行解析绘制即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7nartr1g4356n1sqo1qvo1fff13.png" alt></p><p>由上图可以看出，其整体结构比<code>Gexf</code>要更简单，但是有部分坐标冗余，不过影响不大，使用JSON的好处是可以方便的对数据进行操作（无论是在前端还是后端）</p><h3 id="D3-JS"><a href="#D3-JS" class="headerlink" title="D3.JS"></a>D3.JS</h3><p>关于<code>D3</code>的详细叙述，请移步 <a href="https://github.com/d3/d3/wiki/API--%E4%B8%AD%E6%96%87%E6%89%8B%E5%86%8C" target="_blank" rel="external nofollow noopener noreferrer">这里</a>，注意现在已经有 <a href="https://github.com/xswei/d3js_doc" target="_blank" rel="external nofollow noopener noreferrer">D3.V4</a> 版本了（其实<code>V5</code>也有了）。</p><h3 id="Node的作用"><a href="#Node的作用" class="headerlink" title="Node的作用"></a>Node的作用</h3><p>这里为什么要用<code>Node</code>，其实主要是为了起一个<code>Server</code>，由上面的叙述可以知道，这里<code>d3</code>需要读取<code>json</code>文件，那么问题来了，直接静态打开是会报错的，必须放到一个<code>Server</code>内以请求的方式进行才可以，这个<code>Server</code>从何而来，当然可以是<code>Tomcat</code>，但是，人总是要接受新事物，<code>Node</code>的强大已经在各方面都慢慢体现出来了，服务容器当然也有他的身影，这里我只用了其中一种方式（<code>http-server</code>），如果时间允许自己实现一个也是可以的。</p><p><code>http-server</code>除了可以快速起<code>Server</code>外，还具有实时更新的功能，即，我只管往目录内写（更新）文件，然后用<code>d3</code>进行绘制，更新的部分会自动更新到<code>Server</code>，即重写覆写文件后我不需要重开<code>Server</code>，只需要刷新一下页面即可。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf8bno1ubslm5a1q4g1b5h83n9.png" alt></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="http-server的使用方式"><a href="#http-server的使用方式" class="headerlink" title="http-server的使用方式"></a>http-server的使用方式</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hadoop@msi-PC MINGW64 ~/Desktop/CNPM</span><br><span class="line"><span class="meta">$</span><span class="bash"> node --version                // 随便新建个目录并初始化</span></span><br><span class="line">v8.9.0</span><br><span class="line"></span><br><span class="line">hadoop@msi-PC MINGW64 ~/Desktop/CNPM</span><br><span class="line"><span class="meta">$</span><span class="bash"> cnpm install http-server -g   // 安装http-server</span></span><br><span class="line"></span><br><span class="line">hadoop@msi-PC MINGW64 ~/Desktop/CNPM</span><br><span class="line"><span class="meta">$</span><span class="bash"> http-server -p 8888           // 开启Server</span></span><br><span class="line">Starting up http-server, serving ./</span><br><span class="line">Available on:</span><br><span class="line">  http://192.168.230.1:8888</span><br><span class="line">  http://192.168.146.1:8888</span><br><span class="line">  http://127.0.0.1:8888</span><br><span class="line">Hit CTRL-C to stop the server</span><br></pre></td></tr></table></figure><p>完成后的目录如下所示，这里的整个目录就如同<code>Tomcat</code>的<code>Webapp</code>目录一样；</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceeh81vi3s41lke2a81pvme5f9.png" alt></p><p>注意：这里的文件是可以动态增删改的</p><h3 id="最后的检验"><a href="#最后的检验" class="headerlink" title="最后的检验"></a>最后的检验</h3><p>这里使用<code>d3</code>直接尝试读取生成的<code>csv</code>文件，目的是验证d3是否能够取到生成的数据文件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/d3/4.13.0/d3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span> </span><br><span class="line"><span class="actionscript">d3.csv(<span class="string">"nodes.csv"</span>,<span class="function"><span class="keyword">function</span><span class="params">(error,csvdata)</span></span>&#123;  </span></span><br><span class="line">if(error)&#123;  </span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(error);  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(csvdata);    </span></span><br><span class="line">&#125;);  </span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打开浏览器输入<code>localhost:8888/view.html</code>在<code>Console</code>中会发现<code>csv</code>内的数据已经被读取到。</p><p>  <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cefs4k8m12861bht1u2lq73pusm.png" alt></p><p>注意，必须是以请求的方式进行读取，否则会发生如下错误（如果直接以静态资源的方式打开<code>view.html</code>）</p><p>  <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cefs2r2qujrl4ip3ekk81ggg9.png" alt></p><h3 id="坐标轴绘制、图绘制"><a href="#坐标轴绘制、图绘制" class="headerlink" title="坐标轴绘制、图绘制"></a>坐标轴绘制、图绘制</h3><p>详见 <a href>使用D3.JS进行坐标轴绘制和图绘制</a></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> D3 </tag>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA自动生成Javadoc代码注释</title>
      <link href="/article/f986.html"/>
      <url>/article/f986.html</url>
      
        <content type="html"><![CDATA[<p>在日常写代码时往往不会注重注释的格式、规范等问题，可能注释都不会写，但是一旦代码完成后要交付他人，就需要考虑注释的问题了，因为重要函数、方法的注释往往对整个代码的阅读起着十分重要的作用，在<code>eclipse</code>中，我们可以自动生成注释的模板，在<code>IDEA</code>中显然也是可以的，下面就介绍两种生成注释的方式。</p><a id="more"></a><h3 id="Jindent"><a href="#Jindent" class="headerlink" title="Jindent"></a>Jindent</h3><p>Jindent是一个十分强大的代码格式化工具，它不局限于IDE插件，其本身就是进行代码格式化的，官网如下：<br><a href="http://www.newforms-tech.com/products/jindent/about" target="_blank" rel="external nofollow noopener noreferrer">http://www.newforms-tech.com/products/jindent/about</a></p><p>安装教程 <a href="https://blog.csdn.net/liyanlei5858/article/details/51312600" target="_blank" rel="external nofollow noopener noreferrer">点击此处</a></p><p>注意：注释添加不成功，弹出需要License许可，看来不是拿来即用的插件；<br>可以对代码进行格式化，但只能对Java和C/C++代码进行代码格式化，其他语言执行格式化不会有反应；</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="Live-Templates"><a href="#Live-Templates" class="headerlink" title="Live Templates"></a>Live Templates</h3><p>这是<code>IDEA</code>的自带功能，主要目的是使用快捷键快速生成固定模式的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def main(args: Array[String]): Unit &#x3D; &#123;</span><br><span class="line">  $END$</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>比如上述代码只需在编辑器内输入<code>main</code>四个字符，然后敲击<code>tab键</code>即可出现整段代码，利用这一特性，当然的可以进行函数注释的生成。</p><p>首先，在<code>File</code>-&gt;<code>Setting</code>-&gt;<code>搜索Live转到Live Templates</code>，然后<code>新建Template</code>并输入名称</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7jnpj21d7d1ktnuml11hj1fdk9.png" alt></p><p>选中建好的Template再点击上图中的<code>Live Template</code>，新建一个模板；</p><p>对于注释的模板，可以按类和函数分为<code>class</code>和<code>def</code>两个关键词，例如<code>def</code>的注释</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7k4ij1ho418o0ovm1anq1rnbm.png" alt></p><p>可以发现，其关键就是变量参数指定的<code>Expression</code>，正是这些指定使得模板可以将参数、返回类型等统统取到并替换进模板中。</p><p>最终的效果是，只需编辑<code>def+tab键</code>，即可在指定位置生成注释，然后将<code>description</code>添加上之后，对这个函数的注释就算完成了。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cf7k8nhh1oo1co8mv41og21gh213.png" alt></p><p>按同样的方式，可以对比如<code>Class</code>等结构定义模板，进行注释的快速生成</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> 扩展 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark集群从搭建到任务提交-第N次记录</title>
      <link href="/article/1289.html"/>
      <url>/article/1289.html</url>
      
        <content type="html"><![CDATA[<p>作为一名合格的计算机人士，百折不挠的瞎折腾精神是必备的。今天本想使用一下尘封已久的VMware虚拟机搭的集群，结果发现 Spark 有各种问题，应该是之前潦草搭集群时挖下的坑（前几天也用过，但并不是<code>cluster mode</code>，我现在才知道..），面对这些坑，果断的选择重装啊，所以叒叒叒开始愉快的搭环境了，，</p><a id="more"></a><p>不过这次格外注重了各处细节，力图条理清晰的记录一次搭建过程，除了 Scala 和 Spark 的搭建过程，当然还有运行调试（这才是关键）部分，包括用IDEA打包 jar 上传执行 和IDEA远程提交执行，这里也都分别作了记录。</p><p>关于IDEA提交Spark任务的几种方式，可以参见我 <a href="https://old.cz5h.com/article/2018-5-14%20%E6%8F%90%E4%BA%A4Spark%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html" target="_blank" rel="external nofollow noopener noreferrer">另一篇文章</a> .</p><h3 id="集群环境"><a href="#集群环境" class="headerlink" title="集群环境"></a>集群环境</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebhufs6uifapaadi18is1tnv9.png" alt></p><p>得亏了我<code>16G</code>的内存，四个虚拟机全开还可以娱乐的玩耍，这四台虚拟机已经装过<code>Hadoop</code>了，<code>Hadoop</code>集群用起来也没什么问题，就保留了。</p><p>各版本如下：</p><table><thead><tr><th>配置项</th><th align="right">版本</th><th align="center">备注</th></tr></thead><tbody><tr><td>Hadoop</td><td align="right">2.7.3</td><td align="center"></td></tr><tr><td>Java</td><td align="right">1.8.0</td><td align="center"></td></tr><tr><td>Scala</td><td align="right">2.11.8</td><td align="center">待安装</td></tr><tr><td>Spark</td><td align="right">2.2.0</td><td align="center">待安装</td></tr></tbody></table><h3 id="主节点安装Scala环境"><a href="#主节点安装Scala环境" class="headerlink" title="主节点安装Scala环境"></a>主节点安装Scala环境</h3><ul><li>下载、解压、改名、放到自定义路径 </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget http://downloads.lightbend.com/scala/2.11.8/scala-2.11.8.tgz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf scala-2.11.8.tgz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv scala-2.11.8.tgz scala</span></span><br></pre></td></tr></table></figure><ul><li>更新 <code>/etc/profile</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo vi /etc/profile</span></span><br><span class="line"></span><br><span class="line">    //在文件的最后插入</span><br><span class="line">    export SCALA_HOME=/usr/local/scala</span><br><span class="line">    export PATH=$PATH:$SCALA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure><ul><li>检测是否安装成功</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> scala -version</span></span><br></pre></td></tr></table></figure><h3 id="主节点配置Spark"><a href="#主节点配置Spark" class="headerlink" title="主节点配置Spark"></a>主节点配置Spark</h3><ul><li>下载、解压、改名、放到自定义目录</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> wget http://d3kbcqa49mib13.cloudfront.net/spark-2.2.0-bin-hadoop2.7.tgz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf spark-2.2.0-bin-hadoop2.7.tgz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv spark-2.2.0-bin-hadoop2.7 spark</span></span><br></pre></td></tr></table></figure><ul><li>更新 <code>/etc/profile</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi /etc/profile</span></span><br><span class="line"></span><br><span class="line">    //在最后加入</span><br><span class="line">    export SPARK_HOME=/usr/local/spark</span><br><span class="line">    export PATH=$PATH:$SPARK_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">source</span> /etc/profile</span></span><br></pre></td></tr></table></figure><ul><li>修改Spark配置文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> spark/conf</span></span><br><span class="line"></span><br><span class="line">//先改名，把template去掉</span><br><span class="line"><span class="meta">$</span><span class="bash"> mv spark-env.sh.template spark-env.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv slaves.sh.template slaves.sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi conf/spark-env.sh</span></span><br><span class="line">    //在最后添加各项变量值</span><br><span class="line">    export JAVA_HOME=/usr/local/java/jdk1.8.0_112</span><br><span class="line">    export HADOOP_HOME=/usr/local/hadoop</span><br><span class="line">    export HADOOP_CONF_DIR=/usr/local/hadoop/etc/hadoop</span><br><span class="line">    export SCALA_HOME=/usr/local/scala</span><br><span class="line">    export SPARK_MASTER_IP=192.168.146.130(hadoop01)</span><br><span class="line">    export SPARK_WORKER_MEMORY=1g</span><br><span class="line">    export SPARK_WORKER_CORES=1</span><br><span class="line">    export SPARK_WORKER_INSTANCES=1</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> vi conf/slaves</span></span><br><span class="line">    //在最后添加各从节点映射（主机名或IP）</span><br><span class="line">    hadoop02</span><br><span class="line">    hadoop03</span><br><span class="line">    hadoop04</span><br><span class="line"></span><br><span class="line">//还有spark-defaults.conf，一开始没改，结果导致出错   </span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="comment"># spark-defaults.conf 的修改在后面</span></span></span><br></pre></td></tr></table></figure><h3 id="拷贝分发调试集群"><a href="#拷贝分发调试集群" class="headerlink" title="拷贝分发调试集群"></a>拷贝分发调试集群</h3><ul><li>分发拷贝到各 <code>Slave</code> 节点（其实可以脚本化，偷懒..）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//scala</span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r scala  hadoop02:/usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r scala  hadoop03:/usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r scala  hadoop04:/usr/<span class="built_in">local</span>/</span></span><br><span class="line">//spark</span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r spark  hadoop02:/usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r spark  hadoop03:/usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scp -r spark  hadoop04:/usr/<span class="built_in">local</span>/</span></span><br><span class="line">//profile</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo scp /etc/profile hadoop02:/etc/profile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo scp /etc/profile hadoop03:/etc/profile</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo scp /etc/profile hadoop04:/etc/profile</span></span><br></pre></td></tr></table></figure><ul><li>调试集群</li></ul><p>因为我们只需要使用hadoop的HDFS文件系统，所以我们并不用把hadoop全部功能都启动。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> start-dfs.sh</span></span><br></pre></td></tr></table></figure><p>因为 <code>hadoop/sbin</code> 以及 <code>spark/sbin</code> 均配置到了系统的环境中，它们同一个文件夹下存在同样的 <code>start-all.sh</code> 文件。最好是打开<code>spark-2.2.0</code> ，在文件夹下面打开该文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/spark/sbin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./start-all.sh</span></span><br></pre></td></tr></table></figure><ul><li>各节点的正常状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 ~]$ jps</span><br><span class="line">18822 SecondaryNameNode</span><br><span class="line">18521 NameNode</span><br><span class="line">18634 DataNode</span><br><span class="line">18990 Master</span><br><span class="line">19055 Jps</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop02 ~]$ jps</span><br><span class="line">33380 DataNode</span><br><span class="line">33589 Jps</span><br><span class="line">33519 Worker</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop03 ~]$ jps</span><br><span class="line">25876 Jps</span><br><span class="line">25656 DataNode</span><br><span class="line">25806 Worker</span><br><span class="line"></span><br><span class="line">[hadoop@hadoop04 ~]$ jps</span><br><span class="line">32162 Worker</span><br><span class="line">32025 DataNode</span><br><span class="line">32234 Jps</span><br></pre></td></tr></table></figure><p>注意这里是 <code>3</code> 个 <code>worker</code> 因为 <code>master</code> 节点没有 配置启动 <code>Worker</code>，当然可以配置（比如 <code>hdfs</code> 就是四个 <code>datanode</code>）<br>但是这里 spark 要执行计算任务，所以主节点最好不要有worker以免出现计算任务争夺主节点资源</p><ul><li>Spark UI 正常视图</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb5bjapsokfff5ir13h31sct9.png" alt></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="IDEA-项目打包"><a href="#IDEA-项目打包" class="headerlink" title="IDEA 项目打包"></a>IDEA 项目打包</h3><ul><li>项目示例</li></ul><p>这里的实例程序 读取 <code>hdfs</code> 文件 <code>Vote-demo.txt</code>，并且使用 <code>GraphX</code> 读取文件生成图，并打印图的边数。</p><p> <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb89rub18571sti1l8rv8iamb7r.png" alt></p><ul><li>示例代码 <code>RemoteDemo.scala</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Remote</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.graphx.&#123;Edge, Graph&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.RDD</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;SparkConf, SparkContext&#125;</span><br><span class="line"></span><br><span class="line">object RemoteDemo &#123;</span><br><span class="line">  <span class="function">def <span class="title">main</span><span class="params">(args: Array[String])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    val conf = <span class="keyword">new</span> SparkConf()</span><br><span class="line">      .setAppName(<span class="string">"SimpleDemo"</span>)</span><br><span class="line">      .setMaster(<span class="string">"spark://hadoop01:7077"</span>)</span><br><span class="line">      .setJars(List(<span class="string">"I:\\IDEA_PROJ\\VISNWK\\out\\artifacts\\visnwk_jar\\visnwk.jar"</span>))</span><br><span class="line"></span><br><span class="line">    val sc = <span class="keyword">new</span> SparkContext(conf)</span><br><span class="line"></span><br><span class="line">    <span class="function">def <span class="title">loadEdges</span><span class="params">(fn: String)</span>: Graph[Any, String] </span>= &#123;</span><br><span class="line">      val edges: RDD[Edge[String]] =</span><br><span class="line">        sc.textFile(fn).filter(l =&gt; !(l.startsWith(<span class="string">"#"</span>))).map &#123; <span class="comment">//无放回</span></span><br><span class="line">          line =&gt;</span><br><span class="line">            val fields = line.split(<span class="string">"\t"</span>)</span><br><span class="line">            Edge(fields(<span class="number">0</span>).toLong, fields(<span class="number">1</span>).toLong, <span class="string">"1.0"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      val graph: Graph[Any, String] = Graph.fromEdges(edges, <span class="string">"defaultProperty"</span>)</span><br><span class="line">      graph</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val graph = loadEdges(<span class="string">"hdfs://hadoop01:9000/TVCG/SNAP/DATASET/Vote-demo.txt"</span>)</span><br><span class="line"></span><br><span class="line">    println(s<span class="string">"graph.edges.count() = $&#123;graph.edges.count()&#125;"</span>)</span><br><span class="line">    </span><br><span class="line">    sc.stop <span class="comment">// 一开始没加，报错了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>打包项目，注意指定 <code>Main Class</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb7g47a1206124fcqc1u1p14o757.png" alt></p><ul><li><code>Build</code> 打包</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb7qc821iij1eq76hbcvvnpj71.png" alt></p><ul><li>运行配置 <code>Run Configure</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb971s4ntcn0m1bu51h38irp88.png" alt></p><hr><h3 id="错误，IDEA远程连接失败"><a href="#错误，IDEA远程连接失败" class="headerlink" title="错误，IDEA远程连接失败"></a>错误，IDEA远程连接失败</h3><ul><li>错误详情</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb99lcf13h0dq0p4ppav193u8l.png" alt></p><h3 id="错误排查一"><a href="#错误排查一" class="headerlink" title="错误排查一"></a>错误排查一</h3><ul><li><p>Spark://Hadoop01:7077</p><p>  spark://host_name:7077 改为 spark://master_ip:7077</p></li><li><p>修改配置 <code>spark-env.sh</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb9hgr36qip1l15293qtc61b2.png" alt></p><ul><li>重启 <code>saprk</code> 集群</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./sbin/stop-all.sh</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./sbin/start-all.sh</span></span><br></pre></td></tr></table></figure><ul><li>Spark UI <code>Master_IP:8080</code> 显示正常</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ceb9rf071juv1c1i16lb1bj017hqg6.png" alt></p><h3 id="错误排查二"><a href="#错误排查二" class="headerlink" title="错误排查二"></a>错误排查二</h3><ul><li>修改 Spark <code>spark-defaults.conf</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebbgifqmcn3fn18m819e61ki99.png" alt></p><h3 id="错误排查三"><a href="#错误排查三" class="headerlink" title="错误排查三"></a>错误排查三</h3><ul><li><p>排除集群本身问题，尝试spark-submit 提交</p></li><li><p>采用不打包依赖的方式打包（注意打包后只有 300kb）</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebcaiu3guc6rk15jur0v65p13.png" alt></p><ul><li><strong>集群</strong> 打印了下述错误</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">[hadoop@hadoop01 bin]$ ./spark-submit --class "Remote.RemoteDemo" ~/visnwk-build.jar</span><br><span class="line"><span class="number">17</span>/<span class="number">07</span>/<span class="number">03</span> <span class="number">19</span>:<span class="number">48</span>:<span class="number">53</span> WARN NativeCodeLoader: Unable to load <span class="keyword">native</span>-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line">17/07/03 19:49:03 ERROR TransportRequestHandler: Error while invoking RpcHandler#receive() for one-way message.</span><br><span class="line">org.apache.spark.SparkException: Could not find AppClient.</span><br><span class="line">        at org.apache.spark.rpc.netty.Dispatcher.postMessage(Dispatcher.scala:<span class="number">154</span>)</span><br><span class="line">        at org.apache.spark.rpc.netty.Dispatcher.postOneWayMessage(Dispatcher.scala:<span class="number">134</span>)</span><br><span class="line">        at org.apache.spark.rpc.netty.NettyRpcHandler.receive(NettyRpcEnv.scala:<span class="number">644</span>)</span><br><span class="line">        at org.apache.spark.network.server.TransportRequestHandler.processOneWayMessage(TransportRequestHandler.java:<span class="number">178</span>)</span><br><span class="line">        at org.apache.spark.network.server.TransportRequestHandler.handle(TransportRequestHandler.java:<span class="number">107</span>)</span><br><span class="line">        at org.apache.spark.network.server.TransportChannelHandler.channelRead(TransportChannelHandler.java:<span class="number">118</span>)</span><br><span class="line">        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:<span class="number">357</span>)</span><br><span class="line">        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:<span class="number">343</span>)</span><br><span class="line">        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:<span class="number">336</span>)</span><br><span class="line">        at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:<span class="number">287</span>)</span><br></pre></td></tr></table></figure><p>解决：<a href="http://www.mamicode.com/info-detail-1879289.html" target="_blank" rel="external nofollow noopener noreferrer"> 这里 </a></p><p>示例代码最后添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.stop</span><br></pre></td></tr></table></figure><ul><li><strong>集群提交</strong> 运行正常</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebedvpdejeftfhq513pbmgk3q.png" alt></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.146.130:4040/jobs/  4040 UI界面只有在job运行时才可见，运行完后就不可访问</span><br></pre></td></tr></table></figure><ul><li>集群输出正常</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebe4200192g1bec1qa91acr1i9l2d.png" alt></p><hr><h3 id="回到IDEA提交问题"><a href="#回到IDEA提交问题" class="headerlink" title="回到IDEA提交问题"></a>回到IDEA提交问题</h3><ul><li>比较这个错误（和一个错误IP相比）</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;直接用xxxx这个错误IP报错如下</span><br><span class="line">18&#x2F;05&#x2F;25 19:06:20 INFO SparkUI: Bound SparkUI to 0.0.0.0, and started at http:&#x2F;&#x2F;118.202.40.210:4042</span><br><span class="line">18&#x2F;05&#x2F;25 19:06:20 INFO StandaloneAppClient$ClientEndpoint: Connecting to master spark:&#x2F;&#x2F;xxxxx:7077...</span><br><span class="line">18&#x2F;05&#x2F;25 19:06:23 WARN TransportClientFactory: DNS resolution for xxxxx:7077 took 2551 ms</span><br><span class="line">18&#x2F;05&#x2F;25 19:06:23 WARN StandaloneAppClient$ClientEndpoint: Failed to connect to master xxxxx:7077</span><br><span class="line">org.apache.spark.SparkException: Exception thrown in awaitResult</span><br><span class="line">at org.apache.spark.rpc.RpcTimeout$$anonfun$1.applyOrElse(RpcTimeout.scala:77)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;用master_ip报错如下</span><br><span class="line">18&#x2F;05&#x2F;25 19:07:26 INFO SparkUI: Bound SparkUI to 0.0.0.0, and started at http:&#x2F;&#x2F;118.202.40.210:4040</span><br><span class="line">18&#x2F;05&#x2F;25 19:07:27 INFO StandaloneAppClient$ClientEndpoint: Connecting to master spark:&#x2F;&#x2F;192.168.146.130:7077...</span><br><span class="line">18&#x2F;05&#x2F;25 19:07:27 INFO TransportClientFactory: Successfully created connection to &#x2F;192.168.146.130:7077 after 23 ms (0 ms spent in bootstraps)</span><br><span class="line">18&#x2F;05&#x2F;25 19:07:27 WARN StandaloneAppClient$ClientEndpoint: Failed to connect to master 192.168.146.130:7077</span><br><span class="line">org.apache.spark.SparkException: Exception thrown in awaitResult</span><br><span class="line">at org.apache.spark.rpc.RpcTimeout$$anonfun$1.applyOrElse(RpcTimeout.scala:77)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;比较上述代码，会发现虽然最后的错误一样，但是中间日志并不一样，所以并不是简单的连接失败</span><br></pre></td></tr></table></figure><ul><li>怀疑是 7077 端口的问题，但发现绑定一切正常</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebg22sd1m51qslcsu1hfampd9.png" alt></p><ul><li><p>怀疑是版本的问题了，集群是 scala-2.11.8 + Spark-2.2.0</p><p>  解决：<a href="https://stackoverflow.com/questions/34518669/unable-to-connect-to-spark-master" target="_blank" rel="external nofollow noopener noreferrer"> 这里 </a></p></li><li><p>修改 sbt 中 spark 的版本，原来的是 2.1.0 我擦！</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libraryDependencies +&#x3D; &quot;org.apache.spark&quot; %% &quot;spark-core&quot; % &quot;2.2.0&quot;</span><br><span class="line">libraryDependencies +&#x3D; &quot;org.apache.spark&quot; %% &quot;spark-graphx&quot; % &quot;2.2.0&quot;</span><br></pre></td></tr></table></figure><ul><li>再运行，已越过那个错误~（原来是setJar注释掉了），补全之：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val conf &#x3D; new SparkConf()</span><br><span class="line">    .setAppName(&quot;SimpleDemo&quot;)</span><br><span class="line">    .setMaster(&quot;spark:&#x2F;&#x2F;192.168.146.130:7077&quot;)</span><br><span class="line">    &#x2F;&#x2F;.setIfMissing(&quot;spark.driver.host&quot;, &quot;127.0.0.1&quot;) &#x2F;&#x2F; 不设置会默认使用本机的物理IP</span><br><span class="line">    .setJars(List(&quot;I:\\IDEA_PROJ\\VISNWK\\out\\artifacts\\visnwk_jar\\visnwk.jar&quot;))</span><br><span class="line"></span><br><span class="line">val sc &#x3D; new SparkContext(conf)</span><br></pre></td></tr></table></figure><ul><li>完美的收官：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO DAGScheduler: Job 0 finished: reduce at EdgeRDDImpl.scala:90, took 60.614562 s</span><br><span class="line">graph.edges.count() &#x3D; 103689  &#x2F;&#x2F; 终于等到你！！</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO SparkUI: Stopped Spark web UI at http:&#x2F;&#x2F;118.202.40.210:4040</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO StandaloneSchedulerBackend: Shutting down all executors</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO CoarseGrainedSchedulerBackend$DriverEndpoint: Asking each executor to shut down</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO MemoryStore: MemoryStore cleared</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO BlockManager: BlockManager stopped</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO BlockManagerMaster: BlockManagerMaster stopped</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO SparkContext: Successfully stopped SparkContext</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO ShutdownHookManager: Shutdown hook called</span><br><span class="line">18&#x2F;05&#x2F;25 19:25:36 INFO ShutdownHookManager: Deleting directory C:\Users\msi\AppData\Local\Temp\spark-fae200dd-12cc-4b8a-b2ec-751d641d3689</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><ul><li><p>任务运行时 <a href="http://118.202.40.210:4040/environment/" target="_blank" rel="external nofollow noopener noreferrer">http://118.202.40.210:4040/environment/</a> 显示的状态</p><p>  注：本机 windows ip 为 118.202.40.210 </p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cebie8dd1dbitqprrbdf15t9m.png" alt></p><h3 id="其他各种问题"><a href="#其他各种问题" class="headerlink" title="其他各种问题"></a>其他各种问题</h3><ul><li><a href="https://www.jianshu.com/p/0de92480b8b6" target="_blank" rel="external nofollow noopener noreferrer">Spark常见问题解决办法</a></li><li><a href="https://blog.csdn.net/you12345678901234567/article/details/52763713" target="_blank" rel="external nofollow noopener noreferrer">Spark各种问题的解决</a></li><li><a href="https://www.cnblogs.com/bigbigtree/p/5685298.html" target="_blank" rel="external nofollow noopener noreferrer">Spark集群配置</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> 集群 </tag>
            
            <tag> Spark </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用SBT正确构建IndexedRDD环境</title>
      <link href="/article/970d.html"/>
      <url>/article/970d.html</url>
      
        <content type="html"><![CDATA[<p><code>IndexedRDD</code>由<code>AMPLab</code>的<code>Ankur Dave</code>提出，它是<code>Immutability</code>和<code>Fine-Grained updates</code>的精妙结合。<code>IndexedRDD</code>是一个基于<code>RDD</code>的<code>Key-Value Store</code>，扩展自<code>RDD[(K, V)]</code>，可以在<code>IndexRDD</code>上进行高效的查找、更新以及删除。由于其并没有合并到 <code>Spark</code> 的主项目分支，所以在使用时需要引入特别的对其的支持。</p><a id="more"></a><p><a href="https://blog.csdn.net/zcf1002797280/article/details/49657757" target="_blank" rel="external nofollow noopener noreferrer">IndexedRDD的详细分析</a></p><p>这里主要是记录引进 <code>IndexedRDD</code> 之后项目出现的各种错误及解决过程，目前关于 <code>IndexedRDD</code> 的文章不多，百度出来的与搭环境有关系的也就十几篇左右，出现错误更是无解，所以特此记录一下填坑之路。</p><h3 id="开始引入-IndexedRDD"><a href="#开始引入-IndexedRDD" class="headerlink" title="开始引入 IndexedRDD"></a>开始引入 IndexedRDD</h3><p>参见 <a href="https://github.com/amplab/spark-indexedrdd" target="_blank" rel="external nofollow noopener noreferrer">Github</a> 的说明，在 build.sbt 中添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;这句很关键</span><br><span class="line">resolvers +&#x3D; &quot;Spark Packages Repo&quot; at &quot;http:&#x2F;&#x2F;dl.bintray.com&#x2F;spark-packages&#x2F;maven&quot;</span><br><span class="line">libraryDependencies +&#x3D; &quot;amplab&quot; % &quot;spark-indexedrdd&quot; % &quot;0.3&quot;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;顺带引入GraphX</span><br><span class="line">libraryDependencies +&#x3D; &quot;org.apache.spark&quot; %% &quot;spark-graphx&quot; % &quot;2.2.0&quot;</span><br></pre></td></tr></table></figure><h3 id="编译错误"><a href="#编译错误" class="headerlink" title="编译错误"></a>编译错误</h3><p>注意：这里出现了一个天坑，总是编译（包含IndexedRDD时）出错的问题</p><p>历经解决过程：</p><h4 id="解决措施一"><a href="#解决措施一" class="headerlink" title="解决措施一"></a>解决措施一</h4><p>明确 <code>scala</code> 和 <code>spark</code> 版本的对照关系，版本确定为：<br>scala-2.11.8<br>spark-core-2.1.0（graphx同2.1.0） </p><p>上述版本是 <code>spark-rdd</code> 代码库中 <code>build.sbt</code> 的版本，详见 <a href="https://github.com/amplab/spark-indexedrdd/blob/master/build.sbt" target="_blank" rel="external nofollow noopener noreferrer">Github-spark-indexedrdd</a></p><p>明确 spark-indexedrdd 版本<br>注意，maven源 的版本只有 0.1 0.2 0.3 0.4.0 这四个，Github代码库中的实例程序推荐的是 0.3</p><p>但是编译时会出现如下错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Run:</span><br><span class="line">18&#x2F;05&#x2F;22 01:29:47 WARN ClosureCleaner: Expected a closure; got edu.berkeley.cs.amplab.spark.indexedrdd.IndexedRDD$MultiputZipper</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.NoSuchMethodError: org.apache.spark.SparkContext.runJob</span><br><span class="line"></span><br><span class="line">Sbt shell:</span><br><span class="line">could not find implicit value for evidence parameter of type edu.berkeley.cs.amplab.spark.indexedrdd.KeySerializer[Long]</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="解决措施二"><a href="#解决措施二" class="headerlink" title="解决措施二"></a>解决措施二</h4><p>这时看到了 源库 的这个 <a href="https://github.com/amplab/spark-indexedrdd/issues/31" target="_blank" rel="external nofollow noopener noreferrer">Issue</a><br>于是将 <code>spark-indexedrdd</code> 改为 <code>0.4.0</code> 版本，注意是三位数字</p><p>然后继续编译仍然出同样的错（没效果）</p><h4 id="解决措施三"><a href="#解决措施三" class="headerlink" title="解决措施三"></a>解决措施三</h4><p>这时，又看见了 <a href="https://blog.csdn.net/feng12345zi/article/details/79754730" target="_blank" rel="external nofollow noopener noreferrer"><strong>这个问题</strong></a> 其错误跟咱们的不一样，但是格式太像了，然后看他的解决方案：</p><blockquote><p>报错分析：这种异常的发生通常是因为程序需要一个隐式参数 <code>(implicit parameter)</code>，<br>方法的定义中有个 <code>[R: TypeInformation]</code> ，但程序并没有指定任何有关隐式参数的定义，编译代码无法创建 <code>TypeInformation</code> ，所以出现上面提到的异常信息。<br>解决方案：<br>1） 我们可以直接在代码里面加上以下的代码：<br>&emsp;&emsp;<strong>implicit val typeInfo = TypeInformation.of(classOf[Int])</strong><br>然后再去编译代码就不会出现上面的异常。<br>2） 但是这并不是Flink推荐我们去做的，推荐的做法是在代码中引入一下包：<br>&emsp;&emsp;<strong>import org.apache.flink.streaming.api.scala._</strong><br>如果数据是有限的（静态数据集），我们可以引入以下包：<br>&emsp;&emsp;<strong>import org.apache.flink.api.scala._</strong><br>然后即可解决上面的异常信息。</p></blockquote><p>同样的思路，翻过头来看，自己项目里的 import 确实少了一个！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import edu.berkeley.cs.amplab.spark.indexedrdd.IndexedRDD</span><br><span class="line">&#x2F;&#x2F; 下面这个不引入也不会报错，但是会编译出错</span><br><span class="line">&#x2F;&#x2F; 还要注意顺序，上下颠倒IDEA会自动省略</span><br><span class="line">import edu.berkeley.cs.amplab.spark.indexedrdd.IndexedRDD._</span><br></pre></td></tr></table></figure><p>同时还要注意，之前改为 <code>0.4.0</code> 版本是对的，如果换做 0.3 ，此时还是会编译出错</p><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>综上，IndexedRDD 环境（示例运行正常）应该如下：</p><pre><code>scala-2.11.8 spark-core-2.1.0graphx-2.1.0（非必须）spark-indexedrdd-0.4.0</code></pre><p>build.sbt 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">name :&#x3D; &quot;VISNWK&quot;</span><br><span class="line">version :&#x3D; &quot;0.1&quot;</span><br><span class="line">scalaVersion :&#x3D; &quot;2.11.8&quot;</span><br><span class="line">libraryDependencies +&#x3D; &quot;org.apache.spark&quot; %% &quot;spark-core&quot; % &quot;2.1.0&quot;</span><br><span class="line">libraryDependencies +&#x3D; &quot;org.apache.spark&quot; %% &quot;spark-graphx&quot; % &quot;2.1.0&quot;</span><br><span class="line">resolvers +&#x3D; &quot;Spark Packages Repo&quot; at &quot;http:&#x2F;&#x2F;dl.bintray.com&#x2F;spark-packages&#x2F;maven&quot;</span><br><span class="line">libraryDependencies +&#x3D; &quot;amplab&quot; % &quot;spark-indexedrdd&quot; % &quot;0.4.0&quot;</span><br></pre></td></tr></table></figure><p>IndexedRDD demo（IDEA环境下）：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> edu.berkeley.cs.amplab.spark.indexedrdd.<span class="type">IndexedRDD</span>   <span class="comment">//缺一不可</span></span><br><span class="line"><span class="keyword">import</span> edu.berkeley.cs.amplab.spark.indexedrdd.<span class="type">IndexedRDD</span>._ <span class="comment">//缺一不可</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.<span class="type">Random</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">graphxDemo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置运行环境</span></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"SimpleGraphX"</span>).setMaster(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an RDD of key-value pairs with Long keys.</span></span><br><span class="line">    <span class="keyword">val</span> rdd = sc.parallelize((<span class="number">1</span> to <span class="number">1000000</span>).map(x =&gt; (x.toLong, <span class="number">0</span>)))</span><br><span class="line">    <span class="comment">// Construct an IndexedRDD from the pairs, hash-partitioning and indexing</span></span><br><span class="line">    <span class="comment">// the entries.</span></span><br><span class="line">    <span class="keyword">val</span> indexed = <span class="type">IndexedRDD</span>(rdd).cache()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Perform a point update.</span></span><br><span class="line">    <span class="keyword">val</span> indexed2 = indexed.put(<span class="number">1234</span>L, <span class="number">10873</span>).cache()</span><br><span class="line">    <span class="comment">// Perform a point lookup. Note that the original IndexedRDD remains</span></span><br><span class="line">    <span class="comment">// unmodified.</span></span><br><span class="line">    indexed2.get(<span class="number">1234</span>L) <span class="comment">// =&gt; Some(10873)</span></span><br><span class="line">    indexed.get(<span class="number">1234</span>L) <span class="comment">// =&gt; Some(0)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Efficiently join derived IndexedRDD with original.</span></span><br><span class="line">    <span class="keyword">val</span> indexed3 = indexed.innerJoin(indexed2) &#123; (id, a, b) =&gt; b &#125;.filter(_._2 != <span class="number">0</span>)</span><br><span class="line">    indexed3.collect <span class="comment">// =&gt; Array((1234L, 10873))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Perform insertions and deletions.</span></span><br><span class="line">    <span class="keyword">val</span> indexed4 = indexed2.put(<span class="number">-100</span>L, <span class="number">111</span>).delete(<span class="type">Array</span>(<span class="number">998</span>L, <span class="number">999</span>L)).cache()</span><br><span class="line">    indexed2.get(<span class="number">-100</span>L) <span class="comment">// =&gt; None</span></span><br><span class="line">    indexed4.get(<span class="number">-100</span>L) <span class="comment">// =&gt; Some(111)</span></span><br><span class="line">    indexed2.get(<span class="number">999</span>L) <span class="comment">// =&gt; Some(0)</span></span><br><span class="line">    indexed4.get(<span class="number">999</span>L) <span class="comment">// =&gt; None</span></span><br><span class="line">    </span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="其他错误"><a href="#其他错误" class="headerlink" title="其他错误"></a>其他错误</h3><p>注意，之前还出现过 <code>Apache Spark: Java.Lang.NoSuchMethodError .RddToPairRDDFunctions</code> 这个错误，但是今天明确版本后就没有复现，所以该错误八成是因为版本不兼容的缘故，总之还是版本不兼容引起的编译错误。</p><p>还有这个错误 <code>unresolved dependency: com.ankurdave#part_2.10;0.1</code>，之前是使用 Sbt 和 Maven 混用，然后用 Maven 添加的 spark-indexedrdd 才出现的这个错误，在改用 Sbt 单一管理依赖后该错误也没有复现。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spark </tag>
            
            <tag> SBT </tag>
            
            <tag> IndexedRDD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>添加轻量的RSS订阅内容阅读展示支持</title>
      <link href="/article/fab.html"/>
      <url>/article/fab.html</url>
      
        <content type="html"><![CDATA[<p>大部分资讯类的网站都提供RSS订阅功能，其一般是是XML格式的网页信息，目的是为了能够方便第三方站点轻松的获取本站的最新内容，在Hexo博客中一般也会包含seed这一插件，即可以直接将你的网站内容生成RSS订阅，这对于一些独立站点，尤其是一些SEO欠佳（搜索引擎排名靠后）但内容却十分高质量的博客来说，就可以利用RSS订阅跟进其内容的更新。</p><a id="more"></a><p>曾经一度认为RSS订阅是一种落后的阅读方式，那时还没有真正体会到其正确应用场景，直到随着接触技术网站、个人博客越来越多，慢慢发现了许许多多的高质量站点，先前感叹完之后能做的也只能是将其收藏到浏览器的书签中，但没过几天就会发现早就忘记了，而且，重要的是，你无法跟踪其站点内容的更新，这部分站点又大多都不具有推送功能，只是高冷的存在在那里等待别人的访问，那么真的就无法跟踪到最新的内容了吗，RSS订阅的出现就完美的解决了这一问题，如果把文章推送内容站的主动推送，那么RSS订阅其实更像一种用户端向内容站发起的主动拉取。</p><h3 id="RSS阅读器"><a href="#RSS阅读器" class="headerlink" title="RSS阅读器"></a>RSS阅读器</h3><p>现在，我们只需要一个RSS阅读器和各站点的rss订阅路径，就可以随时获取到各个站点的最新内容（通常是文章），回到一开始的问题，想象一个场景，如果你收藏了几十个干货技术博客，并想看看最近他们都更新了哪些新文章，那么如果不适用RSS阅读器，难道要每一个网站都打开看一遍吗，这是难以想象的。</p><p>RSS阅读器极大地方便了我们获取各站点的最新资源，但是这是否就是最精简的操作方式？是否就是最终的RSS使用场景？答案是否定的，其实真正的应用场景更多偏向于对各站点资源的‘整合’，比如新闻聚合网站等。对于我们自己而言，当然也可以对我们收藏的一些订阅进行整合，并且内嵌到我们自己的站点中来分享我们的订阅。上述场景完全可以自己实现，但其实已经存在很多类似的开源项目，不过很多是需要服务端解析的，所以有些许局限。这里介绍的<code>FeedEk</code>特点就是基于JQuery的轻量实现，完全可以胜任上述场景。</p><p>注意：RSS、ATOM 本质差别不大，都是具有相似的基于XML的格式，基本结构是相同的，只在节点的表达式上有点区别，所以对于 ATOM 处理基本没有差别。</p><h3 id="FeedEk的使用"><a href="#FeedEk的使用" class="headerlink" title="FeedEk的使用"></a>FeedEk的使用</h3><p>Github地址：<a href="https://github.com/enginkizil/FeedEk" target="_blank" rel="external nofollow noopener noreferrer">点击这里</a></p><p>对于日期格式参数，如果需要使用，则必须添加Moment.js，如果想本地化日期格式（日期名称，月份名称），则必须将Moment.js与langs一起包含。<a href="http://momentjs.com/" target="_blank" rel="external nofollow noopener noreferrer">Moment.js地址</a></p><p>注意FeedEK.js的引入，源代码非常简单，所以后期可以十分方便的改写，查看源代码可知，其实现原理其实是利用了 Yahoo 的API，将解析路径封装进字符串，然后调用 Yahoo 的API对其解析并返回json串，然后就是对其解析和拼接，整体上逻辑很简单。</p><p>核心代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> YQLstr = <span class="string">'SELECT channel.item FROM feednormalizer WHERE output="rss_2.0" AND url ="'</span> + def.FeedUrl + <span class="string">'" LIMIT '</span> + def.MaxCount;</span><br><span class="line"></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    url: <span class="string">"https://query.yahooapis.com/v1/public/yql?q="</span> + <span class="built_in">encodeURIComponent</span>(YQLstr) + <span class="string">"&amp;format=json&amp;diagnostics=false&amp;callback=?"</span>,</span><br><span class="line">    dataType: <span class="string">"json"</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">"#"</span> + id).empty();</span><br><span class="line">        <span class="keyword">if</span> (!(data.query.results.rss <span class="keyword">instanceof</span> <span class="built_in">Array</span>)) &#123;</span><br><span class="line">            data.query.results.rss = [data.query.results.rss];</span><br><span class="line">        &#125;</span><br><span class="line">        $.each(data.query.results.rss, <span class="function"><span class="keyword">function</span> (<span class="params">e, itm</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//... ...</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//$("#" + id).append('&lt;ul class="feedEkList"&gt;' + s + '&lt;/ul&gt;');</span></span><br><span class="line">        <span class="comment">//注意:源码中上述语句少了一个&lt;/li&gt;标签</span></span><br><span class="line">        $(<span class="string">"#"</span> + id).append(<span class="string">'&lt;ul class="feedEkList"&gt;'</span> + s + <span class="string">'&lt;/li&gt;&lt;/ul&gt;'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>这段代码的引入注意两个地方，第一个是源代码中有个错误，缺少一个标签，第二个是源代码采用的是<code>(function(){})(jQuery);</code>这种形式的加载方式，测试时没有执行，偷懒给改为<code>$(document).ready(function(){});</code>这种方式，其区别详见 <a href="https://www.cnblogs.com/keyi/p/5919392.html" target="_blank" rel="external nofollow noopener noreferrer">这里</a>。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="嵌入到页面中的效果"><a href="#嵌入到页面中的效果" class="headerlink" title="嵌入到页面中的效果"></a>嵌入到页面中的效果</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cds1a0vvi261c8tom51hedrdf9.png" alt></p><p>这里由于罗列了多个订阅信息，所以必然的需要对解析进行触发而不是直接全部解析（这样加载时间会非常慢），点击展开时就调用一次API，并且解析内容生成html代码更新到指定div即可。</p><p>具体效果可移步 <a href="https://old.cz5h.com/feedek/feedread.html" target="_blank" rel="external nofollow noopener noreferrer">此页面</a> 查看。<br><br></p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> Hexo </tag>
            
            <tag> Rss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提交Spark任务的三种方式</title>
      <link href="/article/4900.html"/>
      <url>/article/4900.html</url>
      
        <content type="html"><![CDATA[<p>在使用Spark的过程中，一般都会经历调试，提交任务等等环节，如果每个环节都可以确认程序的输入结果，那么无疑对加快代码的调试起了很大的作用，现在，借助IDEA可以非常快捷方便的对Spark代码进行调试，在借助IDEA来完成Spark时，可以大致通过以下几个步骤来完成：</p><a id="more"></a><ul><li>初始构建项目阶段，使用Local模式本地运行</li><li>项目大致完成阶段，使用IDEA连接集群自动提交任务运行</li><li>最终部署运行阶段，手动将源码包上传到集群并使用 spark-submit 提交任务运行</li></ul><p>下面，针对三种方式分别举例说明每种方式需要注意的地方。</p><h3 id="使用IDEA本地运行（Local模式）"><a href="#使用IDEA本地运行（Local模式）" class="headerlink" title="使用IDEA本地运行（Local模式）"></a><strong>使用IDEA本地运行（Local模式）</strong></h3><pre><code>本地运行，本地计算，本地输出，与集群无关</code></pre><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">WARN</span>)</span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.eclipse.jetty.server"</span>).setLevel(<span class="type">Level</span>.<span class="type">OFF</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"DemoApp"</span>).setMaster(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> data = sc.makeRDD(<span class="type">Seq</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>))</span><br><span class="line">    data.map&#123;</span><br><span class="line">      x =&gt;&#123;</span><br><span class="line">        (x,<span class="string">s"My number is <span class="subst">$x</span>"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk6dh9vj81foh1fvnelh6ac2t.png" alt></p><h3 id="使用IDEA本地连接集群运行"><a href="#使用IDEA本地连接集群运行" class="headerlink" title="使用IDEA本地连接集群运行"></a><strong>使用IDEA本地连接集群运行</strong></h3><pre><code>运行在集群，计算在集群，输出可以在本地（从远程取回）</code></pre><p><strong>注意：</strong></p><p><strong>1. 此处打包时需要将环境依赖包含在内</strong></p><p><strong>2. 注意勾选 Include in build，然后 Rebuild Module 即可打包</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk0vmh21a2pgc8kq5hu1kkn5q.png" alt></p><p><strong>3. 代码内需要指定jar包的具体路径（setJar）和主节点（setMaster）</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk56dp7sna17ac1h5j18hg1lt23.png" alt></p><p><strong>4. 注意setMaster地址就是webUI中置顶的地址</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk4v4n81r1r7o51sp3mg01rn316.png" alt></p><p><strong>5. 注意这种方式的代码输出</strong></p><p>这种方式 rdd.foreach(println) 或者是一般的 println() 都不能在 Console 打印出结果，如果希望在控制台打印出特定输出必须使用 collect() 将数据取回本地（这时可以将本地想象为集群中的一个节点），对于文件也是同理，其操作相当于对远程hdfs的操作，这里不展开.</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdkcqvckt2t154d10ko74s5nm1p.png" alt></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="手动上传Jar包到集群运行"><a href="#手动上传Jar包到集群运行" class="headerlink" title="手动上传Jar包到集群运行"></a><strong>手动上传Jar包到集群运行</strong></h3><pre><code>运行在集群，计算在集群，输出在集群</code></pre><p><strong>注意：</strong></p><p><strong>1. 此时打包时只打包源码文件，即无需添加环境依赖</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk15pvi5mh8ad1aea1033qq06k.png" alt></p><p><strong>2. 此Jar文件内只有源码，一般很小</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk0co5o1njmgc91n0i13e2u2l5a.png" alt></p><p><strong>3. 代码内 Sparkconf 的获取不用具体指定</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">WARN</span>)</span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.eclipse.jetty.server"</span>).setLevel(<span class="type">Level</span>.<span class="type">OFF</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"DemoApp"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">    <span class="keyword">val</span> data = sc.makeRDD(<span class="type">Seq</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>))</span><br><span class="line">    data.map&#123;</span><br><span class="line">      x =&gt;&#123;</span><br><span class="line">        (x,<span class="string">s"My number is <span class="subst">$x</span>"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. 需要使用 spark-submit 命令提交任务</strong></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cdk0621v1a2gvcd1tah1tu51nkg40.png" alt></p><h3 id="留意这种形式"><a href="#留意这种形式" class="headerlink" title="留意这种形式"></a><strong>留意这种形式</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.spark.&#123;SparkConf, SparkContext&#125;</span><br><span class="line">object demo &#123;</span><br><span class="line">  def main(args: Array[String]) &#123;</span><br><span class="line">    val conf &#x3D; new SparkConf().setAppName(&quot;DemoApp&quot;)setMaster(&quot;local&quot;)</span><br><span class="line">    val sc &#x3D; new SparkContext(conf)</span><br><span class="line">    val text &#x3D; sc.textFile(&quot;hdfs:&#x2F;&#x2F;192.168.146.130:9000&#x2F;spark&#x2F;look.sh&quot;)</span><br><span class="line">    println(&quot;remote clusters&#39; file output:&quot;)</span><br><span class="line">    text.foreach(println)</span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码中，Spark仍然是Local模式，但资源文件却在远程集群的HDFS上，这也是可以运行的！这时访问的资源确实是远程的资源，但是计算仍然在本地，仍然算做第一种方式（Local模式）。</p><hr><h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a><strong>结束语</strong></h3><p>在提交任务的过程中可能会遇到各种各样的问题，一般分为task本身的配置项问题和Spark集群本身的问题两部分，task本身的配置问题一般可以通过:<br>&emsp;- SparkContext().set() 来设置，第二种方式即IDEA连接集群<br>&emsp;- spark-submit添加参数–executor-memory 来设置，即手动提交方式<br>&emsp;- 具体配置项参见<a href="https://blog.csdn.net/guohecang/article/details/52088117" target="_blank" rel="external nofollow noopener noreferrer">[ Spark配置参数 ]</a><br>集群本身的问题涉及<a href="https://blog.csdn.net/happyanger6/article/details/47070223" target="_blank" rel="external nofollow noopener noreferrer">Worker、Master的启动</a>等等，关联的地方较多，在此不进行展开。</p><p>最后，整个提交过程的前提是IDEA项目配置和Spark集群环境的正确，以及两者正确的匹配（比如打包的1.x版本的Saprk任务大概率是不能运行在Spark2.x的集群上的）。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Spark </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GraphX具体功能的代码使用实例-Scala实现</title>
      <link href="/article/4ba7.html"/>
      <url>/article/4ba7.html</url>
      
        <content type="html"><![CDATA[<p>GraphX 为整个图计算流程提供了强大的支持，先前已经有若干篇文章先后介绍了GraphX的强大功能，在GraphX官方编程指南中，提供了部分简单易懂的示例代码，其为GraphX的使用提供了一个初步的认识，作为需要用GraphX来编码实现需求的读者来说是十分宝贵的资源。</p><a id="more"></a><p>本文利用一个初始示例代码，结合部分官方文档中的说明，对GraphX的部分功能方法进行了实践，在全部亲自运行通过后，对大部分代码添加了自己的理解和认识，并且在Pregel模型编程部分结合运行结果对其运行流程做了一定梳理，来意图理解其执行机制。</p><p>下面，是ben程序代码中使用到的主要程序部分，即定义出一个简单的图结构，并构造一个图Graph[VD,ED]，对具体功能的实现均放置在代码的后半部分，主要包括一下几部分：</p><ul><li>Property Operators</li><li>Structural Operators</li><li>Computing Degree</li><li>Collecting Neighbors</li><li>Join Operators</li><li>mapReduceTriplets</li><li>aggregateMessages</li><li>Pregel API Functions</li></ul><p>主程序代码如下：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.&#123;<span class="type">Level</span>, <span class="type">Logger</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.graphx._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">RDD_println</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//屏蔽日志</span></span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.apache.spark"</span>).setLevel(<span class="type">Level</span>.<span class="type">ERROR</span>)</span><br><span class="line">    <span class="type">Logger</span>.getLogger(<span class="string">"org.eclipse.jetty.server"</span>).setLevel(<span class="type">Level</span>.<span class="type">OFF</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置运行环境</span></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"XXXAppName"</span>).setMaster(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置顶点和边，注意顶点和边都是用元组定义的Array</span></span><br><span class="line">    <span class="comment">//顶点的数据类型</span></span><br><span class="line">    <span class="keyword">val</span> vertexArray = <span class="type">Array</span>(</span><br><span class="line">      (<span class="number">1</span>L, (<span class="string">"Alice"</span>, <span class="number">28</span>)),(<span class="number">2</span>L, (<span class="string">"Bob"</span>, <span class="number">27</span>)),</span><br><span class="line">      (<span class="number">3</span>L, (<span class="string">"Charlie"</span>, <span class="number">65</span>)),(<span class="number">4</span>L, (<span class="string">"David"</span>, <span class="number">42</span>)),</span><br><span class="line">      (<span class="number">5</span>L, (<span class="string">"Ed"</span>, <span class="number">55</span>)),(<span class="number">6</span>L, (<span class="string">"Fran"</span>, <span class="number">50</span>))</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">//边的数据类型</span></span><br><span class="line">    <span class="keyword">val</span> edgeArray = <span class="type">Array</span>(</span><br><span class="line">      <span class="type">Edge</span>(<span class="number">2</span>L, <span class="number">1</span>L, <span class="number">7</span>),<span class="type">Edge</span>(<span class="number">2</span>L, <span class="number">4</span>L, <span class="number">2</span>),<span class="type">Edge</span>(<span class="number">3</span>L, <span class="number">2</span>L, <span class="number">4</span>),</span><br><span class="line">      <span class="type">Edge</span>(<span class="number">3</span>L, <span class="number">6</span>L, <span class="number">3</span>),<span class="type">Edge</span>(<span class="number">4</span>L, <span class="number">1</span>L, <span class="number">1</span>),<span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">2</span>L, <span class="number">2</span>),</span><br><span class="line">      <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">3</span>L, <span class="number">8</span>),<span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">6</span>L, <span class="number">3</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造vertexRDD和edgeRDD</span></span><br><span class="line">    <span class="keyword">val</span> vertexRDD: <span class="type">RDD</span>[(<span class="type">Long</span>, (<span class="type">String</span>, <span class="type">Int</span>))] = sc.parallelize(vertexArray)</span><br><span class="line">    <span class="keyword">val</span> edgeRDD: <span class="type">RDD</span>[<span class="type">Edge</span>[<span class="type">Int</span>]] = sc.parallelize(edgeArray)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造图Graph[VD,ED]</span></span><br><span class="line">    <span class="keyword">val</span> graph: <span class="type">Graph</span>[(<span class="type">String</span>, <span class="type">Int</span>), <span class="type">Int</span>] = <span class="type">Graph</span>(vertexRDD, edgeRDD)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------- Property Operators -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- Structural Operators -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- Computing Degree -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- Collecting Neighbors -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- Join Operators -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- mapReduceTriplets -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- aggregateMessages -----------------</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//----------------- Pregel API Functions -----------------</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Property-Operators"><a href="#Property-Operators" class="headerlink" title="Property Operators"></a><strong>Property Operators</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">graph.edges.foreach(println)</span><br><span class="line">println</span><br><span class="line">graph.vertices.foreach(println)</span><br><span class="line">println</span><br><span class="line">graph.triplets.foreach(println)</span><br><span class="line">println</span><br><span class="line">graph.triplets.foreach(e =&gt; prin(<span class="string">s"edge(<span class="subst">$&#123;e.srcId&#125;</span>,<span class="subst">$&#123;e.dstId&#125;</span>)\tage(<span class="subst">$&#123;e.srcAttr._2&#125;</span>,<span class="subst">$&#123;e.dstAttr._2&#125;</span>)"</span>))</span><br><span class="line"><span class="comment">//---- vertexRDD.foreach ----原始的vertexRDD保持顺序</span></span><br><span class="line"><span class="comment">//1 name=Alice age=28</span></span><br><span class="line"><span class="comment">//2 name=Bob age=27</span></span><br><span class="line"><span class="comment">//3 name=Charlie age=65</span></span><br><span class="line"><span class="comment">//4 name=David age=42</span></span><br><span class="line"><span class="comment">//5 name=Ed age=55</span></span><br><span class="line"><span class="comment">//6 name=Fran age=50</span></span><br><span class="line"><span class="comment">//---- edgeRDD.foreach ----</span></span><br><span class="line"><span class="comment">//  2 to 1 w=7</span></span><br><span class="line"><span class="comment">//2 to 4 w=2</span></span><br><span class="line"><span class="comment">//3 to 2 w=4</span></span><br><span class="line"><span class="comment">//3 to 6 w=3</span></span><br><span class="line"><span class="comment">//4 to 1 w=1</span></span><br><span class="line"><span class="comment">//5 to 2 w=2</span></span><br><span class="line"><span class="comment">//5 to 3 w=8</span></span><br><span class="line"><span class="comment">//5 to 6 w=3</span></span><br><span class="line"><span class="comment">//---- graph.vertices.foreach ----生成graph之后顺序被打乱</span></span><br><span class="line"><span class="comment">//4 name=David age=42</span></span><br><span class="line"><span class="comment">//1 name=Alice age=28</span></span><br><span class="line"><span class="comment">//6 name=Fran age=50</span></span><br><span class="line"><span class="comment">//3 name=Charlie age=65</span></span><br><span class="line"><span class="comment">//5 name=Ed age=55</span></span><br><span class="line"><span class="comment">//2 name=Bob age=27</span></span><br><span class="line"><span class="comment">//---- graph.edges.foreach ----</span></span><br><span class="line"><span class="comment">//  2 to 1 w=7</span></span><br><span class="line"><span class="comment">//2 to 4 w=2</span></span><br><span class="line"><span class="comment">//3 to 2 w=4</span></span><br><span class="line"><span class="comment">//3 to 6 w=3</span></span><br><span class="line"><span class="comment">//4 to 1 w=1</span></span><br><span class="line"><span class="comment">//5 to 2 w=2</span></span><br><span class="line"><span class="comment">//5 to 3 w=8</span></span><br><span class="line"><span class="comment">//5 to 6 w=3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//take(n) 按与按顺序！取出前 n 个</span></span><br><span class="line">graph.edges.take(<span class="number">3</span>).foreach(println)</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapVertices 对Vertices进行map操作</span></span><br><span class="line"><span class="comment">// 对整个顶点集的 某一部分 进行批量操作</span></span><br><span class="line">graph.vertices.foreach( x =&gt; println(x))</span><br><span class="line"><span class="comment">// 不改变顺序的进行map操作</span></span><br><span class="line">graph.mapVertices&#123;</span><br><span class="line">  <span class="keyword">case</span> (id, (name, age)) =&gt; (id, (name, age+<span class="number">10</span>))</span><br><span class="line">&#125;.vertices.collect.foreach(v =&gt; println(<span class="string">s"<span class="subst">$&#123;v._2._1&#125;</span> is <span class="subst">$&#123;v._2._2&#125;</span>"</span>))</span><br><span class="line"><span class="comment">//collect可有可无</span></span><br><span class="line"><span class="comment">//mapVertices&#123;case()=&gt; ()&#125; 这种必须用&#123;&#125;</span></span><br><span class="line"><span class="comment">//但是对于 mapVertices&#123; () =&gt; () &#125; 这种也可以用 mapVertices( () =&gt; () )</span></span><br><span class="line"></span><br><span class="line">graph.mapEdges&#123;</span><br><span class="line">  e=&gt;e.attr*<span class="number">2</span></span><br><span class="line">&#125;.edges.collect.foreach(e =&gt; println(<span class="string">s"<span class="subst">$&#123;e.srcId&#125;</span> to <span class="subst">$&#123;e.dstId&#125;</span> att <span class="subst">$&#123;e.attr&#125;</span>"</span>))</span><br></pre></td></tr></table></figure><h3 id="Structural-Operators"><a href="#Structural-Operators" class="headerlink" title="Structural Operators"></a><strong>Structural Operators</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始图结构</span></span><br><span class="line">graph.edges.foreach(println)</span><br><span class="line">println</span><br><span class="line"><span class="comment">// 满足要求的子图结构 这里只用到了 参数epred</span></span><br><span class="line"><span class="keyword">val</span> sub = graph.subgraph( epred = e =&gt; e.srcId &gt; e.dstId )</span><br><span class="line">sub.edges.foreach(println)</span><br><span class="line"></span><br><span class="line"><span class="comment">//println("原图顶点数："+graph.vertices.count()+"\t子图顶点数："+sub.vertices.count())</span></span><br><span class="line"><span class="comment">//println("原图边数："+graph.edges.count()+"\t子图边："+sub.edges.count())</span></span><br><span class="line"><span class="comment">//原图顶点数：6子图顶点数：6</span></span><br><span class="line"><span class="comment">//原图边数：8子图边：5</span></span><br><span class="line"><span class="comment">//分析：过滤掉了3条边，但是仍然包含全部顶点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误的写法：   subgraph( epred = e =&gt; e.srcId &gt; e.dstId, vpred = (id,(_,_)) =&gt; id &gt; 4 )</span></span><br><span class="line"><span class="keyword">val</span> sub2 = graph.subgraph( epred = e =&gt; e.srcId &gt; e.dstId, vpred = (id,_) =&gt; id &gt; <span class="number">4</span> )</span><br><span class="line"><span class="comment">//println("原图顶点数："+graph.vertices.count()+"\t子图顶点数："+sub2.vertices.count())</span></span><br><span class="line"><span class="comment">//println("原图边数："+graph.edges.count()+"\t子图边："+sub2.edges.count())</span></span><br><span class="line"><span class="comment">//原图顶点数：6子图顶点数：2</span></span><br><span class="line"><span class="comment">//原图边数：8子图边：0</span></span><br><span class="line"><span class="comment">//分析：同时有epred和vpred两个条件，最终只剩两点，且无边连接，即边数为0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph.edges.foreach(println)</span><br><span class="line">println</span><br><span class="line">graph.edges.reverse.foreach(println)</span><br><span class="line"><span class="comment">//Edge(2,1,7)</span></span><br><span class="line"><span class="comment">//Edge(2,4,2)</span></span><br><span class="line"><span class="comment">//Edge(3,2,4)</span></span><br><span class="line"><span class="comment">//Edge(3,6,3)</span></span><br><span class="line"><span class="comment">//Edge(4,1,1)</span></span><br><span class="line"><span class="comment">//Edge(5,2,2)</span></span><br><span class="line"><span class="comment">//Edge(5,3,8)</span></span><br><span class="line"><span class="comment">//Edge(5,6,3)</span></span><br><span class="line"><span class="comment">// reverse之后，是边的入点出点 相互交换，即边进行翻转</span></span><br><span class="line"><span class="comment">//Edge(1,2,7)</span></span><br><span class="line"><span class="comment">//Edge(1,4,1)</span></span><br><span class="line"><span class="comment">//Edge(2,3,4)</span></span><br><span class="line"><span class="comment">//Edge(2,5,2)</span></span><br><span class="line"><span class="comment">//Edge(3,5,8)</span></span><br><span class="line"><span class="comment">//Edge(4,2,2)</span></span><br><span class="line"><span class="comment">//Edge(6,3,3)</span></span><br><span class="line"><span class="comment">//Edge(6,5,3)</span></span><br><span class="line"><span class="comment">// 注意：graph.vertices 没有reverse这个方法，即不能对顶点进行翻转</span></span><br></pre></td></tr></table></figure><h3 id="Computing-Degree"><a href="#Computing-Degree" class="headerlink" title="Computing Degree"></a><strong>Computing Degree</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输出全部 ( 度数 , 该度的个数 )</span></span><br><span class="line">graph.outDegrees.foreach( x =&gt; println(x))</span><br><span class="line"></span><br><span class="line">graph.degrees.foreach( x =&gt; println(x))</span><br><span class="line"></span><br><span class="line">println</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为什么这样设计</span></span><br><span class="line"><span class="comment">// 因为：跟的是graph.degrees，即格式为 (VertexId, Int)，</span></span><br><span class="line"><span class="comment">// 所以对其的处理的参数 max(参数a:参数b):(结果)，均为此格式</span></span><br><span class="line"><span class="comment">// 得到最大度的节点：首先需要一个比较两点度大小的函数 max()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max</span></span>(a: (<span class="type">VertexId</span>, <span class="type">Int</span>), b: (<span class="type">VertexId</span>, <span class="type">Int</span>)): (<span class="type">VertexId</span>, <span class="type">Int</span>) = &#123;</span><br><span class="line">  <span class="keyword">if</span> (a._2 &gt; b._2) a <span class="keyword">else</span> b</span><br><span class="line">&#125;</span><br><span class="line">println(graph.degrees.reduce(max))<span class="comment">//foreach( x =&gt; println(x))</span></span><br><span class="line">println(graph.inDegrees.reduce(max))<span class="comment">//foreach( x =&gt; println(x))</span></span><br><span class="line">println(graph.outDegrees.reduce(max))<span class="comment">//foreach( x =&gt; println(x))</span></span><br></pre></td></tr></table></figure><h3 id="Collecting-Neighbors"><a href="#Collecting-Neighbors" class="headerlink" title="Collecting Neighbors"></a><strong>Collecting Neighbors</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GraphOps实现的，即是属于 graph 的方法</span></span><br><span class="line"></span><br><span class="line">graph.collectNeighborIds(<span class="type">EdgeDirection</span>.<span class="type">Out</span>).foreach( x =&gt; &#123;</span><br><span class="line">  print(x._1+<span class="string">" cnt="</span>)</span><br><span class="line">  x._2.foreach(print)</span><br><span class="line">  println</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 按出度，找到的点的邻居节点</span></span><br><span class="line"><span class="comment">//4 cnt=1</span></span><br><span class="line"><span class="comment">//1 cnt=</span></span><br><span class="line"><span class="comment">//6 cnt=</span></span><br><span class="line"><span class="comment">//3 cnt=26</span></span><br><span class="line"><span class="comment">//5 cnt=236</span></span><br><span class="line"><span class="comment">//2 cnt=14</span></span><br><span class="line">println</span><br><span class="line">graph.collectNeighborIds(<span class="type">EdgeDirection</span>.<span class="type">Either</span>).foreach( x =&gt; &#123;</span><br><span class="line">  print(x._1+<span class="string">" cnt="</span>)</span><br><span class="line">  x._2.foreach(print)</span><br><span class="line">  println</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 按出入度，不能用Both，要用Either</span></span><br><span class="line"><span class="comment">//4 cnt=21</span></span><br><span class="line"><span class="comment">//1 cnt=24</span></span><br><span class="line"><span class="comment">//6 cnt=35</span></span><br><span class="line"><span class="comment">//3 cnt=265</span></span><br><span class="line"><span class="comment">//5 cnt=236</span></span><br><span class="line"><span class="comment">//2 cnt=1435</span></span><br><span class="line"></span><br><span class="line">println</span><br><span class="line">graph.collectNeighbors(<span class="type">EdgeDirection</span>.<span class="type">Either</span>).foreach( x =&gt; &#123;</span><br><span class="line">  print(x._1+<span class="string">" cnt="</span>)</span><br><span class="line">  x._2.foreach(print) <span class="comment">//collectNeighbors 找到的邻居是全属性，而不仅是ID</span></span><br><span class="line">  println</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//4 cnt=(2,(Bob,27))(1,(Alice,28))</span></span><br><span class="line"><span class="comment">//1 cnt=(2,(Bob,27))(4,(David,42))</span></span><br><span class="line"><span class="comment">//6 cnt=(3,(Charlie,65))(5,(Ed,55))</span></span><br><span class="line"><span class="comment">//3 cnt=(2,(Bob,27))(6,(Fran,50))(5,(Ed,55))</span></span><br><span class="line"><span class="comment">//5 cnt=(2,(Bob,27))(3,(Charlie,65))(6,(Fran,50))</span></span><br><span class="line"><span class="comment">//2 cnt=(1,(Alice,28))(4,(David,42))(3,(Charlie,65))(5,(Ed,55))</span></span><br></pre></td></tr></table></figure><h3 id="Join-Operators"><a href="#Join-Operators" class="headerlink" title="Join Operators"></a><strong>Join Operators</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 属性重置为0</span></span><br><span class="line"><span class="keyword">val</span> rawGraph = graph.mapVertices((id,_) =&gt; <span class="number">0</span>)</span><br><span class="line">rawGraph.vertices.foreach(println)</span><br><span class="line">println</span><br><span class="line">rawGraph.joinVertices[<span class="type">Int</span>](rawGraph.degrees)((_,_,outDeg) =&gt; outDeg).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,0)</span></span><br><span class="line"><span class="comment">//(1,0)</span></span><br><span class="line"><span class="comment">//(6,0)</span></span><br><span class="line"><span class="comment">//(3,0)</span></span><br><span class="line"><span class="comment">//(5,0)</span></span><br><span class="line"><span class="comment">//(2,0)</span></span><br><span class="line"><span class="comment">// joinVertices 按degree使用join操作 加入到 rawGraph 中</span></span><br><span class="line"><span class="comment">//(4,2)</span></span><br><span class="line"><span class="comment">//(1,2)</span></span><br><span class="line"><span class="comment">//(6,2)</span></span><br><span class="line"><span class="comment">//(3,3)</span></span><br><span class="line"><span class="comment">//(5,3)</span></span><br><span class="line"><span class="comment">//(2,4)</span></span><br><span class="line">rawGraph.outerJoinVertices(rawGraph.degrees)((_,_,outDeg) =&gt; outDeg).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,Some(2))</span></span><br><span class="line"><span class="comment">//(1,Some(2))</span></span><br><span class="line"><span class="comment">//(6,Some(2))</span></span><br><span class="line"><span class="comment">//(3,Some(3))</span></span><br><span class="line"><span class="comment">//(5,Some(3))</span></span><br><span class="line"><span class="comment">//(2,Some(4)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//进阶用法   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//顶点用 类对象来代替，利用到 outerJoinVertices</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> inDegrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>] = graph.inDegrees</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">name: <span class="type">String</span>, age: <span class="type">Int</span>, inDeg: <span class="type">Int</span>, outDeg: <span class="type">Int</span></span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">//创建一个新图，顶点VD的数据类型为User，并从graph做类型转换</span></span></span><br><span class="line"><span class="class"><span class="title">//</span> <span class="title">Graph</span>[<span class="type">User</span>, <span class="type">Int</span>] <span class="title">即</span> <span class="title">Graph</span>[<span class="type">VD</span>，<span class="type">ED</span>]<span class="title">，意思是顶点由User类代替，ED是Int类型</span></span></span><br><span class="line"><span class="class"><span class="title">val</span> <span class="title">ugraph</span></span>: <span class="type">Graph</span>[<span class="type">User</span>, <span class="type">Int</span>] = graph.mapVertices &#123; <span class="keyword">case</span> (id, (name, age)) =&gt; <span class="type">User</span>(name, age, <span class="number">0</span>, &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//initialUserGraph与inDegrees、outDegrees（RDD）进行连接，并修改initialUserGraph中inDeg值、outD值</span></span><br><span class="line"><span class="comment">//outerJoinVertices 这个方法属于 Graph 类型的方法</span></span><br><span class="line"><span class="keyword">val</span> userGraph = ugraph.outerJoinVertices(ugraph.inDegrees) &#123;</span><br><span class="line">  <span class="comment">//required: (graphx.VertexId, User, Option[Int])</span></span><br><span class="line">  <span class="keyword">case</span> (id, u, in) =&gt; <span class="type">User</span>(u.name, u.age, in.getOrElse(<span class="number">0</span>), u.outDeg)</span><br><span class="line">&#125;.outerJoinVertices(ugraph.outDegrees) &#123;</span><br><span class="line">  <span class="keyword">case</span> (id, u, out) =&gt; <span class="type">User</span>(u.name, u.age, u.inDeg,out.getOrElse(<span class="number">0</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(<span class="string">"连接图顶点的属性："</span>)</span><br><span class="line">userGraph.vertices.collect.foreach(v =&gt; println(<span class="string">s"<span class="subst">$&#123;v._2.name&#125;</span> inDeg: <span class="subst">$&#123;v._2.inDeg&#125;</span>  outDeg: v._2.outDeg&#125;"</span>))</span><br><span class="line"></span><br><span class="line">println(<span class="string">"出度和入读相同的："</span>)</span><br><span class="line">userGraph.vertices.filter &#123;</span><br><span class="line">      <span class="comment">//此处应该格式为 (graphx.VertexId, User)</span></span><br><span class="line">  <span class="keyword">case</span> (id, u) =&gt; u.inDeg == u.outDeg</span><br><span class="line">&#125;.collect.foreach &#123;</span><br><span class="line">  <span class="keyword">case</span> (id, property) =&gt; println(property.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="mapReduceTriplets"><a href="#mapReduceTriplets" class="headerlink" title="mapReduceTriplets"></a><strong>mapReduceTriplets</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在早的GraphX版本中我们计算邻居聚合使用mapReduceTriplets操作;</span></span><br><span class="line"><span class="comment">//注意：当前版本 Graph已经不存在MapReduceTriplets这个方法</span></span><br><span class="line"><span class="comment">//    libraryDependencies += "org.apache.spark" %% "spark-core" % "2.2.0"</span></span><br><span class="line"><span class="comment">//    libraryDependencies += "org.apache.spark" %% "spark-graphx" % "2.2.0"</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//mapReduceTriplets</span></span><br><span class="line"><span class="comment">// 操作应用用户定义的map函数到每一个triplet ，使用用户定义的reduce函数聚合产生 messages。。</span></span><br><span class="line"><span class="comment">// 然而，我们发现用户返回迭代器是昂贵的，它抑制了我们应用额外优化(例如，本地顶点的重新编号)的能</span></span><br><span class="line"><span class="comment">// 在 aggregateMessages 中我们引进了EdgeContext，其暴露triplet属性，也明确了函数发送信息的源和顶点//。</span></span><br><span class="line"><span class="comment">// 除此之外，我们移除了字节码检测，取而代之的是要求用户指明哪个triplet属性被需要。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[<span class="type">Int</span>, <span class="type">Float</span>] = ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msgFun</span></span>(triplet: <span class="type">Triplet</span>[<span class="type">Int</span>, <span class="type">Float</span>]): <span class="type">Iterator</span>[(<span class="type">Int</span>, <span class="type">String</span>)] = &#123;</span><br><span class="line">  <span class="type">Iterator</span>((triplet.dstId, <span class="string">"Hi"</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reduceFun</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = a + b</span><br><span class="line"><span class="keyword">val</span> result = graph.mapReduceTriplets[<span class="type">String</span>](msgFun, reduceFun)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msgFun</span></span>(t: <span class="type">EdgeContext</span>[(<span class="type">String</span>,<span class="type">Int</span>), <span class="type">Int</span>, <span class="type">Int</span>]) &#123;</span><br><span class="line">  t.sendToSrc(<span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reduceFun</span></span>(a: <span class="type">Int</span>, b: <span class="type">Int</span>): <span class="type">Int</span> = a + b</span><br><span class="line"><span class="keyword">val</span> result = graph.aggregateMessages[<span class="type">Int</span>](msgFun, reduceFun)</span><br><span class="line"></span><br><span class="line">result.foreach(println)</span><br></pre></td></tr></table></figure><h3 id="aggregateMessages"><a href="#aggregateMessages" class="headerlink" title="aggregateMessages"></a><strong>aggregateMessages</strong></h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//对每个节点的邻接点的属性进行聚合统计</span></span><br><span class="line"><span class="comment">//老版本使用 mapReduceTriplets</span></span><br><span class="line"><span class="keyword">val</span> oldFlowers: <span class="type">VertexRDD</span>[(<span class="type">Int</span>,<span class="type">Double</span>)] = graph.mapReduceTriplets[(<span class="type">Int</span>,<span class="type">Double</span>)]&#123;</span><br><span class="line">    triplet =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (triplet.srcAttr &gt; triplet.dstAttr) &#123;</span><br><span class="line">        <span class="type">Iterator</span>((triplet.dstId, (<span class="number">1</span>, triplet.srcAttr )))</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Iterator</span>.empty</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    (a,b) =&gt; (a._1+b._1, a._2+b._2)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在使用 aggregateMessages 代替</span></span><br><span class="line"><span class="comment">// 首先生成一个随机图</span></span><br><span class="line"><span class="keyword">val</span> g: <span class="type">Graph</span>[<span class="type">Double</span>,<span class="type">Int</span>] = <span class="type">GraphGenerators</span>.logNormalGraph(sc, numVertices = <span class="number">100</span>).mapVertices( d,_) =&gt; id.toDouble )</span><br><span class="line"><span class="comment">//g.edges.foreach(println)</span></span><br><span class="line"><span class="comment">//println</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msgFun</span></span>(triplet: <span class="type">EdgeContext</span>[<span class="type">Double</span>, <span class="type">Int</span>, (<span class="type">Int</span>,<span class="type">Double</span>)]) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (triplet.srcAttr &gt; triplet.dstAttr) &#123;</span><br><span class="line">    triplet.sendToDst((<span class="number">1</span>, triplet.srcAttr ))</span><br><span class="line">    <span class="comment">//注意：原先的 Iterator((triplet.dstId, (1, triplet.srcAttr ))) 上述代码替换，作用完全一样</span></span><br><span class="line">    <span class="comment">//sendToDst 意思为向 目标点 发送消息</span></span><br><span class="line">    <span class="comment">//println("Iterator(("+triplet.dstId+", (1, "+triplet.srcAttr+" )))");</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="type">Iterator</span>.empty</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 有个问题：写成函数定义的形式 下面代码总是出错</span></span><br><span class="line"><span class="comment">// def reduceFun(a:Int,b:Double): (Int,Double) = (a._1+b._1, a._2+b._2)</span></span><br><span class="line"><span class="comment">// aggregateMessages[OOO] OOO处的类型，会附加到图g类型之后，</span></span><br><span class="line"><span class="comment">// 即：g为 Double,Int --&gt;  result为 Double,Int,OOO</span></span><br><span class="line"><span class="keyword">val</span> result = g.aggregateMessages[(<span class="type">Int</span>,<span class="type">Double</span>)](msgFun, (a,b) =&gt; (a._1+b._1,a._2+b._2))</span><br><span class="line"></span><br><span class="line"><span class="comment">//result.collect.foreach(println)</span></span><br><span class="line"><span class="comment">//上述代码执行完后，形如(45,2913.0)，已经是reduce完成的状态，如果下面继续计算平均值，直接后项除项即可</span></span><br><span class="line"><span class="comment">//(19,(45,2913.0))</span></span><br><span class="line"><span class="comment">//(39,(45,2873.0))</span></span><br><span class="line"><span class="comment">//(34,(32,2102.0))</span></span><br><span class="line"><span class="comment">//(4,(62,3466.0))</span></span><br><span class="line"><span class="comment">//(71,(12,1028.0))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//result现在是(Int,Double)形式，现在对Double元素即value</span></span><br><span class="line"><span class="comment">//这里的的match-case类似于switch-case</span></span><br><span class="line"><span class="comment">//对于avg:VertexRDD[Double]，后项变量类型可以省去不写</span></span><br><span class="line"><span class="keyword">val</span> avg:<span class="type">VertexRDD</span>[<span class="type">Double</span>] = result.mapValues(</span><br><span class="line">  (_,value) =&gt; <span class="comment">//这句话意思是前项保持不动，对后项value即形如(12,1028.0)的部分进行加工</span></span><br><span class="line">    value <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> (count,total) =&gt; total/count</span><br><span class="line">    &#125;</span><br><span class="line">) <span class="comment">//整体返回值avg类型为(Int,Double)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//avg.collect.foreach(println)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//下面不使用随机图，使用开头自定义的图结构时：</span></span><br><span class="line"></span><br><span class="line">graph.triplets.foreach(e =&gt; intln(<span class="string">s"edge(<span class="subst">$&#123;e.srcId&#125;</span>,<span class="subst">$&#123;e.dstId&#125;</span>)\tage(<span class="subst">$&#123;e.srcAttr._2&#125;</span>,<span class="subst">$&#123;e.dstAttr._2&#125;</span>)"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msgFun</span></span>(triplet: <span class="type">EdgeContext</span>[(<span class="type">String</span>,<span class="type">Int</span>), <span class="type">Int</span>, (<span class="type">Int</span>,<span class="type">Double</span>)]) &#123;</span><br><span class="line">  <span class="keyword">if</span> (triplet.srcAttr._2 &gt; triplet.dstAttr._2) &#123;</span><br><span class="line">    triplet.sendToDst((<span class="number">1</span>, triplet.srcAttr._2 ))</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="type">Iterator</span>.empty</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> result = graph.aggregateMessages[(<span class="type">Int</span>,<span class="type">Double</span>)](msgFun, (a,b) =&gt; (a._1+b._1,a._2+b._2))</span><br><span class="line">println</span><br><span class="line">result.collect.foreach(println)</span><br><span class="line"><span class="comment">//分析：原始图结构</span></span><br><span class="line"><span class="comment">//((2,(Bob,27)),(1,(Alice,28)),7)</span></span><br><span class="line"><span class="comment">//((2,(Bob,27)),(4,(David,42)),2)</span></span><br><span class="line"><span class="comment">//((3,(Charlie,65)),(2,(Bob,27)),4)   年龄条件符合：顶点2 邻居的Age为 65</span></span><br><span class="line"><span class="comment">//((3,(Charlie,65)),(6,(Fran,50)),3)  年龄条件符合：顶点6 邻居的Age为 65</span></span><br><span class="line"><span class="comment">//((4,(David,42)),(1,(Alice,28)),1)   年龄条件符合：顶点1 邻居的Age为 42     = 42  1个邻居</span></span><br><span class="line"><span class="comment">//((5,(Ed,55)),(2,(Bob,27)),2)        年龄条件符合：顶点2 邻居的Age为 65+55  = 120 2个邻居</span></span><br><span class="line"><span class="comment">//((5,(Ed,55)),(3,(Charlie,65)),8)</span></span><br><span class="line"><span class="comment">//((5,(Ed,55)),(6,(Fran,50)),3)       年龄条件符合：顶点6 邻居的Age为 65+55  = 120 2个邻居</span></span><br><span class="line"><span class="comment">//上述计算的意义是：找到每个顶点用户的比自身年龄大的邻居节点用户的年龄之和，以及邻居数；</span></span><br><span class="line"><span class="comment">//所以，result为：</span></span><br><span class="line"><span class="comment">//(1,(1,42.0))</span></span><br><span class="line"><span class="comment">//(6,(2,120.0))</span></span><br><span class="line"><span class="comment">//(2,(2,120.0))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//继续求平均值</span></span><br><span class="line"><span class="keyword">val</span> avg:<span class="type">VertexRDD</span>[<span class="type">Double</span>] = result.mapValues(</span><br><span class="line">  (_,value) =&gt;</span><br><span class="line">    value <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> (count,total) =&gt; total/count</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">println</span><br><span class="line">avg.collect.foreach(println)</span><br><span class="line"><span class="comment">//上述计算的意义是：找到每个顶点用户的比自身年龄大的邻居节点用户的平均年龄，即原本的计算目的</span></span><br><span class="line"><span class="comment">//结果为：</span></span><br><span class="line"><span class="comment">// (1,42.0)</span></span><br><span class="line"><span class="comment">// (6,60.0)</span></span><br><span class="line"><span class="comment">// (2,60.0)</span></span><br></pre></td></tr></table></figure><h3 id="Pregel-API-Functions"><a href="#Pregel-API-Functions" class="headerlink" title="Pregel API Functions"></a><strong>Pregel API Functions</strong></h3><ul><li><strong>Shortest path</strong></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// ShortestPath 没有被封装成方法，需要自己实现</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sourceId: <span class="type">VertexId</span> = <span class="number">5</span>L <span class="comment">// 定义源点</span></span><br><span class="line"><span class="comment">// 用一个新图initialGraph 来初始化 顶点5 同其他顶点间的距离：本身距离为0，其他距离为MAX</span></span><br><span class="line"><span class="keyword">val</span> initialGraph = graph.mapVertices((id,_) =&gt; <span class="keyword">if</span> (id == sourceId) <span class="number">0.0</span> <span class="keyword">else</span> uble.<span class="type">PositiveInfinity</span>)</span><br><span class="line"><span class="comment">//initialGraph.vertices.foreach(println)</span></span><br><span class="line"><span class="comment">//(4,Infinity)</span></span><br><span class="line"><span class="comment">//(1,Infinity)</span></span><br><span class="line"><span class="comment">//(6,Infinity)</span></span><br><span class="line"><span class="comment">//(3,Infinity)</span></span><br><span class="line"><span class="comment">//(5,0.0)</span></span><br><span class="line"><span class="comment">//(2,Infinity)</span></span><br><span class="line"><span class="comment">//initialGraph.triplets.foreach(println)</span></span><br><span class="line"><span class="comment">//((2,Infinity),(1,Infinity),7)</span></span><br><span class="line"><span class="comment">//((2,Infinity),(4,Infinity),2)</span></span><br><span class="line"><span class="comment">//((3,Infinity),(2,Infinity),4)</span></span><br><span class="line"><span class="comment">//((3,Infinity),(6,Infinity),3)</span></span><br><span class="line"><span class="comment">//((4,Infinity),(1,Infinity),1)</span></span><br><span class="line"><span class="comment">//((5,0.0),(2,Infinity),2)</span></span><br><span class="line"><span class="comment">//((5,0.0),(3,Infinity),8)</span></span><br><span class="line"><span class="comment">//((5,0.0),(6,Infinity),3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Unspecified value parameters: vprog:</span></span><br><span class="line"><span class="comment">// 第一部分：(graphx.VertexId, Double, Double) =&gt; Double,</span></span><br><span class="line"><span class="comment">// 第二部分：sendMsg: EdgeTriplet[Double, Int] =&gt; Iterator[(graphx.VertexId, Double)],</span></span><br><span class="line"><span class="comment">// 第三部分：mergeMsg: (Double, Double) =&gt; Double</span></span><br><span class="line"><span class="keyword">val</span> sssp = initialGraph.pregel(<span class="type">Double</span>.<span class="type">PositiveInfinity</span>)(</span><br><span class="line">  (id, dist, newDist) =&gt; &#123;math.min(dist, newDist)&#125;,</span><br><span class="line">  triplet =&gt; &#123;  <span class="comment">// 计算权重</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (triplet.srcAttr + triplet.attr &lt; triplet.dstAttr) &#123;</span><br><span class="line">      println(<span class="string">"Iterator(("</span>+triplet.dstId+<span class="string">", "</span>+triplet.srcAttr+<span class="string">" + "</span>+triplet.attr+<span class="string">"))"</span>)</span><br><span class="line">      <span class="comment">//triplet.attr即边的权重，不断加入triplet.attr，最后就能找到最短路径</span></span><br><span class="line">      <span class="type">Iterator</span>((triplet.dstId, triplet.srcAttr + triplet.attr))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      println(<span class="string">"Iterator.empty"</span>)</span><br><span class="line">      <span class="type">Iterator</span>.empty</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  (a,b) =&gt; math.min(a,b) <span class="comment">// 更新点⑤到该点的距离</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//解释下过程，拿Triplets结构来说</span></span><br><span class="line"><span class="comment">//((2,Infinity),(1,Infinity),7)</span></span><br><span class="line"><span class="comment">//((2,Infinity),(4,Infinity),2)</span></span><br><span class="line"><span class="comment">//((3,Infinity),(2,Infinity),4)</span></span><br><span class="line"><span class="comment">//((3,Infinity),(6,Infinity),3)</span></span><br><span class="line"><span class="comment">//((4,Infinity),(1,Infinity),1)</span></span><br><span class="line"><span class="comment">//((5,0.0),(2,Infinity),2)</span></span><br><span class="line"><span class="comment">//((5,0.0),(3,Infinity),8)</span></span><br><span class="line"><span class="comment">//((5,0.0),(6,Infinity),3)</span></span><br><span class="line"><span class="comment">//首先由于前五行，顶点的attr均为Infinity，所以sendMsg中的Iterator均是empty空迭代</span></span><br><span class="line"><span class="comment">//第六行，0+2&lt;Infinity，满足条件，传递（0+2=2）到入点，即变为((5,0.0),(2,2),2)，意为5到点2距2</span></span><br><span class="line"><span class="comment">//第七行，0+8&lt;Infinity，满足条件，传递（0+8=8）到入点，即变为((5,0.0),(3,8),8)，意为5到点3距8</span></span><br><span class="line"><span class="comment">//第八行，0+2&lt;Infinity，满足条件，传递（0+2=2）到入点，即变为((5,0.0),(6,3),3)，意为5到点6距3</span></span><br><span class="line"><span class="comment">//==进行mergeMsg步骤== 注意现在更新为：</span></span><br><span class="line"><span class="comment">//((2,2),(1,Infinity),7)</span></span><br><span class="line"><span class="comment">//((2,2),(4,Infinity),2)</span></span><br><span class="line"><span class="comment">//((3,8),(2,2),4)</span></span><br><span class="line"><span class="comment">//((3,8),(6,3),3)</span></span><br><span class="line"><span class="comment">//((4,Infinity),(1,Infinity),1)</span></span><br><span class="line"><span class="comment">//((5,0.0),(2,2),2)</span></span><br><span class="line"><span class="comment">//((5,0.0),(3,8),8)</span></span><br><span class="line"><span class="comment">//((5,0.0),(6,3),3)</span></span><br><span class="line"><span class="comment">//第一行，2+7&lt;Infinity，满足条件，传递（2+7=9）到入点，即变为((2,2),(1,9),7)，意为5到点1距离为2=9</span></span><br><span class="line"><span class="comment">//第二行，2+2&lt;Infinity，满足条件，传递（2+2=4）到入点，即变为((2,2),(4,4),2)，意为5到点4距离为2=4</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 8+4&gt;2</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 8+3&gt;3</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 Infinity无法比较</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 0+2=2</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 0+8=8</span></span><br><span class="line"><span class="comment">//Iterator.empty 因为 0+3=3</span></span><br><span class="line"><span class="comment">//==进行mergeMsg步骤== 注意现在更新为：</span></span><br><span class="line"><span class="comment">//((2,2),(1,9),7)</span></span><br><span class="line"><span class="comment">//((2,2),(4,4),2)</span></span><br><span class="line"><span class="comment">//((3,8),(2,2),4)</span></span><br><span class="line"><span class="comment">//((3,8),(6,3),3)</span></span><br><span class="line"><span class="comment">//((4,4),(1,9),1)</span></span><br><span class="line"><span class="comment">//((5,0.0),(2,2),2)</span></span><br><span class="line"><span class="comment">//((5,0.0),(3,8),8)</span></span><br><span class="line"><span class="comment">//((5,0.0),(6,3),3)</span></span><br><span class="line"><span class="comment">//第一行：Iterator.empty 因为 2+7=9</span></span><br><span class="line"><span class="comment">//第二行：Iterator.empty 因为 2+2=4</span></span><br><span class="line"><span class="comment">//第三行：Iterator.empty 因为 8+4&gt;2</span></span><br><span class="line"><span class="comment">//第四行：Iterator.empty 因为 8+3&gt;3</span></span><br><span class="line"><span class="comment">//第五行：4+1&lt;9，满足条件，传递（4+1=5）到入点，即变为((4,4),(1,5),1)，意为5到点1距离由9更新为5</span></span><br><span class="line"><span class="comment">//第六行：Iterator.empty 因为 0+2=2</span></span><br><span class="line"><span class="comment">//第七行：Iterator.empty 因为 0+8=8</span></span><br><span class="line"><span class="comment">//第八行：Iterator.empty 因为 0+3=3</span></span><br><span class="line"><span class="comment">//==进行mergeMsg步骤== 注意现在更新为：</span></span><br><span class="line"><span class="comment">//((2,2),(1,5),7)</span></span><br><span class="line"><span class="comment">//((2,2),(4,4),2)</span></span><br><span class="line"><span class="comment">//((3,8),(2,2),4)</span></span><br><span class="line"><span class="comment">//((3,8),(6,3),3)</span></span><br><span class="line"><span class="comment">//((4,4),(1,5),1)</span></span><br><span class="line"><span class="comment">//((5,0.0),(2,2),2)</span></span><br><span class="line"><span class="comment">//((5,0.0),(3,8),8)</span></span><br><span class="line"><span class="comment">//((5,0.0),(6,3),3)</span></span><br><span class="line"><span class="comment">//此时，每个顶点的格式即（顶点id，顶点5到该顶点的最短距离），即最短路径算法完成</span></span><br><span class="line"></span><br><span class="line">sssp.vertices.foreach(println)</span><br><span class="line"><span class="comment">//最终输出的结果:</span></span><br><span class="line"><span class="comment">//(4,4.0)</span></span><br><span class="line"><span class="comment">//(1,5.0)</span></span><br><span class="line"><span class="comment">//(6,3.0)</span></span><br><span class="line"><span class="comment">//(3,8.0)</span></span><br><span class="line"><span class="comment">//(5,0.0)</span></span><br><span class="line"><span class="comment">//(2,2.0)</span></span><br></pre></td></tr></table></figure><ul><li><strong>PageRank</strong></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PageRank 有封装好的方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意PageRank的参数，其实可以用精度来理解，这个值越小rank计算越精确，但计算时间也越长</span></span><br><span class="line">graph.pageRank(<span class="number">0.01</span>).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,0.9727164143364966)</span></span><br><span class="line"><span class="comment">//(1,1.7757164399923602)</span></span><br><span class="line"><span class="comment">//(6,1.0009207604397985)</span></span><br><span class="line"><span class="comment">//(3,0.7024005336419639)</span></span><br><span class="line"><span class="comment">//(5,0.5473250911495823)</span></span><br><span class="line"><span class="comment">//(2,1.0009207604397985)</span></span><br><span class="line">graph.pageRank(<span class="number">0.05</span>).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,0.9993165004824702)</span></span><br><span class="line"><span class="comment">//(1,1.700587005467996)</span></span><br><span class="line"><span class="comment">//(6,0.9890640077195239)</span></span><br><span class="line"><span class="comment">//(3,0.7430041814088131)</span></span><br><span class="line"><span class="comment">//(5,0.5789642972016725)</span></span><br><span class="line"><span class="comment">//(2,0.9890640077195239)</span></span><br><span class="line">graph.pageRank(<span class="number">0.1</span>).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,1.035409289731306)</span></span><br><span class="line"><span class="comment">//(1,1.5453030618621122)</span></span><br><span class="line"><span class="comment">//(6,1.0247865028119143)</span></span><br><span class="line"><span class="comment">//(3,0.7698396167465112)</span></span><br><span class="line"><span class="comment">//(5,0.5998750260362425)</span></span><br><span class="line"><span class="comment">//(2,1.0247865028119143)</span></span><br><span class="line">graph.pageRank(<span class="number">0.5</span>).vertices.foreach(println)</span><br><span class="line"><span class="comment">//(4,0.9999999999999999)</span></span><br><span class="line"><span class="comment">//(1,0.9999999999999999)</span></span><br><span class="line"><span class="comment">//(6,0.9999999999999999)</span></span><br><span class="line"><span class="comment">//(3,0.9999999999999999)</span></span><br><span class="line"><span class="comment">//(5,0.9999999999999999)</span></span><br><span class="line"><span class="comment">//(2,0.9999999999999999)</span></span><br></pre></td></tr></table></figure><ul><li><strong>TrangleCount</strong></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TrangleCount 有封装好的方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，老版本GraphX需要 srcID&lt;dstID，有些教程还是这样说的，但是2.x已经没有这个要求</span></span><br><span class="line">graph.triangleCount().vertices.foreach(println)</span><br><span class="line"><span class="comment">//输出结果：</span></span><br><span class="line"><span class="comment">//(4,1) 意思为顶点4 外接一个三角形</span></span><br><span class="line"><span class="comment">//(1,1) ..</span></span><br><span class="line"><span class="comment">//(6,1) ..</span></span><br><span class="line"><span class="comment">//(3,2) 意思为顶点2 外接两个三角形</span></span><br><span class="line"><span class="comment">//(5,2) ..</span></span><br><span class="line"><span class="comment">//(2,2) ..</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scala </tag>
            
            <tag> 整合 </tag>
            
            <tag> 实践 </tag>
            
            <tag> GraphX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java向Oracle数据库表中插入CLOB、BLOB字段</title>
      <link href="/article/cd06.html"/>
      <url>/article/cd06.html</url>
      
        <content type="html"><![CDATA[<p>在需要存储较长字符串到数据库中时往往需要使用一些特殊类型的字段，在Oracle中即blob和clob字段，一般而言：Clob字段存储字符信息，比如较长的文字、评论，Blob字段存储字节信息，比如图像的base64编码。</p><p>注意，上述字段的使用均可以用其他方式替代，比如用MongoDB或者图片直接存储为文件等等，这里不纠结场景的合适与否，只是针对Blob和Clob类型的使用来举例。</p><a id="more"></a><h3 id="操作场景"><a href="#操作场景" class="headerlink" title="操作场景"></a>操作场景</h3><p>主要有三种场景：</p><ul><li>仅对已知表中的某一字段写入Blob和Clob字段的值</li><li>更新已知表中全部字段的值（均为Blob和Clob字段）</li><li>插入数据中带有部分需要插入Blob和Clob字段的数据</li></ul><p>总结来看，后两种均以第一种场景为基础，即我们必须明确如何向Blob和Clob字段写入数据。第二种场景实际上是第一种的重复操作，那么对于第三种，需要十分注意，这里意味着需要向表中插入一行记录，操作有部分差异，在此我们就用第三种场景为例来给出示例。</p><h3 id="插入时带Blob和Clob字段"><a href="#插入时带Blob和Clob字段" class="headerlink" title="插入时带Blob和Clob字段"></a>插入时带Blob和Clob字段</h3><p>情景再现：</p><p>从数据源接收数据，解析完成后产生SQL语句并批量插入数据表，注意，原记录中含有若干个Blob字段（图片编码）和若干个Clob字段（记录信息），其余字段均为一般类型（String，Integer）</p><p>在给出代码前，注意几点：</p><ol><li>Blob和Clob需要单独处理，即一个SQL语句无法完成上述需求</li><li>整个过程分为三部分：组装SQL语句、第一遍插入、第二次插入Blob和Clob类型</li><li>组装SQL语句时：Blob需要人为empty_blob()，置空为Clob需要人为置空为empty_clob()</li><li>每次插入都需要对特殊字段进行处理，故无法使用batch操作</li><li>特殊字段处理（第二次插入），必须在第一遍插入之后进行，此时已初始化为empty_blob()或empty_clob()</li></ol><p>下面就以带特定场景需求的代码来展示写入示例。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="代码背景"><a href="#代码背景" class="headerlink" title="代码背景"></a>代码背景</h3><p>数据源每次发送一个XML字符串非常长，代码端每次解析这个串，解析后会成为 N 条记录，其中每条记录要解析为 M 个字段，其中含有 m 个Blob字段和 n 个Clob字段，现在需要把这 N 条记录插入到数据表中。</p><p>上述的 N，M，n，m 大小均不定且动态变化（已知某些字段是，但这些字段不一定出现），即大小未知。</p><h3 id="大致代码流程"><a href="#大致代码流程" class="headerlink" title="大致代码流程"></a>大致代码流程</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ... ... 整个过程围绕xml节点的迭代来完成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(iter1.hasNext())&#123;  </span><br><span class="line"></span><br><span class="line">  Element e = iter1.next();  </span><br><span class="line">  Iterator&lt;Element&gt; iter2 = e.elementIterator(); </span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 每一条SQL</span></span><br><span class="line">  <span class="keyword">while</span>(iter2.hasNext())&#123;   </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">boolean</span> flag1 = <span class="keyword">false</span>; <span class="comment">// 标志是否含有Clob字段</span></span><br><span class="line">    <span class="keyword">boolean</span> flag2 = <span class="keyword">false</span>; <span class="comment">// 标志是否含有Blob字段</span></span><br><span class="line">    </span><br><span class="line">    String blobId = <span class="string">""</span>;<span class="comment">// 储存所在SQL语句的主键值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始组装每一条SQL语句</span></span><br><span class="line">    Iterator&lt;Element&gt; iter3 = f.elementIterator();  </span><br><span class="line">    <span class="keyword">while</span>(iter3.hasNext())&#123;  </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// ... ...</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span>(colname)&#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">case</span> <span class="string">"CLOB字段名1"</span> :</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"CLOB字段名2"</span> :</span><br><span class="line">    <span class="comment">// ... </span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"CLOB字段名N"</span> : &#123; <span class="comment">//暂存CLOB数据 </span></span><br><span class="line">      cList.add(colname);</span><br><span class="line">      cList.add(h.getStringValue());</span><br><span class="line">      flag1 = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">break</span>; <span class="comment">// break switch</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"BLOB字段名1"</span> :</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"BLOB字段名2"</span> :</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"BLOB字段名N"</span> :&#123; <span class="comment">//暂存BLOB数据 </span></span><br><span class="line">      bList.add(colname);</span><br><span class="line">      bList.add(h.getStringValue());</span><br><span class="line">      flag2 = <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:&#123;</span><br><span class="line">      <span class="keyword">if</span>( <span class="keyword">this</span> value is the primary key )&#123;</span><br><span class="line">        blobId = <span class="keyword">this</span> value</span><br><span class="line">      &#125;    </span><br><span class="line"></span><br><span class="line">      strVALUE.append( <span class="keyword">this</span> valu , ); <span class="comment">// 字段值</span></span><br><span class="line">      strNAMES.append( his value , ); <span class="comment">// 字段名   </span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 去掉最后一个多余的逗号</span></span><br><span class="line">    strVALUE.deleteCharAt( strVALUE.length() - <span class="number">1</span>);</span><br><span class="line">    strNAMES.deleteCharAt( strNAMES.length() - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后追加处理 empty_clob()和empty_blob()</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; cList.size(); i=i+<span class="number">2</span>)&#123;</span><br><span class="line">      strNAMES.append(<span class="string">",\""</span>+cList.get(i)+<span class="string">"\""</span>);</span><br><span class="line">      strVALUE.append(<span class="string">",empty_clob()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; bList.size(); i=i+<span class="number">2</span>)&#123;</span><br><span class="line">      strNAMES.append(<span class="string">",\""</span>+bList.get(i)+<span class="string">"\""</span>);</span><br><span class="line">      strVALUE.append(<span class="string">",empty_blob()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 最终形态（第一次插入的语句）</span></span><br><span class="line">    sqlStr.append(<span class="string">"INSERT INTO 表名 ( "</span>+strNAMES+<span class="string">" ) VALUES ( "</span>+strVALUE+<span class="string">" )"</span>);</span><br><span class="line">        </span><br><span class="line">    pstmt = con.prepareStatement(sqlStr.toString());</span><br><span class="line"></span><br><span class="line">    pstmt.executeUpdate(); <span class="comment">// first insert done</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(pstmt != <span class="keyword">null</span>)&#123;</span><br><span class="line">      pstmt.close();</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 上述第一次插入完成后，开始单独处理特殊类型（第二次插入）</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 根据 flag1 判断是否有Clob类型的数据</span></span><br><span class="line">    <span class="keyword">if</span>(flag1)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; cList.size(); i=i+<span class="number">2</span>)&#123;</span><br><span class="line">        pstmt = con.prepareStatement(</span><br><span class="line">          <span class="string">"SELECT "</span>+cList.get(i)+<span class="string">" FROM 表名 WHERE 表主键 = "</span>+blobId+<span class="string">" for update"</span>);</span><br><span class="line">        ResultSet rs = pstmt.executeQuery();</span><br><span class="line">        Writer outStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;  </span><br><span class="line">          <span class="comment">//得到java.sql.Clob对象后强制转换为oracle.sql.CLOB  </span></span><br><span class="line">          oracle.sql.CLOB clob = (oracle.sql.CLOB) rs.getClob(cList.get(i));  </span><br><span class="line">          outStream = clob.getCharacterOutputStream();  </span><br><span class="line">          <span class="comment">//传入字符串</span></span><br><span class="line">          <span class="keyword">char</span>[] c = cList.get(i+<span class="number">1</span>).toCharArray();  </span><br><span class="line">          outStream.write(c, <span class="number">0</span>, c.length);  </span><br><span class="line">        &#125;  </span><br><span class="line">        outStream.flush();  </span><br><span class="line">        outStream.close();  </span><br><span class="line">        con.commit(); </span><br><span class="line">        <span class="keyword">if</span>(pstmt != <span class="keyword">null</span>)&#123;</span><br><span class="line">          pstmt.close();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// 根据 flag1 判断是否有Blob类型的数据</span></span><br><span class="line">    <span class="keyword">if</span>(flag2)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; bList.size(); i=i+<span class="number">2</span>)&#123;</span><br><span class="line">        pstmt = con.prepareStatement(</span><br><span class="line">          <span class="string">"SELECT "</span>+bList.get(i)+<span class="string">" FROM 表名 WHERE 表主键 = "</span>+blobId+<span class="string">" for update"</span> );</span><br><span class="line">        ResultSet rs = pstmt.executeQuery();</span><br><span class="line">        OutputStream os = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;  </span><br><span class="line">          <span class="comment">// 得到java.sql.Blob对象后强制转换为oracle.sql.BLOB  </span></span><br><span class="line">          oracle.sql.BLOB blob = (oracle.sql.BLOB) rs.getBlob(bList.get(i));  </span><br><span class="line">          <span class="comment">// 通过getBinaryOutputStream()方法获得向数据库中插入图片的流</span></span><br><span class="line">          os = blob.getBinaryOutputStream();  </span><br><span class="line">          <span class="comment">// 读取想要存储的图片文件（或串值） </span></span><br><span class="line">          InputStream is = <span class="keyword">new</span> ByteArrayInputStream(bList.get(i+<span class="number">1</span>).getBytes());</span><br><span class="line">          <span class="comment">// 依次读取流字节,并输出到已定义好的数据库字段中.  </span></span><br><span class="line">          <span class="keyword">int</span> b = <span class="number">0</span>;  </span><br><span class="line">          <span class="keyword">while</span> ((b = is.read()) != -<span class="number">1</span>) &#123;  </span><br><span class="line">            os.write(b);  </span><br><span class="line">          &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        os.flush();  </span><br><span class="line">        os.close();  </span><br><span class="line">        con.commit(); </span><br><span class="line">        <span class="keyword">if</span>(pstmt != <span class="keyword">null</span>)&#123;</span><br><span class="line">          pstmt.close();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="comment">// end while </span></span><br><span class="line">&#125; <span class="comment">// end while</span></span><br></pre></td></tr></table></figure><p>上述代码段的环境非常特殊，前面已经说了，是一个比较复杂的处理逻辑，代码中有些变量定义没写出来，有些地方也去掉了特定变量换成了文字叙述，所以，上述代码仅仅是为了提供思路，并且包含了一些处理技巧：</p><ul><li>如何结合XML对象解析构造SQL</li><li>如何拼接SQL字符串</li><li>如何暂存特殊类型字段</li><li>如何在第一次插入时设置empty_blob()</li><li>如何通过主键值来进行第二次插入</li><li>如何插入Blob和Clob字段</li></ul><p>如果你有更好的方法或者是对该文章有任何的疑问或想法，请在下方留言，我会第一时间回复的！</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> CLOB </tag>
            
            <tag> BLOB </tag>
            
            <tag> SQL插入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GraphX编程指南-官方文档-整理</title>
      <link href="/article/2d41.html"/>
      <url>/article/2d41.html</url>
      
        <content type="html"><![CDATA[<p>GraphX 是新的(alpha)的图形和图像并行计算的Spark API。从整理上看，GraphX 通过引入 弹性分布式属性图(Resilient Distributed Property Graph)继承了Spark RDD：一个将有效信息放在顶点和边的有向多重图。为了支持图形计算，GraphX 公开了一组基本的运算（例如，subgraph，joinVertices和mapReduceTriplets），以及在一个优化后的<br>PregelAPI的变形。此外，GraphX 包括越来越多的图算法和 builder 构造器，以简化图形分析任务。</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccthlr9p187rj041rg21pe41mgv9.png" alt></p><p>GraphX 目前是一个 alpha 组件。虽然我们会尽量减少 API 的变化，但是一些 API 可能会在将来的版本中改变。</p><h4 id="图并行计算的背景"><a href="#图并行计算的背景" class="headerlink" title="图并行计算的背景"></a><strong>图并行计算的背景</strong></h4><p>从社交网络到语言建模，日益扩大的规模和图形数据的重要性已带动许多新的图像并行系统（例如，Giraph和 GraphLab）。通过限制可表示计算的类型以及引入新的技术来划分和分布图，这些系统比一般的数据并行系统在执行复杂图形算法方面有大幅度地提高。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccthsb1e14kl1ii013uj1did1k8km.png" alt></p><p>然而，这些限制在获得重大性能提升的同时，也使其难以表达一个典型的图表分析流程中的许多重要阶段：构造图，修改它的结构或表达计算跨越多重图的计算。此外，如何看待数据取决于我们的目标，相同的原始数据，可能有许多不同的表(table)和图表视图(graph views)。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccthuiq8e381jbu5gm1efs7m813.png" alt></p><p>因此，能够在同一组物理数据的表和图表视图之间切换是很有必要的，并利用各视图的属性，以方便地和有效地表达计算。但是，现有的图形分析管道必须由图并行和数据并行系统组成，从而导致大量的数据移动和重复以及复杂的编程模型。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccthvs4q11911f671skf1jeeitd1g.png" alt></p><p>该 GraphX 项目的目标是建立一个系统，建立一个统一的图和数据并行计算的 API。该GraphX API 使用户能够将数据既可以当作一个图，也可以当作集合（即RDDS）而不用进行数据移动或数据复制。通过引入在图并行系统中的最新进展，GraphX能够优化图形操作的执行。</p><h4 id="GraphX-替换-Spark-Bagel-的-API"><a href="#GraphX-替换-Spark-Bagel-的-API" class="headerlink" title="GraphX 替换 Spark Bagel 的 API"></a><strong>GraphX 替换 Spark Bagel 的 API</strong></h4><p>在GraphX 的发布之前，Spark的图计算是通过Bagel实现的，后者是Pregel的一个具体实现。GraphX提供了更丰富的图属性API，从而增强了Bagel。从而达到一个更加精简的Pregel抽象，系统优化，性能提升以及减少内存开销。虽然我们计划最终弃用Bagel，我们将继续支持Bagel的API和Bagel编程指南。不过，我们鼓励Bagel用户，探索新的GraphXAPI，并就从Bagel升级中遇到的障碍反馈给我们。</p><h4 id="从-Spark-0-9-1-迁移"><a href="#从-Spark-0-9-1-迁移" class="headerlink" title="从 Spark 0.9.1 迁移"></a><strong>从 Spark 0.9.1 迁移</strong></h4><p>GraphX 在Spark 1.1.0 包含Spark-0.9.1一个用户面向接口的改变。EdgeRDD现在可以存储相邻顶点属性来构建triplets，因此它获得了一个类型参数。一个Graph[VD，ED]的边的类型是EdgeRDD[ED，VD]而不是 EdgeRDD[ED]。</p><h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a><strong>入门</strong></h3><p>首先，你要导入 Spark 和 GraphX 到你的项目，如下所示：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark._</span><br><span class="line"><span class="keyword">import</span>  org.apache.spark.graphx._</span><br><span class="line"><span class="comment">// To make some of the examples work we will also need RDD</span></span><br><span class="line"><span class="keyword">import</span>  org.apache.spark.rdd.<span class="type">RDD</span></span><br></pre></td></tr></table></figure><p>如果你不使用Spark shell，你还需要一个 SparkContext。要了解更多有关如何开始使用Spark参考 Spark快速入门指南。</p><h4 id="属性图"><a href="#属性图" class="headerlink" title="属性图"></a><strong>属性图</strong></h4><p>该 属性图是一个用户定义的顶点和边的有向多重图。有向多重图是一个有向图，它可能有多个平行边共享相同的源和目的顶点。多重图支持并行边的能力简化了有多重关系（例如，同事和朋友）的建模场景。每个顶点是 唯一 的 64位长的标识符（VertexID）作为主键。GraphX并没有对顶点添加任何顺序的约束。同样，每条边具有相应的源和目的顶点的标识符。</p><p>该属性表的参数由顶点（VD）和边缘（ED）的类型来决定。这些是分别与每个顶点和边相关联的对象的类型。</p><p>GraphX 优化顶点和边的类型的表示方法，当他们是普通的旧的数据类型（例如，整数，双精度等）通过将它们存储在专门的阵列减小了在内存占用量。</p><p>在某些情况下，可能希望顶点在同一个图中有不同的属性类型。这可以通过继承来实现。例如，以用户和产品型号为二分图我们可以做到以下几点：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">VertexProperty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="class"><span class="title">case</span>  <span class="title">class</span>  <span class="title">UserProperty</span>(<span class="params"> val name: <span class="type">String</span></span>)  <span class="keyword">extends</span>  <span class="title">VertexProperty</span></span></span><br><span class="line"><span class="class"><span class="title">case</span>  <span class="title">class</span>  <span class="title">ProductProperty</span>(<span class="params"> val name: <span class="type">String</span>,  val price: <span class="type">Double</span></span>)  <span class="keyword">extends</span></span></span><br><span class="line"><span class="class"><span class="title">VertexProperty</span></span></span><br><span class="line"><span class="class"><span class="title">//</span> <span class="title">The</span> <span class="title">graph</span> <span class="title">might</span> <span class="title">then</span> <span class="title">have</span> <span class="title">the</span> <span class="title">type</span></span>:</span><br><span class="line"><span class="keyword">var</span> graph: <span class="type">Graph</span>[<span class="type">VertexProperty</span>, <span class="type">String</span>] = <span class="literal">null</span></span><br></pre></td></tr></table></figure><p>和 RDDS 一样，属性图是不可变的，分布式的和容错的。对图中的值或结构的改变是通过生成具有所需更改的新图来完成的。注意原始图的该主要部分（即不受影响的结构，属性和索引）被重用，从而减少这个数据结构的成本。该图是通过启发式执行顶点分区，在不同的执行器(executor)中进行顶点的划分。与 RDDS 一样，在发生故障的情况下，图中的每个分区都可以重建。</p><p>逻辑上讲，属性图对应于一对类型集合（RDDS），这个组合记录顶点和边的属性。因此，该图表类包含成员访问该图的顶点和边：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="keyword">val</span> vertices: <span class="type">VertexRDD</span>[<span class="type">VD</span>]</span><br><span class="line">    <span class="keyword">val</span> edges: <span class="type">EdgeRDD</span>[<span class="type">ED</span>, <span class="type">VD</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类 VertexRDD [VD]和 EdgeRDD[ED，VD]继承和并且分别是一个优化的版本的RDD[(VertexID,VD)]和RDD[Edge[ED]]。这两个VertexRDD[VD]和EdgeRDD[ED,VD]提供各地图的计算内置附加功能，并充分利用内部优化。我们在上一节顶点和边RDDS中详细讨论了VertexRDD和EdgeRDD的API，但现在，他们可以简单地看成是RDDS形式的： RDD[(VertexID,VD)]和 RDD [EDGE[ED]] 。</p><h4 id="属性图的例子"><a href="#属性图的例子" class="headerlink" title="属性图的例子"></a><strong>属性图的例子</strong></h4><p>假设我们要建立一个 GraphX项目各合作者的属性图。顶点属性可能会包含用户名和职业。我们可以使用一组字符注释来描述代表合作者关系的边：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cctigkqj1nq11kh1g5615m7q421t.png" alt></p><p>由此产生的图形将有类型签名：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> userGraph: <span class="type">Graph</span>[(<span class="type">String</span>, <span class="type">String</span>), <span class="type">String</span>]</span><br></pre></td></tr></table></figure><p>有许多方法可以从原始数据文件，RDDS，甚至合成生成器来生成图，我们会在 graph builders 更详细的讨论。可能是最通用的方法是使用 Graph ojbect。例如，下面的代码从一系列的RDDS的集合中构建图：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Assume the SparkContext has already been constructed</span></span><br><span class="line"><span class="keyword">val</span> sc: <span class="type">SparkContext</span></span><br><span class="line"><span class="comment">// Create an RDD for the vertices</span></span><br><span class="line"><span class="keyword">val</span> users: <span class="type">RDD</span>[(<span class="type">VertexId</span>, (<span class="type">String</span>, <span class="type">String</span>))] =</span><br><span class="line">    sc.parallelize( <span class="type">Array</span>((<span class="number">3</span>L, (<span class="string">"rxin"</span>, <span class="string">"student"</span>)), (<span class="number">7</span>L, (<span class="string">"jgonzal"</span>,<span class="string">"postdoc"</span>)),(<span class="number">5</span>L, (<span class="string">"franklin"</span>, <span class="string">"prof"</span>)), (<span class="number">2</span>L, (<span class="string">"istoica"</span>, <span class="string">"prof"</span>))))</span><br><span class="line"><span class="comment">// Create an RDD for edges</span></span><br><span class="line"><span class="keyword">val</span> relationships: <span class="type">RDD</span>[<span class="type">Edge</span>[<span class="type">String</span>]] =</span><br><span class="line">    sc.parallelize( <span class="type">Array</span>( <span class="type">Edge</span>(<span class="number">3</span>L, <span class="number">7</span>L, <span class="string">"collab"</span>), <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">3</span>L, <span class="string">"advisor"</span>),<span class="type">Edge</span>(<span class="number">2</span>L, <span class="number">5</span>L, <span class="string">"colleague"</span>),  <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">7</span>L, <span class="string">"pi"</span>)))</span><br><span class="line"><span class="comment">// Define a default user in case there are relationship with missing user</span></span><br><span class="line"><span class="keyword">val</span> defaultUser = (<span class="string">"John Doe"</span>, <span class="string">"Missing"</span>)</span><br><span class="line"><span class="comment">// Build the initial Graph</span></span><br><span class="line"><span class="keyword">val</span> graph =  <span class="type">Graph</span>(users, relationships, defaultUser)</span><br></pre></td></tr></table></figure><p>在上面的例子中，我们利用了Edge的case类。Edge具有srcId和dstId，它们分别对应于源和目的地顶点的标识符。此外，Edge 类具有 attr属性，并存储的边的特性。</p><p>我们可以通过 graph.vertices 和 graph.edges属性，得到图到各自的顶点和边的视图。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[(<span class="type">String</span>, <span class="type">String</span>), <span class="type">String</span>]  <span class="comment">// Constructed from above</span></span><br><span class="line"><span class="comment">// Count all users which are postdocs</span></span><br><span class="line">graph.vertices.filter &#123;  <span class="keyword">case</span> (id, (name, pos))  =&gt; pos == <span class="string">"postdoc"</span> &#125;.count</span><br><span class="line"><span class="comment">// Count all the edges where src &gt; dst</span></span><br><span class="line">graph.edges.filter(e  =&gt; e.srcId &gt; e.dstId).count</span><br></pre></td></tr></table></figure><p>需要注意的是graph.vertices返回VertexRDD[(String,String)]延伸RDD[(VertexID，(String，String))]，所以我们使用Scala的case表达来解构元组。在另一方面，graph.edges返回EdgeRDD包含Edge[String]对象。我们可以也使用的如下的类型的构造器：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.edges.filter &#123;  <span class="keyword">case</span>  <span class="type">Edge</span>(src, dst, prop)  =&gt; src &gt; dst &#125;.count</span><br></pre></td></tr></table></figure><p>除了 图的顶点和边的意见，GraphX 也提供了三重视图。三重视图逻辑连接点和边的属性产生的 RDD[EdgeTriplet [VD，ED]包含的实例 EdgeTriplet类。此 连接 可以表示如下的SQL表达式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> src.id, dst.id, src.attr, e.attr, dst.attr</span><br><span class="line"><span class="keyword">FROM</span> edges  <span class="keyword">AS</span> e  <span class="keyword">LEFT</span>  <span class="keyword">JOIN</span> vertices  <span class="keyword">AS</span> src, vertices  <span class="keyword">AS</span> dst</span><br><span class="line"><span class="keyword">ON</span> e.srcId = src.Id  <span class="keyword">AND</span> e.dstId = dst.Id</span><br></pre></td></tr></table></figure><p>或图形方式：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cctj00g11j4e1ghaq5v1dvapea2a.png" alt></p><p>该 EdgeTriplet类继承了 Edge并加入了类属性:srcAttr和dstAttr,用于包含了源和目标属性。我们可以用一个图的三元组视图渲染描述用户之间的关系字符串的集合。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[(<span class="type">String</span>, <span class="type">String</span>), <span class="type">String</span>]  <span class="comment">// Constructed from above</span></span><br><span class="line"><span class="comment">// Use the triplets view to create an RDD of facts.</span></span><br><span class="line"><span class="keyword">val</span> facts: <span class="type">RDD</span>[<span class="type">String</span>] =</span><br><span class="line">    graph.triplets.map(triplet  =&gt;</span><br><span class="line">        triplet.srcAttr._1 + <span class="string">" is the "</span> + triplet.attr + <span class="string">" of "</span> + triplet.dstAttr._1)</span><br><span class="line">facts.collect.foreach(println(_ _))</span><br></pre></td></tr></table></figure><h4 id="Graph-操作"><a href="#Graph-操作" class="headerlink" title="Graph 操作"></a><strong>Graph 操作</strong></h4><p>正如RDDs有这样基本的操作mpa，filter，和reduceByKey，属性图也有一系列基本的运算,采用用户定义的函数，并产生新的图形与变换的性质和结构。定义核心运算已优化的实现方式中定义的Graph，并且被表示为核心操作的组合定义在GraphOps。然而，由于Scala的implicits特性,GraphOps中的操作会自动作为Graph的成员。例如，我们可以计算各顶点的入度（定义在的 GraphOps）：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[(<span class="type">String</span>, <span class="type">String</span>), <span class="type">String</span>]</span><br><span class="line"><span class="comment">// Use the implicit GraphOps.inDegrees operator</span></span><br><span class="line"><span class="keyword">val</span> inDegrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>] = graph.inDegrees</span><br></pre></td></tr></table></figure><p>将核心图操作和 GraphOps区分开来的原因是为了将来能够支持不同的图表示。每个图的表示必须实现核心操作并且复用 GraphOps中很多有用的操作。</p><h4 id="运算列表总结"><a href="#运算列表总结" class="headerlink" title="运算列表总结"></a><strong>运算列表总结</strong></h4><p>以下列出了Graph图 和 GraphOps中同时定义的操作.为了简单起见,我们都定义为Graph的成员函数。请注意，某些函数签名已被简化（例如，默认参数和类型的限制被删除了）,还有一些更高级的功能已被删除，完整的列表,请参考API文档。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Summary of the functionality in the property graph */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="comment">//  Information  about  the  Graph</span></span><br><span class="line">    <span class="keyword">val</span> numEdges: <span class="type">Long</span></span><br><span class="line">    <span class="keyword">val</span> numVertices: <span class="type">Long</span></span><br><span class="line">    <span class="keyword">val</span> inDegrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>]</span><br><span class="line">    <span class="keyword">val</span> outDegrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>]</span><br><span class="line">    <span class="keyword">val</span> degrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>]</span><br><span class="line">    <span class="comment">//  Views  of  the  graph  as  collections</span></span><br><span class="line">    <span class="keyword">val</span> vertices: <span class="type">VertexRDD</span>[<span class="type">VD</span>]</span><br><span class="line">    <span class="keyword">val</span> edges: <span class="type">EdgeRDD</span>[<span class="type">ED</span>, <span class="type">VD</span>]</span><br><span class="line">    <span class="keyword">val</span> triplets: <span class="type">RDD</span>[<span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]]</span><br><span class="line">    <span class="comment">//  Functions  for  caching  graphs</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">persist</span></span>(newLevel: <span class="type">StorageLevel</span> =  <span class="type">StorageLevel</span>. <span class="type">MEMORY_ONLY</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cache</span></span>(): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unpersistVertices</span></span>(blocking: <span class="type">Boolean</span> =  <span class="literal">true</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="comment">//  Change  the  partitioning  heuristic</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">partitionBy</span></span>(partitionStrategy: <span class="type">PartitionStrategy</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="comment">//  Transform  vertex  and  edge  attributes</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapVertices</span></span>[<span class="type">VD2</span>](map: (<span class="type">VertexID</span>, <span class="type">VD</span>)  =&gt;  <span class="type">VD2</span>): <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapEdges</span></span>[<span class="type">ED2</span>](map: <span class="type">Edge</span>[<span class="type">ED</span>]  =&gt;  <span class="type">ED2</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapEdges</span></span>[<span class="type">ED2</span>](map: (<span class="type">PartitionID</span>, <span class="type">Iterator</span>[<span class="type">Edge</span>[<span class="type">ED</span>]])  =&gt;  <span class="type">Iterator</span>[<span class="type">ED2</span>]):<span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapTriplets</span></span>[<span class="type">ED2</span>](map: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">ED2</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapTriplets</span></span>[<span class="type">ED2</span>](map: (<span class="type">PartitionID</span>, <span class="type">Iterator</span>[<span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]])  =&gt;</span><br><span class="line">    <span class="type">Iterator</span>[<span class="type">ED2</span>]): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">    <span class="comment">//  Modify  the  graph  structure</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span></span>: <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subgraph</span></span>(</span><br><span class="line">            epred: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>,<span class="type">ED</span>]  =&gt;  <span class="type">Boolean</span> = (x  =&gt;  <span class="literal">true</span>),</span><br><span class="line">            vpred: (<span class="type">VertexID</span>, <span class="type">VD</span>)  =&gt;  <span class="type">Boolean</span> = ((v, d)  =&gt;  <span class="literal">true</span>)</span><br><span class="line">        ): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mask</span></span>[<span class="type">VD2</span>, <span class="type">ED2</span>](other: <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED2</span>]): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">groupEdges</span></span>(merge: (<span class="type">ED</span>, <span class="type">ED</span>)  =&gt;  <span class="type">ED</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="comment">//  Join  RDDs  with  the  graph</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">joinVertices</span></span>[<span class="type">U</span>](table: <span class="type">RDD</span>[(<span class="type">VertexID</span>, <span class="type">U</span>)])(mapFunc: (<span class="type">VertexID</span>, <span class="type">VD</span>, <span class="type">U</span>)</span><br><span class="line">    =&gt;  <span class="type">VD</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">outerJoinVertices</span></span>[<span class="type">U</span>, <span class="type">VD2</span>](other: <span class="type">RDD</span>[(<span class="type">VertexID</span>, <span class="type">U</span>)])</span><br><span class="line">    (mapFunc: (<span class="type">VertexID</span>, <span class="type">VD</span>,  <span class="type">Option</span>[<span class="type">U</span>])  =&gt;  <span class="type">VD2</span>)</span><br><span class="line">    : <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="comment">//  Aggregate  information  about  adjacent  triplets</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">collectNeighborIds</span></span>(edgeDirection:  <span class="type">EdgeDirection</span>): <span class="type">VertexRDD</span>[<span class="type">Array</span>[<span class="type">VertexID</span>]]</span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">collectNeighbors</span></span>(edgeDirection:  <span class="type">EdgeDirection</span>):<span class="type">VertexRDD</span>[<span class="type">Array</span>[(<span class="type">VertexID</span>, <span class="type">VD</span>)]]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapReduceTriplets</span></span>[<span class="type">A</span>: <span class="type">ClassTag</span>](</span><br><span class="line">            mapFunc: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">Iterator</span>[(<span class="type">VertexID</span>, <span class="type">A</span>)],</span><br><span class="line">            reduceFunc: (<span class="type">A</span>, <span class="type">A</span>)  =&gt; <span class="type">A</span>,</span><br><span class="line">            activeSetOpt: <span class="type">Option</span>[(<span class="type">VertexRDD</span>[_ _], <span class="type">EdgeDirection</span>)] =  <span class="type">None</span></span><br><span class="line">        ): <span class="type">VertexRDD</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="comment">//  Iterative  graph-parallel  computation</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pregel</span></span>[<span class="type">A</span>](initialMsg: <span class="type">A</span>, maxIterations: <span class="type">Int</span>, activeDirection:  <span class="type">EdgeDirection</span>)(</span><br><span class="line">            vprog: (<span class="type">VertexID</span>, <span class="type">VD</span>, <span class="type">A</span>)  =&gt;  <span class="type">VD</span>,</span><br><span class="line">            sendMsg: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">Iterator</span>[(<span class="type">VertexID</span>,<span class="type">A</span>)],</span><br><span class="line">            mergeMsg: (<span class="type">A</span>, <span class="type">A</span>)  =&gt; <span class="type">A</span></span><br><span class="line">        ): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="comment">//  Basic  graph  algorithms</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pageRank</span></span>(tol: <span class="type">Double</span>, resetProb: <span class="type">Double</span> = <span class="number">0.15</span>): <span class="type">Graph</span>[<span class="type">Double</span>, <span class="type">Double</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connectedComponents</span></span>(): <span class="type">Graph</span>[<span class="type">VertexID</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">triangleCount</span></span>(): <span class="type">Graph</span>[<span class="type">Int</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stronglyConnectedComponents</span></span>(numIter: <span class="type">Int</span>): <span class="type">Graph</span>[<span class="type">VertexID</span>, <span class="type">ED</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a><strong>属性操作</strong></h3><p>和RDD的 map操作类似，属性图包含以下内容：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapVertices</span></span>[<span class="type">VD2</span>](map: (<span class="type">VertexId</span>, <span class="type">VD</span>)  =&gt;  <span class="type">VD2</span>): <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapEdges</span></span>[<span class="type">ED2</span>](map: <span class="type">Edge</span>[<span class="type">ED</span>]  =&gt;  <span class="type">ED2</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapTriplets</span></span>[<span class="type">ED2</span>](map: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">ED2</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED2</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每个运算产生一个新的图,这个图的顶点和边属性通过 map方法修改。</p><p>请注意，在所有情况下的图的机构不受影响。这是这些运算符的关键所在，它允许新得到图可以复用初始图的结构索引。下面的代码段在逻辑上是等效的，但第一个不保留结构索引，所以不会从 GraphX 系统优化中受益：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newVertices = graph.vertices.map &#123;  <span class="keyword">case</span> (id, attr)  =&gt; (id, mapUdf(id,</span><br><span class="line">attr)) &#125;</span><br><span class="line"><span class="keyword">val</span> newGraph =  <span class="type">Graph</span>(newVertices, graph.edges)</span><br></pre></td></tr></table></figure><p>相反，使用 mapVertices保存索引：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> newGraph = graph.mapVertices((id, attr)  =&gt; mapUdf(id, attr))</span><br></pre></td></tr></table></figure><p>这些操作经常被用来初始化图的特定计算或者去除不必要的属性。例如，给定一个将出度作为顶点的属性图（我们之后将介绍如何构建这样的图），我们初始化它作为 PageRank：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Given a graph where the vertex property is the out-degree</span></span><br><span class="line"><span class="keyword">val</span> inputGraph: <span class="type">Graph</span>[<span class="type">Int</span>, <span class="type">String</span>] =</span><br><span class="line">    graph.outerJoinVertices(graph.outDegrees)((vid,  _ _,  degOpt)  =&gt; degOpt.getOrElse(<span class="number">0</span>))</span><br><span class="line"><span class="comment">// Construct a graph where each edge contains the weight</span></span><br><span class="line"><span class="comment">// and each vertex is the initial PageRank</span></span><br><span class="line"><span class="keyword">val</span> outputGraph: <span class="type">Graph</span>[<span class="type">Double</span>, <span class="type">Double</span>] =</span><br><span class="line">    inputGraph.mapTriplets(triplet  =&gt; <span class="number">1.0</span> / triplet.srcAttr).mapVertices((id, _ _) =&gt; <span class="number">1.0</span>)</span><br></pre></td></tr></table></figure><h4 id="结构操作"><a href="#结构操作" class="headerlink" title="结构操作"></a><strong>结构操作</strong></h4><p>当前 GraphX 只支持一组简单的常用结构化操作，我们希望将来增加更多的操作。以下是基本的结构运算符的列表。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span></span>: <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subgraph</span></span>(epred: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>,<span class="type">ED</span>]  =&gt;  <span class="type">Boolean</span>, vpred: (<span class="type">VertexId</span>, <span class="type">VD</span>)  =&gt;  <span class="type">Boolean</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mask</span></span>[<span class="type">VD2</span>, <span class="type">ED2</span>](other: <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED2</span>]): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">groupEdges</span></span>(merge: (<span class="type">ED</span>, <span class="type">ED</span>)  =&gt;  <span class="type">ED</span>): <span class="type">Graph</span>[<span class="type">VD</span>,<span class="type">ED</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该reverse操作符返回一个新图,新图的边的方向都反转了。这是非常实用的，例如，试图计算逆向PageRank。因为反向操作不修改顶点或边属性或改变的边的数目，它的实现不需要数据移动或复制。</p><p>该子图subgraph将顶点和边的预测作为参数，并返回一个图，它只包含满足了顶点条件的顶点图（值为true），以及满足边条件 并连接顶点的边。subgraph子运算符可应用于很多场景，以限制图表的顶点和边是我们感兴趣的，或消除断开的链接。例如，在下面的代码中，我们删除已损坏的链接：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an RDD for the vertices</span></span><br><span class="line"><span class="keyword">val</span> users: <span class="type">RDD</span>[(<span class="type">VertexId</span>, (<span class="type">String</span>, <span class="type">String</span>))] =</span><br><span class="line">        sc.parallelize( <span class="type">Array</span>((<span class="number">3</span>L, (<span class="string">"rxin"</span>, <span class="string">"student"</span>)), (<span class="number">7</span>L, (<span class="string">"jgonzal"</span>,<span class="string">"postdoc"</span>)),(<span class="number">5</span>L, (<span class="string">"franklin"</span>, <span class="string">"prof"</span>)), (<span class="number">2</span>L, (<span class="string">"istoica"</span>, <span class="string">"prof"</span>)),(<span class="number">4</span>L, (<span class="string">"peter"</span>, <span class="string">"student"</span>))))</span><br><span class="line"><span class="comment">// Create an RDD for edges</span></span><br><span class="line"><span class="keyword">val</span> relationships: <span class="type">RDD</span>[<span class="type">Edge</span>[<span class="type">String</span>]] =</span><br><span class="line">        sc.parallelize( <span class="type">Array</span>( <span class="type">Edge</span>(<span class="number">3</span>L, <span class="number">7</span>L, <span class="string">"collab"</span>), <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">3</span>L, <span class="string">"advisor"</span>),<span class="type">Edge</span>(<span class="number">2</span>L, <span class="number">5</span>L, <span class="string">"colleague"</span>),  <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">7</span>L, <span class="string">"pi"</span>),<span class="type">Edge</span>(<span class="number">4</span>L, <span class="number">0</span>L, <span class="string">"student"</span>), <span class="type">Edge</span>(<span class="number">5</span>L, <span class="number">0</span>L, <span class="string">"colleague"</span>)))</span><br><span class="line"><span class="comment">// Define a default user in case there are relationship with missing user</span></span><br><span class="line"><span class="keyword">val</span> defaultUser = (<span class="string">"John Doe"</span>, <span class="string">"Missing"</span>)</span><br><span class="line"><span class="comment">// Build the initial Graph</span></span><br><span class="line"><span class="keyword">val</span> graph =  <span class="type">Graph</span>(users, relationships, defaultUser)</span><br><span class="line"><span class="comment">// Notice that there is a user 0 (for which we have no information) connected to users</span></span><br><span class="line"><span class="comment">// 4 (peter) and 5 (franklin).</span></span><br><span class="line">graph.triplets.map(</span><br><span class="line">    triplet  =&gt; triplet.srcAttr._1 + <span class="string">" is the "</span> + triplet.attr + <span class="string">" of "</span> + triplet.dstAttr._1</span><br><span class="line">).collect.foreach(println(_ _))</span><br><span class="line"><span class="comment">// Remove missing vertices as well as the edges to connected to them</span></span><br><span class="line"><span class="keyword">val</span> validGraph = graph.subgraph(vpred = (id, attr)  =&gt; attr._2 != <span class="string">"Missing"</span>)</span><br><span class="line"><span class="comment">// The valid subgraph will disconnect users 4 and 5 by removing user 0</span></span><br><span class="line">validGraph.vertices.collect.foreach(println(_ _))</span><br><span class="line">validGraph.triplets.map(</span><br><span class="line">    triplet  =&gt; triplet.srcAttr._1 + <span class="string">" is the "</span> + triplet.attr + <span class="string">" of "</span> + triplet.dstAttr._1</span><br><span class="line">).collect.foreach(println(_ _))</span><br></pre></td></tr></table></figure><p>注意，在上面的例子中，仅提供了顶点条件。如果不提供顶点或边的条件，在subgraph 操作中默认为 真 。</p><p>mask操作返回一个包含输入图中所有的顶点和边的图。这可以用来和subgraph一起使用，以限制基于属性的另一个相关图。例如，我们用去掉顶点的图来运行联通分量，并且限制输出为合法的子图。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run Connected Components</span></span><br><span class="line"><span class="keyword">val</span> ccGraph = graph.connectedComponents()  <span class="comment">// No longer contains missing field</span></span><br><span class="line"><span class="comment">// Remove missing vertices as well as the edges to connected to them</span></span><br><span class="line"><span class="keyword">val</span> validGraph = graph.subgraph(vpred = (id, attr)  =&gt; attr._2 != <span class="string">"Missing"</span>)</span><br><span class="line"><span class="comment">// Restrict the answer to the valid subgraph</span></span><br><span class="line"><span class="keyword">val</span> validCCGraph = ccGraph.mask(validGraph)</span><br></pre></td></tr></table></figure><p>该 groupEdges操作合并在多重图中的平行边（即重复顶点对之间的边）。在许多数值计算的应用中，平行的边缘可以加入 （他们的权重的会被汇总）为单条边从而降低了图形的大小。</p><h4 id="Join-操作"><a href="#Join-操作" class="headerlink" title="Join 操作"></a><strong>Join 操作</strong></h4><p>在许多情况下，有必要从外部集合（RDDS）中加入图形数据。例如，我们可能有额外的用户属性，想要与现有的图形合并，或者我们可能需要从一个图选取一些顶点属性到另一个图。这些任务都可以使用来 join 经操作完成。下面我们列出的关键联接运算符：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">joinVertices</span></span>[<span class="type">U</span>](table: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">U</span>)])(map: (<span class="type">VertexId</span>, <span class="type">VD</span>, <span class="type">U</span>)  =&gt; <span class="type">VD</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">outerJoinVertices</span></span>[<span class="type">U</span>, <span class="type">VD2</span>](table: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">U</span>)])(map: (<span class="type">VertexId</span>, <span class="type">VD</span>,  <span class="type">Option</span>[<span class="type">U</span>])  =&gt;  <span class="type">VD2</span>): <span class="type">Graph</span>[<span class="type">VD2</span>, <span class="type">ED</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该 joinVertices运算符连接与输入RDD的顶点，并返回一个新的图，新图的顶点属性是通过用户自定义的 map功能作用在被连接的顶点上。没有匹配的RDD保留其原始值。</p><p>需要注意的是，如果RDD顶点包含多于一个的值，其中只有一个将会被使用。因此，建议在输入的RDD在初始为唯一的时候，使用下面的 pre-index 所得到的值以加快后续join。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> nonUniqueCosts: <span class="type">RDD</span>[(<span class="type">VertexID</span>, <span class="type">Double</span>)]</span><br><span class="line"><span class="keyword">val</span> uniqueCosts: <span class="type">VertexRDD</span>[<span class="type">Double</span>] = </span><br><span class="line">        graph.vertices.aggregateUsingIndex(nonUnique, (a,b) =&gt; a + b)</span><br><span class="line"><span class="keyword">val</span> joinedGraph = graph.joinVertices(uniqueCosts)(</span><br><span class="line">        (id, oldCost, extraCost)  =&gt; oldCost + extraCost)</span><br></pre></td></tr></table></figure><p>更一般 outerJoinVertices操作类似于joinVertices，除了将用户定义的map函数应用到所有的顶点，并且可以改变顶点的属性类型。因为不是所有的顶点可能会在输入匹配值RDD的mpa函数接受一个Optin类型。例如，我们可以通过</p><p>用 outDegree 初始化顶点属性来设置一个图的 PageRank。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> outDegrees: <span class="type">VertexRDD</span>[<span class="type">Int</span>] = graph.outDegrees</span><br><span class="line"><span class="keyword">val</span> degreeGraph = graph.outerJoinVertices(outDegrees) &#123; </span><br><span class="line">    (id, oldAttr, outDegOpt)  =&gt;</span><br><span class="line">        outDegOpt  <span class="keyword">match</span> &#123;</span><br><span class="line">            <span class="keyword">case</span>  <span class="type">Some</span>(outDeg)  =&gt; outDeg</span><br><span class="line">            <span class="keyword">case</span>  <span class="type">None</span>  =&gt; <span class="number">0</span>  <span class="comment">// No outDegree means zero outDegree</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>您可能已经注意到，在上面的例子中采用了多个参数列表的curried函数模式（例如，f(a)(b)）。虽然我们可以有同样写f(a)(b)为f(a,b)，这将意味着该类型推断b不依赖于a。其结果是，用户将需要提供类型标注给用户自定义的函数：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> joinedGraph = graph.joinVertices(uniqueCosts,</span><br><span class="line">    (id: <span class="type">VertexID</span>, oldCost: <span class="type">Double</span>, extraCost: <span class="type">Double</span>)  =&gt; oldCost + extraCost)</span><br></pre></td></tr></table></figure><h4 id="邻居聚集"><a href="#邻居聚集" class="headerlink" title="邻居聚集"></a><strong>邻居聚集</strong></h4><p>图形计算的一个关键部分是聚集每个顶点的邻域信息。例如，我们可能想要知道每个用户追随者的数量或每个用户的追随者的平均年龄。许多图迭代算法（如PageRank，最短路径，连通分量等）反复聚集邻居节点的属性， （例如，当前的 PageRank 值，到源节点的最短路径，最小可达顶点 ID）。</p><h4 id="mapReduceTriplets"><a href="#mapReduceTriplets" class="headerlink" title="mapReduceTriplets"></a><strong>mapReduceTriplets</strong></h4><p>GraphX中核心（大量优化）聚集操作是 mapReduceTriplets操作：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapReduceTriplets</span></span>[<span class="type">A</span>](</span><br><span class="line">        map: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">Iterator</span>[(<span class="type">VertexId</span>, <span class="type">A</span>)],</span><br><span class="line">        reduce: (<span class="type">A</span>, <span class="type">A</span>)  =&gt; <span class="type">A</span> </span><br><span class="line">    ): <span class="type">VertexRDD</span>[<span class="type">A</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该 mapReduceTriplets运算符将用户定义的map函数作为输入，并且将map作用到每个triplet，并可以得到triplet上所有的顶点（或者两个，或者空）的信息。为了便于优化预聚合，我们目前仅支持发往triplet的源或目的地的顶点信息。用户定义的reduce功能将合并所有目标顶点相同的信息。该mapReduceTriplets操作返回 VertexRDD [A] ，包含所有以每个顶点作为目标节点集合消息（类型 A）。没有收到消息的顶点不包含在返回 VertexRDD。</p><p>需要注意的是 mapReduceTriplets需要一个附加的可选activeSet（上面没有显示,请参见API文档的详细信息），这限制了 VertexRDD地图提供的邻接边的map阶段：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">activeSetOpt: <span class="type">Option</span>[(<span class="type">VertexRDD</span>[_], <span class="type">EdgeDirection</span>)] = <span class="type">None</span></span><br></pre></td></tr></table></figure><p>该EdgeDirection指定了哪些和顶点相邻的边包含在map阶段。如果该方向是in，则用户定义的 mpa函数 将仅仅作用目标顶点在与活跃集中。如果方向是out，则该map函数将仅仅作用在那些源顶点在活跃集中的边。如果方向是 either，则map函数将仅在任一顶点在活动集中的边。如果方向是both，则map函数将仅作用在两个顶点都在活跃集中。活跃集合必须来自图的顶点中。限制计算到相邻顶点的一个子集三胞胎是增量迭代计算中非常必要，而且是GraphX 实现Pregel中的关键。</p><p>在下面的例子中我们使用 mapReduceTriplets算子来计算高级用户追随者的平均年龄。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Import random graph generation library</span></span><br><span class="line"><span class="keyword">import</span>  org.apache.spark.graphx.util.<span class="type">GraphGenerators</span></span><br><span class="line"><span class="comment">// Create a graph with "age" as the vertex property. Here we use a random graph for simplicity.</span></span><br><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[<span class="type">Double</span>, <span class="type">Int</span>] =</span><br><span class="line">        <span class="type">GraphGenerators</span>.logNormalGraph(sc, numVertices = <span class="number">100</span>).mapVertices( </span><br><span class="line">            (id, _ _) =&gt; id.toDouble )</span><br><span class="line"><span class="comment">// Compute the number of older followers and their total age</span></span><br><span class="line"><span class="keyword">val</span> olderFollowers: <span class="type">VertexRDD</span>[(<span class="type">Int</span>, <span class="type">Double</span>)] = graph.mapReduceTriplets[(<span class="type">Int</span>,<span class="type">Double</span>)](</span><br><span class="line">    triplet  =&gt; &#123;  <span class="comment">// Map Function</span></span><br><span class="line">        <span class="keyword">if</span> (triplet.srcAttr &gt; triplet.dstAttr) &#123;</span><br><span class="line">            <span class="comment">// Send message to destination vertex containing counter and age</span></span><br><span class="line">            <span class="type">Iterator</span>((triplet.dstId, (<span class="number">1</span>, triplet.srcAttr)))</span><br><span class="line">        &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Don't send a message for this triplet</span></span><br><span class="line">            <span class="type">Iterator</span>.empty</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Add counter and age</span></span><br><span class="line">    (a, b)  =&gt; (a._1 + b._1, a._2 + b._2)  <span class="comment">// Reduce Function</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// Divide total age by number of older followers to get average age of older followers</span></span><br><span class="line"><span class="keyword">val</span> avgAgeOfOlderFollowers: <span class="type">VertexRDD</span>[<span class="type">Double</span>] =</span><br><span class="line">    olderFollowers.mapValues( (id, value)  =&gt; value  </span><br><span class="line">        <span class="keyword">match</span> &#123;  <span class="keyword">case</span> (count, totalAge) =&gt; totalAge / count &#125; )</span><br><span class="line"><span class="comment">// Display the results</span></span><br><span class="line">avgAgeOfOlderFollowers.collect.foreach(println(_ _))</span><br></pre></td></tr></table></figure><p>注意，当消息（和消息的总和）是固定尺寸的时候（例如，浮点运算和加法而不是列表和连接）时，mapReduceTriplets 操作执行。更精确地说，结果 mapReduceTriplets 最好是每个顶点度的次线性函数。</p><h4 id="计算度信息"><a href="#计算度信息" class="headerlink" title="计算度信息"></a><strong>计算度信息</strong></h4><p>一个常见的聚合任务是计算每个顶点的度：每个顶点相邻边的数目。在有向图的情况下，往往需要知道入度，出度，以及总度。该GraphOps类包含一系列的运算来计算每个顶点的度的集合。例如，在下面我们计算最大的入度，出度，总度：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define a reduce operation to compute the highest degree vertex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max</span></span>(a: (<span class="type">VertexId</span>, <span class="type">Int</span>), b: (<span class="type">VertexId</span>, <span class="type">Int</span>)): (<span class="type">VertexId</span>, <span class="type">Int</span>) = &#123;</span><br><span class="line">    <span class="keyword">if</span> (a._2 &gt; b._2) a  <span class="keyword">else</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Compute the max degrees</span></span><br><span class="line"><span class="keyword">val</span> maxInDegree: (<span class="type">VertexId</span>, <span class="type">Int</span>) = graph.inDegrees.reduce(max)</span><br><span class="line"><span class="keyword">val</span> maxOutDegree: (<span class="type">VertexId</span>, <span class="type">Int</span>) = graph.outDegrees.reduce(max)</span><br><span class="line"><span class="keyword">val</span> maxDegrees: (<span class="type">VertexId</span>, <span class="type">Int</span>) = graph.degrees.reduce(max)</span><br></pre></td></tr></table></figure><h4 id="收集邻居"><a href="#收集邻居" class="headerlink" title="收集邻居"></a><strong>收集邻居</strong></h4><p>在某些情况下可能更容易通过收集相邻顶点和它们的属性来表达在每个顶点表示的计算。这可以通过使用容易地实现 collectNeighborIds和 collectNeighbors运算。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GraphOps</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">collectNeighborIds</span></span>(edgeDirection:  <span class="type">EdgeDirection</span>): <span class="type">VertexRDD</span>[<span class="type">Array</span>[<span class="type">VertexId</span>]]</span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">collectNeighbors</span></span>(edgeDirection:  <span class="type">EdgeDirection</span>): <span class="type">VertexRDD</span>[ <span class="type">Array</span>[(<span class="type">VertexId</span>, <span class="type">VD</span>)] ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是，这些运算计算代价非常高，因为他们包含重复信息，并且需要大量的通信。如果可能的话尽量直接使用 mapReduceTriplets。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="缓存和清空缓存"><a href="#缓存和清空缓存" class="headerlink" title="缓存和清空缓存"></a><strong>缓存和清空缓存</strong></h4><p>在Spark中，RDDS默认并不保存在内存中。为了避免重复计算，当他们需要多次使用时，必须明确地使用缓存（见 Spark编程指南）。在GraphX中Graphs行为方式相同。当需要多次使用图形时，一定要首先调用Graph.cache。</p><p>在迭代计算，为了最佳性能，也可能需要清空缓存。默认情况下，缓存的RDDS和图表将保留在内存中，直到内存压力迫使他们按照LRU顺序被删除。对于迭代计算，之前的迭代的中间结果将填补缓存。虽然他们最终将被删除，内存中的不必要的数据会使垃圾收集机制变慢。一旦它们不再需要缓存，就立即清空中间结果的缓存，这将会更加有效。这涉及物化（缓存和强迫）图形或RDD每次迭代，清空所有其他数据集，并且只使用物化数据集在未来的迭代中。然而，由于图形是由多个RDDS的组成的，正确地持续化他们将非常困难。对于迭代计算，我们推荐使用 Pregel API，它正确地 unpersists 中间结果。</p><h3 id="Pregel-的-API"><a href="#Pregel-的-API" class="headerlink" title="Pregel 的 API"></a><strong>Pregel 的 API</strong></h3><p>图本质上是递归的数据结构，因为顶点的性质取决于它们的邻居，这反过来又依赖于邻居的属性。其结果是许多重要的图形算法迭代重新计算每个顶点的属性，直到定点条件满足为止。一系列图像并行方法已经被提出来表达这些迭代算法。GraphX 提供了类似与Pregel 的操作，这是 Pregel 和 GraphLab 方法的融合。</p><p>从总体来看，Graphx 中的 Pregel 是一个批量同步并行消息传递抽象  约束到该图的拓扑结构。Pregel 运算符在一系列超步骤中，其中顶点收到从之前的步骤中流入消息的总和，计算出顶点属性的新值，然后在下一步中将消息发送到相邻的顶点。不同于Pregel，而是更像GraphLab消息被并行计算，并且作为edge-triplet，该消息的计算可以访问的源和目的地的顶点属性。没有收到消息的顶点在一个超级步跳过。当没有消息是，Pregel 停止迭代，并返回最终图形。</p><p>请注意，不像更标准的 Pregel的实现，在GraphX中顶点只能将消息发送到邻近的顶点，并且信息构建是通过使用用户定义的消息函数并行执行。这些限制使得在 GraphX 有额外的优化。</p><p>以下是类型签名 Pregel，以及一个 初始的实现 （注调用graph.cache已被删除）中：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">GraphOps</span>[<span class="type">VD</span>, <span class="type">ED</span>] </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pregel</span></span>[<span class="type">A</span>](</span><br><span class="line">    initialMsg: <span class="type">A</span>,</span><br><span class="line">    maxIter: <span class="type">Int</span> =  <span class="type">Int</span>. <span class="type">MaxValue</span>,</span><br><span class="line">    activeDir: <span class="type">EdgeDirection</span> =  <span class="type">EdgeDirection</span>. <span class="type">Out</span>)(</span><br><span class="line">        vprog: (<span class="type">VertexId</span>, <span class="type">VD</span>, <span class="type">A</span>)  =&gt;  <span class="type">VD</span>,</span><br><span class="line">        sendMsg: <span class="type">EdgeTriplet</span>[<span class="type">VD</span>, <span class="type">ED</span>]  =&gt;  <span class="type">Iterator</span>[(<span class="type">VertexId</span>, <span class="type">A</span>)],</span><br><span class="line">        mergeMsg: (<span class="type">A</span>, <span class="type">A</span>)  =&gt; <span class="type">A</span></span><br><span class="line">    ): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>] = &#123;</span><br><span class="line">        <span class="comment">// Receive the initial message at each vertex</span></span><br><span class="line">        <span class="keyword">var</span>  g  =  mapVertices(  (vid,  vdata)  =&gt;  vprog(vid,  vdata, initialMsg) ).cache()</span><br><span class="line">        <span class="comment">// compute the messages</span></span><br><span class="line">        <span class="keyword">var</span> messages = g.mapReduceTriplets(sendMsg, mergeMsg)</span><br><span class="line">        <span class="keyword">var</span> activeMessages = messages.count()</span><br><span class="line">        <span class="comment">// Loop until no messages remain or maxIterations is achieved</span></span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (activeMessages &gt; <span class="number">0</span> &amp;&amp; i &lt; maxIterations) &#123;</span><br><span class="line">            <span class="comment">//  Receive  the  messages:------</span></span><br><span class="line">            <span class="comment">// Run the vertex program on all vertices that receive messages</span></span><br><span class="line">            <span class="keyword">val</span> newVerts = g.vertices.innerJoin(messages)(vprog).cache()</span><br><span class="line">            <span class="comment">// Merge the new vertex values back into the graph</span></span><br><span class="line">            g  =  g.outerJoinVertices(newVerts)  &#123;  (vid,  old,  newOpt)  =&gt;  newOpt.getOrElse(old) &#125;.cache()</span><br><span class="line">            <span class="comment">//  Send  Messages:-----</span></span><br><span class="line">            --</span><br><span class="line">            <span class="comment">// Vertices that didn't receive a message above don't appear in newVerts and therefore don't</span></span><br><span class="line">            <span class="comment">// get to send messages. More precisely the map phase of mapReduceTriplets is only invoked</span></span><br><span class="line">            <span class="comment">// on edges in the activeDir of vertices in newVerts</span></span><br><span class="line">            messages = g.mapReduceTriplets(sendMsg, mergeMsg,  <span class="type">Some</span>((newVerts, activeDir))).cache()</span><br><span class="line">            activeMessages = messages.count()</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        g</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请注意，Pregel 需要两个参数列表（即graph.pregel(list1)(list2)）。第一个参数列表中包含的配置参数包括初始信息，迭代的最大次数，以及发送消息（默认出边）的方向。第二个参数列表包含用于用户定义的接收消息（顶点程序 vprog），计算消息（sendMsg），并结合信息 mergeMsg。</p><p>我们可以使用 Pregel 运算符来表达计算，如在下面的例子中的单源最短路径。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  org.apache.spark.graphx._</span><br><span class="line"><span class="comment">// Import random graph generation library</span></span><br><span class="line"><span class="keyword">import</span>  org.apache.spark.graphx.util.<span class="type">GraphGenerators</span></span><br><span class="line"><span class="comment">// A graph with edge attributes containing distances</span></span><br><span class="line"><span class="keyword">val</span> graph: <span class="type">Graph</span>[<span class="type">Int</span>, <span class="type">Double</span>] =</span><br><span class="line">        <span class="type">GraphGenerators</span>.logNormalGraph(sc, numVertices = <span class="number">100</span>).mapEdges(e =&gt; e.attr.toDouble)</span><br><span class="line"><span class="keyword">val</span> sourceId: <span class="type">VertexId</span> = <span class="number">42</span>  <span class="comment">// The ultimate source</span></span><br><span class="line"><span class="comment">// Initialize the graph such that all vertices except the root have distance infinity.</span></span><br><span class="line"><span class="keyword">val</span> initialGraph = graph.mapVertices((id, _ _)  =&gt;  <span class="keyword">if</span> (id == sourceId) <span class="number">0.0</span>  <span class="keyword">else</span> <span class="type">Double</span>.<span class="type">PositiveInfinity</span>)</span><br><span class="line"><span class="keyword">val</span> sssp = initialGraph.pregel( <span class="type">Double</span>. <span class="type">PositiveInfinity</span>)(</span><br><span class="line">    (id, dist, newDist)  =&gt; math.min(dist, newDist),  <span class="comment">// Vertex Program</span></span><br><span class="line">    triplet  =&gt; &#123; <span class="comment">// Send Message</span></span><br><span class="line">        <span class="keyword">if</span> (triplet.srcAttr + triplet.attr &lt; triplet.dstAttr) &#123;</span><br><span class="line">            <span class="type">Iterator</span>((triplet.dstId, triplet.srcAttr + triplet.attr))</span><br><span class="line">        &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Iterator</span>.empty</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    (a,b)  =&gt; math.min(a,b)  <span class="comment">// Merge Message</span></span><br><span class="line">)</span><br><span class="line">println(sssp.vertices.collect.mkString(<span class="string">"\n"</span>))</span><br></pre></td></tr></table></figure><h4 id="Graph-Builder"><a href="#Graph-Builder" class="headerlink" title="Graph Builder"></a><strong>Graph Builder</strong></h4><p>GraphX 提供多种从RDD或者硬盘中的节点和边中构建图。默认情况下，没有哪种Graph Builder会重新划分图的边;相反，边会留在它们的默认分区（如原来的HDFS块）。Graph.groupEdges需要的图形进行重新分区，因为它假设相同的边将被放在同一个分区同一位置，所以你必须在调用Graph.partitionBy之前调用groupEdges。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span>  <span class="title">GraphLoader</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">edgeListFile</span></span>(</span><br><span class="line">        sc: <span class="type">SparkContext</span>,</span><br><span class="line">        path: <span class="type">String</span>,</span><br><span class="line">        canonicalOrientation: <span class="type">Boolean</span> =  <span class="literal">false</span>,</span><br><span class="line">        minEdgePartitions: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">    ): <span class="type">Graph</span>[<span class="type">Int</span>, <span class="type">Int</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GraphLoader.edgeListFile提供了一种从磁盘上边的列表载入图的方式。它解析了一个以下形式的邻接列表（源顶点ID，目的地顶点ID）对，忽略以#开头的注释行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># This is a comment</span><br><span class="line">2 1</span><br><span class="line">4 1</span><br><span class="line">1 2</span><br></pre></td></tr></table></figure><p>它从指定的边创建了一个图表，自动边中提到的任何顶点。所有顶点和边的属性默认为1。canonicalOrientation参数允许重新定向边的正方向（srcId &lt; dstId），这是必需的connected-component算法。该minEdgePartitions参数指定边缘分区生成的最小数目;例如，在HDFS文件具有多个块, 那么就有多个边的分割.</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">VD</span>, <span class="type">ED</span>](</span><br><span class="line">            vertices: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">VD</span>)],</span><br><span class="line">            edges: <span class="type">RDD</span>[<span class="type">Edge</span>[<span class="type">ED</span>]],</span><br><span class="line">            defaultVertexAttr: <span class="type">VD</span> =  <span class="literal">null</span></span><br><span class="line">    ): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fromEdges</span></span>[<span class="type">VD</span>, <span class="type">ED</span>](</span><br><span class="line">            edges: <span class="type">RDD</span>[<span class="type">Edge</span>[<span class="type">ED</span>]],</span><br><span class="line">            defaultValue: <span class="type">VD</span>): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">ED</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fromEdgeTuples</span></span>[<span class="type">VD</span>](</span><br><span class="line">            rawEdges: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">VertexId</span>)],</span><br><span class="line">            defaultValue: <span class="type">VD</span>,</span><br><span class="line">            uniqueEdges: <span class="type">Option</span>[<span class="type">PartitionStrategy</span>] =  <span class="type">None</span></span><br><span class="line">    ): <span class="type">Graph</span>[<span class="type">VD</span>, <span class="type">Int</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Graph.apply允许从顶点和边的RDDS中创建的图。重复的顶点会任意选择，并在边RDD中存在的顶点， 但不是顶点RDD会被赋值为默认属性。</p><p>Graph.fromEdges允许从只有边的元组RDD创建的图，自动生成由边中存在的顶点，并且给这些顶点赋值为缺省值。</p><p>Graph.fromEdgeTuples允许从只有边的元组的RDD图中创建图，并将的边的值赋为1，并自动创建边中所存在的顶点，并设置为缺省值。它也支持删除重边; 进行删除重边时，传入 PartitionStrategy的Some 作为uniqueEdges参数（例如，uniqueEdges=Some（PartitionStrategy.RandomVertexCut））。分区策略是必要的，因为定位在同一分区相同的边，才能使他们能够进行重复删除。</p><h3 id="顶点和边-RDDs"><a href="#顶点和边-RDDs" class="headerlink" title="顶点和边 RDDs"></a><strong>顶点和边 RDDs</strong></h3><p>GraphX 公开了图中 RDD 顶点和边的视图。然而，因为GraphX将顶点和边保存在优化的数据结构，并且为这些数据结构提供额外的功能，顶点和边分别作为VertexRDD和EdgeRDD返回。在本节中，我们回顾一些这些类型的其他有用的功能。</p><h4 id="VertexRDDs"><a href="#VertexRDDs" class="headerlink" title="VertexRDDs"></a><strong>VertexRDDs</strong></h4><p>该VertexRDD [A]继承RDD [(VertexID, A)]，并增加了一些额外的限制 ，每个VertexID只出现 一次 。此外，VertexRDD[A]表示一个顶点集合，其中每个顶点与类型的属性为A。在内部，这是通过将顶点属性中存储在一个可重复使用的哈希表。因此，如果两个VertexRDDs继承自相同的基类VertexRDD（例如，通过filter或mapValues ），他们可以参加在常数时间内实现合并，而不需要重新计算hash值。要充分利用这个索引数据结构，VertexRDD提供了以下附加功能：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">VertexRDD</span>[<span class="type">VD</span>]  <span class="keyword">extends</span>  <span class="title">RDD</span>[(<span class="type">VertexID</span>, <span class="type">VD</span>)] </span>&#123;</span><br><span class="line">    <span class="comment">// Filter the vertex set but preserves the internal index</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter</span></span>(pred: <span class="type">Tuple2</span>[<span class="type">VertexId</span>, <span class="type">VD</span>]  =&gt;  <span class="type">Boolean</span>): <span class="type">VertexRDD</span>[<span class="type">VD</span>]</span><br><span class="line">    <span class="comment">// Transform the values without changing the ids (preserves the internal index)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapValues</span></span>[<span class="type">VD2</span>](map: <span class="type">VD</span> =&gt;  <span class="type">VD2</span>): <span class="type">VertexRDD</span>[<span class="type">VD2</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapValues</span></span>[<span class="type">VD2</span>](map: (<span class="type">VertexId</span>, <span class="type">VD</span>)  =&gt;  <span class="type">VD2</span>): <span class="type">VertexRDD</span>[<span class="type">VD2</span>]</span><br><span class="line">    <span class="comment">// Remove vertices from this set that appear in the other set</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">diff</span></span>(other: <span class="type">VertexRDD</span>[<span class="type">VD</span>]): <span class="type">VertexRDD</span>[<span class="type">VD</span>]</span><br><span class="line">    <span class="comment">// Join operators that take advantage of the internal indexing to accelerate joins (substantially)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">leftJoin</span></span>[<span class="type">VD2</span>, <span class="type">VD3</span>](other: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">VD2</span>)])(f: (<span class="type">VertexId</span>, <span class="type">VD</span>, <span class="type">Option</span>[<span class="type">VD2</span>])  =&gt;  <span class="type">VD3</span>): <span class="type">VertexRDD</span>[<span class="type">VD3</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">innerJoin</span></span>[<span class="type">U</span>, <span class="type">VD2</span>](other: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">U</span>)])(f: (<span class="type">VertexId</span>, <span class="type">VD</span>, <span class="type">U</span>)  =&gt; <span class="type">VD2</span>): <span class="type">VertexRDD</span>[<span class="type">VD2</span>]</span><br><span class="line">    <span class="comment">// Use the index on this RDD to accelerate a `reduceByKey` operation on the input RDD.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">aggregateUsingIndex</span></span>[<span class="type">VD2</span>](other: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">VD2</span>)], reduceFunc: (<span class="type">VD2</span>, <span class="type">VD2</span>)  =&gt;  <span class="type">VD2</span>): <span class="type">VertexRDD</span>[<span class="type">VD2</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请注意，例如，如何filter操作符返回一个VertexRDD。过滤器使用的是实际通过BitSet实现的，从而复用索引和保持能快速与其他 VertexRDD 实现连接功能。 类似地，mapValues 操作不允许mapha函数改变 VertexID，从而可以复用统一HashMap中的数据结构。当两个VertexRDD派生自同一HashMap，并且是通过线性少买而非代价昂贵的逐点查询时，无论是 leftJoin 和 innerJoin 连接时能够识别 VertexRDD 。</p><p>该aggregateUsingIndex操作是一种新的有效的从RDD[(VertexID,A)]构建新的VertexRDD的方式。从概念上讲，如果我在一组顶点上构建了一个VertexRDD[B]，这是一个在某些顶点RDD[(VertexID,A)]的超集，然后我可以重用该索引既聚集，随后为RDD[(VertexID, A)]建立索引。例如：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> setA: <span class="type">VertexRDD</span>[<span class="type">Int</span>] =  <span class="type">VertexRDD</span>(sc.parallelize(<span class="number">0</span>L until <span class="number">100</span>L).map(id  =&gt; (id, <span class="number">1</span>)))</span><br><span class="line"><span class="keyword">val</span> rddB: <span class="type">RDD</span>[(<span class="type">VertexId</span>, <span class="type">Double</span>)] = sc.parallelize(<span class="number">0</span>L until <span class="number">100</span>L).flatMap(id =&gt;  <span class="type">List</span>((id, <span class="number">1.0</span>), (id, <span class="number">2.0</span>)))</span><br><span class="line"><span class="comment">// There should be 200 entries in rddB</span></span><br><span class="line">rddB.count</span><br><span class="line"><span class="keyword">val</span> setB: <span class="type">VertexRDD</span>[<span class="type">Double</span>] = setA.aggregateUsingIndex(rddB, _ _ + _ _)</span><br><span class="line"><span class="comment">// There should be 100 entries in setB</span></span><br><span class="line">setB.count</span><br><span class="line"><span class="comment">// Joining A and B should now be fast!</span></span><br><span class="line"><span class="keyword">val</span> setC: <span class="type">VertexRDD</span>[<span class="type">Double</span>] = setA.innerJoin(setB)((id, a, b)  =&gt; a + b)</span><br></pre></td></tr></table></figure><h4 id="EdgeRDDs"><a href="#EdgeRDDs" class="headerlink" title="EdgeRDDs"></a><strong>EdgeRDDs</strong></h4><p>该EdgeRDD [ED，VD] ，它继承RDD[Edge[ED],以各种分区策略PartitionStrategy将边划分成不同的块。在每个分区中，边属性和邻接结构，分别存储，这使得更改属性值时，能够最大限度的复用。</p><p>EdgeRDD 是提供的三个额外的函数：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Transform the edge attributes while preserving the structure</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mapValues</span></span>[<span class="type">ED2</span>](f: <span class="type">Edge</span>[<span class="type">ED</span>]  =&gt;  <span class="type">ED2</span>): <span class="type">EdgeRDD</span>[<span class="type">ED2</span>, <span class="type">VD</span>]</span><br><span class="line"><span class="comment">// Revere the edges reusing both attributes and structure</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span></span>: <span class="type">EdgeRDD</span>[<span class="type">ED</span>, <span class="type">VD</span>]</span><br><span class="line"><span class="comment">// Join two `EdgeRDD`s partitioned using the same partitioning strategy.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">innerJoin</span></span>[<span class="type">ED2</span>, <span class="type">ED3</span>](other: <span class="type">EdgeRDD</span>[<span class="type">ED2</span>, <span class="type">VD</span>])(f: (<span class="type">VertexId</span>, <span class="type">VertexId</span>,  <span class="type">ED</span>, <span class="type">ED2</span>) =&gt; <span class="type">ED3</span>): <span class="type">EdgeRDD</span>[<span class="type">ED3</span>, <span class="type">VD</span>]</span><br></pre></td></tr></table></figure><p>在大多数应用中，我们发现，在 EdgeRDD 中的操作是通过图形运算符来实现，或依靠在基类定义的 RDD 类操作。</p><h3 id="优化图的表示"><a href="#优化图的表示" class="headerlink" title="优化图的表示"></a><strong>优化图的表示</strong></h3><p>关于 GraphX 中如何表示分布式图结构的详细描述，这个话题超出了本指南的范围，一些高层次的理解可能有助于设计可扩展的算法设计以及 API 的最佳利用。GraphX 采用顶点切的方法来分发图划分：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cctlmkuj6441qf71cfv1f2ot9l2n.png" alt></p><p>不通过边划分图，GraphX 沿顶点来划分图，这样可以减少顶点之间的通信和存储开销。逻辑上，这对应于将边分配到不同的机器，并允许顶点跨越多个机器。分配边的确切方法取决于PartitionStrategy并有多个权衡各种试探法。用户可以通过重新分区图与不同的策略之间进行选择Graph.partitionBy操作。默认分区策略是按照图的构造，使用图中初始的边。但是，用户可以方便地切换到二维-分区或GraphX中其他启发式分区方法。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cctlnrcka0r18eo1r251lkp14pc3k.png" alt></p><p>一旦边被划分，并行图计算的关键挑战在于有效的将每个顶点属性和边的属性连接起来。由于在现实世界中，边的数量多于顶点的数量，我们把顶点属性放在边中。因为不是所有的分区将包含所有顶点相邻的边的信息，我们在内部维护一个路由表，这个表确定在哪里广播顶点信息，执行 triplet 和 mapReduceTriplets 的连接操作。</p><h3 id="图算法"><a href="#图算法" class="headerlink" title="图算法"></a><strong>图算法</strong></h3><p>GraphX 包括一组图形算法来简化分析任务。该算法被包含于org.apache.spark.graphx.lib包中，并可直接通过 GraphOps而被Graph中的方法调用。本节介绍这些算法以及如何使用它们。</p><h4 id="PageRank"><a href="#PageRank" class="headerlink" title="PageRank"></a><strong>PageRank</strong></h4><p>PageRank记录了图中每个顶点的重要性，假设一条边从u到v，代表从u传递给v的重要性。例如，如果一个Twitter用户有很多粉丝，用户排名将很高。</p><p>GraphX 自带的PageRank的静态和动态的实现，放在PageRank对象中。静态的PageRank运行的固定数量的迭代，而动态的PageRank运行，直到排名收敛（即当每个迭代和上一迭代的差值，在某个范围之内时停止迭代）。GraphOps允许Graph中的方法直接调用这些算法。</p><p>GraphX 还包括，我们可以将PageRank运行在社交网络数据集中。一组用户给出graphx/data/users.txt，以及一组用户之间的关系，给出了graphx/data/followers.txt。我们可以按照如下方法来计算每个用户的网页级别：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load the edges as a graph</span></span><br><span class="line"><span class="keyword">val</span> graph =  <span class="type">GraphLoader</span>.edgeListFile(sc, <span class="string">"graphx/data/followers.txt"</span>)</span><br><span class="line"><span class="comment">// Run PageRank</span></span><br><span class="line"><span class="keyword">val</span> ranks = graph.pageRank(<span class="number">0.0001</span>).vertices</span><br><span class="line"><span class="comment">// Join the ranks with the usernames</span></span><br><span class="line"><span class="keyword">val</span> users = sc.textFile(<span class="string">"graphx/data/users.txt"</span>).map &#123; line  =&gt;</span><br><span class="line">    <span class="keyword">val</span> fields = line.split(<span class="string">","</span>)(</span><br><span class="line">        fields(<span class="number">0</span>).toLong, fields(<span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> ranksByUsername = users.join(ranks).map &#123;</span><br><span class="line">    <span class="keyword">case</span> (id, (username, rank))  =&gt; (username, rank)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Print the result</span></span><br><span class="line">println(ranksByUsername.collect().mkString(<span class="string">"\n"</span>))</span><br></pre></td></tr></table></figure><h4 id="联通分量"><a href="#联通分量" class="headerlink" title="联通分量"></a><strong>联通分量</strong></h4><p>连接分量算法标出了图中编号最低的顶点所联通的子集。例如，在社交网络中，连接分量类似集群。GraphX 包含在ConnectedComponents对象的算法，并且我们从该社交网络数据集中计算出连接组件的PageRank部分，如下所示：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load the graph as in the PageRank example</span></span><br><span class="line"><span class="keyword">val</span> graph =  <span class="type">GraphLoader</span>.edgeListFile(sc, <span class="string">"graphx/data/followers.txt"</span>)</span><br><span class="line"><span class="comment">// Find the connected components</span></span><br><span class="line"><span class="keyword">val</span> cc = graph.connectedComponents().vertices</span><br><span class="line"><span class="comment">// Join the connected components with the usernames</span></span><br><span class="line"><span class="keyword">val</span> users = sc.textFile(<span class="string">"graphx/data/users.txt"</span>).map &#123; line  =&gt;</span><br><span class="line">    <span class="keyword">val</span> fields = line.split(<span class="string">","</span>)(</span><br><span class="line">        fields(<span class="number">0</span>).toLong, fields(<span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> ccByUsername = users.join(cc).map &#123;</span><br><span class="line">    <span class="keyword">case</span> (id, (username, cc))  =&gt; (username, cc)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Print the result</span></span><br><span class="line">println(ccByUsername.collect().mkString(<span class="string">"\n"</span>))</span><br></pre></td></tr></table></figure><h4 id="三角计数"><a href="#三角计数" class="headerlink" title="三角计数"></a><strong>三角计数</strong></h4><p>当顶点周围与有一个其他两个顶点有连线时，这个顶点是三角形的一部分。GraphX在TriangleCount对象实现了一个三角形计数算法，这个算法计算通过各顶点的三角形数目，从而提供集群的度。我们从PageRank部分计算社交网络数据集的三角形数量。注意TriangleCount要求边是规范的指向（srcId &lt; dstId），并使用 Graph.partitionBy来分割图形。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load the edges in canonical order and partition the graph for triangle count</span></span><br><span class="line"><span class="keyword">val</span> graph =  <span class="type">GraphLoader</span>.edgeListFile(sc, <span class="string">"graphx/data/followers.txt"</span>, <span class="literal">true</span>).partitionBy( <span class="type">PartitionStrategy</span>. <span class="type">RandomVertexCut</span>)</span><br><span class="line"><span class="comment">// Find the triangle count for each vertex</span></span><br><span class="line"><span class="keyword">val</span> triCounts = graph.triangleCount().vertices</span><br><span class="line"><span class="comment">// Join the triangle counts with the usernames</span></span><br><span class="line"><span class="keyword">val</span> users = sc.textFile(<span class="string">"graphx/data/users.txt"</span>).map &#123; line =&gt; </span><br><span class="line">        <span class="keyword">val</span> fields = line.split(<span class="string">","</span>)(</span><br><span class="line">            fields(<span class="number">0</span>).toLong, fields(<span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">val</span> triCountByUsername = users.join(triCounts).map &#123;  </span><br><span class="line">        <span class="keyword">case</span> (id, (username, tc)) =&gt; (username, tc)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Print the result</span></span><br><span class="line">println(triCountByUsername.collect().mkString(<span class="string">"\n"</span>))</span><br></pre></td></tr></table></figure><ul><li><strong>示例</strong></li></ul><p>假设我想从一些文本文件中构建图，只考虑图中重要关系和用户，在子图中运行的页面排名算法，然后终于返回与顶级用户相关的属性。我们可以在短短的几行 GraphX 代码中实现这一功能：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Connect to the Spark cluster</span></span><br><span class="line"><span class="keyword">val</span> sc =  <span class="keyword">new</span>  <span class="type">SparkContext</span>(<span class="string">"spark://master.amplab.org"</span>, <span class="string">"research"</span>)</span><br><span class="line"><span class="comment">// Load my user data and parse into tuples of user id and attribute list</span></span><br><span class="line"><span class="keyword">val</span> users = (sc.textFile(<span class="string">"graphx/data/users.txt"</span>).map(line  =&gt;  </span><br><span class="line">        line.split(<span class="string">","</span>)).map(  </span><br><span class="line">            parts  =&gt;  (parts.head.toLong,parts.tail) </span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"><span class="comment">// Parse the edge data which is already in userId -&gt; userId format</span></span><br><span class="line"><span class="keyword">val</span>  followerGraph  =  <span class="type">GraphLoader</span>.edgeListFile(sc,<span class="string">"graphx/data/followers.txt"</span>)</span><br><span class="line"><span class="comment">// Attach the user attributes</span></span><br><span class="line"><span class="keyword">val</span> graph = followerGraph.outerJoinVertices(users) &#123;</span><br><span class="line">        <span class="keyword">case</span> (uid, deg,  <span class="type">Some</span>(attrList))  =&gt; attrList</span><br><span class="line">        <span class="comment">// Some users may not have attributes so we set them as empty</span></span><br><span class="line">        <span class="keyword">case</span> (uid, deg,  <span class="type">None</span>)  =&gt;  <span class="type">Array</span>.empty[<span class="type">String</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Restrict the graph to users with usernames and names</span></span><br><span class="line"><span class="keyword">val</span> subgraph = graph.subgraph(vpred = (vid, attr)  =&gt; attr.size == <span class="number">2</span>)</span><br><span class="line"><span class="comment">// Compute the PageRank</span></span><br><span class="line"><span class="keyword">val</span> pagerankGraph = subgraph.pageRank(<span class="number">0.001</span>)</span><br><span class="line"><span class="comment">// Get the attributes of the top pagerank users</span></span><br><span class="line"><span class="keyword">val</span>  userInfoWithPageRank  =</span><br><span class="line">        subgraph.outerJoinVertices(pagerankGraph.vertices) &#123;</span><br><span class="line">            <span class="keyword">case</span> (uid, attrList,  <span class="type">Some</span>(pr))  =&gt; (pr, attrList.toList)</span><br><span class="line">            <span class="keyword">case</span> (uid, attrList,  <span class="type">None</span>)  =&gt; (<span class="number">0.0</span>, attrList.toList)</span><br><span class="line">        &#125;</span><br><span class="line">println(userInfoWithPageRank.vertices.top(<span class="number">5</span>)( </span><br><span class="line">    <span class="type">Ordering</span>.by(_ _._2._1)).mkString(<span class="string">"\n"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><hr><p>翻译者：吴卓华<br>整理自：《Spark GraphX 图计算和图挖掘》</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scala </tag>
            
            <tag> Spark </tag>
            
            <tag> GraphX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何使用IDEA加载已有Spark项目</title>
      <link href="/article/cc29.html"/>
      <url>/article/cc29.html</url>
      
        <content type="html"><![CDATA[<p>背景是这样的：手上有一个学长之前实现的Spark项目，使用到了GraphX，并且用的Scala编写，现在需要再次运行这个项目，但如果直接在IDEA中打开项目，则由于各种错误会导致运行失败，这里就记录一下该如何使用IDEA来加载老旧的Spark项目。<br>注意：默认你的机器已有Scala环境，项目使用IDEA打开，对Sbt不做要求，因为这里采用的是NoSbt方式添加依赖的。</p><a id="more"></a><h3 id="确定项目的版本环境"><a href="#确定项目的版本环境" class="headerlink" title="确定项目的版本环境"></a>确定项目的版本环境</h3><p>这一步是非常重要的，很多情况下就是由于版本的不匹配导致代码解析出现错误，主要的环境版本包括：</p><ul><li>Java Version 1.8 必须</li><li>scala-sdk-x.xx.x</li><li>spark-assembly-x.x.x-hadoop.x.x.jar   //注意这是在No-sbt模式下必须的，这个包很大，大概170M，导入后不用再添加其他依赖即可对Spark程序进行本地(Local)运行，其已包括GraphX模块。</li></ul><h4 id="Java的版本"><a href="#Java的版本" class="headerlink" title="Java的版本"></a>Java的版本</h4><p>这里由于要是用Scala所以必须使用 Version 1.8+，关于如何修改版本这里不赘述。</p><h4 id="Scala的版本"><a href="#Scala的版本" class="headerlink" title="Scala的版本"></a>Scala的版本</h4><p>这里可以通过右键项目名称，进入项目设置页面具体查看原项目使用的版本：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccsin20f138e115e1fci119s1mve9.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccslkpi11q47bt11f971vers4g1g.png" alt></p><p>之后可以添加相应的Scala版本支持，比如假设这里需要 2.10.4 那么直接勾选即可，但是如果本机没有对应的版本，那么可以点击下方的<code>New Liberay</code>选择Scala SDK，进入如下页面：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccsk5ec61d334qt1scm7hl1eps13.png" alt></p><p>在上述页面中你可以选择更多版本的Scala环境，如果还是没有你需要的版本，那么点击下方的<code>Download</code>按钮，可以进一步选择你需要的版本（涵盖所有版本），这是在线下载的操作，所以可能时间会非常慢，非常慢！</p><h4 id="Spark-assembly的版本"><a href="#Spark-assembly的版本" class="headerlink" title="Spark-assembly的版本"></a>Spark-assembly的版本</h4><p>关于这个地方要特别注意版本的对应，老项目里有代码用到了 GraphX中 图的 mapReduceTriplets ，这应该在Spark-2.x.x以后被取消了，所以如果下次再在网上看到使用mapReduceTriplets的代码，复制到本地却无法识别时，不要慌张，那是他们使用了老版本的Spark-GraphX。<br>在这里，原项目使用的是 spark-assembly-1.4.1-hadoop2.6.0.jar 但是这个jar包早就不在项目文件中了，然后在网上也没有搜到完全匹配的Jar包，但上文已说到，找个spark-1.x 版本的即可，所以在网上找了一个 spark-assembly-1.5.1-hadoop2.6.0.jar，同样在 上图 中的右侧点击加号后选择<code>JARS or direct..</code>添加到项目依赖中即可。</p><h3 id="确定项目代码的运行环境"><a href="#确定项目代码的运行环境" class="headerlink" title="确定项目代码的运行环境"></a>确定项目代码的运行环境</h3><p>在上一部分中对原项目的项目的所需依赖的版本进行了更正对应之后，可以发现原先满屏飘红的代码已经没有错误了，即这时IDEA已经具有了对于代码的完全的解析能力，这时我们写代码调方法都可以自动补全等等。</p><p>虽然代码无措，但是直接运行仍然是出不来结果的，因为原项目的代码有原来的运行环境，可能是集群环境或其他，另外，源代码的执行也有可能需要传入若干参数，贸然运行当然就不会得到预期结果。</p><p>这部分的修改要具体情况具体分析，但大致都有以下几步：</p><ul><li>查看Main函数的传入参数，如果带参数的，要明确参数的具体意义，一个是参数类型，一个是参数意义。比如迭代次数，或是文件路径。如果偷懒，可以去掉传入参数，直接对相应变量赋值，这样就可以在IDE中直接运行调试了。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;诸如下面赋值内容要搞清楚具体意义</span><br><span class="line">if(args.length!&#x3D;5)&#123;                                                                 </span><br><span class="line">  printf(&quot;Please input right parameters &lt;vertex path&gt; &lt;edges path&gt; &lt;output path&gt; &lt;deep&gt; &lt;time&gt; &quot;)</span><br><span class="line">  return                                                                            </span><br><span class="line">&#125;      </span><br><span class="line">&#x2F;&#x2F;可以直接对变量赋值，而不用输入参数args(x)</span><br><span class="line">val time&#x3D;args(4).toInt                                                              </span><br><span class="line">val vertexPath&#x3D;args(0)                                                              </span><br><span class="line">val edgesPath&#x3D;args(1)                                                               </span><br><span class="line">val outputPath&#x3D;args(2)                                                              </span><br><span class="line">val deep:Int&#x3D;args(3).toInt</span><br></pre></td></tr></table></figure><ul><li>集群运行还是本地运行，这里比较好改：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val conf &#x3D; new SparkConf().setAppName(&quot;Proj_SIG&quot;) </span><br><span class="line">&#x2F;&#x2F;如果是简单调试，直接改为本地运行即可</span><br><span class="line">val conf &#x3D; new SparkConf().setAppName(&quot;Proj_SIG&quot;).setMaster(&quot;local&quot;)</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="可能需要的Hadoop支持"><a href="#可能需要的Hadoop支持" class="headerlink" title="可能需要的Hadoop支持"></a>可能需要的Hadoop支持</h3><p>如果出现错误：<code>Failed to locate the winutils binary in the hadoop binary path</code> 那么说明当前IDEA环境缺失hadoop的支持。</p><p>解决方案：</p><blockquote><p>首先我们需要明白，hadoop只能运行在linux环境下，如果我们在windows下用idea开发spark的时候底层比方说文件系统这些方面调用hadoop的时候是没法调用的，这也就是为什么会提示这样的错误。<br>当我们有这样的错误的时候，其实还是可以使用spark计算框架的，不过当我们使用saveAsTextFile的时候会提示错误，这是因为spark使用了hadoop上hdfs那一段的程序，而我们windows环境下没有hadoop，怎么办？<br>第一步： 官网下载相应版本的hadoop。<br>第二步：解压到你想要安装的任何路径，解压过程会提示出现错误，不去管他，这是因为linux文件不支持windows。<br>第三步：设置环境变量，在系统变量中添加HADOOP_HOME，指向你解压的文件路径。然后再path中添加 <code>%HADOOP_HOME%bin和%HADOOP_HOME%sbin</code><br>第四步：找一找可以使用的重新编译的winutils兼容工具插件包，这个可以在<a href="http://download.csdn.net/detail/utopia_1919/9623357" target="_blank" rel="external nofollow noopener noreferrer"><strong>这里</strong></a>下载：<br>第五步：下载完以后在我们hadoop文件夹中替换下载包中的两个目录。</p></blockquote><p>回到idea会发现bug完美解决。</p><p>上述几步修改完成后，原先的代码基本就可以跑起来了，再次强调这里使用了NoSBT的模式，手动添加了一个assembly包，再就是对应Scala-SDK的版本，最后对代码内容上进行部分改动，使其可以在本地单机进行调试运行。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scala </tag>
            
            <tag> Spark </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gephi-Toolkit的引入与使用</title>
      <link href="/article/66d5.html"/>
      <url>/article/66d5.html</url>
      
        <content type="html"><![CDATA[<p>Gephi-Toolkit是一个工具包，可以不依赖NetBeans平台来对输入数据进行可视化，输入数据一般是gexf等格式的文件，大多已经完成了坐标计算过程，用此Toolkit的目的就是使用Gephi强大的绘图功能（还有独立的其他功能，这里暂不展开）。详细项目地址点击 <a href="https://github.com/gephi/gephi-toolkit-demos" target="_blank" rel="external nofollow noopener noreferrer">这里</a> 。</p><a id="more"></a><p>在上述Github的项目地址中，有详细的代码<code>demo</code>和使用的部分示例数据。所以具体使用直接参见GitHub即可。</p><h3 id="项目建立"><a href="#项目建立" class="headerlink" title="项目建立"></a>项目建立</h3><p>首先，这里使用 <code>IntelliJ IDEA</code> 来构建测试我们的项目，这里我们先新建一个 <code>Maven</code> 项目，然后在 pom.xml 中引入 Toolkit 的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.gephi/gephi-toolkit --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.gephi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gephi-toolkit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后，去GitHub中的项目里的 demo 中，选择自己所需要的部分，拿出来放到新建的项目里即可。<br>注意：<br>对于数据 LesMiserables.gexf 中的这句代码，如下，会显示一个 <code>未注册</code> 的错误，修改方法是找到 IDEA 的 File -&gt; Settings -&gt; Schemas and DTDs -&gt; 点击设置页下方的绿色加号，将下面代码中的两个网址添加进去，然后未注册错误就没有了！</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gexf</span> <span class="attr">xmlns:viz</span>=<span class="string">"http:///www.gexf.net/1.1draft/viz"</span> <span class="attr">version</span>=<span class="string">"1.1"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.gexf.net/1.1draft"</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="HeadlessSimple-java"><a href="#HeadlessSimple-java" class="headerlink" title="HeadlessSimple.java"></a>HeadlessSimple.java</h3><p>首先关注 HeadlessSimple 这一部分，关于什么是 <code>Headless</code> ?</p><blockquote><p>参见Chrome的 Headless Mode 来理解：<br>Headless Chrome指在headless模式下运行谷歌浏览器。本质就是不用谷歌运行谷歌！它将由Chromium和Blink渲染引擎提供的所有现代网页平台的特征都转化成了命令行<br>它有什么用？<br>Headless浏览器是一种很好的工具，用于自动化测试和不需要可视化用户界面的服务器。例如，你想在一个网页上运行一些测试，从网页创建一个PDF，或者只是检查浏览器怎样递交URL。<br>更多关于Chrome的 headless 模式请参见 <a href="https://www.jianshu.com/p/aec4b1216011" target="_blank" rel="external nofollow noopener noreferrer">这里</a>；</p></blockquote><p>简单来说，就是通过一系列操作，在不借助GUI的条件下，完成原来Gephi客户端能完成的功能，下面代码展示了几个使用toolkit完成的操作。</p><ul><li><code>HeadlessSimple</code> 包括一个完整的从数据导入到结果输出的这样一个处理流程，具体为：<ul><li>创建一个 project 和 workspace，这是必须的操作</li><li>使用 import container 导入polblog.gml这个图数据</li><li>将此 container 追加到主体图结构中</li><li>对图结构进行 Filter，这里使用 DegreeFilter</li><li>Run layout manually.</li><li>计算图的矩阵</li><li>根据节点度值分配节点颜色</li><li>分配节点大小</li><li>配置预览显示不同的标签和边</li><li>将布局图导出为PDF</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.gephi.appearance.api.AppearanceController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.appearance.api.AppearanceModel;</span><br><span class="line"><span class="keyword">import</span> org.gephi.appearance.api.Function;</span><br><span class="line"><span class="keyword">import</span> org.gephi.appearance.plugin.RankingElementColorTransformer;</span><br><span class="line"><span class="keyword">import</span> org.gephi.appearance.plugin.RankingNodeSizeTransformer;</span><br><span class="line"><span class="keyword">import</span> org.gephi.filters.api.FilterController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.filters.api.Query;</span><br><span class="line"><span class="keyword">import</span> org.gephi.filters.api.Range;</span><br><span class="line"><span class="keyword">import</span> org.gephi.filters.plugin.graph.DegreeRangeBuilder.DegreeRangeFilter;</span><br><span class="line"><span class="keyword">import</span> org.gephi.graph.api.*;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.exporter.api.ExportController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.importer.api.Container;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.importer.api.EdgeDirectionDefault;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.importer.api.ImportController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.processor.plugin.DefaultProcessor;</span><br><span class="line"><span class="keyword">import</span> org.gephi.layout.plugin.force.StepDisplacement;</span><br><span class="line"><span class="keyword">import</span> org.gephi.layout.plugin.force.yifanHu.YifanHuLayout;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.api.PreviewController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.api.PreviewModel;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.api.PreviewProperty;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.types.EdgeColor;</span><br><span class="line"><span class="keyword">import</span> org.gephi.project.api.ProjectController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.project.api.Workspace;</span><br><span class="line"><span class="keyword">import</span> org.gephi.statistics.plugin.GraphDistance;</span><br><span class="line"><span class="keyword">import</span> org.openide.util.Lookup;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeadlessSimple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">script</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//A. 此部分是初始部分，必须的，初始Project、Workspace</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Init a project - and therefore a workspace</span></span><br><span class="line">        ProjectController pc = Lookup.getDefault().lookup(ProjectController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        pc.newProject();</span><br><span class="line">        Workspace workspace = pc.getCurrentWorkspace();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//B. GraphModel是全局都需要的</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Get models and controllers for this new workspace - will be useful later</span></span><br><span class="line">        GraphModel graphModel = Lookup.getDefault().lookup(GraphController<span class="class">.<span class="keyword">class</span>).<span class="title">getGraphModel</span>()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//C. 数据读入部分</span></span><br><span class="line"></span><br><span class="line">        ImportController importController = Lookup.getDefault().lookup(ImportController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//Import file</span></span><br><span class="line">        Container container;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(getClass().getResource(<span class="string">"/org/gephi/toolkit/demos/polblogs.gml"</span>).toURI());</span><br><span class="line">            container = importController.importFile(file);</span><br><span class="line">            container.getLoader().setEdgeDefault(EdgeDirectionDefault.DIRECTED);   <span class="comment">//Force DIRECTED</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Append imported data to GraphAPI</span></span><br><span class="line">        importController.process(container, <span class="keyword">new</span> DefaultProcessor(), workspace);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//See if graph is well imported</span></span><br><span class="line">        DirectedGraph graph = graphModel.getDirectedGraph();</span><br><span class="line">        System.out.println(<span class="string">"Nodes: "</span> + graph.getNodeCount());</span><br><span class="line">        System.out.println(<span class="string">"Edges: "</span> + graph.getEdgeCount());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//D. 过滤部分</span></span><br><span class="line"></span><br><span class="line">        FilterController filterController = Lookup.getDefault().lookup(FilterController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">//Filter</span></span><br><span class="line">        DegreeRangeFilter degreeFilter = <span class="keyword">new</span> DegreeRangeFilter();</span><br><span class="line">        degreeFilter.init(graph);</span><br><span class="line">        degreeFilter.setRange(<span class="keyword">new</span> Range(<span class="number">3</span>, Integer.MAX_VALUE));     <span class="comment">//Remove nodes with degree &lt; 30</span></span><br><span class="line">        Query query = filterController.createQuery(degreeFilter);</span><br><span class="line">        GraphView view = filterController.filter(query);</span><br><span class="line">        graphModel.setVisibleView(view);    <span class="comment">//Set the filter result as the visible view</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//See visible graph stats</span></span><br><span class="line">        UndirectedGraph graphVisible = graphModel.getUndirectedGraphVisible();</span><br><span class="line">        System.out.println(<span class="string">"Nodes: "</span> + graphVisible.getNodeCount());</span><br><span class="line">        System.out.println(<span class="string">"Edges: "</span> + graphVisible.getEdgeCount());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Run YifanHuLayout for 100 passes - The layout always takes the current visible view</span></span><br><span class="line">        YifanHuLayout layout = <span class="keyword">new</span> YifanHuLayout(<span class="keyword">null</span>, <span class="keyword">new</span> StepDisplacement(<span class="number">1f</span>));</span><br><span class="line">        layout.setGraphModel(graphModel);</span><br><span class="line">        layout.resetPropertiesValues();</span><br><span class="line">        layout.setOptimalDistance(<span class="number">200f</span>);</span><br><span class="line"></span><br><span class="line">        layout.initAlgo();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span> &amp;&amp; layout.canAlgo(); i++) &#123;</span><br><span class="line">            layout.goAlgo();</span><br><span class="line">        &#125;</span><br><span class="line">        layout.endAlgo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Get Centrality</span></span><br><span class="line">        GraphDistance distance = <span class="keyword">new</span> GraphDistance();</span><br><span class="line">        distance.setDirected(<span class="keyword">true</span>);</span><br><span class="line">        distance.execute(graphModel);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//E. 此部分Rank对节点大小和颜色进行设置</span></span><br><span class="line">        AppearanceController appearanceController = Lookup.getDefault().lookup(AppearanceController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        AppearanceModel appearanceModel = appearanceController.getModel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Rank color by Degree</span></span><br><span class="line">        Function degreeRanking = appearanceModel.getNodeFunction(graph, AppearanceModel.GraphFunction.NODE_DEGREE, RankingElementColorTransformer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        RankingElementColorTransformer degreeTransformer = (RankingElementColorTransformer) degreeRanking.getTransformer();</span><br><span class="line">        degreeTransformer.setColors(<span class="keyword">new</span> Color[]&#123;<span class="keyword">new</span> Color(<span class="number">0xFEF0D9</span>), <span class="keyword">new</span> Color(<span class="number">0xB30000</span>)&#125;);</span><br><span class="line">        degreeTransformer.setColorPositions(<span class="keyword">new</span> <span class="keyword">float</span>[]&#123;<span class="number">0f</span>, <span class="number">1f</span>&#125;);</span><br><span class="line">        appearanceController.transform(degreeRanking);</span><br><span class="line">        <span class="comment">//Rank size by centrality</span></span><br><span class="line">        Column centralityColumn = graphModel.getNodeTable().getColumn(GraphDistance.BETWEENNESS);</span><br><span class="line">        Function centralityRanking = appearanceModel.getNodeFunction(graph, centralityColumn, RankingNodeSizeTransformer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        RankingNodeSizeTransformer centralityTransformer = (RankingNodeSizeTransformer) centralityRanking.getTransformer();</span><br><span class="line">        centralityTransformer.setMinSize(<span class="number">3</span>);</span><br><span class="line">        centralityTransformer.setMaxSize(<span class="number">10</span>);</span><br><span class="line">        appearanceController.transform(centralityRanking);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//F. 最后展现时图的模式：点、边的样式</span></span><br><span class="line"></span><br><span class="line">        PreviewModel model = Lookup.getDefault().lookup(PreviewController<span class="class">.<span class="keyword">class</span>).<span class="title">getModel</span>()</span>;</span><br><span class="line">        <span class="comment">//Preview</span></span><br><span class="line">        model.getProperties().putValue(PreviewProperty.SHOW_NODE_LABELS, Boolean.TRUE);</span><br><span class="line">        model.getProperties().putValue(PreviewProperty.EDGE_COLOR, <span class="keyword">new</span> EdgeColor(Color.GRAY));</span><br><span class="line">        model.getProperties().putValue(PreviewProperty.EDGE_THICKNESS, <span class="keyword">new</span> Float(<span class="number">0.1f</span>));</span><br><span class="line">        model.getProperties().putValue(PreviewProperty.NODE_LABEL_FONT, model.getProperties().getFontValue(PreviewProperty.NODE_LABEL_FONT).deriveFont(<span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//G. 输出部分 </span></span><br><span class="line">        ExportController ec = Lookup.getDefault().lookup(ExportController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ec.exportFile(<span class="keyword">new</span> File(<span class="string">"headless_simple.pdf"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        HeadlessSimple s = <span class="keyword">new</span> HeadlessSimple();</span><br><span class="line">        s.script();</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>注意上述代码中的A.B.C.D.E.F.G 部分，都是XxxxController的实例化，并且每一部分都是相对独立的。<br>上述代码执行完成后，可以得到如下PDF的图像（注释掉Filter阶段让其保留全部布局）：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cclaihoj17q65iv1gl3104u1sut1m.png" alt></p><h3 id="PreviewJFrame-java"><a href="#PreviewJFrame-java" class="headerlink" title="PreviewJFrame.java"></a>PreviewJFrame.java</h3><p>注意在使用PreviewJFrame时，源代码中有个细节要注意，下图结构中的 <code>plugin</code> 文件夹下有需要使用的依赖代码，必须添加到项目中，否则会出错。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cclriks5t7ra69174c1nee1jck23.png" alt></p><blockquote><p>此部分的官方说明：这个文件夹包含一个基本预览插件的结构，它可以做一些简单的渲染，也可以对鼠标事件做出反应。只要有@ Service提供商注释，插件就可以在任何预览窗口中自动包含。<br>可以运行 PreviewJFrame.java 来尝试这个插件。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cclrupm71s76144u1o4ne8o17472g.png" alt></p><p>PreviewJFrame 代码如下（出现PreviewSketch找不到的问题就是没引入plugins文件夹）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.gephi.io.importer.api.Container;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.importer.api.ImportController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.io.processor.plugin.DefaultProcessor;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.api.*;</span><br><span class="line"><span class="keyword">import</span> org.gephi.preview.types.DependantOriginalColor;</span><br><span class="line"><span class="keyword">import</span> org.gephi.project.api.ProjectController;</span><br><span class="line"><span class="keyword">import</span> org.gephi.project.api.Workspace;</span><br><span class="line"><span class="keyword">import</span> org.openide.util.Lookup;</span><br><span class="line"><span class="keyword">import</span> plugins.PreviewSketch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ComponentAdapter;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ComponentEvent;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mathieu Bastian</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreviewJFrame</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">script</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Init a project - and therefore a workspace</span></span><br><span class="line">        ProjectController pc = Lookup.getDefault().lookup(ProjectController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        pc.newProject();</span><br><span class="line">        Workspace workspace = pc.getCurrentWorkspace();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Import file</span></span><br><span class="line">        ImportController importController = Lookup.getDefault().lookup(ImportController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        Container container;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(getClass().getResource(<span class="string">"/Java.gexf"</span>).toURI());</span><br><span class="line">            container = importController.importFile(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Append imported data to GraphAPI</span></span><br><span class="line">        importController.process(container, <span class="keyword">new</span> DefaultProcessor(), workspace);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Preview configuration</span></span><br><span class="line">        PreviewController previewController = Lookup.getDefault().lookup(PreviewController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        PreviewModel previewModel = previewController.getModel();</span><br><span class="line">        previewModel.getProperties().putValue(PreviewProperty.SHOW_NODE_LABELS, Boolean.TRUE);</span><br><span class="line">        previewModel.getProperties().putValue(PreviewProperty.NODE_LABEL_COLOR, <span class="keyword">new</span> DependantOriginalColor(Color.WHITE));</span><br><span class="line">        previewModel.getProperties().putValue(PreviewProperty.EDGE_CURVED, Boolean.FALSE);</span><br><span class="line">        previewModel.getProperties().putValue(PreviewProperty.EDGE_OPACITY, <span class="number">50</span>);</span><br><span class="line">        previewModel.getProperties().putValue(PreviewProperty.BACKGROUND_COLOR, Color.BLACK);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//New Processing target, get the PApplet</span></span><br><span class="line">        G2DTarget target = (G2DTarget) previewController.getRenderTarget(RenderTarget.G2D_TARGET);</span><br><span class="line">        <span class="keyword">final</span> PreviewSketch previewSketch = <span class="keyword">new</span> PreviewSketch(target);</span><br><span class="line">        previewController.refreshPreview();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Add the applet to a JFrame and display</span></span><br><span class="line">        JFrame frame = <span class="keyword">new</span> JFrame(<span class="string">"Test Preview"</span>);</span><br><span class="line">        frame.setLayout(<span class="keyword">new</span> BorderLayout());</span><br><span class="line"></span><br><span class="line">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        frame.add(previewSketch, BorderLayout.CENTER);</span><br><span class="line"></span><br><span class="line">        frame.setSize(<span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Wait for the frame to be visible before painting, or the result drawing will be strange</span></span><br><span class="line">        frame.addComponentListener(<span class="keyword">new</span> ComponentAdapter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">componentShown</span><span class="params">(ComponentEvent e)</span> </span>&#123;</span><br><span class="line">                previewSketch.resetZoom();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        frame.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        PreviewJFrame previewJFrame = <span class="keyword">new</span> PreviewJFrame();</span><br><span class="line">        previewJFrame.script();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时的布局结果是窗体性质的，且内容可缩放，可平移，结果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cclsm5o51alo1pqp1r9l1aja1f9r2t.png" alt></p><h3 id="其他，待续"><a href="#其他，待续" class="headerlink" title="其他，待续"></a>其他，待续</h3>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Maven </tag>
            
            <tag> GitHub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark图计算及GraphX简单入门</title>
      <link href="/article/a486.html"/>
      <url>/article/a486.html</url>
      
        <content type="html"><![CDATA[<h2 id="GraphX介绍"><a href="#GraphX介绍" class="headerlink" title="GraphX介绍"></a><strong>GraphX介绍</strong></h2><h3 id="GraphX应用背景"><a href="#GraphX应用背景" class="headerlink" title="GraphX应用背景"></a><strong>GraphX应用背景</strong></h3><p>Spark GraphX是一个分布式图处理框架，它是基于Spark平台提供对图计算和图挖掘简洁易用的而丰富的接口，极大的方便了对分布式图处理的需求。</p><a id="more"></a><p>众所周知·，社交网络中人与人之间有很多关系链，例如Twitter、Facebook、微博和微信等，这些都是大数据产生的地方都需要图计算，现在的图处理基本都是分布式的图处理，而并非单机处理。Spark GraphX由于底层是基于Spark来处理的，所以天然就是一个分布式的图处理系统。</p><p>图的分布式或者并行处理其实是把图拆分成很多的子图，然后分别对这些子图进行计算，计算的时候可以分别迭代进行分阶段的计算，即对图进行并行计算。下面我们看一下图计算的简单示例：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0e37c158c16jl11a71m7vola9.png" alt></p><p>从图中我们可以看出：拿到Wikipedia的文档以后，可以变成Link Table形式的视图，然后基于Link Table形式的视图可以分析成Hyperlinks超链接，最后我们可以使用PageRank去分析得出Top Communities。在下面路径中的Editor Graph到Community，这个过程可以称之为Triangle Computation，这是计算三角形的一个算法，基于此会发现一个社区。从上面的分析中我们可以发现图计算有很多的做法和算法，同时也发现图和表格可以做互相的转换。</p><h3 id="GraphX的框架"><a href="#GraphX的框架" class="headerlink" title="GraphX的框架"></a><strong>GraphX的框架</strong></h3><p>设计GraphX时，点分割和GAS都已成熟，在设计和编码中针对它们进行了优化，并在功能和性能之间寻找最佳的平衡点。如同Spark本身，每个子模块都有一个核心抽象。GraphX的核心抽象是Resilient Distributed Property Graph，一种点和边都带属性的有向多重图。它扩展了Spark RDD的抽象，有Table和Graph两种视图，而只需要一份物理存储。两种视图都有自己独有的操作符，从而获得了灵活操作和执行效率。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0j03b1uej10pj1n8il22v9em.png" alt></p><p>如同Spark，GraphX的代码非常简洁。GraphX的核心代码只有3千多行，而在此之上实现的Pregel模式，只要短短的20多行。GraphX的代码结构整体下图所示，其中大部分的实现，都是围绕Partition的优化进行的。这在某种程度上说明了点分割的存储和相应的计算优化，的确是图计算框架的重点和难点。</p><h3 id="发展历程"><a href="#发展历程" class="headerlink" title="发展历程"></a><strong>发展历程</strong></h3><p>l早在0.5版本，Spark就带了一个小型的Bagel模块，提供了类似Pregel的功能。当然，这个版本还非常原始，性能和功能都比较弱，属于实验型产品。</p><p>l到0.8版本时，鉴于业界对分布式图计算的需求日益见涨，Spark开始独立一个分支Graphx-Branch，作为独立的图计算模块，借鉴GraphLab，开始设计开发GraphX。</p><p>l在0.9版本中，这个模块被正式集成到主干，虽然是Alpha版本，但已可以试用，小面包圈Bagel告别舞台。1.0版本，GraphX正式投入生产使用。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0jidk54611o8eolhhcfp813.png" alt></p><p>值得注意的是，GraphX目前依然处于快速发展中，从0.8的分支到0.9和1.0，每个版本代码都有不少的改进和重构。根据观察，在没有改任何代码逻辑和运行环境，只是升级版本、切换接口和重新编译的情况下，每个版本有10%~20%的性能提升。虽然和GraphLab的性能还有一定差距，但凭借Spark整体上的一体化流水线处理，社区热烈的活跃度及快速改进速度，GraphX具有强大的竞争力。</p><h2 id="GraphX实现分析"><a href="#GraphX实现分析" class="headerlink" title="GraphX实现分析"></a><strong>GraphX实现分析</strong></h2><p>如同Spark本身，每个子模块都有一个核心抽象。GraphX的核心抽象是Resilient Distributed Property Graph，一种点和边都带属性的有向多重图。它扩展了Spark RDD的抽象，有Table和Graph两种视图，而只需要一份物理存储。两种视图都有自己独有的操作符，从而获得了灵活操作和执行效率。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0k59t17964ea308o2k19ek1g.png" alt></p><p>GraphX的底层设计有以下几个关键点。</p><p>对Graph视图的所有操作，最终都会转换成其关联的Table视图的RDD操作来完成。这样对一个图的计算，最终在逻辑上，等价于一系列RDD的转换过程。因此，Graph最终具备了RDD的3个关键特性：Immutable、Distributed和Fault-Tolerant，其中最关键的是Immutable（不变性）。逻辑上，所有图的转换和操作都产生了一个新图；物理上，GraphX会有一定程度的不变顶点和边的复用优化，对用户透明。</p><p>两种视图底层共用的物理数据，由RDD[Vertex-Partition]和RDD[EdgePartition]这两个RDD组成。点和边实际都不是以表Collection[tuple]的形式存储的，而是由VertexPartition/EdgePartition在内部存储一个带索引结构的分片数据块，以加速不同视图下的遍历速度。不变的索引结构在RDD转换过程中是共用的，降低了计算和存储开销。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0kkp21m0r11a35lc1qkh1f7n1t.png" alt></p><p>图的分布式存储采用点分割模式，而且使用partitionBy方法，由用户指定不同的划分策略（PartitionStrategy）。划分策略会将边分配到各个EdgePartition，顶点Master分配到各个VertexPartition，EdgePartition也会缓存本地边关联点的Ghost副本。划分策略的不同会影响到所需要缓存的Ghost副本数量，以及每个EdgePartition分配的边的均衡程度，需要根据图的结构特征选取最佳策略。目前有EdgePartition2d、EdgePartition1d、RandomVertexCut和CanonicalRandomVertexCut这四种策略。</p><h3 id="存储模式"><a href="#存储模式" class="headerlink" title="存储模式"></a><strong>存储模式</strong></h3><h4 id="图存储模式"><a href="#图存储模式" class="headerlink" title="图存储模式"></a><strong>图存储模式</strong></h4><p>巨型图的存储总体上有边分割和点分割两种存储方式。2013年，GraphLab2.0将其存储方式由边分割变为点分割，在性能上取得重大提升，目前基本上被业界广泛接受并使用。</p><ul><li><p><strong>边分割（Edge-Cut）</strong>：每个顶点都存储一次，但有的边会被打断分到两台机器上。这样做的好处是节省存储空间；坏处是对图进行基于边的计算时，对于一条两个顶点被分到不同机器上的边来说，要跨机器通信传输数据，内网通信流量大。</p></li><li><p><strong>点分割（Vertex-Cut）</strong>：每条边只存储一次，都只会出现在一台机器上。邻居多的点会被复制到多台机器上，增加了存储开销，同时会引发数据同步问题。好处是可以大幅减少内网通信量。</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0lj87s1h1bcnhhd198n14st2a.png" alt></p><p>虽然两种方法互有利弊，但现在是点分割占上风，各种分布式图计算框架都将自己底层的存储形式变成了点分割。主要原因有以下两个。</p><ol><li>磁盘价格下降，存储空间不再是问题，而内网的通信资源没有突破性进展，集群计算时内网带宽是宝贵的，时间比磁盘更珍贵。这点就类似于常见的空间换时间的策略。</li><li>在当前的应用场景中，绝大多数网络都是“无尺度网络”，遵循幂律分布，不同点的邻居数量相差非常悬殊。而边分割会使那些多邻居的点所相连的边大多数被分到不同的机器上，这样的数据分布会使得内网带宽更加捉襟见肘，于是边分割存储方式被渐渐抛弃了。</li></ol><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="GraphX存储模式"><a href="#GraphX存储模式" class="headerlink" title="GraphX存储模式"></a><strong>GraphX存储模式</strong></h4><p>Graphx借鉴PowerGraph，使用的是Vertex-Cut(点分割)方式存储图，用三个RDD存储图数据信息：</p><ul><li><p><strong>lVertexTable(id, data)</strong>：id为Vertex id，data为Edge data</p></li><li><p><strong>lEdgeTable(pid, src, dst, data)</strong>：pid为Partion id，src为原定点id，dst为目的顶点id</p></li><li><p><strong>lRoutingTable(id, pid)</strong>：id为Vertex id，pid为Partion id</p></li></ul><p>点分割存储实现如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0m5pi9ui17sb1o8r13fb1gal2n.png" alt></p><h3 id="计算模式"><a href="#计算模式" class="headerlink" title="计算模式"></a><strong>计算模式</strong></h3><h4 id="图计算模式"><a href="#图计算模式" class="headerlink" title="图计算模式"></a><strong>图计算模式</strong></h4><p>目前基于图的并行计算框架已经有很多，比如来自Google的Pregel、来自Apache开源的图计算框架Giraph/HAMA以及最为著名的GraphLab，其中Pregel、HAMA和Giraph都是非常类似的，都是基于BSP（Bulk Synchronous Parallell）模式。</p><p>Bulk Synchronous Parallell，即整体同步并行，它将计算分成一系列的超步（superstep）的迭代（iteration）。从纵向上看，它是一个串行模式，而从横向上看，它是一个并行的模式，每两个superstep之间设置一个栅栏（barrier），即整体同步点，确定所有并行的计算都完成后再启动下一轮superstep。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0mo9v1eri1l60p3u8oqj6i34.png" alt></p><p>每一个超步（superstep）包含三部分内容：</p><ol><li><strong>计算compute</strong>：每一个processor利用上一个superstep传过来的消息和本地的数据进行本地计算；</li><li><strong>消息传递</strong>：每一个processor计算完毕后，将消息传递个与之关联的其它processors</li><li><strong>整体同步点</strong>：用于整体同步，确定所有的计算和消息传递都进行完毕后，进入下一个superstep。</li></ol><h4 id="GraphX计算模式"><a href="#GraphX计算模式" class="headerlink" title="GraphX计算模式"></a><strong>GraphX计算模式</strong></h4><p>如同Spark一样，GraphX的Graph类提供了丰富的图运算符，大致结构如下图所示。可以在官方GraphX Programming Guide中找到每个函数的详细说明，本文仅讲述几个需要注意的方法。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0nfloupd141hv7h1f9o1ms3h.png" alt></p><h5 id="图的缓存"><a href="#图的缓存" class="headerlink" title="图的缓存"></a><strong>图的缓存</strong></h5><p>每个图是由3个RDD组成，所以会占用更多的内存。相应图的cache、unpersist和checkpoint，更需要注意使用技巧。出于最大限度复用边的理念，GraphX的默认接口只提供了unpersistVertices方法。如果要释放边，调用g.edges.unpersist()方法才行，这给用户带来了一定的不便，但为GraphX的优化提供了便利和空间。参考GraphX的Pregel代码，对一个大图，目前最佳的实践是：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0o55515er1kg6khr1tsf1lju3u.png" alt></p><p>大体之意是根据GraphX中Graph的不变性，对g做操作并赋回给g之后，g已不是原来的g了，而且会在下一轮迭代使用，所以必须cache。另外，必须先用prevG保留住对原来图的引用，并在新图产生后，快速将旧图彻底释放掉。否则，十几轮迭代后，会有内存泄漏问题，很快耗光作业缓存空间。</p><h5 id="邻边聚合"><a href="#邻边聚合" class="headerlink" title="邻边聚合"></a><strong>邻边聚合</strong></h5><p>mrTriplets（mapReduceTriplets）是GraphX中最核心的一个接口。Pregel也基于它而来，所以对它的优化能很大程度上影响整个GraphX的性能。mrTriplets运算符的简化定义是：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0opj71ajs173ao3j3jius44b.png" alt></p><p>它的计算过程为：map，应用于每一个Triplet上，生成一个或者多个消息，消息以Triplet关联的两个顶点中的任意一个或两个为目标顶点；reduce，应用于每一个Vertex上，将发送给每一个顶点的消息合并起来。</p><p>mrTriplets最后返回的是一个VertexRDD[A]，包含每一个顶点聚合之后的消息（类型为A），没有接收到消息的顶点不会包含在返回的VertexRDD中。</p><p>在最近的版本中，GraphX针对它进行了一些优化，对于Pregel以及所有上层算法工具包的性能都有重大影响。主要包括以下几点。</p><ol><li><strong>Caching for Iterative mrTriplets &amp; Incremental Updates for Iterative mrTriplets</strong>：在很多图分析算法中，不同点的收敛速度变化很大。在迭代后期，只有很少的点会有更新。因此，对于没有更新的点，下一次mrTriplets计算时EdgeRDD无需更新相应点值的本地缓存，大幅降低了通信开销。</li><li><strong>Indexing Active Edges</strong>：没有更新的顶点在下一轮迭代时不需要向邻居重新发送消息。因此，mrTriplets遍历边时，如果一条边的邻居点值在上一轮迭代时没有更新，则直接跳过，避免了大量无用的计算和通信。</li><li><strong>Join Elimination</strong>：Triplet是由一条边和其两个邻居点组成的三元组，操作Triplet的map函数常常只需访问其两个邻居点值中的一个。例如，在PageRank计算中，一个点值的更新只与其源顶点的值有关，而与其所指向的目的顶点的值无关。那么在mrTriplets计算中，就不需要VertexRDD和EdgeRDD的3-way join，而只需要2-way join。</li></ol><p>所有这些优化使GraphX的性能逐渐逼近GraphLab。虽然还有一定差距，但一体化的流水线服务和丰富的编程接口，可以弥补性能的微小差距。</p><h5 id="进化的Pregel模式"><a href="#进化的Pregel模式" class="headerlink" title="进化的Pregel模式"></a><strong>进化的Pregel模式</strong></h5><p>GraphX中的Pregel接口，并不严格遵循Pregel模式，它是一个参考GAS改进的Pregel模式。定义如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0p5do4dtvq77r31ccd9t64o.png" alt></p><p>这种基于mrTrilets方法的Pregel模式，与标准Pregel的最大区别是，它的第2段参数体接收的是3个函数参数，而不接收messageList。它不会在单个顶点上进行消息遍历，而是将顶点的多个Ghost副本收到的消息聚合后，发送给Master副本，再使用vprog函数来更新点值。消息的接收和发送都被自动并行化处理，无需担心超级节点的问题。</p><p>常见的代码模板如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ccm0pjsp1km1r3g102t1lo14hb55.png" alt></p><p>可以看到，GraphX设计这个模式的用意。它综合了Pregel和GAS两者的优点，即接口相对简单，又保证性能，可以应对点分割的图存储模式，胜任符合幂律分布的自然图的大型计算。另外，值得注意的是，官方的Pregel版本是最简单的一个版本。对于复杂的业务场景，根据这个版本扩展一个定制的Pregel是很常见的做法。</p><h5 id="图算法工具包"><a href="#图算法工具包" class="headerlink" title="图算法工具包"></a>图算法工具包</h5><p>GraphX也提供了一套图算法工具包，方便用户对图进行分析。目前最新版本已支持PageRank、数三角形、最大连通图和最短路径等6种经典的图算法。这些算法的代码实现，目的和重点在于通用性。如果要获得最佳性能，可以参考其实现进行修改和扩展满足业务需求。另外，研读这些代码，也是理解GraphX编程最佳实践的好方法。</p><hr><p>作者：石山园<br>出处：<a href="http://www.cnblogs.com/shishanyuan/" target="_blank" rel="external nofollow noopener noreferrer">http://www.cnblogs.com/shishanyuan/</a></p>]]></content>
      
      
      <categories>
          
          <category> Spark学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> GraphX </tag>
            
            <tag> Demo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>两个水壶相互倒水—水壶问题</title>
      <link href="/article/113e.html"/>
      <url>/article/113e.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cc8i770evf71ens1aaojdfqe99.png" alt></p><a id="more"></a><p><b><a href="https://old.cz5h.com/article/2018-4-27%20%E4%B8%A4%E4%B8%AA%E6%B0%B4%E5%A3%B6%E7%9B%B8%E4%BA%92%E5%80%92%E6%B0%B4%E2%80%94%E6%B0%B4%E5%A3%B6%E9%97%AE%E9%A2%98.html#%E7%B2%BE%E7%9B%8A%E6%B1%82%E7%B2%BE" target="_blank" rel="external nofollow noopener noreferrer" style="color:red;font-size:19px;">点击此处快速跳到程序部分</a></b></p><h4 id="水壶问题"><a href="#水壶问题" class="headerlink" title="水壶问题"></a><strong>水壶问题</strong></h4><p>有两个容量分别为 x升 和 y升 的水壶以及无限多的水。请判断能否通过使用这两个水壶，从而可以得到恰好 z升 的水？<br>如果可以，最后请用以上水壶中的一或两个来盛放取得的 z升 水。</p><p>你允许：<br>装满任意一个水壶<br>清空任意一个水壶<br>从一个水壶向另外一个水壶倒水，直到装满或者倒空</p><pre><code>示例1: (From the famous &quot;Die Hard&quot; example)输入: x = 3, y = 5, z = 4输出: True示例2:输入: x = 2, y = 6, z = 5输出: False</code></pre><h4 id="第一印象"><a href="#第一印象" class="headerlink" title="第一印象"></a><strong>第一印象</strong></h4><p>乍一看这道题目和题目的示例，以为直接用条件判断就能搞定，于是立刻写了如下非常错误的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( (<span class="number">0.5</span>*x + <span class="number">0.5</span>*y == z)||(x + y == z)||</span><br><span class="line">        (<span class="number">0.5</span>*x + y == z)||(x + <span class="number">0.5</span>*y == z)||</span><br><span class="line">        (x + x == z)||(y + y == z) )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然执行的结果是错误的，这里主要烦了两个重要的错误：</p><ul><li>杯子只能倒空或倒满，不能倒一半（像脑筋急转弯那样）</li><li>两个杯子，当然可以让水从一个倒入另一个</li></ul><p>从上述一开始遇到的错误，可以引出此题的关键：</p><ul><li>需要不断将水倒来倒去，从而利用容量差得到更多样的容量的水</li><li>为了减少实现复杂程度，输入的x，y应该按指定顺序，如前小后大</li><li>对特定情况，能提前排除就提前排除，比如（0,1,2）</li></ul><h4 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a><strong>进入正题</strong></h4><p>首先，是问题的抽象，该问题可以转化为问一个三元组r(x,y,z)，按一定规则对x，y进行运算，规则就是：</p><ul><li>x，y只能被赋值不比自身大的数，</li><li>x，y运算过程中，只要有一个状态，或x，或y，或x+y，等于z，则问题得解</li><li>问题无解的条件？</li></ul><p>然后，<strong>由特殊推普通</strong>，实际计算几个例子，看看有什么规律，杯子x，y每次的状态有：</p><pre><code>注意：下面的每一步都是注定的，即‘只有这样操作才对目标的获得有意义’，目标是什么？目标就是每次操作都要‘利用容量差产生更多样的容量的水’。</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">4</span>  y=<span class="number">5</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>              <span class="comment">//初始状态</span></span><br><span class="line"><span class="number">0</span>    <span class="number">5</span>              <span class="comment">//小的倒空，大的倒满【问题I】</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-(<span class="number">4</span>-<span class="number">0</span>)=<span class="number">1</span>      <span class="comment">//大的将小的倒满，大的会剩余，这里剩余 1</span></span><br><span class="line"><span class="number">0</span>    <span class="number">1</span>              <span class="comment">//小的倒空</span></span><br><span class="line"><span class="number">1</span>    <span class="number">0</span>              <span class="comment">//大的中的剩余倒入小的</span></span><br><span class="line"><span class="number">1</span>    <span class="number">5</span>              <span class="comment">//大的倒满</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-(<span class="number">4</span>-<span class="number">1</span>)=<span class="number">2</span>      <span class="comment">//大的继续将小的倒满，大的还会剩余，这里剩余 2</span></span><br><span class="line"><span class="number">0</span>    <span class="number">2</span>              <span class="comment">//往复上述操作</span></span><br><span class="line"><span class="number">2</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">5</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-(<span class="number">4</span>-<span class="number">2</span>)=<span class="number">3</span></span><br><span class="line"><span class="number">0</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-(<span class="number">4</span>-<span class="number">3</span>)=<span class="number">4</span>      <span class="comment">//x==y，后续会再重新回到开始状态，故这是终止状态【问题II】</span></span><br><span class="line"><span class="number">0</span>    <span class="number">4</span></span><br><span class="line"><span class="number">4</span>    <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span></span><br></pre></td></tr></table></figure><pre><code>问题I，为什么小的倒空大的倒满？因为如果相反，小的满，大的空，水只能从小杯子倒入大杯子，且小杯子无剩余，故没有利用到容量差，所以这种顺序的操作时无意义的。 问题II，如果x和y不相等，且y&gt;x即剩余的水多于小杯子的容量怎么办？答：此时归结为【第二种情况】后续会讲到，所以当 y&lt;=x 时可当做【第一种情况】 </code></pre><h4 id="初步的编码实现"><a href="#初步的编码实现" class="headerlink" title="初步的编码实现"></a><strong>初步的编码实现</strong></h4><p>由上述思路作指导，很自然的想到了使用递归这种方式，于是有了以下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">int</span> zx; </span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">int</span> sm; </span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">int</span> lg; </span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">boolean</span> MK = <span class="keyword">false</span>; </span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(z == x||z == y||z==x+y||z==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(z &gt; x &amp;&amp; z&gt; y &amp;&amp; z&gt;(x+y))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        zx = z;</span><br><span class="line">        sm = x;</span><br><span class="line">        lg = y;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y)&#123;</span><br><span class="line">            <span class="keyword">int</span> tp = sm;sm = lg;lg = tp;  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">            recursion(sm,lg-(sm-<span class="number">0</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> MK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">recursion</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(zx == x+y || zx == x || zx==y) </span><br><span class="line">            MK = <span class="keyword">true</span>; </span><br><span class="line">        <span class="keyword">if</span>(x &lt;= y||y&gt;zx)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!MK) MK = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        x = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(zx == x+y || zx == x || zx==y)  </span><br><span class="line">            MK = <span class="keyword">true</span>;  </span><br><span class="line">        <span class="keyword">int</span> t = x;x = y;y = t; </span><br><span class="line">        x = x;</span><br><span class="line">        y = lg;</span><br><span class="line">        <span class="keyword">if</span>(zx == x+y || zx == x || zx==y)  </span><br><span class="line">            MK = <span class="keyword">true</span>; </span><br><span class="line">        recursion(sm,lg-(sm-x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="补全思路得到新的实现"><a href="#补全思路得到新的实现" class="headerlink" title="补全思路得到新的实现"></a><strong>补全思路得到新的实现</strong></h4><p>上述代码不出意外的还是没过，解答出错，为什么呢，原来是原先的思路有问题，思考不全面，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">4</span>  y=<span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span></span><br><span class="line"><span class="number">0</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">0</span>)=<span class="number">3</span></span><br><span class="line"><span class="number">0</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">3</span>)=<span class="number">6</span>      <span class="comment">//上述步骤同先前同理</span></span><br><span class="line"><span class="number">0</span>    <span class="number">6</span>              <span class="comment">//但此时出现 大的里的剩余 比小的容量还大【问题I】</span></span><br><span class="line">?    ?              </span><br><span class="line">...</span><br></pre></td></tr></table></figure><pre><code>问题I 如果大杯子剩余的比小杯子容量大，怎么处理答：此时应不同于一般情况，一般情况是大的里的剩余是比小的容量小&apos;所以剩余水可以倒入小的，但此时无法将大杯子的剩余水倒入小杯子，因为会溢出，那么应该如何操作呢，本着利用‘容量差’的原则，所以：需要将小杯子用大杯子的剩余水倒满，此时大杯子的水仍有剩余，如果此时剩余的水还比小杯子的大，那么先倒空小杯子，然后继续用剩余的水装满小杯子，直到剩余的水 小于小杯子容量，此时停止，因为此时剩余的水可以倒入小杯子了，所以又回到了第一种情况。</code></pre><p>下面，我们按刚才说的思路将先前的例子列完：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">4</span>  y=<span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span></span><br><span class="line"><span class="number">0</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">0</span>)=<span class="number">3</span></span><br><span class="line"><span class="number">0</span>    <span class="number">3</span></span><br><span class="line"><span class="number">3</span>    <span class="number">0</span></span><br><span class="line"><span class="number">3</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">3</span>)=<span class="number">6</span>      <span class="comment">//此时，按刚才的思路【第二种情况】继续</span></span><br><span class="line"><span class="number">0</span>    <span class="number">6</span>              <span class="comment">//小杯子倒空</span></span><br><span class="line"><span class="number">4</span>    <span class="number">6</span>-<span class="number">4</span>=<span class="number">2</span>          <span class="comment">//用大杯子剩余的水倒满小杯子，大杯子还剩余 2</span></span><br><span class="line"><span class="number">0</span>    <span class="number">2</span>              <span class="comment">//此时回归【第一种情况】</span></span><br><span class="line"><span class="number">2</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">2</span>)=<span class="number">5</span>      <span class="comment">//此时，又回到【第二种情况】</span></span><br><span class="line"><span class="number">0</span>    <span class="number">5</span></span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-<span class="number">4</span>=<span class="number">1</span>          <span class="comment">//此时又回归【第一种情况】</span></span><br><span class="line"><span class="number">0</span>    <span class="number">1</span></span><br><span class="line"><span class="number">1</span>    <span class="number">0</span></span><br><span class="line"><span class="number">1</span>    <span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">1</span>)=<span class="number">4</span>      <span class="comment">//此时xy相等，如果继续，则状态回归初始，故此时终止</span></span><br></pre></td></tr></table></figure><p>上述例子即完整的展现了正确的迭代步骤，即需要分为【两种情况】，所以在先前递归形式的基础上，对每次的迭代中的 x y的大小分情况进入不同的迭代入口即可。然而这一新的实现仍然出错误了：Stack Overflow！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="如何避免递归的栈溢出"><a href="#如何避免递归的栈溢出" class="headerlink" title="如何避免递归的栈溢出"></a><strong>如何避免递归的栈溢出</strong></h4><p>对于溢出时的测试用例：22003,31237,137，在我本机跑时递归了九千次左右就溢出停止了，但对于一般的小的测试用例，答案已经都是正确的了，所以此时的思路应是正确的，只是实现形式有问题，需要优化！</p><p>重新对上一章节中说到的例子进行考究，发现真正有用的（跟Z比较判断的）状态其实只有如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">4</span>  y=<span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">0</span>)=<span class="number">3</span>  <span class="comment">//【情况一】</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">3</span>)=<span class="number">6</span>       </span><br><span class="line"><span class="number">4</span>    <span class="number">6</span>-<span class="number">4</span>=<span class="number">2</span>      <span class="comment">//【情况二】      </span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">2</span>)=<span class="number">5</span>       </span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-<span class="number">4</span>=<span class="number">1</span>           </span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">1</span>)=<span class="number">4</span></span><br></pre></td></tr></table></figure><p>优化情况二：按先前的思路可知，情况二其实不需要迭代操作，其就是在大杯子剩余水多于小杯子容量时，就拿小杯子每次都去装大杯子的剩余水，直到大杯子中剩余的水小于小杯子的容量，抽象为数学运算：</p><ul><li>取余 y % x == c</li></ul><p>实现上，由于需要中间的每个状态（和z比较），所以可以用while循环来完成，优化后的代码：<br>【情况一】：大水杯里的剩水不断的增加，直到增加到剩水大于小水杯容量；<br>【情况二】：大水杯剩水不断的减少，直到剩水小于小水杯的容量；<br>再次明确：情况一时小水杯的容量 &gt;= 大水杯的剩水； 情况二时小水杯的容量 &lt; 大水杯的剩水；<br>注意：<br>对于每次迭代，都对两种情况分别对待，然后进行下一次迭代，此时迭代是靠<code>递归</code>驱动的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> zx; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> sm; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> lgt; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> MK = <span class="keyword">false</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">        sm = x; lgt = y;</span><br><span class="line">        <span class="keyword">if</span>(x &gt; y)&#123;</span><br><span class="line">           sm = y; lgt = x; </span><br><span class="line">        &#125;</span><br><span class="line">        zx = z; </span><br><span class="line">        recursion(lgt);</span><br><span class="line">        <span class="keyword">return</span> MK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//static int cnt = 0;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">recursion</span><span class="params">(<span class="keyword">int</span> rs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sm + rs == zx|| sm + lgt == zx|| sm + rs == zx|| sm == zx|| rs == zx|| zx == <span class="number">0</span>)&#123;</span><br><span class="line">            MK = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rs &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!MK) MK = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sm &lt;= rs)&#123;</span><br><span class="line">            <span class="keyword">int</span> tmp = rs;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; tmp &gt;= sm;i ++)&#123;</span><br><span class="line">                tmp = tmp - sm;</span><br><span class="line">            &#125;</span><br><span class="line">            recursion(tmp); <span class="comment">//情况一</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">int</span> tmp = rs;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; tmp &lt; sm;i ++)&#123;</span><br><span class="line">                tmp = lgt - (sm - tmp);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            recursion(tmp); <span class="comment">//情况一</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="终极优化，递归的转化"><a href="#终极优化，递归的转化" class="headerlink" title="终极优化，递归的转化"></a><strong>终极优化，递归的转化</strong></h4><p>上述代码仍然存在栈溢出的错误，所以还是递归的锅，显然，不是题目的测试样例刁钻，而是有些情况就是需要迭代几万次，即用递归是错误的实现方式。故转念一想，如何将递归转化为循环？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="number">4</span>  y=<span class="number">7</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">0</span>)=<span class="number">3</span>  <span class="comment">//【情况一】</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">3</span>)=<span class="number">6</span>       </span><br><span class="line"><span class="number">4</span>    <span class="number">6</span>-<span class="number">4</span>=<span class="number">2</span>      <span class="comment">//【情况二】      </span></span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">2</span>)=<span class="number">5</span>       </span><br><span class="line"><span class="number">4</span>    <span class="number">5</span>-<span class="number">4</span>=<span class="number">1</span>           </span><br><span class="line"><span class="number">4</span>    <span class="number">7</span>-(<span class="number">4</span>-<span class="number">1</span>)=<span class="number">4</span></span><br></pre></td></tr></table></figure><p>在此回顾上述的内容，发现其实代码中的递归已经没有复杂的处理逻辑，且退化成了驱动迭代的一种结构，所以显然可以改成循环。由于原递归可以连续执行，所以转为循环理所应当的 最外层是 while(true)来制造连续迭代，然后循环的退出可以用return 或者break都可以，对于两种情况的处理还是要分别采用不同的实现，综上，去掉递归改用循环的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(z == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span>((x == <span class="number">0</span> || y == <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> (x + y == z);</span><br><span class="line">    <span class="keyword">if</span>(x &gt; y)</span><br><span class="line">        <span class="keyword">int</span> t = x; x = y; y = t;</span><br><span class="line">    <span class="keyword">int</span> rs = y;</span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(x + rs == z|| x + y == z|| x + rs == z|| x == z|| rs == z|| z == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(rs &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> tmp = rs;</span><br><span class="line">        <span class="keyword">if</span>(x &lt;= rs)&#123;</span><br><span class="line">            <span class="keyword">while</span>(tmp &gt;= x)&#123;</span><br><span class="line">                tmp = tmp - x;</span><br><span class="line">                <span class="comment">//System.out.println((++cnt)+"\tb\tr("+x+","+tmp+")"+"\t"+z);</span></span><br><span class="line">                <span class="keyword">if</span>(x + tmp == z|| x + y == z|| x + tmp == z|| x == z|| tmp == z|| z == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            rs = tmp;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(tmp &lt; x)&#123;</span><br><span class="line">                tmp = y - (x - tmp);</span><br><span class="line">                <span class="keyword">if</span>(x + tmp == z|| x + y == z|| x + tmp == z|| x == z|| tmp == z|| z == <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            rs = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="精益求精"><a href="#精益求精" class="headerlink" title="精益求精"></a><strong>精益求精</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cc8gnelfcvf1rlq1h52kdnn5r9.png" alt></p><p>上述代码终于是得到了绿绿的通过，然而其执行速度却是最慢的，查看代码其实发现在判断停止的条件的语句上过于冗余了，然后有些变量还做了无畏的赋值，于是继续精简，最后得到如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(z == <span class="number">0</span>|| x + y == z) </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span>((x == <span class="number">0</span> || y == <span class="number">0</span>)) </span><br><span class="line">        <span class="keyword">return</span> (x + y == z);</span><br><span class="line">    <span class="keyword">if</span>(x &gt; y)&#123;</span><br><span class="line">        <span class="keyword">int</span> t = x; x = y; y = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rs = y;  </span><br><span class="line">    <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;  </span><br><span class="line">        <span class="keyword">if</span>(rs &lt;= <span class="number">0</span>) </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(x &lt;= rs)&#123;</span><br><span class="line">            <span class="keyword">while</span>(rs &gt;= x)&#123;</span><br><span class="line">                rs = rs - x;</span><br><span class="line">                <span class="keyword">if</span>( x + rs == z|| rs == z) </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(rs &lt; x)&#123;</span><br><span class="line">                rs = y - (x - rs);</span><br><span class="line">                <span class="keyword">if</span>( x + rs == z|| rs == z) </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码的执行速度得到了不少的提升，由原先的21ms提升到了 8ms，如下图所示，现在下图提交的所有代码中，我的代码还成了第二个和第五个柱状图即8ms和21ms的样例程序，想想还有点小激动。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cc8gvfkd1mp11ap41p1e5a71ja89.png" alt></p><h4 id="附第一梯队代码"><a href="#附第一梯队代码" class="headerlink" title="附第一梯队代码"></a><strong>附第一梯队代码</strong></h4><p>当然，对于第一梯队的代码，使用到了 gcd() 函数对最大公约数进行求解，技巧性比较强，速度当然也快。相比之下，我这里其实相当于实现了一下gcd函数。但一般的小白（比如我）是很难将这个问题抽象成求解最大公约数的，所以我的思路其实更笨一点，但也更符合思考的逻辑。<br>下面是第一梯队的样例代码和解读。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">canMeasureWater</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (z==x+y || z==x || z==y || z==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (x==<span class="number">0</span> || y==<span class="number">0</span> || z&gt;x+y || z%gcd(x, y)!= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b == <span class="number">0</span>? a : gcd(b, a%b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此种题解的解题思路，转自网络</p><blockquote><p>这道问题其实可以转换为有一个很大的容器，我们有两个杯子，容量分别为x和y，问我们通过用两个杯子往里倒水，和往出舀水，问能不能使容器中的水刚好为z升。那么我们可以用一个公式来表达：<br>z = m * x + n * y<br>其中m，n为舀水和倒水的次数，正数表示往里舀水，负数表示往外倒水，那么题目中的例子可以写成: 4 = (-2) * 3 + 2 * 5，即3升的水罐往外倒了两次水，5升水罐往里舀了两次水。那么问题就变成了对于任意给定的x,y,z，存不存在m和n使得上面的等式成立。根据裴蜀定理，ax + by = d的解为 d = gcd(x, y)，那么我们只要只要z % d == 0，上面的等式就有解，所以问题就迎刃而解了，我们只要看z是不是x和y的最大公约数的倍数就行了，别忘了还有个限制条件x + y &gt;= z，因为x和y不可能称出比它们之和还多的水。</p></blockquote><hr><p>由于这道题前前后后想了两天多，且期间不断地修正自己的想法，修改对应的实现，最后AC。虽然只是一道普通的题目，但以前还真没真真正正的不借助参考的独立思考过这样难度的题目，所以就在这里啰嗦了一大堆，看来以后还是得多独立思考，正应那句话：<strong>“不是不会做，而是不去想”</strong> 啊！</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> recursion </tag>
            
            <tag> stackoverflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在站点中添加Valine评论系统并修改评论样式</title>
      <link href="/article/c4f9.html"/>
      <url>/article/c4f9.html</url>
      
        <content type="html"><![CDATA[<p>最近在浏览<code>indigo</code>主题原作者的<a href="https://imys.net/" target="_blank" rel="external nofollow noopener noreferrer">网站</a>时，发现其评论系统已经更新为了Valine，看这个评论插件的第一眼就觉着一股浓浓的极简风，而且，十分重要的是，其无后端的设定！<br>或许有些地方跟原先的<code>友言</code>或者<code>多说</code>的插件相似，但由于历史原因今天都无法使用了，现在比较不错的评论系统有<code>disqus</code>还有基于<code>Github Issues</code>的<code>gitalk</code>以及<code>gitment</code>，disqus需要翻墙速度才可以接受，然后一开始我是使用的基于Github的gitment，但是用户必须登录Github账号后才可以留言，所以有一丝丝的局限。</p><a id="more"></a><p>出于其非常吸引人的<code>无需登陆</code>和<code>评论易管理</code>的特性，当然需要尝试一波了。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhjgrgq15lp1jal18fs9j18jq9.png" alt="image_1cbhjgrgq15lp1jal18fs9j18jq9.png-29.1kB"></p><blockquote><p><strong>Valine 的特点：</strong><br>无后端实现<br>高速，使用国内后端云服务提供商 LeanCloud 提供的存储服务<br>开源，自定义程度高<br>支持邮件通知<br>支持验证码<br>支持 Markdown</p></blockquote><h3 id="获取Valine需要引入的AppId和AppKey"><a href="#获取Valine需要引入的AppId和AppKey" class="headerlink" title="获取Valine需要引入的AppId和AppKey"></a><strong>获取Valine需要引入的AppId和AppKey</strong></h3><p>Valine的存储是基于LeanCloud的，所以首先需要注册一个LeanCloud账号，然后登陆创建一个应用：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhjombv14pe1lodp411c4n137lm.png" alt="image_1cbhjombv14pe1lodp411c4n137lm.png-37kB"></p><p>点击设置按钮，进入应用的设置页面</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhk4488apsdtvefn10bo10c21g.png" alt="image_1cbhk4488apsdtvefn10bo10c21g.png-14.9kB"></p><p>找到应用的APPID和APPKEY，复制备用</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhk1c8toar24b1i421v52lpj13.png" alt="image_1cbhk1c8toar24b1i421v52lpj13.png-43.1kB"></p><h3 id="整合Valine到Hexo的主题中，此处为indigo"><a href="#整合Valine到Hexo的主题中，此处为indigo" class="headerlink" title="整合Valine到Hexo的主题中，此处为indigo"></a><strong>整合Valine到Hexo的主题中，此处为indigo</strong></h3><p>Valine对Hexo的支持可以再<a href="https://valine.js.org/hexo/" target="_blank" rel="external nofollow noopener noreferrer">此页面</a>中查看，对于Hexo一般大同小异，由于之前添加过gitment，所以官方扩展方式都没看，下面是我自己的添加方式，应该和官方的差不多。</p><ul><li><strong>在indigo\layout_partial\plugins目录下添加valine.ejs</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (theme.valine )&#123; %&gt;</span><br><span class="line">    &lt;!-- Valine Comments --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"comments vcomment"</span> id=<span class="string">"comments"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="/</span><span class="regexp">/cdn1.lncld.net/</span><span class="keyword">static</span>/js/<span class="number">3.0</span><span class="number">.4</span>/av-min.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script src="</span><span class="comment">//unpkg.com/valine@latest/dist/Valine.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line">    &lt;!-- Valine Comments script --&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> GUEST_INFO = [<span class="string">'nick'</span>,<span class="string">'mail'</span>,<span class="string">'link'</span>];</span><br><span class="line">        <span class="keyword">var</span> guest_info = <span class="string">'&lt;%= theme.valine.guest_info %&gt;'</span>.split(<span class="string">','</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> GUEST_INFO.indexOf(item) &gt; <span class="number">-1</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">new</span> Valine(&#123;</span><br><span class="line">            el: <span class="string">'#comments'</span>,</span><br><span class="line">            notify: <span class="string">'&lt;%= theme.valine.notify %&gt;'</span> == <span class="string">'true'</span>,</span><br><span class="line">            verify: <span class="string">'&lt;%= theme.valine.verify %&gt;'</span> == <span class="string">'true'</span>,</span><br><span class="line">            appId: <span class="string">"&lt;%= theme.valine.appId %&gt;"</span>,</span><br><span class="line">            appKey: <span class="string">"&lt;%= theme.valine.appKey %&gt;"</span>,</span><br><span class="line">            avatar: <span class="string">"&lt;%= theme.valine.avatar %&gt;"</span>,</span><br><span class="line">            placeholder: <span class="string">"&lt;%= theme.valine.placeholder %&gt;"</span>,</span><br><span class="line">            guest_info: guest_info.length == <span class="number">0</span> ? GUEST_INFO : guest_info,</span><br><span class="line">            pageSize: <span class="string">"&lt;%= theme.valine.pageSize %&gt;"</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Valine done!"</span>)</span><br><span class="line"> </span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;!-- Valine Comments end --&gt;</span></span><br><span class="line"><span class="regexp">&lt;% &#125; %&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">注意：上述的 new Valine&#123;&#125; 中的变量参见 https:/</span><span class="regexp">/valine.js.org/</span>configuration/</span><br></pre></td></tr></table></figure><ul><li><strong>修改indigo\layout_partial\post\comment.ejs，添加上述文件</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if(post.comments)&#123; %&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%- partial(&#39;..&#x2F;plugins&#x2F;valine&#39;) %&gt; </span><br><span class="line">    </span><br><span class="line">&lt;%&#125; %&gt;</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><ul><li><strong>在indigo_config.yaml中添加变量的赋值</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">注意：valine.ejs中的变量部分，theme.xxx</span><br><span class="line">凡是使用theme.xxx的变量都需要在_config.yaml中被赋值，所以，按照我这里第一步中valine.ejs的写法，在_config中的初始配置代码应该如下：</span><br><span class="line"></span><br><span class="line">valine: </span><br><span class="line">  notify: true</span><br><span class="line">  verify: true</span><br><span class="line">  appId: xxxxxxxxxxxxxxxxx 第一步中得到的appId</span><br><span class="line">  appKey: xxxxxxxxxxxxxxx 第一步中得到的appKey</span><br><span class="line">  avatar: monsterid</span><br><span class="line">  placeholder: 请在这里书写你想说的话~</span><br><span class="line">  guest_info: nick,mail,link</span><br><span class="line">  pageSize: 10</span><br><span class="line">  </span><br><span class="line">注意：上述代码段有严格的格式要求，冒号后边有个空格，还有第二级变量需要一个2字符的缩进</span><br></pre></td></tr></table></figure><h3 id="修改valine评论空间的风格样式"><a href="#修改valine评论空间的风格样式" class="headerlink" title="修改valine评论空间的风格样式"></a><strong>修改valine评论空间的风格样式</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhld1glqmg1v0im8u1h1s65q3q.png" alt="image_1cbhld1glqmg1v0im8u1h1s65q3q.png-19.5kB"></p><p>上述是默认的主题样式，比较白开水风格，个人感觉太单调，而且背景是透明的，如果你的站点有背景图案，可能或导致视觉混乱，所以在这里尝试查找修改风格的方法。</p><ul><li><strong>头像部分</strong></li></ul><p>官网的说明：<a href="https://valine.js.org/avatar/，有多种样式，作用于变量" target="_blank" rel="external nofollow noopener noreferrer">https://valine.js.org/avatar/，有多种样式，作用于变量</a> <code>avatar</code><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhlj0759eq1sll64t1h1r1g4c47.png" alt="image_1cbhlj0759eq1sll64t1h1r1g4c47.png-42.2kB"></p><ul><li><strong>邮件提醒</strong></li></ul><p>这部分不过多陈述，请移步官方介绍：<a href="https://valine.js.org/notify/" target="_blank" rel="external nofollow noopener noreferrer">https://valine.js.org/notify/</a></p><ul><li><strong>添加底层容器块，保持评论与全站的风格一致</strong></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">主要是修改valine.ejs中的代码，在初始化valine插件之前添加下面的&lt;section&gt;内容</span><br><span class="line"></span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.valine )&#123; %&gt;</span><br><span class="line">&lt;section <span class="class"><span class="keyword">class</span></span>=<span class="string">"comments"</span> id=<span class="string">"comments"</span>  style=<span class="string">"margin-top:40px;padding:1px 15px 1px 10px;background-color:rgba(255,255,255,0.7);box-shadow: 0px 0px 20px #bbbbbb;border-radius: 5px;"</span>&gt;</span><br><span class="line"></span><br><span class="line">... 原来的内容 ...</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/section&gt;</span></span><br></pre></td></tr></table></figure><h3 id="最终的效果"><a href="#最终的效果" class="headerlink" title="最终的效果"></a><strong>最终的效果</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhojs7e1l3i1lb75lkd0ee235e.png" alt="image_1cbhnr8sg1uvf1qom14pg1pdq6o4k.png-407.2kB"></p><h3 id="管理已有的评论"><a href="#管理已有的评论" class="headerlink" title="管理已有的评论"></a><strong>管理已有的评论</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbhovmjv10kht7nte1ce5mnn5r.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Valine </tag>
            
            <tag> 第三方评论插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenOrd-面向大规模图布局的开源算法-研读</title>
      <link href="/article/3cd5.html"/>
      <url>/article/3cd5.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cb93ulb8ngvs86jjo1r8l1u899.png" alt="image_1cb93ulb8ngvs86jjo1r8l1u899.png-138.6kB"></p><pre><code>原文名：OpenOrd: An Open-Source Toolbox for Large Graph Layout中译名：OpenOrd-面向大规模图布局的开源算法刊载源：出版源 Visualization &amp; Data Analysis , 2011 , 7868 (3) :-作者们：Shawn Martin a , W. Michael Brown b  机构名：    - Sandia National Laboratories [a] 桑迪亚国家实验室，US    - Oak Ridge National Laboratories [b] 橡树岭国家实验室，US</code></pre><a id="more"></a><p>ABSTRACT</p><p>我们创作了一个用于绘制大型无向图的开源工具箱。<br>这个工具箱是基于一个以前实现的闭源算法，即VxOrd。<br>我们的工具箱，我们称之为OpenOrd，通过合并切割<code>incorporating edge-cutting</code>、多级方法<code>multi-level approach</code>、平均链接聚类<code>average-link clustering</code>和并行实现<code>parallel implementation</code>，将VxOrd的功能扩展到大型图形布局。<br>在每个层次上，顶点都使用力导向布局和平均链接聚类来分组。<br>分组的顶点会被重新绘制，上述过程不断重复。<br>When a suitable drawing of the coarsened graph is obtained, the algorithm is reversed to obtain a drawing of the original graph.<br>在得到粗化图<code>coarsened graph</code>的一幅合适的图时，该算法得到了相反的结果，得到了原始图的图像。<br>这种方法导致了<strong>包含本地和全局结构</strong>的大图形的布局。<br>本文给出了该算法的详细描述。<br>给出了使用超过600 K个节点的数据集的例子。<br>代码可在<a href="http://www.cs.sandia.gov/smartin上获得。" target="_blank" rel="external nofollow noopener noreferrer">www.cs.sandia.gov/smartin上获得。</a></p><p>关键词：多级<code>Multilevel</code>、力导向、并行、大规模的图形布局<code>1</code>。</p><h2 id="INTRODUCTION"><a href="#INTRODUCTION" class="headerlink" title="INTRODUCTION"></a>INTRODUCTION</h2><p>用于可视化关系数据的图绘制，通常在二维空间中<code>1,2</code>。<br>图绘制的一些应用场景包括：社会网络分析<code>3</code>、科学文献分析<code>4,5</code>、地图制作<code>6</code>和生物信息学<code>7,8</code>。<br>有各种各样的算法可供图绘制，每一种算法都具有不同优化的美学标准<code>aesthetic criteria</code>。<br>一些美学标准的例子包括：尽量减少边的数量，最小化总边长度，并最大化顶点之间的分离。<br>对于用直线<code>straight line</code>边缘绘制的无向图，最常用的算法之一是力导向布局<code>9-13</code>。</p><p>在本文中，我们记录了一种用于绘制大型真实世界<code>real-world</code>图的图绘制算法。<br>我们的算法采用了边切<code>edge-cutting</code>、平均链接<code>average-link</code>聚类、多级图粗化<code>multilevel graph coarsening</code>，以及基于模拟退火的力-导向方法的并行实现。<br>已存在的力-导向布局的相关算法，包括采用多级方法的算法<code>13-16</code>;节点聚类的算法<code>16-18</code>;使用并行GPU架构实现的算法<code>19,20</code>。<br>然而，我们的算法是唯一一个包含所有这三个想法的算法：多级的、节点聚类的以及并行的实现（注意，我们的并行性是基于聚类的，而不是基于GPU的）。<code>is cluster based, instead of GPU based</code><br>此外，我们还引入了一种用于边缘切割的启发式<code>heuristic</code>方法，它的设计目的是为了使图结构可视化，而这些图结构可能没有理想的度分布（通常在真实数据的图中找到）。</p><p>我们的算法是基于一种叫做VxOrd的力-导向算法。<br>此新版本，OpenOrd，将在接下来的几页中进行描述。<br>在第2部分中，我们给出了修改VxOrd的动机。<br>在第3部分中，我们描述了算法的各个部分，包括力-导向的布局;<br>并行布局(3.2);<br>递归地<code>recursive</code>图粗化(3.3);<br>平均链接聚类<code>and average-link clustering</code>(3.4)。<br>在第4部分中，我们演示了我们的算法的一些属性，使用应用程序到<code>applications to</code>几个真实的数据集，包括一个659 K顶点Wikipedia文章的数据集。<br>最后，在第5部分中，我们提供了我们的结论。<br>OpenOrd的代码可在<a href="http://www.cs.sandia.gov/smartin中获得。" target="_blank" rel="external nofollow noopener noreferrer">http://www.cs.sandia.gov/smartin中获得。</a></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="MOTIVATION-动机"><a href="#MOTIVATION-动机" class="headerlink" title="MOTIVATION 动机"></a>MOTIVATION 动机</h2><p>OpenOrd是一种力-导向的布局算法，专门用于处理非常大的图结构，如sci-科学文献引用分析<code>4,5</code>中遇到的。<br>它是基于一个被称为VxOrd<code>22</code>的实现了“Frutcherman-Reingold思想”<code>11</code>的算法，该算法在科学引文分析中被使用<code>23-25</code>，并在生物信息数据的分析中被使用<code>26-28</code>。<br>OpenOrd算法展示了我们将VxOrd扩展到非常大的图结构（大于100 K个顶点）的努力。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cb93ulb8ngvs86jjo1r8l1u899.png" alt="image_1cb93ulb8ngvs86jjo1r8l1u899.png-138.6kB"><br>图1.全局纠缠<code>Tangled global</code>的结构。<br>左边（a）显示的是瑞士卷<code>Swiss roll</code>数据集，由瑞士卷副本<code>manifold</code>随机抽取的2万个点组成<code>19,30</code>。<br>中间（b）显示的是一个由使用VxOrd的20个最近的邻居 这种算法从瑞士卷中获得的力-导向布局。<br>只有节点被绘制了出来，图被着色以说明全局结构的纠缠<code>tangling</code>。<br>右边（c）中显示了正确绘制的图结构，使用OpenOrd的多级版本生成。</p><p>我们已经确定了将VxOrd力-导向布局算法扩展到大图形的三个问题，在这一节中将其描述为我们在第3部分中对后续算法的动机。<br>首先，算法能够正确地揭示布局的全局结构，这种正确性随着图结构的增大而减小。<br>这种正确性无疑也会随着节点的度分布而变化，但即使是相对简单的网格状图也很明显。<br>为了说明这一现象，我们使用了最初在非线性维度<code>nonlinear dimension</code>中引入的瑞士卷数据集<code>29,30</code>。<br>这个数据集的设计目的是为了证明线性方法的不足之处（因为线性方法不能毫无错误地投射出瑞士卷）。<br>在我们的例子中，我们只使用这个数据集作为一个例子，我们的算法是用来绘图，而不是降维的。<br>We imposed a graph on 20,000 points sampled from the Swiss roll manifold using 20 nearest neighbors and drew the graph using VxOrd.<br>我们用’邻居数=20’的配置从瑞士卷数据中抽取了2万个点生成图结构，并使用VxOrd进行了绘制。<br>结果如图1（a，b）所示。<br>在以前的工作中<code>13,31</code>也注意到，力-导向的布局无法正确地揭示全局结构，在这里显示了可以使用多级方法来减轻这种影响。<br>因此，我们在OpenOrd中包含了一个多级策略。</p><blockquote><p>无标度<code>scale-free network</code>网络具有严重的异质性，其各节点之间的连接状况（度数）具有严重的不均匀分布性：网络中少数称之为Hub点的节点拥有极其多的连接，而大多数节点只有很少量的连接。少数Hub点对无标度网络的运行起着主导的作用。从广义上说，无标度网络的无标度性是描述大量复杂系统整体上严重不均匀分布的一种内在性质。<br>现实世界的网络大部分都不是随机网络，少数的节点往往拥有大量的连接，而大部分节点却很少，一般而言他们符合zipf定律，(也就是80/20马太定律)。将度分布符合幂律分布的复杂网络称为无标度网络。</p></blockquote><p>其次，我们发现使用力-导向布局对大规模真实图结构进行处理，通常会导致视觉上不吸引人的布局。<br>通常这些图都是稀疏的，但仍然有良好的关连（不是无标度的），因此得到的图看起来是完全<code>fully</code>连接的。<br>图2（a）中显示了一个使用6147个节点和61646边的酵母微阵列数据的例子（在第4节中详细描述）<br>尽管这张图只有61646条边（可能只是全连接边数的0.3%），但它看起来是完全连通的。<br>为了鼓励更具有视觉吸引的布局，我们使用了一个边缘切割<code>edge-cutting</code>策略来鼓励节点的聚集。<br>这可以看作是在力-导向布局中两个相互竞争的力量之间的权衡，在第3.1节中描述。</p><p>最后，力-布局的Frutcherman-Reingold方法有一个较高的运行时间O(n2)，这当然是力-导向布局在大规模图结构中应用的一个主要约束。<br>使用基于网格的密度计算，并采用多级方法，可以改进运行时间。<br>我们实现了上述两个想法，还包括在OpenOrd中使用并行计算的想法。</p><h2 id="ALGORITHM-算法描述"><a href="#ALGORITHM-算法描述" class="headerlink" title="ALGORITHM 算法描述"></a>ALGORITHM 算法描述</h2><p>第2节中提到的算法，OpenOrd是基于Frutcherman-Reingold算法的力-导向布局算法<code>11</code>，以前这种算法是以VxOrd来实现的<code>22</code>。<br>为了提供算法背景，我们在这里描述了这个VxOrd算法，并在下面的小节中描述了对其的改进。<br>假设我们有一个无向加权图G=(V,E)，其中顶点由V={v1…vn}给出,边由E=E{eij}给出<br>W=(wij)是与图G相对应的邻接矩阵<code>adjacency matrix</code>，所以边eij有权重wij。<br>由于这个图是无定向的，我们知道wij=wji，所以矩阵W是对称的。</p><p>OpenOrd的目标是在二维空间中绘制图G。Xi=(xi1，xi2)表示vi在平面上的位置。<br>OpenOrd通过尝试求解下列算式的最小值：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cb9615jc1n5618ro145h1blvglm.png" alt="image_1cb9615jc1n5618ro145h1blvglm.png-5kB"></p><p>Dxi表示点xi附近x1…xn的密度。<br>1式的算式和包含了一个引力和斥力的项。<br>引力部分Σj(wij ·d(xi,xj)2) 试图通过wij将具有强关联的顶点组合在一起。<br>排斥项Dxi试图把顶点推到平面上密度较小的地方。</p><p>式（1）的最小化是一个困难的非线性问题。<br>出于这个原因，我们使用一个基于模拟退火的贪婪的优化过程。<br>我们的过程是贪婪的，我们通过优化内部和<code>inner-sum</code>Σj(wij·d(xi,xj)2)+Dxi来更新每个顶点的位置，同时修正其他顶点的位置。<br><strong>所有的顶点最初都放在原点处</strong>，并且图中的每个顶点都进行重复更新从而完成优化的一个迭代。<br>迭代是通过一个模拟退火思想的流程来控制的，它由五个不同的阶段组成：液化<code>liquid</code>，膨胀<code>expansion</code>，冷却<code>cool-down</code>，紧缩<code>crunch</code>，和慢煮<code>simmer</code>。</p><p>在退火流程的每一个阶段，我们都改变了几个优化参数：温度、吸引力和阻尼<code>damping</code>。<br>这些参数控制了顶点被允许移动的距离。<br>在算法的每一步中，我们都计算两个可能的顶点移动。<br>第一个可能的移动是一个随机的跳跃，它的距离是由温度决定的。<br>第二种可能的移动是经过分析计算的（称为“障碍跳跃<code>22</code>”）。<code>barrier jump</code><br>这个移动被作为顶点邻居的加权质心<code>weighted centroid</code>来计算。<br>阻尼乘数<code>damping multiplier</code>决定了顶点相对于上述中心被允许移动的距离，引力参数的作用是进一步加强上述导致移动的作用。<code>the attraction factor weights the resulting energy to determine the desirability of such a move.</code><br>在这两种可能的移动中，我们选择的移动结果是最低的内和能量 Σj(wij·d(xi,xj)2)+Dxi。</p><p>退火流程的各阶段分配是由每个阶段花费的时间决定的，并且通过调整各种参数来确定优化的行为。<br>默认的流程下，液体<code>liquid</code>阶段花费了大约25%的时间，膨胀阶段25%，冷却阶段25%，收缩<code>crunch</code>阶段10%，慢煮<code>simmer</code>阶段15%。<br>liquid、expansion和cooldown的阶段都使用相同的温度，但使用不同的吸引参数和阻尼乘数。<br>慢炖<code>simmer</code>阶段使用较低的温度（大约是liquid、expansion和cooldown中所使用的温度的1/4），以及较低的吸引力和阻尼。<br><strong>退火流程各阶段的分配是通过对各种数据集（包括第4节中描述的酵母数据集）的广泛实验来确定的</strong>。这些实验是通过一个交互式的可视化环境进行的，这样就可以在退火过程的每个阶段观察到参数的影响。<br>从定性<code>Qualitatively</code>上讲，膨胀阶段在吸引力和阻尼上允许顶点最大的移动，液体阶段允许下一个最大的运动<code>the liquid stage allows the next largest movements</code>，冷却、收缩和慢炖的阶段都限制定点的移动。</p><p>最后，我们使用基于网格的方法来计算密度项Dxi。<br>通常情况下，密度计算应该是O(n2)，但是通过使用网格来进行密度计算，我们可以将成本降低到O(n)，这是得益于我们计算中使用的许多网格框<code>grid boxes</code>，不可避免的内存使用量会增加。<br>然而，这种粗化<code>coarsening</code>可能是导致布局不准确的原因，因为在网格线上，密度会随着时间的变化而变化。<br>由于这个原因，在<strong>最后的慢炖阶段中不使用密度网格。</strong></p><h3 id="Edge-Cutting-边切割"><a href="#Edge-Cutting-边切割" class="headerlink" title="Edge-Cutting 边切割"></a>Edge-Cutting 边切割</h3><p>为了产生视觉上吸引人的布局，我们开发了一种启发式的<code>heuristic</code>，允许用户控制布局中节点聚类和空白区域的数量。<br>为了控制节点聚类，我们的启发式方法在方程（1）中影响了斥力和引力部分的相对重要性，为了控制空白，我们允许在目标函数的优化过程中忽略某些长边<code>long edges</code>。<br>事实上，节点聚类和空白都可以通过忽略或切割长边来控制。</p><p>正如前面所提到的，方程（1）的目标函数中的Σj(wij·d(xi,xj)2)是为了吸引具有较大边权重<code>nodes with large weight connections</code>的节点，而Dxi是排斥的，并且不鼓励高平均节点密度，和顶点聚集。<br>这两个部分的相对重要性决定了布局中顶点聚集的程度。<br>如果引力项占主导地位，那么就会减少聚类的数目;<br>如果排斥项占主导地位，就会出现更多的聚集现象。<br>在优化过程中切割长边会降低引力项的重要性，并增加了排斥项的重要性，这种作用在布局中可以使得边切割对节点的聚集进行控制。</p><p>空白的空间可以由我们在计算中使用的长边数控制。<br>Edges that are long but have large weight can exert undue influence on distant clusters, causing two groups to be placed on top of each other when a more appealing layout might be obtained if they were allowed to separate.<br>边很长但有较大权重的边会对远处的集群施加不适当<code>undue</code>的影响，在一个更吸引人的允许两个聚簇分开的布局中，两个聚簇会被重合的放置在一起。<br>在优化过程中切割长边允许聚簇分离。<br>同时还改进了最终的绘图，因为这些边扩展了整个布局，因此模糊<code>obscure</code>了绘图中更精细<code>finer</code>的结构。<br>（这种效果可以通过在最终的渲染中使用边的透明性<code>transparency</code>来增强，但是必须在计算中出现，以避免聚簇会放置于彼此之上。）</p><p>OpenOrd的边切割参数从0到1指定。<br>一个边切割参数值为0对应于标准的Frutcherman-Reingold布局算法（没有切割），而边切值为1对应于侵略性<code>aggressive</code>的切割。<br>在退火流程的expansion和cooldown阶段允许进行边切割。<br>在这两个阶段的开始阶段，一个阈值被指定为图中两个节点之间可能的最大距离的百分比。<br>这个百分比是由边切参数控制的，值为0是最大距离的100%，1是最大距离的0%。<br><strong>边切割受制于每个节点必须至少有一个边的约束条件。</strong><br>在expansion和cooldown阶段，如果两点间的距离大于阈值，就会被切断。</p><p>边切割参数与将要切割的边的比例没有对应关系。<br>根据输入图的不同，边切割参数可能没有什么效果，因为在优化过程中，图可能会有很长的边（通常是网状结构<code>meshes</code>的情况）。<br>然而，对于真实世界的图结构，边切割参数可以对最终图的布局产生重大影响，并将在第4部分中进行探讨。</p><h3 id="Parallel-Force-Directed-Layout-并行力-导向布局"><a href="#Parallel-Force-Directed-Layout-并行力-导向布局" class="headerlink" title="Parallel Force-Directed Layout 并行力-导向布局"></a>Parallel Force-Directed Layout 并行力-导向布局</h3><p>OpenOrd可以以串行和并行的方式在计算机上运行。<br>并行版本类似于串行版本。<br>两者都使用相同的贪婪更新，并遵循相同的退火流程。<br>然而，在并行版本中，更新是并行执行的，而不是顺序的。</p><p>在OpenOrd中，并行强制布局算法首先为每个处理器分配一个随机的非重叠<code>non-overlapping</code>子集的图结构。<br>处理器一直跟踪(<code>tracking</code>)它所分配的顶点以及顶点的全部邻居节点。<br>所有的处理器都能跟踪每个顶点的位置，这样每个处理器就可以维护一个相同的网格密度副本。</p><p>每个处理器负责将其指定顶点按优化目标函数方程(1)进行优化。因为每个处理器知道指定顶点的位置,以及顶点的邻居节点的位置,所以可以使用相同的用于串行版本的贪婪的更新顶点位置的算法。<br>在每个顶点更新之后，位置信息在处理器之间交换，然后各进程继续进行计算任务。</p><p>除了增加计算速度之外，OpenOrd的并行版本还有一个优势，即它可以在许多处理器上散布一个非常大的图形，从而使用具有大量有效内存的计算机。<br>这是可行的，因为任何给定的图形都有比顶点多得多的边。<br>此外，通过保持相同的贪婪更新程序和模拟退火流程，OpenOrd的串行和并行版本的结果是相似的。<br>这两种算法的性能以及输出的差异在第4.2节中讨论。</p><h3 id="Multilevel-Graph-Layout-多级图布局"><a href="#Multilevel-Graph-Layout-多级图布局" class="headerlink" title="Multilevel Graph Layout 多级图布局"></a>Multilevel Graph Layout 多级图布局</h3><p>使用OpenOrd的并行策略允许非常大的图形进行布局。<br>边切割增强了布局的视觉吸引力。<br>然而，在使用第2节中描述的瑞士卷数据集进行实验时，产生不正确的全局结构的可能性仍然存在。<br>为了解决这个问题，我们采用了Walshaw<code>13</code>的多级方法来实现OpenOrd。<br>Walshaw的程序如下:<br>首先，一组图G0=G,G1..G是用一个随机的粗化过程产生的<code>32</code>。<br>在粗化过程中，相邻的顶点是随机合并的，如果两个相邻的相邻点有一个共同的邻居，那么他们的边权值就会被加到这两节点间的边权值中来。<br>这个过程会重复，直到得到一个足够小的图GL。<br>图GL是用力-导向算法绘制的。<br>GL的绘制中顶点的放置位置被用作绘制图GL-1的起始点。<br>例如，如果GL-1中的顶点u和v在GL中被合并成w，那么u和v就会被放置在以前的GL图中的w的位置。<br>这个里-导向算法再次应用于获得的图GL-1，并重复该过程。</p><p>沃尔肖<code>Walshaw</code>的方法非常快，并且被证明在大图上很好地工作<code>13</code>。<br>我们使用Walshaw的方法进行了额外的改进。<br>我们使用的是基于聚集的粗化过程（下面描述），而不是随机的粗化过程。<br>当然，我们也使用OpenOrd作为力导向的布局。<br>但是我们将使用前一段中概述的Walshaw的过程。</p><p>使用我们的力导向布局算法需要额外的调整来适应模拟退火流程，并允许在多级方法中使用边切割。<br>在获得了一系列粗化图G0…GL之后，<br>我们用标准退火流程，生产出带有default的边切割的GL的布局。<br>在细化过程中，我们按Walshaw的叙述进行顶点放置，再次使用default的边切割，但是修改我们的退火流程的分配以减少<code>avoid</code> liquid阶段和最小化expansion阶段。<br>在细化阶段，我们也去掉<code>eliminate</code>了simmer的阶段。<br>最后的布局是使用更激进的边切割，并且包含simmer阶段。<br>令人惊讶的是，我们的实验表明，我们的多级布局方法适用于从6K到850K个顶点的数据集，甚至对这些不同数据集使用了相同的退火流程/边切割参数。<br>在第4节中描述了所执行的实验和数据集。</p><h3 id="Average-Link-Clustering-平均链接聚类"><a href="#Average-Link-Clustering-平均链接聚类" class="headerlink" title="Average-Link Clustering 平均链接聚类"></a>Average-Link Clustering 平均链接聚类</h3><p>在我们的多级布局算法中，我们使用平均链接<code>Average-Link</code>聚类来提供粗化图G0=G,G1…GL.<br>我们的聚类算法是基于一个平均链接聚类<code>agglomerative</code>模型，在此模型中，我们使用两点之间的边权值和两点之间的距离来产生顶点的聚簇。<br>距离是由我们的力-导向布局算法从图的布局中获取的。<br>一旦确定了聚簇，我们就合并该聚簇中的所有顶点，从而在新的粗图中得到一个顶点。<br>边根据前面描述的方法合并。</p><p>在描述我们的方法时，让我们假设我们对G0进行粗化以获得G1。<br>获取其余的粗化图是使用相同的过程完成的。<br>我们的聚类算法的第一步是用我们的力导向布局算法加之最大化的边切割来绘制G0。<br>这个步骤为我们提供了一个代理<code>proxy</code>表示，它可以用来得到顶点之间的距离，除了定义G 0的边权值之外。<code>in addition to the edge weights defining G0 .</code><br>最大的边切割鼓励布局算法生成一个自然的聚簇表示（参见第4.3节）。</p><p>接下来，我们将生成一个新的无向加权图G0<del>，它的边是根据G0布局中绘制的距离计算的。<br>在此布局中的边包括没有被布局算法裁剪的边，以及G0中每个节点的最大权边。<br>我们令布局包含最大的权边，以确保图的连通。<br>G0</del>中的边权值不再是G0中提供的原始边权值;<br>它们现在是G0~中互相连接的顶点之间的距离。</p><p>我们的导出<code>derived</code>图G0~可以在聚类算法中使用。<br>我们使用的算法是一种平均链接层次<code>hierarchical</code>聚类的形式<code>33,34</code>。<br>在这个算法中，每个顶点最初被分配给一个特定<code>unique</code>的聚簇。<br>聚簇与相邻的聚簇会在稍后进行合并，合并与否用聚簇的几何中心<code>centroids</code>之间的距离来确定。<br>习惯上，这个过程是重复的，直到所有顶点都被合并到一个聚簇中。<br>然而，在我们的算法中，我们提供了一个距离阈值，之后我们停止形成新的聚簇。<br>在平均链接聚类中，这个距离阈值由用户提供。</p><p>或者，阈值可以由OpenOrd自动选择。<br>The automatic selection is done by locating the point on the plot of normalized rank vs. normalized distance in e G 0 at which the slope is 45 .<br>自动选择是通过在G0<del>中定位顶点来实现的，比较顶点在G0</del>中规约化的rank值和规约化的距离。此时斜率为45度.<br>Rank是通过对G0<del>中的边值<code>edge values</code>进行排序来计算的;<br>规约化的rank是将rank值规约到0</del>1之间。<br>距离是由G0~的实际边值<code>actual edge value</code>给出的;<br>规约化的距离是将距离规约到从0到1。<br>对于真实世界的数据集，我们已经发现了规约化的rank和距离曲线<code>curve</code>，当斜率为45度时，通常可以为平均链接聚类提供一个良好的截止点（这个阈值在规约化后通常在0.9和0.95之间）。</p><h2 id="EXAMPLES-示例"><a href="#EXAMPLES-示例" class="headerlink" title="EXAMPLES 示例"></a>EXAMPLES 示例</h2><p>我们在几个数据集上对OpenOrd进行了基准测试。<br>如第2节所述，我们使用了在酵母细胞周期研究中产生的微阵列基因表达数据集进行实验<code>35</code>。<br>这个数据集之前已经用作为OpenOrd的前身的VxOrd算法进行了测试<code>22,27</code>。<br>数据包括对18个时间点的6 147个基因的同步<code>simultaneous</code>测量。<br>A graph structure was imposed on the data by taking for each gene the top 10 genes most highly correlated over time.<br>对每一个基因的数据构造<code>imposed</code>一个图结构，随着时间的推移，这10个基因高度相关。<br>这产生了一个有6,147个节点和61646个边的图结构。<br>我们使用酵母数据集来演示OpenOrd的边切割的效果和使用并行计算的效果。</p><p>我们还使用了瑞士卷数据集的一个替代品<code>incarnation``29,30</code>，替代品拥有2000个点，并使用每个点的20个最接近的邻居来构造图结构。<code>a graph imposed using the 20 nearest neighbors of each point</code><br>我们使用瑞士卷数据集来检查OpenOrd的多级<code>multilevel</code>功能。<br>此外，我们还使用了来自维基媒体基金会（<a href="http://www.wikimedia.org）的一个大数据集来进一步测试多级功能。" target="_blank" rel="external nofollow noopener noreferrer">http://www.wikimedia.org）的一个大数据集来进一步测试多级功能。</a><br>这个数据集是由B.Herr等人<code>36</code>在2007年使用维基百科的文章收集和处理的（参见<a href="http://scimaps.org/maps/wikipedia）。" target="_blank" rel="external nofollow noopener noreferrer">http://scimaps.org/maps/wikipedia）。</a><br>该数据集由659,388维基百科文章组成，这些文章连接了16,582,426个超链接。</p><p>最后，我们在OpenOrd上执行了许多附加数据集来对参数进行测试。<br>These datasets include 8,712 journals from the year 2003 taken from Thomson Scientific (<a href="http://scientific.thomson.com/isi" target="_blank" rel="external nofollow noopener noreferrer">http://scientific.thomson.com/isi</a>) Institute of Scientific In- formation (ISI) Journal Citation Reports and linked with 98,705 edges;<br>这些数据集包括来自2003年Thomson-Scientific（<a href="http://scientific.thomson.com/isi）科学信息研究所（ISI）期刊引文报告中获得的8" target="_blank" rel="external nofollow noopener noreferrer">http://scientific.thomson.com/isi）科学信息研究所（ISI）期刊引文报告中获得的8</a> 712份期刊，并连接出了98,705条边<code>37</code>;<br>集中于过去25年里从三军情报局获取的有关固态照明<code>solid-state-lighting</code>的32,776个文件数据集，并将其与222,626个共同引用连接起来<code>38</code>;<br>从2003年第一季度开始的，在ISI数据库中收集的218716个元素数据集，并使用了1821,976的共同引用相似性<code>co-citation similarities</code>;<br>最后是2004年在ISI数据库中使用的849,888篇文章数据集，并使用了5,843,729的联合引用相似性。<br>我们使用这些数据集来研究各种参数对不同大小和类型的数据集的影响。</p><h3 id="Edge-Cutting-边切割-1"><a href="#Edge-Cutting-边切割-1" class="headerlink" title="Edge-Cutting 边切割"></a>Edge-Cutting 边切割</h3><p>边切割在OpenOrd中，使用一个从0到1的值来指定。<br>一个边切值为0对应于标准的Frutcherman-Reingold布局算法（没有切割），而边切值为1对应于侵略性的切割。<br>侵略性<code>Aggressive</code>的切割可以促进顶点聚集，但不会把每一条边都砍掉。<br>在OpenOrd中，边切割的默认值是0.8。<br>在图2中，我们演示了边切割对Spellman’s酵母数据的布局的影响。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cba43ac91sld7mchjc1kn1dgc9.png" alt="image_1cba43ac91sld7mchjc1kn1dgc9.png-181.3kB"></p><p>图2，酵母数据集上的边切割。<br>从左到右显示，我们有Spellman’s酵母微阵列数据集<code>35</code>的布局：<br>(a)没有边切割(参数值0)，(b)默认切割(参数值0.8)，和(c)最大切割(参数值1)。<br>边切割的影响参数对目标函数（方程1）的吸引力和排斥力影响如图(d)所示。<br>边切割参数在x轴上从0到1变化，在y轴上显示归一化的能量值（斥力引力两项）。<br>正如在第3.1节中所描述的，当边被切割时，吸引力项就会减少，从而增加排斥项，从而鼓励顶点聚集。</p><p>为了在图2(D)中生成图，我们对酵母数据的11个布局计算了总吸引项Σj(wij·d(xi,xj)2)和总排斥项Dxi，使用边切割参数值0, 0.1, …, 0.9, 1。<br>这些工作比较了规约在0和1之间的吸引项和排斥项的影响。<br>正如在第3.1节中所讨论的，当边被切割时，吸引力项就会减少，从而允许增加排斥项，从而鼓励聚集。<br>同样如在第3.1节中所讨论的，切割长边在图中提供了额外的空白区域。<br>这些效果在图2（a-c）中很明显。</p><h3 id="Serial-vs-Parallel-串行和并行"><a href="#Serial-vs-Parallel-串行和并行" class="headerlink" title="Serial vs. Parallel 串行和并行"></a>Serial vs. Parallel 串行和并行</h3><p>OpenOrd可以在串行或并行模式下运行。<br>两种情况下的算法都是相同的，但是并行的结果不能保证与串行中的结果相同。<br>因此，我们对OpenOrd的第一次测试是为了评估这两种模式之间的潜在差异。<br>在这个测试中，我们再次使用了Spellman’s的酵母数据。<br>我们在酵母数据上使用了1、2、4、8、16和32个处理器。<br>1处理器的情况是串行版本。</p><p>We compared the outputs of each run by computing a similarity metric s ε (U,V) [0,1], whereU,V are two layouts of the same m-node dataset {x 1 ,…<br>我们通过计算一个相似度量<code>similarity-metric</code>Sε(U,V)∈[0,1]来比较每个运行的输出，U,V是m个顶点的相同数据集{X1,…Xm}的两个不同的布局。<br>度量<code>metric</code>是通过首次构造邻域的关联矩阵NUε和NVε来计算的，其中N[·]ε是一个m×m矩阵，N[·]ε=(Nij)：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cba616gor6s1sqlc76ae69481g.png" alt="image_1cba616gor6s1sqlc76ae69481g.png-9.4kB"></p><p>NUε·NVε是二者的点积，两个矩阵都被认为是长度为m2的向量<br>这个度量<code>metric</code>介于0和1之间，较大的值表示更大的相似性。<br>这是对先前提出的相似度度量<code>39</code>的修改。</p><p>在我们的计算中，我们把U和V的每一个布局都缩放到[0,1]×[0,1]范围内，然后使用ε=0.1。<br>我们得到了串行布局与并行布局的平均相似度为0.72。<br>邻居节点数的平均大小是24。<br>除了这个度量之外，我们还对每个运行的输出进行了定性的比较，如图3所示（a-f）。<br>我们的度量计算表明，在并行计算过程中，布局的局部结构得到了保留，而定性<code>qualitative</code>结果表明，全局结构也得到了保护。<br>除了提供类似的结果之外，OpenOrd的并行版本还提供了计算速度的测试，如图3（g）所示。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cba4eqoa1lqd1ubb1rt21jl71vgsm.png" alt="image_1cba4eqoa1lqd1ubb1rt21jl71vgsm.png-214kB"></p><p>图3，OpenOrd的并行执行。<br>在这里，我们提供了使用1、2、4、8、16和32个处理器的OpenOrd结果的定性<code>qualitative</code>比较。<br>在（a）中，我们展示了串行（1处理器）布局。<br>为了表达清晰我们只画出顶点，我们用蓝色、黑色、绿色和红色来给布局上色。<br>在（b-f）中，我们分别显示了2、4、8、16和32个处理器布局的结果。<br>这些布局中的顶点使用与（a）中的单个处理器布局中顶点相同的颜色进行着色，在（g）中，我们展现了不同数目处理器的计算速度变化。</p><h3 id="Multilevel-Layout-多级布局"><a href="#Multilevel-Layout-多级布局" class="headerlink" title="Multilevel Layout 多级布局"></a>Multilevel Layout 多级布局</h3><p>如前所述，Frutcherman-Reingold算法不能很好地扩展到非常大的图形。<br>除了高运行时间之外，该算法还常常会混淆输入的全局结构，如图1（a，b）所示。<br>在瑞士卷数据中，这幅图在局部规模上是正确的，但在全局范围内却很混乱。<br>为了取得更好的结果，OpenOrd使用多级图粗化<code>13</code>，在第3节中描述了各种修改。<br>我们首先通过重访<code>revisiting</code>瑞士卷数据集来演示我们的结果。<br>我们使用了9个级别的粗化和没有边切割的场景，我们得到了如图1（c）所示的瑞士卷的全局正确布局。</p><p>接下来，我们将使用从2007年开始的生成了659388维基百科文章的网络的布局来展示多级方法的结果。<br>这个布局是使用6个递归级别计算的，如图4所示。<br>该方法在粗化过程中使用了侵略性的边切割和聚类，并在细化过程中反复应用了标准的OpenOrd布局算法。<br>在没有粗化的情况下，OpenOrd将绘制出相同的图形，它是一个密度均匀<code>uniformly</code>、高度连接和视觉上不吸引人的球状结构。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cba6q2nq520ks31eer6s1ikf1t.png" alt="image_1cba6q2nq520ks31eer6s1ikf1t.png-47.9kB"></p><p>图4，OpenOrd递归<code>recursion</code>。<br>在这里，我们展示了一个从2007年开始的659388维基百科文章数据集的布局。<br>最终的布局显示在图的中心。<br>在递归过程中产生的各种布局在最终布局的外部显示。<br>从11点到6点方向，我们按逆时针方向进行，我们展示了使用图形粗化<code>coarsen</code>过程产生的布局。<br>从5点到1点方向，我们展示了在细化<code>refine</code>过程中产生的布局。</p><h3 id="Parameter-Testing-参数测试"><a href="#Parameter-Testing-参数测试" class="headerlink" title="Parameter Testing 参数测试"></a>Parameter Testing 参数测试</h3><p>在OpenOrd中使用的布局算法有大量的参数，包括开始时随机的种子、模拟退火流程的分配和边切割参数等。<br>当在多级模式中使用布局算法时，我们必须根据粗化或细化的当前阶段调整这些参数，以便在我们执行的过程中保持布局的连续性。<br>在本节中，我们使用大量的数据集来对参数的选择进行基准测试。</p><p>我们的基准测试的结果如表1所示。<br>尽管数据集具有多样性，使用多级模式时我们发现了一组通用的参数提供了的良好布局。<br>这些参数在<a href="http://www.cs.sandia.gov/smartin的代码中作为默认值提供。" target="_blank" rel="external nofollow noopener noreferrer">www.cs.sandia.gov/smartin的代码中作为默认值提供。</a><br>数据集、它们的大小和使用的递归级别<code>the level of recursion</code>都显示在表1中。<br>还提供了运行时间，以向用户提供给定数据集大小所需的工作。<br>运行时间是使用4GB内存的英特尔Xeon工作站获得的。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cba7eifb16vibhn44917clu4i2a.png" alt="image_1cba7eifb16vibhn44917clu4i2a.png-22.8kB"></p><p>表1，参数测试。<br>在第一列中列出了用于为OpenOrd的多级版本设定基准的默认参数的不同数据集。<br>第二列和第三列包含数据集大小，第四列包含所使用的级别，第五列显示在工作站上运行所需的时间（小时:分钟:秒）。</p><h2 id="CONCLUSIONS"><a href="#CONCLUSIONS" class="headerlink" title="CONCLUSIONS"></a>CONCLUSIONS</h2><p>我们已经创造了一组<code>collection</code>用于绘制大图形的算法（OpenOrd）。<br>这些算法的重点是处理现实世界的数据集，例如在科学文献和生物应用中遇到的数据集。<br>我们的方法是基于Frutcherman-Reingold力导向布局方法<code>11</code>。<br>这种方法已经采用模拟退火和网格计算方法进行了改进，得到了一种实用的算法，在实际数据集上得到了良好的应用<code>23-28</code>。<br>然而，该算法对大型数据集产生了视觉上不吸引人的和全局不准确的布局。<br>我们已经使用边切割解决了视觉吸引力问题，以及使用一种具有平均链接聚类的多级方法来捕获真实数据集的全局结构的不准确的问题。</p><p>我们已经在各种数据集上演示了OpenOrd的行为，包括酵母微阵列数据<code>35</code>、科学期刊数据<code>37</code>、科学文献数据<code>38</code>、维基百科文章<code>36</code>。<br>我们已经确定了适当的默认参数，可以在不同大小的数据集上使用，并在我们的开放源代码中提供了这些默认值，可以在<a href="http://www.cs.sandia.gov/smartin获得。" target="_blank" rel="external nofollow noopener noreferrer">www.cs.sandia.gov/smartin获得。</a><br>最后，该算法已经适配于并行计算的计算机上来处理超大数据集。</p><h2 id="ACKNOWLEDGMENTS"><a href="#ACKNOWLEDGMENTS" class="headerlink" title="ACKNOWLEDGMENTS"></a>ACKNOWLEDGMENTS</h2><p>感谢作者感谢B.Herr提供了维基百科的文章数据。<br>Sandia公司是由洛克希德马丁公司的Sandia公司运营的一个多项目实验室，为美国能源部提供合同，该公司的合同是deac04-94AL85000。<br>这项工作得到了Sandia的计算机科学研究基金的支持。</p><h2 id="REFERENCES"><a href="#REFERENCES" class="headerlink" title="REFERENCES"></a>REFERENCES</h2><p>[ 1 ] Battista, G. D., Eades, P., Tamassia, R., and Tollis, I. G., [Graph Drawing Algorithms for the Visualization of Graphs], Prentice Hall (1999).<br>[ 2 ] Jünger, M. and Mutzel, P., [Graph Drawing Software], Springer-Verlag (2004).<br>[ 3 ] Freeman, L. C., Visualizing social networks, Journal of Social Structure 1(1) (2000).<br>[ 4 ] Borner, K., Chen, C., and Boyack, K., Visualizing knowledge domains, in [Annual Review of Information Science and Technology], Cronin, B., ed., 37, ch. 5, 179 255, American Society for Information Science and Technology, Medford, NJ (2003).<br>[ 5 ] Shiffrin, R. and Borner, K., Mapping knowledge domains, Proc. Natl. Acad. Sci. 101 suppl. 1, 5183 5185 (2004).<br>[ 6 ] Wolff, A., Drawing subway maps: A survey, Informatik - Forschung und Entwicklung 22, 23 44 (2007).<br>[ 7 ] Wiese, K. C. and Eicher, C., Graph drawing tools for bioinformatics research: An overview, in [CBMS 06: Pro- ceedings of the 19th IEEE Symposium on Computer-Based Medical Systems], 653 658, IEEE Computer Society, Washington, DC, USA (2006).<br>[ 8 ] Adai, A. T., Date, S. V., Wieland, S., and Marcotte, E. M., LGL: Creating a map of protein function with an algorithm for visualizing very large biological networks, Journal of Molecular Biology 340, 179 190 (2004).<br>[ 9 ] Eades, P., A heuristic for graph drawing, Congressus Numerantium 42, 149 160 (1984).<br>[ 10 ] Kamada, T. and Kawai, S., An algorithm for drawing general undirected graphs, Information Processing Letters 31, 7 15 (1989).<br>[ 11 ] Frutcherman, T. and Reingold, E., Graph drawing by force-directed placement, Software-Practice and Experi- ence 21, 1129 1164 (1991).<br>[ 12 ] Davidson, R. and Harel, D., Drawing graphs nicely using simulated annealing, ACM Trans. on Graphics 15, 301 331 (1996).<br>[ 13 ] Walshaw, C., A multilevel algorithm for force-directed graph-drawing, Journal of Graph Algorithms and Applica- tions 7(3), 253 285 (2003).<br>[ 14 ] Harel, D. and Koren, Y., A fast multi-scale method for drawing large graphs, Journal of Graph Algorithms and Applications 6, 179 202 (2002).<br>[ 15 ] Hachul, S. and Junger, M., Drawing large graphs with a potential-field-based multilevel algorithm, in [Graph Drawing], Pach, J., ed., 285 295, Springer Berlin (2005).<br>[ 16 ] Hu, Y. F., Efficient and high quality force-directed graph drawing, The Mathematica Journal 10, 37 71 (2005).<br>[ 17 ] Quigley, A. and Eades, P., Fade: Graph drawing, clustering, and visual abstraction, in [Graph Drawing], Marks, J., ed., 197 210, Springer Berlin (2001).<br>[ 18 ] Noack, A., An energy model for visual graph clustering, in [Graph Drawing], Liotta, G., ed., 425 436, Springer Berlin (2004).<br>[ 19 ] Frishman, Y. and Tal, A., Multi-level graph layout on the gpu, IEEE Transactions on Visualization and Computer Graphics 13, 1310 1319 (2007).<br>[ 20 ] Godiyal, A., Hoberock, J., Garland, M., and Hart, J. C., Rapid multipole graph drawing on the gpu, in [Graph Drawing], Tollis, I. G. and Patrignani, M., eds., 90 101, Springer Berlin (2009).<br>[ 21 ] Davidson, G., Hendrickson, B., Johnson, D., Meyers, C., and Wylie, B., Knowledge mining with VxInsight: Dis- covery through interaction, Journal of Intelligent Information Systems 11, 259 285 (1998).<br>[ 22 ] Davidson, G., Wylie, B., and Boyack, K., Cluster stability and the use of noise in interpretation of clustering, in [IEEE Symposium on Information Visualization (INFOVIS)], 23 30 (2001).<br>[ 23 ] Boyack, K., Wylie, B., and Davidson, G., Domain visualization using VxInsight for science and technology man- agement, Journal of the American Society for Information Science and Technology 53(9), 74 774 (2002).<br>[ 24 ] Boyack, K., Mapping knowledge domains: Characterizing PNAS, Proc. Natl. Acad. Sci. 101 suppl. 1, 5192 5199 (2004).<br>[ 25 ] Boyack, K., Klavans, R., and Borner, K., Mapping the backbone of science, Scientometrics 64(3), 351 374 (2005).<br>[ 26 ] Kim, S., Lund, J., Kiraly, M., Duke, K., Jiang, M., Stuart, J., Eizinger, A., Wylie, B., and Davidson, G., A gene expression map for Caenorhabditis elegans, Science 293(5537), 2087 2092 (2001).<br>[ 27 ] Werner-Washburne, M., Wylie, B., Boyack, K., Fuge, E., Galbraith, J., Weber, J., and Davidson, G., Comparative analysis of multiple genome-scale data sets, Genome Research 12(10), 1564 1573 (2002).<br>[ 28 ] Wilson, C., Davidson, G., Martin, S., Andries, E., Potter, J., Harvey, R., Ar, K., Xu, Y., Kopecky, K., Ankerst, D., Gundacker, H., Slovak, M., Mosquera-Caro, M., Chen, I.-M., Stirewalt, D., Murphy, M., Schultz, F., Kang, H., Wang, X., Radich, J., Appelbaum, F., Atlas, S., Godwin, J., and Willman, C., Gene expression profiling of adult acute myeloid leukemia identifies novel biologic clusters for risk classification and outcome prediction, Blood 108, 685 696 (2006).<br>[ 29 ] Tenenbuam, J. B., de Silva, V., and Langford, J. C., A global geometric framework for nonlinear dimensionality reduction, Science 290, 2319 2323 (2000).<br>[ 30 ] Roweis, S. and Saul, L., Nonlinear dimensionality reduction by locally linear embedding, Science 290, 2323 2326 (2000).<br>[ 31 ] Davidson, G., Martin, S., Boyack, K., Wylie, B., Martinez, J., Aragon, A., Werner-Washburne, M., Mosquera- Caro, M., and Willman, C., Robust methods in microarray analysis, in [Genomics and Proteomics Engineering in Medicine and Biology], Akay, M., ed., 99 130, Wiley IEEE (2007).<br>[ 32 ] Hendrickson, B. and Leland, R., A multilevel algorithm for partitioning graphs, in [Proc. Supercomputing 95, San Diego], ACM Press (1995).<br>[ 33 ] King, B., Step-wise clustering procedures, J. Am. Stat. Assoc. 69, 86 101 (1967).<br>[ 34 ] Jain, A. K., Murty, M. N., and Flynn, P. J., Data clustering: A review, ACM Computing Surveys 31(3), 264 323 (1999).<br>[ 35 ] Spellman, P. T., Sherlock, G., Zhang, M. Q., Iyer, V. R., Anders, K., Eisen, M. B., Brown, P. O., Botstein, D., and Futcher, B., Comprehensive identification of cell cycle-regulated genes of the yeast Saccharomyces cerevisiae by microarray hybridization, Molecular Biology of the Cell 9, 3273 3297 (1998).<br>[ 36 ] Herr, B., Holloway, T., and Borner, K., An emergent mosaic of Wikipedian activity. International Workshop and Conference on Network Science (2007).<br>[ 37 ] Boyack, K., Using detailed maps of science to identify potential collaborations, Scientometrics 79, 27 44 (2009).<br>[ 38 ] Boyack, K., Tsao, J., Miksovic, A., and Huey, M., A recursive process for mapping and clustering literatures: International trends in solid state lighting, International Journal of Technology Transfer and Commercialization 8, 51 87 (2009).<br>[ 39 ] Ben-Hur, A., Elisseeff, A., and Guyon, I., A stability based method for discovering structure in clustered data, in [Pacific Symposium on Biocomputing], 6 17 (2002).</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 层次数据 </tag>
            
            <tag> 并行计算 </tag>
            
            <tag> 力导向 </tag>
            
            <tag> 图简化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可视化算法VxOrd论文研读</title>
      <link href="/article/428e.html"/>
      <url>/article/428e.html</url>
      
        <content type="html"><![CDATA[<pre><code>原文名：Cluster Stability and the Use of Noise in Interpretation of Clustering中文译：聚类的稳定性和在聚类解释中添加噪声源刊载：IEEE Symposium on Information Visualization , 2001 :23机构名：Sandia National Laboratories 桑迪亚国家实验室，US研究点：    - Clustering algorithms    - Data visualization    - Stability analysis    - Algorithm design and analysis    - Best practices</code></pre><a id="more"></a><p>摘要<br>本文介绍了一种适合挖掘超大型数据库的聚类和排序<code>ordination</code>算法，包括微阵列表达式研究<code>microarray expression studies</code>产生的数据库，并对其稳定性进行了分析。<br>在实际条件下，利用一个酵母细胞周期实验，对6000个基因进行实验，并对每个基因进行18个实验测量。<br>将数据库对象分配X、Y坐标及顺序的过程，在随机启动条件下，以及在开始相似度估计中对小扰动的处理是稳定的。<br>对聚类通常共同定位的方式进行了仔细的分析，而在不同的初始条件下偶尔出现的大位移则被证明在解释数据时非常有用。<br>当只报告一个聚类时，就会丢失这种额外的稳定性信息，这是目前已被接受的实践。<br>然而，在分析大型数据收集的计算机聚类时，人们认为这里提出的方法应该成为最佳实践的标准部分。</p><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>我们感兴趣的是在大量的实验数据中发现意想不到的关系。<br>不幸的是，我们很容易看到虚幻的模式<code>illusory patterns</code><br>我们的思想是建立在寻找模式的基础上的，即使我们知道感知到的模式仅仅是随机的工件，我们也会这样做。<br>因此，我们感兴趣的模式必须进行一些测试，这些测试表明，如果我们从另一个类似的数据集开始，或者，可能是由于添加了少量的噪音而随机干扰的数据，它们肯定会再次发生。<br>我们使用计算机来查看这些大型数据集，因此我们有必要相信我们的计算工具是可靠的，特别是在我们的例子中，它们使用随机数。<br>我们想知道的结果是对工具内部随机过程的细节不敏感;<br>也就是说，我们想知道我们使用的工具是<strong>稳定</strong>的，在每次的使用中。<br>当然，我们希望这些工具是实用的，对实践科学家有用，他们想知道这些模式是真实的，并且它们可能指向世界上的一些物理事实或重要的过程。</p><p>几个世纪的实践证明，最后一个问题只能通过仔细控制的实验来回答。<br>在这里，我们必须把我们的工具所发现的关系的测试和解释留给实验家。<br>相反，我们的<strong>目的是解决发现潜在重要模式的过程，以及对过程本身的可靠性的调查，以及过程对初始数据的细微变化的敏感性</strong>。<br>我们将报告对一个特定数据挖掘工具的可靠性和灵敏度的各种计算调查，VxInsight<code>1998</code> 使用的是中等大小的微阵列数据集。</p><p>VxInsight使用一个地形隐喻来描述大量的数据，通过在地形上相互靠近，来总结相似元素的簇。<br>二维的星团被想象成由山谷和开阔空间分隔的山脉和山丘。<br>山脉的高度表明了每座山下聚集的元素数量。<br>山脉之间的局部分组和分离也包含了关于集群间相似性的信息。<br>在被广泛隔离的山脉中，数据元素的相似性要小于邻近山脉的数据元素。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbssplqpopstsfp5nts1okk9.png" alt="image_1cbbssplqpopstsfp5nts1okk9.png-353.4kB"><br>图一。在VxInsight中关系的持续变化</p><p>不像自组织的maps<code>4</code>、k-means<code>5</code>、或约克的快速聚类<code>6.7</code>,我们的方法不需要预先猜测应该创建多少个聚类。<br>而且，像地形一样的聚类可以表示 比 仅仅列出聚类元素 更多的信息。<br>在山下的局部结构会显示出更细、更细的关系，当将其放大到地形的表示时（图1），数据对象在特定的聚类或层次结构中并不是显式的成员。<br>物体的位置是通过在二维空间中的<strong>连通图的能量最小化</strong>来确定的。<br>对每个数据元素的X、Y坐标的赋值是一个我们称之为序化的过程。</p><p>本文的主要主题是我们的序化过程的稳定性。<br>简要地介绍了我们的力导向序化算法的随机元素的稳定性特征。<br>这些特征在一系列的实验中被研究，这些实验用不同的随机起始条件重新排列相同的数据集，并比较（从视觉上和统计上）结果。<br>正如在结果和讨论部分中所描述的，序化算法展示了可预测的、可理解的行为。</p><p>在确定该工具可接受的稳定之后，我们研究了在相似关系中添加噪声的影响，在序化过程的输入阶段。<br>正如预期的那样，在真实的数据集下，某些聚类比其他聚类更稳定。<br>重要的是，一些聚类不仅保留了相同的成员，而且在地形图中保持了物理上的接近。<br>其他聚类往往会伴随较大的位移，这可以通过在地形图中聚类间强相似性连接来理解。 </p><p>In the Results and Discussion section, we describe how this analysis suggests important strategies for testing the robustness of clustering algorithms.<br>在结果和讨论部分中，我们描述了该分析如何提出测试聚类算法的健壮性的重要策略。</p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><h3 id="如何生成一个VxInsight图"><a href="#如何生成一个VxInsight图" class="headerlink" title="如何生成一个VxInsight图"></a>如何生成一个VxInsight图</h3><p>图2显示了数据必须通过的一般流程，以生成VxInsight图。<br>一个典型的数据库，在图中表示为表格，它由几千个元素（行）组成，其中一个或多个属性为（列）。<br>必须对这些数据进行处理，以计算每一对数据元素的相似性，然后用它们来构造一个抽象图。<br>在这个节点和弧的图中，节点表示单个的数据元素，而弧是元素之间的相似性。<br>序化过程将每个数据元素分配给抽象可视化表面的X、Y位置。<br>最后，这些坐标被用来生成山地地形。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbt203c1u321qm31f4d1kpb1u661g.png" alt="image_1cbbt203c1u321qm31f4d1kpb1u661g.png-43.9kB"><br>图二。将数据处理成VxInsight图</p><h3 id="选择一个数据集"><a href="#选择一个数据集" class="headerlink" title="选择一个数据集"></a>选择一个数据集</h3><p>在我们的实验中，我们选择了一个现成的数据集<a href="http://genomewww.stanford。edu/cellcycle/data/rawdata，这是一个包含大约6000个数据元素的表格（酵母中的基因）。" target="_blank" rel="external nofollow noopener noreferrer">http://genomewww.stanford。edu/cellcycle/data/rawdata，这是一个包含大约6000个数据元素的表格（酵母中的基因）。</a><br>我们选择了这个数据集的一个子集，在细胞生长分裂的过程中，对这些基因的活动进行了18次测量。<br>这些数据足够大，可以提供数据挖掘技术发现的机会，而且远远超出了测试聚类方法的玩具<code>toy</code>问题。<br>此外，酵母数据集已经被很好地研究过，某些基因也被认为是一起工作的，应该把它们聚集在一起，可以作为对我们算法的简单测试。<br>最后，研究这一数据集使人们有可能对未被研究的基因的功能进行重要的预测，这些基因聚集在这些具有已知功能的基因附近。<br>重要的是，这些预测可以通过检验这些数据最初发布以来发表的文献来验证;<br>其中很多都可以在网上找到，用基因名索引，例如，可以看到<a href="http://www.proteome.com或斯坦福网站http://基因组-www.stanford。edu/cgi-bin/sg/search。" target="_blank" rel="external nofollow noopener noreferrer">http://www.proteome.com或斯坦福网站http://基因组-www.stanford。edu/cgi-bin/sg/search。</a></p><h3 id="计算基因的相似性"><a href="#计算基因的相似性" class="headerlink" title="计算基因的相似性"></a>计算基因的相似性</h3><p>电子表格中的每一列都记录了单个显微镜载片上6000个点的相对亮度。<br>除了受控制的变量之外，各种各样的条件将会系统地改变这些测量值。<br>例如，一张幻灯片的整体亮度可能因位置不同的材料而不同，处理条件略有不同，或者在扫描光强度方面存在差异。<br>为了弥补这些影响，每一张幻灯片的测量值（在扩展表中的一个列）通过减去这张幻灯片的中值来进行标准化，然后除以四分位范围（75百分位数和25%亮度值之间的差值）。<br>这种健壮的标准化对异常值的敏感度要低于标准化，通过减去平均值并除以标准偏差<code>8</code>。<br>皮尔逊的相关系数<code>9</code>被用来计算每一对基因之间的相似性。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbt31b6eqgtolfu5pb9ml91t.png" alt="image_1cbbt31b6eqgtolfu5pb9ml91t.png-14.7kB"></p><p>没有相似之处的基因将会有接近于0的值，而与之相似的基因将有接近于1的值。<br>Using the raw correlations unduly weights the low similarities and does not adequately represent the information content contained in a strong similarity.<br>使用原始的相关性对弱相关进行了过度的加权，并且不能充分地表示强相关的信息内容。<br>The non-linearity of this information, or rareness, is extreme and can change the total range of observed similarity weights by orders of magnitude.<br>该信息的非线性，或罕见性，是极端的并且可以按数量级改变观察到的相似度值的总范围。<br>We created all of the clusters reported here using gene pair similarities based on the t-statistic of the correlation coefficient, not on the correlation coefficient itself<br>我们使用基于相关系数的t统计量的基因对的相似度 来创建所有的聚类，而不是相关系数本身。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbt7js0n9vt8814on17gk138e1p.png" alt="image_1cbbt7js0n9vt8814on17gk138e1p.png-6.2kB"></p><p>这种转换具有逻辑支持，在实践中运行良好，并且易于计算。<br>我们认为，至少对于微阵列（DNA微阵列）实验来说，在所有的聚类分析中，都应该替换直接基于相关性的相似性。</p><p>在这个实验中，每6000个基因中都记录了20个最强烈的正相关。<br>最后，对于6000个基因中的每一个，基因的名称，它相关的基因的名称和相关的t统计量都被写入到一个文件中，供序化程序使用。</p><p>重要的是要使用大量的相似点来确保有序的精细结构被捕获。<br>然而，我们发现，对具有最强烈相似性的基因的放置进行的视觉检查，为评估这些序列的质量和理解它们的结构提供了一种方式。<br>例如，在图3中，强链接表明红色聚类可以很好地放置在山脊的两侧（由黄色、粉色和浅蓝色定义）。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbt8qoqf8d1usba4532q1teh26.png" alt="image_1cbbt8qoqf8d1usba4532q1teh26.png-199.7kB"><br>图3：两个随机运行（左、中）显示红色集群交换位置。<br>强链接（蓝线）表明，顺序是可以接受的。<br>第三幅图像更清晰地显示了山脊内的强连接密度。</p><p>确定一个合适的阈值来确定高度相关的基因是有问题的。<br>1963年，为了报告相关性的统计意义，奥斯特尔[Ostel, 1963] 的常见做法是测试下一种情况<br> Ho : The observed n-sample correlation is consistent with observing two processes with a true correlation 0 = ρ ,<br>观察到的n-样本相关性与观察两个具有真相关的过程是一致的，</p><p>using a t-test with 2 n degrees of freedom and reject the hypothesis with some level of confidence α .<br>使用n-2自由度的t-test测试，并以一定程度的置信度α拒绝这个假设。<br>然而，有6000个基因我们有1800万对相关性。<br>即使使用了0.001的置信水平，假设真正的相关性为0时，我们就会期望有36000对相关性超过临界值。</p><p>确定一组高度相关的基因(特别是当n很大),更好的方法是<strong>进行动力分析</strong><code>a power analysis</code>,这需要一些假设的选择实际相关,ρ0,和一些可接受的机会不是检测对真正有关联的基因ρ0由于观测值的变化。<br>例如，我们选择了ρ0=0.9 作为实际相关度，并且假设我们需要保留在二十次测量中有此相关度大于一次的基因对（这时β=0.05）。</p><p>对于测试Ho的上述公式 仅仅在ρ0=0时有效。当ρ0≠0，可以使用基于费雪<code>10</code>的近似值，which把r转化为标准的Z统计分量（Zρ0和方差σ2）</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbta9ksgqa10mk12083esgfl2j.png" alt="image_1cbbta9ksgqa10mk12083esgfl2j.png-2.1kB"><br>对于Z，有如下：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtatpo13dm1hap13t71o3qfiv30.png" alt="image_1cbbtatpo13dm1hap13t71o3qfiv30.png-5.4kB"></p><p>因此，接收pair的关键是他们是强相关的，根据我们的规范，我们会错误地拒绝一种相关性在20%的情况下，当真正的潜在相关性是ρ0=0.9且n=18：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtf1crb4kn25b0s0bb4r5d.png" alt="image_1cbbtf1crb4kn25b0s0bb4r5d.png-15.7kB"></p><p>这个临界值对应于 α &lt; 0.0005。匹配该规范的一对基因被保存下来，以便稍后在VxInsight中显示。</p><h3 id="VxInsight序化程序"><a href="#VxInsight序化程序" class="headerlink" title="VxInsight序化程序"></a>VxInsight序化程序</h3><p>序化程序通过考虑整个集合中的对象之间的所有相似性来确定数据对象的空间位置，图4显示了具有许多相似链接（边）的对象在地图上聚集在一起;而那些几乎没有或没有相似链接的对象是分开的。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtgtma14p0qbnsskgc12h65q.png" alt="image_1cbbtgtma14p0qbnsskgc12h65q.png-149.7kB"><br>2000个顶点图（顶部）的布局，以及已知的K 5和双K 5（底部）的解决方案。</p><p>一个抽象的，边缘加权的图，G=（V，E），是用一个节点列表和它们的相似点生成的，其中顶点V对应于数据对象，相似点对应于加权边，E，有大量的文献用于图形绘制和布局算法<code>11-19</code><br>Fruchterman和Reingold <code>12</code>的工作与我们的方法特别相关。</p><p>在开发和实现我们的算法时，我们遵循了四个重要原则：</p><ol><li>由边连接的顶点应该相互靠近。</li><li>非连接的顶点应该相互远离。</li><li>结果应该对随机的初始条件不敏感。</li><li>计算的复杂性应该降低到最小值。</li></ol><p>这些原则非常重要，我们将详细讨论每一个原则。</p><h4 id="原则1和2"><a href="#原则1和2" class="headerlink" title="原则1和2"></a>原则1和2</h4><p>Fruchterman等人计算了吸引力和排斥力。然后，这些术语用于为图形顶点生成新的位置。<br>我们的算法将吸引力和排斥项结合成一个势能方程（方程式3），第一个部分，在括号中，是由于连接顶点之间的吸引;第部分是排斥项。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbti36sj62fafpl1abv1pj267.png" alt="image_1cbbti36sj62fafpl1abv1pj267.png-13.4kB"></p><pre><code>Ki(x,y) = 一个顶点在一个特定的x，y位置的能量ni      = 连接到顶点i的边数wi,j    = 顶点i与顶点j连接的顶点之间的边权值。l2i,j   = 顶点i的平方距离和边j的另一端的顶点之间的距离。Dx,y    = 一个力项与xy附近顶点的密度成比例。</code></pre><p>在我们的顺序中，方程3在三个阶段中以迭代的方式逐渐被最小化。<br>第一阶段通过将顶点扩展到它们最终所属的一般区域，从而减少系统中的自由能量。<br>下一阶段类似于模拟退火算法中出现的淬火步骤，节点会进行更小的随机跳跃，以最小化它们的能量方程式。<br>最后一个是酝酿中的阶段，详细的地方修正。</p><p>所有的运动都是随机的;<br>每个顶点都可以从当前位置跳转到一个新的、随机的位置。<br>如果移动减少了顶点的势能，那么顶点就被允许停留在新的位置。<br>否则，顶点将保留旧位置到下一个迭代的位置。<br>其他更复杂的技术，包括梯度下降法和动量项法，在理论上很具有吸引力。<br>然而，成千上万个顶点的能量表面是如此的混乱（在空间上和时间上），在实践中，我们发现更简单的方法表现更好。<br>请注意，对于每个顶点，只有它自己的能量被考虑，这是贪婪算法的一个特征，它只会间接地导致整个系统的全局最小化。<br>然而，系统的总能量，见方程4，仍然可以作为算法终止的标准。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtisji17b7aaa98p6481h546k.png" alt="image_1cbbtisji17b7aaa98p6481h546k.png-15.4kB"></p><p>文献<code>11,16,17</code>讨论了许多其他的终止标准，其中一些没有明确地遵循总能量。<br><strong>例如，Eades<code>11</code>建议简单地运行固定数量的迭代，在它们的情况下是100。</strong><br><strong>我们发现，对于更复杂的图形，800个迭代很好地工作。</strong><br>我们通常处理的图形有上万个顶点。<br>本文讨论的图中有6000个顶点，需要90秒才能完成600 MHz的奔腾III的800次迭代。</p><p>很明显，尽量减少潜在的能量应该会导致与我们的前两个原则相符合的ordinations。<br>吸引项激励点的移动，将使(带权的)强相关顶点之间的边的长度的最小化。<br>第二项，Dx,y，是基于附近顶点的局部密度的力，当顶点移动到不那么拥挤的区域时，它被最小化。<br>为了减少这两部分的计算，一个顶点必须接近它的连接顶点，并且与非连接的顶点保持一定的距离。</p><h4 id="原则3"><a href="#原则3" class="headerlink" title="原则3"></a>原则3</h4><p>一个序化过程可以很容易地以防止平稳过渡到正确的答案的方式开始。<br>也就是说，算法会被困在局部极小值中，并且很可能在计算的早期被迫趋向局部极小值。<br><strong>问题是，初始的配置可能会导致一些应该彼此靠近的顶点，被一个大的障碍分隔开。</strong><br>各种随机技术被用来避免这个问题。<br>例如模拟退火，它采用一定概率来决定，是否采取增加节点相关能量的动作。<br>这种技术允许顶点克服与局部极小值相关的障碍，以寻找更低的能量状态。<br>在对我们的能量方程式进行检查后，我们可以清楚地看到，通过直接求解单个顶点的能量的位置，可以使其迅速地通过一个能量屏障。<br>在我们的算法中，我们已经成功地使用了这种分析方法来避免局部极小值。<br>在过程的早期实现一个良好的配置，独立于初始配置，对于有效的序化是十分重要的，这也契合原则3。</p><blockquote><p>模拟退火算法的原理概述<br>爬山法是一种贪婪的方法，其目标是要找到函数的最大值，若初始化时，初始点的位置在C处，则会寻找到附近的局部最大值A点处，由于A点出是一个局部最大值点，故对于爬山法来讲，该算法无法跳出局部最大值点。若初始点选择在D处，根据爬山法，则会找到全部最大值点B。这一点也说明了这样基于贪婪的爬山法是否能够取得全局最优解与初始值的选取由很大的关系。对于这个优化问题，其大致图像如下图所示：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cb6soscl1rdic281c2k3uejo66k.png" alt="image_1cb6soscl1rdic281c2k3uejo66k.png-21.8kB"><br>其目标是要找到函数的最大值，若初始化时，初始点的位置在C处，则会寻找到附近的局部最大值A点处，由于A点出是一个局部最大值点，故对于爬山法来讲，该算法无法跳出局部最大值点。若初始点选择在D处，根据爬山法，则会找到全部最大值点B。这一点也说明了这样基于贪婪的爬山法是否能够取得全局最优解与初始值的选取由很大的关系。<br>模拟退火算法(Simulated Annealing, SA)的思想借鉴于固体的退火原理，当固体的温度很高的时候，内能比较大，固体的内部粒子处于快速无序运动，当温度慢慢降低的过程中，固体的内能减小，粒子的慢慢趋于有序，最终，当固体处于常温时，内能达到最小，此时，粒子最为稳定。模拟退火算法便是基于这样的原理设计而成。<br>模拟退火算法从某一较高的温度出发，这个温度称为初始温度，伴随着温度参数的不断下降，算法中的解趋于稳定，但是，可能这样的稳定解是一个局部最优解，此时，模拟退火算法中会以一定的概率跳出这样的局部最优解，以寻找目标函数的全局最优解。如上图中所示，若此时寻找到了A点处的解，模拟退火算法会以一定的概率跳出这个解，如跳到了D点重新寻找，这样在一定程度上增加了寻找到全局最优解的可能性。</p></blockquote><p>我们通过将顶点移动到方程3中指定的方向来达到这个结果。<br>然而，为了跳过能量屏障，一小部分顶点忽略了排斥项，并在计算上将吸引项最小化。<br><strong>这是通过在所有连接的顶点上计算加权的中心来实现的。</strong><br>然后顶点跳到那个计算的质心，不管是否有任何可能的能量增加，如图5所示。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtjqak1a8mdh3sf1c2n142r71.png" alt="image_1cbbtjqak1a8mdh3sf1c2n142r71.png-52.8kB"><br>图五，通过忽略密度项来跳过障碍。 </p><p>在冷却过程中，障碍跳跃是与冷却时间相联系的，在淬火期间，障碍跳跃的设置频率从25%下降到10%，在炖煮(simmer)阶段根本不使用。<br>在开始时，为了达到稳定性而在随机的初始阶段使用较高的频率。<br>糟糕的初始位置或初始的错误的跳跃，将不可逆转地改变一个纯粹随机算法的结果。由于这一过程的修正性质，极大地减轻了上述的影响。<br>图6显示了两个随机运行的图像。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtkrtk12pj1ghalm4n0gj9d7e.png" alt="image_1cbbtkrtk12pj1ghalm4n0gj9d7e.png-414.1kB"><br>第一行的使用障碍跳跃，第二行没有。<br>我们可以看到使用障壁跳技术取得的优异的重复性。<br>第二行显示，6000个顶点被绝望地困在一个局部极小值的网络中。<br>图7中的柱状图提供了进一步的支持，即障碍跳跃提高了随机迭代求解器的<strong>可重复性</strong>。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbtsl84hdh141cl42s6fmk8r.png" alt="image_1cbbtsl84hdh141cl42s6fmk8r.png-52kB"></p><p>对于本文的直方图，我们想通过计算在地图的一小部分（1%）内的相同邻居的数量来测量有序算法的稳定性。<br>这些图包含了6000个基因，所以对于每一个基因，我们测量了60个最近的基因中有多少在迭代过程保持不变。<br>（如图所示，图中柱状图的和应为6000，上面的表示大部分节点在布局结束后都能发现45个左右的相同的邻居节点，下面的表示大部分节点在每次布局后都没有/0个相同的邻居节点）</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="原则4"><a href="#原则4" class="headerlink" title="原则4"></a>原则4</h4><p>计算Dxy的蛮力方法肯定不符合我们的第四个原则。<br>因为每个顶点都必须检查它对所有其他顶点的位置，这个简单的方法对于每一个Dxy的确定都要进行|V|次比较。<br>当每个节点都必须计算出Dxy在特定位置xy中确定它的能量时，这个算法需要总运行时间O（|v|2）。</p><p>对于现实世界中的问题O（|v|2）算法是非常耗时的。<br>我们已经开发了一种基于网格的计算Dxy的方法，它允许每个顶点在恒定时间,O(1),内确Dxy的近似值，从而将总运行时间减少到令人满意的O（V）。</p><p>Fruchterman<code>8</code>所讨论的网格变量算法使用一种binning技术来考虑特定区域内的那些顶点。<br>一种方法是，通过对顶点的均匀分布把计算减少到O（V）。<br>然而，如果边的数量很小，那么图形就只有一个均匀的分布。<br>高度连接的图形在小区域中会有密集的顶点集中，并且运行时间不再是线性的，而是取决于顶点数量。<br>为了对所有的图形有效，我们的排斥项利用了非特定密度度量。<br>顶点不会被其他特定的顶点排斥，而是被普遍的过度拥挤所排斥。</p><p>这种对排斥力标准的微小修改使得计算复杂度大大降低。<br>这种密度场<code>density field</code>算法是通过让每个节点将能量足迹<code>footprint</code>放置在二维（密度场）阵列上实现的。<br>能量足迹可以是空间中的任何函数。<br>我们的实现：使用一个半径为r的圆和一个在圆的中心能量达到峰值的函数，同时从圆的中心向外的距离能量下降。<br>总密度场是该区域每个顶点的贡献之和。<br>考虑到密度字段，每个节点可以使用一个常数时间表来查找并确定近似的Dxy值。<br>这种方法将斥力项的计算复杂度从O(|V|2)降低到O(|V|)，并且与我们的第四个原则相一致，这是使文中算法可以应用到实际场景的重要内容。</p><h3 id="计算实验"><a href="#计算实验" class="headerlink" title="计算实验"></a>计算实验</h3><p>为了测试算法的稳定性，我们用不同的<code>种子</code>进行了100次重新排列。<br>在一个布局中(序列)，视觉地标记了每个聚类的元素，并观察它们是否在另一个布局中视觉上仍然聚集在一起。<br>然后我们计算了如下所述的社区统计数据。</p><p>为了确定微小的变化或噪音是否会对分类结果产生改变，我们执行了八十组添加了符合一定规则的噪声的re-ordinations，规则是噪音符合高斯分布、均值为零、标准偏差分别为0.001,0.010,0.050,和0.100，这些噪音的相关性被切断以保持相关系数的有效范围是(-1.0 + 1.0)。<br>这些不同的序列的最后布局均在视觉和统计上进行了比较。</p><h3 id="评估方法"><a href="#评估方法" class="headerlink" title="评估方法"></a>评估方法</h3><p>我们用一种邻域分析法<code>neighborhoods analysis</code>来比较不同的序列ordinations。<br>当两个序列非常相似时，我们有理由相信，对于每一个基因，它的最接近的邻居，比如临近的60个基因在这两个序列中几乎是相同的。<br>事实上，我们对全部序列都有上述的期待。<br>另一方面，如果这些序列几乎没有什么共同之处，那么观察一个在两序列中都有相同的邻居的基因是很罕见的。<br>我们计算了这两种序列中每个基因的邻居统计数据。<br>对于两个序列中的每一个基因，我们分别确定60个最近的基因，然后计算出共同的基因数量。<br>这个数字被用来增加表中的值,所以最后,我们有一个柱状图展示了在这两个序列中的没有共同邻居的基因数量,有多少有一个共同邻居的基因数量,等等,一直到在两个序列中都有相同的60个邻居的基因数量。由上述可以表示为直方图，如图8所示。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbu26iep45182t1e0bgmn1urhbk.png" alt="image_1cbbu26iep45182t1e0bgmn1urhbk.png-25.1kB"><br>图8.随机起始条件下序列的邻居分布，20副本</p><p>We then visually compared the results of the two ordinations by coloring all of the genes in a cluster found in the first ordination and seeing where those colored genes were placed in the other ordination (so that a similar ordination would not break up the group of colored genes, but would still have them co-located;<br>然后我们对 在第一个序列中发现的某个聚类中所有的基因进行着色并观察这些彩色基因被放置在另一个序列中的布局结果，然后将这两个序列的结果进行比较（所以类似的序列不会破坏有色基因的位置，参见图9和图10）。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbu2vh3lqc1jmp15df1ak717suc1.png" alt="image_1cbbu2vh3lqc1jmp15df1ak717suc1.png-116.1kB"><br>图9.有不同的随机初始条件的序列的布局结果</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbu4g2r1p79mbccr21u5l1c2lcr.png" alt="image_1cbbu4g2r1p79mbccr21u5l1c2lcr.png-129.8kB"><br>图10.演示了增加边噪声对聚类的稳定性</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbu9ubn2ikrq38t1sua1kpe8.png" alt="image_1cbbu9ubn2ikrq38t1sua1kpe8.png-99.6kB"></p><p>图11.添加了噪音(std.001)的邻域稳定性的直方图<br>图12.添加了噪音(std.010)的邻域稳定性的直方图<br>图13.添加了噪音(std.050)的邻域稳定性的直方图<br>图14.添加了噪音(std.100)的邻域稳定性的直方图</p><h2 id="结果和讨论"><a href="#结果和讨论" class="headerlink" title="结果和讨论"></a>结果和讨论</h2><p>计算实验揭示了两种类型的信息。<br>首先，我们发现大型结构通常非常健壮，可以从不同的初始条件开始。<br>其次，在有差异的地方，关于为什么聚类位置改变的见解和它们确实改变的事实一样有趣。<br>我们提出了两种衡量这些结构稳定性的方法：视觉解释，以及我们邻域分析的结果。<br>视觉解释在清晰度上是惊人的，但同时也得到了柱状图所示的数值结果的支持。</p><p>直方图的数字可以被解释为从二项分布中提取的数据。<br>例如，如果这两个序列是完全随机的，那么第二个序列中的一个基因的邻居就会从所有其他基因中随机抽取。<br>考虑到我们有6000个基因，并且使用了60个左右的邻域，大约是整个基因的1%，在交叉点<code>intersection</code>恰好有k个邻居的概率是</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbbub27sijk1rlvanrms91llgel.png" alt="image_1cbbub27sijk1rlvanrms91llgel.png-5.1kB"></p><p>当邻域的大小是基因总数的1%时观察0个邻居的预期频率大约是0.547;<br>观察一个邻居的期望频率是0.332;<br>两个邻居的频率大约是0.099，这使得观察三个或更多的邻居的期望频率只有0.022。<br>对于6000个基因来说，随机状态下，只有132个基因在两个随机序列之间有两个以上的共同之处，而实际上有几千个基因被观察到。<br>因此，柱状图和视觉比较表明，我们的排列组合之间的差异与随机的差别非常大。</p><p>图9显示了来自不同初始条件的6个典型的序列。<br>第一个序列的布局是用手和颜色勾勒出来的。<br>在其他的序列布局中，这些相同的基因被跟踪观察它们的相对位置是如何变化的。<br>两个引人注目的模式出现了。<br>在一个案例中，尽管有不同的随机种子，但聚类与第一个的聚类几乎完全相同。<br>在第二种情况下，产生的聚类是初始聚类的镜像。<br>这种镜像是非常合理的，因为只要保持相对距离，就没有理由期望任何首选的自然位置，所以旋转和镜像应该是很正常且可以被观察到的。<br>柱状图显示了镜像布局的良好的邻域特性（符合先前的预期）。</p><p>对结构的更密切关注确实揭示了一些大的变化，例如在图9中，我们注意到红色聚类从内部翻转到外部的位置。<br>这个红色的聚类有一些非常相似的连接，将它与山脊连接起来，如图3所示。<br>因此，它可以很容易地出现在山脊的相反方向/镜像位置。<br>请注意，邻域分析只会在两个的边界<code>frontiers</code>上发现一些差异。<br>正如预期的那样，柱状图显示的两个序列在邻里分析上几乎没有差别。<br>最令人鼓舞的事实是，大多数群体不仅在不同的初始条件下维持他们的相对位置，而且他们还保持着相似的聚类形状，这表示良好的内部一致性，这又一次得到了直方图的支持。<br>这些结果表明，当呈现同一数据集时，序化工具具有健壮的稳定性。<br>有了这些信息，我们就开始了对相似数据的微小变化如何影响聚类位置的研究。</p><p>理想情况下，人们会想要一种序化算法，它能对相似点的细微变化做出反应，即在布局中产生微小的变化。在某种程度上，其会影响布局从有序的状态到完全无序的、高熵的状态，因为相似点与越来越多的噪音混合在一起。<br>图10显示了基于实际相似性的初始聚类，以及在相关性中添加了越来越多的噪声的4个情况。<br>图11-14是相应的直方图，反映了与不断增加的噪声相关的变化。<br>值得注意的是，随着噪音的增加，一些大的结构仍然完好无损，但是有些，例如紫色和棕色的簇会变得更加无序。<br>它们本质上随着噪音的增加而融化。<br>另外，注意红色和绿色的点簇显然更能抵抗噪音。<br>这个熔化的比喻特别合适，因为它反映了在聚类群开始分裂之前必须进行内部顺序的随机化。</p><p>将越来越多的噪声与相似点<code>similarities</code>混合在一起，可以快速地看到哪些聚簇更有可能是工件<code>artifact</code>;<br>这些是在最小的噪音中融化的聚类。<br>这些信息很容易获得，我们相信它应该是基于聚类的每个分析的一部分。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>理解和使用稳定性是这里提出的重要主题。<br>尤其重要的是:</p><ul><li>确保聚类工具对随机起始条件的稳定性</li><li>确保可能的聚类的范围是充分覆盖(通过系统地搜索一个大范围的选择,或使用一个工具,不需要先验判断聚类的数量)</li><li>使用聚类工具应对逐渐添加噪声的反映来深入了解聚簇的实际强度。</li></ul><p>The two important analysis strategies presented here are: (1) use a probability weighted transformation of the correlation coefficients for the similarities, and (2) compute a small series of clusters with similarities mixed with increasing noise.<br>这里提出的两个重要的分析策略是：</p><ul><li>使用相似度的概率加权变换</li><li>计算一个具有相似性和不断增加的噪声的小系列的聚类。</li></ul><p>第一种策略可以更好地分离集群，而第二种策略则能观察单个聚类的强度。<br>我们还展示了一种有用的视觉方法，通过在一个<code>碱基序列</code>中对基因进行着色，并遵循这些彩色基因在其他序列中的相对运动，来跟踪另一个聚类的效果。<br>最后，我们提出了一个基于不同聚类下基因的本地邻居的交集的统计指标。</p><h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><p>我们要感谢查克迈耶斯的开始和资助在这个富有成果的领域的工作;<br>玛格丽特沃纳-沃什伯恩和斯图亚特金帮助使这成为微阵列分析的有用工具;<br>其余的开发团队包括布鲁斯亨德里克森、大卫约翰逊和海伦科勒。<br>我们也要感谢审查人员的有益评论和更正。</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>[ 1 ] Davidson, G.S., Hendrickson, B., Johnson, D.K., Meyers, C.E. &amp; Wylie, B.N. Knowledge mining with VxInsight: discovery through interaction . Journal of Intelligent Information Systems 11, 1998, 259-285.<br>[ 2 ] Spellman, P.T., Sherlock, G., Zhang, M.Q., Iyer, V.R., Anders, K., Eisen, M.B., Brown, P.O., Botstein, D. and Futcher, B., Comprehensive identification of cell cycle-regulated genes of the yeast Saccharomyces cerevisiae by microarray hybridization , Mol. Biology of the Cell, 1998, 9:3273-3297.<br>[ 3 ] Wise, J.A., Thomas, J.J., Pennock, K., Lantrip, D., Pottier, M., Schur, A., &amp; Crow, V. Visualizing the Non-Visual: Spatial Analysis and Interaction with Information from Text Documents , Proceedings of InfoVis ‘95, IEEE, 1995, 51-58.<br>[ 4 ] Kohonen, T. Self-organized formation of topologically correct feature maps . Biological Cybernetics, 1982, 43:59-69.<br>[ 5 ] MacQueen, J. Some methods for classification and analysis of multivariate observations . Proceedings of the Fifth Berkeley Symposium on Mathematical Statistics and Probability. Volume I:  Statistics,. University of California Press, Berkeley and Los Angeles, CA, 1967, pages 281-297<br>[ 6 ] York, J., Bohn, S., Pennock, K., &amp; Lantrip, D. Clustering and Dimensionality Reduction in SPIRE . Symp. on Advanced Intelligence Processing and Analysis, (1995), 73<br>[ 7 ] Wise, J.A. The ecological approach to text visualization . Journal of the American Society for Information Science 50(13), (1999), 1224-1233.<br>[ 8 ] Wilcox, R.R., Introduction to Robust Estimation and Hypothesis Testing , Academic Press, 1997, ISBN 0-12-751545-3<br>[ 9 ] Ostel, B., Statistics In Research Basic Concepts and Techniques for Research Workers , Iowa State University Press, Ames, Iowa, USA, 1963<br>[ 10 ] Fisher, R.A., On the probable error of a coefficient of correlation deduced from a small sample . Metron., 1921, 1 (No.4):3.<br>[ 11 ] Eades, P., A heuristic for graph drawing , Congressus Numerantium, 42, 1984, 149-160<br>[ 12 ] Fruchtermann, T. and Rheingold, E. Graph drawing by force-directed placement . Technical Report UIUCDCS-R-90- 1609, Computer Science, Univ. Illinois, Urbana-Champagne, Il., 1990<br>[ 13 ] Quinn, N. and Breur M., A force directed component placement procedure for printed circuit boards , IEEE Trans on Circuits and Systems, 1979, CAS-26, (6), 377-388<br>[ 14 ] Otten, R. and van Ginneken, L., The Annealing Algorithm , Kluwer Academic Publishers, Boston MA., 1989<br>[ 15 ] Kamada, T. and Kawai, S., Automatic display of network structures for human understanding , Technical Report 88-007, Department of Information Science, Tokyo University, 1988<br>[ 16 ] Davidson, R. and Harel, D., Drawing graphs nicely using simulated annealing , Technical Report CS89-13, Department of Applied Mathematics and Computer Science, The Weizmann Institute, Rehovot, Israel., 1989<br>[ 17 ] Kamada, T. and Kawai, S., An algorithm for drawing general undirected graphs , Information Processing Letters, 1989, 31, (1), 7-15<br>[ 18 ] Kamada, T. and Kawai, S., A simple method for computing general position is displaying three-dimensional objects , Computer Vision, Graphics, and Image Processing, 1988, 41, 43-56<br>[ 19 ] Kirkpatrick, S. Gelatt, C.D. and Vecchi, M.P., Optimization by simulated annealing , Science, 1983, 220, (4598), 671-680</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gephi源码的调试及Git同步</title>
      <link href="/article/3f8f.html"/>
      <url>/article/3f8f.html</url>
      
        <content type="html"><![CDATA[<h3 id="Fork原始Gephi项目"><a href="#Fork原始Gephi项目" class="headerlink" title="Fork原始Gephi项目"></a>Fork原始Gephi项目</h3><ol><li>进入Gephi的github地址：<a href="https://github.com/gephi/gephi" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/gephi/gephi</a></li><li>点击右上角的<code>fork</code>按钮将其fork到自己的github中：</li></ol><a id="more"></a><p> <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca53iver1qbkv0pq7o35k1iho9.png" alt="image_1ca53iver1qbkv0pq7o35k1iho9.png-80.4kB"></p><ol start="3"><li><p>fork完毕后我们就在自己的github中有了完整的备份：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca53pgdihf218v1g4b1cg1u6om.png" alt="image_1ca53pgdihf218v1g4b1cg1u6om.png-45.7kB"></p></li><li><p>然后点击上图中绿色的Clone按钮，注意必须在自己的备份中进行Clone以便后期提交自己的修改；<br>（如何确认本地或源只需看左上角的根目录名称和有无fork标记）<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca53ucsl1rno1la01adbakj1aun13.png" alt="image_1ca53ucsl1rno1la01adbakj1aun13.png-21.2kB"></p></li><li><p>将上图中的https地址复制待用；<br>关于如何将代码Clone到本地，有多种方法，可以选用NetBeans自带的Clone功能：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca54n00r1r3qrs0s3t18j21trrm.png" alt="image_1ca54n00r1r3qrs0s3t18j21trrm.png-42.2kB"></p><p>不过我这里连接github时总是出错（如下），所以使用了git for windows来进行克隆。</p></li></ol><h4 id="Git-for-Windows-的安装"><a href="#Git-for-Windows-的安装" class="headerlink" title="Git for Windows 的安装"></a>Git for Windows 的安装</h4><blockquote><p>**<br>在Windows上使用Git，可以从<a href="https://git-scm.com/download/win" target="_blank" rel="external nofollow noopener noreferrer">Git官网</a>直接下载安装程序(Setup)，（网速慢的同学请移步国内镜像），然后按默认选项安装即可。<br>安装完成后，在开始菜单里找到“Git”-&gt;“GitBash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功！<br>install-git-on-windows<br>安装完成后，还需要最后一步设置，在命令行输入：<br><code>$ git config --global user.name &quot;Your Name&quot;</code><br><code>$ git config --global user.email &quot;email@example.com&quot;</code><br>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。<br>这里的名字和地址对应你最常用的git仓库的用户名和密码（比如这里就是用Github的）<br>注意git config命令的–global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。**</p></blockquote><h3 id="克隆项目到本地"><a href="#克隆项目到本地" class="headerlink" title="克隆项目到本地"></a>克隆项目到本地</h3><ol><li><p>继续上述过程，首先进入到NetBeans的项目空间目录（不是必须的）。然后单机鼠标右键，这时应该有<code>Git Bush Here</code>的选项，点击后在弹出的黑框中输入如下命令：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca55gggfghf10tsmrb1bhoh9m23.png" alt="image_1ca55gggfghf10tsmrb1bhoh9m23.png-14.7kB"><br><code>git clone</code>是克隆项目的指令<br><code>https://github.com/TianZonglin/gephi</code>对应上文中复制备用的https的地址<br><code>YourProjectName</code>对应你想要给你的项目起的名字，如果不带这个参数，则会默认一个文件名；</p><p>克隆完成后文件夹如下所示：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca55upkg6pb1mu91d24140t30e2g.png" alt="image_1ca55upkg6pb1mu91d24140t30e2g.png-17kB"></p></li></ol><h3 id="NetBeans关联Maven"><a href="#NetBeans关联Maven" class="headerlink" title="NetBeans关联Maven"></a>NetBeans关联Maven</h3><p>现在开始使用NetBeans进行操作，由于Gephi的源代码使用的Maven进行构建的，所以首先需要在本机安装Maven（与Netbeans无关），Windows安装Maven的教程如下：</p><h4 id="Windows下的Maven下载与安装"><a href="#Windows下的Maven下载与安装" class="headerlink" title="Windows下的Maven下载与安装"></a>Windows下的Maven下载与安装</h4><blockquote></blockquote><ol><li><p>前往<a href="https://maven.apache.org/download.cgi下载最新版的Maven程序：" target="_blank" rel="external nofollow noopener noreferrer">https://maven.apache.org/download.cgi下载最新版的Maven程序：</a><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca56kl5tbt0v43nr3tpp1qlr3q.png" alt="image_1ca56kl5tbt0v43nr3tpp1qlr3q.png-61.3kB"></p></li><li><p>将文件解压到D:\Program Files\Apache\maven目录下:<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca56m53m15o71nojv13r6n1c485a.png" alt="image_1ca56m53m15o71nojv13r6n1c485a.png-54.3kB"></p></li><li><p>新建环境变量MAVEN_HOME，赋值D:\Program Files\Apache\maven<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca56o81u9op1gq9c4d182f1jtr6q.png" alt="image_1ca56o81u9op1gq9c4d182f1jtr6q.png-24.2kB"></p></li><li><p>编辑环境变量Path，追加%MAVEN_HOME%\bin;</p></li><li><p>至此，maven已经完成了安装，我们可以通过DOS命令<code>mvn -v</code>检查一下我们是否安装成功：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca56pkcd1k71i4c1f301bmp1sbu7a.png" alt="image_1ca56pkcd1k71i4c1f301bmp1sbu7a.png-29.5kB"><br>配置Maven本地仓库</p></li><li><p>在D:\Program Files\Apache\目录下新建maven-repository文件夹，该目录用作maven的本地库。</p></li><li><p>打开D:\Program Files\Apache\maven\conf\settings.xml文件，查找下面这行代码：<br><localrepository>/path/to/local/repo</localrepository><br>localRepository节点默认是被注释掉的，需要把它移到注释之外，然后将localRepository节点的值改为我们在之前创建的目录D:\Program Files\Apache\maven-repository。</p></li><li><p>localRepository节点用于配置本地仓库，本地仓库其实起到了一个缓存的作用，它的默认地址是 C:\Users\用户名.m2。<br>当我们从maven中获取jar包的时候，maven首先会在本地仓库中查找，如果本地仓库有则返回；如果没有则从远程仓库中获取包，并在本地库中保存。<br>此外，我们在maven项目中运行mvn install，项目将会自动打包并安装到本地仓库中。</p></li><li><p>运行一下DOS命令<br>mvn help:system<br>如果前面的配置成功，那么D:\Program Files\Apache\maven-repository会出现一些文件。**</p></li><li><p>需要将NetBeans和本地的Maven进行关联，点击 工具-&gt;选项-&gt;Java-&gt;Maven，在页面中修改Maven主目录，浏览本地的Maven目录并选定，如果正常，则会显示如下：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca5742nv16t86c916dgtok1j6v7n.png" alt="image_1ca5742nv16t86c916dgtok1j6v7n.png-3.8kB"></p></li></ol><h3 id="NetBeans打开Gephi源码"><a href="#NetBeans打开Gephi源码" class="headerlink" title="NetBeans打开Gephi源码"></a>NetBeans打开Gephi源码</h3><ol><li><p>Maven配置成功后，依次点击 文件-&gt;打开项目-&gt;找到之前克隆的项目的文件，然后会发现有特殊的[ma]图标，这是Maven项目的标识。双击打开即可：</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca567b4b1of2jf616np1gjbf8a3a.png" alt="image_1ca567b4b1of2jf616np1gjbf8a3a.png-17kB"></p></li><li><p>打开之后会发现项目名称为gephi，后跟[master]说明是从主分支上克隆的，并且已经被关联git。初次打开时由于需要加载gephi的依赖文件（Maven），所以会有一段时间处于读条状态（右下角）。第一次运行需要进行<code>构建</code>，这时会下载一些本地Maven库中不存在的jar包，所以可能构建过程很慢。</p></li></ol><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="NetBeans修改、执行、同步Gephi源代码"><a href="#NetBeans修改、执行、同步Gephi源代码" class="headerlink" title="NetBeans修改、执行、同步Gephi源代码"></a>NetBeans修改、执行、同步Gephi源代码</h3><ol><li><p><strong>执行</strong>：由于NetBeans的模块化构建，使得gephi整个项目没有一个传统的Main函数入口，这里的入口，在位于gephi源代码项目目录下的<code>模块</code>内的<code>gephi-app</code>模块，双击后即可独立的打开该模块，然后右键选项中点击运行即可打开Gephi主界面。 </p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1ca57k9781t6cr0rnr117rb8l58h.png" alt="image_1ca57k9781t6cr0rnr117rb8l58h.png-11.3kB"><br>上述打开的Gephi就是具有完整功能的客户端。</p></li><li><p><strong>修改布局源代码</strong>：类似的，找到模块中的LayoutPlugin，双击打开，然后在源包中就是全部的布局算法的源码了，针对具体的代码文件进行修改即可。一般的调试源码的步骤：修改源码-&gt;运行gephi-app，如果修改无效，请在修改源码后，对LayoutPlugin模块先进行一次<code>构建</code></p></li><li><p><strong>同步</strong>：回到开头的内容，使用Git的主要目的是进行版本的控制，这对于对源码的修修补补来说显得尤为重要，现在已经对源码进行了修改，可以按下面的操作将修改同步到自己fork的github中：</p><p> 3.1. 右键所修改的模块-&gt;点击Git-&gt;点击提交-&gt;添加修改的备注-&gt;点击提交<br> 3.2. 右键所有该的模块-&gt;点击Git-&gt;点击远程-&gt;点击推入-&gt;选择配置的Git资源库位置，如果没有默认资源库则需要配置-&gt;全部下一步结束</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Maven </tag>
            
            <tag> GitHub </tag>
            
            <tag> NetBeans </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA如何在项目中快速添加Maven依赖</title>
      <link href="/article/663c.html"/>
      <url>/article/663c.html</url>
      
        <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>在日常项目开发中，组件的引入是很平常的事情，一般来说，我们的项目由Maven构建，然后在需要新引入一个依赖时，只需在pom.xml中添加依赖描述即可，但是，有时我们的项目未必采用Maven构建，比如Spark项目就多采用sbt，或者直接添加jar包的方式，这时，如果需要添加某个外部依赖如果采用添加jar包的方式就会非常繁琐，不过IDEA为我们提供了方便的添加方式。</p><a id="more"></a><p>现在，以Spark项目中添加<code>gephi-toolkit</code>为例，来说明整个添加流程，具体流程如下：</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><ul><li><p>右键项目名称，点击<code>Open Module Settings</code>，转到<code>Dependencies</code></p></li><li><p>点击右侧绿色的加号，并选择 Library<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd2ti7aar5poa51hse1t1jn9um.png" alt></p></li><li><p>在弹出页面选择下面的<code>New Library</code>中的<code>Frome Maven</code><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd2tk06kdf7p2q1ic01c4qv0813.png" alt></p></li><li><p>在弹出页面输入<code>gephi-tookit</code>，点击搜索，然后选择对应的版本<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd5a71n51ij3tguso012jun1k9.png" alt></p></li><li><p>之后，注意选择该Library的级别为<code>Project</code>即可<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd2toms11fk61tbt94d1j4d1goh1t.png" alt></p></li><li><p>选完一定要点<code>Add Selected</code><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd2ts1ci157h7o91t6ojao1lcp2a.png" alt></p></li><li><p>最后，查看<code>dependencies</code>，我们发现<code>toolkit</code>已经被添加到项目<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cd5a9gv5buv1ri31j34gn4d4m.png" alt></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NameNode HA：如何防止集群脑裂现象</title>
      <link href="/article/aec3.html"/>
      <url>/article/aec3.html</url>
      
        <content type="html"><![CDATA[<p>转自：<a href="http://www.cnblogs.com/shenh062326/p/3870219.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.cnblogs.com/shenh062326/p/3870219.html</a><br>作者：南国故人</p><p>社区hadoop2.2.0 release版本开始支持NameNode的HA，本文将详细描述NameNode HA内部的设计与实现。</p><a id="more"></a><h3 id="为什么要Namenode-HA？"><a href="#为什么要Namenode-HA？" class="headerlink" title="为什么要Namenode HA？"></a>为什么要Namenode HA？</h3><ol><li>NameNode High Availability即高可用。</li><li>NameNode 很重要，挂掉会导致存储停止服务，无法进行数据的读写，基于此NameNode的计算（MR，Hive等）也无法完成。</li></ol><h3 id="Namenode-HA-的实现、技术难题"><a href="#Namenode-HA-的实现、技术难题" class="headerlink" title="Namenode HA 的实现、技术难题"></a>Namenode HA 的实现、技术难题</h3><ol><li>如何保持主和备NameNode的状态同步，并让Standby在Active挂掉后迅速提供服务，namenode启动比较耗时，包括加载fsimage和editlog（获取file to block信息），处理所有datanode第一次blockreport（获取block to datanode信息），保持NN的状态同步，需要这两部分信息同步。</li><li>脑裂（split-brain），指在一个高可用（HA）系统中，当联系着的两个节点断开联系时，本来为一个整体的系统，分裂为两个独立节点，这时两个节点开始争抢共享资源，结果会导致系统混乱，数据损坏。</li><li>NameNode切换对外透明，主Namenode切换到另外一台机器时，不应该导致正在连接的客户端失败，主要包括Client，Datanode与NameNode的链接。</li></ol><h3 id="社区NN的HA架构、原理、机制"><a href="#社区NN的HA架构、原理、机制" class="headerlink" title="社区NN的HA架构、原理、机制"></a>社区NN的HA架构、原理、机制</h3><ol><li>非HA的Namenode架构，一个HDFS集群只存在一个NN，DN只向一个NN汇报，NN的editlog存储在本地目录。</li></ol><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbra11qd1ig91ahiirumb471b9.png" alt="图1，NN HA架构（源自社区）"><br>社区的NN HA包括两个NN，主（active）与备（standby），ZKFC，ZK，share editlog。流程：集群启动后一个NN处于active状态，并提供服务，处理客户端和datanode的请求，并把editlog写到本地和share editlog（可以是NFS，QJM等）中。另外一个NN处于Standby状态，它启动的时候加载fsimage，然后周期性的从share editlog中获取editlog，保持与active的状态同步。为了实现standby在sctive挂掉后迅速提供服务，需要DN同时向两个NN汇报，使得Stadnby保存block to datanode信息，因为NN启动中最费时的工作是处理所有datanode的blockreport。为了实现热备，增加FailoverController和ZK，FailoverController与ZK通信，通过ZK选主，FailoverController通过RPC让NN转换为active或standby。</p><ol><li>关键问题：</li></ol><ul><li><p>保持NN的状态同步，通过standby周期性获取editlog，DN同时想standby发送blockreport。</p></li><li><p>防止脑裂<br>共享存储的fencing，确保只有一个NN能写成功。使用QJM实现fencing，下文叙述原理。<br>datanode的fencing。确保只有一个NN能命令DN。HDFS-1972中详细描述了DN如何实现fencing</p><ul><li>每个NN改变状态的时候，向DN发送自己的状态和一个序列号。</li><li>DN在运行过程中维护此序列号，当failover时，新的NN在返回DN心跳时会返回自己的active状态和一个更大的序列号。DN接收到这个返回是认为该NN为新的active。</li><li>如果这时原来的active（比如GC）恢复，返回给DN的心跳信息包含active状态和原来的序列号，这时DN就会拒绝这个NN的命令。</li><li>特别需要注意的一点是，上述实现还不够完善，HDFS-1972中还解决了一些有可能导致误删除block的隐患，在failover后，active在DN汇报所有删除报告前不应该删除任何block。</li></ul><p>客户端fencing，确保只有一个NN能响应客户端请求。让访问standby nn的客户端直接失败。在RPC层封装了一层，通过FailoverProxyProvider以重试的方式连接NN。通过若干次连接一个NN失败后尝试连接新的NN，对客户端的影响是重试的时候增加一定的延迟。客户端可以设置重试此时和时间。</p></li></ul><h3 id="ZKFC的设计"><a href="#ZKFC的设计" class="headerlink" title="ZKFC的设计"></a>ZKFC的设计</h3><ul><li>FailoverController实现下述几个功能<ul><li>监控NN的健康状态</li><li>向ZK定期发送心跳，使自己可以被选举。</li><li>当自己被ZK选为主时，active FailoverController通过RPC调用使相应的NN转换为active。</li></ul></li><li>为什么要作为一个deamon进程从NN分离出来<ul><li>防止因为NN的GC失败导致心跳受影响。</li><li>FailoverController功能的代码应该和应用的分离，提高的容错性。</li><li>使得主备选举成为可插拔式的插件。</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbracpvr1bhu7nq1mqrsgc1ive16.png" alt="图2 FailoverController架构（源自社区）"></p><ul><li>FailoverController主要包括三个组件，<ul><li>HealthMonitor 监控NameNode是否处于unavailable或unhealthy状态。当前通过RPC调用NN相应的方法完成。</li><li>ActiveStandbyElector 管理和监控自己在ZK中的状态。</li><li>ZKFailoverController 它订阅HealthMonitor 和ActiveStandbyElector 的事件，并管理NameNode的状态。</li></ul></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="QJM的设计"><a href="#QJM的设计" class="headerlink" title="QJM的设计"></a>QJM的设计</h3><ul><li><p>Namenode记录了HDFS的目录文件等元数据，客户端每次对文件的增删改等操作，Namenode都会记录一条日志，叫做editlog，而元数据存储在fsimage中。为了保持Stadnby与active的状态一致，standby需要尽量实时获取每条editlog日志，并应用到FsImage中。这时需要一个共享存储，存放editlog，standby能实时获取日志。这有两个关键点需要保证， 共享存储是高可用的，需要防止两个NameNode同时向共享存储写数据导致数据损坏。</p></li><li><p>是什么，Qurom Journal Manager，基于Paxos（基于消息传递的一致性算法）。这个算法比较难懂，简单的说，Paxos算法是解决分布式环境中如何就某个值达成一致，（一个典型的场景是，在一个分布式数据库系统中，如果各节点的初始状态一致，每个节点都执行相同的操作序列，那么他们最后能得到一个一致的状态。为保证每个节点执行相同的命令序列，需要在每一条指令上执行一个”一致性算法”以保证每个节点看到的指令一致）</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1cbrag8vv1kbde2a19b97o81cnh1j.png" alt="图3 QJM架构"></p><ul><li><p>如何实现</p><ul><li>初始化后，Active把editlog日志写到2N+1上JN上，每个editlog有一个编号，每次写editlog只要其中大多数JN返回成功（即大于等于N+1）即认定写成功。</li><li>Standby定期从JN读取一批editlog，并应用到内存中的FsImage中。</li><li>如何fencing： NameNode每次写Editlog都需要传递一个编号Epoch给JN，JN会对比Epoch，如果比自己保存的Epoch大或相同，则可以写，JN更新自己的Epoch到最新，否则拒绝操作。在切换时，Standby转换为Active时，会把Epoch+1，这样就防止即使之前的NameNode向JN写日志，也会失败。</li><li>写日志：<ul><li>NN通过RPC向N个JN异步写Editlog，当有N/2+1个写成功，则本次写成功。</li><li>写失败的JN下次不再写，直到调用滚动日志操作，若此时JN恢复正常，则继续向其写日志。</li><li>每条editlog都有一个编号txid，NN写日志要保证txid是连续的，JN在接收写日志时，会检查txid是否与上次连续，否则写失败。  </li></ul></li><li>读日志：<ul><li>定期遍历所有JN，获取未消化的editlog，按照txid排序。</li><li>根据txid消化editlog。</li></ul></li><li>切换时日志恢复机制<ul><li>主从切换时触发</li><li>准备恢复（prepareRecovery），standby向JN发送RPC请求，获取txid信息，并对选出最好的JN。</li><li>接受恢复（acceptRecovery），standby向JN发送RPC，JN之间同步Editlog日志。</li><li>Finalized日志。即关闭当前editlog输出流时或滚动日志时的操作。</li><li>Standby同步editlog到最新</li></ul></li><li>如何选取最好的JN<ul><li>有Finalized的不用in-progress</li><li>多个Finalized的需要判断txid是否相等</li><li>没有Finalized的首先看谁的epoch更大</li><li>Epoch一样则选txid大的。</li></ul></li></ul></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="https://issues.apache.org/jira/secure/attachment/12480489/NameNode%20HA_v2_1.pdf" target="_blank" rel="external nofollow noopener noreferrer">https://issues.apache.org/jira/secure/attachment/12480489/NameNode%20HA_v2_1.pdf</a></li><li><a href="https://issues.apache.org/jira/secure/attachment/12521279/zkfc-design.pdf" target="_blank" rel="external nofollow noopener noreferrer">https://issues.apache.org/jira/secure/attachment/12521279/zkfc-design.pdf</a></li><li><a href="https://issues.apache.org/jira/secure/attachment/12547598/qjournal-design.pdf" target="_blank" rel="external nofollow noopener noreferrer">https://issues.apache.org/jira/secure/attachment/12547598/qjournal-design.pdf</a></li><li><a href="https://issues.apache.org/jira/browse/HDFS-1972" target="_blank" rel="external nofollow noopener noreferrer">https://issues.apache.org/jira/browse/HDFS-1972</a></li><li><a href="https://issues.apache.org/jira/secure/attachment/12490290/DualBlockReports.pdf" target="_blank" rel="external nofollow noopener noreferrer">https://issues.apache.org/jira/secure/attachment/12490290/DualBlockReports.pdf</a></li><li><a href="http://svn.apache.org/viewvc/hadoop/common/branches/branch-2.2.0/" target="_blank" rel="external nofollow noopener noreferrer">http://svn.apache.org/viewvc/hadoop/common/branches/branch-2.2.0/</a></li><li><a href="http://yanbohappy.sinaapp.com/?p=205" target="_blank" rel="external nofollow noopener noreferrer">http://yanbohappy.sinaapp.com/?p=205</a></li></ol><hr><p>转自：<a href="http://www.cnblogs.com/shenh062326/p/3870219.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.cnblogs.com/shenh062326/p/3870219.html</a><br>作者：南国故人</p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集群 </tag>
            
            <tag> 转载 </tag>
            
            <tag> HA </tag>
            
            <tag> 脑裂 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SourceInsight-强大的代码编辑和浏览工具-中文教程</title>
      <link href="/article/bb72.html"/>
      <url>/article/bb72.html</url>
      
        <content type="html"><![CDATA[<h4 id="Source-Insight概述"><a href="#Source-Insight概述" class="headerlink" title="Source Insight概述"></a>Source Insight概述</h4><ul><li>是一个面向项目开发的程序编辑器和代码浏览器，它拥有内置的对C/C++，C#和Java等程序的分析。能分析源代码并在工作的同时动态维护它自己的符号数据库，并自动显示有用的上下文信息。</li><li>提供了最快速的对源代码的导航和任何程序编辑器的源信息。</li><li>提供了快速的访问源代码和源信息的能力。</li><li>自动创建并维护它自己高性能的符号数据库，包括函数、method、全局变量、结构、类和工程源文件里定义的其它类型的符号。其以迅速地更新的文件信息，即使在编辑代码的时候。而且符号数据库的符号可以自动创建到的工程文件中。</li><li>总而言之，<strong>SI是一款强大的代码阅读、编辑工具。</strong></li></ul><a id="more"></a><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="现有资料的不足"><a href="#现有资料的不足" class="headerlink" title="现有资料的不足"></a>现有资料的不足</h4><p>Source Insight作为一款功能强大的代码编辑查看软件，网上教程很多，但是都侧重某一方面展开介绍，很少有比较系统的完整软件的介绍，写这篇文档的目的就是尝试完成这项工作。<br>此文档围绕Source Insight实际操作的情景，介绍了该软件的大部分功能，对于使用者来说，其提供了：</p><ul><li>快速使用该软件的入门教程</li><li>对该软件更进一步的详细介绍（对置顶菜单栏、工具栏以及右键菜单栏的功能进行了解释说明）</li><li>以实例的形式介绍了一些Source Insight的高级扩展功能</li></ul><h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>由于本人能力有限，加之时间紧迫，虽然做了很大努力但是所涉及的依然能涵盖Source Insight功能的全部，而且有些地方的描述可能有误，有些地方的描述可能并不清楚，种种不足还请读者原谅。如果文中出现了错误描述，还请务必在本文最后留言告知，或者使用<a href="tianzonglin@qq.com">邮件</a>进行联系。</p><h4 id="文档原文"><a href="#文档原文" class="headerlink" title="文档原文"></a>文档原文</h4><p>请等待下方插件加载完毕后点击插件右上角下载按钮进行下载，如果加载出错（出现空白）请直接<a href="http://asus.myds.me:6543/SourceInsight%E4%B8%AD%E6%96%87%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B[2016].pdf" target="_blank" rel="external nofollow noopener noreferrer">点击查看全文</a></p><iframe src="http://asus.myds.me:6543/SourceInsight%E4%B8%AD%E6%96%87%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B[2016].pdf" style="width:100%;" frameborder="0" height="1000px"></iframe>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SourceInsight3 </tag>
            
            <tag> 中文教程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>谈一谈本站的来历</title>
      <link href="/article/b1f1.html"/>
      <url>/article/b1f1.html</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a><strong>写在前面</strong></h3><p>许久之前，大概是在13年我接触到了CSDN，知道了有技术博客这么一回事，并且在14年9月20号我在CSDN写了我的第一篇博客文章，当时只能使用富文本编辑，因此文章里有时候还会解析出html的代码，虽然不影响阅读，但是体验很不好，后来CSDN也支持Markdown编辑了，但总归感觉写文章非常不方便，一是费事需要打开浏览器的页面进行编辑，另一个原因是杂乱的东西太多包括csdn的文章推荐等等，这都使得我希望找到一种新的写文章的方式，可以及时、快速、舒服的进行记录，并且还能够发布出去供所有人访问。</p><a id="more"></a><p>（本人也是小白选手一枚，各方面都还可也但远不及精通境界，对于我这一类的人，估计大部分都是懒得出奇，纵使有豪情壮志，往往做的时候要干什么都忘得一干二净了。所以非常需要及时记录所见所学，当然如果能稍加修饰，与他人分享，那也算是赠人玫瑰手留余香，岂不美哉）</p><h4 id="有道云笔记"><a href="#有道云笔记" class="headerlink" title="有道云笔记"></a><strong>有道云笔记</strong></h4><p>这是我做出改变的第一步，抛弃了CSDN拥抱了有道云笔记，虽然这只是众多笔记软件中的一个，但是也带给我了很多方便，尤其是在16年下半年我开始了研究生生涯，有道云笔记在平时需要记录的时候真的是帮了我大忙了：随手就可以编辑，Windows版，网页版还有App都可以进行编辑，这些都非常给力，当然也可以指定文章进行分享，别人访问链接就可以查看文章，还有也是支持有道云笔记用户的分组共享，这也是非常方便的。<br>但是，不足显而易见，别人访问的只是链接，这是硬伤；另外我一直觉着他的Markdown支持一般，所以因为这一点我也找到了我的下一个归宿。</p><h4 id="Cmd-Markdown"><a href="#Cmd-Markdown" class="headerlink" title="Cmd Markdown"></a><strong>Cmd Markdown</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buagdvvft841m3c1r861vkb1qas9.png" alt="image_1buagdvvft841m3c1r861vkb1qas9.png-281.9kB">  </p><p>这应该算是个小众软件了，当然也是众多Markdown编辑器中并不起眼的一个，但是俗话说先入为主，况且他提供的功能也足够我使用了，Markdown的解析超越了标准解析器，虽然这有可能会在文章转移时出现一些问题，但这并不影响其在软件内的展示效果，分屏实时展示、编辑自动同步、发布、更新这些功能自然是必备的，而且非常的简洁，整个客户端非常的轻便，曾经一度非常享受使用这款软件来编写Markdown的文章，但是但是但是。美中不足的是，分享之后仍然是简单的单文章共享，虽然提供了整个目录的入口，但是访问体验还是不好，而且移动端的访问非常丑陋，终于终于，在几个星期前的某一天，我踏上了搭建博客的道路。</p><h4 id="WordPress"><a href="#WordPress" class="headerlink" title="WordPress"></a><strong>WordPress</strong></h4><p>讲真，虽然是博客大户，但是我并没有花很多时间在它上边，很重要的原因是它需要有独立的空间，属于带后台的、有完整用户权限的博客系统，虽然功能强大，但是个人使用，太累赘了，不够轻量，所以放弃了。</p><h4 id="Jekyll"><a href="#Jekyll" class="headerlink" title="Jekyll"></a><strong>Jekyll</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buajmk0918ju1c62b0gvs16sdm.png" alt="image_1buajmk0918ju1c62b0gvs16sdm.png-26.5kB">  </p><p>说起这个，我差点就上车了，因为GitHub现在直接官方支持用户生成Jekyll博客了，但是由于GitHub上的几款主题实在是太丑啦，当时就让我丢掉了兴趣，又恰逢接触到了Hexo，然后看到了一些比较言论，所以就抛弃之了。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buakkartgjvkbf1c3a9j0d1n13.png" alt="image_1buakkartgjvkbf1c3a9j0d1n13.png-132.2kB"></p><h4 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a><strong>Hexo</strong></h4><p>为什么选择Hexo?概括的说，是因为：安装快、易用、主题多实用又好看、圈子活跃。</p><ul><li><p>安装快<br>除了nodejs的下载需要耗费点时间，其他我找不出需要时间的地方了</p></li><li><p>易用<br>默认的主题虽然巨丑无比，但是直接就能用，如果node和hexo安装顺利，几乎一小时以内就可以完成你的博客搭建工作，而且更换主题也非常的方便，直接[git clone`然后修改配置文件就大功告成，整个过程非常流畅。</p></li><li><p>主题实用又好看<br>关于Hexo的主题，真的是太多了，当然这么多主题绝对有你喜欢的，主题大都在Github开源且配有详细的配置说明，让你可以放心的为自己的博客更换不同的主题风格。</p></li><li><p>圈子活跃<br>确实是的，包括最广为人知的<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="external nofollow noopener noreferrer">Next</a>主题在内的众多主题，在其Github项目中会发现有很多的issue，都是一些使用时出现的问题等等，当然大部分都是closed已解决状态，如果你在使用某主题时出现了问题，最直接的方式就是去Github询问作者本人。</p></li></ul><h3 id="写在中间"><a href="#写在中间" class="headerlink" title="写在中间"></a><strong>写在中间</strong></h3><p>大概在几周之前就搭好了博客，但苦于没有好看的主题，找到<a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank" rel="external nofollow noopener noreferrer">indigo</a>后，终于安了心，于是乎一口气把之前Cmd Markdown里所有的存货还有些有道云笔记的历史遗留都搬到Hexo上了，当然CSDN还有一堆，但是我懒得动了。搭建好Hexo，换好主题后，终于可以舒舒服服的写文章了，无关乎平台，也不需要登录。此时此刻，我使用Cmd Markdown写的这篇文章，写完后导出到Hexo的 <code>_post</code>文件夹中，然后直接运行我放在桌面的deploy.bat（里面只有一条命令那就是 <code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</code>），稍等片刻，全世界的人就可以在本博客访问到这篇文章啦！是不是非常方便 :) </p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a><strong>写在最后</strong></h3><p>关于自己的博客，当然需要精心打扮，上面说的都很基础，其实作为一个独立站点，需要考虑的东西还是很多的，主要有下面一些：</p><ul><li><p>域名的绑定<br>这是外界对整个博客最直观的感受之一，当然不是必须的，但现在一般域名也就几块钱一年，而且瞬间使自己的站点显得高大上，何乐而不为。这里要注意的是我们只需要购买域名就行了，空间实名备案什么的跟咱们没关系，因为博客是直接托管在Github或者Coding上的！</p></li><li><p>托管的平台：Hexo+Github VS Hexo+Coding<br>曾经一度我放在Github，但是其更新后的部署速度让我吃惊，大概需要几分钟，访问也不是那么快速，权衡了一下最终还是托管到了<a href="https://coding.net" target="_blank" rel="external nofollow noopener noreferrer">Coding</a>上，体验什么的感觉丝毫不输Github，最重要的是国内源就是快。</p></li><li><p>md文章的解析差异<br>我们都知道Markdown有一套标准解析语法，但是其扩展却有千千万，就拿我现在的Cmd Markdown这款软件来说，‘#文字’之间不需要空格，但是发布在Hexo上则必须是‘# 文字’这种形式。其他差异还有很多，比如#不能紧跟在上一段后，需要加空行等等，这些自己实际试用一下就知道了，而且修改也比较容易。</p></li><li><p>不可或缺的评论<br>关于评论，我觉得是博客称之为博客的原因之一，如果没有评论功能，那就失去了共同探讨的机会，也就失去了博客本身存在的价值，虽然有很多人关闭了评论，但不能否认多数人还是希望听到别人的声音，无论是意见不同的分歧，还是志同道合的点赞，在我看来这都是不可或缺的。要注意，现在多说死了，网易云评论好像也完蛋了，disqus国内太慢，然后现在好像来比力还可以，除此之外就是基于GitApp的<a href="https://github.com/gitalk/gitalk" target="_blank" rel="external nofollow noopener noreferrer">gitalk</a>和<a href="https://github.com/imsun/gitment" target="_blank" rel="external nofollow noopener noreferrer">gitment</a>了，现在我正在使用<a href="https://github.com/imsun/gitment" target="_blank" rel="external nofollow noopener noreferrer">gitment</a>作为评论，还是很不错的，看到这里，还不抓紧在下面评论一波！</p></li><li><p>必不可少的用户统计<br>现在百度、腾讯、CNZZ、谷歌等都有类似站长统计的服务，另外在我使用的indigo主题中自带有‘不蒜子’的统计，其将PV和UV显示在最下方，另外，也支持前面讲的几种统计，试过水之后我认为百度统计大概对于国内站点来说是最准确好用的了。</p></li><li><p>当然要听歌<br>现在我把high一下放到博客里了，由于放在header里移动端会太挤（因为我的名字太长了），所以放到左侧menu里了。坑爹的是第一次集成时并不好使，原来音乐源是amazon的，果断找了一个网易云的换上。非常完美。</p></li><li><p>站点的SEO<br>这方面其实是个人博客与CSDN这类博客最大的差距所在了吧，如果我们想将自己的站点更好的暴露在搜索引擎的视野范围内，那要做的工作还是很多的，这方面对一个博客来讲显得尤为重要。现在我按<a href="http://www.jianshu.com/p/86557c34b671" target="_blank" rel="external nofollow noopener noreferrer">这篇文章</a>的叙述，进行了一些简单操作。</p><ul><li><p>碰见一个坑：添加谷歌的<a href="https://www.google.com/webmasters/" target="_blank" rel="external nofollow noopener noreferrer">Search Console</a>死活验证失败，使用GoogleAnalysis关联也是失败的，非常崩溃，直到看到了下图，网站预览图里那几行诗真的是惊到我了，那特喵的是CodingPages的跳转页!!真相原来在这儿。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buavrbnb1gmn1a3n8ls10p0ptr1p.png" alt="image_1buavrbnb1gmn1a3n8ls10p0ptr1p.png-25.1kB">  </p></li><li><p>知道真相之后马上去Coding的项目中的Pages设置中按要求把署名加到了主页上，居然审核要2工作日，吐槽一下。添加之后，博客的footer变成这个样子了，还还凑合把。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bub01d04eq08lm1fk0anq1ul2j.png" alt="image_1bub01d04eq08lm1fk0anq1ul2j.png-13.1kB"></p></li></ul></li><li><p>其他：想到了再添加</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 博客搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对SNAP图数据进行度分布统计</title>
      <link href="/article/8a40.html"/>
      <url>/article/8a40.html</url>
      
        <content type="html"><![CDATA[<h2 id="统计度分布的数据集"><a href="#统计度分布的数据集" class="headerlink" title="统计度分布的数据集"></a>统计度分布的数据集</h2><table><thead><tr><th>Name</th><th>Type</th><th>Nodes</th><th>Edges</th><th>Description</th></tr></thead><tbody><tr><td>ego-Facebook</td><td>Undirected</td><td>4,039</td><td>88,234</td><td>Social circles from <strong>Facebook</strong> (anonymized)</td></tr><tr><td>ego-Gplus</td><td>Directed</td><td>107,614</td><td>13,673,453</td><td>Social circles from <strong>Google+</strong></td></tr><tr><td>ego-Twitter</td><td>Directed</td><td>81,306</td><td>1,768,149</td><td>Social circles from <strong>Twitter</strong></td></tr><tr><td>soc-Epinions1</td><td>Directed</td><td>75,879</td><td>508,837</td><td>Who-trusts-whom network of <strong>Epinions.com</strong></td></tr><tr><td>soc-LiveJournal1</td><td>Directed</td><td>4,847,571</td><td>68,993,773</td><td><strong>LiveJournal</strong> online social network</td></tr><tr><td>soc-Pokec</td><td>Directed</td><td>1,632,803</td><td>30,622,564</td><td><strong>Pokec</strong> online social network</td></tr><tr><td>soc-Slashdot0811</td><td>Directed</td><td>77,360</td><td>905,468</td><td><strong>Slashdot</strong> social network from November 2008</td></tr><tr><td>soc-Slashdot0922</td><td>Directed</td><td>82,168</td><td>948,464</td><td><strong>Slashdot</strong> social network from February 2009</td></tr><tr><td>wiki-Vote</td><td>Directed</td><td>7,115</td><td>103,689</td><td><strong>Wikipedia</strong> who-votes-on-whom network</td></tr></tbody></table><a id="more"></a><h3 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h3><p>数据集格式大多为A-&gt;B格式，部分数据集的数据注释：<br><strong>wiki-Vote</strong> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Directed graph (each unordered pair of nodes is saved once): Wiki-Vote.txt </span><br><span class="line"># 有向图，每个节点的无序对只存在一次，即无重复</span><br><span class="line"># Wikipedia voting on promotion to administratorship (till January 2008). Directed edge A-&gt;B means user A voted on B becoming Wikipedia administrator.</span><br><span class="line"># 维基百科投票晋升到管理人的职位（直到2008年1月）。定向边缘A-B意味着用户A给用户B投票</span><br><span class="line"># Nodes: 7115 Edges: 103689</span><br><span class="line"># FromNodeIdToNodeId</span><br><span class="line">301412</span><br><span class="line">303352</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>soc-xx,eg:soc-Epinions1</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Directed graph (each unordered pair of nodes is saved once): soc-Epinions1.txt </span><br><span class="line"># 有向图，每个节点的无序对只存在一次，即无重复</span><br><span class="line"># Directed Epinions social network</span><br><span class="line"># Nodes: 75879 Edges: 508837</span><br><span class="line"># FromNodeIdToNodeId</span><br><span class="line">04</span><br><span class="line">05</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><strong>ogo-xxx</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据文件较复杂，一般分为xxx，xxx-combined，readme三个文件；</span><br><span class="line">xxx文件一般格式很复杂，具体意义待研究，这里体现网络的使用的是xxx-combined文件，</span><br><span class="line">xxx-combind数据格式即A-&gt;B格式</span><br></pre></td></tr></table></figure><h3 id="数据集统计"><a href="#数据集统计" class="headerlink" title="数据集统计"></a>数据集统计</h3><p>相关的数据集统计都在SNAP对应的数据集页面有详细显示<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c0o1gjr71n4f1nk1sc5rbtv17m.png" alt="image_1c0o1gjr71n4f1nk1sc5rbtv17m.png-54.9kB"></p><h2 id="节点度分布的计算"><a href="#节点度分布的计算" class="headerlink" title="节点度分布的计算"></a>节点度分布的计算</h2><p>从小规模数据集ego-Facebook和wiki-Vote开始计算</p><pre><code>A-&gt;BA-&gt;CA-&gt;DB-&gt;DB-&gt;Aind(A)=1,outd(A)=3, d(A)=4ind(B)=1,outd(B)=2, d(B)=3ind(C)=1,outd(C)=0, d(C)=1ind(D)=2,outd(D)=0, d(D)=2</code></pre><h3 id="第一阶段：统计全部节点的度"><a href="#第一阶段：统计全部节点的度" class="headerlink" title="第一阶段：统计全部节点的度"></a>第一阶段：统计全部节点的度</h3><h4 id="构造思想"><a href="#构造思想" class="headerlink" title="构造思想"></a>构造思想</h4><pre><code>**map阶段：**A-&gt;B拆分成&apos;A-&apos;+&apos;-B&apos;,转换为KeyValuePair：&lt;A-,1&gt;和&lt;-B,1&gt;即结果为：&lt;A-,1&gt;，&lt;-B,1&gt;，&lt;A-,1&gt;，&lt;-C,1&gt;，&lt;A-,1&gt;，&lt;-D,1&gt;，&lt;B-,1&gt;，&lt;-D,1&gt;，&lt;B-,1&gt;，&lt;-A,1&gt;**reduce阶段：**规约为&lt;A-,3&gt;，&lt;-B,1&gt;...</code></pre><h4 id="任务流程"><a href="#任务流程" class="headerlink" title="任务流程"></a>任务流程</h4><ul><li>启动集群(三虚拟机)，start-all.sh开启hadoop（hdfs）</li><li>将源数据加载到hdfs</li><li>使用IDEA进行远程作业(mapreduce)提交</li><li>返回结果</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="实际操作：1-上传数据导hdfs"><a href="#实际操作：1-上传数据导hdfs" class="headerlink" title="实际操作：1.上传数据导hdfs"></a>实际操作：1.上传数据导hdfs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 DATA0001]$ ls</span><br><span class="line">facebook_combined.txt  Slashdot0811.txt  soc-Epinions1.txt     soc-pokec-relationships.txt     Wiki-Vote.txt gplus_combined.txt     Slashdot0902.txt     soc-LiveJournal1.txt     twitter_combined.txt</span><br><span class="line">[hadoop@hadoop01 ~]$ hadoop fs -mkdir &#x2F;TVCG&#x2F;SNAP</span><br><span class="line">[hadoop@hadoop01 ~]$ hadoop fs -put DATA0001 &#x2F;TVCG&#x2F;SNAP&#x2F;            </span><br><span class="line">#此过程可能会比较慢，会卡几分钟的时间（副本复制，分块等等）</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c0ofl79t1la7j19aib1gpevb6m.png" alt="image_1c0ofl79t1la7j19aib1gpevb6m.png-30.1kB"><br>上述意义是：该文件（400多M）被划分成了四个block，400/3=3.x 应该是4个block，正确无误<br>另外，当前块的所在节点为hadoop01，02，04，即此处是容错的三副本，这里可以优化一下，虚拟机小集群其实可以改为1，即取消副本，减少存储开销。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 修改hdfs-site.xml的配置项，修改完需要重启hdfs！</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">            &lt;name&gt;dfs.replication&lt;&#x2F;name&gt;</span><br><span class="line">                &lt;value&gt;1&lt;&#x2F;value&gt;</span><br><span class="line">        &lt;&#x2F;property&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c0ogn9901nke1muqk761oqf18l01j.png" alt="image_1c0ogn9901nke1muqk761oqf18l01j.png-25.4kB"><br>修改完后发现所在节点只剩下hadoop01了，因为关闭了三副本策略，所以四个节点只有hadoop01存有数据，同时作为namenode的01节点负担会很重，而且计算时会有网络传输开销，但是：<br>由于是虚拟机集群，存储是很宝贵的，网络传输开销显得不重要，所以这样没毛病（节省两倍空间）。</p><h4 id="实际操作：2-构建mapreduce"><a href="#实际操作：2-构建mapreduce" class="headerlink" title="实际操作：2.构建mapreduce"></a>实际操作：2.构建mapreduce</h4><p>先前的思路在实施起来有一定的复杂性，那么如果需求是计算节点的度，而且不分出度入度，那么可以简化成WordCount问题！</p><pre><code>A-&gt;BA-&gt;CA-&gt;DB-&gt;DB-&gt;Ad(A)=4, d(B)=3, d(C)=1, d(D)=2</code></pre><h3 id="第二阶段：对上述度数结果进行计数"><a href="#第二阶段：对上述度数结果进行计数" class="headerlink" title="第二阶段：对上述度数结果进行计数"></a>第二阶段：对上述度数结果进行计数</h3><h4 id="构造思想-1"><a href="#构造思想-1" class="headerlink" title="构造思想"></a>构造思想</h4><pre><code>mapreduce结果：A 4B 3C 2D 2度分布为：零次度1、两次度2、一次度3、一次度4</code></pre><h4 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作"></a>实际操作</h4><ul><li>将mapred结果的key丢弃，只留下value，即度数</li><li>对度数进行统计计数</li><li>本步骤结果为 &lt;degree_value,degree_count&gt;</li></ul><h4 id="操作结果"><a href="#操作结果" class="headerlink" title="操作结果"></a>操作结果</h4><pre><code>mapreduce结果中的values再统计的结果：&lt;4,1&gt;&lt;3,1&gt;&lt;2,2&gt;将上述结果画图即整个图的度分布</code></pre><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1keqocnh9e1m421rah186b87i9.png" alt="image_1c1keqocnh9e1m421rah186b87i9.png-85.6kB"></p><p>为了验证度分布符合幂律的特点，可以分别将XY轴取ln底，那么图像会呈现一条斜率为负的倾斜直线，此斜率的大小正是（Y=cX^(-r)）中的幂r的大小，由上面的叙述可知，可以通过对数底坐标轴的呈现图像是否为一条直线来判断度分布是不是符合幂律分布的特性。下面三组是上述九个数据集中度分布十分符合幂律分布的图像。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1s3551h1o5m1ib61sgj1cvv16ko9.png" alt="image_1c1s3551h1o5m1ib61sgj1cvv16ko9.png-47.3kB">  </p><p>另外，由于数据及场景的特殊性，度分布并不一定完全符合幂律分布，或者说不可能完全符合，只是接近幂律的程度有大有小，下面三组就是九中数据集中符合幂律分布程度较差的图像。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1s39ojr17k61kdie469q51j9im.png" alt="image_1c1s39ojr17k61kdie469q51j9im.png-47.4kB"></p><h2 id="度分布的统计学特性"><a href="#度分布的统计学特性" class="headerlink" title="度分布的统计学特性"></a>度分布的统计学特性</h2><p>（以下转自<a href="http://blog.sina.com.cn/s/blog_49f6467e0100qh9l.html" target="_blank" rel="external nofollow noopener noreferrer">网络</a>）</p><h3 id="泊松分布和幂律分布"><a href="#泊松分布和幂律分布" class="headerlink" title="泊松分布和幂律分布"></a>泊松分布和幂律分布</h3><blockquote><p>自然界与社会生活中，许多科学家感兴趣的事件往往都有一个典型的规模，个体的尺度在这一特征尺度附近变化很小。比如说人的身高，中国成年男子的身高绝大多数都在平均值1.70米左右，当然地域不同，这一数值会有一定的变化，但无论怎样，我们从未在大街上见过身高低于10厘米的“小矮人”，或高于10米的“巨人”。如果我们以身高为横坐标，以取得此身高的人数或概率为纵坐标，可绘出一条<strong>钟形分布曲线</strong>，这种<strong>曲线两边衰减地极快</strong>；类似这样以一个<strong>平均值就能表征出整个群体特性的分布</strong>，我们称之为泊松分布。<br>对于另一些分布，像国家GDP或个人收入的分布，情况就大不一样了，个体的尺度可以在很宽的范围内变化，这种波动往往可以跨越多个数量级。幂律分布的示意图如图1右图所示，其通式可写成y=cx^(−r)，其中x，y是正的随机变量，c，r均为大于零的常数。这种分布(幂律分布)的共性是<strong>绝大多数事件的规模很小</strong>，而只有<strong>少数事件的规模相当大</strong>。对上式两边取对数，可知lny与lnx满足线性关系lny=lnc-rlnx，也即在双对数坐标下，幂律分布表现为<strong>一条斜率为幂指数的负数的直线</strong>，这一线性关系是判断给定的实例中随机变量是否满足幂律的依据。泊松分布(左)与“长尾”/幂律分布(右)。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1l4qmcu1nri1bdcauf175pfvpm.png" alt="image_1c1l4qmcu1nri1bdcauf175pfvpm.png-39.5kB"><br>从统计物理学来看，网络是一个包含了大量个体及个体之间相互作用的系统。近年来在对复杂网络的研究过程中，科学家们亦发现了众多的幂律分布，虽然这些网络在结构及功能上是如此的千变万化，相差迥异。复杂网络中<strong>节点的度值k</strong>相对于<strong>它的概率P(k)</strong>满足幂律关系，且幂指数多在大于2小于3的范围内；这一现象是如此的普遍，如此地令人惊叹不已，以至于人们给具有这种性质的网络起了一个特别的名字——<strong>无标度网络</strong>。这里的无标度是指网络<strong>缺乏一个特征度值</strong>（或平均度值），即节点度值的波动范围相当大。<br>在过去的40多年里，科学家们一直想当然地认为现实中的网络都是随机的，随机图论就是专门为了研究随机网络而发展起来的一门数学学科，但无标度特性的发现打破了这种构想。随机网络的度分布是泊松分布，度值比平均值高许多或低许多的节点，都十分罕见，是一种高度<strong>“民主”</strong>的网络，而无标度网络的度分布则是幂律分布，节点度值相差悬殊，往往可以跨越几个数量级，是一种极端<strong>“专制”</strong>的网络，二者之间有本质的区别。这两种网络的一个形象化的比较如图所示。具有相同节点数和边数的随机网络（左）和无标度网络（右）。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1l51glp1cgd16mtafin4n7jc13.png" alt="image_1c1l51glp1cgd16mtafin4n7jc13.png-113.9kB"><br>度分布满足幂律的无标度网络还有一个奇特的性质——<strong>“小世界”特性</strong>，虽然WWW中的页面数已超过80亿，但平均来说，在WWW上只需点击19次超链接，就可从一个网页到达任一其它页面。“小世界”现象在社会学上也称为<strong>“六度分离”</strong>，它来源于1967年，美国哈佛大学的社会心理学家Milgram的一个实验，这个实验证实，世界上任何两个人，不论他（她）是中国的藏民，非洲的难民，还是美国的政界高层，好莱坞的明星，甚至北极的爱斯基摩人，美洲的土著印第安人，都可通过熟人找熟人的方式建立联系，而两者之间的平均最少“中介”数是6，如此看来，整个地球确实是一个小小的世界。</p></blockquote><h3 id="幂律分布于的判定"><a href="#幂律分布于的判定" class="headerlink" title="幂律分布于的判定"></a>幂律分布于的判定</h3><blockquote><p>Zipf定律与Pareto定律都是简单的幂函数，我们称之为幂律分布；还有其它形式的幂律分布，像名次——规模分布、规模——概率分布，这四种形式在数学上是等价的，幂律分布的示意图如图1右图所示，其通式可写成y=c*x^(-r)，其中x，y是正的随机变量，c，r均为大于零的常数。这种分布的共性是绝大多数事件的规模很小，而只有少数事件的规模相当大。对上式两边取对数，可知lny与lnx满足线性关系，也即在双对数坐标下，幂律分布表现为一条斜率为幂指数的负数的直线，这一线性关系是判断给定的实例中随机变量是否满足幂律的依据。判断两个随机变量是否满足线性关系,可以求解两者之间的相关系数；利用一元线性回归模型和最小二乘法可得lny对lnx的经验回归直线方程，从而得到y与x之间的幂律关系式。下图显示的是一般幂律分布（上一节第一幅图中的右图）在双对数坐标下的图形，由于某些因素的影响，下图前半部分的线性特性并不是很强，而在后半部分（对应于原图的尾部），则近乎为一直线，其斜率的负数就是幂指数。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c1s3i2nahhg17f51k12b3q1cde9.png" alt="image_1c1s3i2nahhg17f51k12b3q1cde9.png-7.5kB"></p></blockquote><h3 id="幂律分布的形成机制"><a href="#幂律分布的形成机制" class="headerlink" title="幂律分布的形成机制"></a>幂律分布的形成机制</h3><blockquote><p>Barabási与Albert针对复杂网络中普遍存在的幂律分布现象，提出了网络动态演化的BA模型，他们解释，<strong>成长性和优先连接性</strong>是无标度网络度分布呈现幂律的两个最根本的原因。所谓成长性是指网络节点数的增加，像Internet中自治系统或路由器的添加，以及WWW中网站或网页的增加等，优先连接性是指新加入的<strong>节点总是优先选择与度值较高的节点相连</strong>，比如，新网站总是优先选择人们经常访问的网站作为超链接。随着时间的演进，网络会逐渐呈现出一种<strong>“富者愈富，贫者愈贫”</strong>的现象。社会学家所说的<strong>“马太效应”</strong>，《新约》圣经所说的“凡有的，还要加给他，叫他有余”，同优先连接也有某种相通之处。<br>“优先连接”并不适用于所有出现幂律分布的情况，即便是对于某些无标度网络，用它解释幂律的成因也显得很不合理(其他略)。</p></blockquote><h3 id="幂律分布的动力学影响"><a href="#幂律分布的动力学影响" class="headerlink" title="幂律分布的动力学影响"></a>幂律分布的动力学影响</h3><blockquote><p>幂律特性的度分布对无标度网络的动力学性质有着极其深刻的影响。以疾病或病毒在网络中的传播这一物理过程为例，以前的基于规则网络及随机网络的研究表明,疾病的传染强度存在一个阈值，只有传染强度大于这个阈值时,疾病才能在网络中长期存在,否则感染人数会呈指数衰减。但对无标度网络上传染病模型的研究结果表明，不存在类似的阈值，只要传染病发生，就将长时间存在下去，这一特性表明，要想在Internet这样的无标度网络上彻底消灭病毒，即使是已知的病毒，也是不可能的。//区别规则网络、小世界网络、随机网络和无标度网络<br>另外，度分布的幂律特性对<strong>网络的容错性</strong>和<strong>抗攻击能力</strong>也有很大的影响，对网络的攻击分为随机攻击和选择性攻击两种类型，分别称为网络的容错能力与抗攻击能力。研究表明，无标度网络具有很强的容错性，但是对基于节点度值的选择性攻击抗攻击能力相当差。比如对万维网或因特网中集散节点的攻击，有可能造成整个网络的瘫痪，对于某些微生物来说，它们体内度值很高的蛋白质通常掌握着细胞的生死。度分布满足泊松分布的随机网络，其容错性和抗攻击能力则是基本相当的。可见，网络的结构稳定性是与网络的度分布特性紧密联系在一起的。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 图数据 </tag>
            
            <tag> Mapreduce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA远程提交hadoop任务时出现的错误</title>
      <link href="/article/6aea.html"/>
      <url>/article/6aea.html</url>
      
        <content type="html"><![CDATA[<h3 id="远程过程中出现的一些错误"><a href="#远程过程中出现的一些错误" class="headerlink" title="远程过程中出现的一些错误"></a>远程过程中出现的一些错误</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot delete &#x2F;tmp&#x2F;hadoop-yarn&#x2F;staging&#x2F;hadoop&#x2F;.staging&#x2F;job_1477796535608_0001. Name node is in safe mode.</span><br></pre></td></tr></table></figure><p>上述问题解决：Linux集群中的namenode没有关闭safemode</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2017-12-05 18:32:27,979 INFO  [main] mapred.ClientServiceDelegate (ClientServiceDelegate.java:getProxy(276)) - Application state is completed. FinalApplicationStatus&#x3D;SUCCEEDED. Redirecting to job history server</span><br><span class="line">Retrying connect to server: 192.168.146.130&#x2F;192.168.146.130:10020. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries&#x3D;10, sleepTime&#x3D;1000 MILLISECONDS)</span><br><span class="line">Exception in thread &quot;main&quot; java.io.IOException: java.net.ConnectException: Call From MSI&#x2F;118.202.43.35 to 192.168.146.130:10020 failed on connection exception: java.net.ConnectException: Connection refused: no further information; For more details see:  http:&#x2F;&#x2F;wiki.apache.org&#x2F;hadoop&#x2F;ConnectionRefused</span><br></pre></td></tr></table></figure><p>上述问题解决：开启historyserver服务  mr-jobhistory-daemon.sh start historyserver</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.io.IOException: Job status not available</span><br></pre></td></tr></table></figure><p>上述问题解决：在mapred-site.xml中添加如下配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt; </span><br><span class="line">  &lt;name&gt;yarn.app.mapreduce.am.staging-dir&lt;&#x2F;name&gt; </span><br><span class="line">  &lt;value&gt;&#x2F;tmp&#x2F;hadoop-yarn&#x2F;staging&lt;&#x2F;value&gt;</span><br><span class="line">&lt;&#x2F;property&gt; </span><br><span class="line">&lt;property&gt; </span><br><span class="line">  &lt;name&gt;mapreduce.jobhistory.intermediate-done-dir&lt;&#x2F;name&gt; </span><br><span class="line">  &lt;value&gt;$&#123;yarn.app.mapreduce.am.staging-dir&#125;&#x2F;history&#x2F;done_intermediate&lt;&#x2F;value&gt; </span><br><span class="line">&lt;&#x2F;property&gt; </span><br><span class="line">&lt;property&gt; </span><br><span class="line">  &lt;name&gt;mapreduce.jobhistory.done-dir&lt;&#x2F;name&gt; </span><br><span class="line">  &lt;value&gt;$&#123;yarn.app.mapreduce.am.staging-dir&#125;&#x2F;history&#x2F;done&lt;&#x2F;value&gt; </span><br><span class="line">&lt;&#x2F;property&gt;</span><br></pre></td></tr></table></figure><pre><code>**注意**：在本地PC可以访问虚拟机集群的hdfs  监控：xxx.xxx.xxx.xxx:50070mr job监控：xxx.xxx.xxx.xxx:19888</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebUI无权访问hdfs文件夹&#x2F;tmp</span><br><span class="line">Permission denied: user&#x3D;dr.who, access&#x3D;READ_EXECUTE, inode&#x3D;&quot;&#x2F;tmp&quot;:hadoop:supergroup:drwx------</span><br></pre></td></tr></table></figure><p>上述问题解决：hadoop dfs -chmod -R 755 /tmp<br>注意：其显示是弃用的方法，不过仍然有效</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="hadoop-put-机制"><a href="#hadoop-put-机制" class="headerlink" title="hadoop put 机制"></a>hadoop put 机制</h3><p>特别注意！关于hdfs的底层原理（上传一个文件的整个历程）<br><a href="http://www.daniubiji.cn/archives/596" target="_blank" rel="external nofollow noopener noreferrer">一定要看这个文章</a>、<a href="https://www.cnblogs.com/laov/p/3434917.html" target="_blank" rel="external nofollow noopener noreferrer">文章的备用连接</a></p><iframe height="500px" width="100%" src="https://yq.aliyun.com/articles/37968"></iframe>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebSocket </tag>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo的安装及重置恢复</title>
      <link href="/article/d6bd.html"/>
      <url>/article/d6bd.html</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a><strong>写在前面</strong></h3><p>Hexo博客已经使用挺长时间了，其出色的静态网页渲染能力深得我的喜欢，然鹅也是因为 Hexo 基本完全依赖渲染模板的原因，如果在整博客的过程中引入了错误的代码段或者和已有代码发生了冲突，会直接影响博客的正常渲染，对于Hexo来说，不能渲染就等于完全废了；针对出现的错误，有时候我们还不一定能找得出来。经常是改一处错两处，那么到了迫不得已的时候，就有必要对博客进行重置了。</p><a id="more"></a><p>关于 Hexo 博客的重置，一般只需重置主题即可，因为 99% 的错误都是在主题文件中的，Hexo主框架自安装完就不会有什么改动。下面，就从重置主题开始，简单记录下我重置过程的代码。</p><h3 id="初始化Hexo"><a href="#初始化Hexo" class="headerlink" title="初始化Hexo"></a><strong>初始化Hexo</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"># 回退时可以跳过初始化部分，从主题部分开始重置</span><br><span class="line"></span><br><span class="line">**H:\hexo&gt;hexo init myblog**</span><br><span class="line">INFO  Cloning hexo-starter to H:\hexo\myblog</span><br><span class="line">Cloning into &#39;H:\hexo\myblog&#39;...</span><br><span class="line">remote: Counting objects: 59, done.</span><br><span class="line">remote: Total 59 (delta 0), reused 0 (delta 0), pack-reused 59</span><br><span class="line">Unpacking objects: 100% (59&#x2F;59), done.</span><br><span class="line">Submodule &#39;themes&#x2F;landscape&#39; (https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-theme-landscape.git) registered for path &#39;themes&#x2F;landscape&#39;</span><br><span class="line">Cloning into &#39;H:&#x2F;hexo&#x2F;myblog&#x2F;themes&#x2F;landscape&#39;...</span><br><span class="line">remote: Counting objects: 785, done.</span><br><span class="line">remote: Total 785 (delta 0), reused 0 (delta 0), pack-reused 784</span><br><span class="line">Receiving objects: 100% (785&#x2F;785), 2.54 MiB | 476.00 KiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (403&#x2F;403), done.</span><br><span class="line">Submodule path &#39;themes&#x2F;landscape&#39;: checked out &#39;decdc2d9956776cbe95420ae94bac87e22468d38&#39;</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">错误: 找不到或无法加载主类 install</span><br><span class="line">INFO  Start blogging with Hexo!</span><br><span class="line"></span><br><span class="line">**H:\hexo&gt;cd hexo**</span><br><span class="line"></span><br><span class="line">**H:\hexo\hexo&gt;hexo g**</span><br><span class="line">INFO  Start processing</span><br><span class="line">FATAL Something&#39;s wrong. Maybe you can find the solution here: http:&#x2F;&#x2F;hexo.io&#x2F;docs&#x2F;troubleshooting.html</span><br><span class="line">Template render error: (unknown path) [Line 8, Column 23]</span><br><span class="line">  Error: Unable to call &#96;the return value of (posts[&quot;first&quot;])[&quot;updated&quot;][&quot;toISOString&quot;]&#96;, which is undefined or falsey</span><br><span class="line">    at Object.exports.prettifyError (H:\hexo\hexo\node_modules\_nunjucks@3.0.1@nunjucks\src\lib.js:34:15)</span><br><span class="line">    at H:\hexo\hexo\node_modules\_nunjucks@3.0.1@nunjucks\src\environment.js:489:31</span><br><span class="line">    at new_cls.root [as rootRenderFunc] (eval at _compile (H:\hexo\hexo\node_modules\_nunjucks@3.0.1@nunjucks\src\environment.js:568:24), &lt;anonymous&gt;</span><br><span class="line">210:3)</span><br><span class="line">    at new_cls.render (H:\hexo\hexo\node_modules\_nunjucks@3.0.1@nunjucks\src\environment.js:482:15)</span><br><span class="line">    at Hexo.module.exports (H:\hexo\hexo\node_modules\_hexo-generator-feed@1.2.2@hexo-generator-feed\lib\generator.js:40:22)</span><br><span class="line">    at Hexo.tryCatcher (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\method.js:15:34)</span><br><span class="line">    at H:\hexo\hexo\node_modules\_hexo@3.4.0@hexo\lib\hexo\index.js:340:24</span><br><span class="line">    at tryCatcher (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\util.js:16:23)</span><br><span class="line">    at MappingPromiseArray._promiseFulfilled (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\map.js:61:38)</span><br><span class="line">    at MappingPromiseArray.PromiseArray._iterate (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\promise_array.js:114:31)</span><br><span class="line">    at MappingPromiseArray.init (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\promise_array.js:78:10)</span><br><span class="line">    at MappingPromiseArray._asyncInit (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\map.js:30:10)</span><br><span class="line">    at Async._drainQueue (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\async.js:138:12)</span><br><span class="line">    at Async._drainQueues (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\async.js:143:10)</span><br><span class="line">    at Immediate.Async.drainQueues (H:\hexo\hexo\node_modules\_bluebird@3.5.1@bluebird\js\release\async.js:17:14)</span><br><span class="line">    at runCallback (timers.js:789:20)</span><br><span class="line">    at tryOnImmediate (timers.js:751:5)</span><br><span class="line">    at processImmediate [as _immediateCallback] (timers.js:722:5)</span><br><span class="line"></span><br><span class="line">**H:\hexo\hexo&gt;cd ..**</span><br><span class="line"></span><br><span class="line">**H:\hexo&gt;cd myblog**</span><br><span class="line"></span><br><span class="line">**H:\hexo\myblog&gt;hexo g**</span><br><span class="line">ERROR Local hexo not found in H:\hexo\myblog</span><br><span class="line">ERROR Try running: &#39;npm install hexo --save&#39;</span><br><span class="line"></span><br><span class="line">**H:\hexo\myblog&gt;cnpm install**</span><br><span class="line">| [8&#x2F;9] Installing cssom@0.3.xplatform unsupported hexo@3.4.0 › hexo-fs@0.2.2 › chokidar@1.7.0 › fsevents@^1.0.0 Package require os(darwin) not compa</span><br><span class="line">ible with your platform(win32)</span><br><span class="line">[fsevents@^1.0.0] optional install error: Package require os(darwin) not compatible with your platform(win32)</span><br><span class="line">√ Installed 9 packages</span><br><span class="line">√ Linked 274 latest versions</span><br><span class="line"></span><br><span class="line">&gt; hexo-util@0.6.1 build:highlight H:\hexo\myblog\node_modules\_hexo-util@0.6.1@hexo-util</span><br><span class="line">&gt; node scripts&#x2F;build_highlight_alias.js &gt; highlight_alias.json</span><br><span class="line"></span><br><span class="line">√ Run 1 scripts</span><br><span class="line">deprecate hexo@3.4.0 › swig@1.4.2 This package is no longer maintained</span><br><span class="line">Recently updated (since 2017-10-29): 1 packages (detail see file H:\hexo\myblog\node_modules\.recently_updates.txt)</span><br><span class="line">√ All packages installed (310 packages installed from npm registry, used 29s, speed 39.09kB&#x2F;s, json 283(524.52kB), tarball 608.11kB)</span><br><span class="line"></span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:&#x2F;&#x2F;www.cxmoe.com](https:&#x2F;&#x2F;www.cxmoe.com) **&gt;&gt;**</span><br><span class="line"></span><br><span class="line">**H:\hexo\myblog&gt;hexo g**</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded in 207 ms</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  Generated: archives&#x2F;index.html</span><br><span class="line">INFO  Generated: fancybox&#x2F;blank.gif</span><br><span class="line">INFO  Generated: archives&#x2F;2017&#x2F;11&#x2F;index.html</span><br><span class="line">INFO  Generated: fancybox&#x2F;fancybox_sprite.png</span><br><span class="line">INFO  Generated: fancybox&#x2F;jquery.fancybox.css</span><br><span class="line">INFO  Generated: fancybox&#x2F;fancybox_sprite@2x.png</span><br><span class="line">INFO  Generated: fancybox&#x2F;fancybox_loading.gif</span><br><span class="line">INFO  Generated: fancybox&#x2F;fancybox_loading@2x.gif</span><br><span class="line">INFO  Generated: fancybox&#x2F;jquery.fancybox.pack.js</span><br><span class="line">INFO  Generated: fancybox&#x2F;jquery.fancybox.js</span><br><span class="line">INFO  Generated: archives&#x2F;2017&#x2F;index.html</span><br><span class="line">INFO  Generated: fancybox&#x2F;fancybox_overlay.png</span><br><span class="line">INFO  Generated: css&#x2F;fonts&#x2F;FontAwesome.otf</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;jquery.fancybox-buttons.css</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;jquery.fancybox-thumbs.css</span><br><span class="line">INFO  Generated: js&#x2F;script.js</span><br><span class="line">INFO  Generated: css&#x2F;fonts&#x2F;fontawesome-webfont.eot</span><br><span class="line">INFO  Generated: css&#x2F;fonts&#x2F;fontawesome-webfont.woff</span><br><span class="line">INFO  Generated: css&#x2F;style.css</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;fancybox_buttons.png</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;jquery.fancybox-thumbs.js</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;jquery.fancybox-buttons.js</span><br><span class="line">INFO  Generated: fancybox&#x2F;helpers&#x2F;jquery.fancybox-media.js</span><br><span class="line">INFO  Generated: 2017&#x2F;11&#x2F;05&#x2F;hello-world&#x2F;index.html</span><br><span class="line">INFO  Generated: css&#x2F;fonts&#x2F;fontawesome-webfont.svg</span><br><span class="line">INFO  Generated: css&#x2F;fonts&#x2F;fontawesome-webfont.ttf</span><br><span class="line">INFO  Generated: css&#x2F;images&#x2F;banner.jpg</span><br><span class="line">INFO  28 files generated in 546 ms</span><br><span class="line"></span><br><span class="line">**H:\hexo\myblog&gt;hexo s**</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http:&#x2F;&#x2F;localhost:4000&#x2F;. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure><h3 id="主题部分（初始化-重置）"><a href="#主题部分（初始化-重置）" class="headerlink" title="主题部分（初始化/重置）"></a><strong>主题部分（初始化/重置）</strong></h3><p>Hexo模块化的结构和生成流程决定了Hexo本身和主题theme是分离的，或者说耦合性不大，如果博客的主题在先使用过程中出现了一些无法修改的问题，那么就需要重置一下主题，比如我是用的indigo主题。<br>再次提醒，大部分错误都是theme中的错误导致的，在替换时只需要修改blog目录中的theme文件夹，替换其中的主题即可，blog根目录的东西一般不会出毛病（一般自定义时都是修改主题内的文件）。<br>注：为什么不用版本控制，因为本身对主题修改的地方不多，且直接重新克隆可以保持主题的最新状态。</p><h4 id="重置步骤"><a href="#重置步骤" class="headerlink" title="重置步骤"></a><strong>重置步骤</strong></h4><ol><li>blog\theme\indigo 将这个文件夹重命名（不要删，还有用）</li><li>blog\theme 此目录下重新克隆 git clone <a href="https://github.com/yscoder/hexo-theme-indigo.git" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/yscoder/hexo-theme-indigo.git</a> indogo</li><li>从原indigo中将一些基本文件替换到新的indigo中<ul><li>indigo\ _config.yaml （注意是indigo目录下的配置文件）</li><li>indigo\source （全部内容，除了js和css，这两部分可能包含先前的错误）</li><li>基本的替换完成后即可运行了（当然现在的版本少了很多自定义内容）  </li></ul></li><li>开始恢复自定义代码，这部分每还原一步都要运行一下(本地部署运行)看是否(编译)正常</li><li>自定义代码集中在 indigo\layout<ul><li>indigo\layout\ _partial\menu.ejs</li><li>indigo\layout\ _partial\footer.ejs</li><li>indigo\layout\ _partial\plugins\site-visit</li><li>indigo\layout\ _partial\plugins\page-visit</li><li>indigo\layout\ _partial\plugins\google-analytics.ejs</li><li>indigo\layout\ _partial\plugins\baidu.ejs</li><li>indigo\layout\tag.ejs</li><li>indigo\source\css\style.css</li></ul></li><li>执行deploy提交git，与git源不冲突，可以正常提交，因为对git来说上述操作都是不可见的。</li><li>整个回退过程结束。</li></ol><p>正常来说，上述操作可以发现到底是在修改那个文件时出现错误，如果是一些不知道怎么引起的疑难杂症，通过这样的替换工作也可以将版本回退到正常的版本。</p>]]></content>
      
      
      <categories>
          
          <category> Hexo相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Indigo </tag>
            
            <tag> 重置版本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark的RDDs相关内容</title>
      <link href="/article/f71d.html"/>
      <url>/article/f71d.html</url>
      
        <content type="html"><![CDATA[<h2 id="RDDs的介绍"><a href="#RDDs的介绍" class="headerlink" title="RDDs的介绍"></a>RDDs的介绍</h2><h3 id="Driver-program"><a href="#Driver-program" class="headerlink" title="Driver program"></a>Driver program</h3><ul><li>main()方法，RDDs的定义和操作</li><li>管理很多节点，称作executors<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c01bbgdf1ipe1ug2tpel7q1m9.png" alt="image_1c01bbgdf1ipe1ug2tpel7q1m9.png-60.7kB"></li></ul><a id="more"></a><h3 id="SparkContext"><a href="#SparkContext" class="headerlink" title="SparkContext"></a>SparkContext</h3><ul><li>Driver programs通过SparkContext对象访问Spark</li><li>SparkContext对象代表和一个集群的连接</li><li>在Shell中SparkContext是自动创建好的，即sc</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用一下命令进入shell    </span></span><br><span class="line">    <span class="comment">//cd /usr/local/spark/bin</span></span><br><span class="line">    <span class="comment">//./spark-shell</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.textFile(<span class="string">"/home/hadoop/look.sh"</span>)</span><br><span class="line">lines: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = /home/hadoop/look.sh <span class="type">MapPartitionsRDD</span>[<span class="number">1</span>] at textFile at &lt;console&gt;:<span class="number">24</span></span><br></pre></td></tr></table></figure><h3 id="RDDs-弹性分布式数据集"><a href="#RDDs-弹性分布式数据集" class="headerlink" title="RDDs(弹性分布式数据集)"></a>RDDs(弹性分布式数据集)</h3><ul><li>上述的lines就是一个弹性分布式数据集（RDD），其可以分布在集群内，但对使用者透明</li><li>RDDs是Spark分发数据和计算的基础抽象类</li><li>一个RDD代表的是一个不可改变的分布式集合对象</li><li>Spark中所有的计算都是通过对RDD的创建、转换、操作完成的</li><li>一个RDD由许多分片（partitions）组成，分片可以再不同节点上进行计算</li><li>分片是Spark的并行处理单元。Spark顺序的并行处理分片</li></ul><h4 id="RDDs的创建"><a href="#RDDs的创建" class="headerlink" title="RDDs的创建"></a>RDDs的创建</h4><p>通常使用parallelize()函数可以创建一个简单的RDD，测试用（为了方便观察结果）。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>),<span class="number">4</span>) 最后一个<span class="number">4</span>指的是并行度，默认是<span class="number">1</span></span><br><span class="line">rdd: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">Int</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">2</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line">scala&gt; rdd.count()</span><br><span class="line">res0: <span class="type">Long</span> = <span class="number">4</span>                                                                  </span><br><span class="line">scala&gt; rdd.foreach(print)</span><br><span class="line"><span class="number">1224</span></span><br><span class="line">scala&gt; rdd.foreach(print)</span><br><span class="line"><span class="number">1422</span></span><br><span class="line">注意：上述parallelize()方法就是为了观察数组的作用</span><br><span class="line">还有如果集群节点大于一个，由于rdd的分片计算特性，会使两次的遍历结果并不相同</span><br></pre></td></tr></table></figure><h3 id="Scala基本知识：-详见Scala学习笔记"><a href="#Scala基本知识：-详见Scala学习笔记" class="headerlink" title="Scala基本知识：(详见Scala学习笔记)"></a>Scala基本知识：(详见Scala学习笔记)</h3><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul><li>Driver program 包含了程序的main方法，整个程序的入口的地方</li><li>SparkContext 代表了和集群的连接，一般在程序的开头就出现</li><li>RDDs 弹性分布式数据集，代表的就是一个数据集</li></ul><h2 id="RDD基本操作之转换（Transformation）"><a href="#RDD基本操作之转换（Transformation）" class="headerlink" title="RDD基本操作之转换（Transformation）"></a>RDD基本操作之转换（Transformation）</h2><h3 id="RDD的逐元素转换"><a href="#RDD的逐元素转换" class="headerlink" title="RDD的逐元素转换"></a>RDD的逐元素转换</h3><ul><li>map()：将map函数应用到RDD的每一个元素，返回一个新的RDD<br>  val line2 = line1.map(word=&gt;(word,1)) //word就代表迭代元素</li><li>filter():返回只包含filter函数的值组成的新的RDD<br>  val line2 = line1.filter(word。contains(“abc”)) //word就代表迭代元素</li><li>flatMap():出入一个复杂元素，输出多个简单元素，类似数据的‘压扁’，按照一定的规则（指定函数）</li><li><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.parallelize(<span class="type">Array</span>(<span class="string">"home Tom"</span>,<span class="string">"hadoop Jack"</span>,<span class="string">"look Kim"</span>))</span><br><span class="line">lines: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">5</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.foreach(println)</span><br><span class="line">home <span class="type">Tom</span></span><br><span class="line">hadoop <span class="type">Jack</span></span><br><span class="line">look <span class="type">Kim</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//注意对RDD本身的操作不影响其本身，因为是val定义的常量</span></span><br><span class="line">scala&gt; lines.flatMap(t=&gt;t.split(<span class="string">" "</span>)) </span><br><span class="line">res20: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">MapPartitionsRDD</span>[<span class="number">6</span>] at flatMap at &lt;console&gt;:<span class="number">27</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.foreach(println)</span><br><span class="line">home <span class="type">Tom</span></span><br><span class="line">hadoop <span class="type">Jack</span></span><br><span class="line">look <span class="type">Kim</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//必须使用新的常量来接收</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> newrdd = lines.flatMap(t=&gt;t.split(<span class="string">" "</span>))</span><br><span class="line">newrdd: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">MapPartitionsRDD</span>[<span class="number">7</span>] at flatMap at &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">scala&gt; newrdd.foreach(println)</span><br><span class="line">home</span><br><span class="line"><span class="type">Tom</span></span><br><span class="line">hadoop</span><br><span class="line"><span class="type">Jack</span></span><br><span class="line">look</span><br><span class="line"><span class="type">Kim</span></span><br><span class="line"></span><br><span class="line">scala&gt;</span><br></pre></td></tr></table></figure></li></ul><h3 id="RDD的集合运算（交集并集）"><a href="#RDD的集合运算（交集并集）" class="headerlink" title="RDD的集合运算（交集并集）"></a>RDD的集合运算（交集并集）</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> rdd1 = sc.parallelize(<span class="type">Array</span>(<span class="string">"one"</span>,<span class="string">"two"</span>,<span class="string">"three"</span>))</span><br><span class="line">rdd1: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">9</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> rdd2 = sc.parallelize(<span class="type">Array</span>(<span class="string">"two"</span>,<span class="string">"three"</span>,<span class="string">"three"</span>))</span><br><span class="line">rdd2: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">10</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.distinct().foreach(println)</span><br><span class="line">two</span><br><span class="line">three</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.union(rdd1).foreach(println)</span><br><span class="line">two</span><br><span class="line">three</span><br><span class="line">three</span><br><span class="line">one</span><br><span class="line">two</span><br><span class="line">three</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.intersection(rdd1).foreach(println)</span><br><span class="line">two</span><br><span class="line">three</span><br><span class="line"></span><br><span class="line">scala&gt; rdd2.subtract(rdd1).foreach(println)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd1.subtract(rdd2).foreach(println)</span><br><span class="line">one</span><br></pre></td></tr></table></figure><h2 id="RDDs的基本操作之Action"><a href="#RDDs的基本操作之Action" class="headerlink" title="RDDs的基本操作之Action"></a>RDDs的基本操作之Action</h2><ul><li>在RDD上计算出来的一个结果</li><li>并把结果返回给driver program，save等等</li></ul><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h3><ul><li>接收一个函数，作用在RDD两个类型相同的元素上，返回新元素</li><li>可以实现RDD中元素的累加、计数、和其他类型的聚集操作。</li></ul><h3 id="Collect"><a href="#Collect" class="headerlink" title="Collect()"></a>Collect()</h3><ul><li>遍历整个RDD，想driver program返回RDD内容</li><li>需要单机内存能够容纳下（因为需要拷贝给driver）</li><li>大数据处理要使用savaAsText方法<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> rdd = sc.parallelize(<span class="type">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">rdd: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">Int</span>] = <span class="type">ParallelCollectionRDD</span>[<span class="number">0</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; rdd.collect()</span><br><span class="line">res0: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.reduce((x,y)=&gt;x+y)</span><br><span class="line">res1: <span class="type">Int</span> = <span class="number">10</span></span><br></pre></td></tr></table></figure><h3 id="take-n"><a href="#take-n" class="headerlink" title="take(n)"></a>take(n)</h3></li><li>返回RDD的n个元素（同时尝试访问最少的partitions）</li><li>返回的结果是无序的（在单节点时是有序的）<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; rdd.take(<span class="number">2</span>)</span><br><span class="line">res2: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.take(<span class="number">3</span>)</span><br><span class="line">res3: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h3 id="top"><a href="#top" class="headerlink" title="top()"></a>top()</h3></li><li>排序，默认使用RDD的比较器，可以自定义比较器<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; rdd.top(<span class="number">2</span>)</span><br><span class="line">res7: <span class="type">Array</span>[<span class="type">Int</span>] = <span class="type">Array</span>(<span class="number">4</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach()"></a>foreach()</h3></li><li>遍历RDD中的每个元素，并执行一次函数，如果为空则仅仅是遍历数据</li><li>一般结合print函数来遍历打印几何数据</li></ul><h2 id="RDDs的特性"><a href="#RDDs的特性" class="headerlink" title="RDDs的特性"></a>RDDs的特性</h2><h3 id="血统关系图"><a href="#血统关系图" class="headerlink" title="血统关系图"></a>血统关系图</h3><ul><li>Spark维护着RDDs之间的依赖关系和创建关系，叫做血统关系图</li><li>Spark使用血统关系图来计算每个RDD的需求和恢复的数据<br>  <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1c01fvepu1bcsimt1i5o1qgl1k5bm.png" alt="image_1c01fvepu1bcsimt1i5o1qgl1k5bm.png-54.6kB"></li><li>上述图示中经过了过个操作最后生成了一个RDD，如果badLinesRDD出错数据丢失，那么由于存在完整的血统关系图，所以可以将其恢复</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="延迟计算（Lazy-Evaluation）"><a href="#延迟计算（Lazy-Evaluation）" class="headerlink" title="延迟计算（Lazy Evaluation）"></a>延迟计算（Lazy Evaluation）</h3><ul><li>Spark对RDDs的计算时 在第一次使用action操作的使用触发的</li><li>这种方式可以减少数据的传输</li><li>Spark内部记实录metedata信息来完成延迟机制</li><li>加载数据本身也是延迟的，数据只有在最后被执行action操作时才会被加载</li></ul><h3 id="RDD-persist-持久化"><a href="#RDD-persist-持久化" class="headerlink" title="RDD.persist() 持久化"></a>RDD.persist() 持久化</h3><ul><li>默认每次在RDDs上面进行action操作时，Spark都会重新计算</li><li>如果想重复使用一个RDD，就需要使用persist进行缓存，使用unpersist解除缓存</li></ul><h3 id="持久化缓存级别："><a href="#持久化缓存级别：" class="headerlink" title="持久化缓存级别："></a>持久化缓存级别：</h3><table><thead><tr><th>级别</th><th>空间占用</th><th>CPU消耗</th><th>是否在内存</th><th>是否在硬盘</th></tr></thead><tbody><tr><td>MEMORY_ONLY</td><td>高</td><td>低</td><td>在</td><td>不在</td></tr><tr><td>MEMORY_ONLY_SER</td><td>低</td><td>高</td><td>在</td><td>不在</td></tr><tr><td>DISK_ONLY</td><td>低</td><td>高</td><td>不在</td><td>在</td></tr><tr><td>MEMORY_AND_DISK</td><td>高</td><td>中</td><td>Some</td><td>Some</td></tr><tr><td>MEMORY_AND_DISK_SER</td><td>低</td><td>高</td><td>Some</td><td>Some</td></tr><tr><td>MEMORY_AND_DISK 内存中放不下往硬盘放</td><td></td><td></td><td></td><td></td></tr><tr><td>MEMORY_AND_DISK_SER 内存中放不下往硬盘放(序列化的，故CPU消耗较大)</td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="键值对（KeyValue）RDDs"><a href="#键值对（KeyValue）RDDs" class="headerlink" title="键值对（KeyValue）RDDs"></a>键值对（KeyValue）RDDs</h2><h3 id="创建键值对RDDs"><a href="#创建键值对RDDs" class="headerlink" title="创建键值对RDDs"></a>创建键值对RDDs</h3><ul><li>使用map()函数，返回键值对RDD</li><li>例如包含多行数据的RDD，将每行数据的第一个单词作为Key<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.textFile(<span class="string">"/home/hadoop/look.sh"</span>)<span class="comment">//注意这是错的，这样默认是取hdfs文件</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.textFile(<span class="string">"file:///home/hadoop/look.sh"</span>)<span class="comment">//用file://来指明取的系统文件</span></span><br><span class="line">lines: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = file:<span class="comment">///home/hadoop/look.sh MapPartitionsRDD[5] at textFile at &lt;console&gt;:24</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.foreach(println)</span><br><span class="line">#!/bin/bash</span><br><span class="line"><span class="type">Jarinfo</span>=$(ps -ef|grep java)</span><br><span class="line">echo <span class="string">"$Jarinfo"</span> | <span class="keyword">while</span> read <span class="type">Line</span></span><br><span class="line">do </span><br><span class="line">        #echo $<span class="type">Line</span>;</span><br><span class="line">        #echo $&#123;<span class="type">Line</span>##*:&#125;</span><br><span class="line">        <span class="type">Jarstr</span>=$&#123;<span class="type">Line</span>##*:&#125;</span><br><span class="line">        <span class="type">Ishere</span>=$(echo $<span class="type">Jarstr</span> | grep $<span class="number">1</span> )</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">"$Ishere"</span> != <span class="string">""</span> ]]</span><br><span class="line">        then</span><br><span class="line">                echo <span class="type">YES</span> <span class="number">1</span>&gt;</span><br><span class="line">                exit <span class="number">1</span></span><br><span class="line">        fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> pairs = lines.map(line=&gt;(line.split(<span class="string">" "</span>)(<span class="number">0</span>),line))</span><br><span class="line">pairs: org.apache.spark.rdd.<span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">String</span>)] = <span class="type">MapPartitionsRDD</span>[<span class="number">6</span>] at map at &lt;console&gt;:<span class="number">26</span></span><br><span class="line"></span><br><span class="line">scala&gt; pairs.foreach(println)</span><br><span class="line">(#!/bin/bash,#!/bin/bash)</span><br><span class="line">(<span class="type">Jarinfo</span>=$(ps,<span class="type">Jarinfo</span>=$(ps -ef|grep java))</span><br><span class="line">(echo,echo <span class="string">"$Jarinfo"</span> | <span class="keyword">while</span> read <span class="type">Line</span>)</span><br><span class="line">(do,do )</span><br><span class="line">(       #echo,  #echo $<span class="type">Line</span>;)</span><br><span class="line">(       #echo,  #echo $&#123;<span class="type">Line</span>##*:&#125;)</span><br><span class="line">(       <span class="type">Jarstr</span>=$&#123;<span class="type">Line</span>##*:&#125;,     <span class="type">Jarstr</span>=$&#123;<span class="type">Line</span>##*:&#125;)</span><br><span class="line">(       <span class="type">Ishere</span>=$(echo,  <span class="type">Ishere</span>=$(echo $<span class="type">Jarstr</span> | grep $<span class="number">1</span> ))</span><br><span class="line">(       <span class="keyword">if</span>,     <span class="keyword">if</span> [[ <span class="string">"$Ishere"</span> != <span class="string">""</span> ]])</span><br><span class="line">(       then,   then)</span><br><span class="line">(               echo,           echo <span class="type">YES</span> <span class="number">1</span>&gt;)</span><br><span class="line">(               exit,           exit <span class="number">1</span>  )</span><br><span class="line">(       fi,     fi)</span><br><span class="line">(done,done)</span><br></pre></td></tr></table></figure><h3 id="键值对常见操作函数"><a href="#键值对常见操作函数" class="headerlink" title="键值对常见操作函数"></a>键值对常见操作函数</h3><table><thead><tr><th>函数名</th><th>作用</th></tr></thead><tbody><tr><td>reduceByKey(func)</td><td>把相同key的value进行结合，key不变，是计算</td></tr><tr><td>groupByKey(func)</td><td>把相同key的value进行分组，key不变，仅分组</td></tr><tr><td>combineByKey(,,,)</td><td></td></tr><tr><td>mapValues(func)</td><td>将map操作作用于Values，进对Values进行操作</td></tr><tr><td>flatMapValues(func)</td><td>将flatMap(扩展)操作作用于Values</td></tr><tr><td>keys</td><td>仅返回键的值（RDD.keys）</td></tr><tr><td>values</td><td>仅返回值的值（RDD.values）</td></tr><tr><td>sortBtKey()</td><td>按照Key来排序</td></tr></tbody></table></li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">var</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">3</span>,<span class="number">6</span>)))</span><br><span class="line">rdd: org.apache.spark.rdd.<span class="type">RDD</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = <span class="type">ParallelCollectionRDD</span>[<span class="number">0</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; rdd.foreach(println)</span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.reduceByKey((x,y)=&gt;x+y).foreach(println)</span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.groupByKey().foreach(println)</span><br><span class="line">(<span class="number">1</span>,<span class="type">CompactBuffer</span>(<span class="number">2</span>))</span><br><span class="line">(<span class="number">3</span>,<span class="type">CompactBuffer</span>(<span class="number">4</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.sortByKey().foreach(println)</span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; rdd.keys.foreach(println)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line">scala&gt; rdd.values.foreach(println)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure><h3 id="combineByKey"><a href="#combineByKey" class="headerlink" title="combineByKey()"></a>combineByKey()</h3><p>特点：最常用的基于key的聚合函数，返回的类型可以与输入的类型不一样<br>参数：createCombiner,mergeValue,mergeCombiners,partitioner<br>应用：许多基于key的聚合函数都用到了，例如groupByKey底层就应用到了<br>注意：</p><ul><li>遍历分片中的元素，元素的key要么之前见过要么没见过</li><li>（某个分区）如果是这个分区中的新key，那么就是用createCombiner()函数</li><li>（某个分区）如果是这个分区中已经见过的key，那么就是用mergeValue()函数</li><li>（全部分区）合计分区结果时，使用mergeCombiner()函数<br>示例：<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">注意：combineByKey(x=&gt;(<span class="number">1</span>,x),,,)  <span class="comment">// x 表示的是Values</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">var</span> rdd = sc.parallelize(<span class="type">Array</span>((<span class="string">"Tom"</span>,<span class="number">82</span>),(<span class="string">"Tom"</span>,<span class="number">78</span>),(<span class="string">"Mike"</span>,<span class="number">76</span>),(<span class="string">"Mike"</span>,<span class="number">74</span>)))</span><br><span class="line">rdd: org.apache.spark.rdd.<span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = <span class="type">ParallelCollectionRDD</span>[<span class="number">6</span>] at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以求每个人的成绩之和+课程数目（即一次计算多个指标）</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> rst = rdd.combineByKey(x=&gt;(<span class="number">1</span>,x),(item:(<span class="type">Int</span>,<span class="type">Int</span>),<span class="keyword">new</span>)=&gt;(item._1+<span class="number">1</span>,item._2+<span class="keyword">new</span>),(a:(<span class="type">Int</span>,<span class="type">Int</span>),b:(<span class="type">Int</span>,<span class="type">Int</span>))=&gt;(a._1+b._1,a._2+b._2))</span><br><span class="line"></span><br><span class="line">scala&gt; rst.foresch(println)</span><br><span class="line">(<span class="type">Tom</span>,(<span class="number">2</span>,<span class="number">160</span>))</span><br><span class="line">(<span class="type">Mike</span>,(<span class="number">2</span>,<span class="number">150</span>))</span><br><span class="line"></span><br><span class="line">附：验证格式可以用<span class="keyword">case</span></span><br><span class="line">scala&gt; rdd.map&#123;<span class="keyword">case</span>(name,score)=&gt;(name,score,<span class="string">"valid ok"</span>)&#125;.foreach(println)</span><br><span class="line">(<span class="type">Tom</span>,<span class="number">82</span>,valid ok)</span><br><span class="line">(<span class="type">Tom</span>,<span class="number">78</span>,valid ok)</span><br><span class="line">(<span class="type">Mike</span>,<span class="number">76</span>,valid ok)</span><br><span class="line">(<span class="type">Mike</span>,<span class="number">74</span>,valid ok)</span><br></pre></td></tr></table></figure></li></ul><h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><ul><li>Spark的介绍：重点是即与内存</li><li>Spark的安装：重点是开发环境的搭建(sbt打包)</li><li>RDDs的介绍：重点Transformations，Actions</li><li>RDDs的特性：重点是血统关系图和延迟[lazy]计算</li><li>键值对RDDs</li></ul><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><ul><li>Spark的架构</li><li>Spark的运行过程</li><li>Spark程序的部署过程</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spark学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spark </tag>
            
            <tag> 原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark的运行环境及远程开发环境的搭建</title>
      <link href="/article/b081.html"/>
      <url>/article/b081.html</url>
      
        <content type="html"><![CDATA[<h2 id="基本概括"><a href="#基本概括" class="headerlink" title="基本概括"></a>基本概括</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><strong>spark快速</strong> </p><ul><li>扩充了mapreduce</li><li>基于内存计算（中间结果的存储位置）</li></ul><a id="more"></a><p><strong>spark通用</strong></p><ul><li>批处理hadoop</li><li>迭代计算 机器学习系统</li><li>交互式查询 hive</li><li>流处理 storm</li></ul><p><strong>spark开放</strong></p><ul><li>Python API</li><li>Java/Scala API</li><li>SQL API</li><li>整合好hadoop/kafka</li></ul><h3 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h3><ul><li>环境搭建</li><li>核心概念RDD</li><li>架构</li><li>重要组件SparkStreaming</li></ul><h3 id="发展历史"><a href="#发展历史" class="headerlink" title="发展历史"></a>发展历史</h3><p>2009 RAD实验室，引入内存存储<br>2010 开源<br>2011 AMP实验室，Spark Streaming<br>2013 Apache顶级项目</p><h3 id="主要组件"><a href="#主要组件" class="headerlink" title="主要组件"></a>主要组件</h3><p><strong>Spark Core：</strong></p><ul><li>包括spark的基本功能，任务调度、内存管理、容错机制</li><li>内部定义RDDs（弹性分布式数据集）</li><li>提供APIs来创建和操作RDDs</li><li>为其他组件提供底层服务</li></ul><p><strong>Spark SQL：</strong></p><ul><li>处理结构化数据的库，类似于HiveSQL、Mysql</li><li>用于报表统计等</li></ul><p><strong>Spark Streaming：</strong></p><ul><li>实时数据流处理组件，类似Storm</li><li>提供API来操作实时数据流</li><li>使用场景是从Kafka等消息队列中接收数据实时统计</li></ul><p><strong>Spark Mlib：</strong></p><ul><li>包含通用机器学习功能的包，Machine Learning Lib</li><li>包含分类、聚类、回归、模型评估、数据导入等</li><li>Mlib所有算法均支持集群的横向扩展（区别于python的单机）</li></ul><p><strong>GraphX：</strong></p><ul><li>处理图数据的库，并行的进行图的计算</li><li>类似其他组件，都继承了RDD API</li><li>提供各种图操作和常用的图算法，PageRank等</li></ul><p><strong>Spark Cluster Managers：</strong></p><ul><li>集群管理，Spark自带一个集群管理调度器</li><li>其他类似的有Hadoop YARN，Apache Mesos</li></ul><h3 id="紧密集成的优点"><a href="#紧密集成的优点" class="headerlink" title="紧密集成的优点"></a>紧密集成的优点</h3><ul><li>Spark底层优化后，基于底层的组件也会相应优化</li><li>减少组件集成的部署测试</li><li>增加新组建时其他组件可以方便使用其功能</li></ul><h3 id="hadoop应用场景"><a href="#hadoop应用场景" class="headerlink" title="hadoop应用场景"></a>hadoop应用场景</h3><ul><li>离线处理、对时效性要求不高、要落到硬盘上</li></ul><h3 id="spark应用场景"><a href="#spark应用场景" class="headerlink" title="spark应用场景"></a>spark应用场景</h3><ul><li>时效性要求高、机器学习、迭代计算</li></ul><h3 id="Doug-Cutting的观点"><a href="#Doug-Cutting的观点" class="headerlink" title="Doug Cutting的观点"></a>Doug Cutting的观点</h3><p>生态系统、各司其职<br>Spark需要借助HDFS进行持久化存储</p><h2 id="运行环境搭建"><a href="#运行环境搭建" class="headerlink" title="运行环境搭建"></a>运行环境搭建</h2><h3 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h3><ul><li>Spark - scala - JVM - Java7+</li><li>Python - Python2.6+/3.4+</li><li>Spark1.6.2 - Scala2.10/Spark2.0.0 - Scala2.11</li><li>搭建Spark不需要Hadoop，如果存在则需要下载相关版本（不是上述对应关系）</li></ul><h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><p>详见<a href="http://dblab.xmu.edu.cn/blog/spark-quick-start-guide/" target="_blank" rel="external nofollow noopener noreferrer">http://dblab.xmu.edu.cn/blog/spark-quick-start-guide/</a><br>主要是两个步骤：</p><ol><li>安装Hadoop（不做介绍）</li><li>解压Spark到对应位置，然后在spark-env.sh中添加SPARK_DIST_CLASSPATH</li><li>run-example SparkPi已可以正常运行示例</li></ol><p><strong>注意几点：</strong></p><ul><li>Spark版本要严格对照Hadoop版本</li><li>Spark运行不依赖Hadoop启动</li><li>Spark运行目录bin的内容，要确保有执行权限[+x]</li></ul><h3 id="Spark目录"><a href="#Spark目录" class="headerlink" title="Spark目录"></a>Spark目录</h3><ul><li>bin     包含和Spark交互的可执行文件，如Spark shell</li><li>core，Streaming，python等   包含主要组件的源代码</li><li>examples    包含一些单机的Spark job</li></ul><h3 id="Spark-shell"><a href="#Spark-shell" class="headerlink" title="Spark shell"></a>Spark shell</h3><ul><li>Spark的shell能够处理分布在集群上的数据</li><li>Spark把数据加载到节点的内存中，故分布式处理可以秒级完成</li><li>快速迭代计算，实时查询，分析等都可以在shell中完成</li><li>有Scala shell和Python shell</li></ul><h3 id="Scala-shell-bin-scala-shell"><a href="#Scala-shell-bin-scala-shell" class="headerlink" title="Scala shell:/bin/scala-shell"></a>Scala shell:/bin/scala-shell</h3><p><strong>注意：</strong></p><ul><li>启动日志级别可以修改为WARN，在目录/conf/log4j.properties</li><li>开启Spark-shell要先启动hadoop，否则会出现以下错误<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 bin]$ .&#x2F;spark-shell</span><br><span class="line">  ... ...</span><br><span class="line">Caused by: java.net.ConnectException: Call From hadoop01&#x2F;192.168.146.130 to hadoop01:9000 failed on connection exception: java.net.ConnectException: 拒绝连接;For more details see:  http:&#x2F;&#x2F;wiki.apache.org&#x2F;hadoop&#x2F;ConnectionRefused;</span><br><span class="line"></span><br><span class="line">  ... 104 more</span><br><span class="line">&lt;console&gt;:14: error: not found: value spark</span><br><span class="line">   import spark.implicits._</span><br><span class="line">  ^</span><br><span class="line">&lt;console&gt;:14: error: not found: value spark</span><br><span class="line">   import spark.sql</span><br><span class="line">  ^</span><br><span class="line">Welcome to</span><br><span class="line">  ____              __</span><br><span class="line"> &#x2F; __&#x2F;__  ___ _____&#x2F; &#x2F;__</span><br><span class="line">_\ \&#x2F; _ \&#x2F; _ &#96;&#x2F; __&#x2F;  &#39;_&#x2F;</span><br><span class="line">   &#x2F;___&#x2F; .__&#x2F;\_,_&#x2F;_&#x2F; &#x2F;_&#x2F;\_\   version 2.2.0</span><br><span class="line">  &#x2F;_&#x2F;</span><br><span class="line"> </span><br><span class="line">Using Scala version 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_112)</span><br><span class="line">Type in expressions to have them evaluated.</span><br><span class="line">Type :help for more information.</span><br><span class="line"></span><br><span class="line">scala&gt; </span><br><span class="line"></span><br><span class="line">scala&gt; val lines &#x3D; sc.textFile(&quot;&#x2F;home&#x2F;hadoop&#x2F;look.sh&quot;)</span><br><span class="line">&lt;console&gt;:17: error: not found: value sc</span><br><span class="line">   val lines &#x3D; sc.textFile(&quot;&#x2F;home&#x2F;hadoop&#x2F;look.sh&quot;)</span><br><span class="line">   ^</span><br></pre></td></tr></table></figure></li></ul><p><strong>其他可能出现的错误：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 spark]$ .&#x2F;bin&#x2F;spark-shell</span><br><span class="line">17&#x2F;07&#x2F;02 13:25:12 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Error while instantiating &#39;org.apache.spark.sql.hive.HiveSessionStateBuilder&#39;</span><br><span class="line"></span><br><span class="line">  ... 47 elided  </span><br><span class="line">Caused by: java.lang.RuntimeException: java.lang.RuntimeException: The root scratch dir: &#x2F;tmp&#x2F;hive on HDFS should be writable. Current permissions are: rwxr-xr-x;</span><br><span class="line"></span><br><span class="line">  ... 61 more </span><br><span class="line">Caused by:java.lang.RuntimeException: The root scratch dir: &#x2F;tmp&#x2F;hive on HDFS should be writable. Current permissions are: rwxr-xr-x</span><br><span class="line"></span><br><span class="line">  ... 70 more </span><br><span class="line">The root scratch dir: **&#x2F;tmp&#x2F;hive on HDFS should be writable. Current permissions are: rwxr-xr-x</span><br><span class="line"></span><br><span class="line">  ... 84 more</span><br><span class="line">&lt;console&gt;:14: error: not found: value spark</span><br><span class="line">   import spark.implicits._</span><br><span class="line">  ^</span><br><span class="line">&lt;console&gt;:14: error: not found: value spark</span><br><span class="line">   import spark.sql</span><br><span class="line">  ^</span><br><span class="line">Welcome to</span><br><span class="line">  ____              __</span><br><span class="line"> &#x2F; __&#x2F;__  ___ _____&#x2F; &#x2F;__</span><br><span class="line">_\ \&#x2F; _ \&#x2F; _ &#96;&#x2F; __&#x2F;  &#39;_&#x2F;</span><br><span class="line">   &#x2F;___&#x2F; .__&#x2F;\_,_&#x2F;_&#x2F; &#x2F;_&#x2F;\_\   version 2.2.0</span><br><span class="line">  &#x2F;_&#x2F;</span><br><span class="line"> </span><br><span class="line">Using Scala version 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_112)</span><br><span class="line">Type in expressions to have them evaluated.</span><br><span class="line">Type :help for more information.</span><br></pre></td></tr></table></figure><ul><li>上述错误出现的原因是/tmp/hive这里，本质上是hdfs中此目录的读写权限出了问题（Spark的运行并不需要Hive的开启，甚至没有Hive也可以），此处只是/tmp/hive这个目录出了问题，使用<code>hadoop dfs -chmod 777 /tmp/hive</code>来修改其权限，如果出现 Name node is in safe mode，那么则需要使用<code>hadoop dfsadmin -safemode leave</code>来退出安全模式，之后便可以正常修改权限，改完之后再执行spark-shell变会出现正常的初始化结果：</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>/<span class="number">07</span>/<span class="number">02</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">43</span> <span class="type">WARN</span> <span class="type">NativeCodeLoader</span>: <span class="type">Unable</span> to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line"><span class="number">17</span>/<span class="number">07</span>/<span class="number">02</span> <span class="number">13</span>:<span class="number">27</span>:<span class="number">54</span> <span class="type">WARN</span> <span class="type">ObjectStore</span>: <span class="type">Failed</span> to get database global_temp, returning <span class="type">NoSuchObjectException</span></span><br><span class="line"><span class="type">Spark</span> context <span class="type">Web</span> <span class="type">UI</span> available at http:<span class="comment">//192.168.146.130:4040</span></span><br><span class="line"><span class="type">Spark</span> context available as <span class="symbol">'s</span>c' (master = local[*], app id = local<span class="number">-1498973265138</span>).</span><br><span class="line"><span class="type">Spark</span> session available as <span class="symbol">'spar</span>k'.</span><br><span class="line">注意上述的三行初始化信息！</span><br></pre></td></tr></table></figure><ul><li>注意Spark-shell中的textFile(path)，参数path默认为hdfs://，要使用file://显式声明</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.textFile(<span class="string">"/home/hadoop/look.sh"</span>)</span><br><span class="line">lines: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = /home/hadoop/look.sh <span class="type">MapPartitionsRDD</span>[<span class="number">1</span>] at textFile at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.count()</span><br><span class="line">org.apache.hadoop.mapred.<span class="type">InvalidInputException</span>: <span class="type">Input</span> path does not exist: hdfs:<span class="comment">//hadoop01:9000/home/hadoop/look.sh</span></span><br><span class="line">  at org.apache.hadoop.mapred.<span class="type">FileInputFormat</span>.singleThreadedListStatus(<span class="type">FileInputFormat</span>.java:<span class="number">287</span>)</span><br><span class="line">  at org.apache.hadoop.mapred.<span class="type">FileInputFormat</span>.listStatus(<span class="type">FileInputFormat</span>.java:<span class="number">229</span>)</span><br><span class="line">  at org.apache.hadoop.mapred.<span class="type">FileInputFormat</span>.getSplits(<span class="type">FileInputFormat</span>.java:<span class="number">315</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">HadoopRDD</span>.getPartitions(<span class="type">HadoopRDD</span>.scala:<span class="number">194</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>$$anonfun$partitions$<span class="number">2.</span>apply(<span class="type">RDD</span>.scala:<span class="number">252</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>$$anonfun$partitions$<span class="number">2.</span>apply(<span class="type">RDD</span>.scala:<span class="number">250</span>)</span><br><span class="line">  at scala.<span class="type">Option</span>.getOrElse(<span class="type">Option</span>.scala:<span class="number">121</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>.partitions(<span class="type">RDD</span>.scala:<span class="number">250</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">MapPartitionsRDD</span>.getPartitions(<span class="type">MapPartitionsRDD</span>.scala:<span class="number">35</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>$$anonfun$partitions$<span class="number">2.</span>apply(<span class="type">RDD</span>.scala:<span class="number">252</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>$$anonfun$partitions$<span class="number">2.</span>apply(<span class="type">RDD</span>.scala:<span class="number">250</span>)</span><br><span class="line">  at scala.<span class="type">Option</span>.getOrElse(<span class="type">Option</span>.scala:<span class="number">121</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>.partitions(<span class="type">RDD</span>.scala:<span class="number">250</span>)</span><br><span class="line">  at org.apache.spark.<span class="type">SparkContext</span>.runJob(<span class="type">SparkContext</span>.scala:<span class="number">2087</span>)</span><br><span class="line">  at org.apache.spark.rdd.<span class="type">RDD</span>.count(<span class="type">RDD</span>.scala:<span class="number">1158</span>)</span><br><span class="line">  ... <span class="number">48</span> elided</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> lines = sc.textFile(<span class="string">"file:///home/hadoop/look.sh"</span>)</span><br><span class="line">lines: org.apache.spark.rdd.<span class="type">RDD</span>[<span class="type">String</span>] = file:<span class="comment">///home/hadoop/look.sh MapPartitionsRDD[3] at textFile at &lt;console&gt;:24</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.count()</span><br><span class="line">res1: <span class="type">Long</span> = <span class="number">26</span></span><br><span class="line"></span><br><span class="line">scala&gt; lines.first()</span><br><span class="line">res2: <span class="type">String</span> = #!/bin/bash</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><h3 id="安装Scala环境"><a href="#安装Scala环境" class="headerlink" title="安装Scala环境"></a>安装Scala环境</h3><p><strong>注意：</strong></p><ul><li>Scala环境本身的安装跟Spark无关，Scala本身就是一门类似Java的语言</li><li>可以在非集群内的主机安装该开发环境，然后通过ssh提交集群运行即可<br>（Spark版本2.x.x - Scala版本2.11.x以上，在IDEA中新建项目时会在首选项中进行选择）</li></ul><h3 id="第一个Scala程序：WordCount"><a href="#第一个Scala程序：WordCount" class="headerlink" title="第一个Scala程序：WordCount"></a>第一个Scala程序：WordCount</h3><p><strong>注意：</strong><br>类似于Hadoop，如果开发环境不在集群内，例如在自己PC中的IDEA进行开发（使用虚拟机同理），那么就会产生两种运行方式，一是本地运行，二是提交集群运行。<br>本质上两种方式都是先打包，再上传（本地或集群）。即流程是一致的，但是在PC中引入的spark-core的作用是不同的，提交集群运行时，PC中的spark-core内容只是作为语法检查，类方法调用等辅助作用；但是本地运行时，除了上述功能外，其还充当了计算部分，即可以使PC成为一个类似节点的且有计算能力的存在。</p><p><strong>全部步骤：</strong><br>PC上安装Scala环境，IDEA，IDEA安装Scala插件</p><p><strong>1.本地运行</strong></p><ul><li>新建Scala的Project，注意要选对应的scala版本</li><li>然后在build.sbt中添加spark-core的依赖，可以去MavenRepositories网站去查，找到sbt（ivy）的依赖格式就行了</li><li>然后新建一个scala class，选择object，书写代码，要使用本地模式</li><li>最后直接点击运行即可。<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 读取本地文件</span></span><br><span class="line">  <span class="keyword">val</span> path = <span class="string">"C:\\Users\\msi\\Desktop\\xiaomi2.txt"</span></span><br><span class="line">  <span class="comment">// 本地调试</span></span><br><span class="line">  <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">"SparkDemo"</span>).setMaster(<span class="string">"local"</span>)</span><br><span class="line">  <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">  <span class="keyword">val</span> lines = sc.textFile(path)</span><br><span class="line">  <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>)).filter(word =&gt; word != <span class="string">" "</span>)</span><br><span class="line">  <span class="keyword">val</span> pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">  <span class="keyword">val</span> wordscount: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = pairs.reduceByKey(_ + _)</span><br><span class="line">  wordscount.collect.foreach(println)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>打印结果：</strong><br>注意下述的IP地址和file路径，确实是在本地运行的，而且就是引入的sparl-core起的作用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">D:\Java\jdk1.8.0_77\bin\java "-javaagent:D:\JetBrains\IntelliJ IDEA </span><br><span class="line">...</span><br><span class="line">17/11/28 00:40:21 INFO Executor: Starting executor ID driver on host localhost</span><br><span class="line">17/11/28 00:40:21 INFO Utils: Successfully started service 'org.apache.spark.network.netty.NettyBlockTransferService' on port 58570.</span><br><span class="line">17/11/28 00:40:21 INFO NettyBlockTransferService: Server created on 192.168.230.1:58570</span><br><span class="line">17/11/28 00:40:21 INFO BlockManager: Using org.apache.spark.storage.RandomBlockReplicationPolicy for block replication policy</span><br><span class="line">17/11/28 00:40:21 INFO BlockManagerMaster: Registering BlockManager BlockManagerId(driver, 192.168.230.1, 58570, None)</span><br><span class="line">17/11/28 00:40:21 INFO BlockManagerMasterEndpoint: Registering block manager 192.168.230.1:58570 with 1992.9 MB RAM, BlockManagerId(driver, 192.168.230.1, 58570, None)</span><br><span class="line">...</span><br><span class="line">17/11/28 00:40:22 INFO HadoopRDD: Input split: file:/C:/Users/msi/Desktop/xiaomi2.txt:0+903</span><br><span class="line">17/11/28 00:40:22 INFO Executor: Finished task 0.0 in stage 0.0 (TID 0). 1111 bytes result sent to driver</span><br><span class="line">17/11/28 00:40:22 INFO TaskSetManager: Finished task 0.0 in stage 0.0 (TID 0) in 183 ms on localhost (executor driver) (1/1)</span><br><span class="line">...</span><br><span class="line">(小米客服那些事,1)</span><br><span class="line">(贤艾森秋t4krP0,1)</span><br><span class="line">(北京IHG向,1)</span><br><span class="line">17/11/28 00:40:22 INFO SparkContext: Invoking stop() from shutdown hook</span><br><span class="line">17/11/28 00:40:22 INFO SparkUI: Stopped Spark web UI at http://192.168.230.1:4040</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p><strong>2.提交集群运行</strong></p><ul><li>第一步同本地模式</li><li>第二步同本地模式</li><li>然后新建一个scala class，选择object，书写代码，要使集群模式</li><li>最后直接点击运行即可。<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WordCount</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 读取hdfs文件</span></span><br><span class="line">  <span class="keyword">val</span> path = <span class="string">"hdfs://192.168.146.130:9000/spark/look.sh"</span></span><br><span class="line">  <span class="comment">//远程调试</span></span><br><span class="line">  <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</span><br><span class="line">    .setAppName(<span class="string">"scalasparktest"</span>)</span><br><span class="line">    .setMaster(<span class="string">"spark://192.168.146.130:7077"</span>)</span><br><span class="line">    .setJars(<span class="type">List</span>(<span class="string">"I:\\IDEA_PROJ\\ScalaSparkTest\\out\\scalasparktest_jar\\scalasparktest.jar"</span>))</span><br><span class="line">  <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">  <span class="keyword">val</span> lines = sc.textFile(path)</span><br><span class="line">  <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>)).filter(word =&gt; word != <span class="string">" "</span>)</span><br><span class="line">  <span class="keyword">val</span> pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">  <span class="keyword">val</span> wordscount: <span class="type">RDD</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = pairs.reduceByKey(_ + _)</span><br><span class="line">  wordscount.collect.foreach(println)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvv7g94014f91qml150nsnb1ito9.png" alt="image_1bvv7g94014f91qml150nsnb1ito9.png-60.3kB">  </li></ul><p>此处一定要选择对Module（不是默认）和要运行的MainClass<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvv7i5bj14a0l4c2kc1pra1d70m.png" alt="image_1bvv7i5bj14a0l4c2kc1pra1d70m.png-43kB">  </p><p>点击OK后，选择Jar打包后的路径<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvv8p92j104td4dhfn1ro59b51g.png" alt="image_1bvv8p92j104td4dhfn1ro59b51g.png-154.8kB"></p><p><strong>使用命令：</strong><br>启动master:  ./sbin/start-master.sh<br>启动worker:  ./bin/spark-class org.apache.spark.deploy.worker.Worker spark://192.168.146.130:7077<br>需要配置<strong>spark-env.sh</strong>中：（下面设为localhost就远程不了了）<br>export  SPARK_MASTER_HOST=192.168.146.130<br>export  SPARK_LOCAL_IP=192.168.146.130<br>注意更新配置文件后需要把master和worker都重启才可以生效（单机两者都在一个机器上的情况）</p><p><strong>出现的错误：</strong><br>错误：java.io.FileNotFoundException: Jar I:\IDEA_PROJ\ScalaSparkTest\out\scalasparktest.jar not found<br>解决：修改setJar方法参数中的jar路径  </p><p>错误：Could not connect to spark://192.168.146.130:7077<br>解决：重启worker和master，前提是spark-env.sh中的MASTER_IP和WORKER_IP要设置正确  </p><p>错误：Exception: Call From msi-PC/192.168.230.1 to 192.168.146.130:8020 failed on connection exception: java.net.ConnectException: Connection refused: no further information;<br>解决：hdfs端口错误，很多教程写的是8020端口，但我hdfs是9000端口，所以要更正  </p><p>错误：Invalid signature file digest for Manifest main attributes<br>解决：打包的文件很大，把全部依赖都打包了，90多M，但正常应该10多M，删掉无用的依赖，并且把sbt中spark-core的依赖设为provided模式<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvvammdghvqppd1dp3nrc1ema1t.png" alt="image_1bvvammdghvqppd1dp3nrc1ema1t.png-110.7kB"></p><p>错误：重复出现如下错误</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">17/11/28 20:20:52 WARN TaskSchedulerImpl: Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources</span><br><span class="line">17/11/28 20:21:07 WARN TaskSchedulerImpl: Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources</span><br><span class="line">17/11/28 20:21:22 WARN TaskSchedulerImpl: Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources</span><br></pre></td></tr></table></figure><p>解决：Worker失效后被kill了[此时jps应该是没有Worker的]，重启Worker即可，还不行就将hadoop和spark都重启</p><p><strong>提交集群运行的结果：</strong>(注意IP和端口，确实是提交到集群/虚拟机 上运行后返回的结果)<br>整个过程全部在IDEA中，完全达到了本地调试，自动上传集群，并返回结果的流程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">D:\Java\jdk1.8.0_77\bin\java "-javaagent:D:\JetBrains\IntelliJ IDEA </span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:39 INFO StandaloneAppClient$ClientEndpoint: Executor added: app-20170630223625-0006/0 on worker-20170630215502-192.168.146.130-50762 (192.168.146.130:50762) with 1 cores</span><br><span class="line">17/11/28 02:09:39 INFO StandaloneSchedulerBackend: Granted executor ID app-20170630223625-0006/0 on hostPort 192.168.146.130:50762 with 1 cores, 1024.0 MB RAM</span><br><span class="line">17/11/28 02:09:39 INFO StandaloneAppClient$ClientEndpoint: Executor updated: app-20170630223625-0006/0 is now RUNNING</span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:43 INFO BlockManagerMasterEndpoint: Registering block manager 192.168.146.130:47071 with 413.9 MB RAM, BlockManagerId(0, 192.168.146.130, 47071, None)</span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:50 INFO TaskSchedulerImpl: Adding task set 0.0 with 2 tasks</span><br><span class="line">17/11/28 02:09:50 INFO TaskSetManager: Starting task 0.0 in stage 0.0 (TID 0, 192.168.146.130, executor 0, partition 0, ANY, 4853 bytes)</span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:55 INFO TaskSetManager: Starting task 1.0 in stage 0.0 (TID 1, 192.168.146.130, executor 0, partition 1, ANY, 4853 bytes)</span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:55 INFO TaskSchedulerImpl: Adding task set 1.0 with 2 tasks</span><br><span class="line">17/11/28 02:09:55 INFO TaskSetManager: Starting task 0.0 in stage 1.0 (TID 2, 192.168.146.130, executor 0, partition 0, NODE_LOCAL, 4625 bytes)</span><br><span class="line">...</span><br><span class="line">17/11/28 02:09:56 INFO TaskSetManager: Starting task 1.0 in stage 1.0 (TID 3, 192.168.146.130, executor 0, partition 1, NODE_LOCAL, 4625 bytes)</span><br><span class="line">...</span><br><span class="line">(-ef|grep,1)</span><br><span class="line"><span class="meta">($</span><span class="bash">Jarstr,1)</span></span><br><span class="line">([[,1)</span><br><span class="line">(do,1)</span><br><span class="line">(YES,1)</span><br><span class="line">(while,1)</span><br><span class="line">("$Jarinfo",1)</span><br><span class="line">(echo,1)</span><br><span class="line"><span class="meta">(#</span><span class="bash">!/bin/bash,1)</span></span><br><span class="line">17/11/28 02:09:56 INFO SparkContext: Invoking stop() from shutdown hook</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spark学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Spark </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过局部聚集自适应的解开小世界网络的纠结</title>
      <link href="/article/74eb.html"/>
      <url>/article/74eb.html</url>
      
        <content type="html"><![CDATA[<p>全称 IEEE Transactions on Visualization and Computer Graphics (TVCG)，是计算机图形学领域仅次于TOG (ACM Transactions on Graphics) 的顶级期刊</p><a id="more"></a><h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>小世界网络具有典型的低成对的短距路径距离，导致基于距离的布局方法产生毛球图形。因此，最近的研究方法是寻找图像的稀疏表示来放大成对距离的变化。由于在布局上对布局的影响难以进行分析，因此这些方法的组合过滤参数通常必须手动选择，并为每个输入实例分别选择。我们建议使用图不变量来自动确定合适的参数。这使我们能够执行自适应滤波来获得最突出的集群结构。该方法基于实际和合成网络的输入和输出特征之间的经验关系。实验结果表明，该方法能有效地提高强制导向布局方法的鲁棒性。</p><blockquote><p><strong>小世界网络</strong>Steven H.Strogatz的文章Exploringcomplexnetworks综述了动力学网络方面的研究。他把网络分成规则网络和复杂网络两种，而复杂网络分为随机网络，小世界网络和自相似网络。小世界网络和自相似网络都介于规则和随机网络之间。<br>小世界网络的特点：<br>在网络理论中，小世界网络是一类特殊的复杂网络结构，在这种网络中大部份的节点彼此并不相连，但绝大部份节点之间经过少数几布就可到达。<br>用数学中图论的语言来说，小世界网络就是一个由大量顶点构成的图，其中任意两点之间的平均路径长度比顶点数量小得多。除了社会人际网络以外，小世界网络的例子在生物学、物理学、计算机科学等领域也有出现。<br>哈佛大学社会心理学家米尔格伦的的“六度分隔”理论，他发现，20%的信件最终送到了目标人物手中。而在成功传递的信件中，平均只需要6.5次转发，就能够到达目标。也就是说，在社会网络中，任意两个人之间的“距离”是6。这就是所谓的“六度分隔”理论。<br>通过上面的论述可以发现社会网络图结构的特点非常具有小世界网络特征</p></blockquote><ul><li>引申-什么是社会网络<br>在学术上来讲，英文文献中出现的”socialnetwork”应被理解为”社会网络”，而非狭义的社交网络。社交网络的分析单位(unit of analysis)通常是”人”,比如我们会说某人的社交网络比较大广；此外，社交网络这个概念中”network tie “的性质也侧重在指代人与人之间的交互、沟通、互动、情感上面。<br>而“社会网络”(social network)既可以指人和人之间的网络，又可以指组织和组织之间的网络，甚至城市和城市之间的关系网络，国家和国家之间的关系网络。这里unitofanalysis不一定是人，而是社会中的实体（entity).此外，社会网络里面networktie可以是指各种类型的关系，比如，可以用来表示两个组织之间有没有相同的组织愿景或服务人群，两个球队之间有没有过交战记录，两个人之间对彼此的评价，或国家之间有没有经济往来等等，不限于“社交”的概念。</li></ul><p>社会网络的特征值：<br>三点组：全局集聚系数基于节点的三点组。一个三点组由三个节点组成，其中可以两边连接(为闭三点组)或三边连接(开三点组)，统称连通三点组。<br>全局集聚系数C：是闭三点组个数(或三倍三角形个数)除以全部连通三点组个数。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfermh21shu136o1lrl1e846bb9.png" alt="image_1bvfermh21shu136o1lrl1e846bb9.png-25.4kB"><br>局部集聚系数：对于每个节点i，ni是节点i的邻居节点个数。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvff6dem160dbbkqdc1gmm17rkm.png" alt="image_1bvff6dem160dbbkqdc1gmm17rkm.png-55.7kB"><br>平均本地聚集系数：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvff8g7b1msbt2r7c01j821sb613.png" alt="image_1bvff8g7b1msbt2r7c01j821sb613.png-3.9kB"><br>示例<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfffijqtlb1r041q6a1ih739r1g.png" alt="image_1bvfffijqtlb1r041q6a1ih739r1g.png-70.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvffg08io0114qa181kvaa112d1t.png" alt="image_1bvffg08io0114qa181kvaa112d1t.png-55.1kB"><br>嵌入性(embeddeness)：两个端点所共同拥有的邻居节点个数<br>（邻居节点重叠(neighborhood overlap)：）<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfg08evgac1q87or51mffo3o2a.png" alt="image_1bvfg08evgac1q87or51mffo3o2a.png-12.4kB"><br>网络基序(Network motif)<br>网络的复杂性本质上就是关系的复杂性。但是，研究者通过对真实网络的分析，发现各种关系种类的出现频率是非随机性的。某些特定的关系种类在网络中反复出现，形成网络的典型连接方式<br>不同类型的网络具有不同的典型连接方式<br>“网络基序”，认为它们是一个网络的基本构造单元</p><p>小世界网络：<br>高集聚系数<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfg60e215cg1qt3gcto2a1beo2n.png" alt="image_1bvfg60e215cg1qt3gcto2a1beo2n.png-2.9kB"><br>低平均最短路径长度<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfg6eif17o311b213i8fggcg434.png" alt="image_1bvfg6eif17o311b213i8fggcg434.png-4kB"><br>示例：<br>每个节点有K&gt;=4最近邻居节点（局部）<br>可调：改变重连接给定边的概率p<br>小p：规则网格<br>大p：经典随机图<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfg940blro17m5t93m951kkd3h.png" alt="image_1bvfg940blro17m5t93m951kkd3h.png-22kB"><br>小世界的起源：<br>隐含的社会网络结构并不包含群体关系，单但是如果将群体关系明确之后，会发现小世界网结构的产生正是由于实体的多个群体归属所导致的，如下图：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvfgbier1mcsndpne918kl1cui3u.png" alt="image_1bvfgbier1mcsndpne918kl1cui3u.png-66.3kB"></p><p><strong>回到原文</strong><br>关键点<br>自动参数选择，自适应边缘滤波，图形化简图，力导向布局，小世界网络，网络可视化</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>社交网络通常高度互联，并展示所谓的“小世界”属性。具有这一特征的网络一般都有一个小的平均成对的最短路径距离和一个高的局部密度。例如，对于脸书的友谊图，这意味着任何人只要与网络中的其他人有少量的中间连接就可以连接起来。<br>尽管可视化方法如强制导向的布局方法为许多图形提供了高质量的结果，但是它们的能力对于小世界图来说是有限的。最终的图纸通常凌乱,看起来像个毛团,其中固有的图形结构是不可见的。这使得社交网络中最重要的任务之一——工作分析、发现和可视化的内聚亚群以及它们在网络中的相互关系，非常有问题。这些布局方法的主要问题是，它们试图直接将成对的图-理论距离转化为欧氏距离。然而，如果成对的两种形式的变化是很低的，就像发球图一样，结果的布局在欧氏距离上也有较低的变化。</p><p>人们提出了各种各样的方法来减少毛球图上的乱画。虽然基于几何图形的可视化技术，比如“边圆面包”，由于在飞机上的节点上的缺失，应用到毛球图纸上，不太可能带来好处，但修改后的布局算法似乎更有希望，因为它们可以补偿图像中的结构性影响。例如，Boitmans等4人提议修改成对的距离，以使相邻的高度节点被进一步分开。这允许放大布局的核心，特别适合于具有极度倾斜程度分布的图形。另一个建议是在人工选择的领域中扭曲布局5。一种不同的一般方法是在图中识别集群，然后使用这些集群来可视化网络6、7。这种方法将可视化问题转移到集群或社区检测方法的选择上。</p><p>处理这个问题的另一种方法是图像的简化——阳离子，它的思想是将图中最重要的部分减少到最重要的位置。这个稀疏的子图，也就是所谓的主干，可以用来布局图。简化方法，保持特定的柱状图，如频谱8，cu/连接性9，或者缩短测试路径10，11，倾向于保持小的成对距离，也就是说，产生的后骨仍然是毛球图形。最具前景的简化方法是对内聚亚群进行的最有效的和视觉化的探索，就是根据嵌入的标准7、12、13、14、15来过滤边缘，这是基于边缘周围的局部密度来确定的。按照这种方法，所有的方法都需要输入一个阈值参数，根据这个参数提取主干，然后使用标准的强制方法进行布局。由于参数对最终可视化的非线性影响，找到合适的阈值参数来检索有意义的网络可视化是非常昂贵的。阈值的一个小差异可能已经完全改变了布局。因此，确定最佳的阈值，在布局中最突出的组结构，在试验和错误的基础上是一项非常耗时的任务，特别是对于大型网络来说。</p><p>对于这些方法，我们提出了一种预处理技术，它可以自适应地确定组结构在图和布局中最明显的阈值(如我们的实验中所示)。利用聚类系数，我们的技术可以量化每一个可能的阈值值。</p><p>我们的贡献是:</p><ul><li>一种新颖的方法来量化每一个阈值对主干的组结构的影响。</li><li>一种有效的动态算法，保持在边删除下的聚类系数，在O(α(G)m)总时间内运行，其中m是图中的边数，而α(G)是最小的能够覆盖图G边集合的生成森林</li><li>对我们的方法在许多真实世界和合成网络中的有效性进行了广泛的评估。</li></ul><p>为了评估我们的预处理技术，我们使用了四边的Simmelian脊骨，作为14个具有不同边缘嵌入度指标的实验研究，它非常适合于解开毛球图形，同时保留了组结构。特别是在多中心的小世界网络中，它支持标准的强制导向的布局技术，在最终的图中强调了固有的组结构。</p><p>我们首先从下一节的几个方面概述了主干布局方法，并解释了第3部分中自适应滤波的量化度量方法。在第4部分中，我们首先评估它的含义——确定与已知集群的关联，然后研究它对网络布局的影响。第5节总结了我们的结论。</p><h1 id="骨干布局方法"><a href="#骨干布局方法" class="headerlink" title="骨干布局方法"></a>骨干布局方法</h1><p>图1中显示的主干布局方法的总体工作流程如图1所示。在第一步中，计算了仅依赖于图结构的边嵌入度度量。基于这些边权值，过滤步骤将删除低于给定阈值的所有边。由于连接对于强制导向的布局方法是不可缺少的，但是可能会通过过滤步骤被破坏，下一步是将所有的边缘从基于嵌入度的所有树的结合中重新插入，以确保主干保持连接。请注意，为了避免任意的(非结构的)优先的优势，联合是必要的。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvh6ov4h1u3iqhovmo1bg8o639.png" alt="斯蒂芬斯蒂芬斯蒂芬是否"><br>图1所示。主干方法的工作流程由一个流程来扩展，该流程分析了所有可能的阈值参数，并对组结构进行了分析。这允许向用户指出有趣的阈值，以及对该参数的完全自动选择。</p><p>结构边缘嵌入的计算可以分为两部分。第一部分计算的是最初的边缘重量，即所谓的四边形重量，它测量了一个边在其邻域内的集成程度，并被定义为<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvh9509pdq813m8nsjqjhq79.png" alt="image_1bvh9509pdq813m8nsjqjhq79.png-10.2kB"><br>q(u,v) 是包含边(u,v)的四边形的个数<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvh9cj2b1v11vu1pae91417ke16.png" alt="image_1bvh9cj2b1v11vu1pae91417ke16.png-5.6kB"><br>v∈V，N(v)是v的邻居节点</p><p>此后，将执行重新附权值。重新调整权值原因是关系(u,v)∈E可能对u和v的重要性是不一样的。关系e可能对u是最重要的，可能是对v无关紧要的,例如因为v可能有其他更重要的关系,因此趋向于摆脱u的束缚.</p><p>对于一个边(u，v)，重新加权是根据最初的边权值来对u和v的邻边进行排序的。然后，k被选为Jaccard的系数，u和v的系数是最大化的。这一最大的Jaccard系数可以被看作是在他们的排名上的u和v的协议，并被用作过滤步骤的嵌入度。</p><p>为了计算最后一步的强制导向布局，我们使用了在14、18中建议的应力最小化16初始化。这种布局算法发现了节点位置，使得两两匹配的算法与图的理论距离相匹配。为了在算法的每一次迭代中找到这些位置，每个节点都被重新定位为所有其他节点的函数。在下一节中，我们将提出一个仅依赖于图形结构的度量，但是它仍然是最终布局质量的一个适当的指示器。</p><h1 id="基于局布局类的自适应过滤"><a href="#基于局布局类的自适应过滤" class="headerlink" title="基于局布局类的自适应过滤"></a>基于局布局类的自适应过滤</h1><p>在本节中，我们的目标是对网络中可聚类的结构程度进行量化，这应该可以作为网络集群结构的清晰程度的度量，但不需要执行实际的聚类操作。这个量化允许对手动选择和全自动参数提取提供可视化支持.<br>不同于在19、20中的现有方法来执行聚类操作，而是度量聚类在网络中的一个经常观察到的参数，即很高的平均聚类系数。聚类系数可以捕捉到一个顶点的邻域之间的关联程度。</p><p>在一系列具有不同的稀疏化参数的后骨中，主要的假设是，具有高聚类系数的主干比具有低聚类系数的主干更有可能包含内聚类。如果使用聚类系数的量化是有效的，那么它的最高值应该将我们指向稀疏化参数，由此产生的主干最类似于一个预定义的集群图22，表示底层的组结构。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvjb5i3nmt1rf1v512uo9v21j.png" alt="image_1bvjb5i3nmt1rf1v512uo9v21j.png-649.3kB"><br>图2所示。摘要通过对一个具有隐式群结构的综合网络，对聚类系数的聚类系数的有效性进行了评价。最高集群系数(a)表示参数，其中组刚刚开始分解(d)，这也是产生的主干与地面真相集群图最相似的点。(e)过滤删除了越来越多的集群边缘，破坏了组的相对位置。</p><p>更准确地说，我们使用phi系数作为一种相似性度量来评估聚类系数的有效性。phi系数可以被理解为两个矩阵实体之间的相关度量，其中第一个矩阵是主干图的邻接矩阵，第二个矩阵是给定的聚类结构的块矩阵。图2给出了整个过程的概况，并展示了一个带有预先划分的合成网络的聚类和phi系数，以及4个有不同的稀疏化阈值的主干图(图2b到2e)。聚类系数可以作为聚类结构的一个指标，并将我们的聚类参数化，这很有可能强调了团体信息。</p><h2 id="聚类系数的有效计算"><a href="#聚类系数的有效计算" class="headerlink" title="聚类系数的有效计算"></a>聚类系数的有效计算</h2><p>现在，我们研究了如何计算聚类系数对每一个可能的稀疏化参数进行计算的方法。局部聚类系数被定义为一个顶点v的封闭三元组的百分比</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvjbbshc1h2513cnln1d25s320.png" alt="image_1bvjbbshc1h2513cnln1d25s320.png-14.7kB"><br>λ(v)是顶点v涉及的闭合三元组(三角形)的数目。τ(v)是v中连接的三元组的数量，对于N(v)≤1（邻居节点个数）我们定义其聚类系数为0，这样便可以过滤掉外围度为1的点。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvjcljjs1f8u1ppr1cb11vaa12864a.png" alt="image_1bvjcljjs1f8u1ppr1cb11vaa12864a.png-156.6kB"><br>由上述可定义全局聚类系数或者叫做平均聚类系数：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvjc2pgj1gnr1pjq1o3taccnva3t.png" alt="image_1bvjc2pgj1gnr1pjq1o3taccnva3t.png-7.5kB"></p><p>当Sun调查网络统计数据的有效更新模式时，我们还不清楚他们更新方案的聚集系数。它们提供了一个用于更新聚类系数的O(<d>)时间复杂度，<d>是网络的平均度。考虑到时间复杂度O(<d>)远小于n=|V|,目前尚不清楚如何在聚集系数为n(最坏的情况下)时更新删除下一个边缘的数量可以在O(<d>)时间内执行完毕。当删除的边被包含在图中每个顶点的三角形中时，就会给出这样的情况(例如，算法1的例子)。</d></d></d></d></p><p>###　算法1　对全部可能的过滤变量计算聚集系数<br>输入：Graph G = (V,E) 其中 n = |V|,m = |E|,边权重 w：E -&gt; R(非零实数)，随E变化而变化<br>数据：Tr[e]:包含边e的三角形集合<br>      d[v]:顶点v的度，λ[v]:顶点v的三角形数目<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvjebkfamiimb61b8r1n1iu8r67.png" alt="image_1bvjebkfamiimb61b8r1n1iu8r67.png-3.6kB"><br>输出：多级(i=0,1,,k)主干结构的聚集系数Ci</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Tr[e],e∈E                       列出三角形集合（triangle listing algorithm）</span><br><span class="line">for v∈V do C[v]&lt;-λ[v]&#x2F;τ(v)      计算全部节点的聚集系数</span><br><span class="line">由全部节点的聚集系数得到平均聚集系数 C0</span><br><span class="line">按边的权重划分到不同的桶B1..Bk中</span><br><span class="line">按权重的降序将桶进行排序</span><br><span class="line">for i to k</span><br><span class="line">    foreach e &#x3D; (u,v)∈Bi do 循环每个桶中的边</span><br><span class="line">        &#x2F;&#x2F;remove来自三角形中的边e的贡献值</span><br><span class="line">        平均聚集系数 &#x3D; 平均聚集系数 - u和v的聚集系数影响</span><br><span class="line">        u的邻接点 &#x3D; 邻接点 - 边e涉及的三角形的顶点</span><br><span class="line">        v的邻接点 &#x3D; 邻接点 - 边e涉及的三角形的顶点</span><br><span class="line">        顶点u的度-1</span><br><span class="line">        顶点v的度-1</span><br><span class="line">        此时重新根据λ和τ计算顶点uv的聚集系数</span><br><span class="line">        最后再讲uv聚集系数的影响加回平均聚集系数</span><br><span class="line">    </span><br><span class="line">    foreach Tr[e]结合中的 (u,v,w)</span><br><span class="line">        类似上述过程</span><br><span class="line">        完成后就删除Tr()</span><br><span class="line">    Ci&lt;-C</span><br></pre></td></tr></table></figure><h2 id="迭代计算"><a href="#迭代计算" class="headerlink" title="迭代计算"></a>迭代计算</h2><p>定义 w:E-&gt;R 为边缘的权重，反映了结构上的边嵌入，W={w(e)|e∈E}是可能的边权重的集合，Gz，z∈W是 主干结构的结果。<br>为了计算一个图的聚类系数,我们只需要知道每个顶点的三角形数量,时间复杂度为O(α(G)m),α(G)是图的荫度,或是图g所需的能覆盖所有的边的最小生成森林。实际上,α(G)可以被认为是社交网络的一个小常数。对每个主干结构执行这个计算将花费O(α(G)m)时间，此时可能的主干结构数为O(m)。<br>算法1描述了如何通过计算原始图的聚类系数来提高效率，并迭代地更新正在删除的每条边的三角统计数据。<br>当边缘e被删除(第7行)时，所有的三角形(Tr)都会被销毁。因此，正如已经观察到的，对于其中一个三角形中的每个顶点来说，它的本地聚集系数和它对C的贡献值需要更新。</p><h2 id="算法1的正确性"><a href="#算法1的正确性" class="headerlink" title="算法1的正确性"></a>算法1的正确性</h2><p>根据聚集系数的定义，C平均、对初始图是正确的。它显示在每条边被删除后C平均、的适当的更新。因此，在删除边e=(u,v)之后，就可以显示每个局部聚集系数C[v]被正确地更新了。局部系数只改变了通过e创建了三角形的顶点，而e的所有三角形(Tr[e])也都是u和v的三角形(见算法1下面的数字)。因为它们都被破坏了，所以我们需要通过|Tr[e]|来减少λ[v]和λ[u]。对于e所在的三角形中一个带有权重w的边e，实际上只有一个三角形受到影响(算法1的第17行)，通过从三角形集合中删除另外两条边（(u,w)(v,w)）的每个三角形移除每个三角形t，我们确保这个三角形永远不会再被考虑。因此，C[w]被正确地更新了。u和v的度也被正确地减少了一个单位，这样就可以更新C[u]和C[v]了。</p><h2 id="算法1的运行时间"><a href="#算法1的运行时间" class="headerlink" title="算法1的运行时间"></a>算法1的运行时间</h2><p>算法1的第一部分的运行时间主要由列出三角形(O(α(G)m))和排序(O(mlogm))组成，在第二个for循环中，每个三角形都处理一次，所需的更新需要常数时间。因为最多有O(α(G)m)个三角形，所以第二个for循环的运行时间是O(α(G)m)。</p><h1 id="评估有效性"><a href="#评估有效性" class="headerlink" title="评估有效性"></a>评估有效性</h1><p>根据所选的稀疏化参数，原图的散化会产生不同的主干结构。对于每一个这样的结构，我们想要量化它的结构是如何被一组固有的群集所组成的。<br>模块化通常用于聚类质量评估，但我们不使用它，这是因为它的反直觉行为:即使是对图的完美划分，也只包含有连接的组件，而模块化具有多样性，并且与1的最优值有很大的不同。我们将读者介绍到引述27和28，就这一行为进行更广泛的讨论。<br>相反，我们测量了主干结构的相似性，其反映了一个完美的划分，由非连接的小结组成，使用对应的邻接矩阵的phi系数。当应用于二进制变量时，phi系数是皮尔逊相关系数的一种变化。弗里曼也称其为Borgatti的参数。<br>直观的解释是，如果图形与给定的完美划分相似则它的值很大，如果不相似，则很小(接近0)。</p><p>由于成对的缩短路径距离通过力导向布局被转换成欧氏距离，我们计算了平均成对的最短路径距离来量化特定参数的图的扩展。在此基础上，利用欧氏空间内的平均邻居距离作为一种局部紧度测度，对阈值参数对最终布局的影响进行了评价。如果聚集结构对于某一特定的主干来说是突出的，那么局部的布局紧凑性应该是很高的。</p><p>我们现在更精确地定义phi系数，并给出一个具体的例子。在此之后，我们将解释数据集和图形模型，以最终讨论结果和局限。</p><h2 id="phi相关系数"><a href="#phi相关系数" class="headerlink" title="phi相关系数"></a>phi相关系数</h2><p>对于主干图G’={V,E’∈E}和顶点集V的划分C={C1,…,Ck} ，令C(v)∈C表示顶点v∈V的聚类。进一步，令<br>X作为G’的邻接矩阵<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvkmjl241k4m6h1ucg1qbt1qck6k.png" alt="image_1bvkmjl241k4m6h1ucg1qbt1qck6k.png-15.4kB"><br>Y作为在这个划分上的完美图的邻接矩阵<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvkmn284dhmfr9ijll16186f71.png" alt="image_1bvkmn284dhmfr9ijll16186f71.png-13kB"><br>在这里，循环并不重要，只要它们的存在或不存在被定义为X和Y。由于我们只对一个顶点对的布尔值感兴趣，所以皮尔逊相关系数会降低到phi值。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvknkhc22gg1iihnfv16t8cjq7e.png" alt="image_1bvknkhc22gg1iihnfv16t8cjq7e.png-8.8kB"><br>a，b，c，d代表观测的频率，从2 x 2个偶然事件表中得到<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvknljii19nacitfv2j7n1bdk7r.png" alt="image_1bvknljii19nacitfv2j7n1bdk7r.png-5.1kB"></p><p>下图3给出了一个图和一个完美的分区之间的相似性的例子。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvknmp2h17kr35tkmo1slv17mr88.png" alt="image_1bvknmp2h17kr35tkmo1slv17mr88.png-17.7kB"><br>左边的图G与一个完美的分区(顶点颜色)相似，正如G的邻接矩阵X和完美的划分Y的矩阵结构之间的高度相似性所表明的那样。此时，x=1,y=1是23，x=1,y=0是2，x=0,y=1是2，x=0,y=0是22<br>φ(X,Y)=套公式=0.84</p><h2 id="数据和模型"><a href="#数据和模型" class="headerlink" title="数据和模型"></a>数据和模型</h2><p>对于评估，我们使用来自facebook100数据集的网络。这些网络最初来自Facebook，包含了美国100所高等教育机构的学生的社会关系。网络大小不同，从762到41K个顶点，从16K到160M条边。其他的属性，如性别，预期的毕业年，宿舍等，都被作为顶点属性。Traud等30人认为，宿舍对社会关系的形成很重要。因此，我们使用寝室属性作为分区C，从而用phi值进行评估。当主干结构和聚类系数计算考虑到图的所有顶点时，在计算phi值时则会忽略一个缺失宿舍值的顶点。因此，大量缺失的值可能会将phi值作为评估准则。<br>请注意，尽管经验上许多社交相关的属性与同型属性值相关联，但在Facebook的网络中，没有一个真实的群体结构是可用的。出于这个原因，我们还使用了一种基础的地面真相组结构，使用了14个分区模型(PPM)，并由Lancichinetti等人(LFR)的模型来生成人工网络。</p><h2 id="结论和讨论"><a href="#结论和讨论" class="headerlink" title="结论和讨论"></a>结论和讨论</h2><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm862is1grvvh1jam1jn12d09.png" alt="image_1bvm862is1grvvh1jam1jn12d09.png-33.6kB"><br>图2a 剩余的边缘<br>聚集效应（上）以聚类参数为基础，和真实的情况（phi系数）十分相似（下），沿着稀疏化参数的减小。</p><p>首先，我们讨论了聚集系数作为phi系数的代理的有效性。然后通过查看局部布局的紧凑性，来评估这种行为是否也反映在最终的布局中。实验的结果是每个网络的两条曲线，类似于图2a。从左到右，根据嵌入的测量，越来越多的边被移走。这些曲线通常有一个顶点。图4显示了这些apexes的聚类和phi系数值。<br>由于空间限制，我们无法显示所有facebook100网络的结果。因此，我们选择了11个在图4中标注他们名字的Facebook网络。选择准则是对不同区域的覆盖，反映了网络的各种属性。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm87a3o1f3r8lna3t17a21rvcm.png" alt="image_1bvm87a3o1f3r8lna3t17a21rvcm.png-57.2kB"><br>图4 聚集系数和phi值的关系<br>facebook 100网络和PPM500的最大聚集系数，以及所有可能的稀疏化比例。为进一步的分析选择了被标记的网络。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm88bckjmt1l3ds7l2151f7q13.png" alt="image_1bvm88bckjmt1l3ds7l2151f7q13.png-120.8kB"><br>图5 聚集系数和phi值的关系<br>在不同网络(Facebook100+PPM500)上的散化比和聚类系数。如果phi值很高，那么峰值位置就非常接近。</p><p>图5显示了选定网络的聚类和phi系数的曲线。最大值处使用虚线突出显示。对于PPM500网络，聚集系数的峰值非常接近phi值的峰值，在这种情况下，对边缘的进一步过滤只会使集群变得稀疏。如果phi系数很高，例如，对于奥伯恩71、Caltech36、Lehigh96或史密斯60，那么这两个最大值就会接近于彼此。这意味着最大的聚集系数将我们指向过滤参数，其中的密度对于固有的聚类来说是最高的。与其他网络相比，Auburn71略有不同，因为它的phi值比上半年的聚类系数要大。看图4，我们可以看到80%的边都缺少相应顶点的宿舍属性值。当集群系数考虑到网络的所有顶点时，phi系数必须忽略那些缺少值的值，因为它们不为它们所知。对这些缺失值的认识可能会改变曲线的形状。</p><p>我们可以看到，对于许多其他的网络，phi系数并没有明显上升，这可能表明，宿舍并不是固有群体的解释变量。然而，聚集系数却有一个明显的峰值，这使我们能够识别出固有的结构的一个重要的全局方面。<br>我们还试验了许多关于集群系数的加权变量，如Panzarasa和Opsahl所讨论的，但我们没有看到对非加权的准确性的提高。结果具有可比性。我们期望其他的变量，如传递比，网络中三角形的数目除以三元组的数目，也可以工作。<br>利用Lancichinetti等人的图形模型，我们生成了一个真实社区结构的网络。我们将混合参数m从0.1增加到0.8，这增加了潜在的噪音，并逐渐模糊了群体结构。我们使用这个模型的实际经验是，如果混合参数大于0.6，那么这个组结构就几乎不存在了。图6显示了最大的聚类系数与最大的phi系数，使用地真信息的最大程度相同。这意味着最大的聚类系数是一个很好的代理，可以用来识别在生成的主干中最显著的组结构的稀疏化参数。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm8973h1ep51qgb35411ms7g21g.png" alt="image_1bvm8973h1ep51qgb35411ms7g21g.png-37.2kB"><br>图6 phi值代替稀疏化参数<br>基于LFR模型的真实社区结构和不同噪音水平的图表。选择基于最大聚类系数的稀疏比，给出的结果与使用phi系数的结果几乎相同。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm8abt81bns1270g34a4vhjn2a.png" alt="image_1bvm8abt81bns1270g34a4vhjn2a.png-42.1kB"><br>图8 阈值和最大聚集系数的关系<br>最大群集系数和它的过滤值(四边形Simmelian)为facebook100+PPM500。在三个阈值值之间进行分组，表明在不同的固有社区中存在类似的密度衰减。</p><h3 id="过滤值"><a href="#过滤值" class="headerlink" title="过滤值"></a>过滤值</h3><p>我们可以观察到一个有趣的观察值，当观察到集群系数最大(图8)的四边Simmelian主干的阈值过滤值时，可以清楚地看到facebook100网络组大约有三个不同的阈值值。这表明，在这些网络中，本地社区结构是相似的，网络中的不同社区之间的密度衰减是一致的(在这些群体中)。找出社区的规模，看看它们是否与这些群体相关联也会很有趣。使用更多的机构信息进行额外的分析，例如，基础设施的属性，可能会揭示更多的解释。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm89r5r1kja1j0eiltlaudg1t.png" alt="image_1bvm89r5r1kja1j0eiltlaudg1t.png-86.8kB"><br>图7<br>平均最短路径在增长<br>聚集系数指明了甜蜜点<br>局部布局更紧凑，组织变得明显<br>网络通常有一个甜蜜的点，在这个点上，成对的距离(灰色的曲线)增加，但是组(蓝色曲线)是紧凑的，正如聚类系数(红色曲线)所显示的那样。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="布局质量"><a href="#布局质量" class="headerlink" title="布局质量"></a>布局质量</h3><p>对于较小的图形，我们计算了各种增加滤波器参数的力导向布局，并对该布局的局部紧化度进行了评估(图7)，可以观察到局部紧实曲线与聚类系数非常相似。高紧度表示图中的顶点的邻边与布局中的这个顶点非常接近。考虑到布局实际上是在扩展，用单调递增的平均短时间曲线(图7顶部)表示，这意味着基于最优聚类系数参数，在最终的布局中，底层集群变得越来越紧凑。<br>为了查看我们的自适应过滤对图表的影响，我们使用了我们的方法来处理PPM500(25%)图(图2d)。图7所示的聚类系数曲线表明，如果去掉许多边，该群结构就会被破坏。这表明我们的方法甚至可以应用于非发球图上，使图更清晰地显示出一个已经清晰的组结构。</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm8gsns1jpm7ne15q6b4llgi2n.png" alt="image_1bvm8gsns1jpm7ne15q6b4llgi2n.png-1148kB"><br>图9<br>来自facebook 100数据集的网络图(Rice31，|V|=4k，|E|=9.7w)。左:原始的力导向布局，右:力导向的布局，我们的自动过滤在四边形的Simmelian主结构上。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm8hnfdcocqaa1ji4174tshk34.png" alt="image_1bvm8hnfdcocqaa1ji4174tshk34.png-1075.7kB"><br>图10<br>facebook 100数据集的一个较大的网络(Auburn71，|V|=18k，|E|=100万)。左:原力导向的布局，右:力导向的布局，我们的自动过滤在四边形的Simmelian主结构上。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bvm8lv5h1dhfvghier1g681o5e3h.png" alt="image_1bvm8lv5h1dhfvghier1g681o5e3h.png-617.5kB"><br>图11<br>来自facebook100数据集(Smith60，|V|=3k，|E|=100k。左:原始的力导向布局，右:力导向的布局，我们的自动过滤在四边形的Simmelian主结构上。</p><h3 id="绘制"><a href="#绘制" class="headerlink" title="绘制"></a>绘制</h3><p>看一看图9、10,11中所产生的主干图，可以看到不同的集群，分别为Caltech36、Rice31、Auburn71和smith 60。强调网络的局部密度和主干布局让我们能够在全局环境中获得关于局部图结构的信息<br>的图。主干显示:</p><ul><li>许多强大的社区存在。</li><li>社区常常是高度重叠的。</li><li>许多参与者(或顶点)没有很好地集成在强社区内。</li></ul><p>根据这些建议，一个图形聚类(或社区检测)方法应该关注于强大的、可能是重叠的社区，以及一组参与者，它们在那里，但不是这些强大社区的一部分。当然，这些参与者可以根据需要分配到他们最接近的社区，例如，如果应用程序需要的话。<br>在分析的网络中，唯一的例外是收获图，在图中没有可见的局部集群，图9b。图8中Facebook网络的边界位置表明，与其他选择的网络相比，它具有不同的结构属性。这可能是哈佛大学住房政策的结果，该政策仅在第一年就为学生提供宿舍。<br>注意，具有最大集群系数的主干强调了全局上下文中的组结构。可能需要过滤出更多的边来观察固有组的精细结构。</p><h2 id="局限"><a href="#局限" class="headerlink" title="局限"></a>局限</h2><p>我们提出的技术在运行时可以很好地扩展到大的图形。然而，我们对集群结构的量化是整个网络的聚合，因此对单个局部细节不敏感。将这种量化以一种更精细的方式进行扩展将是很有趣的，例如，只对交互选择的顶点的子集进行计算。这将允许在图中更详细地分析和可视化特定的兴趣区域。</p><p>正如在14个方面所注意到的，四边形的Simmelian主干对于多中心网络特别有用，而对于一个单一中心的网络则更少，例如中心-外围结构。我们的量化指标只能和潜在的边缘嵌入度一样有效，因此当应用于单一核心网络时，它也有类似的缺点。</p><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>我们提出了聚类系数的使用方法，在聚类结构的基础上，定量地分析了在主链结构上对主链结构的影响。使用真实世界和合成网络进行的实验评估，证实了其在四边形Simmelian脊骨上的有效性，结果也可能扩展到其他密度的基础上。此外，我们还展示了如何有效地计算每一个可能的阈值参数的聚类系数。<br>这在探索和可视化大型网络时尤其有用，因为在大量的网络空间中，由于时间密集型的布局重新计算，在一个错误的基础上选择适当的sparsi虚拟化级别是非常麻烦的。<br>虽然图表的布局度量和视觉检查都表明集群确实是明显的，但是在2行中详细的用户研究必须显示出这种视觉效果对于特定任务的重要性，例如类簇的选择。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 力导向 </tag>
            
            <tag> 图简化 </tag>
            
            <tag> 小世界网络 </tag>
            
            <tag> 边过滤 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Spark的大数据热图可视化方法</title>
      <link href="/article/84c8.html"/>
      <url>/article/84c8.html</url>
      
        <content type="html"><![CDATA[<pre><code>计算机辅助设计与图形学学报 2016-11 浙江工业大学&amp;浙江大学</code></pre><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>针对普通客户端浏览和分析大数据困难的问题, 结合 Spark 和 LOD 技术, 以热图为例提出一种面向大数据可视化技术框架. 首先<strong>利用 Spark 平台分层</strong>并以<strong>瓦片</strong>为单位并行计算, 然后将结果分布式存储在 HDFS 上, 最后通过web 服务器应用Ajax技术结合地理信息提供各种时空分析服务.文中重点解决了数据点位置和地图之间的映射, 以及由于并行计算导致的热图瓦片之间边缘偏差这2个问题.实验结果表明,该方法将数据交互操作与数据绘制和计算任务分离, 为<strong>浏览器端大数据可视化</strong>提供了一个新的思路.</p><a id="more"></a><h3 id="目前大数据可视化面临的主要问题包括"><a href="#目前大数据可视化面临的主要问题包括" class="headerlink" title="目前大数据可视化面临的主要问题包括:"></a>目前大数据可视化面临的主要问题包括:</h3><p>1) 数据复杂散乱. 经常发生数据缺失、数据值不对、结构化程度不高.<br>2) 迭代式分析成本高. 在初次查询后如果发现结果不对, 改变查询条件重新查询代价高.<br>3) 构建复杂工作流困难. 从多数据源取得包含各种不同特征的原始数据,然后执行机器学习算法或者复杂查询, 探索过程漫长.<br>4) 受到原有技术限制, 对小规模数据分析很难直接扩展到大数据分析.<br>5) 数据点的规模超过普通显示器可能提供的有效像素点.<br>Hadoop和Spark先后成为大数据分析工业界的研究热点,前者是一个能够对大量数据提供分布式处理的软件框架和文件系统(hadoopdistrib-utedfilesystem,HDFS);后者是一个通用大数据计算平台,可以解决大数据计算中的批处理、 交互查询及流式计算等核心问题.Zeppelin可以作为Spark的解释器,进一步提供基于 Web 页面的数据分析和可视化协作可以输出表格、柱状图、折线图、饼状图、点图等,但是无法提供更为复杂的交互分析手段.</p><h3 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h3><p><strong>面向 web 的轻量级数据可视化工具</strong>主要是一些JavaScript库，利用canvas或者svg画散点，svg不能支持十亿以上的节点，使用 canvas 画布绘图的heatmap.js 在面对大数据量时也无能为力.<br><strong>热图</strong>是一种常用的基本数据可视化技术,通常用颜色编码数值大小，并以矩阵或方格形式整齐排列,在二维平面或者地图上呈现数据空间分布,被广泛应用在许多领域.近年来,许多研究者成功地将热图应用在眼动数据可视分析上, 有效地概括并表达用户视觉注意力的累计分布<br><strong>LOD</strong>针对数据可视化绘制速度慢、效率低等问题,孙敏等提出<strong>基于格网划分的LOD</strong>(levelsofdetail)分层方法, 实现对大数据集 DEM 数据的实时漫游.</p><h3 id="并行计算大数据热图"><a href="#并行计算大数据热图" class="headerlink" title="并行计算大数据热图"></a>并行计算大数据热图</h3><ul><li>经纬度换算</li><li>并行计算<br>在 Spark 平台上实现热图的绘制,首先将经纬度坐标转换为对应不同瓦片上的像素坐标.每个基站的辐射范围可近似认为相同, 即每个基站（收集数据的基站坐标）的初始影响力近似相同,因此可采用<strong>影响力叠加法</strong>将数据点绘制到画布上,然后做径向渐变,叠加出每个位置的影响大小,得到初始灰度图,如图2a所示.然后将每一个像素点着色,根据每个像素的灰度值大小,以及调色板将灰度值映射成相对应的颜色. 图 2b 是一个透明的PNG 格式图片, 调色板如图 2c 所示. 本文中出现的热图均采用图 2c 调色板.<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv9vh4oqfatb5a12s4ui1sbe9.png" alt="image_1bv9vh4oqfatb5a12s4ui1sbe9.png-185.9kB"><br>将计算出的热图结果存储在HDFS上,并与经纬度以及层级建立索引关系方便以后读取,拼接后的热图绘制效果如图 3 所示.<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv9vj0vb16um1pt91qrs17bh1jam9.png" alt="image_1bv9vj0vb16um1pt91qrs17bh1jam9.png-128kB"></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="瓦片边缘问题"><a href="#瓦片边缘问题" class="headerlink" title="瓦片边缘问题"></a>瓦片边缘问题</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv9vno7315gi1l1r1gog1cdg1tdnm.png" alt="image_1bv9vno7315gi1l1r1gog1cdg1tdnm.png-34.6kB"><br>边缘热点可能处于2片或者4片瓦片之间,因此需要通过2次或者4次重复计算.通过本文提出的重叠计算方法可以解决热图分片计算的边缘问题。</p><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv9vr8311fe817tt11bb22qlr113.png" alt="image_1bv9vr8311fe817tt11bb22qlr113.png-284.2kB"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文提出的大数据热图可视化方法能够有效地解决<strong>前端绘制计算量大的问题</strong>,通过在Spark平台上以瓦片为单位分层次并行计算热图, 将生成的热图存储在HDFS上,然后通过web服务器提供浏览器交互服务, 用户可以通过在地图上拖动鼠标或放大/缩小等操作选择感兴趣区域,再分析不同时间点用户行为差异或渐变过程. 通过解决<strong>热图数据点和地图映射</strong>关系问题以及<strong>瓦片热图之间的边缘</strong>问题,提供大数据热图绘方法, 以满足用户交互、协同和共享等多方面需求.该方法可以拓展到其他常用可视化方法,如ScatterPlot, Bar Chart,平行坐标等.但绘制过程是基于Spark计算后得到的<strong>离线数据</strong>,在<strong>实时性</strong>上还不能得到保证, 在下一步工作中, 我们将着手利用 <strong>Spark Streaming</strong> 库来解决这一问题.</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 热图 </tag>
            
            <tag> 并行计算 </tag>
            
            <tag> 大数据 </tag>
            
            <tag> 细节层次 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一种基于力导向布局的层次结构可视化方法</title>
      <link href="/article/3bfa.html"/>
      <url>/article/3bfa.html</url>
      
        <content type="html"><![CDATA[<p>  计算机仿真    2014-3<br>    北京工商大学</p><p>在数据结构优化管理的研究中，传统的力导向方法应用于层次结构数据的展示时，会存在<strong>树形布局展示不清楚</strong>的问题。为解决上述问题，通过层次数据特征分析，提出了一种面向层次数据的力导向布局算法，<strong>将力导向布局中不同层次的边赋予不同初始弹簧长度</strong>，以解决层次数据中结构信息展示不清楚的问题，然后结合层次上下行、Overview+Detail等交互技术，通过与气泡图的协同，清晰展示层次数据的内容信息，从结构和内容角度对层次数据进行可视化和可视分析。实验表明，能够有效提高层次结构数据的展示能力，最后应用于农产品中农残检测结果数据的分析和观察，取得良好效果。</p><a id="more"></a><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>层次数据的节点链接可视化方法主要包括双曲树(Hyperbolic Tree)和径向树(Radial Tree)等。</p><p><strong>双曲树</strong>是一种fbcus+context技术来显示大型层次数据的可视化方法。该技术的本质是使用统一的算法将层次结构布局到双曲平面上，然后再将该双曲平面映射到圆形显示区域。</p><p><strong>力导向算法</strong>是一种常用的绘制一般网状结构的方法。最初由PeterEades提出，它仿真物理力学的概念，对网络图中任意一个节点，都受到引力及斥力。引力是由与此节点有边相连接的每个邻居所提供的合力，其意义是节点与其邻居之间的距离不会太远；斥力是由整个网络图中除了本身以外的节点所提供，为了让任意两节点不会因距离太近而产生重叠的现象，也因此整个网络图不会太密集而影响视觉。</p><p><strong>算法的终止</strong>通过给定节点的初始位置，放人此力导向的物理模型中，系统自动调整节点位置，直至达到稳定条件才结束。</p><p>对于<strong>簇状数据</strong>，出现了一种与力导向结合的方法，此方法是一种基于将一个图划分为多个子图的多级技术．开始先构建最小的子图，使用力导向布局调整节点的位置．然后在下一层级的子图划分中使用调整好后的结果。</p><p>但是，力导向算法应用于<strong>树型数据</strong>的研究还较少。本文将力导向算法应用于层次数据的布局，提出一种可变弹簧的力导向布局算法，能够较好展示<strong>结构信息</strong>，并结合气泡图展示其中的内容信息，设计完成了多视图协同可视分析系统.</p><h3 id="向层次数据的力导向布局算法"><a href="#向层次数据的力导向布局算法" class="headerlink" title="向层次数据的力导向布局算法"></a>向层次数据的力导向布局算法</h3><p>传统力导向布局会产生边长度相对一致的情况，而这种情况对层次结构的展示是不明显的，尤其是在节点普遍具有较大出度的情况下，在布局中表现为中心节点即根节点处有节点混杂，在叶节点处子树的交叉遮挡现象严重．子树的成团效果不明显，因而影响对层次数据的观察。</p><p>本文考虑调整不同层次的<strong>边的长度</strong>以示区分，以不同的边长表现不同的层次，使得根节点处的边长较长而叶节点的边长较短。并依树形结构的结构特征达到一定的边长比值，从而实现中心节点处发散而叶节点处收敛的目的。</p><p>对于不同层次的边赋以不同的长度，以区别其向指父节点和其子节点的边。并使相邻层次满足边长比例为C，C为某常数,将此布局算法称为<strong>可变弹簧力导向布局算法VSFDP</strong>。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7ns6oms0c1668t6319ui1a2r9.png" alt="image_1bv7ns6oms0c1668t6319ui1a2r9.png-201.6kB">  </p><p><strong>斥力计算：</strong><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7o1k039em1j491adjmstuh5m.png" alt="image_1bv7o1k039em1j491adjmstuh5m.png-154.7kB">  </p><p><strong>引力计算：</strong><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7ob1pv1imautboti1942lq913.png" alt="image_1bv7ob1pv1imautboti1942lq913.png-297kB">  </p><p>确定不同层次弹簧长度的比值<strong>常数C</strong><br>对于一棵规则的满n叉树来说，节点所处的层次越高，其子树包含的节点数目越多。这篇文章将N层节点与N+1层节点的比值定为常数n，则C=n，但是如果每层节点的度的比值不是常数，那么就使用数的平均度来作为常数C：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7p29jq1rl9hp3p5jijs17s1g.png" alt="image_1bv7p29jq1rl9hp3p5jijs17s1g.png-78.6kB">  </p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p><strong>VSFDP算法步骤：</strong></p><ol><li>将输入数据转化为树型结构存储</li><li>计算树型结构的源数据：非叶子节点的度，树的平均度</li><li>根据期望距离（默认长度）+比例常数C来规定每层的边长度</li><li>建立模型，代入数据</li></ol><h3 id="交互方式"><a href="#交互方式" class="headerlink" title="交互方式"></a>交互方式</h3><ul><li>层次放大和层次缩小</li><li>Overview+Detail</li><li>气泡图</li></ul><h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><p><strong>可视化流水线</strong>是将原始数据转换成计算机内存中数据结构。并用一种可视化方法将数据在屏幕上展现出来的过程，如图下图所示，在这个过程中包括用户的交互反馈以及各种工具方法等的使用。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7qncht5oh1hskfvgk0719861t.png" alt="image_1bv7qncht5oh1hskfvgk0719861t.png-35.2kB"></p><h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bv7qqn1n12s1157p11ec1d8h1nka2a.png" alt="image_1bv7qqn1n12s1157p11ec1d8h1nka2a.png-209.1kB"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这篇论文第一个创新点是对传统力导向算法的改进，加入了分层布局，使用整个图的平均度作为常数C，这样的结果就是度大的节点被分为一层，这里他们在布局时会被赋予较长的边距离，然后依次类推，下一层节点拥有较小的度，但是赋予的边的距离也同样变短。<br>另外，在交互手段上使用气泡图辅助，气泡图的圆心在当前层的节点位置，半径同样是按层间的比例，在将布局展示的同时通过气泡来辅助交互。</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 节点连接 </tag>
            
            <tag> 层次数据 </tag>
            
            <tag> 力导向布局 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebSocket的初次使用及调试</title>
      <link href="/article/c4.html"/>
      <url>/article/c4.html</url>
      
        <content type="html"><![CDATA[<h4 id="出现的错误"><a href="#出现的错误" class="headerlink" title="出现的错误"></a>出现的错误</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.3:compile (default-compile) on project JavaWebSocket: Fatal error compiling: 无效的目标发行版: 1.8 -&gt; [Help 1]</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>修改：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">   &lt;plugin&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-war-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.6&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;warSourceDirectory&gt;WebRoot&lt;&#x2F;warSourceDirectory&gt;</span><br><span class="line">      &lt;failOnMissingWebXml&gt;false&lt;&#x2F;failOnMissingWebXml&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">      &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-war-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;source&gt;1.6&lt;&#x2F;source&gt;</span><br><span class="line">      &lt;target&gt;1.6&lt;&#x2F;target&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line">&lt;&#x2F;plugins&gt;</span><br></pre></td></tr></table></figure><p><strong>此处使用maven自动打包上传的插件</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">              &lt;plugin&gt;  </span><br><span class="line">    &lt;groupId&gt;org.codehaus.mojo&lt;&#x2F;groupId&gt;  </span><br><span class="line">    &lt;artifactId&gt;tomcat-maven-plugin&lt;&#x2F;artifactId&gt;  </span><br><span class="line">    &lt;version&gt;1.1&lt;&#x2F;version&gt;  </span><br><span class="line">    &lt;configuration&gt;  </span><br><span class="line">        &lt;url&gt;http:&#x2F;&#x2F;localhost:9080&#x2F;manager&#x2F;text&lt;&#x2F;url&gt;  </span><br><span class="line">        &lt;server&gt;tomcat8&lt;&#x2F;server&gt;  </span><br><span class="line">        &lt;username&gt;admin&lt;&#x2F;username&gt;  </span><br><span class="line">        &lt;password&gt;admin&lt;&#x2F;password&gt;  </span><br><span class="line">        &lt;ignorePackaging&gt;true&lt;&#x2F;ignorePackaging&gt;    </span><br><span class="line">    &lt;&#x2F;configuration&gt;  </span><br><span class="line">&lt;&#x2F;plugin&gt;</span><br><span class="line">&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">**tomcat-users.xml（修改后重启Tomcat）**</span><br></pre></td></tr></table></figure><tomcat-users>            <role rolename="admin-gui">      <role rolename="admin-script">      <role rolename="manager-gui">      <role rolename="manager-script">      <role rolename="manager-jmx">      <role rolename="manager-status">      <user username="admin" password="admin" roles="manager-gui,manager-script,manager-jmx,manager-status,admin-script,admin-gui">  </user></role></role></role></role></role></role></tomcat-users><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**部署的名字与pom.xml开头的配置是一致的**</span><br></pre></td></tr></table></figure>  <modelversion>4.0.0</modelversion>  <groupid>WeeeebSkt</groupid>  <artifactid>WeeeebSkt</artifactid>  <version>0.0.1-SNAPSHOT</version>  <packaging>war</packaging><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**注意下面的路径+项目名**</span><br></pre></td></tr></table></figure>[INFO] Deploying war to http://localhost:8080/WeeeebSkt  [INFO] OK - Deployed application at context path /WeeeebSkt[INFO] ------------------------------------------------------------------------[INFO] BUILD SUCCESS[INFO] ------------------------------------------------------------------------[INFO] Total time: 2.045 s[INFO] Finished at: 2017-11-13T13:29:02+08:00[INFO] Final Memory: 15M/308M[INFO] ------------------------------------------------------------------------<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**果然报错**</span><br></pre></td></tr></table></figure>    (index):20 WebSocket connection to 'ws://localhost:8080/websocket' failed: Error during WebSocket handshake: Unexpected response code: 404<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"> </span><br><span class="line"> **定位前台的出错位置：**</span><br><span class="line"> </span><br><span class="line"> ![image_1bupu08q5hn82aepo61qp31dr09.png-36.3kB][1]</span><br><span class="line"> </span><br><span class="line"> **确认后台的EndPoint：**</span><br><span class="line"> </span><br><span class="line"> ![image_1bupu1ltd8muej0nmn1o6u1cv8m.png-12.5kB][2]</span><br><span class="line"> </span><br><span class="line"> **完全对应，怎么会出错？？？**</span><br><span class="line"> </span><br><span class="line"> **当前环境：**</span><br><span class="line"> </span><br><span class="line"> ![image_1bupu4rg71ee81cps6rod41qs39.png-62.4kB][3]</span><br><span class="line"> </span><br><span class="line"> **项目环境，依赖：**</span><br><span class="line"> </span><br><span class="line"> ![image_1bupu6m1h1ou567jq8k19blcpdm.png-25.3kB][4]</span><br><span class="line"> </span><br><span class="line"> **查找错误：**</span><br><span class="line"> </span><br><span class="line"> 更换 Tomcat8.5 + JavaSE-1.8 结果完全一样的错误</span><br><span class="line"> </span><br><span class="line">&gt; j2ee 项目里面是不是设置了拦截器之类的东西，在web.xml中配置的。可能ws协议的请求被拦截器拦截下来了。这方面的问题网络上有很多。</span><br><span class="line">我犯过的一个弱智的错误：在 ws 请求路径中没有写 j2ee 的项目名称。比如我的工程项目叫BoardGame，</span><br><span class="line">var webSocket &#x3D; new WebSocket(&#39;ws:&#x2F;&#x2F;localhost:8080&#x2F;BoardGame&#x2F;websocket&#39;); </span><br><span class="line">&#x2F;&#x2F;没有 BoardGame 所有一定是找不到的。</span><br><span class="line"> </span><br><span class="line">**修改Tomcat7版本的代码：**</span><br><span class="line"></span><br><span class="line">前台代码修改：</span><br></pre></td></tr></table></figure>if ('WebSocket' in window) {    //websocket = new WebSocket("ws://localhost:8080/websocket");    websocket = new WebSocket("ws://localhost:8080/websocket");}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**错误还是依旧：**</span><br></pre></td></tr></table></figure>WebSocket connection to 'ws://localhost:8080/WeeeebSkt/websocket' failed: Error during WebSocket handshake: Unexpected response code: 404<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**修改Tomcat8版本的代码：**</span><br><span class="line"></span><br><span class="line">前台代码修改：</span><br></pre></td></tr></table></figure>if ('WebSocket' in window) {    //websocket = new WebSocket("ws://localhost:8080/websocket");    websocket = new WebSocket("ws://localhost:8080/websocket");}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**已经连接成功：**</span><br></pre></td></tr></table></figure>[CodeLive] HTTP detected: Connecting using WSVM37:109 [CodeLive] Connected to CodeLive at ws://127.0.0.1:8123<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">通过比较Tomcat7的Webapps中部署的文件来看，和Tomcat8.5中的完全一样，但是，结果是失败的。</span><br><span class="line">之后又尝试了很多修改都是报错。</span><br><span class="line"></span><br><span class="line">#### 结论</span><br><span class="line"></span><br><span class="line">如果你使用Tomcat7.05以上的版本+J2SE-1.7来尝试websocket时出现404，别找错误了，坑太多，直接更换环境吧，使用Tomcat8以上+J2SE-1.8是完全可行的，已亲测。</span><br><span class="line"> </span><br><span class="line">#### 运行效果</span><br><span class="line"></span><br><span class="line">![image_1bupvpea51j8va86v82154jase9.png-142.1kB][5]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:&#x2F;&#x2F;www.cxmoe.com](https:&#x2F;&#x2F;www.cxmoe.com) **&gt;&gt;**</span><br><span class="line"> </span><br><span class="line">#### 下面是相关代码</span><br><span class="line"></span><br><span class="line">前台index.jsp中核心的javascript调用：</span><br></pre></td></tr></table></figure><script type="text/javascript">    var websocket = null;    //判断当前浏览器是否支持WebSocket    if ('WebSocket' in window) {        websocket = new WebSocket("ws://localhost:8080/websocket");    }    else {        alert('当前浏览器 Not support websocket')    }<pre><code>//连接发生错误的回调方法websocket.onerror = function () {    setMessageInnerHTML(&quot;WebSocket连接发生错误&quot;);};//连接成功建立的回调方法websocket.onopen = function () {    setMessageInnerHTML(&quot;WebSocket连接成功&quot;);}//接收到消息的回调方法websocket.onmessage = function (event) {    setMessageInnerHTML(event.data);}//连接关闭的回调方法websocket.onclose = function () {    setMessageInnerHTML(&quot;WebSocket连接关闭&quot;);}//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。window.onbeforeunload = function () {    closeWebSocket();}//将消息显示在网页上function setMessageInnerHTML(innerHTML) {    document.getElementById(&apos;message&apos;).innerHTML += innerHTML + &apos;&lt;br/&gt;&apos;;}//关闭WebSocket连接function closeWebSocket() {    websocket.close();}//发送消息function send() {    var message = document.getElementById(&apos;text&apos;).value;    websocket.send(message);}</code></pre><p></script><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 后台WebSocket的实现</span><br></pre></td></tr></table></figure><p>import java.io.IOException;<br>import java.util.concurrent.CopyOnWriteArraySet;<br>import javax.websocket.*;<br>import javax.websocket.server.ServerEndpoint;</p><p>/**</p><ul><li><p>@ServerEndpoint 注解是一个类层次的注解，它的功能主要是将目前的类定义成一个websocket服务器端,</p></li><li><p>注解的值将被用于监听用户连接的终端访问URL地址,客户端可以通过这个URL来连接到WebSocket服务器端</p></li><li><p>/<br>@ServerEndpoint(“/websocket”)<br>public class Ws {<br>  //静态变量，用来记录当前在线连接数。应该把它设计成线程安全的。<br>  private static int onlineCount = 0;</p><p>  //concurrent包的线程安全Set，用来存放每个客户端对应的MyWebSocket对象。若要实现服务端与单一客户端通信的话，可以使用Map来存放，其中Key可以为用户标识<br>  private static CopyOnWriteArraySet<ws> webSocketSet = new CopyOnWriteArraySet<ws>();</ws></ws></p><p>  //与某个客户端的连接会话，需要通过它来给客户端发送数据<br>  private Session session;</p><p>  /**</p><ul><li><p>连接建立成功调用的方法</p></li><li><p>@param session  可选的参数。session为与某个客户端的连接会话，需要通过它来给客户端发送数据</p></li><li><p>/<br>@OnOpen<br>public void onOpen(Session session){<br>  this.session = session;<br>  webSocketSet.add(this);     //加入set中<br>  addOnlineCount();           //在线数加1<br>  System.out.println(“有新连接加入！当前在线人数为” + getOnlineCount());<br>}</p><p>/**</p></li><li><p>连接关闭调用的方法</p></li><li><p>/<br>@OnClose<br>public void onClose(){<br>  webSocketSet.remove(this);  //从set中删除<br>  subOnlineCount();           //在线数减1<br>  System.out.println(“有一连接关闭！当前在线人数为” + getOnlineCount());<br>}</p><p>/**</p></li><li><p>收到客户端消息后调用的方法</p></li><li><p>@param message 客户端发送过来的消息</p></li><li><p>@param session 可选的参数</p></li><li><p>/<br>@OnMessage<br>public void onMessage(String message, Session session) {<br>  System.out.println(“来自客户端的消息:” + message);<br>  //群发消息<br>  for(Ws item: webSocketSet){</p><pre><code>try {    item.sendMessage(message);} catch (IOException e) {    e.printStackTrace();    continue;}</code></pre><p>  }<br>}</p><p>/**</p></li><li><p>发生错误时调用</p></li><li><p>@param session</p></li><li><p>@param error</p></li><li><p>/<br>@OnError<br>public void onError(Session session, Throwable error){<br>  System.out.println(“发生错误”);<br>  error.printStackTrace();<br>}<br>}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Maven配置：</span><br></pre></td></tr></table></figure><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><modelversion>4.0.0</modelversion><groupid>JavaWebSocket</groupid><artifactid>JavaWebSocket</artifactid><version>0.0.1-SNAPSHOT</version><packaging>war</packaging><properties><webversion>3.1</webversion></properties><dependencies><dependency><groupid>javax.websocket</groupid><artifactid>javax.websocket-api</artifactid><version>1.0</version></dependency></dependencies><build><sourcedirectory>src</sourcedirectory><plugins><plugin>  <artifactid>maven-compiler-plugin</artifactid>  <version>3.3</version>  <configuration>    <source>1.8    <target>1.8</target>  </configuration></plugin>        <plugin>            <groupid>org.codehaus.mojo</groupid>            <artifactid>tomcat-maven-plugin</artifactid>            <version>1.1</version>            <configuration>                <url>http://localhost:9080/manager/text</url>                <server>tomcat8</server>                <username>admin</username>                <password>admin</password>                <ignorepackaging>true</ignorepackaging>              </configuration>        </plugin> <plugin>  <artifactid>maven-war-plugin</artifactid>  <version>2.6</version>  <configuration>    <warsourcedirectory>WebRoot</warsourcedirectory>    <failonmissingwebxml>false</failonmissingwebxml>  </configuration></plugin></plugins></build></project>```</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> WebSocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用WebSocket给传统Web系统赋能</title>
      <link href="/article/236a.html"/>
      <url>/article/236a.html</url>
      
        <content type="html"><![CDATA[<h4 id="现有的机制"><a href="#现有的机制" class="headerlink" title="现有的机制"></a>现有的机制</h4><p>传统的Web系统的全部交互都采用HTTP请求的方式，另外在可视化领域的一些Web展示系统，也多是以HTTP请求的方式来返回需要展示的结果，虽然使用AJAX等技术可以使展示结果具有很高的交互性，但是本质上仍然是针对某一次返回结果的再加工。</p><a id="more"></a><h4 id="难以完成的任务"><a href="#难以完成的任务" class="headerlink" title="难以完成的任务"></a>难以完成的任务</h4><p>对于这样的场景：需要将某个迭代算法中每次迭代的数据进行可视化，传统认知上这样的需求一般在Java语言领域使用JavaSwing进行开发，保证展示效果的同时也保证了整个数据传输的效率（几乎没有传输损耗，数据都在内存中），如果非要以Web方式承载，那么一般方式是使用Ajax长轮询，这种方式核心仍然是一个个的HTTP请求，并不能将算法中迭代的某一中间结果返回到Web端。</p><h4 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h4><p>WebSocket技术伴随着HTML5出现后给这种场景提供了一种可行的解决方案，其可以允许前后台创建一种类似Socket的长连接机制，而且可以维持多个连接，这种非常类似Socket的特点也使得其取名为WebSocket，可以允许前后台建立一个稳定的连接，在后台代码中这个连接以Session的方式维护，后台可以无限制的、随时的、随处的向前台传输数据（只需引用这个Session）。总的来说，这种方式赋予了传统Web系统（BS系统）具有CS系统的敏捷性和便捷性（数据传输不限于请求）。</p><h4 id="其他解决方案"><a href="#其他解决方案" class="headerlink" title="其他解决方案"></a>其他解决方案</h4><p>本质上，一切以连接为基础的数据交互都能完成展示中间计算步骤的目的，例如Redis和一些MQ队列等等，但是能在前端支持js客户端的并不多见，阿里现在支持redis的js client，也有类似GoEasy这种黑盒方式的 前后台通讯方式，不过这些方式严重依赖第三方管理（例如上述两者都需要其自家的秘钥等等），在使用过程中并不透明，WebSocket在这方面具有优良的特性，而且也可以轻易的进行诸如队列的扩展。</p><h4 id="如何实现"><a href="#如何实现" class="headerlink" title="如何实现"></a>如何实现</h4><p>在《WebSocket的使用》中已经对其开发方式做了说明，这里只对部分关键内容进行描述，其实区别于示例代码（多人实时聊天），对于一个需要中间过程数据的系统，例如布局算法中迭代结果的过程展现，其区别是很明显的：</p><ul><li><p>不需要多人连接，也就不需要在Server对消息进行群发<br>对于前者，只需在原有在线人数上加判断即可(前文代码中有)<br>对于后者，之前代码中的群发部分就可以删除了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 收到客户端消息后调用的方法</span></span><br><span class="line"><span class="comment"> * @param message 客户端发送过来的消息</span></span><br><span class="line"><span class="comment"> * @param session </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"来自客户端的消息:"</span> + message);</span><br><span class="line"><span class="comment">//群发消息,可以删掉</span></span><br><span class="line"><span class="keyword">for</span>(WebSocketTest item: webSocketSet)&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">item.sendMessage(message);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>需要在算法迭代过程中对当前会话进行引用，即迭代时需要Session在场：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的核心迭代控制代码中引入Session</span></span><br><span class="line"><span class="comment">//然后在每次迭代过程中，将当前步的数据通过session.getBasicRemote().sendText方法发送给前端</span></span><br><span class="line"><span class="comment">//当然，也可以将Session传入更深层的算法步中，使前台获取更深层算法步骤的中间值</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doLayout</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">this</span>.initAlgo();</span><br><span class="line"><span class="keyword">if</span> (layoutByTimes) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; times; ++i) &#123;</span><br><span class="line"><span class="keyword">this</span>.goAlgo();</span><br><span class="line"><span class="keyword">this</span>.temperature=cool(<span class="keyword">this</span>.temperature);</span><br><span class="line">session.getBasicRemote().sendText(Output.outputJson(graph));</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">//如果没有迭代参数，则会按一次迭代来执行</span></span><br><span class="line"><span class="keyword">this</span>.goAlgo();</span><br><span class="line"><span class="keyword">int</span> times = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">double</span> force = Math.sqrt(<span class="keyword">this</span>.resultantForceX</span><br><span class="line">* <span class="keyword">this</span>.resultantForceX + <span class="keyword">this</span>.resultantForceY</span><br><span class="line">+ <span class="keyword">this</span>.resultantForceY);</span><br><span class="line">System.out.println(force);</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">this</span>.forceThreshold &lt; force) &#123;</span><br><span class="line"><span class="keyword">this</span>.goAlgo();</span><br><span class="line">times++;</span><br><span class="line">System.out.println(force);</span><br><span class="line">force = Math.sqrt(<span class="keyword">this</span>.resultantForceX</span><br><span class="line">* <span class="keyword">this</span>.resultantForceX + <span class="keyword">this</span>.resultantForceY</span><br><span class="line">+ <span class="keyword">this</span>.resultantForceY);</span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">session.getBasicRemote().sendText(Output.outputJson(graph)); </span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"times="</span> + times);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">System.out.println(<span class="string">"暂时没实现这种类型的布局"</span>);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><ul><li>修改原先的OnMessa方法，将此方法改造为类似Servlet的方法，该方法现在是作为后台接收前端数据的桥头堡，应该在这里对前端的数据进行过滤，并在此方法内发起相应的后台操作。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"来自客户端的消息:"</span> + message);</span><br><span class="line"><span class="comment">//群发消息</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">dojob(message); <span class="comment">//这里做了简单包装，将全部逻辑放到dojob中去做</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="实现结果"><a href="#实现结果" class="headerlink" title="实现结果"></a>实现结果</h4><p>可以将整个布局算法在迭代过程中的每个步骤的布局结构都在前端进行展示，下面的效果只进行了一次请求，每次绘制的数据都是通过WebSocket传输到前端的，效果如下：<br>（由于算法写的还有点问题所以节点运动轨迹有点问题，不过不影响效果展示）<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/GIF.gif" alt="GIF.gif-7105.2kB"></p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebSocket </tag>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DBLP数据集使用Python解析</title>
      <link href="/article/572b.html"/>
      <url>/article/572b.html</url>
      
        <content type="html"><![CDATA[<h4 id="dblp的使用"><a href="#dblp的使用" class="headerlink" title="dblp的使用"></a>dblp的使用</h4><blockquote><p>总的来说，DBLP集成元素不多，只有最基本的论文题目，时间，作者，发表类型及期刊或会议名称等等。可能很多人想要的标签、关键词都没有。但是，基于DBLP数据集这些基本的元素，可以挖掘、利用的也是很多。例如官网给出的统计信息，就能引申出很多东西。</p></blockquote><a id="more"></a><p>涉及到DBLP，我能一下想到的关键词：经典的复杂网络，小世界，无标度，合作关系网，关系推荐，聚类，连接预测，随机游走，中心作者分析，作者影响力分析，研究热点发展等等，非常多。因此，DBLP是个很丰富宝贵的资源。<br>引述自：<br><a href="http://blog.csdn.net/frontend922/article/details/18552077" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/frontend922/article/details/18552077</a></p><h4 id="dblp下载"><a href="#dblp下载" class="headerlink" title="dblp下载"></a>dblp下载</h4><pre><code>dblp.dtd        2017-08-29 16:23    13K     dblp.xml.gz        2017-11-10 20:26    393MXML下载链接     http://dblp.uni-trier.de/xml/</code></pre><h4 id="dblp原始数据集示例"><a href="#dblp原始数据集示例" class="headerlink" title="dblp原始数据集示例"></a>dblp原始数据集示例</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">dblp</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"dblp.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dblp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span> <span class="attr">mdate</span>=<span class="string">"2017-05-28"</span> <span class="attr">key</span>=<span class="string">"journals/acta/Saxena96"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Sanjeev Saxena<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Parallel IntegerSimulation Amongst CRCW Models.<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pages</span>&gt;</span>607-619<span class="tag">&lt;/<span class="name">pages</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span>&gt;</span>1996<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">volume</span>&gt;</span>33<span class="tag">&lt;/<span class="name">volume</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">journal</span>&gt;</span>Acta Inf.<span class="tag">&lt;/<span class="name">journal</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">number</span>&gt;</span>7<span class="tag">&lt;/<span class="name">number</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>db/journals/acta/acta33.html#Saxena96<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ee</span>&gt;</span>https://doi.org/10.1007/BF03036466<span class="tag">&lt;/<span class="name">ee</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span> <span class="attr">mdate</span>=<span class="string">"2017-05-28"</span> <span class="attr">key</span>=<span class="string">"journals/acta/Simon83"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">author</span>&gt;</span>Hans Ulrich Simon<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pattern Matching in Trees and Nets.<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pages</span>&gt;</span>227-248<span class="tag">&lt;/<span class="name">pages</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span>&gt;</span>1983<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">volume</span>&gt;</span>20<span class="tag">&lt;/<span class="name">volume</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">journal</span>&gt;</span>Acta Inf.<span class="tag">&lt;/<span class="name">journal</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>db/journals/acta/acta20.html#Simon83<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ee</span>&gt;</span>https://doi.org/10.1007/BF01257084<span class="tag">&lt;/<span class="name">ee</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dblp</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="dblp数据集建表语句"><a href="#dblp数据集建表语句" class="headerlink" title="dblp数据集建表语句"></a>dblp数据集建表语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Navicat MySQL Data Transfer</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Source Server         : localmysql</span></span><br><span class="line"><span class="comment">Source Server Version : 50540</span></span><br><span class="line"><span class="comment">Source Host           : localhost:3306</span></span><br><span class="line"><span class="comment">Source Database       : visual_dataset</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Target Server Type    : MYSQL</span></span><br><span class="line"><span class="comment">Target Server Version : 50540</span></span><br><span class="line"><span class="comment">File Encoding         : 65001</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Date: 2017-11-11 17:44:38</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for dblp</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`dblp`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dblp`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`article_mdate`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`article_key`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`author`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`pages`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`year`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`volume`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`journal`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`number`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ee`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`x2`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=gbk;</span><br></pre></td></tr></table></figure><h4 id="将dblp-xml解析到文件中的代码"><a href="#将dblp-xml解析到文件中的代码" class="headerlink" title="将dblp.xml解析到文件中的代码"></a>将dblp.xml解析到文件中的代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">原代码只将数据解析到文本，且对重复字段没有进行处理</span></span><br><span class="line"><span class="string">&lt;article&gt;</span></span><br><span class="line"><span class="string">    &lt;author&gt;Mr.A&lt;/author&gt;</span></span><br><span class="line"><span class="string">    &lt;author&gt;Mr.B&lt;/author&gt;</span></span><br><span class="line"><span class="string">&lt;/article&gt;</span></span><br><span class="line"><span class="string">此代码修正了上述不足，然后将解析后字段导入数据库</span></span><br><span class="line"><span class="string">读取数据：dblp.xml 2.01G</span></span><br><span class="line"><span class="string">导入Mysql：170万+</span></span><br><span class="line"><span class="string">导入表：visual_dataset.dblp</span></span><br><span class="line"><span class="string">生成备份文件：insert.sql</span></span><br><span class="line"><span class="string">@author: Administrator</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> xml.sax</span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> traceback </span><br><span class="line"><span class="keyword">import</span> pymysql.cursors</span><br><span class="line">sys.stdout = io.TextIOWrapper(sys.stdout.buffer,encoding=<span class="string">'utf8'</span>) <span class="comment">#改变标准输出的默认编码  </span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                format=<span class="string">'%(message)s'</span>,</span><br><span class="line">                datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>,</span><br><span class="line">                filename=<span class="string">'I:\\ABC000000000000\\Dblp\\simple\\app.log'</span>,</span><br><span class="line">                filemode=<span class="string">'w'</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieHandler</span><span class="params">( xml.sax.ContentHandler )</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    res  类变量，记录解析后的字段值</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    athr = []</span><br><span class="line">    ee = []</span><br><span class="line">    res=<span class="string">''</span></span><br><span class="line">    sqlval=<span class="string">''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.CurrentData = <span class="string">""</span></span><br><span class="line">        self.author = <span class="string">""</span></span><br><span class="line">        self.title = <span class="string">""</span></span><br><span class="line">        self.pages = <span class="string">""</span></span><br><span class="line">        self.year = <span class="string">""</span></span><br><span class="line">        self.volume = <span class="string">""</span></span><br><span class="line">        self.journal = <span class="string">""</span></span><br><span class="line">        self.number = <span class="string">""</span></span><br><span class="line">        self.url = <span class="string">""</span></span><br><span class="line">        self.ee = <span class="string">""</span></span><br><span class="line">    <span class="comment"># 元素开始事件处理,对每个顶级标签内数据的解析都会重复的调用此方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">startElement</span><span class="params">(self, tag, attributes)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.CurrentData = tag</span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">"article"</span>:  </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> len(self.__class__.sqlval) :</span><br><span class="line">                <span class="comment">#print(re.sub(",$","",self.__class__.sqlval))</span></span><br><span class="line">                    </span><br><span class="line">                    lt = re.sub(<span class="string">",$"</span>,<span class="string">""</span>,self.__class__.sqlval).split(<span class="string">","</span>)</span><br><span class="line">                    lt2= sorted(set(lt),key=lt.index)</span><br><span class="line"></span><br><span class="line">                    </span><br><span class="line">                    insert_mysql(</span><br><span class="line">                        <span class="string">','</span>.join(lt2),self.__class__.res,</span><br><span class="line">                        <span class="string">','</span>.join(self.__class__.athr),</span><br><span class="line">                        <span class="string">','</span>.join(self.__class__.ee)</span><br><span class="line">                    )</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                traceback.print_exc()</span><br><span class="line">            <span class="comment">#清空res变量，由于跨方法拼字符串，所以使用了类变量</span></span><br><span class="line">            self.__class__.res=<span class="string">''</span></span><br><span class="line">            self.__class__.sqlval=<span class="string">''</span></span><br><span class="line">            self.__class__.athr=[]</span><br><span class="line">            self.__class__.ee=[]</span><br><span class="line">            <span class="comment">#因为处在if判断后，所以只解析第一个标签内的属性值</span></span><br><span class="line">            mdate = attributes[<span class="string">"mdate"</span>]</span><br><span class="line">            key = attributes[<span class="string">"key"</span>]</span><br><span class="line">            <span class="comment">#拼接字符串</span></span><br><span class="line">            self.__class__.res += mdate + SYMBOL + key + SYMBOL</span><br><span class="line">            self.__class__.sqlval += <span class="string">"article_mdate,article_key,"</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 经过开始事件-&gt;内容事件的方法之后，调用此结束事件处理，</span></span><br><span class="line">   <span class="comment"># 对先前内容事件方法中对实例变量的值进行统一过滤处理</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">endElement</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.CurrentData == <span class="string">"author"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"author,"</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'$_author_$'</span> <span class="keyword">not</span> <span class="keyword">in</span> self.__class__.res:</span><br><span class="line">                self.__class__.res += <span class="string">"$_author_$"</span> + SYMBOL</span><br><span class="line">            self.__class__.athr.append(self.author)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"title"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"title,"</span></span><br><span class="line">            self.__class__.res += self.title + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"pages"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"pages,"</span></span><br><span class="line">            self.__class__.res += self.pages + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"year"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"year,"</span></span><br><span class="line">            self.__class__.res += self.year + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"volume"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"volume,"</span></span><br><span class="line">            self.__class__.res += self.volume + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"journal"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"journal,"</span></span><br><span class="line">            self.__class__.res += self.journal + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"number"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"number,"</span></span><br><span class="line">            self.__class__.res += self.number + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"url"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"url,"</span></span><br><span class="line">            self.__class__.res += self.url + SYMBOL</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"ee"</span>:</span><br><span class="line">            self.__class__.sqlval += <span class="string">"ee,"</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'$_ee_$'</span> <span class="keyword">not</span> <span class="keyword">in</span> self.__class__.res:</span><br><span class="line">                self.__class__.res += <span class="string">"$_ee_$"</span> + SYMBOL</span><br><span class="line">            self.__class__.ee.append(self.ee)</span><br><span class="line">     </span><br><span class="line">        self.CurrentData = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 内容事件处理，对每个子元素都执行此方法，并且重置实例变量的值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">characters</span><span class="params">(self, content)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.CurrentData == <span class="string">"author"</span>:</span><br><span class="line">            self.author = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"title"</span>:</span><br><span class="line">            self.title = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"pages"</span>:</span><br><span class="line">            self.pages = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"year"</span>:</span><br><span class="line">            self.year = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"volume"</span>:</span><br><span class="line">            self.volume = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"journal"</span>:</span><br><span class="line">            self.journal = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"number"</span>:</span><br><span class="line">            self.number = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"url"</span>:</span><br><span class="line">            self.url = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.CurrentData == <span class="string">"ee"</span>:</span><br><span class="line">            self.ee = content.replace(<span class="string">"'"</span>,<span class="string">"`"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#class结束</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">独立方法：将解析出的字段导入Mysql</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_mysql</span><span class="params">(names,values,authors,ees)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    <span class="keyword">if</span> count==<span class="number">100</span>:</span><br><span class="line">        sys.exit</span><br><span class="line">    val = re.sub(<span class="string">",'$"</span>,<span class="string">""</span>,values)</span><br><span class="line">    val = re.sub(<span class="string">"#"</span>,<span class="string">"&amp;"</span>,val)</span><br><span class="line">    val = val.replace(<span class="string">"$_ee_$"</span>,re.sub(<span class="string">","</span>,<span class="string">","</span>,ees))</span><br><span class="line">    val = val.replace(<span class="string">"$_author_$"</span>,re.sub(<span class="string">","</span>,<span class="string">","</span>,authors))</span><br><span class="line">    sql = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> len(names) &amp; len(names):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#存入Mysql via：github.com/PyMySQL/PyMySQL</span></span><br><span class="line">            <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">                </span><br><span class="line">                sql = <span class="string">"INSERT INTO `dblp` ("</span></span><br><span class="line">                sql +=names</span><br><span class="line">                sql +=<span class="string">" )VALUES ('"</span></span><br><span class="line">                sql +=val </span><br><span class="line">                sql +=<span class="string">" )"</span></span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                print(<span class="string">'parse items and inserted :'</span>+str(count))</span><br><span class="line">                <span class="keyword">if</span> sql <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> sql != <span class="string">'None'</span>:</span><br><span class="line">                    logging.info(sql+<span class="string">';'</span>)</span><br><span class="line">                    cursor.execute(sql)</span><br><span class="line">            <span class="comment">#创建的connection是非自动提交，需要手动commit </span></span><br><span class="line">            connection.commit()</span><br><span class="line">            a = <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">                    </span><br><span class="line">            logging.error(traceback.print_exc())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里直接运行，则本身__name__就是__main__ </span></span><br><span class="line"><span class="keyword">if</span> ( __name__ == <span class="string">"__main__"</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#定义全局分隔符</span></span><br><span class="line">    SYMBOL = <span class="string">"','"</span></span><br><span class="line"></span><br><span class="line">    XMLFPATH = <span class="string">"I:\\ABC000000000000\\Dblp\\dblp.xml"</span></span><br><span class="line">    parser = xml.sax.make_parser()</span><br><span class="line">    parser.setFeature(xml.sax.handler.feature_namespaces, <span class="number">0</span>)</span><br><span class="line">    Handler = MovieHandler()</span><br><span class="line">    parser.setContentHandler( Handler )</span><br><span class="line"></span><br><span class="line">    connection = pymysql.connect(</span><br><span class="line">        host=<span class="string">'localhost'</span>,</span><br><span class="line">        user=<span class="string">'root'</span>,</span><br><span class="line">        password=<span class="string">'123'</span>,</span><br><span class="line">        db=<span class="string">'visual_dataset'</span>,</span><br><span class="line">        charset=<span class="string">'utf8mb4'</span>,</span><br><span class="line">        cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line">    parser.parse(XMLFPATH)</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="原代码来源于网络"><a href="#原代码来源于网络" class="headerlink" title="原代码来源于网络"></a>原代码来源于网络</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">解析dblp.xml，将结果存入dblp_result.txt内</span></span><br><span class="line"><span class="string">@author: Administrator</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> xml.sax</span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> traceback </span><br><span class="line">sys.stdout = io.TextIOWrapper(sys.stdout.buffer,encoding=<span class="string">'utf8'</span>) </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieHandler</span><span class="params">( xml.sax.ContentHandler )</span>:</span></span><br><span class="line">   <span class="string">'''</span></span><br><span class="line"><span class="string">   res  类变量，记录解析后的字段值</span></span><br><span class="line"><span class="string">   '''</span></span><br><span class="line">   res=<span class="string">''</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">      self.CurrentData = <span class="string">""</span></span><br><span class="line">      self.author = <span class="string">""</span></span><br><span class="line">      self.title = <span class="string">""</span></span><br><span class="line">      self.pages = <span class="string">""</span></span><br><span class="line">      self.year = <span class="string">""</span></span><br><span class="line">      self.volume = <span class="string">""</span></span><br><span class="line">      self.journal = <span class="string">""</span></span><br><span class="line">      self.number = <span class="string">""</span></span><br><span class="line">      self.url = <span class="string">""</span></span><br><span class="line">      self.ee = <span class="string">""</span></span><br><span class="line">   <span class="comment"># 元素开始事件处理</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">startElement</span><span class="params">(self, tag, attributes)</span>:</span></span><br><span class="line">      self.CurrentData = tag</span><br><span class="line">      <span class="keyword">if</span> tag == <span class="string">"article"</span>:</span><br><span class="line">         print(<span class="string">"self.__class__.res="</span>,self.__class__.res)</span><br><span class="line">         <span class="keyword">try</span>:</span><br><span class="line">           ww.write(self.__class__.res + <span class="string">'\n'</span>)</span><br><span class="line">         <span class="keyword">except</span>:</span><br><span class="line">             traceback.print_exc()</span><br><span class="line">        <span class="comment">#清空res变量，由于跨方法拼字符串，所以使用了类变量</span></span><br><span class="line">         self.__class__.res=<span class="string">''</span></span><br><span class="line">        <span class="comment">#因为处在if判断后，所以只解析第一个标签内的属性值</span></span><br><span class="line">         mdate = attributes[<span class="string">"mdate"</span>]</span><br><span class="line">         key = attributes[<span class="string">"key"</span>]</span><br><span class="line">        <span class="comment">#拼接字符串</span></span><br><span class="line">         self.__class__.res=self.__class__.res + mdate + <span class="string">';,;'</span> + key + <span class="string">';,;'</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 元素结束事件处理</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">endElement</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> self.CurrentData == <span class="string">"author"</span>:</span><br><span class="line">         <span class="comment">#print ("author:", self.author)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.author + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"title"</span>:</span><br><span class="line">         <span class="comment">#print ("title:", self.title)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.title + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"pages"</span>:</span><br><span class="line">         <span class="comment">#print ("pages:", self.pages)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.pages + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"year"</span>:</span><br><span class="line">         <span class="comment">#print ("year:", self.year)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.year + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"volume"</span>:</span><br><span class="line">         <span class="comment">#print ("volume:", self.volume)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.volume + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"journal"</span>:</span><br><span class="line">         <span class="comment">#print ("journal:", self.journal)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.journal + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"number"</span>:</span><br><span class="line">         <span class="comment">#print ("number:", self.number)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.number + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"url"</span>:</span><br><span class="line">         <span class="comment">#print ("url:", self.url)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.url + <span class="string">';,;'</span></span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"ee"</span>:</span><br><span class="line">         <span class="comment">#print ("ee:", self.ee)</span></span><br><span class="line">         self.__class__.res=self.__class__.res + self.ee + <span class="string">';,;'</span></span><br><span class="line">      self.CurrentData = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 内容事件处理</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">characters</span><span class="params">(self, content)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> self.CurrentData == <span class="string">"author"</span>:</span><br><span class="line">         self.author = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"title"</span>:</span><br><span class="line">         self.title = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"pages"</span>:</span><br><span class="line">         self.pages = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"year"</span>:</span><br><span class="line">         self.year = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"volume"</span>:</span><br><span class="line">         self.volume = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"journal"</span>:</span><br><span class="line">         self.journal = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"number"</span>:</span><br><span class="line">         self.number = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"url"</span>:</span><br><span class="line">         self.url = content</span><br><span class="line">      <span class="keyword">elif</span> self.CurrentData == <span class="string">"ee"</span>:</span><br><span class="line">         self.ee = content</span><br><span class="line">        </span><br><span class="line"><span class="comment">#class结束</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里直接运行，则本身__name__就是__main__ </span></span><br><span class="line"><span class="keyword">if</span> ( __name__ == <span class="string">"__main__"</span>):</span><br><span class="line"></span><br><span class="line">   parser = xml.sax.make_parser()</span><br><span class="line">   parser.setFeature(xml.sax.handler.feature_namespaces, <span class="number">0</span>)</span><br><span class="line">   Handler = MovieHandler()</span><br><span class="line">   parser.setContentHandler( Handler )</span><br><span class="line">   ww=open(<span class="string">'I:\\ABC000000000000\\Dblp\\simple\\dblp_result.txt'</span>,<span class="string">'w+'</span>)</span><br><span class="line">   parser.parse(<span class="string">"I:\\ABC000000000000\\Dblp\\simple\\dblp.xml"</span>)</span><br><span class="line">   ww.close()</span><br></pre></td></tr></table></figure><h4 id="对于dblp数据的使用"><a href="#对于dblp数据的使用" class="headerlink" title="对于dblp数据的使用"></a>对于dblp数据的使用</h4><p>(待续)</p>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 数据集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>替代Websocket的解决方案：GoEasy</title>
      <link href="/article/6e50.html"/>
      <url>/article/6e50.html</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>GoEasy这个库的适用场景：同Websocket的场景<br>在后台使用例如Java进行逻辑处理后将变量的值传入前台，前台不用发起请求即可接收后台发布的数据，<br>整个流程与Redis的Pub和Sub过程类似<br>整个交互类似Socket的长连接，前台首次调用不需要请求后台。<br>非常适合监控后台参数等场景；</p><a id="more"></a><blockquote><p>但是：<br>GoEasy最大的问题：传输数据大小有限制，大概只有几千字符！！<br>超出大小的传输部分会被丢弃从而会报错。</p></blockquote><h3 id="从GoEasy获取appkey"><a href="#从GoEasy获取appkey" class="headerlink" title="从GoEasy获取appkey"></a>从GoEasy获取appkey</h3><p>appkey是验证用户的有效性的唯一标识。</p><p>注册账号。 GoEasy官网：<a href="http://goeasy.io" target="_blank" rel="external nofollow noopener noreferrer">http://goeasy.io</a><br>用注册好的账号登录到GoEasy的后台管理系统，创建您自己应用（application）.<br>Application创建好之后系统会自动为您生成appkey<br>系统会生成两个keys，一个Super key和一个Subscribe key；它们的区别在于前者既可以订阅又可以推送，但后者只能用于订阅。</p><h3 id="GoEasy实现向特定用户群推送的原理"><a href="#GoEasy实现向特定用户群推送的原理" class="headerlink" title="GoEasy实现向特定用户群推送的原理"></a>GoEasy实现向特定用户群推送的原理</h3><p>知道了他们的推送原理，可以更加方便我们了解他们的服务，以及理解我们写的代码。其实原理很简单，只需要确定哪些用户需要接收信息，然后让这些用户都订阅一个相同的channel（频道）。 然后再往这个平台上推送消息即可！所有关键在于channel，channel一致，则可以接收到信息，否则收不到！</p><p>对于订阅必须要的信息有：Appkey, channel</p><p>对于推送必须要的信息有：Appkey, channel, content</p><h3 id="用GoEasy实现订阅（接收）的实例"><a href="#用GoEasy实现订阅（接收）的实例" class="headerlink" title="用GoEasy实现订阅（接收）的实例"></a>用GoEasy实现订阅（接收）的实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;https:&#x2F;&#x2F;cdn.goeasy.io&#x2F;goeasy.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">             var goEasy &#x3D; new GoEasy(&#123;appkey: &#39;your appkey&#39;&#125;);</span><br><span class="line">                                goEasy.subscribe(&#123;</span><br><span class="line">                         channel: &#39;your_channel&#39;,</span><br><span class="line">                         onMessage: function(message)&#123;</span><br><span class="line">                                alert(&#39;接收到消息:&#39;+message.content);</span><br><span class="line">                                &#x2F;&#x2F;拿到了信息之后，你可以做你任何想做的事</span><br><span class="line">                         &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>有了这几行代码后，只要保证网络畅通的情况下，页面会自动弹出你从任何平台上推送的信息。</p><h3 id="用GoEasy实现推送及接收的实例"><a href="#用GoEasy实现推送及接收的实例" class="headerlink" title="用GoEasy实现推送及接收的实例"></a>用GoEasy实现推送及接收的实例</h3><p>目前GoEasy支持三种推送方式： Java后台推送（它们有提供JAVA SDK和 maven远程仓库）， JS推送，RestAPI推送（有了RestAPI，我们就可以用PHP, .NET, Ruby…来推送信息了，很方便）</p><p>说了这么多，来我们看一下怎么用GoEasy的三种方式分别实现推送吧。</p><h4 id="用GoEasy-SDK推送"><a href="#用GoEasy-SDK推送" class="headerlink" title="用GoEasy SDK推送"></a>用GoEasy SDK推送</h4><h5 id="获取SDK"><a href="#获取SDK" class="headerlink" title="获取SDK"></a>获取SDK</h5><p>Java SDK的获取方式，方式一，直接在goeasy的官网上进行下载；方式二，用maven远程库直接导入到项目中。尽管官网上已经做了相同的说明了，我这里还是把关键点帖出来，方便大家查看。</p><p>GoEasy SDK下载链接：<a href="http://maven.goeasy.io/service/local/artifact/maven/redirect?r=releases&amp;g=io.goeasy&amp;a=goeasy-sdk&amp;v=0.3.3&amp;e=jar" target="_blank" rel="external nofollow noopener noreferrer">http://maven.goeasy.io/service/local/artifact/maven/redirect?r=releases&amp;g=io.goeasy&amp;a=goeasy-sdk&amp;v=0.3.3&amp;e=jar</a></p><p>GoEasy远程maven库的配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;repository&gt;</span><br><span class="line">    &lt;id&gt;goeasy&lt;&#x2F;id&gt;</span><br><span class="line">    &lt;name&gt;goeasy&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.goeasy.io&#x2F;content&#x2F;repositories&#x2F;releases&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;repository&gt;</span><br><span class="line"> …</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.goeasy&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;goeasy-sdk&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.3.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>需要注意的是：GoEasy需要依赖两个额外的jar 包：<br>gson.jar : <a href="http://repo.maven.apache.org/maven2/com/google/code/gson/gson/2.3.1/gson-2.3.1.jar" target="_blank" rel="external nofollow noopener noreferrer">http://repo.maven.apache.org/maven2/com/google/code/gson/gson/2.3.1/gson-2.3.1.jar</a><br>slf4j-api.jar : <a href="http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.2/slf4j-api-1.7.2.jar" target="_blank" rel="external nofollow noopener noreferrer">http://repo.maven.apache.org/maven2/org/slf4j/slf4j-api/1.7.2/slf4j-api-1.7.2.jar</a></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h5 id="实例化GoEasy对象"><a href="#实例化GoEasy对象" class="headerlink" title="实例化GoEasy对象"></a>实例化GoEasy对象</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GoEasy goEasy &#x3D; new GoEasy(&quot;your appkey&quot;);</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line"></span><br><span class="line">##### 推送消息</span><br></pre></td></tr></table></figure><p>goEasy.publish(‘your_channel’, ‘First message’);</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### JS推送</span><br><span class="line"></span><br><span class="line">**Step1.引入goeasy.js**</span><br></pre></td></tr></table></figure><p>CDN：<a href="https://cdn.goeasy.io/goeasy.js" target="_blank" rel="external nofollow noopener noreferrer">https://cdn.goeasy.io/goeasy.js</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**Step2.实例化Goeasy对象，并用publish函数进行推送**</span><br></pre></td></tr></table></figure><p>var goEasy = new GoEasy({appkey: ‘your appkey’});<br>       goEasy. publish ({<br>            channel: ‘your_channel’,<br>            message: ‘Second message！’<br>});</p><pre><code>#### 用RestAPI进行推送URL: https://goeasy.io/goeasy/publishMethod: Post参数：appkey, channel, content例如：https://goeasy.io/goeasy/publish?appkey={your_appkey}&amp;channel={your_channel}&amp;content={your_message}GoEasy官网：http://goeasy.io快速入门：http://goeasy.io/www/started文档下载：http://goeasy.io/www/documents</code></pre>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebSocket </tag>
            
            <tag> 可视化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可视化布局算法的框架设计</title>
      <link href="/article/cb21.html"/>
      <url>/article/cb21.html</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>原项目是一个Web项目，采用传统的Servlet方式，后台主要完成的工作是计算节点的坐标，将节点的坐标封装成json格式由与前台进行交互。前期阶段，从前后台的数据传输方面尝试对代码进行理解，但是原始代码运行环境未知，现有的代码在运行时会有各种错误，未果，放弃。现在直接将后台的业务处理代码抽离进行抽离。目的是形成一个最简单的可执行的布局算法效果展示的SDK</p><a id="more"></a><h3 id="整体设计"><a href="#整体设计" class="headerlink" title="整体设计"></a>整体设计</h3><p>对于布局算法的目的，就是要对给定格式的图数据（如下图）进行节点坐标的计算，计算的规则通过布局算法来实现，整个流程应该包括以下几部分：  </p><ul><li>格式化数据的读入及数据结构的绑定</li><li>通过布局算法对数据的坐标计算</li><li>坐标结果的格式化及数据的输出</li></ul><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bungks3hbnq194213plujl2gqm.png" alt="image_1bungks3hbnq194213plujl2gqm.png-47.6kB"></p><p>上述过程中应该涉及的数据结构(类)设计</p><ul><li>图结构的设计（基础数据结构）：Graph、Node、Edges</li><li>绑定输入数据导上述的结构（配置类）：GraphData、BSPNodeFormatImpl</li><li>布局算法设计（布局类）：FRForceLayout</li><li>对算法的配置（配置类）：FRLayoutConfig</li><li>输入数据的配置：DataConfig</li><li>输出数据：Output</li></ul><h3 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h3><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bungh2ep9frdnghci9i71rt59.png" alt="image_1bungh2ep9frdnghci9i71rt59.png-35.6kB"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    gvbd.congfig    包含力导向算法的配置类(Getter和Setter)</span><br><span class="line">        LayoutConifg    所有Config类的父类,公共参数：迭代次数、是否指定迭代次数、布局长宽</span><br><span class="line">            ForceLayoutConifg</span><br><span class="line">                私有：K值、阈值、是否有向、速度</span><br><span class="line">            FRLayoutConifg</span><br><span class="line">                私有：K值、阈值、是否有向、冷却值、温度值</span><br><span class="line">    gvbd.graph      定义布局数据结构的包,包含图+边+节点等类的定义</span><br><span class="line">        </span><br><span class="line">    gvbd.data       包含图数据的格式化类、</span><br><span class="line">        </span><br><span class="line">    gvbd.layout     包含布局算法的调用类</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行流程</span></span><br><span class="line">    获得输入，之后</span><br><span class="line">    gvbd.data   对输入数据进行规整，调用：</span><br><span class="line">        gvbd.graph      实例化Graph类，Node类等</span><br><span class="line">    gvbd.layout 对节点数据进行布局，调用：</span><br><span class="line">        gvbd.congfig    对布局算法进行配置</span><br><span class="line">        gvbd.evaluate   节点价值的计算</span><br><span class="line">    布局结束之后获得全部节点的坐标数据，开始可视显示</span><br><span class="line">    使用d3/Gephi等等</span><br></pre></td></tr></table></figure><p>整个后台代码可大致分为四个部分：基础数据结构、配置类、绑定类、布局类</p><h3 id="基础数据结构"><a href="#基础数据结构" class="headerlink" title="基础数据结构"></a>基础数据结构</h3><p>这里要注意Graph类的成员变量只含一个Node类对象数组，对于Node类，要特别关注，其既包含节点本身的信息，也包含节点涉及的边的信息，对于边Edge类，其包含起始点和目标点(int类型)，以及权重，可以通过不同的构造函数对带权重和不带权重的两种情况进行实例化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    Node[] nodes;                           <span class="comment">//节点集</span></span><br><span class="line">     ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> nodeId;                     <span class="comment">//节点ID</span></span><br><span class="line"><span class="keyword">private</span> String nodeName;                <span class="comment">//节点名称</span></span><br><span class="line"><span class="keyword">private</span> String nodeLabel;               <span class="comment">//节点标签</span></span><br><span class="line"><span class="keyword">private</span> String nodeValue;               <span class="comment">//节点权重值</span></span><br><span class="line"><span class="keyword">private</span> NodeLayoutData nodeLayoutData;  <span class="comment">//节点的坐标[x,y]，记录两次，非常重要</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Edge&gt; edges;               <span class="comment">//涉及的所有边，绑定输入数据</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Edge&gt; edges2;              <span class="comment">//备用</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;Edge,Float&gt; edge3;          <span class="comment">//备用，涉及的边并且带边权重的情况</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Edge</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> resource;                   <span class="comment">//节点关联边的起点</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> target;                     <span class="comment">//节点关联边的终点</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> weight;                   <span class="comment">//节点关联边的权重</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="绑定类"><a href="#绑定类" class="headerlink" title="绑定类"></a>绑定类</h3><p>这部分是将输入的格式化数据初始化为相关数据结构，即使用输入的数据实例化相关对象，主要依靠的方法是graphData.loadNodeData方法。该方法主要是传入输入数据的文件流参数，在GraphData类中默认实例化一个Graph类对象，并通过上述load方法对Graph对象的节点和边进行初始化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实例化gvbd.data.GraphData</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadNodeData</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">BufferedReader nodeDataReader,NodeFormat nodeFormat,<span class="keyword">int</span> vertexNum)</span> </span>&#123;</span><br><span class="line">graph.createNodes(vertexNum);       <span class="comment">//按输入的节点数创建相关数量节点的图</span></span><br><span class="line">Node [] nodes=graph.getNodes();     <span class="comment">//nodes是构造的</span></span><br><span class="line">String nodeLine;</span><br><span class="line"><span class="keyword">int</span> lineNo=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">nodeLine = nodeDataReader.readLine();</span><br><span class="line"><span class="keyword">if</span>(lineNo == <span class="number">0</span>)System.out.println(nodeLine);</span><br><span class="line"><span class="keyword">while</span> (nodeLine != <span class="keyword">null</span>) &#123;</span><br><span class="line">Node node = nodeFormat.stringToNode(nodeLine); <span class="comment">//转换节点类型</span></span><br><span class="line">nodes[lineNo++]=node;</span><br><span class="line">nodeLine = nodeDataReader.readLine();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><p>这部分主要是调用布局算法前的先导部分，本质是对配置参数的封装，并且规定使用Getter和Setter方法进行参数赋值。另外，在赋值结束后只需在下一步布局算法调用时将该配置类的对象传入即可使布局算法得到相应的参数值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不同布局算法具有不同的参数，所以下面是有公共参数的父类，具体算法配置类应该继承此类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">LayoutConfig</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> times=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> layoutByTimes;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTimes</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> times;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTimes</span><span class="params">(<span class="keyword">int</span> times)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.times = times;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLayoutByTimes</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> layoutByTimes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLayoutByTimes</span><span class="params">(<span class="keyword">boolean</span> layoutByTimes)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.layoutByTimes = layoutByTimes;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> width;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.width = width;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> height;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.height = height;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="执行入口-调用流程"><a href="#执行入口-调用流程" class="headerlink" title="执行入口/调用流程"></a>执行入口/调用流程</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    DataConfig.setDataPath(<span class="string">"C:\\Users\\msi\\Desktop\\xiaomi.txt"</span>); <span class="comment">//读取此txt文件</span></span><br><span class="line">    BufferedReader br = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">    <span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(</span><br><span class="line">    DataConfig.getDataPath()), <span class="string">"utf-8"</span>));</span><br><span class="line">    DataConfig.setDataReader(br);</span><br><span class="line">    DataConfig.setNodeFormat(<span class="keyword">new</span> BSPNodeFormatImpl());</span><br><span class="line"><span class="comment">//注意：此处必须和输入数据的个数完全一致，否则会在节点计算初始坐标时出错</span></span><br><span class="line">    DataConfig.setNodeNum(<span class="number">3142</span>);</span><br><span class="line">    <span class="keyword">if</span> (layoutMethod.equals(<span class="string">"FRLayout"</span>)) &#123;</span><br><span class="line">    <span class="comment">//实例化配置对象,有部分方法是继承自父类的</span></span><br><span class="line">    FRLayoutConfig layoutConfig = <span class="keyword">new</span> FRLayoutConfig();</span><br><span class="line">    layoutConfig.setLayoutByTimes(<span class="keyword">true</span>);</span><br><span class="line">    layoutConfig.setDirected(<span class="keyword">false</span>);</span><br><span class="line">    layoutConfig.setWidth(<span class="number">5000</span>);</span><br><span class="line">    layoutConfig.setHeight(<span class="number">5000</span>);</span><br><span class="line">    layoutConfig.setLayoutByTimes(<span class="keyword">true</span>);</span><br><span class="line">    layoutConfig.setK(Float.parseFloat(<span class="string">"0.2"</span>));</span><br><span class="line">    layoutConfig.setTimes(Integer.parseInt(<span class="string">"3"</span>));</span><br><span class="line">    layoutConfig.setCool(Float.parseFloat(<span class="string">"0.8"</span>));</span><br><span class="line">    layoutConfig.setTemperature(Integer.parseInt(<span class="string">"1"</span>));</span><br><span class="line">    <span class="comment">//按DataConfig的参数输入loadNodeData，</span></span><br><span class="line">    GraphData graphData = <span class="keyword">new</span> GraphData();</span><br><span class="line">    <span class="comment">//包含全部的数据，点、边、关系等等；</span></span><br><span class="line">    graphData.loadNodeData(DataConfig.getDataReader(),</span><br><span class="line">    DataConfig.getNodeFormat(), DataConfig.getNodeNum());</span><br><span class="line">    <span class="comment">//传入已建立的图对象 和 布局算法配置对象</span></span><br><span class="line">    Layout layout = <span class="keyword">new</span> FRForceLayout(graphData.getGraph(), layoutConfig);</span><br><span class="line">    layout.doLayout();<span class="comment">//迭代算法</span></span><br><span class="line">    Output.outputJson(graphData.getGraph(),<span class="string">"C:\\Users\\msi\\Desktop\\xiaomi.json"</span>);</span><br><span class="line">    System.out.println(<span class="string">"FRLayout--end"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>###　结果数据</p><p>通过Output类中的转换方法，将存储结果的整个Graph对象的坐标数据转化为Json格式，并输出到文件，最后的数据如下(截取部分)：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"nodes"</span>:[&#123;<span class="attr">"name"</span>:<span class="string">"1"</span>,<span class="attr">"value"</span>:<span class="string">"小米微博组 "</span>,<span class="attr">"cy"</span>:<span class="string">"156.01001534887016"</span>,<span class="attr">"cx"</span>:<span class="string">"3166.150545142414"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"2"</span>,<span class="attr">"value"</span>:<span class="string">"神得强Steven "</span>,<span class="attr">"cy"</span>:<span class="string">"640.4571943091852"</span>,<span class="attr">"cx"</span>:<span class="string">"2949.154447954751"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"3"</span>,<span class="attr">"value"</span>:<span class="string">"MIUI论坛 "</span>,<span class="attr">"cy"</span>:<span class="string">"3570.9778335387005"</span>,<span class="attr">"cx"</span>:<span class="string">"1698.232117858166"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"4"</span>,<span class="attr">"value"</span>:<span class="string">"小米平板 "</span>,<span class="attr">"cy"</span>:<span class="string">"2063.9975461388217"</span>,<span class="attr">"cx"</span>:<span class="string">"4651.260384562792"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"5"</span>,<span class="attr">"value"</span>:<span class="string">"小米电视 "</span>,<span class="attr">"cy"</span>:<span class="string">"4817.615271549201"</span>,<span class="attr">"cx"</span>:<span class="string">"3685.092338867302"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"6"</span>,<span class="attr">"value"</span>:<span class="string">"公民大李 "</span>,<span class="attr">"cy"</span>:<span class="string">"2608.7081901026404"</span>,<span class="attr">"cx"</span>:<span class="string">"178.94341205320288"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"7"</span>,<span class="attr">"value"</span>:<span class="string">"小米电视俱乐部 "</span>,<span class="attr">"cy"</span>:<span class="string">"4989.0703708172905"</span>,<span class="attr">"cx"</span>:<span class="string">"897.1708897116042"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"8"</span>,<span class="attr">"value"</span>:<span class="string">"小米客服那些事 "</span>,<span class="attr">"cy"</span>:<span class="string">"162.15895711734697"</span>,<span class="attr">"cx"</span>:<span class="string">"1687.8496029706146"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"9"</span>,<span class="attr">"value"</span>:<span class="string">"小米空气净化器 "</span>,<span class="attr">"cy"</span>:<span class="string">"1377.3787717779344"</span>,<span class="attr">"cx"</span>:<span class="string">"1288.6280165113844"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"10"</span>,<span class="attr">"value"</span>:<span class="string">"肉肉的大飞哥 "</span>,<span class="attr">"cy"</span>:<span class="string">"4365.703702756339"</span>,<span class="attr">"cx"</span>:<span class="string">"1768.5797529564923"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"11"</span>,<span class="attr">"value"</span>:<span class="string">"love魑魅魍魉999"</span>,<span class="attr">"cy"</span>:<span class="string">"884.4260930361169"</span>,<span class="attr">"cx"</span>:<span class="string">"1918.0952190492774"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"12"</span>,<span class="attr">"value"</span>:<span class="string">"金子一言520 "</span>,<span class="attr">"cy"</span>:<span class="string">"4306.517287882674"</span>,<span class="attr">"cx"</span>:<span class="string">"857.9229659557374"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"13"</span>,<span class="attr">"value"</span>:<span class="string">"gasaraki神探2333"</span>,<span class="attr">"cy"</span>:<span class="string">"2858.0329169946035"</span>,<span class="attr">"cx"</span>:<span class="string">"3368.2338019639533"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"14"</span>,<span class="attr">"value"</span>:<span class="string">"hellen1314"</span>,<span class="attr">"cy"</span>:<span class="string">"1387.16941825711"</span>,<span class="attr">"cx"</span>:<span class="string">"2564.64775703357"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"15"</span>,<span class="attr">"value"</span>:<span class="string">"梦的一生9 "</span>,<span class="attr">"cy"</span>:<span class="string">"2898.153990200826"</span>,<span class="attr">"cx"</span>:<span class="string">"4351.388549183514"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"16"</span>,<span class="attr">"value"</span>:<span class="string">"小皮康 "</span>,<span class="attr">"cy"</span>:<span class="string">"4540.151322415267"</span>,<span class="attr">"cx"</span>:<span class="string">"4398.402966348725"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"17"</span>,<span class="attr">"value"</span>:<span class="string">"飞啊飞木有翅膀 "</span>,<span class="attr">"cy"</span>:<span class="string">"3025.8018395215827"</span>,<span class="attr">"cx"</span>:<span class="string">"657.2738586083469"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"18"</span>,<span class="attr">"value"</span>:<span class="string">"小米-惜诺"</span>,<span class="attr">"cy"</span>:<span class="string">"2601.4091892917922"</span>,<span class="attr">"cx"</span>:<span class="string">"140.32453861960772"</span>&#125;,&#123;<span class="attr">"name"</span>:<span class="string">"19"</span>,<span class="attr">"value"</span>:<span class="string">"帅得被人侃C"</span>,<span class="attr">"cy"</span>:<span class="string">"1986.1671743022102"</span>,<span class="attr">"cx"</span>:<span class="string">"738.5324574182849"</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><h3 id="显示结果"><a href="#显示结果" class="headerlink" title="显示结果"></a>显示结果</h3><p>这部分主要是按坐标绘制点线的过程，由于大量计算操作已经完成，所以基本上没有什么开销，主要是绘图的开销（渲染和GPU的因素）,总的来说选择很多，如桌面应用形式的Gephi和前端形式的d3js，在这里，主要是使用的d3js对上述结果做了简单的绘制。<br>为什么选择d3js呢，因为其对绘制做了高度的封装，所以代码非常简洁，而且速度也非常两人满意。</p><h3 id="核心的坐标计算部分"><a href="#核心的坐标计算部分" class="headerlink" title="核心的坐标计算部分"></a>核心的坐标计算部分</h3><p>（待完善）<br>第一阶段：读入数据，转化为图结构 涉及的类<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buiv51cu12iueb216hc178u9tr1j.png" alt="image_1buiv51cu12iueb216hc178u9tr1j.png-21kB"></p><p>第二阶段：坐标的计算<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1buj2gidb1vpm1kfs1bnb1qpc12rk20.png" alt="image_1buj2gidb1vpm1kfs1bnb1qpc12rk20.png-20.2kB"></p><pre><code>要计算：两节点之间的斥力、引力（斥力和引力与距离的关系如上图所示）距离越远，引力越大斥力越小。距离越近，引力越小斥力越大。上图第一象限的表达式：f = + k/(d*d)     引力为正第四象限的表达式：f = - (k*k)/d         斥力为负</code></pre>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 可视化 </tag>
            
            <tag> 布局算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用Python实现神经网络(待续)</title>
      <link href="/article/ccc3.html"/>
      <url>/article/ccc3.html</url>
      
        <content type="html"><![CDATA[<ul><li>介绍人工智能的基本概念和逻辑体系</li><li>研究两种数据的分类算法</li><li>使用Python运用分类方法实现只有一层的神经网络</li></ul><a id="more"></a><h4 id="分类两种类型"><a href="#分类两种类型" class="headerlink" title="分类两种类型"></a>分类两种类型</h4><pre><code>感知器，适用性的线性神经元</code></pre><p>使用Python的开发库：Pandas，Numpy，matplotlib：进行读取加工可视化</p><h4 id="神经元"><a href="#神经元" class="headerlink" title="神经元"></a>神经元</h4><blockquote><p>从交叉部分即神经末梢进行输入，在细胞核进行统一运算，然后通过轴突<br>传递到末尾，通过末尾的分叉传递到其他神经元</p></blockquote><h4 id="神经元的数学表示："><a href="#神经元的数学表示：" class="headerlink" title="神经元的数学表示："></a>神经元的数学表示：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3fksv81ri1158i10dl1a9n1oqg9.png" alt="image_1bu3fksv81ri1158i10dl1a9n1oqg9.png-27.2kB"><br>x：电信号<br>w：弱化系数（权重向量），表示神经元分叉部分对信号弱化的向量<br>x1-&gt;w1：从第一个管道传输时伴有的弱化<br>z：细胞核将全部电信号整合在一起<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3fq89h1s81bs41ipn1kio1s15m.png" alt="image_1bu3fq89h1s81bs41ipn1kio1s15m.png-26.4kB"><br>激活函数，又称单元步调函数<br>当z的值大于等于阈值时发送1，小于某阈值时发送-1<br>类似一个分类的函数，通常此函数比较复杂</p><h4 id="向量的点乘（点积）："><a href="#向量的点乘（点积）：" class="headerlink" title="向量的点乘（点积）："></a>向量的点乘（点积）：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3fvroo9nm1361kkb1gat1ff213.png" alt="image_1bu3fvroo9nm1361kkb1gat1ff213.png-17.3kB"><br>矩阵的转置：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3g2hhbu6cd1g1bes1qn2bqu20.png" alt="image_1bu3g2hhbu6cd1g1bes1qn2bqu20.png-30.6kB"></p><p>有了权重向量w，和训练样本x</p><ol><li>把权重向量初始化为0，或把每个分量初始化为【0,1】间得任意小数</li><li>把训练样本输入感知器，得到分类结果-1或1</li><li>根据分类结果更新权重向量w（反复输入更新，从而准确预测）</li></ol><p>简化步调函数<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3gbnrehl51e9i16apr9hupt2d.png" alt="image_1bu3gbnrehl51e9i16apr9hupt2d.png-36.8kB"><br>添加w0和x0从而将判断直接转换为判断z的正负</p><h4 id="权重的更新算法，"><a href="#权重的更新算法，" class="headerlink" title="权重的更新算法，"></a>权重的更新算法，</h4><p>更新后的权重w：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3gjntc1vgd8tpdb332u4ok2q.png" alt="image_1bu3gjntc1vgd8tpdb332u4ok2q.png-5.7kB"></p><p>更新的增量：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3gljls9p71358qnl6fo5ft37.png" alt="image_1bu3gljls9p71358qnl6fo5ft37.png-6.2kB"></p><p>y指的是输入的正确分类，y’感知器输出的分类<br>即如果分类正确，那么整个增量为零，分类错误才需要调整<br>系数n：模型的学习率，0~1，人为经验参数，需要使用者根据具体情况不断手动调整</p><h4 id="权重更新示例："><a href="#权重更新示例：" class="headerlink" title="权重更新示例："></a>权重更新示例：</h4><p>得到了错误分类：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h073ohvqoou98v124n18o3k.png" alt="image_1bu3h073ohvqoou98v124n18o3k.png-10.5kB"><br>进行调整：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h16kk1691kkf101595d8041.png" alt="image_1bu3h16kk1691kkf101595d8041.png-11.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h1hpu112b19eggu5ai41kut4e.png" alt="image_1bu3h1hpu112b19eggu5ai41kut4e.png-8.3kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h329j19lu1hpkh551ktjghq4r.png" alt="image_1bu3h329j19lu1hpkh551ktjghq4r.png-19.4kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h3v7o1iu4r5f1ha019ejrqs58.png" alt="image_1bu3h3v7o1iu4r5f1ha019ejrqs58.png-20.6kB"><br>调整完成：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h4clr1o8l1fmvetu1l161opg5l.png" alt="image_1bu3h4clr1o8l1fmvetu1l161opg5l.png-11.2kB"><br>阈值更新：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3h6squh2035n14r844teg462.png" alt="image_1bu3h6squh2035n14r844teg462.png-23kB"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="感知器的适用范围："><a href="#感知器的适用范围：" class="headerlink" title="感知器的适用范围："></a>感知器的适用范围：</h4><p>预测数据可以线性分割，不是A就是B<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3hajh61shd1kpugdi84qc1v6f.png" alt="image_1bu3hajh61shd1kpugdi84qc1v6f.png-16.8kB"><br>不适用于线性不可分割的数据<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3hbtn91c66isi15au1tpd1smq6s.png" alt="image_1bu3hbtn91c66isi15au1tpd1smq6s.png-31.8kB"></p><h4 id="感知器分类算法的步骤："><a href="#感知器分类算法的步骤：" class="headerlink" title="感知器分类算法的步骤："></a>感知器分类算法的步骤：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bu3hig1pmqr12m91tvd1gji1v9h79.png" alt="image_1bu3hig1pmqr12m91tvd1gji1v9h79.png-52.5kB"><br>初始化训练样本x<br>初始化权重向量w<br>做点积<br>在步调函数/激活函数中进行判断<br>判断正确则输出，错误则更新权重w<br>    做点积<br>    在步调函数/激活函数中进行判断<br>    判断正确则输出，错误则更新权重w<br>        … …<br>        … …<br>        … …</p>]]></content>
      
      
      <categories>
          
          <category> ML/R学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的一些注意事项</title>
      <link href="/article/5dff.html"/>
      <url>/article/5dff.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="使用字典来代替-switch-语句"><a href="#使用字典来代替-switch-语句" class="headerlink" title="使用字典来代替 switch 语句"></a><strong>使用字典来代替 switch 语句</strong></h4><pre><code>方法：    使用字典的key代替 switch中的case示例：    switcher = {        0 : &apos;Go left&apos;,        1 : &apos;Go right&apos;,        2 : &apos;Go straght&apos;    }使用key选择分支：    print(switcher[0])缺点：    模拟不了default分支解决：    使用get方法，并指定匹配不到key时的返回值    print(switcher.get(5, &apos;Unknown&apos;)) #输出 Unknown仍有缺点：    只能简单赋值，无法书写代码段完备的示例：    将原有字符串部分均使用函数进行返回    代码：        def goleft():            return &apos;goleft&apos;        def goright():            return &apos;goright&apos;        def gostraght():            return &apos;gostraght&apos;        def default():            return &apos;default&apos;        注意：定义顺序必，函数必须先进行定义        switcher1 = {            0 : goleft,            1 : goright,            2 : gostraght        }        print( switcher1.get(5, default)() ) #输出default    注意：        调用形式，函数式编程 ：switcher1.get(5, default)()         由于get到的是函数名，所以需要加()显式调用</code></pre><h4 id="列表推导式：（Pythonic）"><a href="#列表推导式：（Pythonic）" class="headerlink" title="列表推导式：（Pythonic）"></a><strong>列表推导式：（Pythonic）</strong></h4><pre><code>场景：    通过已经存在的列表，生成新的列表示例：    对[1,2,3,4,5]全部元素进行平方实现：    其他可以实现的方式：map+filter推导式实现:    a = [1,2,3,4,5,6]    b = [i*i for i in a] # [ 关于i的表达式 for i in 列表 ]    print(b)    #输出：[1, 4, 9, 16, 25, 36]    b = [i*i for i in a if i&gt;3] # [ 关于i的表达式 for i in 列表 if 关于i的判断 ]    print(b)    #输出：[16, 25, 36]注意：    如果对于set进行集合推导式代码：    a = {1,2,3,4,5,6}    b = {i*i for i in a} # [ 关于i的表达式 for i in 列表 ]    print(b)    #输出：{1, 4, 36, 9, 16, 25}其他；    元组，列表，字典，集合，都可以被推导    对于字典：        stu = {            &apos;Tom&apos;:18,            &apos;Jack&apos;:13,            &apos;Kimmy&apos;:15        }    提取key：        stub = { key for key,value in stu }        会报错，字典不能直接被解包遍历，需要使用items()方法    代码：        print( { key for key,value in stu.items() } )        #{&apos;Tom&apos;, &apos;Kimmy&apos;, &apos;Jack&apos;}        print( { value:key for key,value in stu.items() } )        #{18: &apos;Tom&apos;, 13: &apos;Jack&apos;, 15: &apos;Kimmy&apos;} 键值互换        print( ( key for key,value in stu.items() ) )        #&lt;generator object &lt;genexpr&gt; at 0x0000000000B36B48&gt;</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="None-空类型-type-NoneType"><a href="#None-空类型-type-NoneType" class="headerlink" title="None 空类型 type=NoneType"></a><strong>None 空类型 type=NoneType</strong></h4><pre><code>注意:    在类型和字符串方面：不是&apos;&apos;,不是[],不是0,不是false验证：    def fun1():        pass        #函数没有return，返回None    def fun2():        return      #return后不跟变量，返回None    print(fun1())   #返回None    print(fun2())   #返回None判断a = []为空的方式    正确的方式        if not a:            print(&apos;None&apos;)         else:            print(&apos;NotNone----&apos;)     错误的方式        if a is None:            print(&apos;None&apos;)         else:            print(&apos;NotNone&apos;) #a=[]时，并不能判空注意：    print(bool(None))   #Fasle    print(bool([]))     #Fasle    python中每个类型都和True False有对应关系：None = False验证一：    class Test():        pass    test = Test()    if test:        print(&apos;NotNone&apos;)    else:        print(&apos;None&apos;)    #输出：NotNone    print(bool(test))   #True    print(bool(Test())) #True验证二：（添加__len__方法）    class Test():        def __len__(self):            return 0    test = Test()    if test:        print(&apos;NotNone&apos;)    else:        print(&apos;None&apos;)    #输出：None    print(bool(test))   #False    print(bool(Test())) #False结论：    上述表明，实例化后使用if并不一定能判空，其取决于类内的定义    特别是__len__()和__bool__()方法，会决定实例化后返回的布尔取值注意：    __len__(self)方法返回值：只能返回整形或布尔值    触发函数：        bool(Test()),在没有__bool__()时调用对象的__len__()        len(Test()),在没有__bool__()时调用对象的__len__()混合：    class Test():        def __bool__(self):            return True         def __len__(self):            return False    test = Test()    print(bool(Test())) #输出：True结论：    __bool__()方法优先级高于__len__()方法，如果有bool方法存在那么优先使用bool的返回值</code></pre><h4 id="装饰器的副作用"><a href="#装饰器的副作用" class="headerlink" title="装饰器的副作用"></a><strong>装饰器的副作用</strong></h4><pre><code>使用自定义的装饰器    import time    def decorator(func):        def wrapper():            &apos;&apos;&apos;                wrapper的描述            &apos;&apos;&apos;            print(time.time())            func()        return wrapper验证一：    def f1():        &apos;&apos;&apos;            描述f1的作用等等        &apos;&apos;&apos;        print(&apos;f1.__name__:&apos;,f1.__name__)    f1() # 输出：f1    print(help(f1))    #输出：描述f1的作用等等验证二：    @decorator    def f2():        &apos;&apos;&apos;            描述f2的作用等等        &apos;&apos;&apos;        print(&apos;f2.__name__:&apos;,f2.__name__)    f2() # 输出：wrapper    # &gt;&gt;&gt; help(len)可以查看len()函数的说明    print(help(f2))    #输出：“wrapper的描述”结论：    由上可知，装饰器会盖面原有函数的本身性质，函数名注释等等定义无副作用的装饰器：    方法：        在自定义装饰器中添加装饰器@wraps    代码：        import time        from functools import wraps        def decorator(func):            &apos;&apos;&apos;                装饰器的注释            &apos;&apos;&apos;            @wraps(func) #添加装饰器，可以带参数            def wrapper():                print(time.time())                func()            return wrapper    验证：        @decorator        def f1():            &apos;&apos;&apos;                描述f1的作用等等            &apos;&apos;&apos;            print(&apos;f1.__name__:&apos;,f1.__name__)        f1() # 输出：f1        print(help(f1)) #输出：描述f1的作用等等    @wraps装饰器：        原先的装饰器直接执行的wrapper函数，添加@wraps装饰器之后，        首先执行warps装饰器，其可以获得被装饰函数的全部信息，所以可以将原被修饰的函数的全部信息进行保留</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的原生爬虫案例</title>
      <link href="/article/db81.html"/>
      <url>/article/db81.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="完整的爬虫："><a href="#完整的爬虫：" class="headerlink" title="完整的爬虫："></a><strong>完整的爬虫：</strong></h4><pre><code>反扒机制，自动登录，代理IP等等</code></pre><h4 id="示例爬虫："><a href="#示例爬虫：" class="headerlink" title="示例爬虫："></a><strong>示例爬虫：</strong></h4><pre><code>简单的数据抓取，简单的数据处理</code></pre><h4 id="目的："><a href="#目的：" class="headerlink" title="目的："></a><strong>目的：</strong></h4><pre><code>不使用爬虫框架完成数据爬取巩固知识、合理编程、内部原理</code></pre><h4 id="示例内容："><a href="#示例内容：" class="headerlink" title="示例内容："></a><strong>示例内容：</strong></h4><pre><code>内容：    爬取直播网站确定工作：    确定爬取数据：某个分类下各主播人气的数据    确定实现结果：将人气进行排序准备：    分析网站结构    寻找包含爬取信息的页面    F12检查网页，定位信息（主播姓名，人气数据）原理：    对html文件进行文本分析并从中提取信息使用技术    正则表达式具体步骤：    模拟HTTP请求，向服务器发送请求，获取到服务器返回的HTML    用正则表达式处理网页文本，过滤出有用数据    找到相关常量标签，作为正则的定位边界    定位标签：        尽量选择具有唯一标识的标识的标签        尽量选择与目标数据相近的标签        尽量选择将所有目标数据都包含的标签（闭合的标签），比如包含姓名+人气的标签        上述即尽量选父标签，不选兄弟标签，为了易于构造正则提取内容注意：    构造正则不是难点，难点是应对反爬虫的措施整体书写规范    每行代码不要过长    推荐书写一个入口程序    推荐在入口中平行的调用逻辑代码    每个方法中代码尽量少    注意块注释和行级注释的书写格式代码结构：</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">类注释</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">class spider():</span><br><span class="line"></span><br><span class="line">#抓取页面内容（行注释）</span><br><span class="line">def __fetch_content(self):</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">方法注释</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">pass</span><br><span class="line">#数据抽取</span><br><span class="line">def __analysis(self, htmls):</span><br><span class="line">pass</span><br><span class="line">#数据精炼</span><br><span class="line">def __refine(self, pairs):</span><br><span class="line">pass</span><br><span class="line">#排序</span><br><span class="line">def __sort(self, pairs):</span><br><span class="line">pass</span><br><span class="line">#排序的算子</span><br><span class="line">def __seed(self, pairs):</span><br><span class="line">pass</span><br><span class="line">#数据展现</span><br><span class="line">def __show(self, pairs):</span><br><span class="line">pass</span><br><span class="line"></span><br><span class="line">#函数入口</span><br><span class="line">def go(self):</span><br><span class="line">调用</span><br><span class="line">s &#x3D; spider()</span><br><span class="line">s.go() </span><br><span class="line"> </span><br><span class="line">&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">书写代码：</span><br><span class="line">抓取页面：</span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;www.huya.com&#x2F;g&#x2F;lol&#39;</span><br><span class="line">分析原网页：</span><br></pre></td></tr></table></figure><pre><code>&lt;li class=&quot;game-live-item&quot; gid=&quot;1&quot;&gt;    &lt;a href=&quot;http://www.huya.com/yanmie&quot; class=&quot;video-info new-clickstat&quot; target=&quot;_blank&quot; report=&apos;{&quot;eid&quot;:&quot;click/position&quot;,&quot;position&quot;:&quot;lol/0/1/5&quot;,&quot;game_id&quot;:&quot;1&quot;,&quot;ayyuid&quot;:&quot;380335691&quot;}&apos;&gt;        &lt;img class=&quot;pic&quot; data-original=&quot;//screenshot.msstatic.com/yysnapshot/1711a622dc4d670fe32de2018f78a2d030fcde37cfe8?imageview/4/0/w/338/h/190/blur/1&quot; src=&quot;//a.msstatic.com/huya/main/assets/img/default/338x190.jpg&quot; onerror=&quot;this.onerror=null; this.src=&apos;//a.msstatic.com/huya/main/assets/img/default/338x190.jpg&apos;;&quot; alt=&quot;最强赵信折翼的直播&quot; title=&quot;最强赵信折翼的直播&quot;&gt;                &lt;div class=&quot;item-mask&quot;&gt;&lt;/div&gt;        &lt;i class=&quot;btn-link__hover_i&quot;&gt;&lt;/i&gt;        &lt;em class=&quot;tag tag-blue&quot;&gt;蓝光&lt;/em&gt;    &lt;/a&gt;    &lt;a href=&quot;http://www.huya.com/yanmie&quot; class=&quot;title new-clickstat&quot; report=&apos;{&quot;eid&quot;:&quot;click/position&quot;,&quot;position&quot;:&quot;lol/0/1/5&quot;,&quot;game_id&quot;:&quot;1&quot;,&quot;ayyuid&quot;:&quot;380335691&quot;}&apos; title=&quot;可以用赵信上王者第一的男人&quot; target=&quot;_blank&quot;&gt;可以用赵信上王者第一的男人&lt;/a&gt;    &lt;span class=&quot;txt&quot;&gt;        &lt;span class=&quot;avatar fl&quot;&gt;            &lt;img data-original=&quot;//huyaimg.msstatic.com/avatar/1081/63/c83bdc0701b64646c86065e273fd05_180_135.jpg&quot; src=&quot;//a.msstatic.com/huya/main/assets/img/default/84x84.jpg&quot; onerror=&quot;this.onerror=null; this.src=&apos;//a.msstatic.com/huya/main/assets/img/default/84x84.jpg&apos;;&quot; alt=&quot;最强赵信折翼&quot; title=&quot;最强赵信折翼&quot;&gt;            &lt;i class=&quot;nick&quot; title=&quot;最强赵信折翼&quot;&gt;最强赵信折翼&lt;/i&gt;        &lt;/span&gt;                &lt;span class=&quot;num&quot;&gt;&lt;i class=&quot;num-icon&quot;&gt;&lt;/i&gt;&lt;i class=&quot;js-num&quot;&gt;1.5万&lt;/i&gt;&lt;/span&gt;    &lt;/span&gt;&lt;/li&gt;</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">找到含目标数据的最小公约子集：</span><br></pre></td></tr></table></figure><pre><code>&lt;span class=&quot;txt&quot;&gt;    &lt;span class=&quot;avatar fl&quot;&gt;        &lt;img data-original=&quot;//huyaimg.msstatic.com/avatar/1081/63/c83bdc0701b64646c86065e273fd05_180_135.jpg&quot; src=&quot;//a.msstatic.com/huya/main/assets/img/default/84x84.jpg&quot; onerror=&quot;this.onerror=null; this.src=&apos;//a.msstatic.com/huya/main/assets/img/default/84x84.jpg&apos;;&quot; alt=&quot;最强赵信折翼&quot; title=&quot;最强赵信折翼&quot;&gt;        &lt;i class=&quot;nick&quot; title=&quot;最强赵信折翼&quot;&gt;最强赵信折翼&lt;/i&gt;    &lt;/span&gt;            &lt;span class=&quot;num&quot;&gt;&lt;i class=&quot;num-icon&quot;&gt;&lt;/i&gt;&lt;i class=&quot;js-num&quot;&gt;1.5万&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">目标数据：</span><br><span class="line">最强赵信折翼，1.5万</span><br><span class="line">构造正则表达式：</span><br><span class="line">选出上面的最小公约子集：</span><br><span class="line">root_pattern &#x3D; &#39;&lt;span class&#x3D;&quot;txt&quot;&gt;([\s\S]*?)\r\n&lt;&#x2F;li&gt;&#39; </span><br><span class="line">注意：</span><br><span class="line">要加问号，声明是非贪婪的匹配</span><br><span class="line"></span><br><span class="line">然后选出，姓名：</span><br><span class="line">name_pattern &#x3D; &#39;&lt;i class&#x3D;&quot;nick&quot; title&#x3D;&quot;([\s\S]*?)&quot;&gt;&#39;</span><br><span class="line">然后选出，人气：</span><br><span class="line">num_pattern &#x3D; &#39;&lt;i class&#x3D;&quot;js-num&quot;&gt;([\s\S]*?)&lt;&#x2F;i&gt;&#39;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">上述正则的边界并不一定是完整的html标签，因为使用正则即对字符进行匹配，所以可以随意拆分。</span><br><span class="line"></span><br><span class="line">几个重要功能：</span><br><span class="line"></span><br><span class="line">获取页面内容：</span><br><span class="line">from urllib import request</span><br><span class="line">tmp &#x3D; request.urlopen(spider.url)</span><br><span class="line">htmls &#x3D; tmp.read() </span><br><span class="line">注意：此处的结果是字节码：bytes</span><br><span class="line">必须要进行转化：bytes-&gt;str</span><br><span class="line">htmls &#x3D; str(htmls,encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line"> </span><br><span class="line">注意：不推荐打印出页面内容，会出现解码问题，可以加断点调试</span><br><span class="line"> </span><br><span class="line">循环：</span><br><span class="line">此处的循环需要获取到下标，而直接for i in list，获取不到下标</span><br><span class="line">此时应该使用for index in range(0,len(list))这种形式</span><br><span class="line">代码：</span><br><span class="line">for rank in range(0, len(pairs)):</span><br><span class="line">print(&#39;第&#39;,rank,&#39;名：&#39;,pairs[rank][&#39;name&#39;],&#39;:&#39;,pairs[rank][&#39;number&#39;])</span><br><span class="line"></span><br><span class="line">排序：</span><br><span class="line">此处使用内置函数sorted(iterable, cmp&#x3D;None, key&#x3D;None, reverse&#x3D;False)</span><br><span class="line">注意：</span><br><span class="line">key &#x3D; 函数名，此函数应该返回排序的比较值</span><br><span class="line">cmp &#x3D; 函数名，此函数可以重写排序规则</span><br><span class="line">reverse&#x3D;False，从小到大正序排列</span><br><span class="line">代码：</span><br><span class="line">sorted(pairs,key &#x3D; seed,reverse &#x3D; True)</span><br><span class="line">def seed(self, pairs):</span><br><span class="line">tmp &#x3D; pairs[&#39;number&#39;].replace(&#39;万&#39;,&#39;&#39;)</span><br><span class="line">if(&#39;万&#39; in pairs[&#39;number&#39;]):</span><br><span class="line">tmp &#x3D; float(tmp) * 10000</span><br><span class="line">return int(tmp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:&#x2F;&#x2F;www.cxmoe.com](https:&#x2F;&#x2F;www.cxmoe.com) **&gt;&gt;**</span><br><span class="line"></span><br><span class="line">完整的爬虫代码：</span><br></pre></td></tr></table></figure><p>from urllib import request<br>import re</p><p>class spider():</p><pre><code>url = &apos;http://www.huya.com/g/lol&apos;root_pattern = &apos;&lt;span class=&quot;txt&quot;&gt;([\s\S]*?)\r\n&lt;/li&gt;&apos; #父级目录匹配# 使用概括字符集 [\d] [\w]  [\s]  [.]#注意：要加问号，声明是非贪婪的匹配name_pattern = &apos;&lt;i class=&quot;nick&quot; title=&quot;([\s\S]*?)&quot;&gt;&apos;num_pattern = &apos;&lt;i class=&quot;js-num&quot;&gt;([\s\S]*?)&lt;/i&gt;&apos;def __fetch_content(self):  #加__的函数：私有方法    tmp = request.urlopen(spider.url)    htmls = tmp.read() #此处的结果是字节码：bytes    # bytes-&gt;str    htmls = str(htmls,encoding=&apos;utf-8&apos;)    a = 1#如果不添加这一句，htmls赋值发生在最后一句    #那么断点停止时会得不到htmls的值，这时要人为多余的添加一条语句并将断点放到这里即可    #print(htmls)不推荐打印，会出现解码问题    return htmlsdef __sort(self, pairs):    #def sorted(iterable, cmp=None, key=None, reverse=False)    #注意要指定key值    return sorted(pairs,key=self.__seed,reverse=True)def __show(self, pairs):    #for循环中需要拿到序号，直接使用range形式的for循环    for rank in range(0, len(pairs)):        print(&apos;第&apos;,rank,&apos;名：&apos;,pairs[rank][&apos;name&apos;],&apos;:&apos;,pairs[rank][&apos;number&apos;])def __seed(self, pairs):    tmp = pairs[&apos;number&apos;].replace(&apos;万&apos;,&apos;&apos;)    if(&apos;万&apos; in pairs[&apos;number&apos;]):        tmp = float(tmp) * 10000    return int(tmp)def __refine(self, pairs):    f = lambda p: {         &apos;name&apos;:p[&apos;name&apos;][0].strip(),        &apos;number&apos;:p[&apos;number&apos;][0]         }    return map(f, pairs)def __analysis(self, htmls):    root_htm = re.findall(spider.root_pattern,htmls)    pairs = []    for item in root_htm:        name = re.findall(spider.name_pattern,item)        num = re.findall(spider.num_pattern,item)        pair = {&apos;name&apos;:name,&apos;number&apos;:num}        pairs.append(pair)    return pairs#设置入口函数,这是一个主方法，里面都是平级函数，推荐这种写法 def go(self):       htmls = self.__fetch_content()      #抓取页面内容    pairs = self.__analysis(htmls)      #抽取所需数据    pairs = list(self.__refine(pairs))  #数据精炼    pairs = self.__sort(pairs)          #数据排序    self.__show(pairs)                  #数据显示，或后续处理（入库等）</code></pre><p>#实例化并调用入口函数<br>s = spider()<br>s.go()  </p><pre><code>注意事项：    如果需要调试，不推荐站桩print，推荐使用断点调试    调试方法：        启动应用程序 F5        单步执行F10        跳到下一个断点 F5        调到函数内部 F11    例如在 html = tmp.read() 处打断点    在当前断点处，悬停鼠标会显示变量值，也可以在vscode左侧的甲壳虫选项中查看变量的值缺陷：    虽然通过类进行了封装，但是其实最基础的封装    但是，复用性差，抵御需求变化的能力太差，违反开闭原则进阶：    可以使用更加面向对象的设计来完成功能    借助构造函数__init__来对类进行带参数的实例化：    代码：        class Spider():            &apos;&apos;&apos;            This is a class            &apos;&apos;&apos;            url = &apos;&apos;            root_pattern = &apos;&apos;            name_pattern = &apos;&apos;            num_pattern = &apos;&apos;            def __init__(self,url,root_pattern,name_pattern,num_pattern):                 Spider.url = url                Spider.root_pattern = root_pattern                Spider.name_pattern = name_pattern                Spider.num_pattern = num_pattern            s = Spider(            &apos;http://www.huya.com/g/4&apos;,            &apos;&lt;span class=&quot;txt&quot;&gt;([\s\S]*?)\r\n&lt;/li&gt;&apos;,            &apos;&lt;i class=&quot;nick&quot; title=&quot;([\s\S]*?)&quot;&gt;&apos;,            &apos;&lt;i class=&quot;js-num&quot;&gt;([\s\S]*?)&lt;/i&gt;&apos;        )        s.go()      类封装的意义：        这样封装可以完成一个主播人气排序的爬虫类，参数有四个：            爬取的直播网站；            爬取的名称人气的父元素的正则            爬取名称的正则            爬取人气的正则展望：    爬虫模块或框架：        BeautifulSoup模块        Scrapy框架（多线程、分布式、较臃肿，看需求谨慎使用）    反反爬虫技术：        频繁爬取会使IP被封，需要使用定时器！切记！！        寻找代理IP库，应对封IP    整个流程的核心：            爬取的原始数据如何处理，精炼        处理的结果如何存储，分析</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scala中的Collection</title>
      <link href="/article/8cf3.html"/>
      <url>/article/8cf3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Scala中的immutable-Collection-集合"><a href="#Scala中的immutable-Collection-集合" class="headerlink" title="Scala中的immutable Collection 集合"></a>Scala中的immutable Collection 集合</h1><p>Traversable 遍历<br>Iterable    迭代<br>Set无序集合     Sequence序列        Map映射</p><a id="more"></a><ul><li><p><strong>Set</strong></p></li><li><p>SortedSet HashSet BitSet  ListSet</p></li><li><p>TreeSet       </p></li><li><p><strong>Sequence</strong></p></li><li><p>IndexedSeq   LinearSeq   </p></li><li><p>IndexedSeq</p></li><li><p>Vector,NumericRange,Range,Array,String  </p></li><li><p>LinearSeq</p></li><li><p>List,Stream,Quene,Stack</p></li><li><p><strong>Map</strong></p></li><li><p>Sortedmap HashMap LsitMap</p></li><li><p>TreeMap</p></li></ul><h2 id="List-T"><a href="#List-T" class="headerlink" title="List[T]"></a>List[T]</h2><p>T是类型，由于会自动推导类型，所以不必指明类型</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> a = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)        <span class="comment">//定义方法一</span></span><br><span class="line">a: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)     <span class="comment">//自动推导为Int类型的List</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> b = <span class="number">0</span>::a                 <span class="comment">//定义方法二：连接操作符</span></span><br><span class="line">b: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment">//将左边的元素添加到右边List的头部</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">var</span> c = <span class="string">"x"</span>::<span class="string">"y"</span>::<span class="string">"z"</span>::<span class="type">Nil</span>   <span class="comment">//Nil是空List</span></span><br><span class="line">c: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(x, y, z)     </span><br><span class="line"></span><br><span class="line"><span class="comment">//上述过程是从右往左连接，步骤如下：</span></span><br><span class="line">scala&gt; <span class="string">"z"</span>::<span class="type">Nil</span></span><br><span class="line">res5: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(z)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="string">"y"</span>::res5</span><br><span class="line">res6: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(y, z)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="string">"x"</span>::res6</span><br><span class="line">res7: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(x, y, z)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> d = a:::c                <span class="comment">//定义方法三：使用:::连接两个List</span></span><br><span class="line">d: <span class="type">List</span>[<span class="type">Any</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, x, y, z)</span><br><span class="line">                                    <span class="comment">//自动推导为Int,String的父类为Any</span></span><br><span class="line">scala&gt; a.head</span><br><span class="line">res8: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; d.head                       <span class="comment">//.head返回头元素</span></span><br><span class="line">res9: <span class="type">Any</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; c.head</span><br><span class="line">res10: <span class="type">String</span> = x</span><br><span class="line"></span><br><span class="line">scala&gt; a.tail                       <span class="comment">//.tail返回除头元素之外的元素</span></span><br><span class="line">res11: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; d.tail</span><br><span class="line">res12: <span class="type">List</span>[<span class="type">Any</span>] = <span class="type">List</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, x, y, z)</span><br><span class="line"></span><br><span class="line">scala&gt; a.isEmpty                    <span class="comment">//.isEmpty返回List是否为空</span></span><br><span class="line">res13: <span class="type">Boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="type">Nil</span>.isEmpty</span><br><span class="line">res14: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//利用tail和isEmpty构造循环来实现List的遍历：</span></span><br><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">scanf</span></span>(list: <span class="type">List</span>[<span class="type">Int</span>]):<span class="type">String</span> = &#123;</span><br><span class="line">     | <span class="keyword">if</span>(list.isEmpty) <span class="string">"NULL"</span></span><br><span class="line">     | <span class="keyword">else</span> list.head.toString+<span class="string">" "</span>+scanf(list.tail)</span><br><span class="line">     | &#125;</span><br><span class="line">scanf: (list: <span class="type">List</span>[<span class="type">Int</span>])<span class="type">String</span></span><br><span class="line"></span><br><span class="line">scala&gt; scanf(a)</span><br><span class="line">res15: <span class="type">String</span> = <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="type">NULL</span></span><br></pre></td></tr></table></figure><h1 id="List的高阶函数-filter：过滤"><a href="#List的高阶函数-filter：过滤" class="headerlink" title="List的高阶函数 filter：过滤"></a>List的高阶函数 filter：过滤</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将List元素进行过滤</span></span><br><span class="line"><span class="comment">//下面filter参数是一个匿名函数，x代表一个元素，filter会遍历List判断每个元素是否满足条件</span></span><br><span class="line">scala&gt; a.filter(x =&gt; x % <span class="number">2</span> ==<span class="number">1</span>) </span><br><span class="line">res17: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//toList表达式，结果是将当前字符串转为List</span></span><br><span class="line">scala&gt; <span class="string">"100 Persons"</span>.toList</span><br><span class="line">res18: <span class="type">List</span>[<span class="type">Char</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,  , <span class="type">P</span>, e, r, s, o, n, s)</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否为数字可以用Character.isDigit(x)方法</span></span><br><span class="line">scala&gt; <span class="string">"100 Persons"</span>.toList.filter(x =&gt; <span class="type">Character</span>.isDigit(x))</span><br><span class="line">res20: <span class="type">List</span>[<span class="type">Char</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//takeWhile满足条件则取元素，直到！取到某元素才停止</span></span><br><span class="line"><span class="comment">//（类似while循环）下面取元素取到字符‘o’终止，并且不会打印‘o’</span></span><br><span class="line">scala&gt; <span class="string">"100 Persons"</span>.toList.takeWhile(x =&gt; x!='o')</span><br><span class="line">res21: <span class="type">List</span>[<span class="type">Char</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,  , <span class="type">P</span>, e, r, s)</span><br></pre></td></tr></table></figure><h1 id="List的高阶函数-map-flatMap：映射"><a href="#List的高阶函数-map-flatMap：映射" class="headerlink" title="List的高阶函数 map/flatMap：映射"></a>List的高阶函数 map/flatMap：映射</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于下面的变量a和c应用映射</span></span><br><span class="line">scala&gt; a</span><br><span class="line">res22: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">scala&gt; c</span><br><span class="line">res22: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(x, y, z)</span><br><span class="line"></span><br><span class="line"><span class="comment">//map的参数就是一个匿名函数，表明一个转换过程，参数中的匿名函数参数x是List中得每个元素</span></span><br><span class="line"><span class="comment">//使用map实现全部字母大写</span></span><br><span class="line">scala&gt; c.map(x =&gt; x.toUpperCase)</span><br><span class="line">res23: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(<span class="type">X</span>, <span class="type">Y</span>, <span class="type">Z</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数中的匿名函数参数x可以使用通配符下划线'_'来代替</span></span><br><span class="line">scala&gt; c.map( _.toUpperCase)</span><br><span class="line">res24: <span class="type">List</span>[<span class="type">String</span>] = <span class="type">List</span>(<span class="type">X</span>, <span class="type">Y</span>, <span class="type">Z</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//同样的filter也可以使用通配符下划线'_'来代替</span></span><br><span class="line">scala&gt; a.filter( _ % <span class="number">2</span> ==<span class="number">1</span>)</span><br><span class="line">res25: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过filter和map来实现对List中过滤后元素的具体操作</span></span><br><span class="line"><span class="comment">//下面是将奇数全部加10</span></span><br><span class="line">scala&gt; a.filter( _ % <span class="number">2</span> ==<span class="number">1</span>).map( _ +  <span class="number">10</span>)</span><br><span class="line">res26: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">11</span>, <span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面是嵌套List</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> complex = <span class="type">List</span>( a,<span class="type">List</span>(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line">complex: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>), <span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//对于嵌套List，filter仍然会遍历到最里层的元素并且进行过滤</span></span><br><span class="line"><span class="comment">//但是其返回不会去掉外壳，仍然是个嵌套List</span></span><br><span class="line">scala&gt; complex.map(x =&gt; x.filter( _%<span class="number">2</span> ==<span class="number">0</span>))</span><br><span class="line">res27: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">List</span>(<span class="number">2</span>, <span class="number">4</span>), <span class="type">List</span>(<span class="number">4</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//同样，使用下划线也可以通配参数x</span></span><br><span class="line">scala&gt; complex.map( _.filter( _%<span class="number">2</span> ==<span class="number">0</span>))</span><br><span class="line">res28: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">List</span>(<span class="number">2</span>, <span class="number">4</span>), <span class="type">List</span>(<span class="number">4</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用flatMap可以将嵌套List“打平”，将返回元素全部放在同一层</span></span><br><span class="line"><span class="comment">//下面就可以取出嵌套List中的偶数，注意，去除了‘外壳’</span></span><br><span class="line">scala&gt; complex.flatMap( _.filter( _%<span class="number">2</span> ==<span class="number">0</span>))</span><br><span class="line">res30: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><h1 id="List的高阶函数-集合的规约操作"><a href="#List的高阶函数-集合的规约操作" class="headerlink" title="List的高阶函数 集合的规约操作"></a>List的高阶函数 集合的规约操作</h1><p>把集合的元素通过运算和操作规约为一个值</p><h2 id="reduceLeft-op-T-T-gt-T"><a href="#reduceLeft-op-T-T-gt-T" class="headerlink" title="reduceLeft(op: (T, T) =&gt; T )"></a>reduceLeft(op: (T, T) =&gt; T )</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x1  x2  x3      ... xn</span><br><span class="line">  op    x3      ... xn</span><br><span class="line">     op         ... xn</span><br><span class="line">                ...</span><br><span class="line">                 op</span><br></pre></td></tr></table></figure><p>特性1：参数为一个匿名函数<br>特性2：规约结果一定是List元素的类型，所以是被经常使用的（相较于foldLeft）</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">对于<span class="type">List</span>变量a</span><br><span class="line">scala&gt; a</span><br><span class="line">res33: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">使用reduceLeft，参数为匿名函数，表示规约的表达式</span><br><span class="line">scala&gt; a.reduceLeft((x,y) =&gt; x+y)</span><br><span class="line">res31: <span class="type">Int</span> = <span class="number">10</span></span><br><span class="line">可以使用下划线通配</span><br><span class="line">scala&gt; a.reduceLeft(_+_)</span><br><span class="line">res32: <span class="type">Int</span> = <span class="number">10</span></span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="foldLeft-z-U-op-U-T-gt-U"><a href="#foldLeft-z-U-op-U-T-gt-U" class="headerlink" title="foldLeft(z:U)(op: (U, T) =&gt; U )"></a>foldLeft(z:U)(op: (U, T) =&gt; U )</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">z   x1  x2      ... xn</span><br><span class="line">  op    x1      ... xn</span><br><span class="line">     op         ... xn</span><br><span class="line">                ...</span><br><span class="line">                 op</span><br></pre></td></tr></table></figure><p>特性1：使用柯里化定义<br>特性2：必须有初始值z<br>特性3：返回值是初始值z的类型，故不太使用</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; a</span><br><span class="line">res33: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">//使用foldLeft进行元素的求和，并且初值为0</span></span><br><span class="line">scala&gt; a.foldLeft(<span class="number">0</span>)((x,y) =&gt; x+y)</span><br><span class="line">res34: <span class="type">Int</span> = <span class="number">10</span></span><br><span class="line"><span class="comment">//使用通配符</span></span><br><span class="line">scala&gt; a.foldLeft(<span class="number">0</span>)(_+_)</span><br><span class="line">res35: <span class="type">Int</span> = <span class="number">10</span></span><br><span class="line"><span class="comment">//初值改变后的结果</span></span><br><span class="line">scala&gt; a.foldLeft(<span class="number">1</span>)(_+_)</span><br><span class="line">res36: <span class="type">Int</span> = <span class="number">11</span></span><br></pre></td></tr></table></figure><h1 id="惰性求值的类型：Stream-流"><a href="#惰性求值的类型：Stream-流" class="headerlink" title="惰性求值的类型：Stream 流"></a>惰性求值的类型：Stream 流</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用to或until来获取range类型</span></span><br><span class="line">scala&gt; <span class="number">1</span> to <span class="number">10</span> by <span class="number">2</span></span><br><span class="line">res41: scala.collection.immutable.<span class="type">Range</span> = inexact <span class="type">Range</span> <span class="number">1</span> to <span class="number">10</span> by <span class="number">2</span></span><br><span class="line"><span class="comment">//until是小于，取不到边界</span></span><br><span class="line">scala&gt; (<span class="number">1</span> until <span class="number">10</span>).toList</span><br><span class="line">res44: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line"><span class="comment">//to是小于等于，可以取边界</span></span><br><span class="line">scala&gt; (<span class="number">1</span> to <span class="number">10</span>).toList</span><br><span class="line">res45: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用操作符#::来连接定义一个Stream，其中Stream.empty是空流</span></span><br><span class="line">scala&gt; <span class="number">1</span> #:: <span class="number">2</span>#:: <span class="number">3</span>#:: <span class="type">Stream</span>.empty</span><br><span class="line">res46: scala.collection.immutable.<span class="type">Stream</span>[<span class="type">Int</span>] = <span class="type">Stream</span>(<span class="number">1</span>, ?)</span><br><span class="line"></span><br><span class="line"><span class="comment">//惰性求值的特性：由打印可知，只显示和判断第一个元素是什么，其他的用？表示</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> s = (<span class="number">1</span> to <span class="number">1000</span>).toStream</span><br><span class="line">s: scala.collection.immutable.<span class="type">Stream</span>[<span class="type">Int</span>] = <span class="type">Stream</span>(<span class="number">1</span>, ?)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取Stream的第一个元素</span></span><br><span class="line">scala&gt; s.head</span><br><span class="line">res48: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取Stream除首元素以外的元素，其返回结果仍然是Stream类型，所以仍然只显示(2, ?)</span></span><br><span class="line">scala&gt; s.tail</span><br><span class="line">res49: scala.collection.immutable.<span class="type">Stream</span>[<span class="type">Int</span>] = <span class="type">Stream</span>(<span class="number">2</span>, ?)</span><br><span class="line">scala&gt; s.tail.head</span><br><span class="line">res50: <span class="type">Int</span> = <span class="number">2</span></span><br></pre></td></tr></table></figure><h1 id="Scala中的tuple：元组"><a href="#Scala中的tuple：元组" class="headerlink" title="Scala中的tuple：元组"></a>Scala中的tuple：元组</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//元组的概念，和Python中的元组类似，可以放不用类型的变量</span></span><br><span class="line">scala&gt; (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">res51: (<span class="type">Int</span>, <span class="type">Int</span>) = (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有两个元素的元组叫pair，可以使用箭头的方式来定义</span></span><br><span class="line">scala&gt; <span class="number">1</span> -&gt; <span class="number">2</span></span><br><span class="line">res52: (<span class="type">Int</span>, <span class="type">Int</span>) = (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//scala自动识别元素类型</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> t = (<span class="number">1</span>,'a',<span class="string">"Tom"</span>,<span class="number">34.5</span>)</span><br><span class="line">t: (<span class="type">Int</span>, <span class="type">Char</span>, <span class="type">String</span>, <span class="type">Double</span>) = (<span class="number">1</span>,a,<span class="type">Tom</span>,<span class="number">34.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对于一个元组变量，下划线加数字表示第N个元素，t._1表示第一个元素</span></span><br><span class="line">scala&gt; t._1</span><br><span class="line">res54: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line"><span class="comment">//取元素时不能超出下标，否则报错</span></span><br><span class="line">scala&gt; t._5</span><br><span class="line">&lt;console&gt;:<span class="number">13</span>: error: value _5 is not a member of (<span class="type">Int</span>, <span class="type">Char</span>, <span class="type">String</span>, <span class="type">Double</span>)</span><br><span class="line">       t._5</span><br><span class="line">         ^</span><br></pre></td></tr></table></figure><p><strong>元组的用处：</strong><br>可以封装函数的返回值，在函数返回多个类型的变量时，可以包装起来一并返回</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面这个函数通过元组，一并返回输入参数List变量中所有元素的个数、求和、平方和</span></span><br><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">_3operate</span></span>(in:<span class="type">List</span>[<span class="type">Int</span>]):(<span class="type">Int</span>,<span class="type">Int</span>,<span class="type">Int</span>) =</span><br><span class="line">     | in.foldLeft((<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))((t,v) =&gt; (t._1+<span class="number">1</span>,t._2+v,t._3+v*v)</span><br><span class="line">     | )</span><br><span class="line">_3operate: (in: <span class="type">List</span>[<span class="type">Int</span>])(<span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Int</span>)</span><br><span class="line"><span class="comment">//调用该函数，可以返回三个值</span></span><br><span class="line">scala&gt; _3operate(a)</span><br><span class="line">res56: (<span class="type">Int</span>, <span class="type">Int</span>, <span class="type">Int</span>) = (<span class="number">4</span>,<span class="number">10</span>,<span class="number">30</span>)</span><br></pre></td></tr></table></figure><h1 id="Scala中的Map-lt-K-V-gt"><a href="#Scala中的Map-lt-K-V-gt" class="headerlink" title="Scala中的Map&lt;K,V&gt;"></a>Scala中的Map&lt;K,V&gt;</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用类似元组的箭头来定义一个键值对</span></span><br><span class="line">scala&gt; <span class="keyword">val</span> p = <span class="type">Map</span>(<span class="number">1</span> -&gt;  <span class="string">"Tom"</span>,<span class="number">9</span>-&gt;<span class="string">"Jack"</span>)</span><br><span class="line">p: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="type">Tom</span>, <span class="number">9</span> -&gt; <span class="type">Jack</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//按Key取值</span></span><br><span class="line">scala&gt; p(<span class="number">1</span>)</span><br><span class="line">res58: <span class="type">String</span> = <span class="type">Tom</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断指定Key是否在Map中</span></span><br><span class="line">scala&gt; p.contains(<span class="number">1</span>)</span><br><span class="line">res59: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回包含全部Key的Set集合</span></span><br><span class="line">scala&gt; p.keys</span><br><span class="line">res60: <span class="type">Iterable</span>[<span class="type">Int</span>] = <span class="type">Set</span>(<span class="number">1</span>, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回包含全部Value的Iterable类型</span></span><br><span class="line">scala&gt; p.values</span><br><span class="line">res61: <span class="type">Iterable</span>[<span class="type">String</span>] = <span class="type">MapLike</span>.<span class="type">DefaultValuesIterable</span>(<span class="type">Tom</span>, <span class="type">Jack</span>)</span><br></pre></td></tr></table></figure><p><strong>涉及的Map相关运算</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用+号 添加键值对，注意Map不支持混合类型的添加，否则会出错</span></span><br><span class="line">scala&gt; p + (<span class="string">"name"</span> -&gt; <span class="string">"Kim"</span>)</span><br><span class="line">&lt;console&gt;:<span class="number">13</span>: error: <span class="class"><span class="keyword">type</span> <span class="title">mismatch</span></span>;</span><br><span class="line"> found   : (<span class="type">String</span>, <span class="type">String</span>)</span><br><span class="line"> required: (<span class="type">Int</span>, ?)</span><br><span class="line">       p + (<span class="string">"name"</span> -&gt; <span class="string">"Kim"</span>)</span><br><span class="line">                   ^</span><br><span class="line"><span class="comment">//正确添加键值对，注意会按Key值覆写键值对，即Key冲突时丢弃原来的Value</span></span><br><span class="line"><span class="comment">//有冲突的添加</span></span><br><span class="line">scala&gt; p + (<span class="number">1</span> -&gt; <span class="string">"Kim"</span>)</span><br><span class="line">res63: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="type">Kim</span>, <span class="number">9</span> -&gt; <span class="type">Jack</span>)</span><br><span class="line"><span class="comment">//正常的添加</span></span><br><span class="line">scala&gt; p + (<span class="number">2</span> -&gt; <span class="string">"Kim"</span>)</span><br><span class="line">res65: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="type">Tom</span>, <span class="number">9</span> -&gt; <span class="type">Jack</span>, <span class="number">2</span> -&gt; <span class="type">Kim</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用-号来删除键值对，注意减的是Key值</span></span><br><span class="line">scala&gt; p - <span class="number">1</span></span><br><span class="line">res70: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">9</span> -&gt; <span class="type">Jack</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意添加或删减的结果不能直接通过= 赋值给自己，会报错</span></span><br><span class="line">scala&gt; p = p <span class="number">-9</span></span><br><span class="line">&lt;console&gt;:<span class="number">12</span>: error: reassignment to <span class="keyword">val</span></span><br><span class="line">       p = p <span class="number">-9</span></span><br><span class="line">         ^</span><br><span class="line"><span class="comment">//上述的添加和删除都是操作单个元素，下面使用包含键值对的List集合加上++运算符来完成添加拖个键值对</span></span><br><span class="line">scala&gt; p ++ <span class="type">List</span>(<span class="number">2</span>-&gt;<span class="string">"a"</span>,<span class="number">5</span>-&gt;<span class="string">"b"</span>)</span><br><span class="line">res72: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="type">Tom</span>, <span class="number">9</span> -&gt; <span class="type">Jack</span>, <span class="number">2</span> -&gt; a, <span class="number">5</span> -&gt; b)</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除多个键值对，注意删除只需要含Key值的List即可</span></span><br><span class="line">scala&gt; p -- <span class="type">List</span>(<span class="number">1</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">5</span>)</span><br><span class="line">res73: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以联合构成表达式</span></span><br><span class="line">scala&gt; p ++ <span class="type">List</span>(<span class="number">2</span>-&gt;<span class="string">"a"</span>,<span class="number">5</span>-&gt;<span class="string">"b"</span>) -- <span class="type">List</span>(<span class="number">2</span>,<span class="number">5</span>)</span><br><span class="line">res74: scala.collection.immutable.<span class="type">Map</span>[<span class="type">Int</span>,<span class="type">String</span>] = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="type">Tom</span>, <span class="number">9</span> -&gt; <span class="type">Jack</span>)</span><br></pre></td></tr></table></figure><h1 id="函数式编程示例：快速排序"><a href="#函数式编程示例：快速排序" class="headerlink" title="函数式编程示例：快速排序"></a>函数式编程示例：快速排序</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qSort</span></span>(a:<span class="type">List</span>[<span class="type">Int</span>]):<span class="type">List</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line"><span class="keyword">if</span>(a.length &lt; <span class="number">2</span>) a</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">qSort( a.filter( _ &lt; a.head )) ++ </span><br><span class="line">a.filter( _ == a.head ) ++ </span><br><span class="line">qSort( a.filter( _ &gt; a.head ))</span><br><span class="line"></span><br><span class="line">&#125;                                 <span class="comment">//&gt; qSort: (a: List[Int])List[Int]</span></span><br><span class="line"></span><br><span class="line">qSort(<span class="type">List</span>(<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">2</span>))      <span class="comment">//&gt; res0: List[Int] = List(1, 2, 2, 2, 3, 5, 5, 8)</span></span><br><span class="line">qSort(<span class="type">List</span>(<span class="number">9</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>))      <span class="comment">//&gt; res1: List[Int] = List(0, 1, 2, 3, 4, 5, 8, 9)</span></span><br></pre></td></tr></table></figure><p><strong>解释：</strong></p><blockquote><p>首先快排需要一个分割变量，这里直接用a.head即输入List的第一个元素来做分割<br>其次是归类，每次递归都要分出小于，大于和等于的元素<br>然后是合并，使用++操作符，把每次的元素拼接起来，即每次调整后的结果<br>最后是判断递归结束条件：如果当前作为输入的分割后的List元素不足2，那么表示无序调整，排序结束</p></blockquote><p><strong>注意：</strong></p><blockquote><p>这里外层递归中含有两个递归，外层递归即函数的返回的是三部分之和，这并不是尾递归<br>这个例子是综合了函数式编程、高阶函数、递归等Scala编程思想的体现。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spark学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scala </tag>
            
            <tag> Collection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scala的基础概念</title>
      <link href="/article/bd82.html"/>
      <url>/article/bd82.html</url>
      
        <content type="html"><![CDATA[<h2 id="Scala语言的特性"><a href="#Scala语言的特性" class="headerlink" title="Scala语言的特性"></a>Scala语言的特性</h2><blockquote><p><strong>Scalable语言</strong><br>Scala是一门可伸缩的scalable语言，既可以写复杂的服务器端程序，也可以写简单的脚本<br><strong>纯正的面向对象</strong><br>所有的概念最终都会被时限为纯正的对象</p></blockquote><a id="more"></a><blockquote><p><strong>函数式编程的特性</strong><br>函数式程序思想！！！<br><strong>无缝的Java互操作</strong><br>构建于Jvm之上，Java的包可以在Scala中使用，huo1Scala写好的程序给Java调用<br><strong>编程思路灵活</strong><br>既可以面向对象的思想，也可以函数式编程的思想</p></blockquote><h2 id="Scala之父：Martin-Odersky"><a href="#Scala之父：Martin-Odersky" class="headerlink" title="Scala之父：Martin Odersky"></a>Scala之父：Martin Odersky</h2><blockquote><p><strong>导读</strong>：<br>函数式变成的概念和思想<br>Scala的开发环境搭建<br>Scala语言的基础<br>Scala中的类型和求值策略<br>Scala中函数的概念<br>Immutable Collections如何用函数式思想实现数据结构和其上的一些操作</p></blockquote><h2 id="函数式编程思想"><a href="#函数式编程思想" class="headerlink" title="函数式编程思想"></a>函数式编程思想</h2><h3 id="只用纯函数编程"><a href="#只用纯函数编程" class="headerlink" title="只用纯函数编程"></a>只用纯函数编程</h3><blockquote><p><strong>定义</strong>：函数式编程是一种编程范式，构建计算机程序和结构的方法和风格，把计算当做数学函数求值的过程，并且避免了改变状态和可变的数据</p></blockquote><h3 id="纯函数特点-Pure-Function"><a href="#纯函数特点-Pure-Function" class="headerlink" title="纯函数特点 Pure Function"></a>纯函数特点 Pure Function</h3><blockquote><p>纯函数，没有副作用的函数</p></blockquote><h4 id="没有副作用：状态的变化"><a href="#没有副作用：状态的变化" class="headerlink" title="没有副作用：状态的变化"></a>没有副作用：状态的变化</h4><p>例如：调用 def Add(y:Int) = x + y<br>其结果为xy之和，并且调用之后没有引起x值的变换，没有副作用<br>所以，Add函数没有副作用</p><h4 id="引用透明性"><a href="#引用透明性" class="headerlink" title="引用透明性"></a>引用透明性</h4><p>对于上述Add函数，对于同一输入y，返回结果均相同<br>所以，Add具有引用透明性</p><h5 id="如何确保引用透明"><a href="#如何确保引用透明" class="headerlink" title="如何确保引用透明"></a>如何确保引用透明</h5><blockquote><p>不变性Immutablity：任何的状态和值都是不变的，才能获得引用透明<br>函数与变量，对象类是同一级的，即函数中可以定义函数，有变量的地方都可以使用函数，都是等同的</p></blockquote><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><blockquote><p>函数作为一个函数的输入或另一个函数的输出</p></blockquote><h4 id="闭包-closure"><a href="#闭包-closure" class="headerlink" title="闭包 closure"></a>闭包 closure</h4><h4 id="表达式求值"><a href="#表达式求值" class="headerlink" title="表达式求值"></a>表达式求值</h4><p>函数式编程中，一切都是表达式，表达式求值策略：</p><blockquote><p>严格求值：call by value<br>非严格求值：call by name</p></blockquote><h4 id="惰性求值"><a href="#惰性求值" class="headerlink" title="惰性求值"></a>惰性求值</h4><blockquote><p>定义表达式时不会立即求值，只在第一次调用时才求值</p></blockquote><h4 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h4><p>函数式编程中没有循环语句，全部的循环用递归实现<br>调优递归：尾递归</p><h2 id="函数式编程的优点"><a href="#函数式编程的优点" class="headerlink" title="函数式编程的优点"></a>函数式编程的优点</h2><p>Lisp是第一种函数式编程语言</p><ol><li>编程代码量少</li><li>当构造完含数之后，对于相同输入，输出相同，便于调试</li><li>非常适用于并行编程，没有副作用，具备引用透明性，在n个节点运算结果是相同的</li><li>传统语言多核编程非常复杂</li></ol><h2 id="Scala环境的搭建"><a href="#Scala环境的搭建" class="headerlink" title="Scala环境的搭建"></a>Scala环境的搭建</h2><p>安装Jdk6以上，并安装Scala包</p><h2 id="Scala基础语法"><a href="#Scala基础语法" class="headerlink" title="Scala基础语法"></a>Scala基础语法</h2><h3 id="变量修饰符"><a href="#变量修饰符" class="headerlink" title="变量修饰符"></a>变量修饰符</h3><ol><li><strong>val</strong> 定义 immutable variable     常量</li><li><strong>var</strong> 定义 mutable variable       变量</li><li>lazy <strong>val</strong>                           惰性求值的常量</li></ol><p>定义时不用显示的说明类型，scala会自己进行变量推导</p><blockquote><p>前两种定义，在定义时表达式就会立即求值<br>lazy val<br>在REPL中，scala会给没有变量名的变量自动取值resN，可以直接引用已有的resN<br>注意：<br>    scala中不允许常量定义后被直接改变，而变量var可以<br>    val x = 10<br>    x = 20      //会报错reassignment to val<br>    val x = 20  //正确的重新赋值，需要使用val重新定义<br>    对于lazy val，注意没有lazy var，一般是定义惰性求值的表达式<br>    val l = 常量或变量组成的表达式</p></blockquote><h2 id="Scala的类体系"><a href="#Scala的类体系" class="headerlink" title="Scala的类体系"></a>Scala的类体系</h2><blockquote><p>Any     所有类的父类<br>    AnyVal  值类型<br>        NumericTypes    数值类型 Byte，Shot，Int，Long，Float，Double<br>        Boolean         布尔类型<br>        Char            字符类型<br>        Unit            空类型，相当于Java的void<br>AnyRef  所有引用类型的父类<br>        All java.* ref types    所有Java的引用类都是其子类<br>        All scala.* ref types   所有自定义的scala的类都是其子类<br>    Null 所有引用类型的最后一个子类<br>Nothing 所有类型的最后一个子类（既是AnyVal又是AnyRef的子类）</p></blockquote><ol><li>NumericTypes<br>对于数值类型：低精度可以赋值给高精度，反之不行，数据会缺失：报类型不匹配错误</li><li>Unit<br>往往作为函数的返回值出现，表明函数有副作用</li><li>Null<br>表示一个引用类型的值为空。通常不使用</li><li>Nothing<br>对于函数而言，如果返回值为nothing，那么则表示函数异常<br>scala&gt; def foo() = throw new Exception(“1111”)<br>foo: ()Nothing</li><li>String<br>新特性 - 字符串插值(interpolation)<br>scala&gt; val name=”Jack”<br>name: String = Jack<br>scala&gt; s”my name is $name”      //使用字符串插值<br>res11: String = my name is Jack</li></ol><h2 id="代码块Block"><a href="#代码块Block" class="headerlink" title="代码块Block"></a>代码块Block</h2><p>代码块用于组织多个表达式：{exp1；exp2}<br>多个表达式在一行2时需要分号分割，代码块本事也是一个表达式<br>最后的求值，是最后一个表达式</p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>定义函数的方式：<br>    def functionName（param：paramType）：returnType  = {<br>        //body  expressions<br>    }<br>示例：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">worksheetA</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 完整形式</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hello</span></span>(name:<span class="type">String</span>):<span class="type">String</span> = &#123;</span><br><span class="line"><span class="string">s"Hello,<span class="subst">$name</span>"</span></span><br><span class="line">&#125;                                 <span class="comment">//&gt; Hello: (name: String)String</span></span><br><span class="line"><span class="type">Hello</span>(<span class="string">"Jack"</span>)                     <span class="comment">//&gt; res0: String = Hello,Jack</span></span><br><span class="line"><span class="comment">// 省略返回值，自动推断类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Hello2</span></span>(name:<span class="type">String</span>) = &#123;</span><br><span class="line"><span class="string">s"Hello,<span class="subst">$name</span>"</span></span><br><span class="line">&#125;                                 <span class="comment">//&gt; Hello2: (name: String)String</span></span><br><span class="line"><span class="type">Hello2</span>(<span class="string">"Tom"</span>)                     <span class="comment">//&gt; res1: String = Hello,Tom</span></span><br><span class="line"><span class="comment">// 单语句的函数体</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x:<span class="type">Int</span>,y:<span class="type">Int</span>) = &#123;</span><br><span class="line">x + y</span><br><span class="line">&#125;                                 <span class="comment">//&gt; add: (x: Int, y: Int)Int</span></span><br><span class="line"><span class="comment">// 可以省略大扩号</span></span><br><span class="line"><span class="comment">//def add(x:Int,y:Int) = x + y</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">2</span>)                          <span class="comment">//&gt; res2: Int = 3</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="scala中的if"><a href="#scala中的if" class="headerlink" title="scala中的if"></a>scala中的if</h2><p>if是表达式，而不是语句<br>if(逻辑表达式) valA else valB<br>        val a = 1                         //&gt; a  : Int = 1<br>        if(a!=1) “not none”               //&gt; res3: Any = ()返回空<br>        if(a!=1) “not none” else a        //&gt; res4: Any = 1</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="scala中的for-comprehension"><a href="#scala中的for-comprehension" class="headerlink" title="scala中的for comprehension"></a>scala中的for comprehension</h2><p>用于实现循环的一种推导式，本身是由map() reduce()组合实现的<br>是scala语法糖(thin text sugar)的一种</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line">    x &lt;- xs</span><br><span class="line">    y = x + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>( y &gt; <span class="number">0</span>)</span><br><span class="line">&#125;<span class="keyword">yield</span> y</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">worksheetA</span> </span>&#123;</span><br><span class="line"><span class="comment">//初始化一个List</span></span><br><span class="line"><span class="keyword">val</span> list = <span class="type">List</span>(<span class="string">"alice"</span>,<span class="string">"bob"</span>,<span class="string">"cathy"</span>)</span><br><span class="line"><span class="keyword">for</span> (</span><br><span class="line"><span class="comment">//遍历list每一个元素给s，generator</span></span><br><span class="line">s &lt;- list</span><br><span class="line">)println(s)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">s &lt;- list</span><br><span class="line"><span class="comment">//串长度大于三才被打印</span></span><br><span class="line"><span class="keyword">if</span>( s.length &gt; <span class="number">3</span>)</span><br><span class="line">&#125;println(s)</span><br><span class="line"><span class="keyword">val</span> res_for = <span class="keyword">for</span>&#123;</span><br><span class="line">s &lt;- list</span><br><span class="line"><span class="comment">//变量绑定,variable binding</span></span><br><span class="line">s1 = s.toUpperCase()</span><br><span class="line"><span class="keyword">if</span> ( s1 != <span class="string">""</span>)</span><br><span class="line"><span class="comment">//yeild导出的意思，如果每次s1不空，则生成新的collection</span></span><br><span class="line">&#125;<span class="keyword">yield</span> (s1)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="scala中的try"><a href="#scala中的try" class="headerlink" title="scala中的try"></a>scala中的try</h2><p>try也是一个表达式，返回一个值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="type">Integer</span>.praseInt(<span class="string">"dog"</span>)</span><br><span class="line">&#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">    <span class="keyword">case</span> _ =&gt; <span class="number">0</span>  <span class="comment">//下划线是通配符，统配所有异常</span></span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    print(<span class="string">"总是会打印"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="scala中的macth"><a href="#scala中的macth" class="headerlink" title="scala中的macth"></a>scala中的macth</h2><p>类似switch，但也是一个表达式，返回相应的值，主要用在 pattern match</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> expression = <span class="number">1</span>                  <span class="comment">//&gt; expression  : Int = 1</span></span><br><span class="line">expression <span class="keyword">match</span>&#123;</span><br><span class="line">       <span class="keyword">case</span> <span class="number">1</span> =&gt; <span class="string">"dog"</span></span><br><span class="line">       <span class="keyword">case</span> <span class="number">2</span> =&gt; <span class="string">"cat"</span></span><br><span class="line">       <span class="comment">//类似switch的default</span></span><br><span class="line">       <span class="keyword">case</span> _ =&gt; <span class="string">"others"</span></span><br><span class="line">   &#125;                                   <span class="comment">//&gt; res5: String = dog</span></span><br></pre></td></tr></table></figure><h2 id="Scala的求值策略"><a href="#Scala的求值策略" class="headerlink" title="Scala的求值策略"></a>Scala的求值策略</h2><p>scala中所有运算都是基于表达式的，求值会有不同策略</p><ol><li>call by value<blockquote><p>对函数实参求值，仅求一次，求得的值直接替换函数中的形式参数</p></blockquote></li><li>call by value<blockquote><p>不会对函数实参进行表达式求值，直接把表达式传入函数体内，替换表达式的形参，然后在函数内每次使用到此形参时会被求值</p></blockquote></li></ol><h3 id="scala通常使用call-by-value"><a href="#scala通常使用call-by-value" class="headerlink" title="scala通常使用call by value"></a>scala通常使用call by value</h3><blockquote><p>def foo(x: Int) = x  //call by Value<br>def foo(x: =&gt; Int) = x //call by Name</p></blockquote><p>下面是两种求值策略在不同情况下的运行机制：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>,y: <span class="type">Int</span>) = x * x      <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: =&gt;<span class="type">Int</span>,y: =&gt;<span class="type">Int</span>) = x * x</span><br><span class="line">add(<span class="number">3</span>+<span class="number">4</span>,<span class="number">7</span>)                          add(<span class="number">3</span>+<span class="number">4</span>,<span class="number">7</span>) </span><br><span class="line">=&gt;add(<span class="number">7</span>,<span class="number">7</span>)                          =&gt;(<span class="number">3</span>+<span class="number">4</span>)*(<span class="number">3</span>+<span class="number">4</span>)</span><br><span class="line">=&gt;<span class="number">7</span>*<span class="number">7</span>                               =&gt;<span class="number">7</span>*(<span class="number">3</span>+<span class="number">4</span>)</span><br><span class="line">=&gt;<span class="number">49</span>                                =&gt;<span class="number">7</span>*<span class="number">7</span></span><br><span class="line">                                    =&gt;<span class="number">49</span></span><br><span class="line">                                </span><br><span class="line">add(<span class="number">7</span>,<span class="number">3</span>+<span class="number">4</span>)                          add(<span class="number">7</span>,<span class="number">3</span>+<span class="number">4</span>)</span><br><span class="line">=&gt;add(<span class="number">7</span>,<span class="number">7</span>)                          =&gt;<span class="number">7</span>*<span class="number">7</span></span><br><span class="line">=&gt;<span class="number">7</span>*<span class="number">7</span>                               =&gt;<span class="number">49</span></span><br><span class="line">=&gt;<span class="number">49</span></span><br></pre></td></tr></table></figure><p>注意上述运行机制的区别</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">bar</span></span>(x:<span class="type">Int</span>, y: =&gt; <span class="type">Int</span>) : <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">bar: (x: <span class="type">Int</span>, y: =&gt; <span class="type">Int</span>)<span class="type">Int</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>():<span class="type">Int</span> = loop</span><br><span class="line">loop: ()<span class="type">Int</span></span><br><span class="line"></span><br><span class="line">scala&gt; bar(<span class="number">1</span>,loop) </span><br><span class="line"><span class="comment">//loop函数位于的参数的定义方式是y: =&gt; Int，即call by name，不进行求值，会带到函数体内并且使用时</span></span><br><span class="line">才求值，此处，loop没有机会执行。</span><br><span class="line">res0: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">scala&gt; bar(loop,<span class="number">1</span>)</span><br><span class="line"><span class="comment">//loop函数位于的参数的定义方式是y: Int，即call by value，会直接将表达式求值并代替形参，此处loop</span></span><br><span class="line">首先被执行求值，故而陷入死循环。</span><br><span class="line">输出:死循环</span><br></pre></td></tr></table></figure><p>进行函数设计和调用时，两种差异要搞清楚</p><h2 id="Scala中的函数"><a href="#Scala中的函数" class="headerlink" title="Scala中的函数"></a>Scala中的函数</h2><ol><li>支持把函数作为实参传递给另外一个函数</li><li>支持把函数作为返回值</li><li>支持把函数赋值给变量</li><li>支持把函数存储在数据结构里</li></ol><p>即，在scala中，函数跟普通变量一样使用，且具有函数的相关类型</p><h3 id="函数的类型"><a href="#函数的类型" class="headerlink" title="函数的类型"></a>函数的类型</h3><p>在scala中，函数类型的格式为 A =&gt; B,表示一个：接受参数类型为A的、并返回类型B的函数<br>eg：<br>    Int =&gt; String 是把整型映射为字符串的函数类型</p><h3 id="高阶函数-1"><a href="#高阶函数-1" class="headerlink" title="高阶函数"></a>高阶函数</h3><ol><li>接受的参数为函数<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funcName</span></span>( f: (<span class="type">Int</span>, <span class="type">Int</span>) =&gt; <span class="type">Int</span>) = &#123;</span><br><span class="line">    f(<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>参数：f<br>类型：Int =&gt; Int<br>返回：Int类型</li><li>返回值为一个函数<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funcName</span></span>() = ( name: <span class="type">String</span>) =&gt; &#123;<span class="string">"hello "</span>+name&#125;</span><br></pre></td></tr></table></figure>参数：name<br>类型：String =&gt; String<br>返回：String类型<br>注意上述叫做：匿名函数 - 函数常量 - 函数的文字量（相对于def funcName 叫函数变量）</li><li>兼具上述情况</li></ol><h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>匿名函数没有函数名<br>定义格式： （形参列表） =&gt; { 函数体 }</p><ul><li>(x: Int) =&gt; { x * x }</li><li>(x: Int,y: Int) =&gt; { x + y }</li><li>var add = (x: Int,y: Int) =&gt; { x + y }</li><li>def func() = (x: Int,y: Int) =&gt; { x + y }<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; (x: <span class="type">Int</span>,y: <span class="type">Int</span>) =&gt; &#123; x + y &#125;</span><br><span class="line">res0: (<span class="type">Int</span>, <span class="type">Int</span>) =&gt; <span class="type">Int</span> = $$<span class="type">Lambda</span>$<span class="number">1016</span>/<span class="number">2093139281</span>@<span class="number">69</span>feb4d9</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">var</span> add = (x: <span class="type">Int</span>,y: <span class="type">Int</span>) =&gt; &#123; x + y &#125;</span><br><span class="line">add: (<span class="type">Int</span>, <span class="type">Int</span>) =&gt; <span class="type">Int</span> = $$<span class="type">Lambda</span>$<span class="number">1025</span>/<span class="number">1152113439</span>@<span class="number">62108</span>cd3</span><br><span class="line"></span><br><span class="line">scala&gt; add(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">res1: <span class="type">Int</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="function"><span class="keyword">def</span> <span class="title">funcName</span></span>() = ( name: <span class="type">String</span>) =&gt; &#123;<span class="string">"hello "</span>+name&#125;</span><br><span class="line">funcName: ()<span class="type">String</span> =&gt; <span class="type">String</span></span><br><span class="line"></span><br><span class="line">scala&gt; funcName()(<span class="string">"Jack"</span>)</span><br><span class="line">res4: <span class="type">String</span> = hello <span class="type">Jack</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h3><p>Scala中的重要的技术，具有多个参数的函数转化成一个函数列，每个函数只有单一参数</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>,y: <span class="type">Int</span>) = &#123; x + y &#125;  <span class="comment">//普通函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>)(y: <span class="type">Int</span>) = &#123; x + y &#125; <span class="comment">//柯里化函数定义，多个参数单一化，串接起来</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">curriedAdd</span></span>(a: <span class="type">Int</span>)(b: <span class="type">Int</span>) = a + b</span><br><span class="line">curriedAdd(<span class="number">2</span>)(<span class="number">2</span>) <span class="comment">//4</span></span><br><span class="line"><span class="keyword">val</span> add = curriedAdd(<span class="number">1</span>)_    <span class="comment">//Int =&gt; Int</span></span><br><span class="line">add(<span class="number">2</span>)  <span class="comment">//3</span></span><br></pre></td></tr></table></figure><p>解释：curriedAdd(1)_，下划线统配之后的全部参数列表，此处a=1固定，只有b是可变值，下划线通配变量b<br>add(2),传入curriedAdd后a=1，b=2</p><p>利用柯里化技术，通过原有通用函数构造一些新的函数</p><h2 id="Scala中的递归"><a href="#Scala中的递归" class="headerlink" title="Scala中的递归"></a>Scala中的递归</h2><p>scala里计算n的阶乘</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial（n</span></span>: <span class="type">Int</span>): <span class="type">Int</span> = </span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">0</span>) <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> n * factorial(n - <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>递归优化：变成尾递归，尾递归会复写当前栈，不会导致堆栈溢出<br>尾递归优化：用￥annotation.tailrec显示指明编译时进行尾递归优化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@annotation.tailrec</span><br><span class="line">def factorial（n: Int,m: Int): Int &#x3D; </span><br><span class="line">    if(n &lt;&#x3D; 0) m</span><br><span class="line">    else factorial(n - 1, m * n)</span><br><span class="line">factorial(5,1)</span><br></pre></td></tr></table></figure><p>上述引入m，m保留当前运算之前的历史阶乘结果<br>如果退出，则就是递归的值，如果不退出，那么把当前结果传入下一次，这样不需要开辟栈保留计算结果，每次只需m变量记录结果<br>示例：求f(x)在(a,b)上的和</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(f: <span class="type">Int</span> =&gt; <span class="type">Int</span>)(a: <span class="type">Int</span>)(b: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@annotation</span>.tailrec</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>(n: <span class="type">Int</span>, acc: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line"><span class="comment">//函数中可定义其他函数</span></span><br><span class="line"><span class="comment">//n:循环变量</span></span><br><span class="line"><span class="comment">//acc:累积和</span></span><br><span class="line"><span class="keyword">if</span> (n &gt; b) &#123;</span><br><span class="line">println(<span class="string">s"n=<span class="subst">$&#123;n&#125;</span>, acc=<span class="subst">$&#123;acc&#125;</span>"</span>)</span><br><span class="line">acc</span><br><span class="line"><span class="comment">//if表达式返回acc的值</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">println(<span class="string">s"n=<span class="subst">$&#123;n&#125;</span>, acc=<span class="subst">$&#123;acc&#125;</span>"</span>)</span><br><span class="line">loop(n + <span class="number">1</span>, acc + f(n))</span><br><span class="line"><span class="comment">//else表达式返回loop</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">loop(a, <span class="number">0</span>)</span><br><span class="line">&#125;                               <span class="comment">//&gt; sum: (f: Int =&gt; Int)(a: Int)(b: Int)Int</span></span><br><span class="line"><span class="comment">//函数y=f(x)</span></span><br><span class="line">sum(x =&gt; x)(<span class="number">1</span>)(<span class="number">5</span>)               <span class="comment">//&gt; n=1, acc=0</span></span><br><span class="line">                                  <span class="comment">//| n=2, acc=1</span></span><br><span class="line">                                  <span class="comment">//| n=3, acc=3</span></span><br><span class="line">                                  <span class="comment">//| n=4, acc=6</span></span><br><span class="line">                                  <span class="comment">//| n=5, acc=10</span></span><br><span class="line">                                  <span class="comment">//| n=6, acc=15</span></span><br><span class="line">                                  <span class="comment">//| res0: Int = 15</span></span><br><span class="line">                                                </span><br><span class="line">                                                </span><br><span class="line">  sum(x =&gt; x * x)(<span class="number">1</span>)(<span class="number">5</span>)           <span class="comment">//&gt; n=1, acc=0</span></span><br><span class="line">                                  <span class="comment">//| n=2, acc=1</span></span><br><span class="line">                                  <span class="comment">//| n=3, acc=5</span></span><br><span class="line">                                  <span class="comment">//| n=4, acc=14</span></span><br><span class="line">                                  <span class="comment">//| n=5, acc=30</span></span><br><span class="line">                                  <span class="comment">//| n=6, acc=55</span></span><br><span class="line">                                  <span class="comment">//| res1: Int = 55</span></span><br><span class="line">                                                </span><br><span class="line">                                                </span><br><span class="line">                                                </span><br><span class="line">  sum(x =&gt; x * x * x)(<span class="number">1</span>)(<span class="number">5</span>)       <span class="comment">//&gt; n=1, acc=0</span></span><br><span class="line">                                  <span class="comment">//| n=2, acc=1</span></span><br><span class="line">                                  <span class="comment">//| n=3, acc=9</span></span><br><span class="line">                                  <span class="comment">//| n=4, acc=36</span></span><br><span class="line">                                  <span class="comment">//| n=5, acc=100</span></span><br><span class="line">                                  <span class="comment">//| n=6, acc=225</span></span><br><span class="line">                                  <span class="comment">//| res2: Int = 225</span></span><br><span class="line">   </span><br><span class="line">  <span class="comment">//利用柯里化技术，通过原有通用函数构造一些新的函数，简化代码</span></span><br><span class="line">                                                </span><br><span class="line">  <span class="keyword">val</span> sumSquare = sum(x =&gt; x * x)_              </span><br><span class="line">  <span class="comment">//&gt; sumSquare  : Int =&gt; (Int =&gt; Int) = sumfunc$$$Lambda$13/2054798982@34ce8af7</span></span><br><span class="line"> </span><br><span class="line">sumSquare(<span class="number">1</span>)(<span class="number">5</span>)                 <span class="comment">//&gt; n=1, acc=0</span></span><br><span class="line">                                  <span class="comment">//| n=2, acc=1</span></span><br><span class="line">                                  <span class="comment">//| n=3, acc=5</span></span><br><span class="line">                                  <span class="comment">//| n=4, acc=14</span></span><br><span class="line">                                  <span class="comment">//| n=5, acc=30</span></span><br><span class="line">                                  <span class="comment">//| n=6, acc=55</span></span><br><span class="line">                                  <span class="comment">//| res3: Int = 55</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spark学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scala </tag>
            
            <tag> 概述 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的函数式编程</title>
      <link href="/article/4e6b.html"/>
      <url>/article/4e6b.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a><strong>匿名函数</strong></h4><pre><code>特点：    定义函数时不需要定义函数名实现：    借助 lambda 关键字    lambda parameter_list: expression    注意：expression只能包含表达式！不能包含语句！示例：    一般函数：        def add(x, y):        return x + y    上述add函数的匿名形式：(匿名函数 或 叫做Lambda表达式)        lambda x,y: x+y匿名函数的调用：    因为没有名字，所以需要赋值给变量，然后调用    f = lambda x,y: x+y    print(f(1,2)) #输出 3</code></pre><h4 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a><strong>三元表达式</strong></h4><pre><code>地位：    表达式版本的if else 语句实现：    Java的形式  x &gt; y ? 1 : 1    Python的三元表达式    [条件为真时返回的结果] if [条件判断] else [条件为假时的返回结果]示例：    x = 1    y = 2    print( True if x &gt; y else False) #输出 False</code></pre><h4 id="class-map-func-iterables"><a href="#class-map-func-iterables" class="headerlink" title="class map(func,*iterables)"></a><strong>class map(func,*iterables)</strong></h4><pre><code>使用场景    对序列中的全部元素执行相同的操作应用：    求列表中每个数字的平方示例：    list_x = [1,2,3,4,5,6]    def func(x):        return x * x    print(map(func, list_x))        #输出 &lt;map object at 0x0000000000A5D7F0&gt;    print(list(map(func, list_x)))      #输出 [1, 4, 9, 16, 25, 36]注意：    map会吧集合中的每个元素都传入到第一个参数，func中去    即按照一定的规则，对一族元素进行映射，规则就是func中的逻辑map+lambda：注意：    map(func,*iterables)结合Lambda表达式    直接替换掉参数func    注意第二个参数 *iterables，带星号，表示可变参数    如果func参数有多个，第二个参数位置可以传入多个list示例：    完成返回平方的功能：    print( list( map( lambda x: x*x, [1,2,3,4,5] ) ) )    #输出 [1, 4, 9, 16, 25]    Lambda表达式有两个参数    print( list( map( lambda x,y: x*y, [1,2,3,4,5],[1,2,3,4,5] ) ) )    #输出[1, 4, 9, 16, 25]    注意多个参数时会一一对照，多余会丢弃    print( list( map( lambda x,y: x*y, [1,2,3,4,5],[1] ) ) )    #输出[1]    上述输出只有一个元素，因为输入的两个参数只有第一个元素满足运行条件</code></pre><h4 id="def-reduce"><a href="#def-reduce" class="headerlink" title="def reduce"></a><strong>def reduce</strong></h4><pre><code>注意：    map类在全局命名空间，不需要引入模块，reduce函数需要引入functools    def reduce(function,sequence,initial=None)示例：    from functools import reduce    list_x = [1,2,3,4]        #完成求和    print( reduce( lambda x,y:x+y, list_x ) )    #输出 10 运算过程：    #1   2   3   4 ...    #    3   3   4 ...    #        6   4 ...    #            10...应用场景：    连续规约计算，从前向后对数据进行两两规约计算带initial参数：    print( reduce( lambda x,y:x+y, list_x, 10 ) )    #输出 10 运算过程：    #10  1   2   3   4 ...    #    11  2   3   4 ...    #        13  3   4 ...    #            16  4 ...    #                20扩展：    map/reduce 映射+规约，进行并行计算（大数据处理）</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="class-filter-func-or-None-iterables"><a href="#class-filter-func-or-None-iterables" class="headerlink" title="class filter(func or None, iterables)"></a><strong>class filter(func or None, iterables)</strong></h4><pre><code>注意：    由参数可知，只能对一个序列进行处理，参数func仍然可以被Lambda表达式替换    另：第一个参数必须可以返回True/False 或者代表True/False的值    filter依靠TF来判断是否要剔除，返回false表示保留示例：    print( filter( lambda x:False if x == 0 else True, [0,0,1,2,3,0] ))    #输出 &lt;filter object at 0x000000000111D828&gt;    print( list( filter( lambda x:False if x == 0 else True, [0,0,1,2,3,0] )))    #输出 [1, 2, 3]对比：    命令式编程：依靠def，if else，for/while等等    函数式编程：依靠map，reduce，filter + Lambda（三大函数 +　算子）    解释：        map,reduce近似循环        filter近似判断        Lambda近似函数    上述集合使用，可以完成流程控制注意：    Python只是支持部分函数式编程的特性，本身并不是函数式编程语言</code></pre><h4 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a><strong>装饰器</strong></h4><pre><code>地位：    非常有用、常用，是一种设计模式，类似Java的注解示例：    对所有函数追加打印当前时间的功能代码：    import time    def func1():        print(time.time())        #输出 1509550613.9346058 Unix时间戳        print(&apos;This is a function&apos;)    func1()追加修改原则：    开闭原则：对修改是封闭的，对扩展是开放的，如果需要打印时间，会迫使修改函数内部进一步：    使用函数式编程思想的封装,没有违反开闭原则    def func2():        print(&apos;This is a function&apos;)             def print_time(func):        print(time.time())          func()    print_time(func2)    上述缺点：打印时间并没有和原函数绑定再进一步：    使用装饰器完成上述功能    装饰器的基本结构：        def decorator():            def wrapper():                pass#装饰器的逻辑            return wrapper    示例：        import time        def func1():            print(&apos;This is a function&apos;)        #构造装饰器        def decorator(func):            def wrapper():                print(time.time())                func()            return wrapper        decorator(func1)() 完成调用    解释：        真正业务逻辑在wrapper内    缺点：        仍然没有将打印时间和原始函数绑定起来再进一步：    使用装饰器语法糖，使用@符号    代码：        import time        #构造装饰器        def decorator(func):            def wrapper():                print(time.time())                func()            return wrapper        @decorator        def func1():            print(&apos;This is a function&apos;)        func1() #完成调用，而且没有改变原有调用逻辑评价：    这才是完整的有意义的装饰器的使用方法，只需要在原有函数定义上添加    @decorator就会执行附加操作，体现了AOP面向切面编程</code></pre><h4 id="对带参数的原函数添加装饰器"><a href="#对带参数的原函数添加装饰器" class="headerlink" title="对带参数的原函数添加装饰器"></a><strong>对带参数的原函数添加装饰器</strong></h4><pre><code>示例：    import time    #构造装饰器    def decorator(funcname):        def wrapper(*fc):         #此处的参数，应该和被修饰函数的参数个数相对于，        #但是为了通用性，应该使用*params可变参数形式            print(time.time())            funcname(*fc)        return wrapper    @decorator     def func1(f_param):        print(&apos;This is &apos;,f_param)    @decorator     def func2(param1,param2):        print(&apos;This is &apos;,param1,param2)    func1(&apos;Tom&apos;)    func2(&apos;Tom&apos;,&apos;Jack&apos;)    上述成功完成了对不同参数的函数进行添加装饰器进一步优化适应关键字参数：    import time    #构造装饰器    def decorator(funcname):        def wrapper(*fc,**kw): #参数**kw适用于关键字参数            print(time.time())            funcname(*fc,**kw)        return wrapper    @decorator    def func2(param1,**param2):        print(&apos;This is &apos;,param1,param2)    func2(&apos;Tom&apos;,a = &apos;1&apos;,b = &apos;2&apos;) #正确适应了关键字参数的函数关键字参数，回顾：    对于含有关键字参数的函数         def func2(param1,**param2):            print(&apos;This is &apos;,param1,param2)        func2(&apos;Tom&apos;,a = &apos;1&apos;,b = &apos;2&apos;)        输出 This is  Tom {&apos;b&apos;: &apos;2&apos;, &apos;a&apos;: &apos;1&apos;}综上：    此时的装饰器：    def decorator(funcname):        def wrapper(*fc,**kw):              print(time.time())            funcname(*fc,**kw)        return wrapper    在待装饰函数具有多个可变参数，或者包含关键字参数的情况均可使用装饰器小结：    装饰器的思想：对封装的单元追加行为，保证原有单元的稳定性，    不破坏单元内的代码，遵循开闭原则，更加体现了装饰器内代码的复用应用场景：    flask内，添加@api.route可以使函数变为控制器        @api.route(&apos;/get&apos;,methods=[&apos;GET&apos;])        def test_http():            p = request.agrs.get(&apos;name&apos;)            return p,200    添加多个装饰器，追加不同的操作        @api.route(&apos;/get&apos;,methods=[&apos;GET&apos;])        @auth.login_required        def get_money():            p = request.agrs.get(&apos;psw&apos;)            r = generate_hash(p)            return &apos;user&apos;,200</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的闭包</title>
      <link href="/article/c301.html"/>
      <url>/article/c301.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="地位："><a href="#地位：" class="headerlink" title="地位："></a><strong>地位：</strong></h4><pre><code>闭包 和函数有关系</code></pre><h4 id="解释："><a href="#解释：" class="headerlink" title="解释："></a><strong>解释：</strong></h4><pre><code>python中一切皆对象:函数可以赋值给变量，例如 a = def func()， 可以把函数当做参数，传入一个函数可以把函数当做一个函数的返回结果</code></pre><h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a><strong>示例：</strong></h4><pre><code>Python中允许的正确的调用方法：    def curve_pre():        def curve():            print(&apos;This is a funcion&apos;)        return curve        #函数作为返回值    func = curve_pre()    func()    #产生调用，输出 This is a funcion</code></pre><h4 id="将上述示例扩展为闭包："><a href="#将上述示例扩展为闭包：" class="headerlink" title="将上述示例扩展为闭包："></a><strong>将上述示例扩展为闭包：</strong></h4><pre><code>注意：    闭包内的变量与闭包外的变量没有关系示例：    def curve_pre():        a = 25              #a在curve外部        def curve(x):            return a*x*x        return curve        #函数curve作为返回值    func = curve_pre()    print(func(2))          #打印100外部变量对一般函数的影响：    a = 10    def f(i):        return a*i    print(f(2))             #打印20    函数外面的a影响到了函数内a的值外部变量对闭包的影响：    a = 10     print(func(2))          #打印100    调用外面的a没有影响到函数内a的值，def curve(x)内的a仍然是def curve_pre()内的a的值    上述就是闭包的现象</code></pre><h4 id="闭包定义："><a href="#闭包定义：" class="headerlink" title="闭包定义："></a><strong>闭包定义：</strong></h4><pre><code>由函数以及函数定义时外部的变量构成的整体，叫闭包闭包 = 函数 + 原函数所处环境的变量（原函数外部）</code></pre><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>上述函数所处环境的变量不能是全局变量，即：至少需要两个结构体嵌套闭包内的环境变量：    保存在curve_pre().__closure__内    print(func.__closure__)    #输出：(&lt;cell at 0x0000000001158CA8: int object at 0x00000000539604D0&gt;,)    print(func.__closure__[0].cell_contents)    #输出：25</code></pre><h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>单一函数 + 不同的外部变量 = 多种不同的闭包（类似设计模式的工厂模式）</code></pre><h4 id="闭包的调用方式："><a href="#闭包的调用方式：" class="headerlink" title="闭包的调用方式："></a><strong>闭包的调用方式：</strong></h4><pre><code>正常非闭包函数的调用：代码：    def func1():        a = 10        def func2():            a = 20            print(&quot;func2&apos;s a = &quot;,a) # 20    运行顺序：2        print(&quot;func1&apos;s a = &quot;,a)     # 10    运行顺序：1        func2()        print(&quot;func1&apos;s a = &quot;,a)     # 10    运行顺序：3    func1()注意：    上述是一个函数的调用，不是一个闭包，可以使用__closure__来判断是否为闭包测试是否是闭包：    def func1():        a = 10        def func2():            a = 20            return a        return func2        func2()    func1()    f = func1()    print(f.__closure__) #输出：None原因：    func2中的a被当做了局部变量，此时func2函数内并没有产生对外部变量的引用！    所以，并没有构成一个闭包修改为闭包的方式：    def func1():        a = 10        def func2():            #a = 20        将局部变量a注释            c = a * 20        return func2        func2()    func1()    f = func1()    print(f.__closure__)     #输出：(&lt;cell at 0x0000000001108CA8: int object at 0x00000000539602F0&gt;,)成为闭包的原因：    将func2中的局部变量a去掉后，只要func2中产生对外部变量a的使用，就可以被作为闭包    闭包一定要引用外部环境的变量</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="闭包的应用："><a href="#闭包的应用：" class="headerlink" title="闭包的应用："></a><strong>闭包的应用：</strong></h4><pre><code>要求：    对于x，y    按顺序x=3,y=3;x=5,y=8;x=6,y=14本质：    需要对中间变量进行保存非闭包实现：（失败）    origin = 0    def walk(step):        new_pos = origin + step     #这一步origin是外面的全局变量        origin = new_pos                    #此处的赋值会出错，因为如果函数内部有赋值操作，那么origin会变成局部变量，从而导致上一句中找不到origin的定义        return origin    print(walk(3))    print(walk(5))    print(walk(6))上述代码修改为：（借助global，成功）    origin = 0    def walk(step):        global origin           #显式的声明全局变量之后，就不会讲origin作为局部变量        new_pos = origin + step              origin = new_pos                     return origin    print(walk(3))  #3    print(walk(5))  #8    print(walk(6))  #14闭包方式：（失败）    origin = 0    def func1(pos):        #pos成为了环境的变量        def walk(step):           new_pos = pos + step            pos = new_pos               #此处报错UnboundLocalError: local variable &apos;pos&apos; referenced before assignment           return new_pos        return walk    tour = func1(origin)    print(tour(3))  #3    print(tour(5))  #8    print(tour(6))  #14修改为：（借助nonlocal，成功）    origin = 0    def func1(pos):        #pos成为了环境的变量        def walk(step):           nonlocal pos     #显式声明pos是一个本地变量           new_pos = pos + step            pos = new_pos               #此处报错UnboundLocalError: local variable &apos;pos&apos; referenced before assignment           return new_pos        return walk    tour = func1(origin)    print(tour(3))  #3    print(tour.__closure__[0].cell_contents)  #3    print(tour(5))  #8    print(tour.__closure__[0].cell_contents)  #8    print(tour(6))  #14    print(tour.__closure__[0].cell_contents)  #14使用闭包的优点：（函数式编程）    没有使用全局变量origin，所有的变量操作均在闭包内部    闭包+nonlocal关键字可以完成中间变量的记录，打印__closure__[0].cell_contents也会发现，闭包确实记录了中间变量</code></pre><h4 id="闭包的扩展："><a href="#闭包的扩展：" class="headerlink" title="闭包的扩展："></a><strong>闭包的扩展：</strong></h4><pre><code>可以实现设计模式中的；工厂模式闭包内的变量会常驻内存，使用时要注意闭包不是函数式编程的全部，只是一种体现</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的枚举类型</title>
      <link href="/article/3d.html"/>
      <url>/article/3d.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="产生："><a href="#产生：" class="headerlink" title="产生："></a><strong>产生：</strong></h4><pre><code>数据类型 dict，list，tuple，set 等等有时并不适用</code></pre><h4 id="使用："><a href="#使用：" class="headerlink" title="使用："></a><strong>使用：</strong></h4><pre><code>引入模块：form enum import Enum</code></pre><h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a><strong>示例：</strong></h4><pre><code>所有的枚举类型都是Enum类的子类，Py中没有enum这个数据类型枚举类中定义了多组常量，枚举类名和标识名推荐大写from enum import Enumclass EMP(Enum):    YELLOW = 1    GREEN = 2    BLACK = 3    RED = 4上述常量只要赋值为不同量即可，可以为不同的数字或不同的字符串print(EMP.BLACK)注意：    这里运行会报错：ImportError: cannot import name &apos;Enum&apos;    原因是此文件本身叫做enum.py，这与引包操作产生冲突，需要修改文件名上述正确打印结果为：EMP.BLACK如果按一般的类，打印结果应该为3，但是枚举类会打印出本身</code></pre><h4 id="继承Enum的枚举类的特点和优势："><a href="#继承Enum的枚举类的特点和优势：" class="headerlink" title="继承Enum的枚举类的特点和优势："></a><strong>继承Enum的枚举类的特点和优势：</strong></h4><pre><code>对于其他实现枚举的方式：    一是直接定义：        BLACK = 1           RED = 2    二是使用字典：        {&quot;BLACK&quot;:1,&quot;RED&quot;:2}    三是自定义类：        class MyEnum():            BLACK = 1            RED = 2上述的缺点：    上述实现方式，对应关系均是可变的，可以发生赋值    上述均没有防止重复的功能，不同类型对应值可能相同枚举的要求：    类型一般不能随意更改    类型一般不能出现重复对于枚举类型：    from enum import Enum    class EMP(Enum):        BLACK = 1        RED = 2    EMP.BLACK = 3    尝试修改时报错：AttributeError: Cannot reassign members.    from enum import Enum    class EMP1(Enum):        BLACK = 1        BLACK = 2    相同标签对应不同类型时报错：TypeError: Attempted to reuse key: &apos;BLACK&apos;综上：    枚举类型可以保证类型名称的不重复性、并且保护类型不被修改</code></pre><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>区别于枚举名称的重复（不允许）：    class EMP1(Enum):        BLACK = 1        RED = 1    上述这种方式是不报错的，因为这表示两个标签对应同一类别，这是允许的，类似别名的概念    此时print(EMP1.RED)会打印出EMP1.BLACK    对于这种类型相同的枚举类型，在遍历时只会遍历EMP1.BLACK    如果想将别名也全部遍历出来，那么使用        for x in EMP1.__members__.items()：            print(x)        输出：            (&apos;BLACK&apos;,&lt;EMP1.BLACK: 1&gt;)            (&apos;RED&apos;,&lt;EMP1.RED: 1&gt;)    或者使用        for x in EMP1.__members__:            print(x)        输出：            BLACK            RED</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="注意区别："><a href="#注意区别：" class="headerlink" title="注意区别："></a><strong>注意区别：</strong></h4><pre><code>枚举类型、枚举名称、枚举值对于代码：    from enum import Enum    class EMP1(Enum):        BLACK = 1        RED = 2通过枚举类型，访问枚举名称和枚举值：    print( EMP1.BLACK.value )   #输出 1    print( EMP1.BLACK.name )    #输出 BLACK    验证：        print( type(EMP1.BLACK) )       #输出 &lt;enum &apos;EMP1&apos;&gt; 枚举类型        print( type(EMP1.BLACK.name) )  #输出 &lt;class &apos;str&apos;&gt; 枚举名称通过枚举名称访问枚举类型    print( EMP1[&apos;BLACK&apos;] )      #输出 EMP1.BLACK    print( type(EMP1[&apos;BLACK&apos;] ))#输出 &lt;enum &apos;EMP1&apos;&gt;   枚举类型</code></pre><h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>枚举类本身可以被遍历for x in EMP1:   print(x)  输出：    EMP1.BLACK    EMP1.RED上述将EMP1类中的全部枚举类型都打印出来</code></pre><h4 id="枚举类型的比较"><a href="#枚举类型的比较" class="headerlink" title="枚举类型的比较:"></a><strong>枚举类型的比较:</strong></h4><pre><code>限定：同一枚举类中的枚举类型方式：    两个枚举之间的等值比较，    两个枚举之间的身份比较，    不支持大小比较！！！示例：    from enum import Enum    class EMP1(Enum):        BLACK = 1        RED = 2    print( EMP1.BLACK == EMP1.RED )    #输出 False ，表明两个枚举类型不相等    print( EMP1.BLACK == 1 )    #输出 False ，表明枚举类型的比较不是单纯的数值比较    print( EMP1.BLACK is EMP1.BLACK )    #输出 True，表明两者身份相同对于不同枚举类之间的枚举类型    class EMP2(Enum):        BLACK = 1        RED = 2    print( EMP1.BLACK == EMP2.BLACK )    #输出 False注意：    虽然对应类型相同，但是两者属于不同类，无从比较</code></pre><h4 id="枚举转换"><a href="#枚举转换" class="headerlink" title="枚举转换"></a><strong>枚举转换</strong></h4><pre><code>将数值形式来转换为枚举类型的操作示例：    from enum import Enum    class EMP1(Enum):        BLACK = 1        RED = 2    param = 1    print( EMP1(param) )    #输出EMP1.BLACK</code></pre><h4 id="枚举类型的总结："><a href="#枚举类型的总结：" class="headerlink" title="枚举类型的总结："></a><strong>枚举类型的总结：</strong></h4><pre><code>对于继承的Enum类，允许类型为字符串类型    from enum import Enum    class EMP1(Enum):        BLACK = &apos;1&apos;        RED = &apos;2&apos;如果继承IntEnum，上述代码会报错，因为不允许非Int类型    from enum import IntEnum    class EMP1(IntEnum):        BLACK = &apos;1&apos;        RED = &apos;2&apos;引入的unique模块是一个装饰器，其内不允许重复    from enum import Enum,unique    @unique    class EMP1(Enum):        BLACK = 1        RED = 1    #报错：ValueError:duplicate values found in &lt;enum &apos;EMP1&apos;&gt;: RED -&gt; BLACK</code></pre><h4 id="其他："><a href="#其他：" class="headerlink" title="其他："></a><strong>其他：</strong></h4><pre><code>枚举类型是单例模式，不允许实例化</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识机器学习</title>
      <link href="/article/7f0b.html"/>
      <url>/article/7f0b.html</url>
      
        <content type="html"><![CDATA[<h2 id="几个基础算法"><a href="#几个基础算法" class="headerlink" title="几个基础算法"></a><strong>几个基础算法</strong></h2><h3 id="关联规则"><a href="#关联规则" class="headerlink" title="关联规则"></a>关联规则</h3><blockquote><p>啤酒和尿布的案例<br>原始的购物篮分析，属于数据挖掘范畴，但也是机器学习的必备算法。</p></blockquote><a id="more"></a><h3 id="协同过滤"><a href="#协同过滤" class="headerlink" title="协同过滤"></a>协同过滤</h3><blockquote><p>高级的购物篮分析，是推荐系统常用到的算法之一</p></blockquote><h3 id="聚类"><a href="#聚类" class="headerlink" title="聚类"></a>聚类</h3><blockquote><p>运营商人群分类案例<br>通过聚类分离不同人群，然后再分析人群的特点，制定不同的品牌，其属于机器学习范畴，对于给定的数据，运行给定的算法即可获得相关结果</p></blockquote><h3 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h3><blockquote><p>原始的垃圾邮件过滤经常被用到</p></blockquote><h3 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h3><blockquote><p>通过不同的参数指标来获得对事物的评判</p></blockquote><h3 id="CTR预估"><a href="#CTR预估" class="headerlink" title="CTR预估"></a>CTR预估</h3><blockquote><p>类似于PageRank的目的，其对指定对象进行评分排名</p></blockquote><h2 id="机器学习和数据分析的区别"><a href="#机器学习和数据分析的区别" class="headerlink" title="机器学习和数据分析的区别"></a><strong>机器学习和数据分析的区别</strong></h2><h3 id="处理数据的不同"><a href="#处理数据的不同" class="headerlink" title="处理数据的不同"></a><strong>处理数据的不同</strong></h3><blockquote><p>机器学习：处理行为数据，搜索记录，浏览记录，评论记录等等<br>数据分析：处理交易数据，账单工单等等<br>数据量：海量/行为数据 VS  交易/少量数据</p></blockquote><h3 id="数据特点不同"><a href="#数据特点不同" class="headerlink" title="数据特点不同"></a><strong>数据特点不同</strong></h3><blockquote><p>交易数据的一致性要求非常高，事务保证，确保数据一致性<br>行为数据一致性不高，数据缺失影响不大，对于整体分析结果影响较少<br>对于交易型数据的存储：关系型数据库<br>行为数据：MongoDB等NoSQL数据库</p></blockquote><ul><li>对于数据一致性不高的特点：产生了NoSQL</li><li>NoSQL特点：保证数据吞吐量的前提下会损失一致性，所以存储上：</li></ul><h3 id="分析方法不同"><a href="#分析方法不同" class="headerlink" title="分析方法不同"></a><strong>分析方法不同</strong></h3><blockquote><p>数据分析多采用采样分析<br>机器学习大多是全量分析，数据量越多，分析结果越贴合</p></blockquote><h3 id="解决的问题不一样"><a href="#解决的问题不一样" class="headerlink" title="解决的问题不一样"></a><strong>解决的问题不一样</strong></h3><blockquote><p>过去的历史数据特点：数据分析<br>预测未来的用户特点：机器学习</p></blockquote><h3 id="技术手段不同"><a href="#技术手段不同" class="headerlink" title="技术手段不同"></a><strong>技术手段不同</strong></h3><table><thead><tr><th>分类</th><th align="right">特点</th></tr></thead><tbody><tr><td>数据分析</td><td align="right">汇总数据，OLAP，纬度少，属性少，数据量小，用户驱动，交互式分析</td></tr><tr><td>机器学习</td><td align="right">明细全量数据，纬度多，属性多，数据量大，数据驱动，自动进行知识发现</td></tr></tbody></table><h3 id="参与者、受众不同"><a href="#参与者、受众不同" class="headerlink" title="参与者、受众不同"></a><strong>参与者、受众不同</strong></h3><blockquote><p>数据分析取决于分析师的能力视角，目标用户是特定决策者<br>机器学习结果：取决于数据质量，数据驱动，算法影响较小，目标用户是数据用户本身</p></blockquote><h2 id="机器学习算法分类"><a href="#机器学习算法分类" class="headerlink" title="机器学习算法分类"></a><strong>机器学习算法分类</strong></h2><p>| 依据|类别|<br>| — |— | —<br>| 按训练数据特点|有监督学习，无监督学习，半监督学习|<br>| 按算法解决的问题|分类和回归，聚类，标注|<br>| 按算法本质|生成模型，判别模型|</p><h3 id="按训练数据特点"><a href="#按训练数据特点" class="headerlink" title="按训练数据特点"></a><strong>按训练数据特点</strong></h3><p>对样本数据进行训练，得到一个模型，然后判断Y(输出)-X(输入)关系</p><ol><li>有监督学习：分类算法(类别)、回归算法(数字)<blockquote><p>例如分类垃圾邮件：<br>训练数据明确给出每个样本属于哪个类别，已经打好标签<br>特点，垃圾邮件已知，通过训练获得垃圾邮件的特征，从而分类出垃圾邮件<br>评判：给出垃圾邮件，要分到垃圾类别</p></blockquote></li><li>无监督学习：不知道类别，标签未知，数据中没有Y<blockquote><p>例如用户聚类：<br>分类之前不知道具体类别，算法结束后才知道具体类别和类别特征</p></blockquote></li><li>半监督学习、强化学习<blockquote><p>可能开始有Y值，但是模型结果不好，但随着训练增多结果变好</p></blockquote></li></ol><h3 id="按算法解决问题"><a href="#按算法解决问题" class="headerlink" title="按算法解决问题"></a><strong>按算法解决问题</strong></h3><ol><li>分类和回归：预测分类，预测Y值</li><li>聚类</li><li>标注：例如文本，可以切词，打标签，标注算法</li></ol><h3 id="按算法的本质"><a href="#按算法的本质" class="headerlink" title="按算法的本质"></a><strong>按算法的本质</strong></h3><ol><li>生成模型：告诉属于各个类的概率，模棱两可，陪审团</li><li>判别模型：直接给算法，数据丢进去返回哪一类，非黑即白，法庭宣判<blockquote><p>通常用来说分类问题<br>例如逻辑回归和朴素贝叶斯的本质区别：是判别和生成模型的区别<br>从算法实现思想出发，非常重要！</p></blockquote></li></ol><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="常见算法"><a href="#常见算法" class="headerlink" title="常见算法"></a><strong>常见算法</strong></h2><table><thead><tr><th>类别</th><th>名称</th><th>特点</th></tr></thead><tbody><tr><td>分类</td><td>C4.5</td><td>有监督算法，淘汰</td></tr><tr><td>聚类</td><td>K-Means</td><td>无监督算法</td></tr><tr><td>分类</td><td>SVM</td><td>基于统计，有数学理论支撑（效果好，有理论支撑）-被深度学取代-必考，公式推导</td></tr><tr><td>关联分析</td><td>Apriori</td><td>频繁项集挖掘，代价大，被FP-Growth取代，只需；两次扫描数据库，推荐不用这些算法了</td></tr><tr><td>抽象</td><td>EM</td><td>算法框架，K-Means本质即为EM算法</td></tr><tr><td>链接</td><td>PageRank</td><td></td></tr><tr><td>分类框体</td><td>AdaBoost</td><td>人脸识别，有监督学习</td></tr><tr><td>分类</td><td>kNN</td><td>最简单，有监督学习，类似k-means</td></tr><tr><td>分类</td><td>NativeBayes</td><td></td></tr><tr><td>分类</td><td>CART</td><td>淘汰</td></tr><tr><td>其他杂类</td><td></td><td></td></tr></tbody></table><table><thead><tr><th>名称</th><th>特点</th></tr></thead><tbody><tr><td>FP-Growth</td><td>频繁项集挖掘</td></tr><tr><td>逻辑回归</td><td>搜索结果排序，本质逻辑回归</td></tr><tr><td>RF随机森林、GBDT</td><td>类似AdaBoost，都是决策树算法改进</td></tr><tr><td>推荐算法</td><td>—</td></tr><tr><td>LDA</td><td>文本分析，自然语言处理   难度大</td></tr><tr><td>Word2Vector</td><td>文本挖掘</td></tr><tr><td>HMM马尔科夫模型、CRF条件随机场</td><td>文本挖掘</td></tr><tr><td>深度学习系列算法</td><td>—</td></tr></tbody></table><h2 id="机器学习的框架"><a href="#机器学习的框架" class="headerlink" title="机器学习的框架"></a><strong>机器学习的框架</strong></h2><p>机器学习解决的问题无非两类：预测、分类<br>预测：预测所属分类、预测预测数值，区别：预测目标Y是连续的还是离散的</p><h3 id="算法概要流程"><a href="#算法概要流程" class="headerlink" title="算法概要流程"></a><strong>算法概要流程</strong></h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a><strong>准备工作</strong></h4><ol><li>首先确定业务需求，确定问题</li><li>围绕问题收集数据</li><li>特征工程：预处理、提取特征，清洗整合重构，ETL过程，时间占比七成左右<blockquote><p>例如预测购买力，要确定收入、学历等数据，筛选出来结构化<br>如果数据准备好了，那么用哪种模型对结果效果影响较小，特征工程的影响非常大<br>数据的好坏基本会决定了整个学习的效果。</p></blockquote></li></ol><h4 id="训练模型"><a href="#训练模型" class="headerlink" title="训练模型"></a><strong>训练模型</strong></h4><ol start="4"><li>针对问题定义模型<blockquote><p>定义模型的参数是不知道的，通过训练数据求参数，最终产生一个公式</p></blockquote></li><li>定义损失函数<blockquote><p>评估偏差的大小，机器学习没法得到问题的解析解/精确解，找到偏差最小的函数<br>偏差的定义：对于回归问题就是真实与预测的查，对于分类问题偏差定义较困难不直观，必须用数学方式定义之。loglogth，thinge等等</p></blockquote></li><li>优化算法<blockquote><p>在定义损失函数之后，确定损失函数的最小值，往往演变为优化问题，又会用到一些优化算法，纯数学问题：凸优化问题、优化问题，涉及梯度下降、随机梯度下降、坐标法等等</p></blockquote></li></ol><h4 id="模型评估（在输入数据、计算、得到模型之后）"><a href="#模型评估（在输入数据、计算、得到模型之后）" class="headerlink" title="模型评估（在输入数据、计算、得到模型之后）"></a><strong>模型评估（在输入数据、计算、得到模型之后）</strong></h4><ol><li>交叉验证：K值实值等等</li><li>效果评估指标：准确率，召回率，方差，ROC曲线，AOC等等<blockquote><p>检验模型好不好的标准<br>难度：损失函数，优化算法</p></blockquote></li></ol><h4 id="示例：将图像按颜色分类"><a href="#示例：将图像按颜色分类" class="headerlink" title="示例：将图像按颜色分类"></a><strong>示例：将图像按颜色分类</strong></h4><blockquote><p>确定问题：按颜色分类<br>收集数据：大量图片文件<br>特征工程：对于图片要根据图像内容，每个像素点由三数字组成；图片大小不一样，即数据维度不一样，如何将图片文件转换为聚类格式，转换为统一维度的向量<br>训练模型：K-Mean聚类<br>评价指标：暂略<br>注意：每次结果可能不一致</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ML/R学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的JSON处理</title>
      <link href="/article/8830.html"/>
      <url>/article/8830.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="什么是JSON："><a href="#什么是JSON：" class="headerlink" title="什么是JSON："></a><strong>什么是JSON：</strong></h4><pre><code>是一种轻量级的（比较于XML格式）数据交换格式</code></pre><h4 id="表现形式："><a href="#表现形式：" class="headerlink" title="表现形式："></a><strong>表现形式：</strong></h4><pre><code>字符串不同语言可以将其转换为不同类型：Python(dict),JavaScript(Object)</code></pre><h4 id="优势："><a href="#优势：" class="headerlink" title="优势："></a><strong>优势：</strong></h4><pre><code>易于阅读，易于解析，网络传输开销小效率高，适合跨语言交换数据</code></pre><h4 id="应用场景："><a href="#应用场景：" class="headerlink" title="应用场景："></a><strong>应用场景：</strong></h4><pre><code>前后台交互、多语言服务的交互</code></pre><h4 id="几种定义："><a href="#几种定义：" class="headerlink" title="几种定义："></a><strong>几种定义：</strong></h4><pre><code>JSON字符串：符合JSON格式的字符串。{&quot;name&quot;:&quot;Tom&quot;}</code></pre><h4 id="操作JSON字符串"><a href="#操作JSON字符串" class="headerlink" title="操作JSON字符串:"></a><strong>操作JSON字符串:</strong></h4><pre><code>处理方式：    Python内置模块json，转换为字典dict类型示例：    import json    Json_str = &apos;{&quot;name&quot;:&quot;Tom&quot;, &quot;aga&quot;:20, &quot;sex&quot;:&quot;female&quot;}&apos;    注意上述字符串要加引号：双引号，数字不用加，布尔值不用加    整个字符串可以用单引号包装；    student = json.loads(Json_str)    print(type(student))    #输出 &lt;class &apos;dict&apos;&gt;    print(student)    #输出 {&apos;name&apos;: &apos;Tom&apos;, &apos;sex&apos;: &apos;female&apos;, &apos;aga&apos;: 20}    访问JSON的成员    print(student[&apos;name&apos;])</code></pre><h4 id="包含多个对象的Array形式"><a href="#包含多个对象的Array形式" class="headerlink" title="包含多个对象的Array形式"></a><strong>包含多个对象的Array形式</strong></h4><pre><code>处理方式：    Python中&quot;反序列化&quot;为List&lt;dict&gt;示例：    import json    Json_str = &apos;[{&quot;name&quot;:&quot;Tom&quot;, &quot;aga&quot;:20},{&quot;name&quot;:&quot;Jack&quot;, &quot;aga&quot;:16}]&apos;    student = json.loads(Json_str)    print(type(student))    #&lt;class &apos;list&apos;&gt;    print(student)    #[{&apos;aga&apos;: 20, &apos;name&apos;: &apos;Tom&apos;}, {&apos;aga&apos;: 16, &apos;name&apos;: &apos;Jack&apos;}]</code></pre><h4 id="反序列化："><a href="#反序列化：" class="headerlink" title="反序列化："></a><strong>反序列化：</strong></h4><pre><code>上述JSON格式转化为Python类型，即为反序列化反序列化对应的数据类型：    object          dict    array           list    string          str     number          int/float    true/false      True/False    null            None</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a><strong>序列化</strong></h4><pre><code>即将现有数据类型转化为JSON格式处理方式：    使用json模块的json.dumps()示例：    import json    Json_str = [            {&quot;name&quot;:&quot;Tom&quot;, &quot;aga&quot;:20},            {&quot;name&quot;:&quot;Jack&quot;, &quot;aga&quot;:16}        ]    student =json.dumps(Json_str)    print(type(student))    #&lt;class &apos;str&apos;&gt;    上述list已经序列化为JSON字符串    print(student)    #[{&quot;name&quot;: &quot;Tom&quot;, &quot;aga&quot;: 20}, {&quot;name&quot;: &quot;Jack&quot;, &quot;aga&quot;: 16}]</code></pre><h4 id="JSON相关概念："><a href="#JSON相关概念：" class="headerlink" title="JSON相关概念："></a><strong>JSON相关概念：</strong></h4><pre><code>JSONJSON对象JSON字符串误区一：JSON和JavaScript没有太大关系    遵循ECMASCRIPT的语言：ActionScript，TypeScript，JavaScript，JSON误区二：JSON就是字符串    JSON具有自己的数据类型，与JavaScript相似</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的正则表达式</title>
      <link href="/article/d81.html"/>
      <url>/article/d81.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a><strong>正则表达式</strong></h4><pre><code>定义：    是一个特殊的字符序列，一个字符串是否符与此字符序列相匹配作用：    可以快速检索文本、实现一些替换文本的操作场景：    检查一串数字是否是电话号码    检查字符串是否是Email格式    把文本中指定单词替换为其他单词示例：    判断下列字符串是否包含Python        a = &apos;C|C++|Java|C#|Python|JavaScript&apos;        print(a.index(&apos;Python&apos;)&gt;-1)        # True        print(&apos;Python&apos; in a)        # True    上述是使用python内置的函数来实现字符串查找等功能    使用常量正则表达式：        使用re的方法： re.findall(&apos;正则表达式&apos;,&apos;所匹配的字符串&apos;)            import re            a = &apos;C|C++|Java|C#|Python|JavaScript&apos;            print(re.findall(&apos;Python&apos;,a))            #输出：[&apos;Python&apos;]            print(re.findall(&apos;C&apos;,a))            #输出：[&apos;C&apos;, &apos;C&apos;, &apos;C&apos;]            #判断是否包含字符串：            print( len(re.findall(&apos;Python&apos;,a)) &gt; 0 ) #输出True        常量正则表达式：规则单一，没有体现出正则的强大        正则的强大之处就在于构造有意义的规则    构造有规则的正则表达式：        示例:            提取字符串中的所有数字            方法一：循环遍历每个字符            方法二：构造正则，使用findAll方法 :&apos;\d&apos;表示0~9            &apos;Python&apos;    -   普通字符            &apos;\d&apos;        -   元字符之一            &apos;\D&apos;        -   去掉数字                代码：                import re                a = &apos;C1|C++2|Java3|C#4|Python5|JavaScript6&apos;                print(re.findall(&apos;\d&apos;,a))                #[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;] 找出了全部数字                print(re.findall(&apos;\D&apos;,a))   去掉数字                #[&apos;C&apos;, &apos;|&apos;, &apos;C&apos;, &apos;+&apos;, &apos;+&apos;, &apos;|&apos;, &apos;J&apos;, &apos;a&apos;, &apos;v&apos;, &apos;a&apos;, &apos;|&apos;, &apos;C&apos;, &apos;#&apos;, &apos;|&apos;,                # &apos;P&apos;, &apos;y&apos;, &apos;t&apos;, &apos;h&apos;, &apos;o&apos;, &apos;n&apos;, &apos;|&apos;, &apos;J&apos;, &apos;a&apos;, &apos;v&apos;, &apos;a&apos;, &apos;S&apos;, &apos;c&apos;, &apos;r&apos;,                # &apos;i&apos;, &apos;p&apos;, &apos;t&apos;]        元字符很多，不需要记忆元字符，要学会自由组合        更重要的是：模式    -   任意的、A或B、等等</code></pre><h4 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a><strong>字符集</strong></h4><pre><code>形式：    中括号 [xyz]：x或y或z示例：    找出中间一个字符是c或者是f的字符串代码：    import re    s = &apos;abc,acc,adc,aec,afc,apc&apos;    print( re.findall( &apos;a[cf]c&apos;,s ) )   #[&apos;acc&apos;, &apos;afc&apos;]    #输出:       a       [cf]        c    #       借助a定界   表示a或f   借助c定界    #       普通字符    元字符     普通字符    中括号 [^xyz]：除去x或y或z    代码：        print( re.findall( &apos;a[^cf]c&apos;,s ) )  #[&apos;abc&apos;, &apos;adc&apos;, &apos;aec&apos;, &apos;apc&apos;]    中括号 [a-d]：a或b或c或d    代码：        print( re.findall( &apos;a[a-c]c&apos;,s ) )  #[&apos;abc&apos;, &apos;acc&apos;]</code></pre><h4 id="概括字符集"><a href="#概括字符集" class="headerlink" title="概括字符集"></a><strong>概括字符集</strong></h4><pre><code>形式：    类似&apos;\d&apos;,表示囊括所有的数字，    其他相同作用的规则：          &apos;\d&apos; = 字符集&apos;[0-9]&apos;        &apos;\D&apos; = 字符集&apos;[^0-9]&apos;场景：    匹配字符串中的各类字符示例：    import re    a = &apos;C1|C++2|Java3( C#4\n)Python5_JavaScript6&apos;    print( re.findall( &apos;\w&apos;,a ) )   #返回单词字符，字母，数字，和下划线    #[&apos;C&apos;, &apos;1&apos;, &apos;C&apos;, &apos;2&apos;, &apos;J&apos;, &apos;a&apos;, &apos;v&apos;, &apos;a&apos;, &apos;3&apos;, &apos;C&apos;, &apos;4&apos;, &apos;P&apos;, &apos;y&apos;, &apos;t&apos;,    # &apos;h&apos;, &apos;o&apos;, &apos;n&apos;, &apos;5&apos;, &apos;_&apos;, &apos;J&apos;, &apos;a&apos;, &apos;v&apos;, &apos;a&apos;, &apos;S&apos;, &apos;c&apos;, &apos;r&apos;, &apos;i&apos;, &apos;p&apos;,    # &apos;t&apos;, &apos;6&apos;]    print( re.findall( &apos;\W&apos;,a ) )   #返回非单词字符    #[&apos;|&apos;, &apos;+&apos;, &apos;+&apos;, &apos;|&apos;, &apos;(&apos;, &apos; &apos;, &apos;#&apos;, &apos;\n&apos;, &apos;)&apos;]    使用中括号的形式匹配字母和数字        print( re.findall( &apos;[0-9a-zA-Z]&apos;,a ) )    print( re.findall( &apos;\s&apos;,a ) )   &apos;\s&apos;    匹配空白字符    #[&apos; &apos;, &apos;\n&apos;]    print( re.findall( &apos;\S&apos;,a ) )   &apos;\S&apos;    匹配非空白字符    print( re.findall( &apos;.&apos;,a ) )       &apos;.&apos;        匹配除\n之外的字符</code></pre><h4 id="第一种数量词"><a href="#第一种数量词" class="headerlink" title="第一种数量词"></a><strong>第一种数量词</strong></h4><pre><code>形式：    {N} 或者 {M,N}示例：    import re    a = &apos;tom12,gimmy*77,kit_001,jack,yang&apos;    print(re.findall(&apos;[a-z][a-z][a-z]&apos;,a))    #输出[&apos;tom&apos;, &apos;gim&apos;, &apos;kit&apos;, &apos;jac&apos;, &apos;yan&apos;]    这里重复使用三次中括号字符集完成了匹配长度为三的字符    print(re.findall(&apos;[a-z]{3}&apos;,a))    #输出[&apos;tom&apos;, &apos;gim&apos;, &apos;kit&apos;, &apos;jac&apos;, &apos;yan&apos;]    上述使用大括号：{}，使用数量词来完成重复，结果与上述一致    print(re.findall(&apos;[a-z]{3,6}&apos;,a))    #输出[&apos;tom&apos;, &apos;gimmy&apos;, &apos;kit&apos;, &apos;jack&apos;, &apos;yang&apos;]    如果需要匹配出全部英文单词，即匹配出长度为3-5的字符，可以使用{x,y}来限定重复次数    此处的匹配是：贪婪的，检测到gim之后，并不停止，因为没有达到最大限定5，故还会继续匹配，一直到匹配到gimmy之后才停止    python默认是贪婪的匹配    非贪婪的模式匹配正则:{}?    print(re.findall(&apos;[a-z]{3,6}?&apos;,a))    #输出[&apos;tom&apos;, &apos;gim&apos;, &apos;kit&apos;, &apos;jac&apos;, &apos;yan&apos;]，此处匹配到3字符后就停止了</code></pre><h4 id="第二种数量词"><a href="#第二种数量词" class="headerlink" title="第二种数量词"></a><strong>第二种数量词</strong></h4><pre><code>形式：    *, +, ?含义：    *   匹配*号前的字符0次或者无限多次    +   匹配+号前的字符1次或者无限多次    ?   匹配?号前的字符0次或1次示例：    import re    a = &apos;to_tom12tomy*77tomyy,kit_001,jack,yang&apos;    print(re.findall(&apos;tomy*&apos;,a))    #输出[&apos;tom&apos;, &apos;tomy&apos;, &apos;tomyy&apos;]    解释：       tom     成功匹配t,o,m,匹配y不成功，即成功0次       tomy    成功匹配t,o,m,y       tomyy   成功匹配t,o,m,y,y又匹配成功，因为可以无限次，故含有y    print(re.findall(&apos;tomy+&apos;,a))    #输出[&apos;tomy&apos;, &apos;tomyy&apos;]    解释：       to      没出来，因为to之后的my没匹配成功，即成功-1次       tom     没出来，因为tom之后的y没匹配成功，即成功0次       tomy    成功匹配t,o,m,y       tomyy   成功匹配t,o,m,y后，后续匹配y，因为y在tomy内，故成功    print(re.findall(&apos;tomy?&apos;,a))    #输出[&apos;tom&apos;, &apos;tomy&apos;, &apos;tomy&apos;]    解释：       to      没匹配出来，因为匹配失败2次，即匹配成功-1次       tom     匹配出tom，因为匹配到tom之后再匹配&apos;y&apos;没有匹配到，即匹配成功0次       tomy    成功匹配t,o,m,y       tomy    注意tomyy匹配为tomy，因为成功匹配t,o,m,y后，y虽又匹配成功，但已经是第二次，故丢弃    print(re.findall(&apos;tomy{1,2}&apos;,a))    #使用{}作为数量词限定    #输出[&apos;tomy&apos;, &apos;tomyy&apos;]    print(re.findall(&apos;tomy{1,2}?&apos;,a))   #非贪婪    #输出[&apos;tomy&apos;, &apos;tomy&apos;]</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="边界匹配符"><a href="#边界匹配符" class="headerlink" title="边界匹配符"></a><strong>边界匹配符</strong></h4><pre><code>形式：    ^ 、 $场景：    验证字符串长度：4-8位示例：    import re    a = &apos;11345610000&apos;    print(re.findall(&apos;\d{4,8}&apos;,a))     #输出[&apos;12345610&apos;]    这样可以匹配出4-8位字符，但是判断不了原串是否为4-8位    此处应该使用面向字符串的匹配：        边界匹配：^表达式$，将‘表达式’作为整体匹配        示例：            print(re.findall(&apos;^\d{4,8}$&apos;,a))            #输出[]        边界符的作用：        不用边界符时        print(re.findall(&apos;00&apos;,a))        #输出[&apos;00&apos;, &apos;00&apos;]        使用边界附    ^   从字符串开始的位置开始匹配        print(re.findall(&apos;^00&apos;,a))        #输出[]        因为字符串开头为1，故匹配失败        使用边界附    $   从字符串末尾的位置开始匹配        print(re.findall(&apos;00$&apos;,a))        #输出[&apos;00&apos;]        字符串结尾为0000，这里只匹配到0,0就结束</code></pre><h4 id="组"><a href="#组" class="headerlink" title="组"></a><strong>组</strong></h4><pre><code>形式：    ()场景：    判断字符串是否包含连续！N个子串示例：    例如判断串中是否存在三个&apos;to&apos;代码：    import re    a = &apos;to_tom12tomy*77tomyy, kit_001, jack, yang_tototo&apos;    print(len(re.findall(&apos;(to){3}&apos;,a))&gt;0)    #输出True   表示存在tototo，连续匹配 t且o 三次    中括号[]和小括号()的区别：        [xyz]：x或y或z        (xyz)：x且y且z</code></pre><h4 id="匹配模式"><a href="#匹配模式" class="headerlink" title="匹配模式"></a><strong>匹配模式</strong></h4><pre><code>形式：    re.I  re.S示例：    import re    a = &apos;to_tom\ntomy*77tomyy, kit_001, jack, yang_tototo&apos;    print(re.findall(&apos;Tom&apos;,a))    #[] 匹配不到tom，大小写不符    使用模式：添加第三个参数：    print(re.findall(&apos;Tom&apos;, a, re.I ))    #[&apos;tom&apos;, &apos;tom&apos;, &apos;tom&apos;]    如何匹配&apos;tom\n&apos;  ?        print(re.findall(&apos;Tom.&apos;, a, re.I ))        #[&apos;tomy&apos;, &apos;tomy&apos;]   没匹配出来        使用添加模式re.S        print(re.findall(&apos;Tom.&apos;, a, re.I | re.S ))        #[&apos;tom\n&apos;, &apos;tomy&apos;, &apos;tomy&apos;]        这里由于匹配了模式re.S，所以匹配出了\n字符</code></pre><h4 id="sub"><a href="#sub" class="headerlink" title="sub()"></a><strong>sub()</strong></h4><pre><code>形式：        re.sub(表达式,替换成,原串))场景：    替换 字符串示例：    简单替换（与内置方法replace类似）        import re        a = &apos;to_tomtomy*77tomyy, kit_001&apos;        print(re.sub(&apos;tom&apos;,&apos;Tom&apos;,a))        # to_TomTomy*77Tomyy, kit_001        print(re.sub(&apos;tom&apos;,&apos;Tom&apos;,a, 1))        #to_Tomtomy*77tomyy, kit_001        #注意：使用了count=1参数，只替换了第一个tom        #简易替换：        print(a.replace(&apos;tom&apos;,&apos;Tom&apos;, 1))        #to_Tomtomy*77tomyy, kit_001        #同样是替换了第一个tom    高级替换：        sub的强大之处，在于可以附加一个函数参数        示例：            def convert(value): #注意需要带一个参数                print(value)            print(re.sub(&apos;tom&apos;,convert,a))            #输出            #&lt;_sre.SRE_Match object; span=(3, 6), match=&apos;tom&apos;&gt;            #&lt;_sre.SRE_Match object; span=(6, 9), match=&apos;tom&apos;&gt;            #&lt;_sre.SRE_Match object; span=(13, 16), match=&apos;tom&apos;&gt;            #to_y*77yy, kit_001            注意上述替换后结果中tom消失了，而且传入函数的参数为对象：            三个对象：表示进行了三次字符串匹配            span(3,6)表示第一次tom字符串的起始边界为3，结束后的边界为6        通过函数进行动态替换,替换为return的值        示例：            def conver(value): #注意需要带一个参数                match = value.group()                #value.group()  表示匹配成功时传进函数的字符串                return &apos;[&apos;+match+&apos;]&apos;            print(re.sub(&apos;tom&apos;,conver,a))            #输出：to_[tom][tom]y*77[tom]yy, kit_001    进一步复杂的替换：        示例：            替换所有大于等于50的数字为 [BIG] ，小于的剔除        代码：            import re            a = &apos;to_to5mtomy*77tomy65y&apos;            def conver(value): #注意需要带一个参数                    match = value.group()                print(match)                if( int(match) &gt;= 50):   #注意转换类型                    return &apos; [BIG] &apos;                return &apos;&apos;            print(re.sub(&apos;\d+&apos;,conver,a))            #输出：            #5            #77     注意，此处77作为整体传入，不会分两次传入7,7            #65            #to_tomtomy* [BIG] tomy [BIG] y ，完成替换</code></pre><h4 id="search-match"><a href="#search-match" class="headerlink" title="search(),match()"></a><strong>search(),match()</strong></h4><pre><code>地位：    这是re模块正则匹配的三种方法的除findall之外的其余两种 形式：    re.match    re.search示例：    import re    a = &apos;1_to_to5mtomy*77tomy65y&apos;    print(re.match(&apos;\d&apos;,a))     #输出&lt;_sre.SRE_Match object; span=(0, 1), match=&apos;1&apos;&gt;    match()特点：        从字符串首字符开始匹配，如果失败，将返回None,object; span=(0, 1)其实就是&apos;1&apos;    print(re.search(&apos;\d&apos;,a))     #输出&lt;_sre.SRE_Match object; span=(5, 6), match=&apos;5&apos;&gt;    search()特点：        将尝试搜索字符串，将找到的第一个字符返回，注意object; span=(5, 6)，其实就是字符&apos;5&apos;    对于返回的object，有相关操作方法        group()方法：返回匹配的字符、字符串        示例：            print(re.search(&apos;\d&apos;,a).group()) #输出 1        span()方法：返回匹配结果在原串中的位置        示例：            print(re.search(&apos;\d&apos;,a).span()) #输出 (0, 1)    比较与findall方法，他们只要匹配成功就会停止匹配    比较与findall方法，他们会返回对象    print(re.findall(&apos;\d&apos;,a)) #输出[&apos;1&apos;, &apos;5&apos;, &apos;7&apos;, &apos;7&apos;, &apos;6&apos;, &apos;5&apos;]</code></pre><h4 id="匹配返回对象的方法-分组：group"><a href="#匹配返回对象的方法-分组：group" class="headerlink" title="匹配返回对象的方法 分组：group()"></a><strong>匹配返回对象的方法 分组：group()</strong></h4><pre><code>场景：    例如取出下面的时间信息示例：    import re    a = &apos;#2002 2017-10-30 11:12:34 #!&apos;    首先使用普通字符 定界，这里的边界是&apos;2002 &apos;和&apos; #!&apos;    print(re.search(&apos;2002 \w #!&apos;,a).group())    # 报错，因为seach无返回值，None.group()会报错    print(re.search(&apos;2002 \w* #!&apos;,a).group())    # 报错，因为seach无返回值，None.group()会报错    print(re.search(&apos;2002 .* #!&apos;,a).group())    # 输出:2002 2017-10-30 11:12:34 #!     这里并没有只返回中间内容，连边界也返回了    print(re.search(&apos;2002 .+ #!&apos;,a).group())    # 同样输出:2002 2017-10-30 11:12:34 #!    带参数的group()        注意：            group(parameter): group() = group(0)            group(0)：永远记录完整匹配结果            group(N)：N&gt;0，记录第N个分组        示例：            print(re.search(&apos;2002 (.+) #!&apos;,a).group(1))            #输出：2017-10-30 11:12:34        注意上述括号(),表示一个分组，使用group(1)，表示返回第一个分组    使用findall完全可以实现：    print(re.findall(&apos;2002 (.+) #!&apos;,a))    #输出：[&apos;2017-10-30 11:12:34&apos;]    另：groups()    print(re.search(&apos;2002 (.+) #!&apos;,a).groups())    直接返回全部分组：(&apos;2017-10-30 11:12:34&apos;,)</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的面向对象</title>
      <link href="/article/ddd3.html"/>
      <url>/article/ddd3.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a><strong>面向对象</strong></h4><pre><code>目的：    写出有意义的面向对象的代码，其作用就是封装代码定义时注意：    命名规范 Student、StudentPages    类体不能什么都不写，要写pass定义示例：    class Student():        # 开始类体的编写        name = &apos;&apos;           age = 0        def print_file():            print(&apos;age = &apos;+str(age))    stu = Student() #不需要使用new 来实例化这个类调用类的方法：    stu.print_file()    注意上述调用会报错          # TypeError: print_file() takes 0 positional arguments but 1 was given    做如下修改：        def print_file(self):            print(&apos;age = &apos;+str(age))    仍然报错，报错age没有定义    继续修改,改完正确运行        def print_file(self):            print(&apos;age = &apos;+str(self.age))    正确示例：        class Student():            name = &apos;&apos;               age = 0            def print_file(self):                print(&apos;age = &apos;+str(self.age))        stu = Student()         stu.print_file()        # 或者直接用：Student().print_file()    注意：        上述类体中，对于print_file函数，不能在类体里调用        写类的模块，最好是只写类，然后通过其他模块来实例化调用什么的            from c1 import Student            Student().print_file()            Student().age        注意：            如果c1.py中同时包含对Student类的实例化和调用，那么上述import时也会执行c1.py中的示例化和调用            所以，最好是模块和类分开，便于调用时的清晰</code></pre><h4 id="方法-和-函数："><a href="#方法-和-函数：" class="headerlink" title="方法 和 函数："></a><strong>方法 和 函数：</strong></h4><pre><code>区别：    方法是语言设计层面的考量，应用起来没什么区别    类中的函数应该叫‘方法’，模块中的函数就叫‘函数’    类中的变量应该叫‘数据成员’，模块中变量叫‘变量’类和对象 通过实例化联系在一起什么是类：    就是数据及一些操作的有意义的封装，可以体现出数据特征和行为特征    行为要联系主体，体现在类的设计中要具有现实意义什么是对象：    表示具体的类对象，类本身可以实例化多种多样的对象通过实例化来创造对象的多样性，依靠类的构造函数实现    class Student():        name = &apos;&apos;           age = 0        def __init__(self): # 至少需要添加self参数            print(&apos;init&apos;)        def print_file(self):            print(&apos;age = &apos;+str(self.age))    stu = Student() #构造函数在实例化时自动调用    stu.__init__()      #构造函数也可以调用，跟普通函数类似，但是不推荐这样用    但是：对于构造函数 只允许返回None，返回其他则报错为构造函数添加参数：    def __init__(self,param1,param2):    此时实例化类时，必须传入两个值：stu = Student(&apos;a&apos;,&apos;b&apos;)构造函数通常的用法：    来修改类的数据特征，即重置类的成员变量        class Student():            name = &apos;&apos;               age = 0            def __init__(self, name, age): # 至少需要添加self参数                name = name                age = age    上面的代码不报错，但是不能修改name和age的值，并不是因为变量作用域的问题注意：    类的变量的作用域 与 模块变量的作用域 完全不同！    要注意区别类的行为和模块的行为</code></pre><h4 id="类变量-实例变量："><a href="#类变量-实例变量：" class="headerlink" title="类变量 实例变量："></a><strong>类变量 实例变量：</strong></h4><pre><code>代码示例：    class Student():        name = &apos;&apos;       name 是类变量：与类相关        age = 0         age  是类变量：与类相关        def __init__(self, name, age):              self.name = name    self.name 实例变量：与对象相关            self.age = age      self.age  实例变量：与对象相关    s1 = Student(&apos;a&apos;,1) 作为实例变量传入    s2 = Student(&apos;b&apos;,8) 作为实例变量传入注意上述self可以换成任意名称：    def __init__(this, name, age):          this.name = name          this.age = age      换成this也是对的，但是推荐使用默认的 self使用区别：    对象名.成员变量   取决于实例化时的构造     类名.成员变量     只跟类有关，不可改变    应用场景：        比如定义一个狗类叫做ClassA:        里面有成员变量 动物种类、狗品种、狗毛色        有构造函数，参数为品种、毛色，但动物种类变量就等于“狗”，构造时不修改        实例化时借助构造函数，得到N个不同的狗对象ObjN，可以对应现实世界中不同的狗个体        此时，ObjN.品种，就是此狗对象的对象属性        而ClassA.动物类型，表明此类的特征属性，表示共同特性或者不属于个体特性的变量就可以作为类的成员变量</code></pre><p>(类的机制)</p><h4 id="类变量和实例变量的特性"><a href="#类变量和实例变量的特性" class="headerlink" title="类变量和实例变量的特性"></a><strong>类变量和实例变量的特性</strong></h4><pre><code>示例代码：    class Student():        name = &apos;类变量name&apos;           age = 0        def __init__(self, name, age): # 至少需要添加self参数            name = name            age = age    obj = Student(&apos;实例变量name&apos;,&apos;实例变量age&apos;)    print(obj.name)         #打印类变量name    print(Student.name)     #打印类变量name    print(obj.__dict__)     #打印{}    print(Student.__dict__) #打印{&apos;name&apos;: &apos;类变量name&apos;, &apos;__doc__&apos;: None, &apos;__weakref__&apos;: &lt;attribute &apos;__weakref__&apos; of &apos;Student&apos; objects&gt;, &apos;__init__&apos;: &lt;function Student.__init__ at 0x00000000006BFA60&gt;, &apos;__module__&apos;: &apos;__main__&apos;, &apos;__dict__&apos;:&lt;attribute &apos;__dict__&apos; of &apos;Student&apos; objects&gt;, &apos;age&apos;: 0}寻找相关变量的机制：    如果尝试去访问对象的一个成员变量    首先会在对象的变量列表obj.__dict__里去查找有没有    否则，到类的变量列表Student.__dict__去寻找    否则继续去类的父类中去寻找 示例代码：    class Student():        name = &apos;类变量name&apos;           age = 0        def __init__(self, name, age): # 至少需要添加self参数            self.name = name            self.age = age    obj = Student(&apos;实例变量name&apos;,&apos;实例变量age&apos;)    print(obj.name)         #打印类变量name    print(Student.name)     #打印实例变量name    print(obj.__dict__)     #打印{&apos;age&apos;: &apos;实例变量age&apos;, &apos;name&apos;: &apos;实例变量name&apos;}    解释：        修改为self.name之后，则是实例的变量，在构造函数中必须赋值给实例的变量        定义实例方法例如构造函数时，需要self出现，但是调用实例方法时不需要出现self    注意：        self和实例、对象绑定，与类无关        实例、对象可以调用的方法叫：实例方法，参数第一个必须为 self保留        self可以换成其他名字，比如this，但位置必须是第一参数        解释：            意思是实例方法第一个参数应该保留，具体叫self还是this或其他无所谓，但推荐用 self</code></pre><h4 id="Python的类"><a href="#Python的类" class="headerlink" title="Python的类"></a><strong>Python的类</strong></h4><pre><code>--- 变量  --- 类变量          --- 实例变量--- 方法  --- 实例方法    self + .操作符 -&gt; 修改实例变量          --- 类方法          --- 静态方法--- 构造函数(特殊的实例方法，只是默认调用)实例方法要操作变量：    --- 实例方法    self + .操作符 -&gt; 修改实例变量        例如：            class Student():                name = &apos;类变量name&apos;                   age = 0                def __init__(self, name1, age): # 至少需要添加self参数                    self.name = name1                    self.age = age                    print(self.name)    #访问的实例变量                    print(name)                                 #这也是访问的实例变量，但是访问的是形参name,如果形参不是name，那就会报错                    #print(__dict__)             obj = Student(&apos;实例变量name&apos;,&apos;实例变量age&apos;)            打印：                实例变量name                实例变量name        注意：            查找变量列表__dict__只能在外部调用时访问，在实例方法内无法打印            实例方法中，方法参数不要和类变量名相同            类变量定义时，不要与类内置变量重名    --- 实例方法    修改类变量        例如：            class Student():                name = &apos;类变量name&apos;                   age = 0                def __init__(self, name1, age): # 至少需要添加self参数                    print(&apos;形参name1:&apos;+name1)                    self.name = name1                    print(&apos;修改实例变量:&apos;+self.name)                    print(&apos;访问类变量法一:&apos;+Student.name)                     print(&apos;访问类变量法二:&apos;+self.__class__.name)  #注意self.__class__的使用            obj = Student(&apos;实例变量name&apos;,&apos;实例变量age&apos;)        输出：            形参name1:实例变量name            修改实例变量:实例变量name            访问类变量法一:类变量name            访问类变量法二:类变量name    --- 实例方法操作类变量 完成类变量的变化        class Student():            sum = 0            name = &apos;类变量name&apos;               age = 0            def __init__(self, name1, age): # 至少需要添加self参数                self.__class__.sum += 1                print(&apos;类变量sum变为:&apos;+str(self.__class__.sum))         obj1 = Student(&apos;Tom&apos;,13)        obj2 = Student(&apos;Kimmy&apos;,24)        obj3 = Student(&apos;Jack&apos;,18)        输出：            类变量sum变为:1            类变量sum变为:2            类变量sum变为:3           注意：            实例方法通常是操作实例变量的，但是也可以操作类变量，引出：专门操作类变量的方法</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="类方法："><a href="#类方法：" class="headerlink" title="类方法："></a><strong>类方法：</strong></h4><pre><code>定义规范：    @classmethod        #使用装饰器@classmethod来定义一个类方法    def plus_sum(cls):  #类方法的参数必须含一个cls参数        pass重新完成上述类变量的修改：    class Student():        sum = 0        def __init__(self,param):             pass        @classmethod        def plus_sum(cls): # cls仍然可以改成别的名字，不建议更改            cls.sum += 1            print(cls.sum)类方法的调用    stu = Student(1)    stu.plus_sum()      # 打印 1    stu = Student(2)    stu.plus_sum()      # 打印 2    stu = Student(3)    stu.plus_sum()      # 打印 3再次强调：    实例方法关联的是对象，类方法关联的是类本身    另外，两者有时候都可以完成参数修改，但是要是操作有“意义”有时就需要区分类方法和实例方法，例如与对象无关的操作就应该使用类方法    即，对象最好不要调用@classmethod 类方法（虽然不报错，但是缺失实际意义）</code></pre><h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a><strong>静态方法</strong></h4><pre><code>定义规范：    @staticmethod    def add(x,y):        print(&quot;这是一个静态方法&quot;)与其他方法的区别：    静态方法中没有强制参数    实例方法中，self 参数代表对象本身    类方法中 cls 代表类本身    一个对象或以各类都可以调用静态方法示例：       class Student():        sum = 0        name =&apos;Lei&apos;        def __init__(self,param):             self.name = param        @classmethod        def plus_sum(cls):             cls.sum += 1            print(cls.sum)            #print(self.name)    # 类方法不可以引用实例变量        @staticmethod        def add(x,y):             #print(self.name)            # 静态方法不可以引用实例变量            print(Student.sum)              # 静态方法可以访问类变量            print(&apos;这是一个静态方法&apos;)            #调用    stu = Student(1)    stu.add(1,1)        # 对象调用静态方法  且访问了类变量 不可以引用实例变量    Student.add(1,1)    # 类调用静态方法   且访问了类变量 不可以引用实例变量    stu.plus_sum()      # 对象调用类方法   且访问了类变量 不可以引用实例变量       Student.plus_sum()  # 类调用类方法   且访问了类变量 不可以引用实例变量注意：    静态方法不要经常使用，与类的关联性不强，与普通函数无区别</code></pre><h4 id="类成员的可见性"><a href="#类成员的可见性" class="headerlink" title="类成员的可见性"></a><strong>类成员的可见性</strong></h4><pre><code>对于下面示例：    class Student():        sum = 0        def __init__(self,param,param1):             self.name = param            self.age = param1            self.score = &apos;0&apos;            print(&apos;初值为：&apos;+self.score)        def marking(self,score):             self.score = score            print(&apos;修改后:&apos;+str(score))        def do_hmwork(self):             pass        def do_eng_hmwork(self):             pass    s = Student(1,2)    # 将socre参数隐藏，不暴露score的直接赋值    s.score = -1            #不推荐方式，直接修改参数，这样没法进行相关过滤，不应该通过直接访问的方式修改    print(&apos;修改后:&apos;+str(s.score))    #正确方法：所有访问应该通过方法操作变量，可以在方法中对输入进行判断，进而保护数据    s1 = Student(1,2)    s1.marking(-1)注意：    上述marking方法之外，仍然可以通过 s.score = -1 来直接赋值，原因：    上述变量和方法全部都是公开的Python控制变量的可见性（读、写）： 公开public 私有private    方式：        私有变量：__私有变量名        私有函数：__marking()    注意：        对于构造函数，因为__init__右边也有下划线，这样不会被识别为私有    示例：        class Student():            sum = 0            def __init__(self,param,param1):                 self.name = param                self.age = param1                self.__score = &apos;0&apos;                print(&apos;初值为：&apos;+self.__score)            def __marking(self,score): #添加双下划线                self.__score = score                print(&apos;修改后:&apos;+str(self.__score))        s1 = Student(1,2)        #s1.__marking(-1)      # 访问私有方法报错：&apos;Student&apos; object has no attribute &apos;__marking&apos;        s1.__score = -1        print(s1.__score)   # 访问私有变量，成功修改        #上述原因是：实际是利用py得动态属性，通过点的方式新添加了一个__score变量，原有私有变量并没有修改        #下面直接访问会发现 访问报错 ：&apos;Student&apos; object has no attribute &apos;__score&apos;        s2 = Student(1,2)        print(s2.__score)     可以利用__dict__内容验证：        print(s1.__dict__)        输出：            {&apos;name&apos;: 1, &apos;_Student__score&apos;: &apos;0&apos;, &apos;age&apos;: 2,&apos;_score&apos;:-1}        print(s2.__dict__)        输出：            {&apos;name&apos;: 1, &apos;_Student__score&apos;: &apos;0&apos;, &apos;age&apos;: 2}        分析上述发现：            其实私有变量会被改名，此处由__score变为了_Student__score，所以访问原名是访问不到的            比较两次打印，会发现s1.__score = -1 这句话其实会添加一个__score变量，而没有修改原来的score。因为原来的socre已经被改名了        上述发现：            其实Python没有完善的私有变量机制，其仅仅是通过改名，如果使用_Student__score来操作，仍然可以完成修改</code></pre><h4 id="面向对象的特性：继承"><a href="#面向对象的特性：继承" class="headerlink" title="面向对象的特性：继承"></a><strong>面向对象的特性：继承</strong></h4><pre><code>三大特性：继承、封装、多态封装：类就是从现实世界的角度对变量和方法进行封装，很抽象比较难讲清楚类的组成：变量和方法继承作用：避免定义重复的方法和重复的变量推荐一个模块创建一个类对于以下示例：    c2模块的Human代码如下：        class Human():            sum = 0            def __init__(self, name, age):                self.name = name                self.age = age            def get_name(self):                print(self.name)    子类Student如下：        from c2 import Human        class Student(Human):  # 标准的继承方法            sum = 0            def __init__(self,name,age):                 self.name = name                self.age = age                self.__score = 0                print(&apos;初值为：&apos;+str(self.__score))        s = Student(&apos;Tom&apos;,13)  # 实例化子类时，要按照父类的构造函数传参        print(s.sum)        print(Student.sum)  # 打印 0 表示子类继承了父类的类变量        print(s.name)   # 打印 Tom 表示子类继承了父类的实例变量        print(s.age)    # 打印 13 表示子类继承了父类的实例变量        s.get_name()   # 打印 Tom 表示子类继承了父类的实例方法    注意：        上述只是将Human父类的变量和方法提取到了子类中        Python允许多继承，一个子类可以有多个父类，一般用不到    进一步：        现在子类有自己独有的方法和变量        例如：Student类有school变量，那么其构造函数为school+父类构造参数    在子类里调用父类的函数，示例：        from c2 import Human        class Student(Human):  # 标准的继承方法            def __init__(self,school,name,age): # 父类构造参数是name age                self.school = school                Human.__init__(self,name,age)   #直接调用父类构造函数 传参                #注意此处父类构造参数要加上self，此处是！普通函数的调用！，传参缺一不可，self必不可少        s = Student(&apos;YangTz&apos;,&apos;Tom&apos;,13)        print(s.school) # 正确打印YangTz        print(s.name) # 正确打印Tom        print(s.age)# 正确打印13    开闭原则：        对扩展是开放的，对更改本身是关闭的    注意：        Human.__init__(self,name,age)        上述使用类，调用了实例方法，其实不推荐这样做，如果类调用一个实例方法，那么实例方法的 self 参数会成为一个普通参数，调用时应该被传入方法内        现在对于上述代码，如果父类改变，那么代码中涉及的地方全都要改，违反了开闭原则    引出：super() 通用调用方法，修改为：        super(Student,self).__init__(name,age)    注意：        这样修改父类时不需要修改这里的代码        super()目的是继承父类的同名方法，如__init__()或一些公共方法        对于一个普通实例方法do_something(self)，如果其和父类方法同名，那么会优先调用子类的此方法        但是如果修改为            def do_homework(self):                super(Student,self).do_homework()        那么此时表示子类的该实例方法继承了父类的该方法，此时调用会执行父类的do_something()</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的函数</title>
      <link href="/article/8bff.html"/>
      <url>/article/8bff.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="Python的内置的函数"><a href="#Python的内置的函数" class="headerlink" title="Python的内置的函数"></a><strong>Python的内置的函数</strong></h4><pre><code>round()    a = 1.12586    #保留小数的函数,四舍五入，参数为保留小数点后的位数    print(round(a,2))    快速查看内置函数功能：命令行直接输入python,进入RPEL，使用help()函数        &gt;&gt;&gt; help(round)            Help on built-in function round in module builtins:            round(...)            round(number[, ndigits]) -&gt; number            Round a number to a given precision in decimal digits (default 0 digits).            This returns an int when called with one argument, otherwise the            same type as the number. ndi打印出python之禅    &gt;&gt;&gt; import this        The Zen of Python, by Tim Peters        Beautiful is better than ugly.        Explicit is better than implicit.        Simple is better than complex.        Complex is better than complicated.        Flat is better than nested.        Sparse is better than dense.        Readability counts.        Special cases aren&apos;t special enough to break the rules.        Although practicality beats purity.        Errors should never pass silently.        Unless explicitly silenced.        In the face of ambiguity, refuse the temptation to guess.        There should be one-- and preferably only one --obvious way to do it.        Although that way may not be obvious at first unless you&apos;re Dutch.        Now is better than never.        Although never is often better than *right* now.        If the implementation is hard to explain, it&apos;s a bad idea.        If the implementation is easy to explain, it may be a good idea.        Namespaces are one honking great idea -- let&apos;s do more of those!</code></pre><h4 id="Python函数的特点："><a href="#Python函数的特点：" class="headerlink" title="Python函数的特点："></a><strong>Python函数的特点：</strong></h4><ol><li>功能性</li><li>隐藏细节</li><li>避免编写重复代码</li><li>组织代码</li><li>自定义函数</li></ol><h4 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a><strong>函数定义</strong></h4><pre><code>def funcname(parameter_list):    pass上述函数定义有以下特点：    1.parameter_list参数列表可以没有    2.可以使用 return 返回函数结果，如果不写，则认为返回 None    3.funcname不推荐与内置函数名相同，因为会同名并产生递归        对于递归而言默认只允许为995，应该使用：        #import sys        #sys.setrecursionlimit(1000000) 修改最大递归层数    4.对于函数不强制返回类型，可以动态返回类型</code></pre><h4 id="函数调用："><a href="#函数调用：" class="headerlink" title="函数调用："></a><strong>函数调用：</strong></h4><pre><code>def add(x,y):    return x+ydef printA(code):    print (code)    return    print(&quot;a&quot;) #return 后的代码不执行print(add(1,2),printA(&quot;abc&quot;)) #print(A,B,C)可以连续打印，打印在同一行打印：    abc            为什么先打印abc？    3 None         为什么打印None不换行？解释：    首先执行add函数，内部没有打印，但是返回3，暂存，接下来执行printA函数    此时printA内打印出abc，且printA没有return即返回值为None，此时，    print(3,None)，然后就在同一行打印出3，None，之前已经打印了abc</code></pre><h4 id="对于多个参数的函数调用："><a href="#对于多个参数的函数调用：" class="headerlink" title="对于多个参数的函数调用："></a><strong>对于多个参数的函数调用：</strong></h4><pre><code>def re_two_1(skill_1, skill_2):    re_1 = skill_1    re_2 = skill_2    return (re_1,re_2)def re_two_2(skill_1, skill_2):    re_1 = skill_1    re_2 = skill_2    return re_1,re_2print(re_two_1(1,2))    #打印 (1, 2)print(re_two_2(1,2))    #打印 (1, 2)注意：    不用显式的使用元组，直接逗号罗列即可返回一个元组拆分多个返回结果：    第一种方法：不推荐，只是使用无意义的下标        res = re_two_2(1,2)        print(res[0],res[1])     第二种方法：序列解包，有意义        r1,r2 = re_two_2(1,2)        print(r1,r2) </code></pre><h4 id="序列解包："><a href="#序列解包：" class="headerlink" title="序列解包："></a><strong>序列解包：</strong></h4><pre><code>必须严格对照，否则报错    a = 1    b = 2    c = 3    a,b,c = 1,2,3    print(a,b,c)这也是一种解包的形式    a = 1,2,3    c,d,e = a    print(c,d,e)</code></pre><h4 id="小贴士："><a href="#小贴士：" class="headerlink" title="小贴士："></a><strong>小贴士：</strong></h4><pre><code>a = 1b = 1等价于 a = b = 1</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="函数的参数类型"><a href="#函数的参数类型" class="headerlink" title="函数的参数类型"></a><strong>函数的参数类型</strong></h4><pre><code>调用上的区分：1.必须参数，在参数列表中定义的参数，必须按顺序传入，否则报错2.关键字参数，可以指定传入参数顺序，参数数量要对应，可以增加可读性    add(y = 3,x = 2)，这种形式调用，明确指定形参和实参的对应    def add(x,y):   形式参数x，y        return x+y    print(add(1,2)) 实际参数1,23.默认参数    如果函数输入过多，应该封装成对象，或者是添加默认参数    如果不是默认参数，那么形参实参必须严格对照正常的定义和调用：    def print_student(name,age,school):        print(name)        print(age)        print(school)print_student(&apos;Jack&apos;,18,&apos;清华&apos;)带默认参数的定义和调用：    def print_student_defalut(name,age,school= &apos;清华&apos;):        print(name)        print(age)        print(school)    print_student_defalut(&apos;Tommy&apos;,18)   不带默认值    print_student_defalut(&apos;Tommy&apos;,18,&apos;北大&apos;)            修改默认值    print_student_defalut(&apos;Tommy&apos;,18,school = &apos;北大&apos;)   修改默认值注意：    如果默认参数在必传参数的的中间，则报错：        def print_student_defalut(name,school= &apos;清华&apos;,age)        上述定义不合规则，应该必传在前，默认参数在后    如果有多个默认参数，例如2个，只想修改第二个默认参数时，必须使用关键字参数指明赋值        def add(a,b,c=1,d=&apos;加法&apos;)        上述只修改d时，调用add(2,3,&apos;减法&apos;)，这是错误的，默认参数列表对应错误    同样，多个默认参数在调用时，调用的形参也必须按照默认参数都放在后面的规范，不能夹杂调用        add(2,c=1,3,d=&apos;减法&apos;)        上述虽然使用了关键参数，但是夹杂定义，仍然报错4.可变参数    print(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;) 具有可变的形参列表    通过一般参数来实现可变输入：        def nomal(param):            print(param,type(param))        nomal((1,2,3,5))    输出#(1, 2, 3, 5) &lt;class &apos;tuple&apos;&gt;     可变输入形式：        def change(*param):            print(param,type(param))        change(1,2,3,5)     输出#(1, 2, 3, 5) &lt;class &apos;tuple&apos;&gt;    注意：        对于有动态参数的change函数，如果change((1,2,3)),传入元组        那么进入函数后会生成二维元组((1,2,3))，此时可以用change(*(1,2,3))        上述方式采用*号，将传入元组类似解包，去掉元组外壳</code></pre><h4 id="注意混合参数的调用："><a href="#注意混合参数的调用：" class="headerlink" title="注意混合参数的调用："></a><strong>注意混合参数的调用：</strong></h4><pre><code>def demo(param1,param2 = &apos;默认值&apos;,*param3):    print(param1,type(param))    print(param2,type(param))    print(param3,type(param))如果想跳过默认值，直接赋值可变参数，如下形式：        demo(1,2,3)这样仍然给 默认参数赋值2 ，这是不行的首先要修改默认参数，都放到最后    def demo(param1,,*param2,param3 = &apos;默认值&apos;):        print(param1,type(param))        print(param2,type(param))        print(param3,type(param))    如果想修改默认值，使用demo(1,2,3,&apos;修改&apos;),并不能达到目的，其会将(2,3,&apos;修改&apos;)作为可变参数然后：    正确方法是demo(1,2,3,param3 =&apos;修改&apos;)    上述方法，指明默认参数，而且可变参数也正确的识别为(2,3)综上，混合参数函数的调用比较复杂，在函数中尽量避免使用</code></pre><h4 id="高级传参："><a href="#高级传参：" class="headerlink" title="高级传参："></a><strong>高级传参：</strong></h4><pre><code>带可变参数的函数在调用时传入参数的解包：    def pingfanghe(*param):        sum = 0        for i in param:            sum += i*i        print(sum)    pingfanghe(1,2,3)           # 14    pingfanghe(*[1,2,3,4])      # 30    注意此处的*号使用**传入字典：    def print_age(**param):        print(param)    print_age(xiaoming=18,Tom=24,Lina=13)    # {&apos;xiaoming&apos;: 18, &apos;Tom&apos;: 24, &apos;Lina&apos;: 13}遍历字典;    def print_age1(**param):        for c in param:            print(c)    print_age1(xiaoming=18,Tom=24,Lina=13)    输出：        #Tom        #Lina        #xiaoming    def print_age2(**param):        for a,b in param:            print(b)    print_age2(xiaoming=18,Tom=24,Lina=13)    输出：        #Lina : 13        #xiaoming : 18        #Tom : 24传入字典：    dic = {&apos;xiaoming&apos;:18,&apos;Tom&apos;:24,&apos;Lina&apos;:13}    print_age2(**dic)    输出：        #xiaoming : 18        #Tom : 24        #Lina : 13    传入空值时什么都不做        print_age2()    输出空白指明传入字典的映射：    def print_age2(**param):        print(param)        for a,b in param:            print(a,b)    print_age2( Jack = 18,Tom = 24,Lina = 13) #注意使用方式</code></pre><h4 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a><strong>变量作用域</strong></h4><pre><code>示例代码：    c = 50  #全局变量    def add(x, y):        c = x + y   # 局部变量 c 作用域只是在函数内部，相当于新变量，与外部的 c 无关        print(c)    add(1,2)    # c = 3    print(c)    # c = 50注意：    对于控制语句，python的特性：        for while if 内定义的变量，在结束体之外也能访问            for x in range(0,3):            a = &apos;a&apos;            print(a)    # 可以输出a        for while if 内接收的变量，与for同级的变量可以直接引用            a = 10            for x in range(0,1):            print(a)       # 可以打印出10    原因：Python只有函数作用域，没有块作用域</code></pre><h4 id="函数的作用域：同变量一样"><a href="#函数的作用域：同变量一样" class="headerlink" title="函数的作用域：同变量一样"></a><strong>函数的作用域：同变量一样</strong></h4><pre><code>示例代码：    c = 1    def func1():        c = 2        def func2():            c = 3            print(c)        func2()     #func2作用域 只限于函数func1内    func1()         #调用func1最终会调用func2，然后执行打印</code></pre><h4 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a><strong>作用域链</strong></h4><pre><code>作用域具有逐级寻找的过程：    c = 1    def func1():        def func2():            print(c)    # 可以打印c，作用域链，逐级寻找            a = 2        func2()          func1()             print(a)    # 不可以打印a，作用域出错</code></pre><h4 id="global关键字："><a href="#global关键字：" class="headerlink" title="global关键字："></a><strong>global关键字：</strong></h4><pre><code>示例代码：    c = 1    def func1():        def func2():            print(c)    # 可以打印c，作用域链，逐级寻找            global a    # 注意这里使用global关键字            a = 2       # 注意：使用global a = 2 是错误的        func2()          func1()             print(a)    # global修饰后可以打印，同样体现了作用域链注意：    对于全局变量，包括global，可以在全部模块中都被使用，只需 import相关模块</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的项目代码结构</title>
      <link href="/article/7ad3.html"/>
      <url>/article/7ad3.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="Python项目的代码要求："><a href="#Python项目的代码要求：" class="headerlink" title="Python项目的代码要求："></a><strong>Python项目的代码要求：</strong></h4><pre><code>高性能，封装性（可复用）、抽象</code></pre><h4 id="自己写程序的要求："><a href="#自己写程序的要求：" class="headerlink" title="自己写程序的要求："></a><strong>自己写程序的要求：</strong></h4><pre><code>不单追求简单业务逻辑。更要考虑封装性</code></pre><h4 id="项目结构："><a href="#项目结构：" class="headerlink" title="项目结构："></a><strong>项目结构：</strong></h4><pre><code>顶级结构：  包      文件夹，类似jar，dll等二级结构：  模块    .py文件，单文件可包含多个类，也可以不定义类，但最好用类组织起来三级结构：  类                  函数、变量（类的特性）</code></pre><h4 id="包和模块的命名："><a href="#包和模块的命名：" class="headerlink" title="包和模块的命名："></a><strong>包和模块的命名：</strong></h4><pre><code>与文件夹和文件的名称相同</code></pre><h4 id="区分不同包的模块：使用命名空间"><a href="#区分不同包的模块：使用命名空间" class="headerlink" title="区分不同包的模块：使用命名空间"></a><strong>区分不同包的模块：使用命名空间</strong></h4><pre><code>baoA.modulebaoB.module</code></pre><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>包可以包含字包如果想让文件夹成为一个包，那么必须含有一个_init_.py文件    __init__.py叫做init模块，如果需要引用，形式    不是bao.__init__而是bao，用包的名称即 import bao 即可引入他</code></pre><h4 id="包的相互引入："><a href="#包的相互引入：" class="headerlink" title="包的相互引入："></a><strong>包的相互引入：</strong></h4><pre><code>引入的第一种方式    如果 import 包名，那么会引入执行该包的全部代码    对于包内模块的引入：        模块AB同级：            如果A模块引用B模块定义的变量param            那么需要在A模块内 import module_name            即：在A模块内：import B; print(B.param)，有严格的先后顺序        模块AB不同级：            加上包的命名空间即可:            import bao.B; print(bao.B.param)，            精简：import bao.B as m; print(m.param)，//缩短点引用    注意：        在python中一旦发生模块之间的import引用，就会在包下面生成pycache文件夹        __pycacahe__文件夹和期内的.pyc文件是自动生成的，与py虚拟机相关        在VSCODE中的配置页内的&quot;files.exculed&quot;中添加&quot;__pycache__&quot;:true,则会隐藏文件引入的第二种方式    使用from..import..        特点：可以引用单变量，也可以同import：form bao import B; print(bao.B.param)        例如 from bao.B import param ; print(param)        全部引入：             from bao.B import * ; 可以把B内变量全部引入，但是会混淆当前模块定义    控制需要引入的变量：仅适用本方式        例如在B模块中有三个变量，但只需import变量param，那么需要在        B模块中第一行：添加模块内置属性 __all__ = [&apos;param&apos;]        此时使用 from bao.B import *; 时只能导入param变量</code></pre><h4 id="规范的引入："><a href="#规范的引入：" class="headerlink" title="规范的引入："></a><strong>规范的引入：</strong></h4><pre><code>首先明确，python内一行代码字符不超过80个    from bao.B import a,b,c,d,e,f 如果需要换行，那么可以加反斜杠换行：        from bao.B import a,b,c,\        d,e,f    或者使用括号，保证其连接性（适用场景很多）：        from bao.B import (a,b,c,        d,e,f)</code></pre><h4 id="init-py的作用："><a href="#init-py的作用：" class="headerlink" title="init.py的作用："></a><strong><strong>init</strong>.py的作用：</strong></h4><pre><code>其相当于在全部代码前夹上init内的代码，引用包bao内的模块B时，会自动执行该包内的init模块例如：    引用包bao内的模块B时，自动执行bao内的init模块__init__的功能：    在init内，通过 __all__ = [&apos;B&apos;]来控制此包内能够被引用的模块    在init内，添加公共 import 的类库，    例如在包common内的init模块中添加公共库之后，在其他代码中只需 import common即可批量添加类库</code></pre><h4 id="引入的注意事项："><a href="#引入的注意事项：" class="headerlink" title="引入的注意事项："></a><strong>引入的注意事项：</strong></h4><pre><code>包和模块不会重复导入，类似static代码块，只导入一次避免循环导入    例如在模块A内 import B，在模块B内 import A 会陷入循环引入，要避免！    多模块间复杂引用时要避免因引用过多产生环链关注 import 引入的内容    一旦导入的是一个模块，则就会执行模块的全部代码    无论在代码中重复引入多少次，引入的模块都只会执行一次    搞清入口文件：运行test.py时，其实就是将其作为入口文件</code></pre><h4 id="模块的内置变量"><a href="#模块的内置变量" class="headerlink" title="模块的内置变量"></a><strong>模块的内置变量</strong></h4><pre><code>dir()函数：返回当前模块内的全部变量内置变量：    __builtins__    __cached__    __doc__          __file__        __loader__    __name__    __package__    __spec__用户自定义变量：    userA...</code></pre><h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a><strong>注意：</strong></h4><pre><code>内置变量跟变量完全一样，内容可以被修改</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong>   </p><h4 id="使用打印输出变量信息："><a href="#使用打印输出变量信息：" class="headerlink" title="使用打印输出变量信息："></a><strong>使用打印输出变量信息：</strong></h4><pre><code>print(&apos;name:&apos;+__name__)     print(&apos;pakage:&apos;+__package__)print(&apos;doc:&apos;+__doc__)print(&apos;file:&apos;+__file__)</code></pre><h4 id="错误信息排查："><a href="#错误信息排查：" class="headerlink" title="错误信息排查："></a><strong>错误信息排查：</strong></h4><pre><code>Traceback (most recent call last):File &quot;h:/mooc/test/a1.py&quot;, line 1, in &lt;module&gt;    import test1.a1File &quot;h:\mooc\test\test1\a1.py&quot;, line 3, in &lt;module&gt;    print(&apos;doc:&apos;+__doc__)TypeError: Can&apos;t convert &apos;NoneType&apos; object to str implicitly解释：    上述Traceback表示错误栈信息，会列出整个执行路径的全部出错信息，最后的Error是错误类型    应该先看最后的错误类型，然后通过错误栈来定位错误。</code></pre><h4 id="内置变量打印结果："><a href="#内置变量打印结果：" class="headerlink" title="内置变量打印结果："></a><strong>内置变量打印结果：</strong></h4><pre><code>name:test1.a                    模块的完整名称，带命名空间pakage:test1                    模块所属的包名doc:                            注释文件的注释信息    我是开头的注释file:h:\mooc\test\test1\a.py    当前模块的物理路径</code></pre><h4 id="对于打印未知字符串，可以使用容错处理"><a href="#对于打印未知字符串，可以使用容错处理" class="headerlink" title="对于打印未知字符串，可以使用容错处理"></a><strong>对于打印未知字符串，可以使用容错处理</strong></h4><pre><code>print(&quot;可能的NoneType类型：&quot; + param ) 修改为：print(&quot;可能的NoneType类型：&quot; + (param or &apos;空值&apos;))</code></pre><p>（区别与上面的普通模块输出）</p><h4 id="如果一个py文件被当做入口文件：那么此文件的"><a href="#如果一个py文件被当做入口文件：那么此文件的" class="headerlink" title="如果一个py文件被当做入口文件：那么此文件的"></a><strong>如果一个py文件被当做入口文件：那么此文件的</strong></h4><pre><code>__name__ = &apos;__main__&apos;，其会被强制改变，不在为文件名__package__ = &apos;NoneType&apos;即，入口文件不属于任何包__file__ = &apos;执行时的路径&apos;，即使用python 1/2/3.py时，此变量为1/2/3.py值不确定</code></pre><h4 id="另外："><a href="#另外：" class="headerlink" title="另外："></a><strong>另外：</strong></h4><pre><code>import sysprint(dir(sys)) 打印系统内置变量，比模块的内置变量更多</code></pre><h4 id="内置变量-name-的作用"><a href="#内置变量-name-的作用" class="headerlink" title="内置变量 name 的作用"></a><strong>内置变量 <strong>name</strong> 的作用</strong></h4><pre><code>判断当前模块是否是被作为入口文件：    if __name__ == &apos;__main__&apos;:        print(&apos;是入口文件，单独执行&apos;)    else：        print(&apos;作为模块被调用&apos;)上述代码在a.py中，分别用a1调用和单独执行a：注意路径区别    a.py  在包test/test1下     a1.py 在包test下，代码是 import test1.aH:\mooc\test\test1&gt;python a.py 或 H:\mooc\test&gt;python test1\a.py    是入口文件，单独执行    name:__main__                   pakage:没有上一层的包      //注意    doc:        我是开头的注释    file:h:/mooc/test/test1/a.pyH:\mooc\test&gt;python a1.py    作为模块被调用    name:test1.a              //注意    pakage:test1    doc:        我是开头的注释    file:h:\mooc\test\test1\a.py将可执行的文件当做模块来调用： H:\mooc\test&gt;python -m test1.a     是入口文件，单独执行    name:__main__    pakage:test1              //注意    doc:        我是开头的注释    file:H:\mooc\test\test1\a.py注意上述三中运行方式的区别！！！！</code></pre><h4 id="包和模块导入时的绝对和相对路径"><a href="#包和模块导入时的绝对和相对路径" class="headerlink" title="包和模块导入时的绝对和相对路径"></a><strong>包和模块导入时的绝对和相对路径</strong></h4><pre><code>顶级包，与入口文件的位置有关顶级包是相对于入口文件以外的文件来说的，对于一个项目，在入口文件中需要import 包路径.模块名而包路径就关乎顶级包的正确确定</code></pre><h4 id="绝对引入：import-包路径-模块名"><a href="#绝对引入：import-包路径-模块名" class="headerlink" title="绝对引入：import 包路径.模块名"></a><strong>绝对引入：import 包路径.模块名</strong></h4><pre><code>其中的包路径必须从顶级包开始</code></pre><h4 id="相对引入：使用"><a href="#相对引入：使用" class="headerlink" title="相对引入：使用"></a><strong>相对引入：使用</strong></h4><pre><code>from .module    表示引入同级的模块from ..module   表示引入上一层的模块注意：    import 方式不能使用 . 方式    可以使用 from .module import x 的方式        但是，入口文件不能使用 .module 相对引入    另外，如果待引用模块位于入口文件的同一层。那么无法点引入，会报错        错误：尝试引用一个超过顶级包的模块相对引入的机制：    使用内置变量__name__来找到模块，    因此，入口文件的name是‘_main_’，    所以如果想在‘入口文件这一层引入模块’，那么只能绝对引入    如果在‘入口文件的上一层’，并使用 python -m module 仍然可以使用相对引入，        因为这种方式，文件仍然是入口文件，但是__name__不会改变，故能够使用相对引入</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的控制流</title>
      <link href="/article/2582.html"/>
      <url>/article/2582.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h3 id="使用分支时注意"><a href="#使用分支时注意" class="headerlink" title="使用分支时注意"></a>使用分支时注意</h3><h4 id="变量命名规范："><a href="#变量命名规范：" class="headerlink" title="变量命名规范："></a>变量命名规范：</h4><pre><code>用户名：user_name,按下划线而不是驼峰</code></pre><h4 id="条件控制"><a href="#条件控制" class="headerlink" title="条件控制"></a>条件控制</h4><pre><code>if else</code></pre><h4 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h4><pre><code>for while break continue</code></pre><h4 id="分支控制"><a href="#分支控制" class="headerlink" title="分支控制"></a>分支控制</h4><pre><code>没有switch没有goto</code></pre><h3 id="Python的if控制"><a href="#Python的if控制" class="headerlink" title="Python的if控制"></a>Python的if控制</h3><h4 id="判断元素为空："><a href="#判断元素为空：" class="headerlink" title="判断元素为空："></a>判断元素为空：</h4><pre><code>if not [] :    print(&apos;该元素为空&apos;) </code></pre><h4 id="判断输入用户输入变量是否正确："><a href="#判断输入用户输入变量是否正确：" class="headerlink" title="判断输入用户输入变量是否正确："></a>判断输入用户输入变量是否正确：</h4><pre><code>account = &apos;admin&apos; passwd = &apos;admin&apos;print(&apos;input:&apos;)i_account = input()print(&apos;input:&apos;)i_passwd = input()if (i_account == account) and (i_passwd == passwd):    print(&apos;success&apos;)else:    print(&apos;error&apos;)    </code></pre><h4 id="程序规范问题："><a href="#程序规范问题：" class="headerlink" title="程序规范问题："></a>程序规范问题：</h4><pre><code>不合法的变量定义：    [pylint] C0103:Invalid constant name &quot;account&quot;      python没有常量机制，但是有默认规范：        常量变量名要：全部大写！（包括串常量和输入值！）缺失模块定义：    [pylint] C0103:Invalid module name &quot;Untitled-1&quot;    [pylint] C0111:Missing module docstring        每个文件第一行需要进行此代码段的模块说明，使用块注释！其他错误：    pylint监测    另外，python代码隔离用四个空格或Tab</code></pre><h4 id="使用snippet片段快捷的定义各种-python代码段，循环、类、函数等等"><a href="#使用snippet片段快捷的定义各种-python代码段，循环、类、函数等等" class="headerlink" title="使用snippet片段快捷的定义各种 python代码段，循环、类、函数等等"></a>使用snippet片段快捷的定义各种 python代码段，循环、类、函数等等</h4><pre><code>if condition:    pass    #pass是空语句，占位语句，如果什么都不写，则会报错else:    pass            这均作为结构体，有变量作用域的问题嵌套控制    多个if嵌套，封装：提取为函数，具体逻辑封装到函数中        单程控制    if elif else，同一级别完成多个判断（python没有开关控制switch！）        替换switch：    多个elif、使用dict字典    参见python.doc.org//程序设计的F&amp;Q</code></pre><h4 id="对于input-："><a href="#对于input-：" class="headerlink" title="对于input()："></a>对于input()：</h4><pre><code>动态型语言，输入类型不可控，且输入后并不报错接收到的值为字符串，如果需要整形：则需要int()转换</code></pre><h4 id="if用法实例，判断输入："><a href="#if用法实例，判断输入：" class="headerlink" title="if用法实例，判断输入："></a>if用法实例，判断输入：</h4><pre><code>ACCOUNT = &apos;admin&apos;PASSWD = &apos;admin&apos;ACCOUNT1 = input()PASSWD2 = input()if (ACCOUNT1 == ACCOUNT) and (PASSWD2 == PASSWD):    print(&apos;success&apos;)else:    print(&apos;error&apos;)   </code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong>        </p><h3 id="Python的循环控制"><a href="#Python的循环控制" class="headerlink" title="Python的循环控制"></a>Python的循环控制</h3><h4 id="while循环："><a href="#while循环：" class="headerlink" title="while循环："></a>while循环：</h4><pre><code>直到型循环，直到目标之后才结束循环适合于递归</code></pre><h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><pre><code>CONDITION = Truewhile CONDITION:    CONDITION = bool(input())    print(1)else:    print(2)</code></pre><h4 id="for循环："><a href="#for循环：" class="headerlink" title="for循环："></a>for循环：</h4><pre><code>适用于序列、集合字典的遍历！直接取的就是元素，会去掉外层包装</code></pre><h4 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h4><pre><code>for x in [1,[&apos;a&apos;,&apos;b&apos;],3,(4,5)]:    if not isinstance(x,int):        for y in x:            print(y)    else:        print(x) </code></pre><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><pre><code>for-else,while-else循环的最后会执行，一般用不到</code></pre><h4 id="循环的跳出"><a href="#循环的跳出" class="headerlink" title="循环的跳出"></a>循环的跳出</h4><pre><code>break 跳出循环，终止循环,对于for-else,while-else，不会执行elsecontinue 跳出当前循环，会执行else</code></pre><h4 id="示例：-2"><a href="#示例：-2" class="headerlink" title="示例："></a>示例：</h4><pre><code>for x in [1,2,3]:    if x == 2:        continue    print(x)else:    print(&apos;EOF&apos;)</code></pre><h4 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h4><pre><code>均作用于当前循环，多层循环要多个breakPython的for循环没有类似Java的指定次数的形式    类似for(int i=0;i&lt;10;i++):        for x in range(0,10):            print(x)    类似for(int i=0;i&lt;10;i+=2):步长为2        for x in range(0,10,-2):            print(x,end=&apos;-\n&apos;)       类似for(int i=10;i&gt;0;i-=2):递减        for x in range(10,0,-2):            print(x,end=&apos;\n&apos;)   #print带参数独有的特性：    用for打印间隔步长的元素：        a = [1,2,3,4,5,6,7,8]        for x in range(0,len(a),2):            print(a[x],end=&apos; &apos;)        #输出 1 3 5 7     用切片用法取间隔元素：        print(a[0:len(a):2])        #输出 [1, 3, 5, 7]&apos;&apos;&apos;</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python的变量</title>
      <link href="/article/f569.html"/>
      <url>/article/f569.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h4 id="变量不说“定义”！"><a href="#变量不说“定义”！" class="headerlink" title="变量不说“定义”！"></a>变量不说“定义”！</h4><h4 id="使用变量-“-变量名称-变量类型-”"><a href="#使用变量-“-变量名称-变量类型-”" class="headerlink" title="使用变量    “ 变量名称 = 变量类型 ”"></a>使用变量    “ 变量名称 = 变量类型 ”</h4><pre><code>a = {&apos;name&apos;:&apos;tom&apos;,&apos;sex&apos;:&apos;wm&apos;}</code></pre><h4 id="变量命名规范："><a href="#变量命名规范：" class="headerlink" title="变量命名规范："></a>变量命名规范：</h4><blockquote><p>   首字母不能是数字，字母数字下划线组合，_1 = 1  是合法的<br>    注意：保留字不能用，但函数名可以用，但不要用！<br>        type = 1;不报错，但是type(1)时则报错！<br>    变量是动态赋值，num = 1; num = True 是合法的</p></blockquote><h4 id="变量接收的赋值类型，后续操作若操作引用类型，则源头修改，下游皆改"><a href="#变量接收的赋值类型，后续操作若操作引用类型，则源头修改，下游皆改" class="headerlink" title="变量接收的赋值类型，后续操作若操作引用类型，则源头修改，下游皆改"></a>变量接收的赋值类型，后续操作若操作引用类型，则源头修改，下游皆改</h4><pre><code>对一般赋值·后来者与数据源无关   [值类型]    a = 1;b = a;a = 2;          print(b) = 1    a = &apos;a&apos;;b = a;a = 2;        print(b) = &apos;a&apos;    a = (1,2);b = a;a = 2;      print(b) = (1,2)对于传递后修改了数据源的动态类型，那么则会传导!!    [引用类型]    a = [1,2];b = a;a[0] = 2;   print(b) = [2,2]    //注意！    a = (1,2);b = a;a[0] = 2;   print(b)            //会报错总结：（两类型与是否为序列无关）    值类型：    字符串str、整形int、元组tuple    引用类型：  列表list、集合set，字典dict</code></pre><h4 id="对于字符串-字符串是值类型，不可改变-相加："><a href="#对于字符串-字符串是值类型，不可改变-相加：" class="headerlink" title="对于字符串(字符串是值类型，不可改变)相加："></a>对于字符串(字符串是值类型，不可改变)相加：</h4><pre><code>对于a = &apos;1&apos;,a += &apos;2&apos; 结果为&apos;12&apos;，其并不是原串的改变    &gt;&gt;&gt; a = &apos;1&apos;     id(a) = 10322752    初始赋值的内存地址    &gt;&gt;&gt; a += &apos;2&apos;    id(a) = 55621088    相加后a的地址发生改变上述结果不违背str是值类型，故&apos;string&apos;[0] = &apos;a&apos;,是错误的！</code></pre><h4 id="tuple-list的区别"><a href="#tuple-list的区别" class="headerlink" title="tuple list的区别"></a>tuple list的区别</h4><pre><code>访问：    两者均可通过Array[id]访问元素，并可以多维访问[i][j]    a = (1,2,[3,4,[5]]);    a[2][2][0] = 5赋值：    列表list：        &gt;&gt;&gt; a = [1,2,3]     hex(id(a)) = &apos;0x34d2f48&apos;        &gt;&gt;&gt; a[0] = 2        hex(id(a)) = &apos;0x34d2f48&apos;    元组tuple：        &gt;&gt;&gt; a = (1,2,3) a[0] = 2 这是错误的，因为元组是值类型    注意：对于元组中的可变类型，依然可以动态修改        &gt;&gt;&gt; a = (1,2,[3,4,[5]]) a[2][0] = 8;        &gt;&gt;&gt; a = (1,2,[8,4,[5]]) 正常完成修改追加元素：    列表list：        &gt;&gt;&gt; b = [1,2]    b.append(4)  b = [1, 2, 4]    元组tuple：        值类型，没有append方法总结：列表是动态的，元组定义后不可变的，这是针对元素的说法，      与包装外皮无关，比如元组中的列表依然可以修改</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><pre><code>python特有的运算符    算术运算符        +       &apos;a&apos; + &apos;b&apos; = &apos;ab&apos;        -       {1,2} - {1} = {2}        *       [1,2] * 2 = [1,2,1,2]        /       3/2 = 1.5 3//2 = 1        %       5 % 2 = 1           取余        **      2 ** 2 = 4          N次方    赋值运算符                  *=      算数运算符后跟等号                python没有自增运算符，i++ 是错误的    比较、关系运算符            ==      比较两个类型是否相等，                对于元组等复杂类型，元素类型相同时可以比较长度                返回结果是bool类型！    逻辑运算符                  and     True and True = True            且        or      False or False = False          或        not     单目运算符：not False = True    非                返回值不一定是bool类型的形式！    成员运算符                  in      在，一个元素是否在另外一组元素        not in  不在                返回值为bool类型！    身份运算符                  is      (object)        is not  (object)                返回值为bool类型!    位运算符        &amp;       按位与，双目        |       按位或        ^       按位异或        ~       按位取反        &lt;&lt;      左移        &gt;&gt;      右移                注意：均会转化为二进制数运算运算符结合顺序：从右往左    b = 1, b+=b&gt;=1 即 b = b + True复杂类型的比较：    &apos;a&apos; &gt; &apos;b&apos; = False       因为 ord(&apos;a&apos;) &lt; ord(&apos;b&apos;)    &apos;ab&apos;&gt; &apos;aa&apos;= True        字典比较    [1,2] &lt; [2,3] = True    相同的按元素比较    (1,2) &lt; (2,3) = True    同上，注意 (1,2) &lt; (2,1) = True    对于动态类型列表和集合{}，其不能比较，返回值均为false复杂类型逻辑运算：    not 0 = True    not &apos;a&apos; = False     本质只能操作bool类型，整形和字符串都能转换为bool类型    转换规则：        对于int，float，0被认为是False，其余均是True        对于str，空串&apos;&apos;被认为是False，其余均是True        对于list，空列表[]被认为是False，其余均为True        其余类似        [] or [1] = [1] 返回的是True值的形式，但不一定是bool型        &apos;&apos; and &apos;a&apos; = &apos;&apos; 返回False值的形式，&apos;&apos;即为False形式        注意：            1 and 2 = 2， 2 and 1 = 1 必须检测后者，就近返回            1 or 2  = 1， 2 or 1 = 2  此处只需看前者，就近返回复杂成员运算：    对于非数值类型，str、tuple、list、set、dict判断元素在不在        对于除字典以外：&apos;a&apos; in (1,(1,&apos;a&apos;)) = False，只        对于dict：只能检查key值在不在，不能检查value    对于数值类型，包括int、float、bool，不能使用，否则会报错身份运算符：    与关系运算符 == 无关！    身份符比较的是身份！身份：暂时理解为内存地址的比较    &gt;&gt;&gt; 1 is 1 = True        值类型    &gt;&gt;&gt; {1} is {1} = False   引用型    &gt;&gt;&gt; (1,2) == (2,1) False 序列，位置固定，按位置比较    &gt;&gt;&gt; (1,2) is (2,1) False 内存不同    &gt;&gt;&gt; {1,2} == {2,1} True  无序集合，表示内容相同！不说‘相等’！    &gt;&gt;&gt; {1,2} is {2,1} False 内存不同对于两个变量、或对象的三特征：值(==)、身份(is)、类型(isinstance)        a = &apos;hello&apos;, type(a)==str是True，这种方式不推荐    注意：        上述方法不能判断a的子类是否是str        下面的方法可以判断a的子类是不是某种类型    判断对象类型：        isinstance(a,str) = True        isinstance(a,(int,str))) = True 可以一次判断多种类型位运算符    按位与      2 &amp; 3 = 0b10 &amp; 0b11 = 0b10 = 2        按位或      2 | 3 = 0b10 &amp; 0b11 = 0b11 = 3    按位异或    2 ^ 3 = 0b10 &amp; 0b11 = 0b01 = 1</code></pre><h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><pre><code>表达式 Expression = 运算符 operator + 操作数 operand注意：    上述运算符，包括上一节中的七大运算符    运算符都有优先级顺序：1 or 2 and 3 = 1 or (2 and 3) = 1 or 3 = 1     括号优先级最高！然后是次幂运算    详细优先级可查    执行顺序原则：        不同优先级：按优先级进行先后计算        相同优先级：解释器从左向右解释（左结合），        上述比较的是优先级，而不是运算符类型，自定义顺序推荐用（括号）        对于 = ：        其优先级高于or，但是a = 1 or 0，则会先计算or，不会按优先级顺序上述叫做基本类型与基本概念 命令行操作正经编程开发，需要使用文件，在cmd中用   python file.py 运行常用IDE：    pycharm     复杂项目首选，自动化步骤，功能强大    vscode      初学推荐     sublimevscode：    ctrl+` 弹出终端，目录可能不对，点击文件，在终端中即可打开    零插件即可运行python代码    智能感知（完整需要安装插件python、terminal）、断点调试    语句不强制要求加分号，不需要加大括号，不建议使用分号    注意：        Python是使用‘缩进’来区分代码段，不能压缩，开源友好        #单行注释        三引号：多行注释</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python基本的变量类型</title>
      <link href="/article/8da4.html"/>
      <url>/article/8da4.html</url>
      
        <content type="html"><![CDATA[<pre><code>注：此为慕课网Python（不打广告）视频的观看笔记，只做记录之用，并未勘误。</code></pre><a id="more"></a><h3 id="初识："><a href="#初识：" class="headerlink" title="初识："></a>初识：</h3><pre><code>    print(&apos;hello world&apos;)    print(&quot;hello world&quot;)    print(&apos;hello&apos;,&apos;world&apos;)错误方式：    ERROR:print &apos;hello&apos;    ERROR:print &quot;hello&quot;</code></pre><h3 id="Python基本数据类型："><a href="#Python基本数据类型：" class="headerlink" title="Python基本数据类型："></a>Python基本数据类型：</h3><ul><li>类型：    Number包括整数+小数</li><li>整数：    int</li><li>浮点数：float（不分精度）</li><li>布尔型：bool</li><li>复数：    complex // 36j</li></ul><h4 id="简单运算"><a href="#简单运算" class="headerlink" title="简单运算"></a>简单运算</h4><pre><code>判断数据类型 type(param)类型合并原则：    向精度更高的方向合并，结果为高精度示例：    type(1+1.1111111)  为float类型    type(1*1.1111111) 为float类型    type(2/2) float    type(2//2) int 结果为整形    2/2 = 1.0    2//2 = 1    1//2 = 0     1/2 = 0.5    注意：        符号 /  自动转换类型        符号 // 整除，向下取整注意：    Python2中有long类型，3版本后去掉    错误的方式：数字+字符串，这里不同于Java，不能直接相加</code></pre><h4 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h4><pre><code>形式：    int类型的不同进制示例：    type(0xFFFFF) 均为int类型    但是，其默认转为进制计算，如下：        &gt;&gt;&gt; 0xFFFFF        1048575注意：    逗号运算符，自动拼为元组    &gt;&gt;&gt; 0x0,&apos;1&apos;    (0, &apos;1&apos;)    可以混合，可以识别元组</code></pre><h4 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h4><pre><code>表示：    二进制 [b]  0b0101 = 十进制 5     八进制 [o]  0o10   = 十进制 8     16进制 [x]  0xF    = 十进制 15转换-利用方法       任意进制-&gt;二进制：bin() bin(10) = &apos;0b1010&apos;    任意进制-&gt;十进制：int()    任意进制-&gt;16进制：hex()    任意进制-&gt;八进制：oct()</code></pre><h4 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h4><pre><code>形式：    True  ERROR:true.TRUE转化：    int(True) = 1     bool(1) = True注意：    无论正负小数，只要非零，皆为True示例：    &gt;&gt;&gt; bool(&apos;&apos;)    False    &gt;&gt;&gt; bool(&apos;a&apos;)    True    &gt;&gt;&gt; bool([]) //列表    False    &gt;&gt;&gt; bool([1,2,3])    True注意：    False = 0 . [] . {} . &apos;&apos; 。 None 均为假</code></pre><h4 id="字符串-str"><a href="#字符串-str" class="headerlink" title="字符串:str"></a>字符串:str</h4><pre><code>形式：    &apos;&apos;单引号    &quot;&quot;双引号       &apos;&apos;&apos;-&apos;&apos;&apos;或者&quot;&quot;&quot;-&quot;&quot;&quot;三引号 含换行的字符串输入示例：    正确的:&quot; It&apos;s me.&quot;    正确的:&apos; It\&apos;s me.&apos; 可以转义    正确的:&apos; He is &quot;. &apos; 双引号在内三引号：    可以在代码中换行输入    代码：        &gt;&gt;&gt; &apos;&apos;&apos;2&apos;        22&apos;        222222&apos;        2&apos;&apos;&apos;&apos;&apos;        &quot;2&apos;\n22&apos;\n222222&apos;\n2&quot;显示换行：    需要使用print    代码：        &gt;&gt;&gt; &quot;2&apos;\n22&apos;\n222222&apos;\n2&quot;        &quot;2&apos;\n22&apos;\n222222&apos;\n2&quot;        &gt;&gt;&gt; print(&quot;2&apos;\n22&apos;\n222222&apos;\n2&quot;)        2&apos;        22&apos;        222222&apos;        2IDLE特点：    使用\也可以换行    代码：        &gt;&gt;&gt; &apos;hello\        world&apos;        &apos;helloworld&apos;注意：    转义字符，与语言本身有冲突    \n  \&apos;  \t     单个斜杠：\\    &apos;\\t&apos;= &apos;\t&apos;应用：        文件路径不允许单个\出现 C:\\windows    print(&apos;C:\\windows&apos;)    print(r&apos;C:\windows&apos;) 字符加r之后，可以忽略转义分歧</code></pre><h4 id="字符串操作方法"><a href="#字符串操作方法" class="headerlink" title="字符串操作方法"></a>字符串操作方法</h4><pre><code>形式：    运算符：只有 + * 没有 - /    取单值：[index]    取多值：[m:n]    串合并：&apos;a&apos;+&apos;b&apos; = &apos;ab&apos;    串分割：</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">   示例：</span><br><span class="line"></span><br><span class="line">str[index]：直接转为字符数组，</span><br><span class="line"></span><br><span class="line">&#39;who&#39;[ 0] &#x3D; &#39;w&#39;  参数为正·是数组下标</span><br><span class="line">&#39;who&#39;[-1] &#x3D; &#39;o&#39;  参数为负·是从右起第几个</span><br><span class="line"></span><br><span class="line">str[ m : n ]：截取一段，只有m或n时都不会返回单值</span><br><span class="line">str[ 起始 : 长度 ] ：</span><br><span class="line">不写起始 str[__: 长度 ]，默认为str[0 : 长度 ]</span><br><span class="line">不写长度 str[起始 : __ ]，默认为str[起始 : 截取到最右 ]</span><br><span class="line">&#39;who&#39;[0:0] &#x3D; &#39;&#39; </span><br><span class="line">注意第一个参数取得不是下标，&#39;who&#39;[0:] &#x3D; &#39;who&#39;</span><br><span class="line">注意第二个参数取得不是下标，&#39;who&#39;[0:0] 不是 &#39;who&#39;[ 0] </span><br><span class="line">&#39;who&#39;[0:3] &#x3D; &#39;who&#39;</span><br><span class="line">&#39;who&#39;[0:-2] &#x3D; &#39;w&#39;  </span><br><span class="line">从右起拿掉2位之后剩余‘w’</span><br><span class="line">&#39;who&#39;[0:10] </span><br><span class="line">多余位数自动丢弃，不会报错</span><br><span class="line">&#39;who&#39;[3:-2] &#x3D; &#39;&#39;        </span><br><span class="line">从左开始，数三位是o，从o开始，往左数两个，为&#39;&#39; </span><br><span class="line">&#39;who&#39;[-3:-2] &#x3D; &#39;w&#39;      </span><br><span class="line">从右开始，数三位是&#39;&#39;，从&#39;&#39;开始，即等效于&#39;who&#39;[0:-2] 从右往左数两个，为&#39;w&#39; </span><br><span class="line">&#39;who&#39;[-2:] &#x3D; &#39;ho&#39;   </span><br><span class="line">从w开始，截取到最右：ho</span><br></pre></td></tr></table></figure><h4 id="元组tuple"><a href="#元组tuple" class="headerlink" title="元组tuple"></a>元组tuple</h4><pre><code>多种方式：    &lt;class &apos;list&apos;&gt; 列表[]    元素可以混合    &lt;class &apos;tuple&apos;&gt;元组()    元素可以混合全空类型：    () , []定义方式：    type([1,2,3,&apos;a&apos;,False])    [1,2,3,[True,&apos;b&apos;],&apos;a&apos;] 嵌套列表    [,,,] 不能为空访问方式：    [1,2,3,4][0] = 1            取单值时，取出元素本身    [1,2,3,4][0:3] = [1,2,3]    取多值时，取出仍为列表操作方式：同串类似    + 操作 ：[1,2]+[3,4] = [1, 2, 3, 4]    * 操作 ：[1,2]*2 = [1, 2, 1, 2]     [1,2]*2 = []    上述操作结果均为一层列表包裹</code></pre><h4 id="列表和元组的区别："><a href="#列表和元组的区别：" class="headerlink" title="列表和元组的区别："></a>列表和元组的区别：</h4><pre><code>对待单元素的处理不同    type((&apos;a&apos;)) -- &lt;class &apos;str&apos;&gt; 作为运算符括号处理，规定    type([&apos;a&apos;]) -- &lt;class &apos;list&apos;&gt;     定义单元素元组 type((&apos;a&apos;,)) = (&apos;a&apos;)赋值的区别    元组(1,2)[0] = 1 是错误的，不支持赋值    列表[1,2][0] = 1 正确，结果为[2,2]</code></pre><h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><pre><code>int，float，bool，complex   简单类型str，list，tuple            称之为“序列”“序列”的共有操作：    取单值          序列[m]         有序号，有序    取多值(切片)    序列[m：n]      高级用法 序列[m：n：p] 共有的高级方法：    判断序列是否在本序列：in             &apos;a&apos; in &apos;abc&apos;或者2 in [1,2,3]或者2 in (1,2,3)        2 in [1,2,3] = True 反之：2 not in [1,2,3] = False    得到序列长度：        len(()) = 0     len(&apos;1234&apos;) = 4     得到序列最大最小元素：        max(),min() 去包装的返回值        max(&apos;abcd&apos;) = &apos;d&apos;                 按ASCII（ord(&apos;&apos;)）码值，空格等照样        max([(1,2),(1,2,3)]) = (1,2,3)    元组长度最大</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="无序：集合"><a href="#无序：集合" class="headerlink" title="无序：集合"></a>无序：集合</h4><pre><code>type({1,2,3,4}) = &lt;class &apos;set&apos;&gt;特性：    无序        序列操作方式不适用 集合，集合元素没有一个固定下标    不重复      {1,1,2,2,3,4} = {1,2,3,4}    公共        len(),  in, not in    集合运算    - &amp; |运算：    差集    {1,2,3} - {1} = {2,3}    交集    {1,2} &amp; {2,3} = {2}    并集    {1,2} | {2,3} = {1,2,3}    上述运算符中均不能出现{}空集合，另外结果会自动去掉重复注意：    直接使用{}定义的不是空集合，其类型为字典：&lt;class &apos;dict&apos;&gt;    定义空集合：set()，即为type(set()) = &lt;class &apos;set&apos;&gt;    列表内不能含有列表或者字典元素        {1,{1,2,3}}是错的，可以含有元组，字符串和整形的混合</code></pre><h4 id="无序：字典"><a href="#无序：字典" class="headerlink" title="无序：字典"></a>无序：字典</h4><pre><code>不是序列，类似于集合，但不同定义方式：    {&apos;name&apos;:&apos;tom&apos;,&apos;sex&apos;:&apos;wm&apos;}  type类型是   &lt;class &apos;dict&apos;&gt;取值：通过Key访问Value    {&apos;name&apos;:&apos;tom&apos;,&apos;sex&apos;:&apos;wm&apos;}[&apos;name&apos;] = &apos;tom&apos;    {(1,2):&apos;a&apos;,&apos;name&apos;:&apos;b&apos;,&apos;sex&apos;:&apos;wm&apos;}[(1,2)] = &apos;a&apos;    {&apos;name&apos;:&apos;a&apos;,&apos;name&apos;:&apos;b&apos;,&apos;sex&apos;:&apos;wm&apos;}[&apos;name&apos;] = &apos;b&apos;    字典不能有重复键值对，如果重复，运算之前会自动去重    字典的Key必须为不可变类型  int,str,tuple  list和set不行       字典的Value类型不限        {2:{2:&apos;a&apos;}}[2][2] = &apos;a&apos;    定义空字典：直接{}         type({}) = &lt;class &apos;dict&apos;&gt;</code></pre><h4 id="基本类型总结"><a href="#基本类型总结" class="headerlink" title="基本类型总结"></a>基本类型总结</h4><pre><code>int，float，bool，complex       1            1.2             False      20jstr，list，tuple                &apos;a&apos;          [1,2]  列表     (1,2) 元组    set，dict                       {1,2} 集合   {1:&quot;2&quot;}字典不可变类型    整形 布尔型 字符串 元组  int,bool,str,tuple可变类型    列表 集合 字典 [list],{set},{dict}集合 无序，无索引，不能切片字典 类似集合，不是序列</code></pre>]]></content>
      
      
      <categories>
          
          <category> Python学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>R语言的学习路线</title>
      <link href="/article/64af.html"/>
      <url>/article/64af.html</url>
      
        <content type="html"><![CDATA[<h4 id="初级入门"><a href="#初级入门" class="headerlink" title="初级入门"></a>初级入门</h4><blockquote><p>《An Introduction to R》，这是官方的入门小册子。其有中文版，由丁国徽翻译，译名为《R导论》。《R4Beginners》，这本小册子有中文版应该叫《R入门》。除此之外，还可以去读刘思喆的《153分钟学会R》。这本书收集了R初学者提问频率最高的153个问题。为什么叫153分钟呢？因为最初作者写了153个问题，阅读一个问题花费1分钟时间，全局下来也就是153分钟了。</p></blockquote><a id="more"></a><p>《R导论》<br>《153分钟学会R》<br>慕课网视频较少,主要有：<br>R语言基础：<a href="http://www.imooc.com/learn/446" target="_blank" rel="external nofollow noopener noreferrer">http://www.imooc.com/learn/446</a><br>R语言入门：<a href="http://www.imooc.com/learn/546" target="_blank" rel="external nofollow noopener noreferrer">http://www.imooc.com/learn/546</a><br>R语言入门进阶：<a href="http://www.imooc.com/learn/828" target="_blank" rel="external nofollow noopener noreferrer">http://www.imooc.com/learn/828</a><br>以下是从Youtube收集的资源：<br>R语言基础视频，总时长130分钟，讲解R语言的语法、数据结构以及数据操作<br><a href="https://www.youtube.com/playlist?list=PLO5e_-yXpYLBWwWiFiMYbeTDBGtRrnfKJ" target="_blank" rel="external nofollow noopener noreferrer">https://www.youtube.com/playlist?list=PLO5e_-yXpYLBWwWiFiMYbeTDBGtRrnfKJ</a><br>R语言基础视频，总时长170分钟，参照《R入门》进行系统讲解<br><a href="https://www.youtube.com/playlist?list=PLBTcf4SwWEI9_kCOJ-1o-Jwr-_Qb6bkeg" target="_blank" rel="external nofollow noopener noreferrer">https://www.youtube.com/playlist?list=PLBTcf4SwWEI9_kCOJ-1o-Jwr-_Qb6bkeg</a><br>Machine Learning, Data Mining, Statistics with R，英文讲述<br><a href="https://www.youtube.com/playlist?list=PLjPbBibKHH18I0mDb_H4uP3egypHIsvMn" target="_blank" rel="external nofollow noopener noreferrer">https://www.youtube.com/playlist?list=PLjPbBibKHH18I0mDb_H4uP3egypHIsvMn</a><br>R语言在数据科学领域中的应用 ：DATA SCIENCE WORKSHOP<br><a href="http://scientistcafe.com/" target="_blank" rel="external nofollow noopener noreferrer">http://scientistcafe.com/</a><br>R语言进阶，包括数据的可视、工具包的扩展等<br><a href="https://www.youtube.com/playlist?list=PLduWpQLOo6Y2rmylzNwOPAz2bLcc-6TF5" target="_blank" rel="external nofollow noopener noreferrer">https://www.youtube.com/playlist?list=PLduWpQLOo6Y2rmylzNwOPAz2bLcc-6TF5</a><br>关于一些常用的用法实例和统计分析实例，在W3CSchool有很详细的介绍：<br><a href="https://www.w3cschool.cn/r/" target="_blank" rel="external nofollow noopener noreferrer">https://www.w3cschool.cn/r/</a><br>另外的易佰教程：<a href="http://www.yiibai.com/r/" target="_blank" rel="external nofollow noopener noreferrer">http://www.yiibai.com/r/</a></p><h4 id="高级入门"><a href="#高级入门" class="headerlink" title="高级入门"></a>高级入门</h4><blockquote><p>读了上述书籍之后，你就可以去高级入门阶段了。这时候要读的书有两本很经典的。《Statistics with R》和《The R book》。之所以说这两本书高级，是因为这两本书已经不再限于R基础了，而是结合了数据分析的各种常见方法来写就的，比较系统的介绍了R在线性回归、方差分析、多元统计、R绘图、时间序列分析、数据挖掘等各方面的内容，看完之后你会发现，哇，原来R能做的事情这么多，而且做起来是那么简洁。读到这里已经差不多了，剩下的估计就是你要专门攻读的某个方面内容了。下面大致说一说。</p></blockquote><h4 id="绘图与可视化"><a href="#绘图与可视化" class="headerlink" title="绘图与可视化"></a>绘图与可视化</h4><blockquote><p>亚里斯多德说，“较其他感觉而言，人类更喜欢观看”。因此，绘图和可视化得到很多人的关注和重视。那么，如何学习R画图和数据可视化呢？再简单些，如何画直方图？如何往直方图上添加密度曲线呢？我想读完下面这几本书你就大致会明白了。<br>首先，画图入门可以读《R Graphics》，个人认为这本是比较经典的，全面介绍了R中绘图系统。该书对应的有一个网站，google之就可以了。更深入的可以读《Lattice：Multivariate Data Visualization with R》。上面这些都是比较普通的。当然，有比较文艺和优雅的——ggplot2系统，看《ggplot2：Elegant Graphics for Data Analysis》。还有数据挖掘方面的书：《Data Mining with Rattle and R》，主要是用Rattle软件，个人比较喜欢Rattle!当然，Rattle不是最好的，Rweka也很棒！再有就是交互图形的书了，著名的交互系统是ggobi，这个我已经喜欢两年多了，关于ggobi的书有《Interactive and Dynamic Graphics for Data Analysis With R and GGobi》，不过，也只是适宜入门，更多更全面的还是去ggobi的主页吧，上面有各种资料以及包的更新信息！<br>特别推荐一下，中文版绘图书籍有谢益辉的《现代统计图形》。</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="计量经济学"><a href="#计量经济学" class="headerlink" title="计量经济学"></a>计量经济学</h4><blockquote><p>关于计量经济学，首先推荐一本很薄的小册子:《Econometrics In R》，做入门用。然后，是《Applied Econometrics with R》，该书对应的R包是AER，可以安装之后配合使用，效果甚佳。计量经济学中很大一部分是关于时间序列分析的，这一块内容在下面的地方说。</p></blockquote><h4 id="时间序列分析"><a href="#时间序列分析" class="headerlink" title="时间序列分析"></a>时间序列分析</h4><blockquote><p>时间序列书籍的书籍分两类，一种是比较普适的书籍，典型的代表是：《Time Series Analysis and Its Applications ：with R examples》。该书介绍了各种时间序列分析的经典方法及实现各种经典方法的R代码，该书有中文版。如果不想买的话，建议去作者主页直接下载，英文版其实读起来很简单。时间序列分析中有一大块儿是关于金融时间序列分析的。这方面比较流行的书有两本《Analysis of financial time series》，这本书的最初是用的S-plus代码，不过新版已经以R代码为主了。这本书适合有时间序列分析基础和金融基础的人来看，因为书中关于时间序列分析的理论以及各种金融知识讲解的不是特别清楚，将极值理论计算VaR的部分就比较难看懂。另外一个比较有意思的是Rmetrics推出的《TimeSeriesFAQ》，这本书是金融时间序列入门的东西，讲的很基础，但是很难懂。对应的中文版有《金融时间序列分析常见问题集》，当然，目前还没有发出来。经济领域的时间序列有一种特殊的情况叫协整，很多人很关注这方面的理论，关心这个的可以看《Analysis of Integrated and Cointegrated Time Series with R》。最后，比较高级的一本书是关于小波分析的，看《Wavelet Methods in Statistics with R》。附加一点，关于时间序列聚类的书籍目前比较少见，是一个处女地，有志之士可以开垦之！</p></blockquote><h4 id="金融"><a href="#金融" class="headerlink" title="金融"></a>金融</h4><blockquote><p>金融的领域很广泛，如果是大金融的话，保险也要被纳入此间。用R做金融更多地需要掌握的是金融知识，只会数据分析技术意义寥寥。我觉得这些书对于懂金融、不同数据分析技术的人比较有用，只懂数据分析技术而不动金融知识的人看起来肯定如雾里看花，甚至有人会觉得金融分析比较低级。这方面比较经典的书籍有：《Advanced Topics in Analysis of Economic and Financial Data Using R》以及《Modelling Financial Time Series With S-plus》。金融产品定价之类的常常要用到随机微分方程，有一本叫《Simulation Inference Stochastic Differential Equations：with R examples》的书是关于这方面的内容的，有实例，内容还算详实!此外，是风险度量与管理类。比较经典的有《Simulation Techniques in Financial Risk Management》、《Modern Actuarial Risk Theory Using R》和《Quantitative Risk Management：Concepts, Techniques and Tools》。投资组合分析类和期权定价类可以分别看《Portfolio Optimization with R》和《Option Pricing and Estimation of Financial Models with R》。</p></blockquote><h4 id="数据挖掘"><a href="#数据挖掘" class="headerlink" title="数据挖掘"></a>数据挖掘</h4><blockquote><p>这方面的书，最经典的是《Data Mining with R》</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ML/R学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> R语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web数据接口开发的阶段总结</title>
      <link href="/article/d44.html"/>
      <url>/article/d44.html</url>
      
        <content type="html"><![CDATA[<h3 id="背景及要求"><a href="#背景及要求" class="headerlink" title="背景及要求"></a>背景及要求</h3><p>需要将数据提供方（对方）的数据同步到本地（我方）<br>目的是在本地维护一个与数据提供方一致的本地数据库（ORACLE）<br>数据提供方提出的方案就是我方开发一个Web接口供其调用<br>数据方给出其发送数据的格式等信息，即给出了接口规范</p><a id="more"></a><h3 id="交互情景"><a href="#交互情景" class="headerlink" title="交互情景"></a>交互情景</h3><p>对于实时数据，数据方在收集后每隔十分钟调用一次接口推送过来这些数据<br>我方接口对其推送数据进行解析并入库<br>对于先前历史数据，直接以文件方式提供给我方<br>我方直接用本地程序解析后入库，不通过接口</p><h3 id="推送数据的具体规范"><a href="#推送数据的具体规范" class="headerlink" title="推送数据的具体规范"></a>推送数据的具体规范</h3><p>原始数据采用的是XML格式的文本，先后经过base64编码和DES加密，之后对方推送至我方<br>原始数据是格式化且规范的，XML共分四级，第三级标签开始代表每一次操作的表数据<br>原始数据包含CLOB和BLOB类型的数据 - 插入Oracle时要额外处理<br>原始数据包含的字段每次都是不确定的<br>一次推送包含若干原始数据段，即本地入库时对表的操作也是不确定的<br>推送的数据量可能很大，一次推送纯文本大约20MB - 构造SQL语句时要额外处理，否则SQL语句会过长（超过4000）<br>数据对应表有5张，每个表平均100个字段左右</p><h3 id="对于历史数据"><a href="#对于历史数据" class="headerlink" title="对于历史数据"></a>对于历史数据</h3><p>数据就是一堆编码并加密了的字符串 - 对其处理与处理推送数据的逻辑差不多<br>此字符串非常长，文本大小约500MB - 在解密解码时只要加大内存限制就可以完成，但解析XML时需要SAXReader方式，dom方式的话要爆炸了<br>原始数据包含CLOB和BLOB类型的数据 - 插入Oracle时要额外处理<br>原始数据包含的字段每次都是不确定的<br>一次推送包含若干原始数据段，即本地入库时对表的操作也是不确定的</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="我方开发接口的情况"><a href="#我方开发接口的情况" class="headerlink" title="我方开发接口的情况"></a>我方开发接口的情况</h3><p>接口参数包括验证信息，和数据，就这两个参数<br>接口采用JAX-WS实现，原因是其实现比较简单且轻便，可以参照：真正的轻量级WebService框架 - 使用JAX-WS(JWS)发布WebService<br>接口任务一，DES解密并base64解码推送来的数据<br>— 解密方式一定要和对方的一致，这里直接用对方提供的加解密代码，并且对方告知了DES秘钥<br>— 解码就比较随意，base64解码都大同小异<br>接口任务二，用dom4j包来解析XML树，这里采用SAXReader的方式，原因上面说了<br>接口任务三，映射表名字段名，原始推送数据字段均为汉字，Oracle库中存的都是首字母大写<br>接口任务四，构造SQL语句，具体思想就是解析XML到第三级标签，这一级会包含所有&lt;插入字段名&gt;和&lt;插入字段值&gt;</p><h3 id="整个流程大致如下"><a href="#整个流程大致如下" class="headerlink" title="整个流程大致如下"></a>整个流程大致如下</h3><p><img src="http://img.blog.csdn.net/20170710175522138?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMjkzNTY0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt></p><h3 id="下面是上述叙述中遇到的问题："><a href="#下面是上述叙述中遇到的问题：" class="headerlink" title="下面是上述叙述中遇到的问题："></a>下面是上述叙述中遇到的问题：</h3><ul><li>如何按原始数据中的汉语字段建立数据表</li><li>如何监控接口的情况也是问题，生成日志是解决之道</li><li>乱码问题！!服务器？编译时？原数据？UTF-8？GBK？到底是谁的锅</li><li>如何将原始字段快速映射成我即将将其插入到表中的对应字段</li><li>Oracle字段的符号要求，废了很多时间</li><li>大量字段中含少量CLOB字段时，对CLOB类型的数据使用jdbc插入数据库</li><li>大量字段中含少量BLOB字段时，对BLOB类型的数据使用jdbc插入数据库，这个费了一番功夫</li><li>整明白插入时，涉及大量字段操作时，对数据的增量更新也是问题</li><li>SQL语句如何执行，批量还是单独，这是个问题</li><li>程序循环过多导致Oracle连接游标数超出限制的问题</li></ul><p>以上问题先放着，抽空再逐个分析，如果上述包括了您急需解决的问题，请@我我会尽快回复我的解决办法，或许对您会有帮助。</p><h3 id="对于接口的传输性能"><a href="#对于接口的传输性能" class="headerlink" title="对于接口的传输性能"></a>对于接口的传输性能</h3><ul><li>开始时错误的以为历史数据也要通过接口方式调用，就对JWS发布的这个接口进行了一下测试，发现接口的极限是200M左右 </li><li>也就是说调用接口时，传入参数的字符串大小可以为200M没问题 </li><li>上述都是废话，正常是不允许出现上述情况的</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> WebService </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kettle对接Hadoop</title>
      <link href="/article/53aa.html"/>
      <url>/article/53aa.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-46.2kB"></p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-63.7kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-94.7kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-69.9kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-13.5kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-12.9kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-36.3kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-123.1kB"></p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-45.9kB"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> Kettle </tag>
            
            <tag> 整合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web接口开发的相关事项</title>
      <link href="/article/7b5b.html"/>
      <url>/article/7b5b.html</url>
      
        <content type="html"><![CDATA[<h4 id="本次任务的具体背景及要求："><a href="#本次任务的具体背景及要求：" class="headerlink" title="本次任务的具体背景及要求："></a>本次任务的具体背景及要求：</h4><ul><li>需要将数据提供方（对方）的数据同步到本地（我方）</li><li>目的是在本地维护一个与数据提供方一致的本地数据库（ORACLE）</li><li>数据提供方提出的方案就是我方开发一个Web接口供其调用</li><li>数据方给出其发送数据的格式等信息，即给出了接口规范</li></ul><a id="more"></a><h4 id="本次任务的交互情景："><a href="#本次任务的交互情景：" class="headerlink" title="本次任务的交互情景："></a>本次任务的交互情景：</h4><ul><li>对于实时数据，数据方在收集后每隔十分钟调用一次接口推送过来这些数据</li><li>我方接口对其推送数据进行解析并入库</li><li>对于先前历史数据，直接以文件方式提供给我方</li><li>我方直接用本地程序解析后入库，不通过接口</li></ul><h4 id="推送数据的具体规范："><a href="#推送数据的具体规范：" class="headerlink" title="推送数据的具体规范："></a>推送数据的具体规范：</h4><ul><li>原始数据采用的是XML格式的文本，先后经过base64编码和DES加密，之后对方推送至我方</li><li>原始数据是格式化且规范的，XML共分四级，第三级标签开始代表每一次操作的表数据</li><li>原始数据包含CLOB和BLOB类型的数据 - 插入Oracle时要额外处理</li><li>原始数据包含的字段每次都是不确定的</li><li>一次推送包含若干原始数据段，即本地入库时对表的操作也是不确定的</li><li>推送的数据量可能很大，一次推送纯文本大约20MB - 构造SQL语句时要额外处理，否则SQL语句会过长（超过4000）</li><li>数据对应表有5张，每个表平均100个字段左右</li></ul><h4 id="对于历史数据："><a href="#对于历史数据：" class="headerlink" title="对于历史数据："></a>对于历史数据：</h4><ul><li>数据就是一堆编码并加密了的字符串 - 对其处理与处理推送数据的逻辑差不多</li><li>此字符串非常长，文本大小约500MB - 在解密解码时只要加大内存限制就可以完成，但解析XML时需要SAXReader方式，dom方式的话要爆炸了</li><li>原始数据包含CLOB和BLOB类型的数据 - 插入Oracle时要额外处理</li><li>原始数据包含的字段每次都是不确定的</li><li>一次推送包含若干原始数据段，即本地入库时对表的操作也是不确定的</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="知道上述信息后我方开发接口的情况："><a href="#知道上述信息后我方开发接口的情况：" class="headerlink" title="知道上述信息后我方开发接口的情况："></a>知道上述信息后我方开发接口的情况：</h4><ul><li>接口参数包括验证信息，和数据，就这两个参数</li><li>接口采用JAX-WS实现，原因是其实现比较简单且轻便，可以参照：真正的轻量级WebService框架 - 使用JAX-WS(JWS)发布WebService</li><li>接口任务一，DES解密并base64解码推送来的数据</li><li>– 解密方式一定要和对方的一致，这里直接用对方提供的加解密代码，并且对方告知了DES秘钥</li><li>– 解码就比较随意，base64解码都大同小异</li><li>接口任务二，用dom4j包来解析XML树，这里采用SAXReader的方式，原因上面说了</li><li>接口任务三，映射表名字段名，原始推送数据字段均为汉字，Oracle库中存的都是首字母大写</li><li>接口任务四，构造SQL语句，具体思想就是解析XML到第三级标签，这一级会包含所有&lt;插入字段名&gt;和&lt;插入字段值&gt;</li></ul><h4 id="整个流程大致如下："><a href="#整个流程大致如下：" class="headerlink" title="整个流程大致如下："></a>整个流程大致如下：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/image_1bunklcj6tim16li12rn1q0undf9.png" alt="image_1bunklcj6tim16li12rn1q0undf9.png-134.2kB"><br>左边：数据推送方，不必关心其逻辑实现<br>右边：本地逻辑接口实现</p><h4 id="下面是上述叙述中遇到的问题："><a href="#下面是上述叙述中遇到的问题：" class="headerlink" title="下面是上述叙述中遇到的问题："></a>下面是上述叙述中遇到的问题：</h4><ul><li>如何按原始数据中的汉语字段建立数据表</li><li>如何监控接口的情况也是问题，生成日志是解决之道</li><li>乱码问题！!服务器？编译时？原数据？UTF-8？GBK？到底是谁的锅</li><li>如何将原始字段快速映射成我即将将其插入到表中的对应字段</li><li>Oracle字段的符号要求，浪费了很多时间</li><li>大量字段中含少量CLOB字段时，对CLOB类型的数据使用jdbc插入数据库</li><li>大量字段中含少量BLOB字段时，对BLOB类型的数据使用jdbc插入数据库，这个费了一番功夫</li><li>整明白插入时，涉及大量字段操作时，对数据的增量更新也是问题</li><li>SQL语句如何执行，批量还是单独，这是个问题</li><li>程序循环过多导致Oracle连接游标数超出限制的问题</li></ul><p>以上问题先放着，抽空再逐个分析，如果上述包括了您急需解决的问题，请@我我会尽快回复我的解决办法，或许对您会有帮助。</p><p>对于接口的传输性能：</p><ul><li>开始时错误的以为历史数据也要通过接口方式调用，就对JWS发布的这个接口进行了一下测试，发现接口的极限是200M左右</li><li>也就是说调用接口时，传入参数的字符串大小可以为200M没问题</li><li>上述都是废话，正常是不允许接口传输大量数据的。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> WebService </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop常用命令</title>
      <link href="/article/547d.html"/>
      <url>/article/547d.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">启动Hadoop</span><br><span class="line">    进入HADOOP_HOME目录。</span><br><span class="line">    执行sh bin&#x2F;start-all.sh</span><br><span class="line">关闭Hadoop</span><br><span class="line">    进入HADOOP_HOME目录。</span><br><span class="line">    执行sh bin&#x2F;stop-all.sh</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1、查看指定目录下内容</span><br><span class="line">hadoop dfs –ls [文件目录]</span><br><span class="line">eg: [hadoop@hadoop-1 test]$ hadoop fs -ls &#x2F;gsw&#x2F;rs</span><br><span class="line"></span><br><span class="line">2、打开某个已存在文件</span><br><span class="line">hadoop dfs –cat [file_path]</span><br><span class="line">eg:[hadoop@hadoop-1 test]$ hadoop dfs -cat &#x2F;gsw&#x2F;rs1&#x2F;part-r-00000</span><br><span class="line"></span><br><span class="line">3、将本地文件存储至hadoop</span><br><span class="line">hadoop fs –put [本地地址] [hadoop目录]</span><br><span class="line">hadoop fs –put &#x2F;home&#x2F;t&#x2F;file.txt  &#x2F;user&#x2F;t   (file.txt是文件名)</span><br><span class="line"></span><br><span class="line">4、将本地文件夹存储至hadoop</span><br><span class="line">hadoop fs –put [本地目录] [hadoop目录] </span><br><span class="line">hadoop fs -put &#x2F;data&#x2F;math &#x2F;gsw&#x2F;demo (dir_name是文件夹名)</span><br><span class="line"></span><br><span class="line">5、将hadoop上某个文件down至本地已有目录下</span><br><span class="line">hadoop fs -get [文件目录] [本地目录]</span><br><span class="line">hadoop fs –get &#x2F;user&#x2F;t&#x2F;ok.txt &#x2F;home&#x2F;t</span><br><span class="line"></span><br><span class="line">6、删除hadoop上指定文件</span><br><span class="line">hadoop fs –rm [文件地址]</span><br><span class="line">hadoop fs –rm &#x2F;user&#x2F;t&#x2F;ok.txt</span><br><span class="line"></span><br><span class="line">7、删除hadoop上指定文件夹（包含子目录等）</span><br><span class="line">hadoop fs –rm [目录地址]</span><br><span class="line">hadoop fs –rm &#x2F;gsw&#x2F;demo&#x2F;english</span><br><span class="line"></span><br><span class="line">8、在hadoop指定目录内创建新目录</span><br><span class="line">hadoop fs –mkdir &#x2F;user&#x2F;t</span><br><span class="line"></span><br><span class="line">9、在hadoop指定目录下新建一个空文件</span><br><span class="line">使用touchz命令：</span><br><span class="line">hadoop  fs  -touchz  &#x2F;user&#x2F;new.txt</span><br><span class="line"></span><br><span class="line">10、将hadoop上某个文件重命名</span><br><span class="line">使用mv命令：</span><br><span class="line">hadoop  fs  –mv  &#x2F;user&#x2F;test.txt  &#x2F;user&#x2F;ok.txt   （将test.txt重命名为ok.txt）</span><br><span class="line"></span><br><span class="line">11、将hadoop指定目录下所有内容保存为一个文件，同时down至本地</span><br><span class="line">hadoop dfs –getmerge &#x2F;user &#x2F;home&#x2F;t</span><br><span class="line"></span><br><span class="line">12、将正在运行的hadoop作业kill掉</span><br><span class="line">hadoop job –kill  [job-id]</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、列出所有Hadoop Shell支持的命令</span><br><span class="line">  $ bin&#x2F;hadoop fs -help</span><br><span class="line">2、显示关于某个命令的详细信息</span><br><span class="line">  $ bin&#x2F;hadoop fs -help command-name</span><br><span class="line">3、用户可使用以下命令在指定路径下查看历史日志汇总</span><br><span class="line">  $ bin&#x2F;hadoop job -history output-dir</span><br><span class="line">这条命令会显示作业的细节信息，失败和终止的任务细节。</span><br><span class="line">4、关于作业的更多细节，比如成功的任务，以及对每个任务的所做的尝试次数等可以用下面的命令查看</span><br><span class="line">  $ bin&#x2F;hadoop job -history all output-dir</span><br><span class="line">5、 格式化一个新的分布式文件系统：</span><br><span class="line">  $ bin&#x2F;hadoop namenode -format</span><br><span class="line">6、在分配的NameNode上，运行下面的命令启动HDFS：</span><br><span class="line">  $ bin&#x2F;start-dfs.sh</span><br><span class="line">  bin&#x2F;start-dfs.sh脚本会参照NameNode上$&#123;HADOOP_CONF_DIR&#125;&#x2F;slaves文件的内容，在所有列出的slave上启动DataNode守护进程。</span><br><span class="line">7、在分配的JobTracker上，运行下面的命令启动Map&#x2F;Reduce：</span><br><span class="line">  $ bin&#x2F;start-mapred.sh</span><br><span class="line">  bin&#x2F;start-mapred.sh脚本会参照JobTracker上$&#123;HADOOP_CONF_DIR&#125;&#x2F;slaves文件的内容，在所有列出的slave上启动TaskTracker守护进程。</span><br><span class="line">8、在分配的NameNode上，执行下面的命令停止HDFS：</span><br><span class="line">  $ bin&#x2F;stop-dfs.sh</span><br><span class="line">  bin&#x2F;stop-dfs.sh脚本会参照NameNode上$&#123;HADOOP_CONF_DIR&#125;&#x2F;slaves文件的内容，在所有列出的slave上停止DataNode守护进程。</span><br><span class="line">9、在分配的JobTracker上，运行下面的命令停止Map&#x2F;Reduce：</span><br><span class="line">  $ bin&#x2F;stop-mapred.sh</span><br><span class="line">  bin&#x2F;stop-mapred.sh脚本会参照JobTracker上$&#123;HADOOP_CONF_DIR&#125;&#x2F;slaves文件的内容，在所有列出的slave上停止TaskTracker守护进程。</span><br></pre></td></tr></table></figure><p>DFSShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">10、创建一个名为 &#x2F;foodir 的目录</span><br><span class="line">  $ bin&#x2F;hadoop dfs -mkdir &#x2F;foodir</span><br><span class="line">11、创建一个名为 &#x2F;foodir 的目录    </span><br><span class="line">  $ bin&#x2F;hadoop dfs -mkdir &#x2F;foodir</span><br><span class="line">12、查看名为 &#x2F;foodir&#x2F;myfile.txt 的文件内容    </span><br><span class="line">  $ bin&#x2F;hadoop dfs -cat &#x2F;foodir&#x2F;myfile.txt</span><br></pre></td></tr></table></figure><p>DFSAdmin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">13、将集群置于安全模式       </span><br><span class="line">  $ bin&#x2F;hadoop dfsadmin -safemode enter</span><br><span class="line">14、显示Datanode列表    </span><br><span class="line">  $ bin&#x2F;hadoop dfsadmin -report</span><br><span class="line">15、使Datanode节点 datanodename退役   </span><br><span class="line">  $ bin&#x2F;hadoop dfsadmin -decommission datanodename</span><br><span class="line">16、bin&#x2F;hadoop dfsadmin -help 命令能列出所有当前支持的命令。比如：</span><br><span class="line">    * -report：报告HDFS的基本统计信息。有些信息也可以在NameNode Web服务首页看到。</span><br><span class="line">    * -safemode：虽然通常并不需要，但是管理员的确可以手动让NameNode进入或离开安全模式。</span><br><span class="line">    * -finalizeUpgrade：删除上一次升级时制作的集群备份。</span><br><span class="line">17、显式地将HDFS置于安全模式</span><br><span class="line">  $ bin&#x2F;hadoop dfsadmin -safemode</span><br><span class="line">18、在升级之前，管理员需要用（升级终结操作）命令删除存在的备份文件</span><br><span class="line">  $ bin&#x2F;hadoop dfsadmin -finalizeUpgrade</span><br><span class="line">19、能够知道是否需要对一个集群执行升级终结操作。</span><br><span class="line">  $ dfsadmin -upgradeProgress status</span><br><span class="line">20、使用-upgrade选项运行新的版本</span><br><span class="line">  $ bin&#x2F;start-dfs.sh -upgrade</span><br><span class="line">21、如果需要退回到老版本,就必须停止集群并且部署老版本的Hadoop，用回滚选项启动集群</span><br><span class="line">  $ bin&#x2F;start-dfs.h -rollback</span><br><span class="line">22、下面的新命令或新选项是用于支持配额的。 前两个是管理员命令。  </span><br><span class="line">    * dfsadmin -setquota &lt;N&gt; &lt;directory&gt;...&lt;directory&gt;</span><br><span class="line">      把每个目录配额设为N。这个命令会在每个目录上尝试， 如果N不是一个正的长整型数，目录不存在或是文件名， 或者目录超过配额，则会产生错误报告。</span><br><span class="line">    * dfsadmin -clrquota &lt;directory&gt;...&lt;director&gt;</span><br><span class="line">      为每个目录删除配额。这个命令会在每个目录上尝试，如果目录不存在或者是文件，则会产生错误报告。如果目录原来没有设置配额不会报错。</span><br><span class="line">    * fs -count -q &lt;directory&gt;...&lt;directory&gt;</span><br><span class="line">      使用-q选项，会报告每个目录设置的配额，以及剩余配额。 如果目录没有设置配额，会报告none和inf。</span><br><span class="line">23、创建一个hadoop档案文件</span><br><span class="line">  $ hadoop archive -archiveName NAME &lt;src&gt;* &lt;dest&gt;</span><br><span class="line">                        -archiveName NAME  要创建的档案的名字。</span><br><span class="line">                        src 文件系统的路径名，和通常含正则表达的一样。</span><br><span class="line">                        dest 保存档案文件的目标目录。</span><br><span class="line">24、递归地拷贝文件或目录</span><br><span class="line">  $ hadoop distcp &lt;srcurl&gt; &lt;desturl&gt;</span><br><span class="line">            srcurl      源Url</span><br><span class="line">            desturl     目标Url</span><br><span class="line"></span><br><span class="line">25、运行HDFS文件系统检查工具(fsck tools)</span><br><span class="line">用法：hadoop fsck [GENERIC_OPTIONS] &lt;path&gt; [-move | -delete | -openforwrite] [-files [-blocks [-locations | -racks]]]</span><br><span class="line">            命令选项             描述</span><br><span class="line">            &lt;path&gt;              检查的起始目录。</span><br><span class="line">            -move               移动受损文件到&#x2F;lost+found</span><br><span class="line">            -delete             删除受损文件。</span><br><span class="line">            -openforwrite       打印出写打开的文件。</span><br><span class="line">            -files              打印出正被检查的文件。</span><br><span class="line">            -blocks             打印出块信息报告。</span><br><span class="line">            -locations          打印出每个块的位置信息。</span><br><span class="line">            -racks              打印出data-node的网络拓扑结构。</span><br><span class="line"></span><br><span class="line">26、用于和Map Reduce作业交互和命令(jar)</span><br><span class="line">用法：hadoop job [GENERIC_OPTIONS] [-submit &lt;job-file&gt;] | [-status &lt;job-id&gt;] | [-counter &lt;job-id&gt; &lt;group-name&gt; &lt;counter-name&gt;] | [-kill &lt;job-id&gt;] | [-events &lt;job-id&gt; &lt;from-event-#&gt; &lt;#-of-events&gt;] | [-history [all] &lt;jobOutputDir&gt;] | [-list [all]] | [-kill-task &lt;task-id&gt;] | [-fail-task &lt;task-id&gt;]</span><br><span class="line">    命令选项                                        描述</span><br><span class="line">    -submit &lt;job-file&gt;                              提交作业</span><br><span class="line">    -status &lt;job-id&gt;                                打印map和reduce完成百分比和所有计数器。</span><br><span class="line">    -counter &lt;job-id&gt; &lt;group-name&gt; &lt;counter-name&gt;   打印计数器的值。</span><br><span class="line">    -kill &lt;job-id&gt;                                  杀死指定作业。</span><br><span class="line">    -events &lt;job-id&gt; &lt;from-event-#&gt; &lt;#-of-events&gt;   打印给定范围内jobtracker接收到的事件细节。</span><br><span class="line">    -history [all] &lt;jobOutputDir&gt;     </span><br><span class="line">    -history &lt;jobOutputDir&gt;        </span><br><span class="line">    打印作业的细节、失败及被杀死原因的细节。更多的关于一个作业的细节比如成功的任务，做过的任务尝试等信息可以通过指定[all]选项查看。</span><br><span class="line">    -list [all]     -list all                       显示所有作业。-list只显示将要完成的作业。</span><br><span class="line">    -kill-task &lt;task-id&gt;                            杀死任务。被杀死的任务不会不利于失败尝试。</span><br><span class="line">    -fail-task &lt;task-id&gt;                            使任务失败。被失败的任务会对失败尝试不利。</span><br><span class="line"></span><br><span class="line">27、运行pipes作业</span><br><span class="line">用法：hadoop pipes [-conf &lt;path&gt;] [-jobconf &lt;key&#x3D;value&gt;, &lt;key&#x3D;value&gt;, ...] [-input &lt;path&gt;] [-output &lt;path&gt;] [-jar &lt;jar file&gt;] [-inputformat &lt;class&gt;] [-map &lt;class&gt;] [-partitioner &lt;class&gt;] [-reduce &lt;class&gt;] [-writer &lt;class&gt;] [-program &lt;executable&gt;] [-reduces &lt;num&gt;]</span><br><span class="line">    命令选项                                描述</span><br><span class="line">    -conf &lt;path&gt;                            作业的配置</span><br><span class="line">    -jobconf &lt;key&#x3D;value&gt;, &lt;key&#x3D;value&gt;, ...  增加&#x2F;覆盖作业的配置项</span><br><span class="line">    -input &lt;path&gt;                           输入目录</span><br><span class="line">    -output &lt;path&gt;                          输出目录</span><br><span class="line">    -jar &lt;jar file&gt;                         Jar文件名</span><br><span class="line">    -inputformat &lt;class&gt;                    InputFormat类</span><br><span class="line">    -map &lt;class&gt;                            Java Map类</span><br><span class="line">    -partitioner &lt;class&gt;                    Java Partitioner</span><br><span class="line">    -reduce &lt;class&gt;                         Java Reduce类</span><br><span class="line">    -writer &lt;class&gt;                         Java RecordWriter</span><br><span class="line">    -program &lt;executable&gt;                   可执行程序的URI</span><br><span class="line">    -reduces &lt;num&gt;                          reduce个数</span><br><span class="line">28、打印版本信息。</span><br><span class="line">用法：hadoop version</span><br><span class="line"></span><br><span class="line">29、hadoop脚本可用于调调用任何类。</span><br><span class="line">用法：hadoop CLASSNAME</span><br><span class="line">    运行名字为CLASSNAME的类。</span><br><span class="line"></span><br><span class="line">30、运行集群平衡工具。管理员可以简单的按Ctrl-C来停止平衡过程(balancer)</span><br><span class="line">用法：hadoop balancer [-threshold &lt;threshold&gt;]</span><br><span class="line">    命令选项                                描述</span><br><span class="line">    -threshold &lt;threshold&gt;                  磁盘容量的百分比。这会覆盖缺省的阀值。</span><br><span class="line">    </span><br><span class="line">31、获取或设置每个守护进程的日志级别(daemonlog)。</span><br><span class="line">用法：hadoop daemonlog -getlevel &lt;host:port&gt; &lt;name&gt;</span><br><span class="line">用法：hadoop daemonlog -setlevel &lt;host:port&gt; &lt;name&gt; &lt;level&gt;</span><br><span class="line">    命令选项                                        描述</span><br><span class="line">    -getlevel &lt;host:port&gt; &lt;name&gt;</span><br><span class="line">    打印运行在&lt;host:port&gt;的守护进程的日志级别。</span><br><span class="line">    这个命令内部会连接http:&#x2F;&#x2F;&lt;host:port&gt;&#x2F;logLevel?log&#x3D;&lt;name&gt;-setlevel &lt;host:port&gt; &lt;name&gt; &lt;level&gt;     设置运行在&lt;host:port&gt;的守护进程的日志级别。这个命令内部会连接http:&#x2F;&#x2F;&lt;host:port&gt;&#x2F;logLevel?log&#x3D;&lt;name&gt;</span><br><span class="line"></span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:&#x2F;&#x2F;www.cxmoe.com](https:&#x2F;&#x2F;www.cxmoe.com) **&gt;&gt;**</span><br><span class="line"></span><br><span class="line">32、运行一个HDFS的datanode。</span><br><span class="line">用法：hadoop datanode [-rollback]</span><br><span class="line">    命令选项                                       描述</span><br><span class="line">    -rollback</span><br><span class="line">    将datanode回滚到前一个版本。这需要在停止datanode，分发老的hadoop版本之后使用。</span><br><span class="line">    </span><br><span class="line">33、运行一个HDFS的dfsadmin客户端。</span><br><span class="line">用法：hadoop dfsadmin [GENERIC_OPTIONS] [-report] [-safemode enter | leave | get | wait] [-refreshNodes] [-finalizeUpgrade] [-upgradeProgress status | details | force] [-metasave filename] [-setQuota &lt;quota&gt; &lt;dirname&gt;...&lt;dirname&gt;] [-clrQuota &lt;dirname&gt;...&lt;dirname&gt;] [-help [cmd]]</span><br><span class="line">命令选项                                     描述</span><br><span class="line">-report                                      报告文件系统的基本信息和统计信息。</span><br><span class="line">-safemode enter | leave | get | wait                                安全模式维护命令。安全模式是Namenode的一个状态，这种状态下，Namenode</span><br><span class="line">    1. 不接受对名字空间的更改(只读)</span><br><span class="line">    2. 不复制或删除块</span><br><span class="line">    Namenode会在启动时自动进入安全模式，当配置的块最小百分比数满足最小的副本数条件时，会自动离开     安全模式。安全模式可以手动进入，但是这样的话也必须手动关闭安全模式。</span><br><span class="line">-refreshNodes                                                      重新读取hosts和exclude文件，更新允许连到Namenode的或那些需要退出或入编的Datanode的集合。</span><br><span class="line">-finalizeUpgrade                              终结HDFS的升级操作。Datanode删除前一个版本的工作目录，之后Namenode也这样做。这个操作完结整个升级过程。</span><br><span class="line">-upgradeProgress status | details | force      请求当前系统的升级状态，状态的细节，或者强制升级操作进行。</span><br><span class="line">-metasave filename                              保存Namenode的主要数据结构到hadoop.log.dir属性指定的目录下的&lt;filename&gt;文件。对于下面的每一项，</span><br><span class="line">    &lt;filename&gt;中都会一行内容与之对应</span><br><span class="line">    1. Namenode收到的Datanode的心跳信号</span><br><span class="line">    2. 等待被复制的块</span><br><span class="line">    3. 正在被复制的块</span><br><span class="line">    4. 等待被删除的块</span><br><span class="line">-setQuota &lt;quota&gt; &lt;dirname&gt;...&lt;dirname&gt;</span><br><span class="line">    为每个目录&lt;dirname&gt;设定配额&lt;quota&gt;。目录配额是一个长整型整数，强制限定了目录树下的名字个数。</span><br><span class="line">    命令会在这个目录上工作良好，以下情况会报错：</span><br><span class="line">    1. N不是一个正整数，或者</span><br><span class="line">    2. 用户不是管理员，或者</span><br><span class="line">    3. 这个目录不存在或是文件，或者</span><br><span class="line">    4. 目录会马上超出新设定的配额。</span><br><span class="line">-clrQuota &lt;dirname&gt;...&lt;dirname&gt;     为每一个目录&lt;dirname&gt;清除配额设定。</span><br><span class="line">    命令会在这个目录上工作良好，以下情况会报错：</span><br><span class="line">    1. 这个目录不存在或是文件，或者</span><br><span class="line">    2. 用户不是管理员。</span><br><span class="line">    如果目录原来没有配额不会报错。</span><br><span class="line">-help [cmd]     显示给定命令的帮助信息，如果没有给定命令，则显示所有命令的帮助信息。</span><br><span class="line"></span><br><span class="line">34、运行MapReduce job Tracker节点(jobtracker)。</span><br><span class="line">用法：hadoop jobtracker</span><br><span class="line"></span><br><span class="line">35、运行namenode。有关升级，回滚，升级终结的更多信息请参考升级和回滚。</span><br><span class="line">用法：hadoop namenode [-format] | [-upgrade] | [-rollback] | [-finalize] | [-importCheckpoint]</span><br><span class="line">    命令选项                             描述</span><br><span class="line">    -format             </span><br><span class="line">    格式化namenode。它启动namenode，格式化namenode，之后关闭namenode。</span><br><span class="line">    -upgrade                             </span><br><span class="line">    分发新版本的hadoop后，namenode应以upgrade选项启动。</span><br><span class="line">    -rollback </span><br><span class="line">    将namenode回滚到前一版本。这个选项要在停止集群，分发老的hadoop版本后使用。</span><br><span class="line">    -finalize      </span><br><span class="line">    finalize会删除文件系统的前一状态。最近的升级会被持久化，rollback选项将再不可用，升级终结操作之后，它会停掉namenode。</span><br><span class="line">    -importCheckpoint  </span><br><span class="line">    从检查点目录装载镜像并保存到当前检查点目录，检查点目录由fs.checkpoint.dir指定。</span><br><span class="line"></span><br><span class="line">36、运行HDFS的secondary namenode。</span><br><span class="line">用法：hadoop secondarynamenode [-checkpoint [force]] | [-geteditsize]</span><br><span class="line">    命令选项                      描述</span><br><span class="line">    -checkpoint [force]           </span><br><span class="line">    如果EditLog的大小 &gt;&#x3D;fs.checkpoint.size，启动Secondarynamenode的检查点过程。如果使用了-force，     将不考虑EditLog的大小。</span><br><span class="line">    -geteditsize                            </span><br><span class="line">    打印EditLog大小。</span><br><span class="line">    </span><br><span class="line">37、运行MapReduce的task Tracker节点。</span><br><span class="line">用法：hadoop tasktracker</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> 转载 </tag>
            
            <tag> 常用命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebService初步使用</title>
      <link href="/article/d296.html"/>
      <url>/article/d296.html</url>
      
        <content type="html"><![CDATA[<p>####　使用中出现的错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">faultDetail: </span><br><span class="line">&#123;http:&#x2F;&#x2F;xml.apache.org&#x2F;axis&#x2F;&#125;stackTrace:服务器无法处理请求。 ---&gt; 值不能为空。</span><br><span class="line">    call.setOperationName(new QName(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;&quot;,&quot;getSupportCity&quot;));                      &#x2F;&#x2F;一定要加·QName</span><br><span class="line">      call.addParameter(</span><br><span class="line">            new QName(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;&quot;,&quot;byProvinceName&quot;) ,</span><br><span class="line">            org.apache.axis.encoding.XMLType.XSD_STRING, </span><br><span class="line">            javax.xml.rpc.ParameterMode.IN</span><br><span class="line">      );  &#x2F;&#x2F;一定要加·QName</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">faultString: 服务器未能识别 HTTP 头 SOAPAction 的值: 。</span><br><span class="line">    call.setUseSOAPAction(true);   </span><br><span class="line">    call.setSOAPActionURI(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;getRegionCountry&quot;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">faultString: (405)Method Not Allowed faultDetail: &#123;&#125;:return code:  405 </span><br><span class="line">    call.setTargetEndpointAddress(&quot;http:&#x2F;&#x2F;ws.webxml.com.cn&#x2F;WebServices&#x2F;WeatherWebService.asmx&quot;);     &#x2F;&#x2F;路径要写对</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">关于invoke传参res&#x3D;(String[]) call.invoke(new Object[]&#123;&quot;4544&quot;&#125;);   </span><br><span class="line"> faultString: 404 </span><br><span class="line"> faultString: 400 bad request</span><br><span class="line"> faultString: SimpleDeserializer encountered a child element, which is NOT expected, in something it was trying to deserialize.</span><br><span class="line"> faultString: (403)Forbidden</span><br><span class="line">您未被授权查看该页</span><br><span class="line">您试图访问的 Web 服务器上有一个不被允许访问该网站的 IP 地址列表，并且您用来浏览的计算机的 IP 地址也在其中。</span><br><span class="line">HTTP 错误 403.6 - 禁止访问：客户端的 IP 地址被拒绝。</span><br><span class="line">打开浏览器：直接输网址，同样打不开，被禁了</span><br><span class="line">- No returnType was specified to the Call object!  You must call setReturnType() if you have called addParameter().</span><br><span class="line">call.setReturnType(org.apache.axis.encoding.XMLType.XSD_UNSIGNEDBYTE);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Exception:</span><br><span class="line">org.xml.sax.SAXException: SimpleDeserializer encountered a child element, which is NOT expected, in something it was trying to deserialize.</span><br><span class="line">（应该与下方错误 原因一样）</span><br><span class="line"> faultString: org.xml.sax.SAXException: Found character data inside an array element while deserializing</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">byte a &#x3D; (Byte) call.invoke(new Object[]&#123;&quot;山东&quot;&#125;); &#x2F;&#x2F;要强制转换</span><br><span class="line">       ~call.setReturnType(org.apache.axis.encoding.XMLType.XSD_UNSIGNEDBYTE); </span><br><span class="line">            &#x2F;&#x2F;上一句非常重要：规定了返回的值的类型（UsignedByte），直接打印即可</span><br><span class="line">            if(call.invoke(new Object[]&#123;&quot;dqw@qq.com&quot;&#125;).toString().equals(&quot;1&quot;))     </span><br><span class="line">                System.out.println(&quot;合法&quot;);</span><br><span class="line">   else</span><br><span class="line">       System.out.println(&quot;非法&quot;);</span><br><span class="line">            &#x2F;&#x2F;通过返回值来解析出实际结果</span><br></pre></td></tr></table></figure><p>删掉bin中的class之后，出现cant find the main class，解决：执行clean     project-&gt;clean</p><h4 id="书写规范"><a href="#书写规范" class="headerlink" title="书写规范"></a>书写规范</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Service service &#x3D; new Service();   </span><br><span class="line">Call call &#x3D; (Call) service.createCall();  </span><br><span class="line">call.setTargetEndpointAddress(&quot;http:&#x2F;&#x2F;ws.webxml.com.cn&#x2F;WebServices&#x2F;WeatherWebService.asmx&quot;);   &#x2F;&#x2F;?wsdl</span><br><span class="line">call.setOperationName(new QName(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;&quot;,&quot;getWeatherbyCityName&quot;));   </span><br><span class="line">call.addParameter(new QName(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;&quot;,&quot;theCityName&quot;) ,org.apache.axis.encoding.XMLType.XSD_STRING, javax.xml.rpc.ParameterMode.IN);         </span><br><span class="line">call.setUseSOAPAction(true);   </span><br><span class="line">call.setSOAPActionURI(&quot;http:&#x2F;&#x2F;WebXml.com.cn&#x2F;getWeatherbyCityName&quot;);  </span><br><span class="line">call.setReturnType(org.apache.axis.encoding.XMLType.XSD_UNSIGNEDBYTE); </span><br><span class="line">call.setReturnClass(java.lang.String[].class);  </span><br><span class="line">String[] returnConetext &#x3D;  (String[])call.invoke(new Object[]&#123;&quot;53772&quot;&#125;); </span><br><span class="line">for (int i &#x3D; 0; i &lt; returnConetext.length; i++) &#123; </span><br><span class="line"> System.out.println(returnConetext[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>定义Service—————-Service service = new Service();<br>定义Call——————–Call call = (Call) service.createCall();<br>设置EndpointURL———使用服务发布的WSDL（结尾是 ?wsdl）或者ENDPOINT（原链接）<br><a href="http://ws.webxml.com.cn/WebServices/WeatherWebService.asmx" target="_blank" rel="external nofollow noopener noreferrer">http://ws.webxml.com.cn/WebServices/WeatherWebService.asmx</a> 或<br><a href="http://ws.webxml.com.cn/WebServices/WeatherWebService.asmx？wsdl" target="_blank" rel="external nofollow noopener noreferrer">http://ws.webxml.com.cn/WebServices/WeatherWebService.asmx？wsdl</a>    </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-16kB"></p><blockquote><p>设置Operation名称——–要使用的接口方法，必须 new QName( 高层域名，原方法名称 )；（如下应为getWeatherbyCityName）  </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-22.1kB"></p><blockquote><p>添加Parameter参数——–接口方法传入的参数，有几个就写几个，必须 new QName( 高层域名，原参数名称 )；外加 XMLType.XSD_STRING, 和 ParameterMode.IN<br>  注意，此处是“注明”之意，赋值操作不在此处；（如下应为theCityName）  </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-7.8kB"></p><blockquote><p>设置SOAPActionURL——高层域名url+接口方法；（如下应为<a href="http://WebXml.com.cn/getWeatherbyCityName），其中高层域名为&quot;http://WebXml.com.cn/&quot;" target="_blank" rel="external nofollow noopener noreferrer">http://WebXml.com.cn/getWeatherbyCityName），其中高层域名为&quot;http://WebXml.com.cn/&quot;</a>;  </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-24.4kB"></p><blockquote><p>设置返回类型Type———-关系到invoke的返回值，具体要与发布的服务信息相对应<br>如下应使用为call.setReturnClass(java.lang.String[].class);  ，因为字符串数组是封装类，此时应声明返回的类型<br>如果返回值是可以描述的类型，比如String，byte这些基础类型，可以直接使用call.setReturnType(XMLType.XSD_STRING）  </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-19.6kB"></p><blockquote><p>触发invoke—————–传入实际的参数，一是参数要为Object对象数组，二是返回类型可转换时(如String) invoke前要加强制转换，</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="会员先注册，然后点击我的服务"><a href="#会员先注册，然后点击我的服务" class="headerlink" title="会员先注册，然后点击我的服务"></a><strong>会员先注册，然后点击我的服务</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-144.8kB"></p><h4 id="然后点击一个服务的试用，之后返回，再用UserID就可以了"><a href="#然后点击一个服务的试用，之后返回，再用UserID就可以了" class="headerlink" title="然后点击一个服务的试用，之后返回，再用UserID就可以了"></a><strong>然后点击一个服务的试用，之后返回，再用UserID就可以了</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-9kB"></p><h4 id="结果很完美"><a href="#结果很完美" class="headerlink" title="结果很完美"></a><strong>结果很完美</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-47.1kB"></p><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a><strong>注意</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-144.8kB"></p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WebService </tag>
            
            <tag> 初次使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hive与hbase的联系与区别</title>
      <link href="/article/5835.html"/>
      <url>/article/5835.html</url>
      
        <content type="html"><![CDATA[<p>hive与hbase的联系与区别：<br>共同点：</p><ol><li>hbase与hive都是架构在hadoop之上的。都是用hadoop作为底层存储</li></ol><a id="more"></a><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>区别：</p><ol><li>Hive是建立在Hadoop之上为了减少MapReduce jobs编写工作的批处理系统，HBase是为了支持弥补Hadoop对实时操作的缺陷的项目 。</li><li>想象你在操作RMDB数据库，如果是全表扫描，就用Hive+Hadoop,如果是索引访问，就用HBase+Hadoop 。</li><li>Hive query就是MapReduce jobs可以从5分钟到数小时不止，HBase是非常高效的，肯定比Hive高效的多。</li><li>Hive本身不存储和计算数据，它完全依赖于HDFS和MapReduce，Hive中的表纯逻辑。</li><li>hive借用hadoop的MapReduce来完成一些hive中的命令的执行</li><li>hbase是物理表，不是逻辑表，提供一个超大的内存hash表，搜索引擎通过它来存储索引，方便查询操作。</li><li>hbase是列存储。</li><li>hdfs作为底层存储，hdfs是存放文件的系统，而Hbase负责组织文件。</li><li>hive需要用到hdfs存储文件，需要用到MapReduce计算框架。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hive </tag>
            
            <tag> 区别 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>美国是如何一步步成为超级大国的</title>
      <link href="/article/8996.html"/>
      <url>/article/8996.html</url>
      
        <content type="html"><![CDATA[<p>美国如何一步步成为超级大国的</p><p>　　古往今来，从来没有哪个国家像美国这样强大</p><p>　　美国究竟依靠了哪些力量和因素崛起为超级大国?</p><p>　　一、崛起历程</p><a id="more"></a><p>　　从它在世界上所占的地位看，美国的发展历程大致可分为三个阶段。</p><p>　　1、从独立建国到发展为头号资本主义国家(1776—1945年)为第一阶段。</p><p>　　这一阶段，北美1 3个英属殖民地的人民通过独立战争和1812——1814年第二次独立战争，彻底摆脱了英 国殖民统治，为美国资本主义的发展开辟了道路；又经过南北战争(1861—1865年)，废 除了奴隶制度，大大推进了在自由劳动制度下美国工业化的进程。虽然1929—1933年的 全球经济危机使美国受到严重打击，但两次世界大战都极大地刺激了美国经济，从而使第二次世界大战结束时，美国发展成为世界头号资本主义国家。</p><p>　　2、从二战后初期到1991年苏联解体前为第二阶段。</p><p>　　当时的美国是与苏联并列的两个超级大国之一。</p><p>　　3、 从1991年底苏联解体至今是第三阶段。</p><p>　　此时的美国是世界上唯一的超级大国。20世纪9 0年代美国率先走上发展信息经济的道路，从而使劳动生产率和经济发展速度再次超过所有发达资本主义国家。苏联的解体和美国经济实力的膨胀，使美国以唯一“超级大国 ”身份行事，摆出世界霸主的架势。</p><p>　　二、美国崛起的原因</p><p>　　1、良好的自然条件和地理环境</p><p>　　良好的自然条件：可耕地占国土面积90%！与加拿大共有的五大湖泊所蓄淡水 约占世界淡水总量一半，并具有丰富的矿产资源。</p><p>　　良好的地理位置：北与加 拿大、南与墨西哥两个弱国相邻，东西有大西洋、太平洋两洋相隔，使其在两次大战中 不仅本土未受损伤，反而可以利用战争的机会聚敛财富。世界上几乎没有任何一个其它 大国享有如此的“天赋权利”。</p><p>　　2、有利于创新、发展的民族精神</p><p>　　美国历来被称为多民族的国家，是一个没有传统的(宗教传统除外) 、从民主共和国开始的国家，是一个比任何别的民族都要精力充沛的民族。</p><p>　　清教对美利坚民族精神的形成起了独特的作用。清教徒们想方设法证明，努力工作就能取悦于上帝，发奋经商就会得到升 华，因为“上帝不会让一个人具有五分的才干只得到二分报酬”。教友们由此而“极其勤劳，为聚敛财富而不辞劳苦与艰辛”。这种职业教义使宗教观和资产阶级经济观有机地结合在一起。，美国之所以能够产生出充满活力、发展迅速的市场经济，是和美国新教徒的伦理道德、职业精神分不开的。使得美利坚 民族养成了自强不息、艰苦奋斗的精神和科学的求实态度，以及藐视封建传统、趋向变 动的革新精神和强烈的自治愿望。</p><p>　　3、有一部维护资产阶级长治久安的相对稳定的宪法</p><p>　　美国宪法制定的过程及其权威性和相对稳定性特点，对美国的发展起了重要作 用。</p><p>　　200多年来除增加了“权利法案” 即前十条修正案外，总共仅26条修正案，且至今仍然适用，在世界宪法史上是绝无仅有的。其中重要原因之一是它只列基本原则，宪法自身随时代的演变而演变。而三权分立 与制衡被认为是美国建国先辈们一项得意之作。其最大成就，在于他们成功地将一个软弱无力、宗派林立的各州联盟转变成一个统一国家 。这个成就本身改变了美国的世界地位”。</p><p>　　4、两次革命与多次改革为经济和综合国力发展创造了有利条件</p><p>　　1775年开始的美国独立战争推翻了英国殖民统治，使美国生产力获得第一次大解放；1861—1865年内战废除了奴隶制，使生产力获得第二次大解放，从而使工业革命于19世 纪80年代完成。无论是18世纪的独立战争或是19世纪60年代的内战，这两次革命的主力都是 广大的人民群众。</p><p>　　值得注意的是，美国从建国伊始还经历了各种社会运动和改革，大到关系国计民生的 经济变革和政府改革，小到禁酒运动和涉及民风民俗，几乎无所不包。其中比较突出的 有19世纪末的黑幕揭发者运动，20世纪初影响深远的进步运动，30年代初的罗斯福“新 政”和二次大战后60年代兴起的空前激烈的争取民权、反对种族歧视、争取妇女平等权 利的运动和新左派运动等。这些运动迫使美国当局在一定程度上进行相应的改革。从这 个意义上讲，社会运动和改革已构成美国重要推动力，这也反映了美国社会的自我调节能力，。</p><p>　　5、一贯重视经济、教育、科技和人才的网罗</p><p>　　作为一个纯粹的资本主义国家，出于对资本增殖和扩展的强烈愿望，美国很懂得加强 经济这个根本。</p><p>　　为了解决工业化时期资金不足的问题，曾大量引进外资，并特别注意树立奖励发明和 技术创新意识。早在1790年联邦政府即正式成立专利局，管理发明创造。</p><p>　　美国新教有重视教育的传统。特别是高等教育在总体上一直处于世界领先地位。而且 ，美国当局不断检讨教育中的问题，时时存在一种危机感。敢于正视存在的问题，也反映了对教育的重视。</p><p>　　美国一直鼓励科学和发明，其办法是促进思想自由交流，鼓励“实用知识”的发展和 网罗来自世界各地的有创造力的人才。20世纪90年代美国又 率先进入知识经济时代，依靠信息网络优势，在劳动生产率和经济发展速度上再次超过 其他发达资本主义国家。作为世界头号科技强国，美国的科技投入也是无人可及的。</p><p>　　美国成为科技强国与其广泛招揽科研人才有密切关系。作为一个主要由外来移民组成 的国家，美国不仅吸收了世界上许多国家文化、科技和其它工艺，而且获得了许多优秀 的科学家和技术人才。</p><p>　　6、利用两次世界大战登上世界霸主地位</p><p>　　20世纪上半叶，两次世界大战造成了空前浩劫，世界上各主要大国除美国外几乎无一 例外地遭到严重打击或削弱。美国由于有两洋之隔，远离战争中心而免遭破坏，反而利 用大战发了横财。    </p><p>　　经过第一次世界大战，美国由债务国一跃而为债权国，成为全世界金融中心和财政剥 削中心。</p><p>　　二战后，美国不仅摆脱了30年代严重的经济危机与萧条，而且大大发展了生产 力，促进了国家垄断资本主义的发展。战后初期，美国占资本主义世界工业产量的53.4 %(1948年)，出口贸易的32.4%(1947年)，黄金储备的74.5%(1948年)。美国靠战争的输 血而空前强大起来。当时，美国垄断资产阶级宣称，20世纪是“美国世纪”。杜鲁门总 统在1945年12月的国情咨文中说，“胜利已使美国人民有经常而迫切的必要来领导世界 了”。</p><p>　　7、利用美元在二战后资本主义世界货币领域的霸权地位而获利</p><p>　　美国霸权的基础，是美元在国际货币体系中的作用 和它的核威慑力量扩大到了各个盟国。</p><p>　　《布雷顿森林协定》确立了美元在战后资本主义世界货币领域的霸权地位，为美 国的经济扩张创造了极为有利的条件。由于美国在国际贸易中占有绝对优势，1947年10 月于日内瓦签订的《关税和贸易总协定》(“世界贸易组织”的前身)，同样首先适应了 美国的需要。1999年美国以其占世界4.5%的人口利用了世界85%的流动资本和72%的世界 储备。难怪在两极格局解体后，美国一再强调“这个由美国起领导作用的”、上世纪40 年代形成的世界秩序一直存在，而美国“仍然是世界秩序的核心”。</p><p>　　8、利用“冷战”推行联合与壮大资本主义力量的策略</p><p>　　二战后美苏两国几达半个世纪的“冷战”给了美国国力发展以多方面的刺激。由于“ 冷战”这种疑似临战态势的不断持续，刺激了国防工业，从而“造就了美国尖端技术” 。而更重要的是给了美国以拉拢资本主义同盟者的天赐良机。</p><p>　　1947年6月就提出了援助西欧的马歇尔计划。此计划以“复兴欧洲”为名，行控制西欧之实。对美国来说，马歇尔计划达到了 一箭几雕的目的。既稳定了西欧经济，防止社会动乱与革命的爆发，又使受援国沦为美 国的附庸和势力范围，纳入美国全球称霸的战略轨道。对于美国经济而言，它有助于美国商品的输出。这样，美国就利用“ 冷战”的阴影，把“遏制”共产主义的计谋与制造商、出口商的热情融为一体了。</p><p>　　从以上的论述中我们看到，200多年来促使美国迅速崛起的因素是多方面的，是这些因素综合作用的结果。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>How the United States has become a superpower</p><p>Throughout the past, no country has ever been so powerful as the United States</p><p>What power and factors do the United States rely on to rise for the superpower?</p><p>First, the rise of the process</p><p>From its position in the world, the development of the United States can be divided into three stages.</p><p>1, from independent founding to the development of the number one capitalist countries (1776-1945) for the first stage.</p><p>At this stage, the people of the 13 British colonies in North America opened the way for the development of American capitalism through the War of Independence and the Second War of Independence of 1812 - 1814, completely freeing the British colonial rule, and through the Civil War 1861-1865), abolished the slavery system, greatly promoted the process of industrialization in the United States under the free labor system. Although the global economic crisis of 1929-1933 had dealt a serious blow to the United States, the two world wars had greatly stimulated the American economy, so that at the end of the Second World War, the United States developed into the world’s top capitalist state.</p><p>2, from the early post-World War II to 1991 before the disintegration of the Soviet Union for the second stage.</p><p>At that time the United States was one of the two superpowers tied to the Soviet Union.</p><p>3, from the end of 1991 the Soviet Union has been the third stage.</p><p>At this time the United States is the world’s only superpower. In the 1990s, the United States took the lead in embarking on the path of developing the information economy, thus making labor productivity and economic development faster than all developed capitalist countries. The disintegration of the Soviet Union and the expansion of US economic power, so that the United States to act as the only “superpower” identity, put the world’s overlord posture.</p><p>Second, the reasons for the rise of the United States</p><p>1, good natural conditions and geographical environment</p><p>Good natural conditions: arable land accounted for 90% of land area! The five major lakes shared with Canada account for about half of the world’s fresh water and are rich in mineral resources.</p><p>Good location: North and Canada, South and Mexico two weak countries adjacent to things, the Atlantic Ocean, the Pacific Ocean separated, so that in the two wars not only local damage, but can use the opportunity to gather the wealth of war. Almost no other big country in the world enjoys such “natural rights”.</p><p>2, is conducive to innovation, the development of national spirit</p><p>The United States, which has traditionally been called a multi-ethnic country, is a country that is not traditional (except religious traditions) and which begins with a democratic republic, a nation that is energetic than any other nation.</p><p>Puritan played a unique role in the formation of the American national spirit. The Puritans tried to prove that hard work would be able to please God, and that the counselor would be sublimated because “God would not let a man have five points to earn only two points.” The faithful are “extremely industrious and hardworking and struggling to gather wealth.” This professional doctrine makes the religious and bourgeois economic views organically combined. , The United States has been able to produce a vibrant, rapid development of the market economy, and the American Protestant ethics, professional spirit inseparable. So that the American people to develop self-improvement, the spirit of hard work and scientific truth-seeking attitude, as well as contempt for feudal traditions, tend to change the spirit of innovation and strong desire for autonomy.</p><p>3, there is a maintenance of the bourgeoisie long-term stability of the relatively stable constitution</p><p>The development of the US Constitution and its authoritative and relative stability characteristics, the development of the United States played an important role.</p><p>Over the past two years, in addition to the addition of the Bill of Rights Act, the first ten amendments, a total of only 26 amendments, and still apply, in the history of the world’s history is unique. One of the important reasons is that it only lists the basic principles, the evolution of the Constitution itself with the evolution of the times. And the separation of powers and checks and balances are considered a founding father of the United States. Its greatest achievement is that they succeed in transforming a weak, sectarian state coalition into a unified state. This achievement itself changed the status of the United States. “</p><ol start="4"><li>The two revolutions and many reforms have created favorable conditions for economic and comprehensive national strength development</li></ol><p>The American Civil War, which began in 1775, overthrew the British colonial rule and gave American productive power the first major liberation; the 1861-1865 civil society abolished slavery and made the second great liberation of productive forces, bringing the industrial revolution to the 19th century The age is complete. Whether it was the 18th century War of Independence or the civil war of the 1960s, the main forces of the two revolutions were the broad masses of the people.</p><p>It is noteworthy that the United States from the beginning of the founding of the country has also experienced a variety of social movements and reform, to the people’s livelihood and economic reform and government reform, small to alcohol and folk customs, almost all-encompassing. Which is more prominent in the late 19th century shady actress movement, the early 20th century, far-reaching progressive movement, the early 1930s Roosevelt “New Deal” and the Second World War 60 years after the rise of unprecedented fierce civil rights, against racial discrimination, Women’s equal rights movement and the New Left movement. These movements forced the US authorities to a certain extent, the corresponding reform. In this sense, social movements and reforms have become an important impetus to the United States, which also reflects the self-regulation of American society.</p><p>5, has always attached importance to the economy, education, science and technology and talent snare</p><p>As a purely capitalist country, thanks to the strong desire for capital proliferation and expansion, the United States knows how to strengthen the economy.</p><p>In order to solve the problem of insufficient funds in the industrial period, a large number of foreign investment, and pay special attention to establish the invention of incentives and technological innovation. As early as 1790 the federal government formally established the patent office, management of inventions.</p><p>American Protestantism attaches great importance to the tradition of education. In particular, higher education has been a world leader in general. Moreover, the US authorities continue to review the problems in education, there is always a sense of crisis. Dare to face up to the problems, but also reflects the importance of education.</p><p>The United States has always encouraged science and invention by promoting freedom of thought, encouraging the development of “practical knowledge” and bringing creative talent from all over the world. In the 1990s, the United States took the lead in entering the era of knowledge economy, relying on the advantages of information network, in labor productivity and economic development speed again over other developed capitalist countries. As the world’s number one technology power, the United States is also unparalleled investment in science and technology.</p><p>The United States has become a strong power of science and technology and its extensive recruitment of scientific research personnel are closely related. As a country mainly composed of immigrants, the United States not only absorbed many countries in the world of culture, technology and other technology, and access to many outstanding scientists and technical personnel.</p><p>6, the use of two world wars boarded the world hegemony</p><p>The first half of the 20th century, the two world wars caused an unprecedented catastrophe, the world’s major powers in addition to the United States almost without exception, was severely hit or weakened. The United States because of the two seas, away from the war center and from the destruction, but the use of war made a windfall.</p><p>After the First World War, the United States by the debtor countries leap to creditors, as the world’s financial center and financial exploitation center.</p><p>After World War II, the United States not only out of the 30’s serious economic crisis and depression, but also greatly developed the productive forces, and promote the development of national monopoly capitalism. In the early years after the war, the United States accounted for 53.4% ​​of the industrial output of the capitalist world (1948), 32.4% of the export trade (1947) and 74.5% of the gold reserves (1948). The United States by the war of blood transfusion and unprecedented strength. At that time, the US monopoly bourgeoisie declared that the twentieth century was “American century”. In his December 1945, President Truman said, “victory has made the American people have the urgent need to lead the world.”</p><p>7, the use of the dollar in the post-World War II capitalist world currency hegemony and profit</p><p>The basis of American hegemony is the role of the dollar in the international monetary system and its nuclear deterrent power has been extended to allies.</p><p>The Bretton Woods Agreement establishes the hegemonic position of the dollar in the postwar capitalist world currency, creating extremely favorable conditions for US economic expansion. As the United States has an absolute advantage in international trade, the General Agreement on Tariffs and Trade (the predecessor of the World Trade Organization), signed in Geneva in October 1947, first adapted to the needs of the United States. In 1999, the United States used 85% of the world’s working capital and 72% of the world’s reserves for 4.5% of the world’s population. It is no wonder that after the disintegration of the bipolar pattern, the United States has repeatedly stressed that “this is the leading role of the United States,” the formation of the last century, 40 years of the world order has always existed, and the United States “is still the core of the world order.”</p><p>8, the use of “cold war” to implement the joint and strengthen the capitalist forces strategy</p><p>After the Second World War, the United States and the Soviet Union for half a century “cold war” to the United States to the development of a multitude of stimulus. As the “cold war” this suspected war situation continues to continue to stimulate the defense industry, thus “creating the US cutting-edge technology.” And more importantly, to the United States to draw the capitalist allies of the heaven-sent opportunity.</p><p>In June 1947, the Marshall Plan for Western Europe was proposed. This plan to “revive Europe” in the name of the line control of Western Europe. For the United States, Marshall plans to achieve the purpose of a few arrows. Both to stabilize the Western European economy, to prevent social unrest and the outbreak of the revolution, but also to the recipient countries into the United States of the vassal and sphere of influence, into the United States to dominate the global strategic track. For the US economy, it contributes to the export of US goods. In this way, the United States on the use of “cold war” shadow, the “containment” communist strategy and manufacturers, exporters of the enthusiasm of the integration.</p><p>From the above discussion we have seen that the factors that have contributed to the rapid rise of the United States in the past 200 years are multidimensional and the result of the combined effect of these factors.</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 翻译 </tag>
            
            <tag> 英语 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何开发并发布REST风格的WebService</title>
      <link href="/article/1772.html"/>
      <url>/article/1772.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>在《WebService的使用》中已经可以发现其调用方式非常简单，但是也知道一个WebService服务包含非常多的定义和描述（在对WSDL文件的分析中就可以看出），可以说其实现是非常的复杂。不过，在常见开发语言中（JavaC#）都有对实现WebService的封装框架，Java下有AXIS2、CXF、JAX-WS、XFire方式，并且每种方式在常见IDE如Eclipse中都有相关的插件支持或者操作界面化的支持。</p></blockquote><a id="more"></a><h4 id="开发和使用的复杂性"><a href="#开发和使用的复杂性" class="headerlink" title="开发和使用的复杂性"></a>开发和使用的复杂性</h4><blockquote><p>AXIS2、CXF、XFire均需要引入其自身的支持，而且有的需要特殊的代码结构支持，这里采用JDK原生支持的方式来对WebService的实现进行简单阐述。</p></blockquote><blockquote><p>通常来说使用JAX-WS方式是最简单快速的开发方式，是JDK支持的一种编写方法，实现非常简单，但是相对的，在使用时，其并不支持多种方式调用，也不支持直接的Http调用，需要添加相关方法来辅助实现调用的完成，不过这一过程在Eclipse中可以自动根据WSDL文件来生成相关代码。JAX-WS的不足突出体现在调用方式的笨拙上，即不支持REST方式的调用，为此出现了其进阶版JAX-RS（Java API for RESTful Web Services）这是一个Java编程语言的应用程序接口，支持按照表述性状态转移（REST）架构风格创建Web服务。它有好几种实现方式，而Jersey是其实现方式之一。</p></blockquote><h4 id="使用Eclipse开发示例"><a href="#使用Eclipse开发示例" class="headerlink" title="使用Eclipse开发示例"></a>使用Eclipse开发示例</h4><pre><code>示例完成的功能：同天气接口一样，在地址栏输入调用链接并返回数据；在Java代码中调用返回数据；新建一个Web Service Project，注意要选择JAX-RS选项，并且添加Maven支持。右侧是初始项目结构：</code></pre><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/xww9la2y3o9omvixwx2y67ns/a.png" alt="a.png-60.8kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/rmrdh4ishi91t9zwuxn1qx9t/b.png" alt="b.png-12.2kB"></p><blockquote><p>对于上述项目结构，我们要实现发布一个服务，只需要关心三部分：<br>首先，打开pom.xml添加项目依赖；<br>然后，在src/main/java下编写逻辑代码；<br>最后，在web.xml中修改拦截目录以及对应上述代码的位置</p></blockquote><h4 id="打开pom-xml添加项目依赖；"><a href="#打开pom-xml添加项目依赖；" class="headerlink" title="打开pom.xml添加项目依赖；"></a>打开pom.xml添加项目依赖；</h4><blockquote><p>这部分主要添加的是jersey的包，这里使用的是org.glassfish.jersey提供的包，不同组织提供了不同的包，但本质实现的功能都是一样的，这里添加jersey-bom这个包（对应其他组织提供的包可能需要导入的包名会发生变化）。</p></blockquote><h4 id="在src-main-java下编写逻辑代码；"><a href="#在src-main-java下编写逻辑代码；" class="headerlink" title="在src/main/java下编写逻辑代码；"></a>在src/main/java下编写逻辑代码；</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/qs9gdzvgugt4fhbegh8r8dw9/c.png" alt="c.png-67.5kB"> </p><h4 id="在web-xml中修改"><a href="#在web-xml中修改" class="headerlink" title="在web.xml中修改"></a>在web.xml中修改</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/pbgsxfedrdnccesaliavhmah/d.png" alt="d.png-53.5kB"><br>上述三部分完成后，在Tomcat中运行即可，然后在浏览器中测试一下。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/nwjcfn5suu7bdt4k6pi4adoa/e.png" alt="e.png-94.6kB"></p><h4 id="Java代码中的调用"><a href="#Java代码中的调用" class="headerlink" title="Java代码中的调用"></a>Java代码中的调用</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/t8pyjhh03tm2js4gvnc8kumg/f.png" alt="f.png-48.9kB"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote><p>在JDK原生支持的WebService开发方式中，JAX-WS和JAX-RS是主要的形式，前者在使用上较为不便，所以推荐时候支持REST方式的JAX-RS进行开发，而其本身只是一种规范，Jersey是这种规范的实现之一，上述示例即使用Jersey完成了一个简单的WebService的开发，其调用方式与之前提到的天气接口相同，非常方便，且使用Jersey开发的整个流程也十分简单快速。</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> WebService </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebService获取数据实例及WSDL文件解读</title>
      <link href="/article/c314.html"/>
      <url>/article/c314.html</url>
      
        <content type="html"><![CDATA[<h4 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h4><p>这是一个汇总webservice的网站:<a href="http://www.webxml.com.cn" target="_blank" rel="external nofollow noopener noreferrer">http://www.webxml.com.cn</a><br>里面有非常多可以供调用的WebService<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/1.png" alt="1.png-147.3kB"> </p><a id="more"></a><h4 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h4><p>点进某个服务，针对这个服务的方法都有非常详细的方法说明，完整说明以文件的形式列出：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/2.png" alt="2.png-27.6kB"><br>点进某个具体方法是调用接口的具体方式，例如SOAP方式以及Http的Post或者Get方式等等，通常是使用Http进行请求，这种方式返回的结果就是结果本身。（SOAP方式返回结果还有一层soap的标签）<br> <img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/3.png" alt="3.png-13.8kB"></p><h4 id="测试使用"><a href="#测试使用" class="headerlink" title="测试使用"></a>测试使用</h4><p>在这个页面可以进行对方法的调用测试<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/4.png" alt="4.png-2.8kB"> </p><h4 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/5.png" alt="5.png-369.1kB"><br>对此种调用方式进行分析<br>上述直接在浏览器中显示的是POST方式；<br>调用返回的数据格式为XML，还可以支持JSON格式（这个示例只能返回XML）；<br>上述服务是采用C#写的，并且发布环境是IIS；<br>上述getRegionCountry方法只是该天气服务的一个方法；</p><h4 id="接口描述文件："><a href="#接口描述文件：" class="headerlink" title="接口描述文件："></a>接口描述文件：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/6.png" alt="6.png-58kB"><br>对于全部方法的描述，在没有说明文档时，可以参考接口描述文件(WSDL)，对于规范的WebService服务都可以使用“WebService地址”+“?WSDL”的方式访问到该文件，该文件详细的描述了：<br>服务中包含的所有方法；<br>方法传入的参数类型<br>方法调用的路径等等；</p><h4 id="分析整个WSDL文档："><a href="#分析整个WSDL文档：" class="headerlink" title="分析整个WSDL文档："></a>分析整个WSDL文档：</h4><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/7.png" alt="7.png-38.2kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/8.png" alt="8.png-29.9kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/9.png" alt="9.png-75.3kB"> </p><h4 id="代码中调用"><a href="#代码中调用" class="headerlink" title="代码中调用"></a>代码中调用</h4><p>本质还是实现一次Http请求,故非常简单,只需要使用代码发送一次请求即可(默认是POST方式)<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/10.png" alt="10.png-69.8kB"> </p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> WebService </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle复杂 Merge Into  | no listener | ORA-00001</title>
      <link href="/article/92b2.html"/>
      <url>/article/92b2.html</url>
      
        <content type="html"><![CDATA[<h3 id="使用-Merge-Into-进行数据表的增量更新"><a href="#使用-Merge-Into-进行数据表的增量更新" class="headerlink" title="使用 Merge Into 进行数据表的增量更新"></a>使用 Merge Into 进行数据表的增量更新</h3><p>特点：如果数据存在则更新，如果不存在则插入<br>示例：北斗渔船位置的实时数据表</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">MERGE INTO A_DATA T1</span><br><span class="line">USING (</span><br><span class="line">SELECT   &#39;21212958881122&#39; AS MSG_ID ,</span><br><span class="line">&#39;北斗星通1&#39; AS COMM_TYPE ,</span><br><span class="line">&#39;20261&#39; AS USER_ID ,</span><br><span class="line">&#39;2818101&#39;AS TERMINAL_CODE,</span><br><span class="line">&#39;201704051&#39; AS MSG_DATE ,</span><br><span class="line">&#39;定时回传位置1&#39; AS POS_TYPE ,</span><br><span class="line">&#39;2017-04-05 20:56:311&#39; AS UTC ,</span><br><span class="line">&#39;126°33′431″&#39; AS LONGITUDE ,</span><br><span class="line">&#39;30°11′01″&#39; AS LATITUDE ,</span><br><span class="line">&#39;6801&#39; AS COURSE ,</span><br><span class="line">&#39;01&#39; AS TRUEHEADING ,</span><br><span class="line">&#39;8.91&#39; AS SPEED ,</span><br><span class="line">&#39;正常1&#39; AS STATUS ,</span><br><span class="line">&#39;01&#39; AS VDESC ,</span><br><span class="line">&#39;北斗星通1&#39; AS TERMINAL_TYPE ,</span><br><span class="line">&#39;2017-04-05 21:21:401&#39; AS SYSTEM_TIME</span><br><span class="line">FROM dual</span><br><span class="line">) T2</span><br><span class="line">ON ( T1.TERMINAL_CODE &#x3D; T2.TERMINAL_CODE)</span><br><span class="line">WHEN MATCHED THEN</span><br><span class="line">    UPDATE SET T1.MSG_ID &#x3D; T2.MSG_ID ,</span><br><span class="line"> T1.COMM_TYPE &#x3D; T2.COMM_TYPE ,</span><br><span class="line"> T1.USER_ID &#x3D; T2.USER_ID ,</span><br><span class="line"> T1.MSG_DATE &#x3D; T2.MSG_DATE ,</span><br><span class="line"> T1.POS_TYPE &#x3D; T2.POS_TYPE ,</span><br><span class="line"> T1.UTC &#x3D; T2.UTC ,</span><br><span class="line"> T1.LONGITUDE &#x3D; T2.LONGITUDE ,</span><br><span class="line"> T1.LATITUDE &#x3D; T2.LATITUDE ,</span><br><span class="line"> T1.COURSE &#x3D; T2.COURSE ,</span><br><span class="line"> T1.TRUEHEADING &#x3D; T2.TRUEHEADING ,</span><br><span class="line"> T1.SPEED &#x3D; T2.SPEED ,</span><br><span class="line"> T1.STATUS &#x3D; T2.STATUS ,</span><br><span class="line"> T1.VDESC &#x3D; T2.VDESC ,</span><br><span class="line"> T1.TERMINAL_TYPE &#x3D; T2.TERMINAL_TYPE ,</span><br><span class="line"> T1.SYSTEM_TIME &#x3D; T2.SYSTEM_TIME </span><br><span class="line">WHEN NOT MATCHED THEN </span><br><span class="line">    INSERT (MSG_ID ,COMM_TYPE ,USER_ID ,TERMINAL_CODE ,MSG_DATE ,POS_TYPE ,UTC ,LONGITUDE ,LATITUDE ,COURSE ,TRUEHEADING ,SPEED ,STATUS ,VDESC ,TERMINAL_TYPE ,SYSTEM_TIME ) </span><br><span class="line">VALUES(T2.MSG_ID ,T2.COMM_TYPE ,T2.USER_ID ,T2.TERMINAL_CODE ,T2.MSG_DATE ,T2.POS_TYPE ,T2.UTC ,T2.LONGITUDE ,T2.LATITUDE ,T2.COURSE ,T2.TRUEHEADING ,T2.SPEED ,T2.STATUS ,T2.VDESC ,T2.TERMINAL_TYPE ,T2.SYSTEM_TIME);</span><br></pre></td></tr></table></figure><h3 id="SQL-错误-ORA-00001-违反唯一约束条件-SYSTEM-SYS-C0010160"><a href="#SQL-错误-ORA-00001-违反唯一约束条件-SYSTEM-SYS-C0010160" class="headerlink" title="SQL 错误: ORA-00001: 违反唯一约束条件 (SYSTEM.SYS_C0010160)"></a><strong>SQL 错误: ORA-00001: 违反唯一约束条件 (SYSTEM.SYS_C0010160)</strong></h3><ol><li>00000 -  “unique constraint (%s.%s) violated”</li></ol><p>原因：在select语句中的AS部分全部是取值于已存在记录的值，在id相同并执行update时，相当于更新一条完全相同的语句，即便是各个值没有违反唯一性约束，此时也会报: ORA-00001错误，不要全都一样就可以了；</p><p>在Java中使用Oracle的MERGE INTO语句时，老师报错：sql语句未正常结束，但在Navcat中完全正常<br>解决：Navcat中执行时语句的最后有个分号；但在Java中prepareStatement构造时，要去掉这个分号！！！！</p><h3 id="连接错误-no-listener、The-Network-Adapter-could-not-establish-the-connection"><a href="#连接错误-no-listener、The-Network-Adapter-could-not-establish-the-connection" class="headerlink" title="连接错误:no listener、The Network Adapter could not establish the connection"></a><strong>连接错误:no listener、The Network Adapter could not establish the connection</strong></h3><p>1.打开SQL Developer查看本地SYSTEM(例子)是否能连接（密码：ttzzlll）<br>如不行（报adapter错误等等）：<br>查看Oracle服务启动正常否：<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-22.8kB"><br>如果未启动，则右键属性，转登录栏，使用账号密码重新登录，之后即可启动<br>上述完成，看是否可以本地连接，如果仍不行：<br>执行 lsnrctl start + lsnrctl status  看信息正常否<br>正常，则打开oracle安装目录下：oracle\product\12.1.0\dbhome_1\network\admin\listener.ora<br>打开listener.ora，找到最下方LINSTENER=(…)<br>修改HOST = 主机名（主机名可我的电脑右键属性查看）<br>保存，之后cmd下：<br>lsnrctl  stop<br>lsnrctl  start<br>lsnrctl  status<br>有一定的延迟，在客户机上连接，此时OK！！！！</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> Merge </tag>
            
            <tag> Error </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware虚拟机联网</title>
      <link href="/article/f7b9.html"/>
      <url>/article/f7b9.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>1.复制虚拟机文件<br>2.在VMware中分别打开三个虚拟机<br>3.设置NAT模式，固定IP，可上网<br>4.运行一下</p></blockquote><a id="more"></a><h2 id="复制虚拟机文件"><a href="#复制虚拟机文件" class="headerlink" title="复制虚拟机文件"></a>复制虚拟机文件</h2><p>拷到本机，随便放</p><h2 id="在VMware中分别打开三个虚拟机"><a href="#在VMware中分别打开三个虚拟机" class="headerlink" title="在VMware中分别打开三个虚拟机"></a>在VMware中分别打开三个虚拟机</h2><p>第一次打开时一定要选择我已移动此虚拟机！否则需要重新配置IP<br>如果ip变了，要么重新配ip（百度），要么删掉重新拷贝一个；<br>验证：打开hadoop01/02/03 使用ifconfig看ip地址分别应该是<br>192.168.146.130/131/132；</p><h2 id="设置NAT模式，固定IP，可上网"><a href="#设置NAT模式，固定IP，可上网" class="headerlink" title="设置NAT模式，固定IP，可上网"></a>设置NAT模式，固定IP，可上网</h2><p>先改本机（win）的虚拟网卡：修改VMnet8配置如下<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/82f4a98b3ba5463cbfb74a0083801581.jpg" alt="82f4a98b3ba5463cbfb74a0083801581.jpg-117.1kB"><br>再改虚拟机的网络设置：虚拟机-&gt;编辑-&gt;虚拟网络设置，如下<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/7C54B6589AD649C787858F0601767DA7.jpg" alt="7C54B6589AD649C787858F0601767DA7.jpg-120.5kB"><br>验证：三个节点打开浏览器看是否能上网，不要用ping，<br>如果不能上网重复第三步；</p><h2 id="运行一下"><a href="#运行一下" class="headerlink" title="运行一下"></a>运行一下</h2><p>三个节点分别有hadoop，zookeeper，storm，kafka，flume，maven<br>hadoop开：start-all.sh<br>hadoop关：stop-all.sh<br>其余开关：<br>先在根目录 cd cmd<br>zookeeper开：sh zookeeperstart.sh<br>zookeeper关：sh zookeeperstop.sh<br>kafka开：sh kafkastart.sh<br>kafka关：sh kafkastop.sh<br>storm开：stormstart.sh<br>storm关：stormstop.sh<br>对于flume的开启：<br>先cd /usr/local/flume<br>再bin/flume-ng agent –conf conf –conf-file conf/flume-conf.properties –name producer -Dflume.root.logger=INFO,console<br>对于flume的关闭：<br>直接关终端或Ctrl+C即可</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 调试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用flume完成数据的接收</title>
      <link href="/article/6515.html"/>
      <url>/article/6515.html</url>
      
        <content type="html"><![CDATA[<p>使用flume完成数据的接收<br>场景：source是通过tcp发送，chnnel处理过滤字段，sink存在集群中</p><a id="more"></a><h2 id="适合①-注意，syslog需要特定环境，也可用telnet发送数据"><a href="#适合①-注意，syslog需要特定环境，也可用telnet发送数据" class="headerlink" title="适合①[注意，syslog需要特定环境，也可用telnet发送数据]"></a>适合①[注意，syslog需要特定环境，也可用telnet发送数据]</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">source[syslogtcp],sink[hdfs]</span><br><span class="line">a1.sources &#x3D; r1</span><br><span class="line">a1.sinks &#x3D; k1</span><br><span class="line">a1.channels &#x3D; c1</span><br><span class="line"></span><br><span class="line"># Describe&#x2F;configure the source</span><br><span class="line">a1.sources.r1.type &#x3D; syslogtcp</span><br><span class="line">a1.sources.r1.port &#x3D; 12345</span><br><span class="line">a1.sources.r1.host &#x3D;hadoop01</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">a1.sinks.k1.type &#x3D; hdfs</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br><span class="line">###HDFS的数目路径</span><br><span class="line">a1.sinks.k1.hdfs.path &#x3D; hdfs:&#x2F;&#x2F;hadoop01:9000&#x2F;flume</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix &#x3D; Syslog</span><br><span class="line">a1.sinks.k1.hdfs.round &#x3D; true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue &#x3D; 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit &#x3D; minute</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">a1.channels.c1.type &#x3D; memory</span><br><span class="line">a1.channels.c1.capacity &#x3D; 1000</span><br><span class="line">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class="line"></span><br><span class="line"># Bind the source and sink to the channel</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 flume]$ start-all.sh</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -mkdir flume</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls</span><br><span class="line">drwxr-xr-x   - hadoop supergroup          0 2017-03-12 17:14 flume</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接收端：bin&#x2F;flume-ng agent --conf conf --conf-file conf&#x2F;syslog.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br><span class="line">发送端：telnet hadoop01 12345，，，</span><br><span class="line">结果：</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls &#x2F;flume &#x2F;&#x2F;注意在hadoop下面写文件查看时，文件夹要加“&#x2F;”</span><br><span class="line">Found 13 items</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        177 2017-03-12 18:09 &#x2F;flume&#x2F;My_netcat_log.1489313346930</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        224 2017-03-12 18:16 &#x2F;flume&#x2F;My_netcat_log.1489313794747</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        185 2017-03-12 17:21 &#x2F;flume&#x2F;Syslog.1489310474526</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        149 2017-03-12 17:21 &#x2F;flume&#x2F;Syslog.1489310474527</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls flume &#x2F;&#x2F;没有“&#x2F;”会看不到！！！！</span><br><span class="line">[hadoop@hadoop01 flume]$ </span><br><span class="line">[hadoop@hadoop01 flume]$</span><br></pre></td></tr></table></figure><h2 id="适合②-使用telnet来发送数据"><a href="#适合②-使用telnet来发送数据" class="headerlink" title="适合②[使用telnet来发送数据]"></a>适合②[使用telnet来发送数据]</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">source[netcat],sink[hdfs]</span><br><span class="line"># Describe&#x2F;configure the source</span><br><span class="line">a1.sources.r1.type &#x3D; netcat</span><br><span class="line">a1.sources.r1.port &#x3D; 12321</span><br><span class="line">a1.sources.r1.bind &#x3D; hadoop01</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">a1.sinks.k1.type &#x3D; hdfs</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br><span class="line">###HDFS的数目路径</span><br><span class="line">a1.sinks.k1.hdfs.path &#x3D; hdfs:&#x2F;&#x2F;hadoop01:9000&#x2F;flume</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix &#x3D; My_netcat_log</span><br><span class="line">a1.sinks.k1.hdfs.round &#x3D; true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue &#x3D; 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit &#x3D; minute</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">a1.channels.c1.type &#x3D; memory</span><br><span class="line">a1.channels.c1.capacity &#x3D; 1000</span><br><span class="line">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class="line"></span><br><span class="line"># Bind the source and sink to the channel</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">接收端：bin&#x2F;flume-ng agent --conf conf --conf-file conf&#x2F;netcat.conf --name a1 -Dflume.root.logger&#x3D;INFO,console</span><br><span class="line">发送端：telnet hadoop01 12345，，，</span><br><span class="line">结果：</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls &#x2F;flume</span><br><span class="line">Found 13 items</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        177 2017-03-12 18:09 &#x2F;flume&#x2F;My_netcat_log.1489313346930</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        224 2017-03-12 18:16 &#x2F;flume&#x2F;My_netcat_log.1489313794747</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls flume</span><br><span class="line">[hadoop@hadoop01 flume]$ </span><br><span class="line">[hadoop@hadoop01 flume]$</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="适合③-使用curl来发送数据"><a href="#适合③-使用curl来发送数据" class="headerlink" title="适合③[使用curl来发送数据]"></a>适合③[使用curl来发送数据]</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">source[http],sink[hdfs]</span><br><span class="line">a1.sources &#x3D; r1</span><br><span class="line">a1.sinks &#x3D; k1</span><br><span class="line">a1.channels &#x3D; c1</span><br><span class="line"></span><br><span class="line"># Describe&#x2F;configure the source</span><br><span class="line">a1.sources.r1.type &#x3D; http</span><br><span class="line">a1.sources.r1.port &#x3D; 50000</span><br><span class="line">a1.sources.r1.bind &#x3D; hadoop01</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">a1.sinks.k1.type &#x3D; hdfs</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br><span class="line">###HDFS</span><br><span class="line">a1.sinks.k1.hdfs.path &#x3D; hdfs:&#x2F;&#x2F;hadoop01:9000&#x2F;flume</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix &#x3D; Http_log</span><br><span class="line">a1.sinks.k1.hdfs.round &#x3D; true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue &#x3D; 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit &#x3D; minute</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">a1.channels.c1.type &#x3D; memory</span><br><span class="line">a1.channels.c1.capacity &#x3D; 1000</span><br><span class="line">a1.channels.c1.transactionCapacity &#x3D; 100</span><br><span class="line"></span><br><span class="line"># Bind the source and sink to the channel</span><br><span class="line">a1.sources.r1.channels &#x3D; c1</span><br><span class="line">a1.sinks.k1.channel &#x3D; c1</span><br><span class="line"> </span><br><span class="line">接收端：bin&#x2F;flume-ng agent -c conf -f conf&#x2F;http.conf  -n a1 -Dflume.root.logger&#x3D;INFO,console</span><br><span class="line">发送端：</span><br><span class="line">[hadoop@hadoop01 flume]$ curl -X POST -d&#39;[&#123;&quot;headers&quot;:&#123;&quot;h1&quot;:&quot;v1&quot;,&quot;h2&quot;:&quot;v2&quot;&#125;,&quot;body&quot;:&quot;hello body&quot;&#125;]&#39;  http:&#x2F;&#x2F;hadoop01:50000</span><br><span class="line">[hadoop@hadoop01 flume]$ curl -X POST -d&#39;[&#123;&quot;headers&quot;:&#123;&quot;h1&quot;:&quot;v1&quot;,&quot;h2&quot;:&quot;v2&quot;&#125;,&quot;body&quot;:&quot;asdascfascas&quot;&#125;]&#39;  http:&#x2F;&#x2F;hadoop01:50000</span><br><span class="line">[hadoop@hadoop01 flume]$ curl -X POST -d&#39;[&#123;&quot;headers&quot;:&#123;&quot;h1&quot;:&quot;v1&quot;,&quot;h2&quot;:&quot;v2&quot;&#125;,&quot;body&quot;:&quot;xxxxxxxxxxx&quot;&#125;]&#39;  http:&#x2F;&#x2F;hadoop01:50000</span><br><span class="line">结果：</span><br><span class="line">[hadoop@hadoop01 flume]$ hadoop fs -ls &#x2F;flume</span><br><span class="line">Found 16 items</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        145 2017-03-12 18:49 &#x2F;flume&#x2F;Http_log.1489315734229</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        147 2017-03-12 18:49 &#x2F;flume&#x2F;Http_log.1489315785602</span><br><span class="line">-rw-r--r--   3 hadoop supergroup        161 2017-03-12 18:49 &#x2F;flume&#x2F;Http_log.1489315785603</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flume </tag>
            
            <tag> 实践 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远程IDEA调试Storm</title>
      <link href="/article/ce1b.html"/>
      <url>/article/ce1b.html</url>
      
        <content type="html"><![CDATA[<p>现在IDEA编译成功topo后，使用WinSCP将打包好的包传到主节点<br>注意：打包之前–要讲 [ 本地模式 ] 改为 [ 集群模式 ]</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;本地测试模式           </span><br><span class="line">    LocalCluster cluster &#x3D; new LocalCluster();</span><br><span class="line">    cluster.submitTopology(&quot;firstTopo&quot;, conf, builder.createTopology());</span><br><span class="line">    Utils.sleep(100000);</span><br><span class="line">    cluster.killTopology(&quot;firstTopo&quot;);</span><br><span class="line">    cluster.shutdown();</span><br><span class="line">&#x2F;&#x2F;集群提交模式</span><br><span class="line">    StormSubmitter.submitTopology(&quot;firstTopo&quot;, conf, builder.createTopology());</span><br></pre></td></tr></table></figure><a id="more"></a><hr><p>storm.yaml文件中的seeds选项不能与host同时存在<br>如果同时存在，则storm运行时会出错：提交任务找不到主类等等</p><hr><p>修改storm配置中的UI端口，只能！在nimbus中修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在supervisor中修改会导致supervisor启动不了，会报一下错误</span><br><span class="line">Caused by: while scanning a simple key</span><br><span class="line"> in &#39;reader&#39;, line 32, column 2:</span><br><span class="line">     ui.port &#x3D; 8000</span><br><span class="line">     ^</span><br><span class="line">could not found expected &#39;:&#39;</span><br><span class="line"> in &#39;reader&#39;, line 33, column 1:</span><br><span class="line">    #</span><br></pre></td></tr></table></figure><hr><p>package是把jar打到本项目的target下，<br>install时把target下的jar安装到本地仓库，供其他项目使用<br>此处使用<br>先clean再使用pakage打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">storm jar  simple-1.0.jar Random.FirstTopo</span><br></pre></td></tr></table></figure><p>Maven配置文件</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line">         xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.test&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;simple&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;simple&lt;/name&gt;</span><br><span class="line">    &lt;url&gt;http:<span class="comment">//maven.apache.org&lt;/url&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.storm&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;storm-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0.1&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;compile&lt;/scope&gt;  </span><br><span class="line">            <span class="comment">//引入依赖的方式默认[没有scope]为compile，意为最后打包无需包含此依赖，</span></span><br><span class="line">            <span class="comment">//provided必须显式写出scope[打包时会包含依赖]</span></span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            <span class="comment">//可删去</span></span><br><span class="line">            &lt;plugin&gt;  </span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;                                          </span><br><span class="line">                    <span class="comment">//实测此处的1.8没有什么用处，改成1.6也行，但是最好改成与系统一致的jdk版本</span></span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.4&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span><br><span class="line">                    &lt;/descriptorRefs&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure><hr><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-328.3kB"></p><p>Random包下有三个文件，则再提交时，main入口class应为 Random.FirstTopo<br>提交命令中的jar应为上图中的simple-1.0.jar</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">simple-1.0.jar                                           5 KB</span><br><span class="line">simple-1.0-jar-with-dependencies.jar    24735 KB</span><br><span class="line">src&#x2F;main&#x2F;java&#x2F;Random : src,main,java都不算路径，Random才对应eclipse中的package</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>附SenqueceBolt:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package Random; &#x2F;**</span><br><span class="line"> * Created by hadoop on 2017&#x2F;3&#x2F;1.</span><br><span class="line"> *&#x2F;</span><br><span class="line">import org.apache.storm.topology.BasicOutputCollector;</span><br><span class="line">import org.apache.storm.topology.OutputFieldsDeclarer;</span><br><span class="line">import org.apache.storm.topology.base.BaseBasicBolt;</span><br><span class="line">import org.apache.storm.tuple.Tuple;</span><br><span class="line"></span><br><span class="line">public class SenqueceBolt extends BaseBasicBolt&#123;</span><br><span class="line">    &#x2F;* (non-Javadoc)</span><br><span class="line">     * @see backtype.storm.topology.IBasicBolt#execute(backtype.storm.tuple.Tuple, backtype.storm.topology.BasicOutputCollector)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void execute(Tuple input, BasicOutputCollector collector) &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">        String word &#x3D; (String) input.getValue(0);</span><br><span class="line">        String out &#x3D; &quot;I&#39;m &quot; + word +  &quot;!&quot;;</span><br><span class="line">        System.out.println(&quot;out&#x3D;&quot; + out);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;* (non-Javadoc)</span><br><span class="line">     * @see backtype.storm.topology.IComponent#declareOutputFields(backtype.storm.topology.OutputFieldsDeclarer)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void declareOutputFields(OutputFieldsDeclarer declarer) &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>附RandomSpout:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package Random; &#x2F;**</span><br><span class="line"> * Created by hadoop on 2017&#x2F;3&#x2F;1.</span><br><span class="line"> *&#x2F;</span><br><span class="line">import org.apache.storm.spout.SpoutOutputCollector;</span><br><span class="line">import org.apache.storm.task.TopologyContext;</span><br><span class="line">import org.apache.storm.topology.OutputFieldsDeclarer;</span><br><span class="line">import org.apache.storm.topology.base.BaseRichSpout;</span><br><span class="line">import org.apache.storm.tuple.Fields;</span><br><span class="line">import org.apache.storm.tuple.Values;</span><br><span class="line"></span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Random;</span><br><span class="line"></span><br><span class="line">public class RandomSpout extends BaseRichSpout&#123;</span><br><span class="line">    private SpoutOutputCollector collector;</span><br><span class="line">    private static String[] words &#x3D; &#123;&quot;happy&quot;,&quot;excited&quot;,&quot;angry&quot;&#125;;</span><br><span class="line"></span><br><span class="line">    &#x2F;* (non-Javadoc)</span><br><span class="line">     * @see backtype.storm.spout.ISpout#open(java.util.Map, backtype.storm.task.TopologyContext, backtype.storm.spout.SpoutOutputCollector)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void open(Map arg0, TopologyContext arg1, SpoutOutputCollector arg2) &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">        this.collector &#x3D; arg2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;* (non-Javadoc)</span><br><span class="line">     * @see backtype.storm.spout.ISpout#nextTuple()</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void nextTuple() &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">        String word &#x3D; words[new Random().nextInt(words.length)];</span><br><span class="line">        collector.emit(new Values(word));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;* (non-Javadoc)</span><br><span class="line">     * @see backtype.storm.topology.IComponent#declareOutputFields(backtype.storm.topology.OutputFieldsDeclarer)</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void declareOutputFields(OutputFieldsDeclarer arg0) &#123;</span><br><span class="line">        &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">        arg0.declare(new Fields(&quot;randomstring&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>附FirstTopo:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package Random; &#x2F;**</span><br><span class="line"> * Created by hadoop on 2017&#x2F;3&#x2F;1.</span><br><span class="line"> *&#x2F;</span><br><span class="line">import org.apache.storm.Config;</span><br><span class="line">import org.apache.storm.LocalCluster;</span><br><span class="line">import org.apache.storm.StormSubmitter;</span><br><span class="line">import org.apache.storm.topology.TopologyBuilder;</span><br><span class="line">import org.apache.storm.utils.Utils;</span><br><span class="line"></span><br><span class="line">public class FirstTopo &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        TopologyBuilder builder &#x3D; new TopologyBuilder();</span><br><span class="line">        builder.setSpout(&quot;spout&quot;, new RandomSpout());</span><br><span class="line">        builder.setBolt(&quot;bolt&quot;, new SenqueceBolt()).shuffleGrouping(&quot;spout&quot;);</span><br><span class="line">        Config conf &#x3D; new Config();</span><br><span class="line">        conf.setDebug(false);</span><br><span class="line">        if (args !&#x3D; null &amp;&amp; args.length &gt; 0) &#123;</span><br><span class="line">            conf.setNumWorkers(3);</span><br><span class="line">            StormSubmitter.submitTopology(args[0], conf, builder.createTopology());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            LocalCluster cluster &#x3D; new LocalCluster();</span><br><span class="line">            cluster.submitTopology(&quot;firstTopo&quot;, conf, builder.createTopology());</span><br><span class="line">            Utils.sleep(100000);</span><br><span class="line">            cluster.killTopology(&quot;firstTopo&quot;);</span><br><span class="line">            cluster.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> Storm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka的应用场景</title>
      <link href="/article/dcd4.html"/>
      <url>/article/dcd4.html</url>
      
        <content type="html"><![CDATA[<h2 id="Kafka的应用场景"><a href="#Kafka的应用场景" class="headerlink" title="Kafka的应用场景"></a>Kafka的应用场景</h2><p><strong>1 消息队列</strong></p><blockquote><p>比起大多数的消息系统来说，Kafka有更好的吞吐量，内置的分区，冗余及容错性，这让Kafka成为了一个很好的大规模消息处理应用的解决方案。消息系统 一般吞吐量相对较低，但是需要更小的端到端延时，并尝尝依赖于Kafka提供的强大的持久性保障。在这个领域，Kafka足以媲美传统消息系统，如ActiveMR或RabbitMQ。</p></blockquote><a id="more"></a><p><strong>2 行为跟踪</strong></p><blockquote><p>Kafka的另一个应用场景是跟踪用户浏览页面、搜索及其他行为，以发布-订阅的模式实时记录到对应的topic里。那么这些结果被订阅者拿到后，就可以做进一步的实时处理，或实时监控，或放到hadoop/离线数据仓库里处理。</p></blockquote><p><strong>3 元信息监控</strong></p><blockquote><p>作为操作记录的监控模块来使用，即汇集记录一些操作信息，可以理解为运维性质的数据监控吧。</p></blockquote><p><strong>4 日志收集</strong></p><blockquote><p>日 志收集方面，其实开源产品有很多，包括Scribe、Apache Flume。很多人使用Kafka代替日志聚合（log aggregation）。日志聚合一般来说是从服务器上收集日志文件，然后放到一个集中的位置（文件服务器或HDFS）进行处理。然而Kafka忽略掉 文件的细节，将其更清晰地抽象成一个个日志或事件的消息流。这就让Kafka处理过程延迟更低，更容易支持多数据源和分布式数据处理。比起以日志为中心的 系统比如Scribe或者Flume来说，Kafka提供同样高效的性能和因为复制导致的更高的耐用性保证，以及更低的端到端延迟。</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p><strong>5 流处理</strong></p><blockquote><p>这 个场景可能比较多，也很好理解。保存收集流数据，以提供之后对接的Storm或其他流式计算框架进行处理。很多用户会将那些从原始topic来的数据进行 阶段性处理，汇总，扩充或者以其他的方式转换到新的topic下再继续后面的处理。例如一个文章推荐的处理流程，可能是先从RSS数据源中抓取文章的内 容，然后将其丢入一个叫做“文章”的topic中；后续操作可能是需要对这个内容进行清理，比如回复正常数据或者删除重复数据，最后再将内容匹配的结果返 还给用户。这就在一个独立的topic之外，产生了一系列的实时数据处理的流程。Strom和Samza是非常著名的实现这种类型数据转换的框架。</p></blockquote><p><strong>6 事件源</strong></p><blockquote><p>事件源是一种应用程序设计的方式，该方式的状态转移被记录为按时间顺序排序的记录序列。Kafka可以存储大量的日志数据，这使得它成为一个对这种方式的应用来说绝佳的后台。比如动态汇总（News feed）。</p></blockquote><p><strong>7 持久性日志（commit log）</strong></p><blockquote><p>Kafka可以为一种外部的持久性日志的分布式系统提供服务。这种日志可以在节点间备份数据，并为故障节点数据回复提供一种重新同步的机制。Kafka中日志压缩功能为这种用法提供了条件。在这种用法中，Kafka类似于Apache BookKeeper项目。</p></blockquote><p><strong>8 其他</strong></p><blockquote><p>在大数据系统中，常常会碰到一个问题，整个大数据是由各个子系统组成，数据需要在各个子系统中高性能，低延迟的不停流转。传统的企业消息系统并不是非常适合 大规模的数据处理。为了已在同时搞定在线应用（消息）和离线应用（数据文件，日志）Kafka就出现了。Kafka可以起到两个作用：</p></blockquote><ul><li>降低系统组网复杂度。</li><li>降低编程复杂度，各个子系统不在是相互协商接口，各个子系统类似插口插在插座上，Kafka承担高速数据总线的作用。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 概述 </tag>
            
            <tag> 转载 </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flume+Kafka联通</title>
      <link href="/article/2b6e.html"/>
      <url>/article/2b6e.html</url>
      
        <content type="html"><![CDATA[<h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><p>前提是要先把flume和kafka独立的部分先搭建好。<br>下载插件包<br>下载flume-kafka-plus:<a href="https://github.com/beyondj2ee/flumeng-kafka-plugin" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/beyondj2ee/flumeng-kafka-plugin</a><br>把lib目录下的<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/16170518367.jpeg" alt="16170518367.jpeg-13.2kB"></p><a id="more"></a><p>和package下的<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/16170609628.jpeg" alt="16170609628.jpeg-3.8kB"></p><p>都放到flume的lib目录<br>修改原有的flume-conf文件<br>在插件包里有一个flume-conf.properties，把这个文件放到flume的conf文件夹里</p><h4 id="修改以下内容"><a href="#修改以下内容" class="headerlink" title="修改以下内容"></a>修改以下内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">producer.sources.s.type &#x3D; exec</span><br><span class="line">producer.sources.s.command &#x3D; tail -f -n+1 ~&#x2F;tmp&#x2F;test.log</span><br><span class="line">producer.sources.s.channels &#x3D; c</span><br><span class="line">……</span><br><span class="line">producer.sinks.r.custom.topic.name&#x3D;test</span><br><span class="line">……</span><br><span class="line">consumer.sources.s.custom.topic.name&#x3D;test</span><br></pre></td></tr></table></figure><blockquote><p>producer.sources.s.type = exec<br>producer.sources.s.command = tail -f -n+1 ~/tmp/test.log<br>producer.sources.s.channels = c</p></blockquote><p>以上路径处需要注意：</p><ul><li>尽量不要使用<del>/tmp/这种目录格式，</del>代表的是当前用户的目录。</li><li>使用tail -f filename 就可以了这里</li><li>文件目录要对应正确路径，且对应位置要有相应文件！！！！</li><li>与文件权限无关</li></ul><h4 id="启动zookeeper"><a href="#启动zookeeper" class="headerlink" title="启动zookeeper"></a>启动zookeeper</h4><blockquote><p>zkServer.sh start</p></blockquote><h4 id="启动kafka-broker"><a href="#启动kafka-broker" class="headerlink" title="启动kafka broker"></a>启动kafka broker</h4><blockquote><p>bin/kafka-server-start.sh config/server.properties</p></blockquote><h4 id="创建kafka-topic"><a href="#创建kafka-topic" class="headerlink" title="创建kafka topic"></a>创建kafka topic</h4><blockquote><p>bin/kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 1 –partitions 1 –topic test</p></blockquote><h4 id="启动kafka-consumer"><a href="#启动kafka-consumer" class="headerlink" title="启动kafka consumer"></a>启动kafka consumer</h4><blockquote><p>bin/kafka-console-consumer.sh –zookeeper localhost:2181 –topic test –from-beginning</p></blockquote><h4 id="启动flume"><a href="#启动flume" class="headerlink" title="启动flume"></a>启动flume</h4><blockquote><p>bin/flume-ng agent –conf conf –conf-file conf/flume-conf.properties –name producer -Dflume.root.logger=INFO,console</p></blockquote><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><blockquote><p>echo “this is a test” &gt;&gt; ~/tmp/test.txt<br>此时只要能在consumer里现“this is a test”就表示成功</p></blockquote><p>测试成功<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-341.1kB"></p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
            <tag> 整合 </tag>
            
            <tag> Flume </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA中运行Topology</title>
      <link href="/article/1fbc.html"/>
      <url>/article/1fbc.html</url>
      
        <content type="html"><![CDATA[<h2 id="基本调试过程"><a href="#基本调试过程" class="headerlink" title="基本调试过程"></a>基本调试过程</h2><p>现在IDEA编译成功topo后，使用WinSCP将打包好的包传到主节点</p><p>注意：打包之前–要讲 [ 本地模式 ] 改为 [ 集群模式 ]</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;本地测试模式           </span><br><span class="line">LocalCluster cluster &#x3D; new LocalCluster();</span><br><span class="line">    cluster.submitTopology(&quot;firstTopo&quot;, conf, builder.createTopology());</span><br><span class="line">    Utils.sleep(100000);</span><br><span class="line">    cluster.killTopology(&quot;firstTopo&quot;);</span><br><span class="line">    cluster.shutdown();</span><br><span class="line">    &#x2F;&#x2F;集群提交模式</span><br><span class="line">    StormSubmitter.submitTopology(&quot;firstTopo&quot;, conf, builder.createTopology());</span><br></pre></td></tr></table></figure><a id="more"></a><p>storm.yaml文件中的seeds选项不能与host同时存在<br>如果同时存在，则storm运行时会出错：提交任务找不到主类等等</p><p>修改storm配置中的UI端口，只能！在nimbus中修改<br>在supervisor中修改会导致supervisor启动不了，会报一下错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Caused by: while scanning a simple key</span><br><span class="line"> in &#39;reader&#39;, line 32, column 2:</span><br><span class="line">     ui.port &#x3D; 8000</span><br><span class="line">     ^</span><br><span class="line">could not found expected &#39;:&#39;</span><br><span class="line"> in &#39;reader&#39;, line 33, column 1:</span><br><span class="line">    #</span><br></pre></td></tr></table></figure><p>package是把jar打到本项目的target下，<br>install时把target下的jar安装到本地仓库，供其他项目使用<br>此处使用<br>先clean再使用pakage打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">storm jar  simple-1.0.jar Random.FirstTopo</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.test&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;simple&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">    &lt;name&gt;simple&lt;&#x2F;name&gt;</span><br><span class="line">    &lt;url&gt;http:&#x2F;&#x2F;maven.apache.org&lt;&#x2F;url&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.storm&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;storm-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;scope&gt;compile&lt;&#x2F;scope&gt;  </span><br><span class="line">            &#x2F;&#x2F;引入依赖的方式默认[没有scope]为compile，意为最后打包无需包含此依赖，</span><br><span class="line">            &#x2F;&#x2F;provided必须显式写出scope[打包时会包含依赖]</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &#x2F;&#x2F;可删去</span><br><span class="line">            &lt;plugin&gt;  </span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;&#x2F;source&gt;              </span><br><span class="line">                    &#x2F;&#x2F;实测此处的1.8没有什么用处，改成1.6也行，但是最好改成与系统一致的jdk版本</span><br><span class="line">                    &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;&#x2F;encoding&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-assembly-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.4&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;descriptorRefs&gt;</span><br><span class="line">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;&#x2F;descriptorRef&gt;</span><br><span class="line">                    &lt;&#x2F;descriptorRefs&gt;</span><br><span class="line">                &lt;&#x2F;configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;make-assembly&lt;&#x2F;id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;single&lt;&#x2F;goal&gt;</span><br><span class="line">                        &lt;&#x2F;goals&gt;</span><br><span class="line">                    &lt;&#x2F;execution&gt;</span><br><span class="line">                &lt;&#x2F;executions&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/%E6%88%AA%E5%9B%BE.png" alt="截图.png-328.3kB"></p><p>Random包下有三个文件，则再提交时，main入口class应为 Random.FirstTopo<br>提交命令中的jar应为上图中的simple-1.0.jar<br>simple-1.0.jar                                           5 KB<br>simple-1.0-jar-with-dependencies.jar    24735 KB<br>src/main/java/Random : src,main,java都不算路径，Random才对应eclipse中的package</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="运行组合用例"><a href="#运行组合用例" class="headerlink" title="运行组合用例"></a>运行组合用例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Object : kafka-storm-demo</span><br><span class="line">Assign：</span><br><span class="line"> </span><br><span class="line">[IDEA] 打包的时候要改为 集群 模式</span><br><span class="line">[IDEA] 修改topic的名称</span><br><span class="line">[IDEA] 验证成功与否需要在console中查看System.out的输出</span><br><span class="line">[Attention!] 此实例可以放在集群中提交，但是在集群中无法验证是否执行成功</span><br><span class="line">  因为代码中只有 [ 系统输出 ] 在集群中提交并不会将输出写入日志，</span><br><span class="line">  也就是说，查看日志等方法无法知道是否执行成功，唯一的方式是</span><br><span class="line">  在IDEA的调试窗口看输出。</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Prepare] IDEA运行程序</span><br><span class="line">[Prepare] CRT_1开启flume</span><br><span class="line">[Prepare] CRT_2开启kafka-consumer</span><br><span class="line">[Prepare] CRT_3开启shell脚本循环写log文件（模拟生产）</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Process-1] CRT_3循环写log，文本 &#x3D;&gt; logg.log[会在界面输出]</span><br><span class="line">[Process-2] CRT_1监控logg文件，文本 &#x3D;&gt; logg.log &#x3D;&gt; flume[输出同上一致]</span><br><span class="line">[Process-3] flume充当producer，文本 &#x3D;&gt; logg.log &#x3D;&gt; flume &#x3D;&gt; kafkaproducer</span><br><span class="line">[Process-4] storm获取产生数据并处理，文本 &#x3D;&gt; logg.log &#x3D;&gt; flume &#x3D;&gt; kafkaproducer &#x3D;&gt; storm</span><br><span class="line">[Process-5] 数据被订阅方consumer接收，文本 &#x3D;&gt; logg.log &#x3D;&gt; flume &#x3D;&gt; kafkaproducer &#x3D;&gt; storm &#x3D;&gt; kafkaconsumer</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flume+kafka+storm</span><br><span class="line">[do] topic：test 上述各方的topic要一致，不一致要在代码中改过来</span><br><span class="line">[do] cd cmd  &#x3D;&gt; sh logg.sh                                        </span><br><span class="line">                                                                            打开脚本生产数据[1]</span><br><span class="line">[do]应有的终端窗口 flume | consumer | shell-log | idea-console </span><br><span class="line">[do] bin&#x2F;flume-ng agent --conf conf --conf-file conf&#x2F;flume-conf.properties --name producer -Dflume.root.logger&#x3D;INFO,console                                </span><br><span class="line">                                                                            开启flume[2]</span><br><span class="line">[do] kafka-console-producer.sh --broker-list hadoop01:9092 --topic test     开启消费者[3]</span><br><span class="line">[do] storm jar simple-1.0.jar Skafka.KafkaTopologytest提交任务[4]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> Storm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA中调试Topology出现的错误</title>
      <link href="/article/e19a.html"/>
      <url>/article/e19a.html</url>
      
        <content type="html"><![CDATA[<p>在IDEA的maven项目中编写Topology出错：<br>NoClassFound找不到主类：解决–<br>在pom.xml中，找到<dependence>中的storm，添加&lt;&gt;compi&lt;&gt;</dependence></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kafka中的topic不新建也可以使用</span><br><span class="line">如果不执行 .&#x2F;kafka-topics.sh --create --zookeeper hadoop01:2181 --replication-factor 1 --partitions 1 --topic test</span><br><span class="line">直接执行下述两条命令：</span><br><span class="line">kafka生产者客户端命令</span><br><span class="line">.&#x2F;kafka-console-producer.sh --broker-list hadoop01:9092 --topic test</span><br><span class="line">kafka消费者客户端命令</span><br><span class="line">.&#x2F;kafka-console-consumer.sh -zookeeper hadoop01:2181 --from-beginning --topic test</span><br><span class="line">也可以起到新建topic的目的</span><br></pre></td></tr></table></figure><a id="more"></a><hr><p>maven有很多插件，在IDEA中调试时需要使用compile插件来执行compile命令、</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn compile exec:Java -Dstorm.topology&#x3D;storm.starter.WordCountTopology 错</span><br><span class="line">mvn compile exec:java -Dstorm.topology&#x3D;storm.starter.WordCountTopology 对</span><br></pre></td></tr></table></figure><p>调试Topology过程：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pom.xml ：                     打包出错，jdk版本问题，打包中[显式指定]</span><br><span class="line">项目setting加M2_HOME　：　      -DmultiXXXXX错误[首行出错]</span><br><span class="line">import org.apache.storm..　：   新版storm包　１.０.ｘ</span><br><span class="line">import backtype.storm..　：　   旧版storm包版本 ０.９.ｘ</span><br><span class="line">src目录结构 ：待探究</span><br><span class="line">本地运行找不到IRichSpout ：     同compile改动</span><br><span class="line">打包compile、provided ：        ClassNotFoundError</span><br><span class="line">SLF4J ERROR ：                  引入两个dependence - slf4j+log4j</span><br></pre></td></tr></table></figure><hr><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>kafka启动问题的日志在logs文件夹中的server.log</p><p>kafka主题的日志才在自己自定义的目录中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2017-03-01 17:23:12.906 o.a.s.u.NimbusClient [WARN] Using deprecated config nimbus.host for backward compatibility. Please update your storm.yaml so it only has config nimbus.seeds</span><br><span class="line">2017-03-01 17:23:12.906 o.a.s.u.NimbusClient [WARN] Using deprecated config nimbus.host for backward compatibility. Please update your storm.yaml so it only has config nimbus.seeds</span><br></pre></td></tr></table></figure><p>错误原因：更改UI端口只修改了nimbus的，没有修改supervisor的</p><p>storm nimbus启动失败：nimbus进程不可用时，storm ui将无法访问<br>查nimbus.log无果，直接使用命令./storm nimbus 则会在下方打印出错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:&#x2F;usr&#x2F;local&#x2F;storm&#x2F;tzl-depend.jar!&#x2F;org&#x2F;slf4j&#x2F;impl&#x2F;StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:&#x2F;usr&#x2F;local&#x2F;storm&#x2F;lib&#x2F;log4j-slf4j-impl-2.1.jar!&#x2F;org&#x2F;slf4j&#x2F;impl&#x2F;StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http:&#x2F;&#x2F;www.slf4j.org&#x2F;codes.html#multiple_bindings for an explanation.</span><br></pre></td></tr></table></figure><p>是因为之前提交的topo有slf4j的错误，再次开启storm时就会自动运行[叙述不恰当]而出错<br>改：删掉之<br>（使用storm kill不行，因为nimbus已经出错启动不起来了，故而直接删除掉相关文件）</p><p>下图如是：tzl.jar和tzl-depend.jar是之前提交的错误任务，其有slf4j的错误，在启动时好像storm命令会扫描整个目录文件<br>解决：删掉后，storm nimbus &amp; 完美运行</p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> IDEA </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flume、Kafka、Storm如何结合使用</title>
      <link href="/article/f84f.html"/>
      <url>/article/f84f.html</url>
      
        <content type="html"><![CDATA[<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>如何仔细阅读过关于Flume、Kafka、Storm的介绍，就会知道，在他们各自之间对外交互发送消息的原理。<br>在后面的例子中，主要对Flume的sink进行重构，调用kafka的消费生产者(producer)发送消息;在Storm的spout中继承IRichSpout接口，调用kafka的消息消费者(Consumer)来接收消息，然后经过几个自定义的Bolt，将自定义的内容进行输出。</p><a id="more"></a><h4 id="flume和kafka的整合"><a href="#flume和kafka的整合" class="headerlink" title="flume和kafka的整合"></a>flume和kafka的整合</h4><ul><li>复制flume要用到的kafka相关jar到flume目录下的lib里面。</li><li>编写sink.java文件,然后在eclipse导出jar包，放到flume-1.5.1-bin/lib目录中,项目中要引用flume-ng-configuration-1.5.0.jar,flume-ng-sdk-1.5.0.jar,flume-ng-core-1.5.0.jar,zkclient-0.3.jar,commons-logging-1.1.1.jar,在flume目录中，可以找到这几个jar文件，如果找不到就用find命令搜一下。</li><li>在m1上配置flume和kafka交互的agent</li><li>在m1,m2,s1,s2的机器上,分别启动kafka（如果不会请参考这篇文章介绍了kafka的安装、配置和启动《kafka2.9.2的分布式集群安装和demo(java api)测试》），然后在s1机器上再启动一个消息消费者consumer</li><li>在m1启动flume</li><li>在m1上再打开一个窗口，测试向flume中发送syslog<ul><li>m1打开的flume窗口中看最后一行的信息，Flume已经向kafka发送了消息</li></ul></li><li>在刚才s1机器上打开的kafka消费端，同样可以看到从Flume中发出的信息，说明flume和kafka已经调试成功了</li></ul><h4 id="kafka和storm的整合"><a href="#kafka和storm的整合" class="headerlink" title="kafka和storm的整合"></a>kafka和storm的整合</h4><ul><li>我们先在eclipse中写代码，在写代码之前，我们要先对maven进行配置，pom.xml配置文件内容如下：</li><li>编写KafkaSpouttest.java文件</li><li>编写KafkaTopologytest.java文件</li><li>测试kafka和storm的结合<ul><li>打开两个窗口(也可以在两台机器上分别打开)，分别m2上运行kafka的producer，在s1上运行kafka的consumer(如果刚才打开了就不用再打开),先测试kafka自运行是否正常。</li><li>如下所示，我在m2上运行producer，输入“hellowelcomeidoall.org”，在s1的机器上consumer同样收到了消息。说明kafka已经运行正常，并且消息通讯也没有问题。</li><li>m2机器输出的消息：</li><li>s1机器接收的消息：</li></ul></li><li>我们再在Eclipse中运行KafkaTopologytest.java，可以看到在控制台，同样收到了刚才在m2上kafka发送的消息。说明kafka和storm也打通了。</li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="flume、kafka、storm的整合"><a href="#flume、kafka、storm的整合" class="headerlink" title="flume、kafka、storm的整合"></a>flume、kafka、storm的整合</h4><ul><li>从上面两个例子我们可以看到，flume和kafka之前已经完成了通讯和部署，kafka和storm之间可以正常通讯，只差把storm的相关文件打包成jar部署到storm中即可完成三者的通讯。</li><li>Storm的安装、配置、部署，如果不了解，可以参考这篇文章《ubuntu12.04+storm0.9.2分布式集群的搭建》</li><li>复制kafka相关的jar包到storm的lib里面。（因为在上面我们已经说过，kafka和storm的整合，主要是重写storm的spout，调用kafka的Consumer来接收消息并打印，所在需要用到这些jar包）</li><li>在m1上启动storm nimbus</li><li>在s1,s2上启动storm supervisor</li><li>在m1上启动storm ui</li><li>将Eclipse中的文件打包成jar复制到做任意目录，然后用storm来运行</li><li>在flume中发消息，在storm中看是否有接收到<ul><li>在flume中发送的消息：</li><li>storm中显示的内容：</li></ul></li></ul><h5 id="通过以上实例，即完成了flume、kafka、storm之间的通讯，"><a href="#通过以上实例，即完成了flume、kafka、storm之间的通讯，" class="headerlink" title="通过以上实例，即完成了flume、kafka、storm之间的通讯，"></a>通过以上实例，即完成了flume、kafka、storm之间的通讯，</h5>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> Kafka </tag>
            
            <tag> Storm </tag>
            
            <tag> 整合 </tag>
            
            <tag> Flume </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka初使用</title>
      <link href="/article/45fb.html"/>
      <url>/article/45fb.html</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@hadoop01 bin]$ kafka-topics.sh --create --zookeeper hadoop01,hadoop02,hadoop03 --replication-factor 1 --partitions 3 --topic hadoop01</span><br><span class="line">Created topic &quot;hadoop01&quot;.</span><br><span class="line">[hadoop@hadoop01 bin]$ kafka-topics.sh --create --zookeeper hadoop01,hadoop02,hadoop03 --replication-factor 3 --partitions 1 --topic hadoop02</span><br><span class="line">Created topic &quot;hadoop02&quot;.</span><br><span class="line">[hadoop@hadoop01 bin]$ kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class="line">hadoop01</span><br><span class="line">hadoop02</span><br><span class="line">[hadoop@hadoop01 bin]$ kafka-topics.sh --describe --zookeeper localhost:2181 --topic hadoop01</span><br><span class="line">Topic:hadoop01  PartitionCount:3        ReplicationFactor:1     Configs:</span><br><span class="line">        Topic: hadoop01 Partition: 0    Leader: 3       Replicas: 3     Isr: 3</span><br><span class="line">        Topic: hadoop01 Partition: 1    Leader: 1       Replicas: 1     Isr: 1</span><br><span class="line">        Topic: hadoop01 Partition: 2    Leader: 2       Replicas: 2     Isr: 2</span><br><span class="line">----------------------------------</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>检查log目录，对于topic hadoop01，hadoop01为0号分区，hadoop02为1号分区。<br>而topic hadoop02则复制了3份，都为0号分区<br>hadoop01-1<br>hadoop02-0<br>hadoop01-2<br>hadoop02-0<br>hadoop01-0<br>hadoop02-0<br>即：hadoop01-0,1,2<br>hadoop02-0,0,0<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/C82B7620E6144C87BCEBB62E62FE14B8.jpg" alt="C82B7620E6144C87BCEBB62E62FE14B8.jpg-59kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/6A3AAA2431D14E198FA0BBD5DDCCB911.jpg" alt="6A3AAA2431D14E198FA0BBD5DDCCB911.jpg-49.7kB"><br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/34C69FFC6FBF48D18F2F58D5A8E9954F.jpg" alt="34C69FFC6FBF48D18F2F58D5A8E9954F.jpg-58.7kB"></p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
            <tag> 常用命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kafka集群常用命令</title>
      <link href="/article/24fd.html"/>
      <url>/article/24fd.html</url>
      
        <content type="html"><![CDATA[<p>kafka常用命令<br>以下是kafka常用命令行总结：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1、kafka服务启动</span><br><span class="line">.&#x2F;kafka-server-start.sh -daemon ..&#x2F;config&#x2F;server.properties </span><br><span class="line"></span><br><span class="line">&lt;!-- more --&gt;</span><br><span class="line"></span><br><span class="line">2、创建topic</span><br><span class="line">.&#x2F;kafka-topics.sh --create --zookeeper hadoop01:2181 --replication-factor 1 --partitions 1 --topic test</span><br><span class="line"></span><br><span class="line">2.1、为topic增加副本</span><br><span class="line">.&#x2F;kafka-reassign-partitions.sh -zookeeper hadoop01:2181 -reassignment-json-file json&#x2F;partitions-to-move.json -execute</span><br><span class="line"></span><br><span class="line">2.2、为topic增加partition</span><br><span class="line">.&#x2F;bin&#x2F;kafka-topics.sh –zookeeper hadoop01:2181 –alter –partitions 20 –topic test</span><br><span class="line"></span><br><span class="line">3、查看有哪些topic： </span><br><span class="line">.&#x2F;kafka-topics.sh --list --zookeeper hadoop01:2181</span><br><span class="line"></span><br><span class="line">4、查看topic的详细信息</span><br><span class="line">.&#x2F;kafka-topics.sh -zookeeper hadoop01:2181 -describe -topic test</span><br><span class="line"></span><br><span class="line">5、kafka生产者客户端命令</span><br><span class="line">.&#x2F;kafka-console-producer.sh --broker-list hadoop01:9092 --topic test</span><br><span class="line"></span><br><span class="line">6、kafka消费者客户端命令</span><br><span class="line">.&#x2F;kafka-console-consumer.sh -zookeeper hadoop01:2181 --from-beginning --topic test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:&#x2F;&#x2F;www.cxmoe.com](https:&#x2F;&#x2F;www.cxmoe.com) **&gt;&gt;**</span><br><span class="line"></span><br><span class="line">[成功] </span><br><span class="line"></span><br><span class="line">7、下线broker</span><br><span class="line">.&#x2F;kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper hadoop01:2181 --broker #brokerId# --num.retries 3 --retry.interval.ms 60</span><br><span class="line">shutdown broker</span><br><span class="line"></span><br><span class="line">8、删除topic</span><br><span class="line">.&#x2F;kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic test --zookeeper hadoop01:2181</span><br><span class="line">.&#x2F;kafka-topics.sh --zookeeper hadoop01:2181 --delete --topic test</span><br><span class="line">实际不会删除，只会显示marked for deletion</span><br><span class="line"></span><br><span class="line">9、查看consumer组内消费的offset</span><br><span class="line">.&#x2F;kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper hadoop01:2181 --group test --topic test</span><br><span class="line"> .&#x2F;kafka-consumer-offset-checker.sh --zookeeper hadoop01:2181 --group group1 --topic group1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
            <tag> 常用命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zkp,kfk,stm联通的问题</title>
      <link href="/article/3e6b.html"/>
      <url>/article/3e6b.html</url>
      
        <content type="html"><![CDATA[<p>要注意source的使用;<br>在root下使用之后有时需要在hadoop用户下再source一次才可以；</p><a id="more"></a><p>注意各个组件的配置文件<br>zookeeper：<br>zookeeper/conf/zoo.cfg<br>运行参数的配置文件<br>zookeeper/data 自定义工作目录<br>内有myid  version-2  zookeeper_server.pid，version-2里有snapshot.xxxxxxxx<br>zookeeper/没配置目录，默认在/bin/zookeeper.out<br>zookeeper/bin:<br>zkServer.sh start[正常的启动/默认后台运行]<br>注意：启动要各个节点分别启动，平等的peer关系，用id区分<br>zkServer.sh start-foreground带日志输出的启动[会不能退出！]<br>zkServer.sh status 显示follow、leader等信息<br>zkServer.sh stop 停止zookeeper<br>注意：zookeeper服务通常要最后关闭…</p><hr><p>storm :<br>storm/conf/storm.yaml<br>运行参数的配置文件<br>storm/workdir 自定义工作目录<br>storm/logs 默认目录位置<br>storm/bin:<br>./storm nimbus 在nimbus节点使用<br>./storm supervisor 在supervisor节点使用<br>注意：storm的各个节点有主控节点和工作节点之区别！<br>另：在终端运行时要使用nohup ./storm nimbus &amp; 来后台运行</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><hr><p>kafka :<br>kafka/logs 自定义的kafka工作目录<br>kafka/config/server.properties<br>运行参数的配置文件<br>kafka/config/zookeeper.properties<br>kafka所连接的zookeeper的相关配置</p><hr><p>nohup kafka-server-start  server.properties &amp; 启动<br>注意：kafka也要全部启动，类似平等的关系，用id区分</p><p>另：kafka-topics.sh的使用 +<br>–create –zookeeper hadoop01,hadoop02,hadoop03 –replication-factor 1 –partitions 3 –topic hadoop01<br>–list –zookeeper localhost:2181<br>–describe –zookeeper localhost:2181 –topic hadoop01 等等</p><p>注意：在关闭kafka时使用kafka-server-stop.sh之后，jps仍然显示有kafka，这时只要关闭zookeeper，就可将kafka彻底关闭，[错误][有时候就是关不掉kafka，kill也不好使？待解决]<br>顺序应为：kafka-&gt;zookeeper</p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kafka </tag>
            
            <tag> Zookeeperp </tag>
            
            <tag> Storm </tag>
            
            <tag> 整合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在windows下使用IDEA远程连接linux集群进行mapreduce调试</title>
      <link href="/article/5dab.html"/>
      <url>/article/5dab.html</url>
      
        <content type="html"><![CDATA[<p>在windows下使用IDEA远程连接linux集群进行mapreduce调试</p><p>改用户名，administrator改为hadoop，即改为linux集群的用户名，我的为hadoop</p><p>将hadoop.tar.gz解压至windows下，添加系统变量跟环境变量 HADOOP_HOME，添加PATH追加上HADOOP_HOME\bin;HADOOP_HOME\sbin;</p><a id="more"></a><p>在Windows下解压winutils包，将其内的七个文件复制到hadoop目录下的bin中和lib中</p><ul><li>打开IDEA，新建maven项目，测试maven是否正常打包，正常则跳过，不正常则（maven缺失）：下载maven并解压到自定义目录，配置环境变量和系统变量，MAVEN_HOME(可不要)和M2_HOME，并在PATH路径中加入M2_HOME\bin和\sbin。</li><li>再次新建maven项目，在idea左下角的运行选项中选择maven，在弹出对话框中填写入运行参数，如-Dmaven……=$M2_HOME</li><li>点击运行，出现打包信息，则表示maven正常使用，继续下一步。</li></ul><p>开启集群，即</p><blockquote><p>start-all.sh<br>mr-jobhistory-daemon.sh start historyserver [一定要开historyserver]</p></blockquote><p>linux下开启集群，开启后一定要确定集群开启无误，并且确定\input目录存在且有数据（因为要运行wordcount必须有输入）之后就不用动了（本人用的是虚拟机）</p><p>之后注意要关闭防火墙，一般已经关闭<br>还要离开安全模式，即</p><blockquote><p>hadoop -dfsadmin safemode leave</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>正式开始IDEA调试：</p><blockquote><p>新建maven项目，之后右键项目出现菜单中选择open module setting ，选择dependencies<br>点绿色＋号添加library，找到hadoop目录下的share中的hadoop文件夹，将其中的除https之外的文件全部添加进来，可以取名为hadoop</p></blockquote><ul><li><p>打开pom.xml，添加相关依赖，之后右上角会有import导入提示，点击后就会导入相关依赖，同时先前的红色字体（错误）会变为灰色（正确），到此maven配置结束。</p></li><li><p>在main文件夹中的resources下新建log4j.properties和core-site.xml，即一些配置项文件。</p></li><li><p>在main文件夹中的java中新建wordcount类，具体代码可从网上得到，注意代码中的conf.()设置，其中内容要跟linux集群相匹配，另外其他xxx:9000等类似地方也要修改为自己的master节点的ip。</p></li><li><p>从置顶菜单栏中选择run configration，在弹出的配置页中添加运行参数，包括xxxx:9000\tmp\input，和xxxx:9000\tmp\output，注意此处的input文件夹在运行之前就要存在，而output文件夹在运行之前不能存在。另外端口9000后的路径就是linux下的真实路径，即运行的输入输出均不在Windows本地，而在远程linux。</p></li><li><p>要去开启或关闭windows功能中，勾选上telnet，在windows系统中telnet是默认关闭的，要手动开启。</p></li><li><p>最后一步，从IDEA左下角选择maven启动项，填上参数点击run，即可开始运行mapreduce代码，远程调用集群的资源，本地并不涉及存取，相应的运行信息或者日志均在IDEA下打印。</p></li></ul><p>修改用户名为hadoop，首先要去用户管理里修改、<br>然后去，用户组管理里修改，分两步！！！！</p>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kafka的使用</title>
      <link href="/article/d1cb.html"/>
      <url>/article/d1cb.html</url>
      
        <content type="html"><![CDATA[<h2 id="kafka的使用"><a href="#kafka的使用" class="headerlink" title="kafka的使用"></a>kafka的使用</h2><blockquote><p>Kafka是一个消息系统，原本开发自LinkedIn，用作LinkedIn的活动流（Activity Stream） 和运营数据处理 管道（Pipeline）的基础活动流数据是几乎所有站点在对其网站使用情况做报表时都要用到的数据中最常规的部分。活动数据包括页面访问量（PageView）、被查看内容方面的信息以及搜索情况等内容。这种数据通常的处理方式是先把各种活动以日志的形式写入某种文件，然后周期性地对这些文件进行统计分析。运营数据指的是服务器的性能数据（CPU、IO使用率、请求时间、服务日志等等数据)。运营数据的统计方法种类繁多。</p></blockquote><a id="more"></a><h2 id="Kafka是一种分布式的，基于发布-订阅的消息系统。主要设计目标如下："><a href="#Kafka是一种分布式的，基于发布-订阅的消息系统。主要设计目标如下：" class="headerlink" title="Kafka是一种分布式的，基于发布/订阅的消息系统。主要设计目标如下："></a>Kafka是一种分布式的，基于发布/订阅的消息系统。主要设计目标如下：</h2><blockquote><p>● 以时间复杂度为O(1)的方式提供消息持久化能力，即使对TB级以上数据也能保证常数时间复杂度的访问性能。<br>  ● 高吞吐率。即使在非常廉价的商用机器上也能做到单机支持每秒100K条以上消息的传输。<br>  ● 支持Kafka Server间的消息分区，及分布式消费，同时保证每个Partition内的消息顺序传输。<br>  ● 同时支持离线数据处理和实时数据处理。<br>  ● Scale out：支持在线水平扩展。</p></blockquote><h2 id="为何使用消息系统"><a href="#为何使用消息系统" class="headerlink" title="为何使用消息系统"></a>为何使用消息系统</h2><blockquote><p> ● 解耦<br>这允许你独立的扩展或修改两边的处理过程，只要确保它们遵守同样的接口约束。<br>  ● 冗余<br>有些情况下，处理数据的过程会失败。除非数据被持久化，否则将造成丢失。消息队列把数据进行持久化直到它们已经被完全处理，通过这一方式规避了数据丢失风险。许多消息队列所采用的”插入-获取-删除”范式中，在把一个消息从队列中删除之前，需要你的处理系统明确的指出该消息已经被处理完毕，从而确保你的数据被安全的保存直到你使用完毕。<br>  ● 扩展性<br>因为消息队列解耦了你的处理过程，所以增大消息入队和处理的频率是很容易的，只要另外增加处理过程即可。不需要改代码、调参数。<br>  ● 灵活性 &amp; 峰值处理能力<br>不常见；如果为以能处理这类峰值访问为标准来投入资源随时待命无疑是巨大的浪费。使用消息队列能够使关键组件顶住突发的访问压力，而不会因为突发的超负荷的请求而完全崩溃。<br>  ● 可恢复性<br>消息队列降低了进程间的耦合度，所以即使一个处理消息的进程挂掉，加入队列中的消息仍然可以在系统恢复后被处理。<br>  ● 顺序保证<br>大部分消息队列本来就是排序的，并且能保证数据会按照特定的顺序来处理。Kafka保证一个Partition内的消息的有序性。<br>  ● 缓冲<br>在任何重要的系统中，都会有需要不同的处理时间的元素。例如，加载一张图片比应用过滤器花费更少的时间。消息队列通过一个缓冲层来帮助任务最高效率的执行———写入队列的处理会尽可能的快速。该缓冲有助于控制和优化数据流经过系统的速度。<br>  ● 异步通信<br>很多时候，用户不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</p></blockquote><p>Kafka是一个高性能跨语言分布式发布/订阅消息队列系统，而Jafka是在Kafka之上孵化而来的，即Kafka的一个升级版。具有以下特性：快速持久化，可以在O(1)的系统开销下进行消息持久化；高吞吐，在一台普通的服务器上既可以达到10W/s的吞吐速率；完全的分布式系统，Broker、Producer、Consumer都原生自动支持分布式，自动实现负载均衡；支持Hadoop数据并行加载，对于像Hadoop的一样的日志数据和离线分析系统，但又要求实时处理的限制，这是一个可行的解决方案。</p><h2 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h2><blockquote><p> ● Broker<br>Kafka集群包含一个或多个服务器，这种服务器被称为broker<br>  ● Topic<br>每条发布到Kafka集群的消息都有一个类别，这个类别被称为Topic。（物理上不同Topic的消息分开存储，逻辑上一个Topic的消息虽然保存于一个或多个broker上但用户只需指定消息的Topic即可生产或消费数据而不必关心数据存于何处）<br>  ● Partition<br>Parition是物理上的概念，每个Topic包含一个或多个Partition.<br>  ● Producer<br>负责发布消息到Kafka broker<br>  ● Consumer<br>消息消费者，向Kafka broker读取消息的客户端。<br>  ● Consumer Group<br>每个Consumer属于一个特定的Consumer Group（可为每个Consumer指定group name，若不指定group name则属于默认的group）。</p></blockquote><h2 id="Kafka拓扑结构"><a href="#Kafka拓扑结构" class="headerlink" title="Kafka拓扑结构"></a>Kafka拓扑结构</h2><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/9oewcbhgv5067pdrm84w19fx/0310020.png" alt="0310020.png-167.5kB"><br>如上图所示，一个典型的Kafka集群中包含若干Producer（可以是web前端产生的Page View，或者是服务器日志，系统CPU、Memory等），若干broker（Kafka支持水平扩展，一般broker数量越多，集群吞吐率越高），若干Consumer Group，以及一个Zookeeper集群。Kafka通过Zookeeper管理集群配置，选举leader，以及在Consumer Group发生变化时进行rebalance。Producer使用push模式将消息发布到broker，Consumer使用pull模式从broker订阅并消费消息。</p><h2 id="Topic-amp-Partition"><a href="#Topic-amp-Partition" class="headerlink" title="Topic &amp; Partition"></a>Topic &amp; Partition</h2><blockquote><p>Topic在逻辑上可以被认为是一个queue，每条消费都必须指定它的Topic，可以简单理解为必须指明把这条消息放进哪个queue里。为了使得Kafka的吞吐率可以线性提高，物理上把Topic分成一个或多个Partition，每个Partition在物理上对应一个文件夹，该文件夹下存储这个Partition的所有消息和索引文件。若创建topic1和topic2两个topic，且分别有13个和19个分区，则整个集群上会相应会生成共32个文件夹（本文所用集群共8个节点，此处topic1和topic2 replication-factor均为1），如下图所示。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/03q1s4qtsyx0adrlzpuodx3k/0310021.png" alt="0310021.png-49.6kB"><br>每个日志文件都是一个log entrie序列，每个log entrie包含一个4字节整型数值（值为N+5），1个字节的”magic value”，4个字节的CRC校验码，其后跟N个字节的消息体。每条消息都有一个当前Partition下唯一的64字节的offset，它指明了这条消息的起始位置。磁盘上存储的消息格式如下：</p><blockquote><p>message length ： 4 bytes (value: 1+4+n)<br>    “magic” value ： 1 byte<br>    crc ： 4 bytes<br>    payload ： n bytes </p></blockquote></blockquote><blockquote><p>这个log entries并非由一个文件构成，而是分成多个segment，每个segment以该segment第一条消息的offset命名并以“.kafka”为后缀。另外会有一个索引文件，它标明了每个segment下包含的log entry的offset范围，如下图所示。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/a8uav2n35zthofnxixps6l9c/0310022.png" alt="0310022.png-182.5kB"><br>因为每条消息都被append到该Partition中，属于顺序写磁盘，因此效率非常高（经验证，顺序写磁盘效率比随机写内存还要高，这是Kafka高吞吐率的一个很重要的保证）。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/zcoshob2go68h5av4crkf8ip/0310023.png" alt="0310023.png-46.3kB"></p></blockquote><p>对于传统的message queue而言，一般会删除已经被消费的消息，而Kafka集群会保留所有的消息，无论其被消费与否。当然，因为磁盘限制，不可能永久保留所有数据（实际上也没必要），因此Kafka提供两种策略删除旧数据。一是基于时间，二是基于Partition文件大小。<br>例如可以通过配$KAFKA_HOME/config/server.properties，让Kafka删除一周前的数据，也可在Partition文件超过1GB时删除旧数据，配置如下所示。　</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># The minimum age of a log file to be eligible for deletion</span><br><span class="line">log.retention.hours&#x3D;168</span><br><span class="line"># The maximum size of a log segment file. When this size is reached a new log segment will be created.</span><br><span class="line">log.segment.bytes&#x3D;1073741824</span><br><span class="line"># The interval at which log segments are checked to see if they can be deleted according to the retention policies</span><br><span class="line">log.retention.check.interval.ms&#x3D;300000</span><br><span class="line"># If log.cleaner.enable&#x3D;true is set the cleaner will be enabled and individual logs can then be marked for log compaction.</span><br><span class="line">log.cleaner.enable&#x3D;false</span><br></pre></td></tr></table></figure><blockquote><p>这里要注意，因为Kafka读取特定消息的时间复杂度为O(1)，即与文件大小无关，所以这里删除过期文件与提高Kafka性能无关。选择怎样的删除策略只与磁盘以及具体的需求有关。另外，Kafka会为每一个Consumer Group保留一些metadata信息——当前消费的消息的position，也即offset。这个offset由Consumer控制。正常情况下Consumer会在消费完一条消息后递增该offset。当然，Consumer也可将offset设成一个较小的值，重新消费一些消息。因为offet由Consumer控制，所以Kafka broker是无状态的，它不需要标记哪些消息被哪些消费过，也不需要通过broker去保证同一个Consumer Group只有一个Consumer能消费某一条消息，因此也就不需要锁机制，这也为Kafka的高吞吐率提供了有力保障。</p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="Producer消息路由"><a href="#Producer消息路由" class="headerlink" title="Producer消息路由"></a>Producer消息路由</h2><blockquote><p>Producer发送消息到broker时，会根据Paritition机制选择将其存储到哪一个Partition。如果Partition机制设置合理，所有消息可以均匀分布到不同的Partition里，这样就实现了负载均衡。如果一个Topic对应一个文件，那这个文件所在的机器I/O将会成为这个Topic的性能瓶颈，而有了Partition后，不同的消息可以并行写入不同broker的不同Partition里，极大的提高了吞吐率。<br>可以在$KAFKA_HOME/config/server.properties中通过配置项num.partitions来指定新建Topic的默认Partition数量，也可在创建Topic时通过参数指定，同时也可以在Topic创建之后通过Kafka提供的工具修改。<br>在发送一条消息时，可以指定这条消息的key，Producer根据这个key和Partition机制来判断应该将这条消息发送到哪个Parition。<br>Paritition机制可以通过指定Producer的paritition. class这一参数来指定，该class必须实现kafka.producer.Partitioner接口。本例中如果key可以被解析为整数则将对应的整数与Partition总数取余，该消息会被发送到该数对应的Partition。（每个Parition都会有个序号,序号从0开始）</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import kafka.producer.Partitioner;</span><br><span class="line">import kafka.utils.VerifiableProperties;</span><br><span class="line">public class JasonPartitioner&lt;T&gt; implements Partitioner &#123;</span><br><span class="line">    public JasonPartitioner(VerifiableProperties verifiableProperties) &#123;&#125;</span><br><span class="line">    @Override</span><br><span class="line">    public int partition(Object key, int numPartitions) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            int partitionNum &#x3D; Integer.parseInt((String) key);</span><br><span class="line">            return Math.abs(Integer.parseInt((String) key) % numPartitions);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return Math.abs(key.hashCode() % numPartitions);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果将上例中的类作为partition.class，并通过如下代码发送20条消息（key分别为0，1，2，3）至topic3（包含4个Partition）。</span><br><span class="line">public void sendMessage() throws InterruptedException&#123;</span><br><span class="line">　　for(int i &#x3D; 1; i &lt;&#x3D; 5; i++)&#123;</span><br><span class="line">　　      List messageList &#x3D; new ArrayList&lt;KeyedMessage&lt;String, String&gt;&gt;();</span><br><span class="line">　　      for(int j &#x3D; 0; j &lt; 4; j++）&#123;</span><br><span class="line">　　          messageList.add(new KeyedMessage&lt;String, String&gt;(&quot;topic2&quot;, j+&quot;&quot;, &quot;The &quot; + i + &quot; message for key &quot; + j));</span><br><span class="line">　　      &#125;</span><br><span class="line">　　      producer.send(messageList);</span><br><span class="line">    &#125;</span><br><span class="line">　　producer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>则key相同的消息会被发送并存储到同一个partition里，而且key的序号正好和Partition序号相同。（Partition序号从0开始，本例中的key也从0开始）。下图所示是通过Java程序调用Consumer后打印出的消息列表。 [负载均衡]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/9i0l34crwmykvgpub9etmsa7/0310024.png" alt="0310024.png-354.9kB"></p><h2 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a>Consumer Group</h2><p>（本节所有描述都是基于Consumer hight level API而非low level API）。<br>使用Consumer high level API时，同一Topic的一条消息只能被同一个Consumer Group内的一个Consumer消费，但多个Consumer Group可同时消费这一消息。[就是说在同一个group里consumer与topic的m某条消息应该是一对一的，如下；]<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/eo2xz4uhq5ajtty0o9ao1l5a/0310025.png" alt="0310025.png-248.8kB"><br>这是Kafka用来实现一个Topic消息的广播（发给所有的Consumer）和单播（发给某一个Consumer）的手段。一个Topic可以对应多个Consumer Group。如果需要实现广播，只要每个Consumer有一个独立的Group就可以了。要实现单播只要所有的Consumer在同一个Group里。用Consumer Group还可以将Consumer进行自由的分组而不需要多次发送消息到不同的Topic。<br>实际上，Kafka的设计理念之一就是同时提供离线处理和实时处理。根据这一特性，可以使用Storm这种实时流处理系统对消息进行实时在线处理，同时使用Hadoop这种批处理系统进行离线处理，还可以同时将数据实时备份到另一个数据中心，只需要保证这三个操作所使用的Consumer属于不同的Consumer Group即可。下图是Kafka在Linkedin的一种简化部署示意图。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/cx6b3nekrnx9samgegqdyjkj/0310026.png" alt="0310026.png-125kB"><br>下面这个例子更清晰地展示了Kafka Consumer Group的特性。首先创建一个Topic (名为topic1，包含3个Partition)，然后创建一个属于group1的Consumer实例，并创建三个属于group2的Consumer实例，最后通过Producer向topic1发送key分别为1，2，3的消息。结果发现属于group1的Consumer收到了所有的这三条消息，同时group2中的3个Consumer分别收到了key为1，2，3的消息。如下图所示。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/nacyuox7ck5743jq7tm02t2m/0310027.png" alt="0310027.png-358.3kB"></p><h2 id="Push-vs-Pull"><a href="#Push-vs-Pull" class="headerlink" title="Push vs. Pull"></a>Push vs. Pull</h2><p>作为一个消息系统，Kafka遵循了传统的方式，选择由Producer向broker push消息并由Consumer从broker pull消息。一些logging-centric system，比如Facebook的Scribe和Cloudera的Flume，采用push模式。事实上，push模式和pull模式各有优劣。<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/2h670hyy8v0jc9rze7svowxv/0310020.png" alt="0310020.png-167.5kB"><br>push模式很难适应消费速率不同的消费者，因为消息发送速率是由broker决定的。push模式的目标是尽可能以最快速度传递消息，但是这样很容易造成Consumer来不及处理消息，典型的表现就是拒绝服务以及网络拥塞。而pull模式则可以根据Consumer的消费能力以适当的速率消费消息。<br>对于Kafka而言，pull模式更合适。pull模式可简化broker的设计，Consumer可自主控制消费消息的速率，同时Consumer可以自己控制消费方式——即可批量消费也可逐条消费，同时还能选择不同的提交方式从而实现不同的传输语义。<br>Kafka delivery guarantee<br>有这么几种可能的delivery guarantee：<br>  ● At most once 消息可能会丢，但绝不会重复传输<br>  ● At least one 消息绝不会丢，但可能会重复传输<br>  ● Exactly once 每条消息肯定会被传输一次且仅传输一次，很多时候这是用户所想要的。</p><p>当Producer向broker发送消息时，一旦这条消息被commit，因数replication的存在，它就不会丢。但是如果Producer发送数据给broker后，遇到网络问题而造成通信中断，那Producer就无法判断该条消息是否已经commit。虽然Kafka无法确定网络故障期间发生了什么，但是Producer可以生成一种类似于主键的东西，发生故障时幂等性的重试多次，这样就做到了Exactly once。截止到目前(Kafka 0.8.2版本，2015-03-04)，这一Feature还并未实现，有希望在Kafka未来的版本中实现。（所以目前默认情况下一条消息从Producer到broker是确保了At least once，可通过设置Producer异步发送实现At most once）。</p><p>接下来讨论的是消息从broker到Consumer的delivery guarantee语义。（仅针对Kafka consumer high level API）。Consumer在从broker读取消息后，可以选择commit，该操作会在Zookeeper中保存该Consumer在该Partition中读取的消息的offset。该Consumer下一次再读该Partition时会从下一条开始读取。如未commit，下一次读取的开始位置会跟上一次commit之后的开始位置相同。当然可以将Consumer设置为autocommit，即Consumer一旦读到数据立即自动commit。如果只讨论这一读取消息的过程，那Kafka是确保了Exactly once。但实际使用中应用程序并非在Consumer读取完数据就结束了，而是要进行进一步处理，而数据处理与commit的顺序在很大程度上决定了消息从broker和consumer的delivery guarantee semantic。</p><blockquote><p> ● 读完消息先commit再处理消息。这种模式下，如果Consumer在commit后还没来得及处理消息就crash了，下次重新开始工作后就无法读到刚刚已提交而未处理的消息，这就对应于At most once<br>  ● 读完消息先处理再commit。这种模式下，如果在处理完消息之后commit之前Consumer crash了，下次重新开始工作时还会处理刚刚未commit的消息，实际上该消息已经被处理过了。这就对应于At least once。在很多使用场景下，消息都有一个主键，所以消息的处理往往具有幂等性，即多次处理这一条消息跟只处理一次是等效的，那就可以认为是Exactly once。（笔者认为这种说法比较牵强，毕竟它不是Kafka本身提供的机制，主键本身也并不能完全保证操作的幂等性。而且实际上我们说delivery guarantee 语义是讨论被处理多少次，而非处理结果怎样，因为处理方式多种多样，我们不应该把处理过程的特性——如是否幂等性，当成Kafka本身的Feature）<br>  ● 如果一定要做到Exactly once，就需要协调offset和实际操作的输出。精典的做法是引入两阶段提交。如果能让offset和操作输入存在同一个地方，会更简洁和通用。这种方式可能更好，因为许多输出系统可能不支持两阶段提交。比如，Consumer拿到数据后可能把数据放到HDFS，如果把最新的offset和数据本身一起写到HDFS，那就可以保证数据的输出和offset的更新要么都完成，要么都不完成，间接实现Exactly once。（目前就high level API而言，offset是存于Zookeeper中的，无法存于HDFS，而low level API的offset是由自己去维护的，可以将之存于HDFS中）<br>总之，Kafka默认保证At least once，并且允许通过设置Producer异步提交来实现At most once。而Exactly once要求与外部存储系统协作，幸运的是Kafka提供的offset可以非常直接非常容易得使用这种方式。</p></blockquote><p>注：本文转自网络</p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 概述 </tag>
            
            <tag> 转载 </tag>
            
            <tag> Kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ETL工具~Kettle调研</title>
      <link href="/article/d21a.html"/>
      <url>/article/d21a.html</url>
      
        <content type="html"><![CDATA[<p>ETL工具~Kettle调研 2017.2<br>Kettle<br>kettle是其中Pentaho默认的ETL工具，下图为Pentaho的使用情况<br><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-298.8kB"></p><a id="more"></a><h2 id="什么是ETL"><a href="#什么是ETL" class="headerlink" title="什么是ETL"></a>什么是ETL</h2><blockquote><p>抽取（Extract）：需要连接到不同的数据资源，以便为随后的步骤（转换、加载、分析、报表展示等）提供数据。数据抽取实际上是ETL解决方案的成功实施的一个主要障碍。<br>转换（Transform）:任何对数据的处理过程都是转换。通常包括：<br>1、移动数据<br>2、根据规则验证数据<br>3、修改数据的内容或者数据结构<br>4、集成多个数据源的数据<br>5、根据处理后的数据计算派生值或者聚集值<br>加载（Load）:将数据加载到目标系统的所有操作</p></blockquote><h2 id="能解决什么问题？"><a href="#能解决什么问题？" class="headerlink" title="能解决什么问题？"></a>能解决什么问题？</h2><ol><li>适用于将多个应用系统的大批量的、异构的数据进行整合，有强大的数据转换功能。</li><li>高效适配多种类型的异构数据库、文件和应用系统。</li><li>快速构建复杂数据大集中应用、无需编码。</li></ol><h2 id="适合什么场景？"><a href="#适合什么场景？" class="headerlink" title="适合什么场景？"></a>适合什么场景？</h2><blockquote><p>异构数据库迁移，如将两个SQL Server中的业务数据分别依照特定的逻辑迁移到三个Oracle数据库中。<br>Kettle通过Webservice获取天气信息 <a href="http://blog.itpub.net/10009036/viewspace-1398948/" target="_blank" rel="external nofollow noopener noreferrer">http://blog.itpub.net/10009036/viewspace-1398948/</a><br>kettle学习：JsonInput使用 <a href="http://blog.csdn.net/jiesa/article/details/50098601" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/jiesa/article/details/50098601</a><br>开源ETL工具kettle系列之增量更新设计<a href="http://blog.csdn.net/aiynmimi/article/details/52150318" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/aiynmimi/article/details/52150318</a><br>用kettle向hdfs复制文件<a href="http://www.cnblogs.com/allan00/p/3838256.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.cnblogs.com/allan00/p/3838256.html</a><br>KETTLE访问HIVE表数据<a href="https://ask.hellobi.com/blog/hql15/3450" target="_blank" rel="external nofollow noopener noreferrer">https://ask.hellobi.com/blog/hql15/3450</a></p></blockquote><h2 id="Kettle的优点？"><a href="#Kettle的优点？" class="headerlink" title="Kettle的优点？"></a>Kettle的优点？</h2><blockquote><ol><li>插件架构扩展性好<br>Kettle 体系架构<a href="http://blog.csdn.net/romaticjun2011/article/details/40680483" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/romaticjun2011/article/details/40680483</a></li><li>流程式设计方便易用</li><li>全面的数据访问支持(支持多个数据库, 如果非默认支持,还可以通过插件扩展)</li><li>支持多平台</li><li>高效稳定：<br>1）每个步骤一个线程或者一个步骤分多个线程处理<br>2）集群，把数据分散在多个机器中，在每个机器中作运算再汇总</li><li>商业、社区支持</li><li>多种方式应用集成：</li></ol></blockquote><p>1) 把Kettle集成到应用中，通过调用Kettle的API来调用一个作业<br>2) 把自己写的jar包集成到Kettle里面，通过Kettle的javascript来调用自己编写的class<br>3) 通过向web页面提交参数，执行一个kettle作业</p><h2 id="是否跨平台？"><a href="#是否跨平台？" class="headerlink" title="是否跨平台？"></a>是否跨平台？</h2><blockquote><p>底层依靠JVM，且为纯JAVA开发<br>Linux<br>1）进入到Kettle部署的路径<br>2）执行 chmod *.sh，将所有shell文件添加可执行权限<br>3）在Kettle路径下，如果要执行transformation，就运行./pan.sh -file=?.ktr -debug=debug -log=log.log 其中。-file说明你要运行的transformation文件所在的路径；-debug说明日志输出的级别；-log说明日志输出的路径<br>4）同理，对于job的执行，请将./pan.sh更换成./kitchen.sh，其他部分说明不变。<br>Windows<br>执行spoon.bat</p></blockquote><h2 id="是否开源，社区支持如何？"><a href="#是否开源，社区支持如何？" class="headerlink" title="是否开源，社区支持如何？"></a>是否开源，社区支持如何？</h2><blockquote><p>开源社区<a href="http://www.ukettle.org/forum.php" target="_blank" rel="external nofollow noopener noreferrer">http://www.ukettle.org/forum.php</a></p></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="对分布式集群的针对性如何？"><a href="#对分布式集群的针对性如何？" class="headerlink" title="对分布式集群的针对性如何？"></a>对分布式集群的针对性如何？</h2><blockquote><p>Kettle Execution on Storm <a href="http://wiki.pentaho.com/display/BAD/Kettle+Execution+on+Storm" target="_blank" rel="external nofollow noopener noreferrer">http://wiki.pentaho.com/display/BAD/Kettle+Execution+on+Storm</a><br>Kettle on Spark <a href="http://wiki.pentaho.com/display/BAD/Kettle+on+Spark" target="_blank" rel="external nofollow noopener noreferrer">http://wiki.pentaho.com/display/BAD/Kettle+on+Spark</a><br>Loading Data into HDFS <a href="http://wiki.pentaho.com/display/BAD/Loading+Data+into+HDFS" target="_blank" rel="external nofollow noopener noreferrer">http://wiki.pentaho.com/display/BAD/Loading+Data+into+HDFS</a><br>Kettle 集群（cluster）在多个服务器（windows、linux）上并发执行 <a href="http://blog.csdn.net/lixuemei504/article/details/38271145" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/lixuemei504/article/details/38271145</a><br>KETTLE集群搭建 <a href="http://www.cnblogs.com/skyrim/p/5104557.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.cnblogs.com/skyrim/p/5104557.html</a></p></blockquote><h2 id="是否可以进行自定义改进源代码？"><a href="#是否可以进行自定义改进源代码？" class="headerlink" title="是否可以进行自定义改进源代码？"></a>是否可以进行自定义改进源代码？</h2><blockquote><p>kettle插件开发 <a href="https://wenku.baidu.com/view/33c46d1459eef8c75fbfb3b5.html?re=view" target="_blank" rel="external nofollow noopener noreferrer">https://wenku.baidu.com/view/33c46d1459eef8c75fbfb3b5.html?re=view</a><br>kettle调用第三方短信平台HTTP接口发送短信 <a href="http://www.ukettle.org/thread-1025-1-1.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.ukettle.org/thread-1025-1-1.html</a></p></blockquote><h2 id="结构组成？"><a href="#结构组成？" class="headerlink" title="结构组成？"></a>结构组成？</h2><blockquote><p>Spoon    一个基于swt开发的流式处理客户端，用户开发转换、任务、创建数据库、集群、分区等<br>Pan        独立的命令行程序，支持通过命令行实现界面的功能，如果转换启停,任务启停,状态查看等<br>Kitchen    一个独立的命令行程序，用于执行由Spoon编辑的作业.<br>Carte    一个轻量级的Web容器，用于建立专用、远程的ETL Server。</p></blockquote><hr><h2 id="有什么缺点？"><a href="#有什么缺点？" class="headerlink" title="有什么缺点？"></a>有什么缺点？</h2><blockquote><p>kettle性能及效率提升 <a href="http://blog.csdn.net/littlecaesar1234/article/details/18657093" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/littlecaesar1234/article/details/18657093</a><br>kettle中做查询时,遇到大数据时怎么处理 <a href="http://www.myexception.cn/database/1294030.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.myexception.cn/database/1294030.html</a></p></blockquote><h2 id="kettle处理数据的速度，相比较？"><a href="#kettle处理数据的速度，相比较？" class="headerlink" title="kettle处理数据的速度，相比较？"></a>kettle处理数据的速度，相比较？</h2><blockquote><p>让kettle的执行速度飞起来 <a href="https://my.oschina.net/sucre/blog/398996" target="_blank" rel="external nofollow noopener noreferrer">https://my.oschina.net/sucre/blog/398996</a></p></blockquote><h2 id="注意事项？"><a href="#注意事项？" class="headerlink" title="注意事项？"></a>注意事项？</h2><p>开源ETL工具kettle系列之常见问题 <a href="http://blog.csdn.net/zftang/article/details/6194124" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/zftang/article/details/6194124</a></p><p>81个开源大数据处理的工具 <a href="http://www.36dsj.com/archives/25042" target="_blank" rel="external nofollow noopener noreferrer">http://www.36dsj.com/archives/25042</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 概述 </tag>
            
            <tag> Kettle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spark安装之问题</title>
      <link href="/article/b086.html"/>
      <url>/article/b086.html</url>
      
        <content type="html"><![CDATA[<p>厦门大学数据库实验室教程<br>有几个坑</p><p>SparkSQL context 在执行sql语句时，现在使用spark.sql()替换sqlContext.sal()</p><a id="more"></a><p>sparkapp使用sbt打包<br>simple.sbt<br>直接使用教程中的sbt依赖版本即可，即此处无所谓，不过最好是和本机配置版本一致<br>sbt package<br>打包运行时一定要注意联网！！<br>注意执行此打包命令的位置，要在sparkapp目录下！！<br>即在有simple.sbt的目录位置执行sbt package命令</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>spark.sql<br>执行时目前需要开启hadoop，原理未知，不开会报错</p><p>sbt<br>第一次安装时，直接官网下，现在教程中说的bug已经没有了，会卡住无输出，是正常的，时间非常慢！<br>第一次打包时，下载的依赖非常多，不断输出，但非常慢！</p><p>完成次教程全部都在①台机器上<br>还未进行集群配置</p>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>由主节点配置从节点从而构建集群</title>
      <link href="/article/bce3.html"/>
      <url>/article/bce3.html</url>
      
        <content type="html"><![CDATA[<h4 id="主节点操作"><a href="#主节点操作" class="headerlink" title="主节点操作"></a>主节点操作</h4><blockquote><p>改名字，改为master，hosts<br>改hadoop的slaves加四个xml<br>slaves是加一个节点就要改一次</p></blockquote><a id="more"></a><h4 id="从节点操作"><a href="#从节点操作" class="headerlink" title="从节点操作"></a>从节点操作</h4><ol><li>新建hadoop用户，修改权限，赋予权限<br>ALL =…</li><li>改好主机名，按node01 node02……规则</li><li>配好ssh，保证可以通信<br>关防火墙，iptables stop<br>关selinux<br>自ssh可以，主对从可以免密ssh</li><li>用scp传jdk和hadoop到从节点的tmp目录下<br>可能会出现权限问题，使用tmp目录则不要紧，文件夹权限问题</li><li>配jdk和hadoop的环境变量<br>新建一个java目录，如usr/local/java，将之放入，hadoop同理<br>改./bashrc添加路径<br>改./etc/profile添加路径<br>source文件 重载刷新<br>检查：直接java和hadoop回显相关信息</li><li>配置hadoop<br>改五个文件，特别注意，从主节点cp过来的hadoop是已经配好的，无需动<br>slaves仍然要改<br>检测： reboot<br>start-all.sh<br>hadoop dfsadmin -report显示正确<br>jps主从点显示正常进程<br>要关闭安全模式<br>dfsadmin safemode leave</li></ol><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><ol start="7"><li><p>运行实例<br>在hdfs新建一个文件夹<br>构造一个input输入文件夹带数据<br>运行hadoop文件夹中share里的用例<br>在hdfs中ls output<br>get output到本地再查看内容<br>完成</p></li><li><p>其他配置<br>zookeeper<br>hbase<br>hive pig mahout<br>sqoop flume<br>Ambari<br>此部分配置spark，依附于hadoop集群</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 调试 </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kettle相关知识</title>
      <link href="/article/31ad.html"/>
      <url>/article/31ad.html</url>
      
        <content type="html"><![CDATA[<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p>开源ETL工具(Kettle) V5.1.0 免费Spoon版<br><a href="http://www.cr173.com/soft/30051.html" target="_blank" rel="external nofollow noopener noreferrer">http://www.cr173.com/soft/30051.html</a><br>ETL工具大全，你了解多少<br><a href="http://bbs.csdn.net/topics/390349305" target="_blank" rel="external nofollow noopener noreferrer">http://bbs.csdn.net/topics/390349305</a><br>Kettle_抽取数据举例<br><a href="http://blog.csdn.net/huangyanlong/article/details/42264543" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/huangyanlong/article/details/42264543</a></p><a id="more"></a><p>文件列表</p><p>kettle入门(三) 之kettle连接hadoop&amp;hdfs图文详解<br><a href="http://blog.csdn.net/xiaohai798/article/details/39558939" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/xiaohai798/article/details/39558939</a></p><hr><p>ETL2004ETL和数据集成工具：ETL和数据集成的工作量占BI项目的40%，但是ETL工具约占BI市场的9%，其中很多应用是采用手工编码方式，ETL工具仍有待普及</p><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-24.9kB"></p><ol><li>从哪里抽取什么样的数据，即抽取规则。要支持增量抽取，即每次抽取只抽取上次抽取后变化的数据。在复杂情况下，还需要检查上次抽取后修改或者删除的数据，并依据数据安全策略进行相应的处理；</li><li>数据抽取频率即什么时间抽取，即抽取时间设置，确定每天晚上12点抽取，或者每1小时正点时抽取1次，等等；</li><li>数据校验，确定每个抽取的数据是否是有效的，是否是没有缺陷的，是否需要补充内容等；</li><li>数据转换规则，即源数据怎样转化成需要的数据的，经过什么样的计算、拆分、合并等等；本数据转换完后，需要触发哪些数据的ETL过程；</li><li>数据质量检查，可以采用对账等方式对转换完后的数据进行统一检查，保证数据的抽取质量；</li><li>错误处理，如果转换过程中出现错误，需要进行统一的、相应的处理，给出明确的业务描述，记录错误日志，并发到系统信息中心；</li><li>记录ETL日志，包括转换的时间，数据源是哪个，转化的数据种类，转换的源数据是哪些，对应的目标数据是哪些，等等。</li></ol><h2 id="ETL大致分为两部分"><a href="#ETL大致分为两部分" class="headerlink" title="ETL大致分为两部分"></a>ETL大致分为两部分</h2><ul><li>设计期：ETL过程，<blockquote><p>Extract即是从业务数据库中抽取数据,<br>Transform即是根据业务逻辑规则对数据进行加工的过程，<br>Load即是把数据加载到数据仓库的过程<br>(Extract-Transform-Load )，关键就在T的处理上，这个过程的实现，可    以用可以用perl、shell、存储过程等来实现，也可以用类似Kettle等ETL工具实现</p></blockquote></li><li>运行期：ETL的调度过程，所谓调度，就是执行定时任务，对以上脚本、job的调度，主要是这其中的依赖如何配置的问题，还有就是对于日增、日全、月增、月全等数据如何加载。</li></ul><h3 id="资源库"><a href="#资源库" class="headerlink" title="资源库"></a>资源库</h3><p>资源库用来保存连接信息和转换信息。用户通过图形界面创建的的数据库连接和数据转换任务可以保存在资源库中。<br>资源库可以是各种常见的数据库，用户通过用户名/密码来访问资源库中的资源，默认的用户名/密码是admin/admin。资源库并不是必须的，如果没有资源库，用户还可以把转换任务保存在 xml 文件中。<br>资源库可以使多用户共享转换任务，转换任务在资源库中是以文件夹形式分组管理的，用户可以自定义文件夹名称。有了资源库,就可以将 transformation/job 保存在数据库里,这样方便共享。</p><h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><p>Kettle以任务的方式存在，每个任务就是一个转换流程，以流程图的方式表现，支持各种流程处理模式，包括条件跳转、分支、循环等等，每一个节点就是业务处理单元。业务处理单元可以是SQL语句，也可以是存储过程，还可以是Java程序等等。<br>Kettle中有两种脚本文件，transformation和job，transformation完成针对数据的基础转换，job则完成整个工作流的控制。主要描述了从各个数据源中抽取数据、转换数据并加载到数据仓库的各个环节及流程。主要功能有数据校验、数据转换规则、数据质量检查、Bug调试错误处理，定时功能、日志跟踪等。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="Kettle使用及练习—安装部署"><a href="#Kettle使用及练习—安装部署" class="headerlink" title="Kettle使用及练习—安装部署"></a>Kettle使用及练习—安装部署</h3><p>Kettle的下载可以在 <a href="http://kettle.pentaho.org/" target="_blank" rel="external nofollow noopener noreferrer">http://kettle.pentaho.org/</a> 网站下载。要求jdk.5以上版本，设置JAVA_HOME 环境变量，.kettle不需要安装,直接解压。运行spoon.bat即能看到kettle的欢迎界面，选择没有资源库，打开kettle主界面，在左边的Main tree,双击transaction，配置DB Connection，点击test,提示成功则表示DB已经配置好了。<br>注：</p><ol><li>Kettle支持跨平台使用，Spoon.bat 是在windows 平台运行，Spoon.sh 是在Linux、Apple OSX、Solaris 平台运行。</li><li>spoon.bat 文件中的set OPT=-Xmx256m 改成 set OPT=-Xmx512m，或者更大也可以，否则会在抽取过程中，可能会出现内存溢出的异常</li></ol><p>因为kettle7.0是基于jdk1.8的，所以你用1.7的时候会报错，你可以运行SpoonDebug.bat，把完整的报错输出出来。<br>然后1.8 已经不支持MaxPermSize，所以你要在Spoon.bat中把XX:MaxPermSize修改为MaxMetaspaceSize。</p><hr><p><img src="https://cdn.jsdelivr.net/gh/TianZonglin/tuchuang/backupAllinOne/clipboard.png" alt="clipboard.png-148.3kB">  </p><ol><li>只更新、无更新、无删除<br>只使用【更新操作】，注意，更新操作的查询字段只能包含PRAMARY KEY，其他字段不能被包含，更新字段要包含全部字段。</li><li>只增加</li><li>增加+更新、无删除<br>上述都可以用【插入\更新操作】，注意其中的查询字段同样只需要主键。</li><li>增加+更新+删除<br>需要【组合】【多种操作】</li></ol>]]></content>
      
      
      <categories>
          
          <category> 大数据相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 概述 </tag>
            
            <tag> Kettle </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2016研究生数学建模竞赛E题</title>
      <link href="/article/c035.html"/>
      <url>/article/c035.html</url>
      
        <content type="html"><![CDATA[<p>2016年全国研究生数学建模竞赛E题<br>粮食最低收购价政策问题研究</p><blockquote><p>粮食，不仅是人们日常生活的必需食品，而且还是维护国家经济发展和政治稳定的战略物资，具有不可替代的特性。由于耕地减少、人口增加、水资源短缺、气候变化等问题日益凸显，加之国际粮食市场的冲击，我国粮食产业面临着潜在的风险。因此，研究我国的粮食保护政策具有十分重要的作用和意义。</p></blockquote><a id="more"></a><p>一般而言，粮食保护政策体系主要由三大支持政策组成：粮食生产支持政策、粮食价格支持政策和收入支持政策。粮食最低收购价政策就属于粮食价格支持政策范畴。<br>一般情况下，我国粮食收购价格由市场供需情况决定，国家在充分发挥市场机制作用的基础上实行宏观调控。为保护农民利益、保障粮食市场供应，国家对重点粮食品种，在粮食主产区实行最低收购价格政策，并每年事先公布重点粮食品种的最低收购价。在最低收购价格政策执行期（粮食收获期，一般在2-5个月）内，当市场粮食实际收购价低于国家确定的最低收购价时，国家委托符合一定资质条件的粮食企业，按国家确定的最低收购价格收购农民种植的粮食，以保护粮农的种植积极性。</p><blockquote><p>我国自2005年起开始对粮食主产区实行了最低收购价政策，并连续多年上调最低收购价价格。2016年国家发展与改革委员会公布的小麦（三等）最低收购价格为每50公斤118元，比首次实施小麦最低收购价的2006年提高了66.2%；早籼稻（三等）、中晚籼稻（三等）和粳稻（三等）最低收购价格分别为每50公斤133元、138元和155元，分别比首次实施水稻最低收购价的2005年提高了84.72%、91.67%和106.67%。显而易见，粮食最低收购价政策已经成为了国家保护粮食生产的最为重要的举措之一。</p></blockquote><blockquote><p>然而，也有学者不认同这项最低收购价政策。他们认为，粮食的实际收购价格（以后称为粮食市场收购价）应该由粮食供需双方通过市场调节来决定。粮食最低收购价政策作为一种粮食种植保护政策，扭曲了粮食市场的供需行为，即该政策的实施很有可能抬高了市场收购价格，导致粮食企业承担了很大的经营风险。<br>对于粮食最低收购价政策实施效果的评价，学者们也是见解不一。部分地区某些粮食品种种植面积、粮食总产量不增反降，导致部分学者质疑粮食最低收购价政策的效果；但也有学者高度肯定了粮食最低收购价政策，认为如果不实施粮食最低收购价政策，这些地区某些粮食品种的种植面积可能会下降得更快，因而认为粮食最低收购价政策在稳定或增加粮食种植面积方面是有着积极的作用。</p></blockquote><blockquote><p>一般来讲，粮食的种植面积是决定粮食供给的关键因素，也是保障粮食安全的重要前提。衡量粮食最低收购价政策实施的效果，主要是比较政策实施前后粮食种植面积是否有显著性变化。然而，可能影响粮食种植面积的因素有很多，除了粮食最低收购价政策外，还可能有其他很多的影响因素，如农业劳动力人口、粮食进出口贸易、农民受教育程度、城乡收入差距、家庭负担等。因此，要研究粮食最低收购价政策的实施效果，不能仅仅根据种植面积的变化来评定。</p></blockquote><blockquote><p>与此同时，也有一些学者就粮食最低收购价制定的合理范围进行了探讨。最低收购价并不是实际的市场收购价格，而是一种心理安慰价，是收购粮食的底价。粮农决定是否种植粮食，取决于很多因素，但最主要的还是看种植粮食所获得的纯收益的大小。粮食最低收购价的公布，使得粮农能清楚地算出这笔经济账。因此粮食最低收购价的高低直接影响着当年的粮食生产。中国是一个“以粮为纲”的国家，存储的粮食一般要能够满足全国人民三年的吃饭和需求。同时国家对于粮食的补贴金额也是有限制的，在保持合理库存的前提下，一般不会超出各地粮食市场价格的10%。因此，过高的粮食最低收购价不仅会提高粮食市场价格从而加重消费者负担，同时也会增加粮食的库存压力和国家财政的支出风险。另一方面，过低的粮食最低收购价会打压粮农种植粮食的积极性，造成粮食种植面积的萎缩，这更不是国家所愿意看到的。</p></blockquote><blockquote><p>请你们查阅相关资料和数据，结合数据特点，回答下列问题：</p></blockquote><ol><li><p>影响粮食种植面积的因素比较多，它们之间的关系错综复杂而且可能存在着粮食品种和区域差异。请你们建立影响粮食种植面积的指标体系和关于粮食种植面积的数学模型，讨论、评价指标体系的合理性，研究他们之间的关系，并对得出的相应结果的可信度和可靠性给出检验和分析。</p></li><li><p>对粮食最低收购价政策的作用，学者们褒贬不一。请你们建立粮食最低收购价政策执行效果的评价模型。并运用你们所建立的评价模型，结合粮食品种和区域差异，选择几个省份比较研究粮食主产区粮食最低收购价执行的效果。</p></li><li><p>粮食市场收购价是粮食企业收购粮食的市场价格，是由粮食供需双方通过市场调节来决定。它与粮食最低收购价一起构成粮食价格体系，是宏观价格调控系统中有一定相对独立性的重要措施。请你们运用数据分析或建立数学模型探讨我国粮食价格所具有的特殊规律性。</p></li><li><p>结合前面的研究和国家制定粮食最低收购价政策的初衷，请你们建立粮食最低收购价的合理定价模型，进而对“十二五”期间国家发展与改革委员会公布的粮食最低收购价价格的合理性做出评价，并运用你们所建立的模型对2017年的粮食最低收购价的合理范围进行预测。</p></li><li><p>与2000年相比，2015年我国小麦种植面积略有下降。如果国家想让小麦种植面积增加5%，通过调整粮食最低收购价是否能够达到这一目的？请说明理由。</p></li><li><p>根据你们的研究结论，请提出调控粮食种植的优化决策和建议。</p></li></ol><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><blockquote><p>注：数据收集主要关注（不限于）以下网站或数据库<br><a href="http://www.chinagrain.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">http://www.chinagrain.gov.cn/</a>   国家粮食局<br><a href="http://www.zzys.moa.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">http://www.zzys.moa.gov.cn/</a>  中华人民共和国农业部种植业管理司<br><a href="http://www.sdpc.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">http://www.sdpc.gov.cn/</a> 中华人民共和国国家发展与改革委员会<br><a href="http://faostat.fao.org" target="_blank" rel="external nofollow noopener noreferrer">http://faostat.fao.org</a> 世界粮农组织数据库<br><a href="http://apps.fas.usda.gov/" target="_blank" rel="external nofollow noopener noreferrer">http://apps.fas.usda.gov/</a> 美国农业部数据库<br><a href="http://www.ncpqh.com/" target="_blank" rel="external nofollow noopener noreferrer">http://www.ncpqh.com/</a> 布瑞克农产品数据库<br><a href="http://www.stats.gov.cn/tjsj/ndsj/" target="_blank" rel="external nofollow noopener noreferrer">http://www.stats.gov.cn/tjsj/ndsj/</a>  中华人民共和国国家统计局<br><a href="http://comtrade.un.org/" target="_blank" rel="external nofollow noopener noreferrer">http://comtrade.un.org/</a> 联合国贸易数据库<br><a href="http://www.bjinfobank.com/" target="_blank" rel="external nofollow noopener noreferrer">http://www.bjinfobank.com/</a>   高校财经数据库<br><a href="http://www.soshoo.com.cn/" target="_blank" rel="external nofollow noopener noreferrer">http://www.soshoo.com.cn/</a>   搜数数据库<br><a href="http://bbs.pinggu.org/" target="_blank" rel="external nofollow noopener noreferrer">http://bbs.pinggu.org/</a>    人大经济论坛<br>中华人民共和国农业部编，中国农业统计资料，中国农业出版社<br>国家发展与改革委员会编，全国农产品成本收益资料汇编，中国统计出版社</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 研究方向 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop集群运行时问题</title>
      <link href="/article/dcd4.html"/>
      <url>/article/dcd4.html</url>
      
        <content type="html"><![CDATA[<h4 id="Hadoop-Copy"><a href="#Hadoop-Copy" class="headerlink" title="Hadoop Copy"></a>Hadoop Copy</h4><blockquote><p>-copyFromLocal 相当于复制<br>-moveFromLocal 本地会删除，相当于剪切<br>-getmerge 合并， 源目录 -&gt; 目的目录<br>-mkdir<br>-rmr<br>-ls<br>-copyToLocal 从hadoop下文件，不过通常用 -get（类似于-put）<br>hadoop fs -lsr</p></blockquote><a id="more"></a><h4 id="运行hadoop实例的顺序"><a href="#运行hadoop实例的顺序" class="headerlink" title="运行hadoop实例的顺序"></a>运行hadoop实例的顺序</h4><blockquote><p>首先，开启hadoop    start-all.sh<br>之后，创建用户目录  hdfs dfs -mkdir input<br>之后，构造程序输入  hdfs dfs -put ./etc/hadoop/*.xml input<br>之后，确认输入有内容  hdfs dfs -ls input<br>之后，运行jar包  hadoop jar  /etc/local/hadoop/etc/…/example-2.7.3 input output ‘[a-z.]+’<br>之后，会输出运行的INFO<br>之后，cat output 看结果，可以选择取回本地<br>完成</p></blockquote><h4 id="hadoop集群节点不全开"><a href="#hadoop集群节点不全开" class="headerlink" title="hadoop集群节点不全开"></a>hadoop集群节点不全开</h4><p>有hadoop01-04 四个节点，现在只开hadoop01，只用master<br>修改master节点的   /etc/local/hadoop/etc/hadoop/slaves文件<br>将hadoop01加入，即之前没有hadoop01，表明master节点只有namenode，没有datanode，<br>现在将datanode让之启动，就可以使master有双重身份<br>其他配置，其他节点的配置，均不改<br>以上类似伪分布式，但是更灵活，本身为完全分布式状态，只运行hadoop01时即为节点缺省状态，当其他节点运行时，不用任何改动即可以成为一个集群。<br>完。</p><h4 id="IDEA报错详解"><a href="#IDEA报错详解" class="headerlink" title="IDEA报错详解"></a>IDEA报错详解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cannot delete &#x2F;tmp&#x2F;hadoop-yarn&#x2F;staging&#x2F;hadoop&#x2F;.staging&#x2F;job_1477796535608_0001. </span><br><span class="line">Name node is in safe mode.</span><br><span class="line">    </span><br><span class="line">原因：Linux集群中的namenode没有关闭safemode</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2016-11-01 18:32:27,979 INFO  [main] mapred.ClientServiceDelegate (ClientServiceDelegate.java:getProxy(276)) - Application state is completed. FinalApplicationStatus&#x3D;SUCCEEDED. Redirecting to job history server</span><br><span class="line">Retrying connect to server: 192.168.146.130&#x2F;192.168.146.130:10020. Already tried 9 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries&#x3D;10, sleepTime&#x3D;1000 MILLISECONDS)</span><br><span class="line">Exception in thread &quot;main&quot; java.io.IOException: java.net.ConnectException: Call From MSI&#x2F;118.202.43.35 to 192.168.146.130:10020 failed on connection exception: java.net.ConnectException: Connection refused: no further information; For more details see:  http:&#x2F;&#x2F;wiki.apache.org&#x2F;hadoop&#x2F;ConnectionRefused</span><br><span class="line"></span><br><span class="line">原因：开启historyserver服务  mr-jobhistory-daemon.sh start historyserver</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">问题出现：使用IDEA运行完分词程序后，在输出界面输出了分词信息；</span><br><span class="line">但是去Linux集群下，quer使用find &#x2F; -name &#39;output&#39; 却找不到这个文件，</span><br><span class="line"></span><br><span class="line">原因：hdfs不是一个实际的路径，如果程序中的代码为</span><br><span class="line">&quot;hdfs:&#x2F;&#x2F;192.168.146.130:9000&#x2F;tmp&#x2F;input&quot;</span><br><span class="line">&quot;hdfs:&#x2F;&#x2F;192.168.146.130:9000&#x2F;tmp&#x2F;output&quot;</span><br><span class="line">那么实际上在master节点上并没有一个tmp文件夹里存放这两个文件</span><br></pre></td></tr></table></figure><p>如何将此二文件取回本地，也就是能够实际的打开相应的文件？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">使用hdfs dfs -get 【hdfs的目录】 【本地目录】</span><br><span class="line">以上命令即可将hdfs上的文件取回本地</span><br><span class="line"></span><br><span class="line">如何新建hdfs上的文件，也就是在运行程序的时候需要上传程序的输入到hdfs上</span><br><span class="line"></span><br><span class="line">使用hdfs dfs -mkdir 【hdfs新建的目录】</span><br><span class="line">使用hdfs dfs -put 【本地目录】 【hdfs的目录】</span><br><span class="line">以上即可完成hdfs文件的上传</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 调试 </tag>
            
            <tag> Hadoop </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS集群相关问题</title>
      <link href="/article/bd8a.html"/>
      <url>/article/bd8a.html</url>
      
        <content type="html"><![CDATA[<h3 id="centos-ssh连不上"><a href="#centos-ssh连不上" class="headerlink" title="centos ssh连不上"></a>centos ssh连不上</h3><blockquote><p>出现22端口拒绝访问等问题</p></blockquote><p>确保安装相关软件<br>可以用yum search 来查找相关ssh的软件包</p><a id="more"></a><p>要安装 openssh，openssh-servers，openssh-clients<br>然后启动ssh，要用service sshd start</p><p>注意要将防火墙关闭，可以直接将iptables stop</p><p>现在ssh localhost 就可以登录了</p><h3 id="centos-ping不通外网"><a href="#centos-ping不通外网" class="headerlink" title="centos ping不通外网"></a>centos ping不通外网</h3><p>很大程度上是因为dns设置错误，如果在默认的dns下不能访问外网<br>就要在Wmware软件中虚拟网络编辑器中的NAT设置中的DNS设置添加上8.8.8.8和8.8.4.4</p><p>不需要在centos中修改配置文件（精简版安装的除外可能有部分功能被删减）</p><p>此时，centos就可以ping 通外网了</p><h3 id="修改hostname主机名"><a href="#修改hostname主机名" class="headerlink" title="修改hostname主机名"></a>修改hostname主机名</h3><p>需要修改两处：一处是/etc/sysconfig/network，另一处是/etc/hosts，<br>只修改任一处会导致系统启动异常。首先切换到root用户。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">● &#x2F;etc&#x2F;sysconfig&#x2F;network</span><br><span class="line">  用任一款你喜爱的编辑器打开该文件，里面有一行 HOSTNAME&#x3D;localhost.localdomain     </span><br><span class="line">  (如果是默认的话），修改 localhost.localdomain 为你的主机名。</span><br><span class="line">● &#x2F;etc&#x2F;hosts</span><br><span class="line">  打开该文件，会有一行 127.0.0.1 localhost.localdomain localhost 。其中 127.0.0.1         </span><br><span class="line">  是本地环路地址， localhost.localdomain 是主机名(hostname)，也就是你待修改的。localhost     </span><br><span class="line">  是主机名的别名（alias），它会出现在Konsole的提示符下。将第二项修改为你的主机名，第三项可选。</span><br><span class="line">  将上面两个文件修改完后，并不能立刻生效。如果要立刻生效的话，可以用 hostname your-hostname        作临时修改，它只是临时地修改主机名，系统重启后会恢复原样的。但修改上面两个文件是永久的，重启     系统会得到新的主机名。</span><br><span class="line">● uname -n</span><br><span class="line">  重启后查看主机名</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="修改用户密码，等基础操作"><a href="#修改用户密码，等基础操作" class="headerlink" title="修改用户密码，等基础操作"></a>修改用户密码，等基础操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# passwd</span><br><span class="line">Changing password for user root.</span><br><span class="line">New password:</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> 调试 </tag>
            
            <tag> 联网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMware虚拟机相关问题</title>
      <link href="/article/7bc.html"/>
      <url>/article/7bc.html</url>
      
        <content type="html"><![CDATA[<h2 id="主机连不上VMware，ping不通，"><a href="#主机连不上VMware，ping不通，" class="headerlink" title="主机连不上VMware，ping不通，"></a>主机连不上VMware，ping不通，</h2><p>分析：与linux能不能上网没有关系，是VMware软件设置出错</p><blockquote><p><strong>可能原因</strong><br>1.服务。<br>打开服务，查看VM的各项服务是否为启动状态【首先要确定】<br>2.同一网段。<br><strong>拿NAT来说，</strong></p></blockquote><a id="more"></a><p>①打开Vmware的虚拟网络编辑器，找到NAT对应的NAT设置，记下相应的网关和子网IP地址<br>②使用的是虚拟网卡VMnet8，去网络共享中心的网络适配器中查看这块网卡的属性，记下其ipv4的地址，切记要将此处的地址改为和①中地址所属同一网段的地址！（在ipv4属性中这些地址都可以自己指定）</p><p>完成后即可ping通</p><h2 id="虚拟机迁移注意事项："><a href="#虚拟机迁移注意事项：" class="headerlink" title="虚拟机迁移注意事项："></a>虚拟机迁移注意事项：</h2><p>直接拷贝虚拟机文件；<br>使用对应版本的VMware虚拟机来打开它；<br>不知道选择“我已复制该虚拟机”;<br>知道选择“我已移动该虚拟机”(免设置网络IP)一定要选这个！！！<br>如果需要修改IP地址，要做以下内容：</p><blockquote><ul><li>要改【虚拟网络编辑器】中的NAT选项页【最下方】的子网IP改成相应IP</li><li>ifconfig-&gt;看到所显示的信息是哪个网卡【eth0?eth1?eth2?】-&gt;看到HWADDR是什么</li><li>cd /etc/sysconfig/network-scripts/中 要将eth中的硬件地址与之相对应；</li><li>service network restart</li></ul></blockquote><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h2 id="新增加一个节点需要的工作"><a href="#新增加一个节点需要的工作" class="headerlink" title="新增加一个节点需要的工作"></a>新增加一个节点需要的工作</h2><ul><li><p>新建用户hadoop</p></li><li><p>增加权限</p></li><li><p>修改主机名</p></li><li><p>安装jdk，需要使用完整的jdk（oracle），使用scp直接远程拷贝</p></li><li><p>配置profile【root】</p></li><li><p>配置bashrc【hadoop】</p></li><li><p>在hadoop用户下测试java</p></li><li><p>安装hadoop，直接由scp远程拷贝而来</p><blockquote><p> 【注意】：拷贝来的hadoop文件夹，其配置文件是配置好的不用改（四个.xml文件完全相同）<br>：slaves文件中要因人而异，主从节点是不同的，就是由此区分<br> 【首次】：对hadoop文件夹进行权限更改！！！！！ 特别重要！！！<br>sudo chown -R hadoop usr/local/hadoop<br>：关闭取消centos的防护机制，iptables，selinux<br>：退出hadoop的安全模式<br>以上完成，即可开始修改配置xml 添加进集群<br> 【主机启动】start-all.sh 使用jps查看进程状态<br>使用hadoop dfsadmin -report查看当前hdfs状态<br>有异常：则查看日志log</p></blockquote></li></ul><h2 id="新增加节点的问题"><a href="#新增加节点的问题" class="headerlink" title="新增加节点的问题"></a>新增加节点的问题</h2><p><strong>1）防火墙设置问题：</strong><br>==&gt;解决方案：关闭防火墙：#service iptables stop。出现三行OK，此时防火墙被关闭。重复启动集群后，发现问题没有完全解决。<br><strong>2）SELinux设置问题：</strong><br>==&gt;解决方案：关闭SELinux：<br>可以编辑配置文件达到目的<br>     vi /etc/selinux/conf<br>     set SELINUX=disabled<br><strong>3）清除Hadoop集群的缓存目录（在core-sites里面设置）</strong></p><p><strong>4）格式化NameNode，同意NameNode的ID号</strong><br>==&gt;解决方案：#hadoop namenode -format</p><p><strong>5）关闭Hadoop系统的安全模式：</strong><br>==&gt;解决方案：#hadoop dfsadmin -safemode leave</p><p><strong>6）重启集群后，显示正常，且不会逐渐节点衰亡。</strong></p>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VMware </tag>
            
            <tag> 调试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS安装JDK</title>
      <link href="/article/251a.html"/>
      <url>/article/251a.html</url>
      
        <content type="html"><![CDATA[<h2 id="centos-安装jdk"><a href="#centos-安装jdk" class="headerlink" title="centos 安装jdk"></a>centos 安装jdk</h2><blockquote><p>目的是使用hadoop<br>不要使用openjdk，要使用更完整的jdk，Oracle官网</p></blockquote><p>首先卸载当前已有的jdk【root下进行】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java-version显示当前jdk</span><br><span class="line">rpm -qa | grep java将本机全部的jdk查找出来</span><br></pre></td></tr></table></figure><a id="more"></a><p>然后挨个卸载之</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps java-1.x.x-openjdk-xxx将此jdk卸载</span><br><span class="line">yum -y remove java java-1.x.x-openjdk-xxx双管齐下，确保卸载</span><br></pre></td></tr></table></figure><p>之后开始安装jdk【hadoop用户下即可】<br>用浏览器去官网下载tar.gz后缀的jdk，64位的要选x64的jdk</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxf ~&#x2F;下载&#x2F;jdk-x.x.x.tar.gz -C &#x2F;usr&#x2F;local&#x2F;java 【使用浏览器默认下载路径】</span><br></pre></td></tr></table></figure><p>以上将下载好的jdk直接解压到/usr/local/java目录中</p><p>修改环境变量，双管齐下<br>【root中】修改、etc/profile<br>在profile中末尾添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME&#x3D;你的路径</span><br><span class="line">export JRE_HOME&#x3D;你的路径&#x2F;jre</span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib:$JRE_HOME&#x2F;lib:$CLASSPATH</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$JRE_HOME&#x2F;bin:$PATH</span><br><span class="line">然后</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>【hadoop中】修改 ~/.bashrc </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在bashrc末尾加上JAVA_HOME&#x3D;你的路径</span><br><span class="line">然后source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure><p>【hadoop中】测试<br>java -version输出版本则表示OK</p><blockquote><p>注意：<br>去到hadoop目录下找到hadoop-env.sh<br>此文件在/usr/local/hadoop/etc/hadoop 中<br>其中找到JAVA_HOME，看是否对应正确的当前jdk路径</p></blockquote><p>【hadoop中】终极测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  1. cd &#x2F;usr&#x2F;local&#x2F;hadoop</span><br><span class="line">  2. mkdir .&#x2F;input</span><br><span class="line">  3. cp .&#x2F;etc&#x2F;hadoop&#x2F;*.xml .&#x2F;input   将配置文件作为输入文件</span><br><span class="line">  4. .&#x2F;bin&#x2F;hadoop jar .&#x2F;share&#x2F;hadoop&#x2F;mapreduce&#x2F;hadoop-mapreduce-examples-*.jar grep .&#x2F;input .&#x2F;output &#39;dfs[a-z.]+&#39;</span><br><span class="line">  5. cat .&#x2F;output&#x2F;*      </span><br><span class="line">运行hadoop的wordcount实例，正常则OK</span><br></pre></td></tr></table></figure><p>完</p>]]></content>
      
      
      <categories>
          
          <category> Hadoop相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> JDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装sqlserver并用myeclipse访问之</title>
      <link href="/article/cad2.html"/>
      <url>/article/cad2.html</url>
      
        <content type="html"><![CDATA[<p>之前都是用mysql现在项目要求用sqlserver，现把安装配置连接步骤总结如下：</p><h3 id="安装sqlserver数据库"><a href="#安装sqlserver数据库" class="headerlink" title="安装sqlserver数据库"></a>安装sqlserver数据库</h3><p>网上安装资源很多，我从这里下载的安装版：<a href="http://free.zolsky.com/activation/soft/21.htm" target="_blank" rel="external nofollow noopener noreferrer">http://free.zolsky.com/activation/soft/21.htm</a></p><p>下好后按照教程装好，教程可参见：</p><a id="more"></a><p>在安装时应该要输入一个秘钥，秘钥在此：<a href="http://zhidao.baidu.com/question/873260145955726092.html?fr=iks&amp;word=sqlserver2008r2++empress%C3%D8%D4%BF&amp;ie=gbk" target="_blank" rel="external nofollow noopener noreferrer">http://zhidao.baidu.com/question/873260145955726092.html?fr=iks&amp;word=sqlserver2008r2++empress%C3%D8%D4%BF&amp;ie=gbk</a></p><p>上面链接中的秘钥分标准版企业版等好几个版本，我安装时的版本选项是英文，这里对应尝试一下只要秘钥有效就能继续进行安装工工作了。</p><h3 id="使用management-studio登录"><a href="#使用management-studio登录" class="headerlink" title="使用management studio登录"></a>使用management studio登录</h3><p>下载安装完成后，在相应安装目录下会发现有sqlserver management studio这歌工具，图标是圆筒和锤子加扳手；</p><p>打开之后会填写登录账号密码，一般在安装时你已经设置了密码，这时身份验证选择“sqlserver身份验证”，输入完毕后即可进入；</p><p><strong>登录失败的解决方法：</strong></p><p>详见链接：<a href="http://wenku.baidu.com/link?url=00tLSKLmDSma0-BZLUdteUx2Ij4GOmnAIPpEhgDn_RZdQUn8Gx0luK74dnp_MFcT8R2nfDQvlAys0VsTRhlTeiD9IjdSWDxWqs4HVWxPRKq" target="_blank" rel="external nofollow noopener noreferrer">http://wenku.baidu.com/link?url=00tLSKLmDSma0-BZLUdteUx2Ij4GOmnAIPpEhgDn_RZdQUn8Gx0luK74dnp_MFcT8R2nfDQvlAys0VsTRhlTeiD9IjdSWDxWqs4HVWxPRKq</a></p><p>sqlserver身份验证有时会出现错误（比如忘记密码），这时可以使用windows验证，windows验证一般可以直接进入，无需密码；</p><p>进入之后找到左侧“安全性”一栏，点开之后再最低部有个sa项，双击打开之后可以更改密码，之后重新登录，会发现用sqlserver验证也可以成功登录了</p><p><strong>注意：</strong></p><p>使用sqlserver验证登录是必要的，因为在项目中链接数据库操作是就是使用的此验证，故要确保sqlserver验证可以登陆成功，之后在工程的链接代码中还要提供相应的用户名和密码。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="使用myeclipse连接sqlserver·"><a href="#使用myeclipse连接sqlserver·" class="headerlink" title="使用myeclipse连接sqlserver·"></a>使用myeclipse连接sqlserver·</h3><p>首先下载连接sqlserver的jar包，名为sqljdbc4.jar，下载地址：<a href="http://download.csdn.net/download/hgg923/6542847" target="_blank" rel="external nofollow noopener noreferrer">http://download.csdn.net/download/hgg923/6542847</a></p><p>然后myeclipse中新建一个java工程，把下好的包导入到工程中；</p><p>之后在java文件中书写如下，代码转自：<a href="http://blog.163.com/jackie_howe/blog/static/19949134720125173539380/" target="_blank" rel="external nofollow noopener noreferrer">http://blog.163.com/jackie_howe/blog/static/19949134720125173539380/</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        String driverName=<span class="string">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span>;</span><br><span class="line">        String dbURL=<span class="string">"jdbc:sqlserver://localhost:1433;DatabaseName=填写你的数据库名"</span>;</span><br><span class="line">        String userName=<span class="string">"填写你的用户名，我的是sa"</span>;</span><br><span class="line">        String userPwd=<span class="string">"填写你的密码"</span>;</span><br><span class="line">        <span class="keyword">try</span>  &#123;</span><br><span class="line">            Class.forName(driverName);</span><br><span class="line">            System.out.println(<span class="string">"加载驱动成功！"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"加载驱动失败！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Connection dbConn=DriverManager.getConnection(dbURL,userName,userPwd);</span><br><span class="line">            System.out.println(<span class="string">"连接数据库成功！"</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.print(<span class="string">"SQL Server连接失败！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将上述代码中的用户名密码该为自己的信息，然后运行，一般会输出：</p><pre><code>加载驱动成功！连接数据库成功！</code></pre><p>如果见到以上内容就代表大功告成！代码访问数据库工作就告一段落了。</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Sqlserver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C语言函数传值的相关问题</title>
      <link href="/article/c554.html"/>
      <url>/article/c554.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）现有如下程序段：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmem</span><span class="params">(<span class="keyword">char</span> **p,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">*p=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="comment">// your code goes here</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line">getmem(&amp;str,<span class="number">100</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(str,<span class="string">"hello"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,str);<span class="built_in">free</span>(str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>执行无误，输出hello，没有问题；<br>修改之后如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getmem</span><span class="params">(<span class="keyword">char</span> *p,<span class="keyword">int</span> n)</span></span>&#123; <span class="comment">//一开始认为是多余的</span></span><br><span class="line">p=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="comment">// your code goes here</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line">getmem(str,<span class="number">100</span>); <span class="comment">//相应改为str</span></span><br><span class="line"><span class="built_in">strcpy</span>(str,<span class="string">"hello"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,str);<span class="built_in">free</span>(str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>上述输出为null，其实不小心犯了个低级错误，那就是：<br>调用getmem时是值传递，str本身在getmem之后并没有获得相应空间，原因即getmem中的*p 作为局部变量并不能将p返回到main函数，即它只让局部的p指向了一段空间，没有意义。</p><p>而如果形参改为开始的</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getmem(<span class="keyword">char</span> **p,<span class="keyword">int</span> n)</span><br></pre></td></tr></table></figure><p>调用时使用</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getmem(&amp;str,<span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>其意思是：char *<em>p即指向指针的指针，意为“p指向一个变量，此变量存放的不是具体数据，而是一个指针的地址”，</em>p 即表示其所指的地址变量，显然，此处被指向的指针即str，那么getmem中的</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*p=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n);</span><br></pre></td></tr></table></figure><p>即表示此“被指向的指针”，即str指向一段空间，而区别于值传递的是此处实参为&amp;str，其结束调用后会改变其指向。</p><p>此处会改变的原因：本质仍为值传递，但是传递的不是此指针（不同于前面的getmem(str,100)），而是指针所存放的地址，其被 p所指向，然后在函数中通过p修改了p指向内容的值，即修改了str的地址，即调用后str指向发生改变。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>char *str中，str是一个地址，printf(str)中str也是个地址，只不过格式控制类型为%s，这样的print即从str地址开始一直输出，直到’\0’为止（终结符是系统自动加上的），这样便实现打印字符串的工作，好像str真作为一个变量存放了这个串，其实不然。</p><p>另外，不用函数的方式来开辟空间确实就不需要**p这么麻烦：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="comment">// your code goes here</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line">str=(<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">100</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(str,<span class="string">"hello"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,str);<span class="built_in">free</span>(str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述即可以完成对char *str开辟空间的工作，此外，除了用malloc手动申请空间，也可以用数组赋值的方式：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="comment">// your code goes here</span></span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">100</span>];<span class="comment">//利用系统自动为数组分配空间的特点</span></span><br><span class="line">str=a; <span class="comment">//这样也可以实现str指向一片连续空间</span></span><br><span class="line"><span class="comment">//str=(char *)malloc(100);</span></span><br><span class="line"><span class="built_in">strcpy</span>(str,<span class="string">"hello"</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s"</span>,str);<span class="built_in">free</span>(str);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++ </tag>
            
            <tag> malloc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JQuery选择器和JQuery包装集</title>
      <link href="/article/64a8.html"/>
      <url>/article/64a8.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）今天学习了JQuery的一些基本用法，包括JQuery选择器和JQuery包装集；</p><p>从现在开始，要慎重区分DOM对象和JQuery对象，两种对象的方法不同，属性不同，在使用中要特别注意</p><a id="more"></a><h3 id="JQuery选择器"><a href="#JQuery选择器" class="headerlink" title="JQuery选择器"></a>JQuery选择器</h3><p>编写任何javascript程序都需要首先获得对象, jQuery选择器能彻底改变我们平时获取对象的方式, 可以获取几乎任何语意的对象, </p><p>比如”拥有title属性并且值中包含test的元素”, 完成这些工作只需要编写一个jQuery选择器字符串. 学习jQuery选择器是学习jQuery最重要的一步. </p><p>DOM对象获取方法：</p><pre><code>单个对象：var objDiv =document.getElementById(“id”);多个对象：Var arrObj = document.getElementsByTagName(“id”);</code></pre><p>JQuery对象获取方法：</p><pre><code>单个对象：var objDiv = $ (“#Id&quot;); 多个对象：var arrObj = $(&apos;div&apos;);//警告：此处是JQuery语法形式，但依然是dom对象数组！！</code></pre><p>在DOM编程中我们只能使用有限的函数根据id或者TagName获取DOM对象。</p><p>而在JQUERY中则完全不同，JQUERY提供了异常强大的选择器用来帮助我们获取页面上的对象,并且将对象以JQUERY包装集的形式返回。</p><pre><code>&quot;$&quot;符号在JQUERY中代表对JQUERY框架集的引用。</code></pre><p>JQUERY选择器包括以下几种：</p><pre><code>1、基础选择器2、层次选择器3、基本过滤器4、内容过滤器5、可见性过滤器6、属性过滤器7、子元素过滤器8、表单选择器9、表单过滤器</code></pre><p>下面列出几种重要的选择器：</p><h4 id="基础选择器"><a href="#基础选择器" class="headerlink" title="基础选择器"></a>基础选择器</h4><pre><code>$(&quot;#Id&quot;) 选择ID为divId的元素（根据元素Id选择）$(&quot;element&quot;) 选择所有元素（根据元素的名称选择）$(&quot;.class&quot;) 选择所用CSS类为bgRed的元素（根据元素的css类选择）$(&quot;*&quot;)选择页面所有元素（选择所有元素）$(&quot;#divId, element, .class&quot;)（可以将几个选择器用&quot;,&quot;分隔开然后再拼成一个选择器字符串.会同时选中这几个选择器匹配的内容.）</code></pre><h4 id="属性过滤器"><a href="#属性过滤器" class="headerlink" title="属性过滤器"></a>属性过滤器</h4><pre><code>$(&quot;div[id]&quot;)匹配包含给定属性的元素$(&quot;input[name=&apos;...&apos;]&quot;) 匹配给定的属性是某个特定值的元素  name=&apos;...&apos;$(&quot;input[name!=&apos;...&apos;]&quot;)匹配给定的属性是不包含某个特定值的元素 name=&apos;...&apos;$(&quot;input[name^=&apos;...&apos;]&quot;)匹配给定的属性是以某些值开始的元素 name^=&apos;...&apos;$(&quot;input[name$=&apos;...&apos;]&quot;)匹配给定的属性是以某些值结尾的元素 name$=&apos;...&apos;$(&quot;input[name*=&apos;...&apos;]&quot;)匹配给定的属性是以包含某些值的元素 name*=&apos;...&apos;$(&quot;input[id][name$=&apos;...&apos;]&quot;)复合属性选择器，需要同时满足多个条件时使用 [id][name$=&apos;...&apos;]</code></pre><h4 id="表单过滤器"><a href="#表单过滤器" class="headerlink" title="表单过滤器"></a>表单过滤器</h4><pre><code>$(&quot;input:enabled&quot;)匹配所有可用元素$(&quot;input:disabled&quot;)匹配所有不可用元素$(&quot;input:checked&quot;)匹配所有选中的被选中元素(复选框、单选框等，不包括select中的option)$(&quot;select option:selected&quot;)匹配所有选中的option元素</code></pre><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ol><li>DOM转JQUERY包装集：$(arrDiv[i]).html(‘div’+i);//arrDivp[i]是DOM对象，直接用$()转为JQuery对象后调用html方法；</li><li>JQUERY包装集转DOM对象</li><li>通过索引访问到的JQUERY包装集中的单个元素是DOM对象</li><li>通过包装集的某些遍历函数，例如each中传递的遍历函数中的this也是DOM元素<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var arrDiv &#x3D; $(&#39;div&#39;);</span><br><span class="line">for( var i &#x3D; 0;i &lt; arrDiv.length; i++) &#123;</span><br><span class="line">    arrDiv[i].innerHTML &#x3D; &#39;div&#39; + i;&#x2F;&#x2F;通过索引访问到的元素不是JQuery对象，而是DOM对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="JQuery包装集"><a href="#JQuery包装集" class="headerlink" title="JQuery包装集"></a>JQuery包装集</h3><p>在此介绍一些基本的JQuery包装集及使用</p><h4 id="ready-方法"><a href="#ready-方法" class="headerlink" title="ready()方法"></a>ready()方法</h4><p>在使用JQUERY时，当 DOM（文档对象模型） 已经加载完成时，就会发生 ready 事件。由于该事件在文档就绪后发生，因此把所有其他的 JQUERY事件和函数置于该事件中是非常好的做法。</p><p>即将JQuery函数及事件全部放到$(document).ready(function(){…all jquery functions..});</p><p>相比较而言，<code>&lt;body onload=&quot;&quot;&gt;&lt;/body&gt;</code>中的onload同ready的区别有：</p><p>onload是原生的JAVASCRIPT事件方法；</p><p>onload必须等到页面内包括图片的所有元素加载完毕后才能执行，ready是DOM结构绘制完毕后就执行，不必等到加载完毕；</p><p>onload不能同时编写多个，如果有多个onload方法，只会执行一个，而ready可以同时编写多个，并且都可以得到执行 ；</p><p>onload无简化写法，ready有简化的写法，可以简写成$(function(){…})；</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h4 id="appendTo-方法"><a href="#appendTo-方法" class="headerlink" title="appendTo()方法"></a>appendTo()方法</h4><p>在被选元素的结尾（仍然在内部）插入指定内容，可以被用来动态添加若干句HTML语句；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var testDiv &#x3D; $(&#39;#testDiv&#39;);</span><br><span class="line">$(&#39;&lt;select&gt;&lt;option&gt;choose1&lt;&#x2F;option&gt;&lt;option&gt;choose2&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&#39;).appendTo(testDiv);</span><br></pre></td></tr></table></figure><p>意思是将此行html语句先转换成JQuery对象，然后用对象的appendTo方法追加到testDiv这个被选元素的结尾，这个被选元素即某个控件，</p><p>如一个div块或者一个文本框，效果是在此控件后显示一个下拉框；</p><h4 id="其他一些常用的操作JQUERY包装集的函数"><a href="#其他一些常用的操作JQUERY包装集的函数" class="headerlink" title="其他一些常用的操作JQUERY包装集的函数"></a>其他一些常用的操作JQUERY包装集的函数</h4><pre><code>$(&quot;p&quot;).eq(1) 获取第N个元素：.eq(Index)$(&quot;p&quot;).filter(&quot;.bgRed&quot;)筛选出与指定表达式匹配的元素集合：.filter(&quot;Express&quot;)$(&quot;div&quot;).filter(function(index) {});筛选出与指定函数返回值匹配的元素集合：.filter(function)$(&quot;input[type=&apos;checkbox&apos;]&quot;).parent().is(&quot;form&quot;)用一个表达式来检查当前选择的元素集合，如果其中至少有一个元素符合这个给定的表达式就返回true$(&quot;p&quot;).parent()查找每个段落的父元素：</code></pre><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><pre><code>HTML 代码：&lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;执行$(&quot;p&quot;).parent()之后结果为：[ &lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;]$(&quot;p&quot;).parent(&quot;.selected&quot;)查找段落的父元素中每个类名为selected的父元素：HTML 代码：&lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;&lt;div class=&quot;selected&quot;&gt;&lt;p&gt;Hello Again&lt;/p&gt;&lt;/div&gt;执行$(&quot;p&quot;).parent(&quot;.selected&quot;)之后结果为：[ &lt;div class=&quot;selected&quot;&gt;&lt;p&gt;Hello Again&lt;/p&gt;&lt;/div&gt; ]</code></pre><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">使用is()方法查找段落的父元素中每个类名为selected的父元素（带返回值true&#x2F;false）：</span><br><span class="line"></span><br><span class="line">使用var flagValue &#x3D; $(&quot;p&quot;).parent().is(&quot;select&quot;) 代替 $(&quot;p&quot;).parent(&quot;.selected&quot;) &#x2F;&#x2F; 使用is()方法会有返回值，如果满足条件，则flagValue会为true;</span><br><span class="line"></span><br><span class="line">$(&quot;input&quot;).map(function()&#123;&#125;).get().join(&quot;, &quot;)把form中的每个input元素的值建立一个列表</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;b&gt;Values: &lt;&#x2F;b&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;form&gt;  </span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;name&quot; value&#x3D;&quot;John&quot;&#x2F;&gt;  </span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;password&quot; value&#x3D;&quot;password&quot;&#x2F;&gt;  </span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;url&quot; value&#x3D;&quot;http:&#x2F;&#x2F;ejohn.org&#x2F;&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">JS：$(&quot;p&quot;).append(  $(&quot;input&quot;).map(function()&#123;  return $(this).val();&#125;).get().join(&quot;, &quot;)  ); </span><br><span class="line"></span><br><span class="line">结果：在&lt;p&gt;标签后追加字符串，其内容是取出所有&lt;input&gt;标签的value值，并用“，”分隔，最后结果为：</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;b&gt;Values:John, password, http:&#x2F;&#x2F;ejohn.org&#x2F;&lt;&#x2F;b&gt;&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">jQuery.map(arr|obj,callback) &#x2F;&#x2F;将一个数组转换为另一个数组</span><br><span class="line"></span><br><span class="line">将原数组中每个元素加 4 转换为一个新数组：$.map( [0,1,2], function(n)&#123;  return n + 4;&#125;);  结果:[4, 5, 6]</span><br><span class="line"></span><br><span class="line">原数组中大于 0 的元素加 1 ，否则删除：$.map( [0,1,2], function(n)&#123;  return n &gt; 0 ? n + 1 : null;&#125;); 结果:[2, 3]</span><br><span class="line"></span><br><span class="line">原数组中每个元素扩展为一个包含其本身和其值加 1 的数组，并转换为一个新数组：$.map( [0,1,2], function(n)&#123;  return [ n, n + 1 ];&#125;); 结果:[0, 1, 1, 2, 2, 3]</span><br><span class="line"></span><br><span class="line">$(&quot;p&quot;).not($(&quot;#testid&quot;)[0])去除所有与给定选择器匹配的元素</span><br><span class="line"></span><br><span class="line">&lt;input name&#x3D;&quot;apple&quot; &#x2F;&gt;&lt;input name&#x3D;&quot;flower&quot; checked&#x3D;&quot;checked&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">查找所有未选中的 input 元素：$(&quot;input:not(:checked)&quot;) 结果:[ &lt;input name&#x3D;&quot;apple&quot; &#x2F;&gt; ]</span><br><span class="line"></span><br><span class="line">$(&quot;p&quot;).slice(0, 1);选取一个匹配的子集</span><br><span class="line"></span><br><span class="line">.slice(start [,end] );第一个参数：开始选取子集的位置。第一个元素是0.如果是负数，则可以从集合的尾部开始选起。</span><br><span class="line"></span><br><span class="line">第二个参数：结束选取自己的位置，如果不指定，则就是本身的结尾。</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Hello&lt;&#x2F;p&gt;&lt;p&gt;cruel&lt;&#x2F;p&gt;&lt;p&gt;World&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">选择第一个p元素：$(&quot;p&quot;).slice(0, 1).wrapInner(&quot;&lt;b&gt;&lt;&#x2F;b&gt;&quot;);&#x2F;&#x2F;选择的是value值</span><br><span class="line"></span><br><span class="line">选择前两个p元素：$(&quot;p&quot;).slice(0, 2).wrapInner(&quot;&lt;b&gt;&lt;&#x2F;b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">只选取第二个p元素：$(&quot;p&quot;).slice(1, 2).wrapInner(&quot;&lt;b&gt;&lt;&#x2F;b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">只选取第二第三个p元素$(&quot;p&quot;).slice(1).wrapInner(&quot;&lt;b&gt;&lt;&#x2F;b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">选取第最后一个p元素：$(&quot;p&quot;).slice(-1).wrapInner(&quot;&lt;b&gt;&lt;&#x2F;b&gt;&quot;);</span><br><span class="line"></span><br><span class="line">$(&quot;p&quot;).wrapInner(htm|element|fnl)将每一个匹配的元素的子内容(包括文本节点)用一个HTML结构包裹起来，举例如上，将全部字符加粗；</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JQuery </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> JQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JQuery基础概念知识</title>
      <link href="/article/dcf0.html"/>
      <url>/article/dcf0.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）JQuery是继prototype之后又一个优秀的Javascript库。它是轻量级的js库 ，它兼容CSS3，还兼容各种浏览器（IE 6.0+, FF 1.5+, Safari 2.0+, Opera 9.0+），jQuery2.0及后续版本将不再支持IE6/7/8浏览器。jQuery使用户能更方便地处理HTML（标准通用标记语言下的一个应用）、events、实现动画效果，并且方便地为网站提供AJAX交互。jQuery还有一个比较大的优势是，它的文档说明很全，而且各种应用也说得很详细，同时还有许多成熟的插件可供选择。jQuery能够使用户的html页面保持代码和html内容分离。jQuery是一个兼容多浏览器的javascript库，核心理念是write less,do more(写得更少,做得更多)。jQuery的语法设计可以使开发者更加便捷，例如操作文档对象、选择DOM元素、制作动画效果、事件处理、使用Ajax以及其他功能。除此以外，jQuery提供API让开发者编写插件。其模块化的使用方式使开发者可以很轻松的开发出功能强大的静态或动态网页。</p><a id="more"></a><p><strong>jQuery</strong>，顾名思议，也就是JavaScript和查询（Query），即是辅助JavaScript开发的库。</p><p><strong>AJAX</strong>：即“Asynchronous Javascript And XML”（异步JavaScript和XML），可以不刷新页面完成数据库操作（包括查询并返回数据），在验证输入时有很重要的作用。</p><p><strong>文档说明</strong>：Jquery有完整的API开发文档，比如jQuery1.11.0_20140330.chm，手册查询非常方便，即查即用</p><p>代码和html内容分离：使用Jquery不用再在html里面插入一堆js来调用命令了，只需要定义id即可，通过id选择器来选中JQuery对象，之后便可以通过对象方法来操作</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>JQUERY是一个JAVASCRIPT库（子集）、JS文件也是一个工具包；</p><p>封装了大量的有用函数，提高了开发效率；强大的DOM、CSS事件处理操作能力；使代码更加简洁；减弱了与浏览器的相关性；提高了运行效率；</p><p>下载地址：<a href="http://docs.jquery.com/Downloading_jQuery" target="_blank" rel="external nofollow noopener noreferrer">http://docs.jquery.com/Downloading_jQuery</a></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>jQuery的Id选择器；jQuery的事件方法；修改样式函数css()；修改属性函数attr()；</p><ul><li>新建一个html文档</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>!DOCTYPE是文档说明，做一个兼容性的网页一般完整的文档说明如下:</p><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><meta charset="UTF-8">为网页提供了一种编码方式,否则页面很可能出现乱码.UTF-8 是没有国家的编码,也就是独立于任何一种语言,任何语言都可以使用<title>Document</title>是网页的标题名称<ul><li>要使用JavaScript脚本首先要导入js的库文件，即导入jquery-1.11.1.min.js（此处是压缩版的库文件）：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;js&#x2F;jquery-1.11.1.min.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>“src”是js库文件的路径，”type”是代表插入脚本的类型，可以为”text/javascript”或者”text/css”等。</li></ul><p>带有min的文件打开后是没有缩进的，不带min的那个是完整格式的，打开后是有良好格式的js代码，方便阅读和修改（一般不要改）</p><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><ul><li>首先在html文档中写一个输入框和两个按钮：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"sub.html"</span> <span class="attr">onsubmit</span>=<span class="string">"return doCheck();"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"account"</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">value</span>=<span class="string">"重置"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>以上两句写在html中的<code>&lt;body&gt;&lt;/body&gt;</code>标签中，<code>&lt;input&gt;</code>标签写在<code>&lt;form&gt;</code>标签中，<br><code>&lt;input&gt;</code>标签中的type类型”submit”是提交form标签之间文本框中输入的数据；<br><code>&lt;input&gt;</code>标签中的type类型”reset”是重置form标签之间文本框中输入的数据为空；<br><code>&lt;form&gt;</code>中的action属性标示了按下提交按钮后的跳转，可以是一个简单的网址，也可以是一个action的名字（框架中）；<br><code>&lt;form&gt;</code>中的onsubmit’属性标示了跳转之前要检查onsubmit的值，false则不跳转，true?false的值来自doCheck()这个JS函数；</p><p>doCheck函数的实现作为JavaScript脚本要放在<code>&lt;head&gt;&lt;/head&gt;</code>标签中间，并用<code>&lt;script type=&quot;text/javascript&gt;&lt;/script&gt;</code>包含起来，如下所示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="js/</span>jquery<span class="number">-1.11</span><span class="number">.1</span>.min.js<span class="string">" type="</span>text/javascript<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script type="</span>text/javascript<span class="string">"&gt;</span></span><br><span class="line"><span class="string">    //public void doCheck();</span></span><br><span class="line"><span class="string">    //在这个方法中写入表单验证的代码。如果此方法返回true，则会执行action中的URL，否则就不执行。</span></span><br><span class="line"><span class="string">    function doCheck() &#123;</span></span><br><span class="line"><span class="string">        //alert('docheck done');</span></span><br><span class="line"><span class="string">        var validFlag = true;</span></span><br><span class="line"><span class="string">        //获取用户输入的账号文本值</span></span><br><span class="line"><span class="string">        var account = document.getElementById('account').value;</span></span><br><span class="line"><span class="string">        //判断账号的长度是6-30个字符之间</span></span><br><span class="line"><span class="string">        //获取账号的长度</span></span><br><span class="line"><span class="string">        var len = account.length;</span></span><br><span class="line"><span class="string">        if (len &lt; 6 || len &gt; 30) &#123;</span></span><br><span class="line"><span class="string">            validFlag = false;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        return validFlag; </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br></pre></td></tr></table></figure><p>从以上代码可以看出，js代码和Java代码非常相似，但：</p><pre><code>函数定义以function打头，可以返回true/false或者变量，或者数组等任何值（包括一个对象）没有数据类型的分别，定义一个变量用var关键字，var parameter = xx；数组的定义：var Arr = new Array(&apos;a&apos;,&apos;b&apos;,&apos;c&apos;); //new Array(&apos;&apos;)是固定格式</code></pre><p>以上获取文本框输入值使用的是Dom对象的方法，Dom（documnet），其对象有getElementById()这个方法，可以按html标签内的id名来获取到dom对象</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> account = <span class="built_in">document</span>.getElementById(<span class="string">'account'</span>).value;</span><br><span class="line"><span class="comment">//即取到id为account的控件的value值，并赋值给account，</span></span><br></pre></td></tr></table></figure><p>此处的account值是一个类似Java中的String类型（注意：不要混用Java中的各种方法），Js有其自己的各种函数来操作字符串，使用之前要确定正确</p><p>比较字符串可以用<code>if(account==&quot;example&quot;)</code>等方式来比较；其对象还有length属性，直接获取字符串长度；</p><p>doCheck完成的是判断用户输入内容的长度，在6-30位是正确的，点击提交会跳转到sub.html页面；</p>]]></content>
      
      
      <categories>
          
          <category> JQuery </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
            <tag> JQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>J2EE前后台传值带中文时乱码</title>
      <link href="/article/421a.html"/>
      <url>/article/421a.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）传值乱码问题在Web开发中涉及许多方面：登陆注册时，是否正确得到正确的中文用户名；修改信息时，是否可以显示提交的中文信息；</p><p>以上是具体使用，当然包括所有后台想得到值的 文本框 的传值！！<br>可以看到输入中文是我们在做一个网站时必须要考虑的，纯英文的外国网站你输入中文也不会乱码。<br>其实，解决乱码我们只需要注意几个问题，再加之少许操作即可获得想要的中文</p><a id="more"></a><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><ul><li><p>一个Web工程项目中代码涉及编码的地方有几处：<br>你的struts.xml配置文件中开头会有一句：<?xml version="1.0" encoding="GBK" ?></p></li><li><p>文本框所在的jsp页面的开头也会有一句：<code>&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;GBK&quot;%&gt;</code><br>好像这就是所涉及到编码的所有部分了，如果我们只是改变一下”GBK”,”UTF-8”等等字眼，估计随便怎么换也是乱码</p></li><li><p>我们需要进一步的进行“再编码”！！</p></li></ul><p>下面的解决方式面对两种问题，至今我只遇到了这两种，即两种后台得到值的方式“<br>标准的form表单提交，后台用get和set得到文本框的值；<br>大量重复操作的跳转（比如页面中一个表格里每一行后面有一个删除按钮），直接href=action后挂相应的值进行传递</p><h3 id="标准form表单提交"><a href="#标准form表单提交" class="headerlink" title="标准form表单提交"></a>标准form表单提交</h3><p>1.把显示的jsp页面的第一句话写为：pageEncoding=”UTF-8”，GBK是不行的，对于struts可以忽视</p><p>2.在后台Java代码中的业务处理部分，</p><p>如果你的get和set没有在.java中，你总要通过getParameter(“xxx”);来获取值即：</p><p>如果get与set在其中，则可以直接用，不用getParameter</p><p>要做的操作：String xxx = request.getParameter(“xxx”);之后加一句 xxx = URLDecoder.decode(username , “utf-8”);  //关键代码,所需包会自动添加</p><p>get与set同你的处理代码在一起的，就在excute()里第一次出现xxx的前面添加：xxx = URLDecoder.decode(username , “utf-8”); </p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="用href-action传值"><a href="#用href-action传值" class="headerlink" title="用href=action传值"></a>用href=action传值</h3><p>首先，要改写，不要用href，改为点击触发一个js的function()，比如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"in"</span> <span class="attr">value</span>=<span class="string">"&lt;%p++(构造了一个id值)%&gt;"</span><span class="attr">....href</span>=<span class="string">"xx.action?id=p "</span>&gt;</span></span><br><span class="line">单传非中文是没有问题的，但是中文就要改一下，先要执行一个js：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"in"</span> <span class="attr">value</span>=<span class="string">"&lt;%p++(构造了一个id值)%&gt;"</span><span class="attr">....onclick</span>=<span class="string">”look(</span>'<span class="attr">p</span>')“&gt;</span></span><br><span class="line">添加完onclick属性后，再添加代码：</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">look</span>(<span class="params"> str </span>)</span>&#123; </span><br><span class="line"><span class="comment">//在js中首先进行两侧编码,注意是两次，查阅所有网上资料都可以发现，至于为什么，功力未到还不能搞懂</span></span><br><span class="line">    <span class="keyword">var</span> faultAddr = <span class="built_in">encodeURI</span>(<span class="built_in">encodeURI</span>(str));  <span class="comment">//需要通过两次编码    </span></span><br><span class="line">    <span class="built_in">window</span>.location.href=<span class="string">"xxx.action?id="</span>+str; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这相当于在页面传值的时候进行了编码，在后java中得到的是编码两次的变量，所以要进行一次解码，添加：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxx &#x3D; URLDecoder.decode(xxx, &quot;utf-8&quot;);  &#x2F;&#x2F;关键代码，添加位置同First所述</span><br><span class="line">Second-End</span><br></pre></td></tr></table></figure><h3 id="具体实例"><a href="#具体实例" class="headerlink" title="具体实例"></a>具体实例</h3><p>在“input.jsp”页面中，需要通过js将值传递到后台，后台根据传递的值进行数据查询时，</p><p>通过test.jsp的js进行编码（粉色为编码），后台java解码（绿色为解码部分），可以解决</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span> charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> faultAddr = <span class="built_in">encodeURI</span>(<span class="built_in">document</span>.getElementById(<span class="string">"faultAddr"</span>).value);</span><br><span class="line">        faultAddr = <span class="built_in">encodeURI</span>(faultAddr);  <span class="comment">//需要通过两次编码</span></span><br><span class="line">        <span class="built_in">window</span>.frames[<span class="string">"listframe"</span>].location.href =<span class="string">"queryorderList.action?faultAddr="</span> + faultAddr ;</span><br><span class="line">   &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span>      </span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">height</span>=<span class="string">"5%"</span> <span class="attr">width</span>=<span class="string">"50"</span>&gt;</span>输入内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"faultAddr"</span> <span class="attr">maxlength</span>=<span class="string">"300"</span> <span class="attr">size</span>=<span class="string">"10"</span> <span class="attr">name</span>=<span class="string">"faultAddr"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URLDecoder;</span><br><span class="line">String faultAddr =request.getParameter(<span class="string">"faultAddr"</span>);</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    faultAddr = URLDecoder.decode(faultAddr , <span class="string">"utf-8"</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> HTML </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>select标签添加onclick()事件的兼容写法</title>
      <link href="/article/166a.html"/>
      <url>/article/166a.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）</p><h3 id="修改前"><a href="#修改前" class="headerlink" title="修改前"></a>修改前</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">style</span>=<span class="string">"height:25px;width:160px;"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">onclick</span>=<span class="string">"xx('err')"</span> <span class="attr">selected</span>&gt;</span>选择查找方式<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">onclick</span>=<span class="string">"xx('low')"</span> &gt;</span>简单查询<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">onclick</span>=<span class="string">"xx('mid')"</span> &gt;</span>模糊检索<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">onclick</span>=<span class="string">"xx('hih')"</span> &gt;</span>高级搜索<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>javascript如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xx</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">alert(value);</span><br><span class="line"><span class="keyword">if</span>(value==<span class="string">"low"</span>)&#123;</span><br><span class="line">            ... ...</span><br><span class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value==<span class="string">"mid"</span>)&#123;</span><br><span class="line">   ... ...</span><br><span class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(value==<span class="string">"hih"</span>)&#123;</span><br><span class="line">   ... ...</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码片是可以在Firefox和IE9下运行的，但是它在我的360浏览器上就是无效的，究其原因还是IE版本的问题（存在兼容性问题），<br>也就是：老版本只能这样 <code>&lt;select  onclick() &gt;&lt;/select&gt;</code></p><p>而高版本和Firefox则支持这样 <code>&lt;option onclick() &gt;&lt;/option&gt;</code></p><p>具体版本我们不去管它，因为我找到了折中的实现办法，即可以兼容的实现触发事件，解决了以上问题</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="修改后"><a href="#修改后" class="headerlink" title="修改后"></a>修改后</h3><p>修改后的代码片如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">style</span>=<span class="string">"height:25px;width:160px;"</span> <span class="attr">onclick</span>=<span class="string">"xx(this)"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"err"</span> <span class="attr">selected</span>&gt;</span>选择查找方式<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"low"</span> &gt;</span>简单查询<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"mid"</span> &gt;</span>模糊检索<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"hih"</span> &gt;</span>高级搜索<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>javascript：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xx</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> selectedOption=value.options[value.selectedIndex];  </span><br><span class="line"><span class="comment">//alert(selectedOption.value);</span></span><br><span class="line"><span class="keyword">if</span>(selectedOption.value==<span class="string">"low"</span>)&#123;</span><br><span class="line">... ...</span><br><span class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(selectedOption.value==<span class="string">"mid"</span>)&#123;</span><br><span class="line">... ...</span><br><span class="line"> &#125;<span class="keyword">else</span> <span class="keyword">if</span>(selectedOption.value==<span class="string">"hih"</span>)&#123;</span><br><span class="line">... ...</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改后的实现其实是用了低版本IE的方法，但是通过获取到选项的value值，来选择要执行的js代码段，从而实现了一种灵活的兼容的触发事件的方法<br>个人认为，此办法非常不错。</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>注册型网站设计的阶段总结</title>
      <link href="/article/ee49.html"/>
      <url>/article/ee49.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）</p><h3 id="表格属性"><a href="#表格属性" class="headerlink" title="表格属性"></a>表格属性</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">cellpadding</span>=<span class="string">"0"</span> <span class="attr">cellspacing</span>=<span class="string">"0"</span> <span class="attr">width</span>=<span class="string">"100%"</span> <span class="attr">align</span>=<span class="string">"center"</span>  <span class="attr">style</span>=<span class="string">"ord-break:break-all;word-wrap:break-word;margin-right:0px;margin-left:0px;border:1px solid #000000; margin-top:10px;"</span>  &gt;</span></span><br></pre></td></tr></table></figure><ul><li>align=”center”表格元素在格子内居中</li><li>cellpadding=”0” cellspacing=”0”元格子（组成表格的每一个小格子）之间的距离为零，即一般表格样式</li><li>border:1px solid #000000;表格线的宽度为1px，颜色是黑色</li></ul><a id="more"></a><h3 id="表格分色"><a href="#表格分色" class="headerlink" title="表格分色"></a>表格分色</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%if(i%2!=0)&#123;</span> %&gt;</span><span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">"#CFEEF8"</span>&gt;</span>... ...<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%&#125;else&#123;</span> %&gt;</span><span class="tag">&lt;<span class="name">tr</span> <span class="attr">bgcolor</span>=<span class="string">"#000005"</span>&gt;</span>... ...<span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">%&#125;</span> %&gt;</span></span><br></pre></td></tr></table></figure><p>这是我自己想的方法，不知道大众化的方法是怎样实现的，其实分色就是利用bgcolor这个属性给表格上色</p><h3 id="点击传值"><a href="#点击传值" class="headerlink" title="点击传值"></a>点击传值</h3><p>文字/按钮链接属性有form，无form，需要返回值，无需返回值直接简单执行</p><p>这是对于“批量按钮”来说的，如果是简单的地址链接，那直接href添加上，无需多说</p><p>但是如果是“删除”这种按钮，点击一下，会触发删除的action，后台会在数据库中将相应的id的记录删掉</p><p>所以在给“删除”添加链接时，就要传递一个参数id，并且处理一个action，但是单纯的用href=action?id=xx </p><p>的方式对于数字英文是可以，不过如果传参不是id，而是一些中文字符，则此处会出现传值乱码现象，具体参见我的：</p><p>这篇：<a href="http://blog.csdn.net/u012935646/article/details/42007041" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/u012935646/article/details/42007041</a></p><h3 id="直接静态链"><a href="#直接静态链" class="headerlink" title="直接静态链"></a>直接静态链</h3><pre><code>&lt;span&gt;&lt;/span&gt;以及&lt;a&gt;&lt;/a&gt;标记都可以添href属性比如&lt;span href=&quot;http:www.baidu.com&quot; &gt;百度&lt;/span&gt;&lt;ahref=&quot;http:www.baidu.com&quot; &gt;百度&lt;/a&gt;都可以为百度二字添加相应的百度链接</code></pre><h3 id="动态action传数据"><a href="#动态action传数据" class="headerlink" title="动态action传数据"></a>动态action传数据</h3><pre><code>利用onclick属性转js；</code></pre><p>同“文字/按钮链接属性有form，无form&gt;…..”具体参见：<a href="http://blog.csdn.net/u012935646/article/details/42007041" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/u012935646/article/details/42007041</a></p><h3 id="多项注册型网站要考虑的东西"><a href="#多项注册型网站要考虑的东西" class="headerlink" title="多项注册型网站要考虑的东西"></a>多项注册型网站要考虑的东西</h3><h4 id="输入检测"><a href="#输入检测" class="headerlink" title="输入检测"></a>输入检测</h4><p>检测邮箱格式的正确性，电话，手机等等，利用正则表达式+实现正则方法</p><p>有多重正则表达式，不能说谁优谁劣，具体有以下等等：</p><p>其一：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"javascript"</span> type=<span class="string">"text/javascript"</span> &gt;</span><br><span class="line">     <span class="comment">/**  * Check email format  */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">emailCheck</span>(<span class="params">obj, labelName</span>) </span>&#123;      </span><br><span class="line">        <span class="keyword">var</span> objName = <span class="built_in">eval</span>(<span class="string">"document.all."</span>+obj);      </span><br><span class="line">        <span class="keyword">var</span> pattern = <span class="regexp">/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/</span>;     </span><br><span class="line">        <span class="keyword">if</span> (!pattern.test(objName.value)) &#123;          </span><br><span class="line">            alert(<span class="string">"请输入正确的邮箱地址。"</span>);          </span><br><span class="line">            objName.focus();         </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">     &#125;</span><br><span class="line"> &lt;<span class="regexp">/script&gt;   </span></span><br><span class="line"><span class="regexp"> &lt;input type="text" id="email" name="email" maxlength="30" onblur="return emailCheck('email', 'email')"  /</span>&gt; <span class="comment">//jsp代码</span></span><br></pre></td></tr></table></figure><p>其二：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;        </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isValidMail</span>(<span class="params"></span>) </span>&#123;            </span><br><span class="line">    <span class="keyword">var</span> TextVal = <span class="built_in">document</span>.getElementById(<span class="string">"TextBox1"</span>).value;            </span><br><span class="line">    <span class="keyword">var</span> Regex = <span class="regexp">/^(?:\w+\.?)*\w+@(?:\w+\.)*\w+$/</span>;            </span><br><span class="line">    <span class="keyword">if</span> (Regex.test(TextVal))&#123;                </span><br><span class="line">        alert(<span class="literal">true</span>);            </span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;                </span><br><span class="line">        <span class="keyword">if</span> (TextVal == <span class="string">""</span>) &#123;                    </span><br><span class="line">            alert(<span class="string">"请输入电子邮件地址！！"</span>);                    </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;                </span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;                    </span><br><span class="line">        alert(<span class="string">"您好，你输入不正确，请重新输入；"</span>);                    </span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"TextBox1"</span>).value = <span class="string">""</span>;                    </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;                </span><br><span class="line">    &#125;            </span><br><span class="line">&#125;   </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;asp:TextBox ID="TextBox1" runat="server"&gt;&lt;/</span>asp:TextBox&gt; <span class="comment">//asp的代码   </span></span><br><span class="line">&lt;asp:Button ID=<span class="string">"Button3"</span> runat=<span class="string">"server"</span> Text=<span class="string">"Button"</span>  OnClientClick=<span class="string">"return isValidMail()"</span> OnClick=<span class="string">"Button3_Click"</span> /&gt;  <span class="comment">//asp的代码</span></span><br></pre></td></tr></table></figure><p>其三：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> temp = <span class="built_in">document</span>.getElementById(<span class="string">"text1"</span>);</span><br><span class="line">    <span class="comment">//对电子邮件的验证</span></span><br><span class="line">    <span class="keyword">var</span> myreg = <span class="regexp">/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]&#123;2,3&#125;$/</span>;</span><br><span class="line">    <span class="keyword">if</span>(!myreg.test(temp.value))&#123;</span><br><span class="line">        alert(<span class="string">'提示\n\n请输入有效的E_mail！'</span>);</span><br><span class="line">        myreg.focus();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//由于方法相同，一下只写出相关的正则表达式</span></span><br><span class="line">    <span class="comment">//对于手机号码的验证（提供了两种方法）</span></span><br><span class="line">    <span class="keyword">var</span> mobile=<span class="regexp">/^((13[0-9]&#123;1&#125;)|159|153)+\d&#123;8&#125;$/</span>;</span><br><span class="line">    <span class="keyword">var</span> mobile1=<span class="regexp">/^(13+\d&#123;9&#125;)|(159+\d&#123;8&#125;)|(153+\d&#123;8&#125;)$/</span>;</span><br><span class="line">    <span class="comment">//对于区号的验证</span></span><br><span class="line">    <span class="keyword">var</span> phoneAreaNum = <span class="regexp">/^\d&#123;3,4&#125;$/</span>;</span><br><span class="line">    <span class="comment">//对于电话号码的验证</span></span><br><span class="line">    <span class="keyword">var</span> phone =<span class="regexp">/^\d&#123;7,8&#125;$/</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码的含义说明：</p><pre><code>1、/^$/ 这个是个通用的格式。  ^ 匹配输入字符串的开始位置；$匹配输入字符串的结束位置2、其中输入需要实现的功能。  + 匹配前面的子表达式一次或多次； ？匹配前面的子表达式零次或一次；  \d  匹配一个数字字符，等价于[0-9]； * 匹配前面的子表达式零次或多次；</code></pre><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="不同选项之间有关联时的动态对应性"><a href="#不同选项之间有关联时的动态对应性" class="headerlink" title="不同选项之间有关联时的动态对应性"></a>不同选项之间有关联时的动态对应性</h3><p>比较麻烦，以后会单独研究一下</p><h4 id="空值检测"><a href="#空值检测" class="headerlink" title="空值检测"></a>空值检测</h4><p>全空格或回车的定性为空的特性，注册时，更改时</p><p>这是对于文本框信息进行检验的一个步骤，当我们进行输入时，应该把空格全部去掉，无论是提交的用户名也好，还是一串查询的信息也好</p><p>空格对于后代的数据库处理其实都是无用的，所以要进行过滤，使用的方法：</p><p>var xxx = inputname.trim()；//假设已经获得了input框的值，并且把它赋值给了inputname</p><p>这样可以把输入到文本框里的字符中的空格给去掉</p><p>再者，如果对于”输入不为空“这个条件进行检测，那么输入一串空格将是必须的，上述的trim()可以吧字符串去掉空格字符，当然对于一串</p><p>空格，处理后就会是空值，即上述方法就可以完成。</p><h4 id="必填判断"><a href="#必填判断" class="headerlink" title="必填判断"></a>必填判断</h4><p>哪个必须输入，哪个不用的提交判断</p><p>这是对于有多项注册项目的网站来说的，比如12306的注册，有一二十项，但是必须填的可能也就那几项，我们会在表格后面紧跟红星*等等方法标记</p><h4 id="具有注册后更改的页面的实现"><a href="#具有注册后更改的页面的实现" class="headerlink" title="具有注册后更改的页面的实现"></a>具有注册后更改的页面的实现</h4><p>有一些是需要动态选择的，比如说：</p><p>有一个提交文档的选项，是或否，选择是，则会出现提交文档的按钮，禁止提交为空，即不提交；如果选择否，那么不会出现提交选项；</p><p>这个实现用js：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yns</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> publish=$(<span class="string">"#formxx [name='publish']:checked"</span>).val();<span class="comment">//内容可忽略就是获取选择项的值,如果选择是，则写一个*号，如果选择否，则写空</span></span><br><span class="line">    <span class="keyword">if</span>(publish==<span class="string">"yes"</span>)&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'cnt'</span>).innerHTML=<span class="string">'&lt;font color="red"&gt; *&lt;/font&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'cnt'</span>).innerHTML=<span class="string">' '</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="注册名判重"><a href="#注册名判重" class="headerlink" title="注册名判重"></a>注册名判重</h4><p>用户名的提交判重实现，用户名已存在</p><p>这对于一个注册网站来说是很重要的，在后台的数据库中，不会允许有两个相同用户名的账号存在，传统方式是提交完后，然后给注册者一个反馈，这是不合理的</p><p>虽然也可以，但是不友好，友好的检测是在用户一旦输入完用户名后就给出相应的弹窗信息，这样用户就会及时的进行修改</p><p>如何实现：</p><p>利用ajax-Asynchronous Javascript And XML异步JavaScript和XML，ajax是一种编程方式并非一种新语言</p><p>可以进行无刷新的检测，即虽然也执行action，也具有后台的处理，但是不会出现跳转，也不会刷新本页面，实现用户名查重的方法如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">checkRegister</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">var</span> uname = $(<span class="string">"#username"</span>).val();</span><br><span class="line">          <span class="comment">//alert(uname);</span></span><br><span class="line">          <span class="comment">//检查输入内容格式</span></span><br><span class="line">      <span class="keyword">if</span>(uname==<span class="string">""</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          alert(<span class="string">"用户名不能为空"</span>);</span><br><span class="line">          $(<span class="string">"#username"</span>).focus();</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line">      $.ajax(&#123;  <span class="comment">//编程方式</span></span><br><span class="line">          type : <span class="string">"post"</span>,</span><br><span class="line">          <span class="keyword">async</span>:<span class="literal">false</span>,</span><br><span class="line">          url : <span class="string">"check.action?uname="</span>+uname,</span><br><span class="line">          success : <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(result==<span class="string">"failure"</span>)&#123;</span><br><span class="line">alert(<span class="string">"用户名已存在"</span>);</span><br><span class="line">$(<span class="string">"#username"</span>).focus();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  failure:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">     &#125;);</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line"> &#125;</span><br><span class="line"> &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><h3 id="数据库中表结构格式的设置"><a href="#数据库中表结构格式的设置" class="headerlink" title="数据库中表结构格式的设置"></a>数据库中表结构格式的设置</h3><ul><li>action?xx=x直接传值乱码的解决 参见：：<a href="http://blog.csdn.net/u012935646/article/details/42007041" target="_blank" rel="external nofollow noopener noreferrer">http://blog.csdn.net/u012935646/article/details/42007041</a></li><li>Firefox中js function报错xx is not defined的问题<br>火狐的Firebug可以说是给我们web开发提供了许多的便利，但是有些时候一些错误却会误导我们，浪费我们的时间：<br>比如页面中写了一个function do，但是在运行页面时没有执行预期的效果，而且出现了一条错误信息：do is not defined<br>如何看待这个错误：这并不是我们function的问题，有的时候一个变量的定义错误，或许是忘记结尾加分号，或许是function程序体里面的括号匹配有问题<br>上述情况都会引起Firebug的报错，毕竟没法对js中的错误定位到行，所以“尽信工具则不如无工具”</li></ul><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>使用js进行按键的屏蔽，鼠标键的屏蔽，即屏蔽复制保存等操作</p><p>这又是一个在现在web项目中经常遇到的需要解决的一个问题，为何：因为有些数据是不能被复制的</p><p>比如说一个会议信息系统可以查询到与会人员的信息，一个普通的注册账户可以正常的查看其它开会人员的信息，这是合情合理的，</p><p>但是如果有人将信息复制，或通过网页保存的方式等等，把这个数据获取到了，那么一些提交的重要文档资料，救会被泄露</p><p>最真实的应用：360图书馆以及 百度文库的在线预览</p><p>如何实现：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">key</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">          <span class="comment">//if(event.shiftKey)&#123;</span></span><br><span class="line">          <span class="comment">//window.close();&#125;</span></span><br><span class="line">          <span class="comment">//禁止shift</span></span><br><span class="line">      <span class="keyword">if</span>(event.altKey)&#123;</span><br><span class="line">          alert(<span class="string">'禁止CTRL-C复制本贴内容'</span>);&#125;</span><br><span class="line">          <span class="comment">//禁止alt</span></span><br><span class="line">          <span class="keyword">if</span>(event.ctrlKey)&#123;</span><br><span class="line">                alert(<span class="string">'禁止CTRL-C复制本贴内容'</span>);&#125;</span><br><span class="line">                <span class="comment">//禁止ctrl</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">document</span>.onkeydown=key;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">window</span>.Event)</span><br><span class="line">          <span class="built_in">document</span>.captureEvents(Event.MOUSEUP);</span><br><span class="line"></span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">norightclick</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">window</span>.Event)&#123;</span><br><span class="line">                <span class="keyword">if</span> (e.which == <span class="number">2</span> || e.which == <span class="number">3</span>)</span><br><span class="line">                      <span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (event.button == <span class="number">2</span> || event.button == <span class="number">3</span>)&#123;</span><br><span class="line">                      event.cancelBubble = <span class="literal">true</span></span><br><span class="line">                      event.returnValue = <span class="literal">false</span>;</span><br><span class="line">                 <span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">Click</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">                alert(<span class="string">'禁止右键粘贴本贴内容'</span>); </span><br><span class="line">                <span class="built_in">window</span>.event.returnValue=<span class="literal">false</span>; </span><br><span class="line">          &#125; </span><br><span class="line">       <span class="built_in">document</span>.oncontextmenu=Click; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一个更简单的方法就是在<body>中加入如下的代码,这样鼠标的左右键都失效了.</body></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">topmargin="0" oncontextmenu="return false" ondragstart="return false" onselectstart ="return false" onselect="document.selection.empty()" </span><br><span class="line">oncopy="document.selection.empty()" onbeforecopy="return false" onmouseup="document.selection.empty()"</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onmousemove</span>=<span class="string">\HideMenu()\</span> <span class="attr">oncontextmenu</span>=<span class="string">"return false"</span> <span class="attr">ondragstart</span>=<span class="string">"return false"</span> <span class="attr">onselectstart</span> =<span class="string">"return false"</span> <span class="attr">onselect</span>=<span class="string">"document.selection.empty()"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">oncopy</span>=<span class="string">"document.selection.empty()"</span> <span class="attr">onbeforecopy</span>=<span class="string">"return false"</span> <span class="attr">onmouseup</span>=<span class="string">"document.selection.empty()"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>禁止网页另存为：在<body>后面加入以下代码：<noscript><iframe src="*.htm"></iframe></noscript></body></p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> HTML </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA动态创建表以及动态插入数据</title>
      <link href="/article/7bfd.html"/>
      <url>/article/7bfd.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）首先，连接数据库是必做的工作，在温习一下。</p><h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>利用JDBC驱动链接Mysql数据其实很简单的，第一要下载一个名为 “mysql-connector-java-5.1.20-bin.jar” 驱动包。并解压到相应的目录！5.1.20是版 本号到目前为止这个是最新的版本！</p><a id="more"></a><p>第一、如果你是在命令行方式下开发，需要把mysql-connector-java-5.1.2.0-bin.jar 添加到系统的CLASSPATH中。怎么加到CLASSPATH中我想不要讲了大家也应懂的吧。</p><p>第二、如果你是用Eclipse开发工具的话，还要配置一下 “Java Build Path”、具体的操作“点击Eclipse的Project-&gt;Properties-&gt;Java Build Path-&gt;Libraries” 现在在看以的窗口中点击右边的Add External JARs  然后选择mysql-connector-java-5.1.2.0-bin.jar驱动 点击打开就完成了配置。</p><p>下面就是Java利用JDBC连接Mysql数据的实例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;   </span><br><span class="line">  </span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectMysql</span> </span>&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;   </span><br><span class="line">        String driver = <span class="string">"com.mysql.jdbc.Driver"</span>;   </span><br><span class="line">        String url = <span class="string">"jdbc:mysql://192.168.1.112:3306/linksystem"</span>;   </span><br><span class="line">        String user = <span class="string">"root"</span>;   </span><br><span class="line">        String password = <span class="string">"blog.micxp.com"</span>;   </span><br><span class="line">        <span class="keyword">try</span> &#123;   </span><br><span class="line">            Class.forName(driver);   </span><br><span class="line">            Connection conn = DriverManager.getConnection(url, user, password);   </span><br><span class="line">            <span class="keyword">if</span> (!conn.isClosed()) &#123;   </span><br><span class="line">                System.out.println(<span class="string">"Succeeded connecting to the Database!"</span>);   </span><br><span class="line">                Statement statement = conn.createStatement();   </span><br><span class="line">                String sql = <span class="string">"select * from flink_list"</span>;   </span><br><span class="line">                ResultSet rs = statement.executeQuery(sql);   </span><br><span class="line">                String name;   </span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;   </span><br><span class="line">  </span><br><span class="line">                    name = rs.getString(<span class="string">"link_name"</span>);   </span><br><span class="line">                    System.out.println(name);   </span><br><span class="line">                &#125;   </span><br><span class="line">  </span><br><span class="line">            &#125;   </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;   </span><br><span class="line">            e.printStackTrace();   </span><br><span class="line">  </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;   </span><br><span class="line">&#125; </span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">上述实例包含在完整的结构中，如果只是作为项目程序的一部分，也可以将其写为一个类，在主程序中<span class="keyword">new</span>对象即可，不再赘述。连接时有时会抛出异常，在一般情况下，密码错误是主要原因，通过mysql工具直接修改即可，另外自己的url也容易出错，上述例中在使用 url=<span class="string">"jdbc:mysql://192.168.1.112:3306/linksystem"</span>  时，就抛出异常。改正方法：</span><br><span class="line"></span><br><span class="line">- 把<span class="number">192.168</span><span class="number">.1</span><span class="number">.112</span>直接改为localhost。</span><br><span class="line"></span><br><span class="line">- linksystem是你建表的数据库名称，要换成你自己的。</span><br><span class="line"></span><br><span class="line">**&lt;&lt;** 更多精彩尽在『程序萌部落』**&gt;&gt;**</span><br><span class="line">**&lt;&lt;** [https:<span class="comment">//www.cxmoe.com](https://www.cxmoe.com) **&gt;&gt;**</span></span><br><span class="line"></span><br><span class="line">### 动态建表</span><br><span class="line"></span><br><span class="line">一切就绪后，开始动态建表，建表代码如下： </span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">sqlstr = <span class="string">"create table random_data("</span>;    </span><br><span class="line">sqlstr+= <span class="string">" id int(32),"</span>;     </span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nodenum-<span class="number">1</span>;i++) sqlstr+=<span class="string">"ND"</span>+i+<span class="string">" int(32),"</span>;     </span><br><span class="line">sqlstr+= <span class="string">"ND"</span>+(nodenum-<span class="number">1</span>)+<span class="string">" int(32)"</span>;  </span><br><span class="line">sqlstr+= <span class="string">" );"</span>;</span><br></pre></td></tr></table></figure><p>上述代码可输出如下形式字符串：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> random_data( <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">32</span>),ND0 <span class="built_in">int</span>(<span class="number">32</span>),ND1 <span class="built_in">int</span>(<span class="number">32</span>),ND2 <span class="built_in">int</span>(<span class="number">32</span>),ND3 <span class="built_in">int</span>(<span class="number">32</span>),ND4 <span class="built_in">int</span>(<span class="number">32</span>),ND5 <span class="built_in">int</span>(<span class="number">32</span>),ND6 <span class="built_in">int</span>(<span class="number">32</span>) );</span><br></pre></td></tr></table></figure><p>即生成一个列名为id，ND0，ND1……的表格，列名显然是动态生成的。生成表格之后要插入数据，现有一ArrayLst存放着全部的数据，要做的就是逐个放入空表中，显然要用到insert语句。</p><p>首先我们可以写出如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nodenum-<span class="number">1</span>;i++)&#123;  </span><br><span class="line">   <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;nolist.get(i).get_feature_count();j++)&#123;  </span><br><span class="line">       sqlin = <span class="string">"insert into random_data( id,"</span>;  </span><br><span class="line">       <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nodenum-<span class="number">1</span>;i++)sqlin+=<span class="string">"ND"</span>+i+<span class="string">","</span>;  </span><br><span class="line">       sqlin+= <span class="string">"ND"</span>+(nodenum-<span class="number">1</span>);  </span><br><span class="line">       sqlin+=<span class="string">") values("</span>;    </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以得到 “ insert into random_data( id,ND0,ND1,ND2,ND3,ND4,ND5,ND6) values( ”的字符串 ，之后的部分必须动态的重构出来，才能拼接完整，令over也是ArrayList类型，是原数据集ArrayList中数据每隔列数个就存入一次得到的，其输出已经形如：</p><pre><code>&apos;2&apos;,&apos;3&apos;,&apos;1&apos;,&apos;0&apos;,&apos;2&apos;,&apos;1&apos;,&apos;4&apos;,  &apos;4&apos;,&apos;2&apos;,&apos;5&apos;,&apos;6&apos;,&apos;2&apos;,&apos;1&apos;,&apos;2&apos;,  &apos;3&apos;,&apos;2&apos;,&apos;4&apos;,&apos;0&apos;,&apos;2&apos;,&apos;2&apos;,&apos;0&apos;,  </code></pre><p>再用 T = T .substring(0,T.length()-1) 这个方法去掉最后重复的逗号，现在，完整的insert语句中values括号内的字符串已经得到，最后过程，有如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;over.size();i++)&#123;  </span><br><span class="line">   String sqldo = sqlin +<span class="string">"'"</span>+(i+<span class="number">1</span>)+<span class="string">"',"</span>+ over.get(i) + <span class="string">");"</span>;  </span><br><span class="line">   <span class="comment">//System.out.println(sqldo);   </span></span><br><span class="line">   statement.executeUpdate(sqldo);             </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出拼接完成的字符串，可得到若干字符串形如：       </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> random_data( <span class="keyword">id</span>,ND0,ND1,ND2,ND3,ND4,ND5,ND6) <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'2'</span>,<span class="string">'4'</span>,<span class="string">'0'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'0'</span>);</span><br></pre></td></tr></table></figure><p>至此，由以上种种操作，已经得到了以下字符串，显然它们就是是我们想要的sql执行语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> random_data( <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">32</span>),ND0 <span class="built_in">int</span>(<span class="number">32</span>),ND1 <span class="built_in">int</span>(<span class="number">32</span>),ND2 <span class="built_in">int</span>(<span class="number">32</span>),ND3 <span class="built_in">int</span>(<span class="number">32</span>),ND4 <span class="built_in">int</span>(<span class="number">32</span>),ND5 <span class="built_in">int</span>(<span class="number">32</span>),ND6 <span class="built_in">int</span>(<span class="number">32</span>) );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> random_data( <span class="keyword">id</span>,ND0,ND1,ND2,ND3,ND4,ND5,ND6) <span class="keyword">values</span>(<span class="string">'3'</span>,<span class="string">'2'</span>,<span class="string">'4'</span>,<span class="string">'1'</span>,<span class="string">'0'</span>,<span class="string">'3'</span>,<span class="string">'2'</span>);  </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> random_data <span class="keyword">where</span> <span class="keyword">id</span> = <span class="string">"16760"</span>; //具体查询不做详述</span><br></pre></td></tr></table></figure><p>由于在for循环中进行，每次拼接完成后随即执行，完成循环的同时也完成了对数据库中数据的插入操作,所以动态建立的表格中便动态插入了数据。</p><p>以上所有内容的关键，就是字符串的拼接，以及所遵循的sql语句的书写格式，在实际调试程序时，最好的方法是在mysql-front中的命令调试器（或命令行）中调试输出的字符串，这个过程应该是个考验细心和耐心的过程。</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> 动态建表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于JAVA中动态创建二维数组的技巧</title>
      <link href="/article/a660.html"/>
      <url>/article/a660.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）看似一个非常简单的问题，但是实际却花了我很多时间。我的目的是，创建一个二维数组str[][]，令 <code>str[][]   &lt;--  Arraylist&lt;Arraylist&lt;T&gt;&gt;</code><br>//此处T指的int(Integer)类型</p><h3 id="创建二维数组"><a href="#创建二维数组" class="headerlink" title="创建二维数组"></a>创建二维数组</h3><p>首先JAVA中创建二维数组的方法无非两种:</p><a id="more"></a><p>一种是静态的，即已知全部数据，比如要建立3乘3的二维数组，每个数组中的个数，及数组中元素是什么都明确已知，注意，是两者都已知才可以静态赋值，例如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int a[][] &#x3D; &#123;&#123;1,2,6&#125;,&#123;3,4,5,6&#125;,&#123;7,8,9&#125;&#125; ;</span><br></pre></td></tr></table></figure><p>静态赋值比较简单，在实际中用的也不多，因为用到此处时多为不同类型的转化问题，所以大多信息存在于已知的类型数据中，要转化为二维数组中，必然要动态的按照原类型中的信息重构二维数组，所以新的二维数组可能每个数组中元素个数都不确定，需要动态确定。</p><h3 id="动态赋值"><a href="#动态赋值" class="headerlink" title="动态赋值"></a>动态赋值</h3><p>动态赋值，也分两种，因为赋值方式除了直接两类型相等外，绝大多数都是通过两层循环，逐个赋值。于是产生了问题，在所需要的二维数组的要求“不高”时，可以直接用形如 int [][]a = new int[3][3]; 来存储，反之则会出错误。</p><p>上述的“要求”高低，就是说在不确定每个数组长度时，直接用较大的空间去存，就好像 变量 a[] 是一个班的成绩，它是未知的，可以直接用int a[100]来存一样，可能结果只用了100个中的30个，但是也完成了储存或输出的任务。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>那么，如果要求是”高”的，意思是，结果二维数组不仅仅完成存储的任务，还要保证每个数组的长度，同原信息保持一致。回到正题，要完成 <code>str[][]   &lt;--  Arraylist&lt;Arraylist&lt;T&gt;&gt;</code>  这一过程，用str[1000][1000]来存简单情况下是没有问题的，但二维数组却丢失了ArrayList中的每个“小链表”的长度 这一重要信息。其结果第一是浪费了空间，第二个很重要的是这个二维数组不能再利用，可能通过限制可以完成输出的任务，但是用于递归嵌套等对每个数组长度有明确要求的时候，str[1000][1000]完全没用。</p><p>其实，二维数组的每一维都可以动态创建，这一点很重要，动态第一维的方法：int [][]a = new a[第一维数][]；</p><p>然后，在上面一维创建后，同样可以动态第二维：int a[ i ] = new a[ 第二维数 ]；</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>比如两次循环时，便可以如下操作：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> [][] arr ;</span><br><span class="line">arr = <span class="keyword">new</span> <span class="keyword">int</span> [ 一维数 ][];    <span class="comment">//动态创建第一维</span></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span> ; i &lt; 一维数 ; i++ ) &#123;</span><br><span class="line">    arr [ i ] = <span class="keyword">new</span> <span class="keyword">int</span> [ 二维数 ];    <span class="comment">//动态创建第二维</span></span><br><span class="line">    <span class="keyword">for</span>( j=<span class="number">0</span> ; j &lt; 二维数 ; j++) &#123;</span><br><span class="line">          arr [i][j] = j; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由上可完成赋值，结果每个数组个数可能都不相同，即完成了<code>Arraylist&lt;Arraylist&lt;T&gt;&gt;</code> 给 str[][]  赋值的工作。</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数组 </tag>
            
            <tag> 动态赋值 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在VC6.0中连接mysql数据库的方法实例</title>
      <link href="/article/39cd.html"/>
      <url>/article/39cd.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）最近用JAVA写程序，在连接数据库并操作上感觉还是较其他语言简单多了，在这方面C/C++就显得有点繁杂，不过也并非难事。<br>首先就是要清除mysql提供的关于C的API，连接：<a href="http://dev.mysql.com/doc/refman/5.1/zh/apis.html" target="_blank" rel="external nofollow noopener noreferrer">http://dev.mysql.com/doc/refman/5.1/zh/apis.html</a></p><a id="more"></a><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>内容包括以下，用到的大概前几项，主要是数据类型，函数概括，函数描述</p><pre><code>25.2. MySQL C API25.2.1. C API数据类型25.2.2. C API函数概述25.2.3. C API函数描述25.2.4. C API预处理语句25.2.5. C API预处理语句的数据类型25.2.6. C API预处理语句函数概述25.2.7. C API预处理语句函数描述25.2.8. C API预处理语句方面的问题25.2.9. 多查询执行的C API处理25.2.10. 日期和时间值的C API处理25.2.11. C API线程函数介绍25.2.12. C API嵌入式服务器函数介绍25.2.13. 使用C API时的常见问题25.2.14. 创建客户端程序25.2.15. 如何生成线程式客户端</code></pre><p>以上内容非常全面，是mysql官方资料，要自己多看多了解，学会查询即可。<br>知道了上面的内容，那自己写个连接代码也是很容易的，主要就是几个异常的检测以及连接操作，具体的API上面目录里都有详细讲解，在此只贴出代码：</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><p>必要的头文件包括以下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock.h&gt;  //最好放在首位，位置关系会导致错误,mysql.h</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"ws2_32.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">"libmysql.lib"</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">连接及操作的代码实现：</span><br><span class="line">MYSQL mydata;</span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == mysql_library_init(<span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>)) &#123;<span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_library_init() succeed"</span> &lt;&lt; <span class="built_in">endl</span>;&#125; </span><br><span class="line"><span class="keyword">else</span> &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_library_init() failed"</span> &lt;&lt; <span class="built_in">endl</span>;  <span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">NULL</span> != mysql_init(&amp;mydata)) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_init() succeed"</span> &lt;&lt; <span class="built_in">endl</span>;&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_init() failed"</span> &lt;&lt; <span class="built_in">endl</span>;  <span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == mysql_options(&amp;mydata, MYSQL_SET_CHARSET_NAME, <span class="string">"gbk"</span>)) </span><br><span class="line">&#123;<span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_options() succeed"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;  <span class="keyword">return</span> <span class="number">-1</span>;  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">NULL</span>!=mysql_real_connect(&amp;mydata,<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">""</span>,<span class="string">"cap"</span>,<span class="number">3306</span>,<span class="literal">NULL</span>,<span class="number">0</span>))  <span class="comment">//更改项</span></span><br><span class="line">&#123;<span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_real_connect() succeed"</span> &lt;&lt; <span class="built_in">endl</span>;&#125;       </span><br><span class="line"><span class="keyword">else</span> &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"mysql_real_connect() failed"</span> &lt;&lt; <span class="built_in">endl</span>;<span class="keyword">return</span> <span class="number">-1</span>;  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///*****************************/  生成数据，可忽略不看  /***************/</span></span><br><span class="line"> mysql_query(&amp;mydata,<span class="string">"truncate table n_e_w;"</span>);</span><br><span class="line"> <span class="built_in">string</span> sqlstr;   </span><br><span class="line"> sqlstr += <span class="string">"insert into n_e_w "</span>; </span><br><span class="line"> sqlstr += <span class="string">"set input=(SELECT c_name FROM concept ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"output=(SELECT c_name FROM concept ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"beforer=(SELECT c_name FROM concept ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"afterr=(SELECT c_name FROM concept ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"s_one=(SELECT s FROM s_table ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"s_two=(SELECT s FROM s_table ORDER BY RAND() LIMIT 1),"</span>;</span><br><span class="line"> sqlstr += <span class="string">"s_three=(SELECT s FROM s_table ORDER BY RAND() LIMIT 1);"</span>;</span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">int</span> t = <span class="number">0</span>; t &lt; <span class="number">30</span> ; t++)mysql_query(&amp;mydata,sqlstr.c_str()); </span><br><span class="line"><span class="comment">//******************************/  获得数据，存到traindata  /**************/</span></span><br><span class="line">MYSQL_RES *result = <span class="literal">NULL</span>;</span><br><span class="line">mysql_query(&amp;mydata,<span class="string">"SELECT * FROM n_e_w"</span>);</span><br><span class="line"></span><br><span class="line">result = mysql_store_result(&amp;mydata); <span class="comment">//取得并打印行数</span></span><br><span class="line"><span class="keyword">int</span> rowcount = mysql_num_rows(result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> fieldcount = mysql_num_fields(result);  <span class="comment">//取得并打印各字段的名称</span></span><br><span class="line"></span><br><span class="line">MYSQL_ROW row = <span class="literal">NULL</span>;</span><br><span class="line">row = mysql_fetch_row(result);    </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;rowcount;j++)</span><br><span class="line">&#123; </span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fieldcount<span class="number">-1</span>; i++)</span><br><span class="line"> &#123;</span><br><span class="line">traindata[j][i] = row[i];</span><br><span class="line"><span class="comment">//cout&lt;&lt;"整个结果集显示："&lt;&lt;traindata[j][i] &lt;&lt;"\t";</span></span><br><span class="line"> &#125;     </span><br><span class="line">                row = mysql_fetch_row(result);</span><br><span class="line">&#125;    </span><br><span class="line">   <span class="comment">//for(int ii=0;ii&lt;DEFINE_COUNT;ii++) cout&lt;&lt;traindata[ii][1]&lt;&lt;endl;</span></span><br><span class="line">   mysql_free_result(result) ;</span><br><span class="line">mysql_close(&amp;mydata);</span><br><span class="line">mysql_server_end();</span><br></pre></td></tr></table></figure><p>上述内容只是简单的建立连接后查询内容，其中只在建立连接部分做了异常判别处理，其实还有很多工作没有做，比如未涉及的创建表，删除表等等操作，其都有对应的异常判别的API函数，通过IF条件判断，可以对创建不成功或删除不成功等异常情况予以显式输出，从而完善代码。</p><h3 id="其余配置"><a href="#其余配置" class="headerlink" title="其余配置"></a>其余配置</h3><p>以上是代码书写的工作，其实在书写代码之前，要用C++连（本人用的VC6.0）数据库，还要在VC中做相应的配置工作：</p><ol><li>打开VC6.0 工具栏Tools菜单下的Options选项，在Directories的标签页中右边的“Show directories for:”下拉列表中选中“Includefiles”，然后在中间列表框中添加你本地安装MySQL的include目录路径（X:...\include）。</li><li>在“Show directories for:”下拉列表中选中“Library files”，然后添加本地安装MySQL的Lib目录路径。Lib目录下还有debug和opt两个目录，建议选debug（X:...\lib\debug）。</li><li>在“Project settings-&gt;Link:Object/library modules”里面添加“libmysql.lib”。</li><li>在程序开头的写法，具体参照上文中代码。 注：#include “winsock.h”一定要写在#include “mysql.h”的前面，否则出错。</li><li>将“libmySQL.lib、libmySQL.dll”拷到你所建的工程的目录下。</li></ol><p>到此，完成配置后，即可进行连接并对数据库进行操作。</p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> C/C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从N个数组分别取值，穷尽全部情况</title>
      <link href="/article/468f.html"/>
      <url>/article/468f.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）要求是这样的：</p><h3 id="具体要求"><a href="#具体要求" class="headerlink" title="具体要求"></a>具体要求</h3><p>有N个数组，每个数组元素不定，从每个数组都中取出一个，组成长度为N的序列，求穷尽序列的所有情况。</p><p>很明显这区别于给定几个元素并把这些元素全排列的问题，全排列要交换位置，此处则不同，暂称“伪全排列”。</p><p>网上资料很多，不过多用指针或者指针数组，这对于JAVA来说没一点用。</p><a id="more"></a><p>在此，我把JAVA中的实现来个详细说明。</p><p>首先，思路为递归，将其写为成员函数，方便调用。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ABC</span></span>&#123;   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[][]str;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ABC</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">            ... ...  </span><br><span class="line">            <span class="comment">//str[][]的赋值语句，得到存储完成的二维数组，见‘创建动态二维数组的技巧’  </span></span><br><span class="line">            ... ...  </span><br><span class="line">        <span class="keyword">int</span> result[]=<span class="keyword">new</span> <span class="keyword">int</span>[ N ];  <span class="comment">//此处即符合要求的，有N个数组  </span></span><br><span class="line">        show(result,<span class="number">0</span>);  <span class="comment">//进入递归函数，进行测试  </span></span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(<span class="keyword">int</span>[] result1, <span class="keyword">int</span> curr)</span></span>&#123;      <span class="comment">//curr即代表当前取元素的数组  </span></span><br><span class="line">        <span class="keyword">if</span> (curr == N) &#123;    <span class="comment">//curr==N即完成一个序列，输出一次结果集  </span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;result1.length;k++) System.out.print(result1[k]);   </span><br><span class="line">            System.out.println();   <span class="comment">//输出格式控制  </span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;str[curr].length; ++i) &#123;     <span class="comment">//每次循环此次取元素的数组的长度  </span></span><br><span class="line">                result1[curr] = str[curr][i];               <span class="comment">//关键赋值处，给到结果集  </span></span><br><span class="line">                show(result1, curr+<span class="number">1</span>);  <span class="comment">//一次递归完成，即从下一个数组中去取元素，curr+1.       </span></span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上可完成所有情况的输出，输入集是个二维数组，可方便由多种数据类型转化得到。输出是一维数组，也可方便进行再处理，故代码易改造，简洁明了。以上即是实现的所有代码(测试+方法)。</p><p>测试如下,从七个数组中取：</p><pre><code>[01234]，[012]，[012345]，[0123456]，[0123456]，[012]，[01234]</code></pre><p>情况序列计数为66150个，结果集输出正确，此处省略。</p>]]></content>
      
      
      <categories>
          
          <category> Java/数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数组 </tag>
            
            <tag> Java </tag>
            
            <tag> 排列组合 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于图中节点间的概率求解问题</title>
      <link href="/article/4735.html"/>
      <url>/article/4735.html</url>
      
        <content type="html"><![CDATA[<p>（本文年代久远，请谨慎阅读）前提：节点是含有若干特征（小节点）的大节点，大节点间连接实际为特征间的连接</p><p>在一个网络图中，若干节点之间的概率问题有以下几种：</p><p>设现有A,B,C等若干大节点，其内特征为ai,bj,ck;</p><a id="more"></a><pre><code>P(A); //数出A节点发散的所有边的数量除以图中出现的总边数P(AB); //即P(A)*P(B)，原理同上P(A,B); //此为联合概率，如果AB之间不相联系，则直接为零P(A | B); //AB间相关联边数/B涉及的边数P(A | B,C); //在上条基础上求加和，待改进P(A,C | B); //与AC两节点相关联的边数/B的边数，待改进P(ai | bj); //该bj特征与ai的边数/bj涉及的边数P(ai | bj,ck); //在上条基础上求加和，待改进P(ai,bj | ck); //ck与ai，bj两特征相关联的边数/ai，bj两特征的边数，待改进</code></pre><p>以上这么多都是区别于传统概率论中的求解方法，因为节点之间表现发生与不发生的</p><p>标致就是之间有没有边！！</p><h3 id="求两个节点间的概率"><a href="#求两个节点间的概率" class="headerlink" title="求两个节点间的概率"></a>求两个节点间的概率</h3><p>此问题的前提是，节点为大节点，内有若干特征，节点间的连接（或称为连线）实际为特征之间的连线。且两节点不是孤立的，而是在一个网络（或称一个图）中。</p><p><strong>&lt;&lt;</strong> 更多精彩尽在『程序萌部落』<strong>&gt;&gt;</strong><br><strong>&lt;&lt;</strong> <a href="https://www.cxmoe.com">https://www.cxmoe.com</a> <strong>&gt;&gt;</strong></p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>利用已知的特征之间的边，来分别计算边的条数，直接用条数来计算概率。</p><p>example：</p><pre><code>求条件概率P(A|B)，A内有 a0,a1,a2；B内有b0,b1；</code></pre><p>现求节点B“发生”的情况下节点A发生的概率，用公式推导P(A|B)=P(AB)/P(B)；或者直接由实际出发，</p><p>可得出：</p><p>分子是AB间特征的连线条数，分母是B自己特征的全部连线条数，注意B除了与A点的特征相连外还与其他点相连。</p><p>由上述可用连线边数来求得概率。</p><p><img src="http://img.blog.csdn.net/20140920155445687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMjkzNTY0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt></p><p>但是，现有一公式如图，</p><p>并不是用的节点间数边数的方法，而是进而细化到节点内的特征之间，最底层是数特征的边数，求得是P(ai|bj)的概率，概率最后加和，看似很完美。</p><p>但有个致命问题，P(ai|bj)的每一个都是概率值，0~1，对若干项加和后极有可能大于1  !!</p><p>说明这个公式是有问题的，目前的解决办法是：求加权平均</p><p>这个平均不是所有特征数的和，而是仅仅有概率的数量，即P(ai|bj)=0时，不算入其内。</p><p>目前暂且这样处理。</p><p>以上两种已java编程实现，结果有较大差异，不过上述思路大体正确，先记于此</p>]]></content>
      
      
      <categories>
          
          <category> ML/R学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 节点概率 </tag>
            
            <tag> 贝叶斯公式 </tag>
            
            <tag> 总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将博客搬至CSDN</title>
      <link href="/article/38f4.html"/>
      <url>/article/38f4.html</url>
      
        <content type="html"><![CDATA[<p>为了不影响文章列表，就放在最最后面吧，这是为了搬迁博客用的验证页面。</p><p>————编辑于2020年8月7日</p>]]></content>
      
      
      <categories>
          
          <category> Daily_Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
